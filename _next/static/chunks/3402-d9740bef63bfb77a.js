(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3402],{3387:function(e,t,a){"use strict";a.d(t,{xu:function(){return l}});var n=a(8126),i=a(959),r=a(4771);function o(e,t){let a=e+"Geometry";return i.forwardRef(({args:e,children:r,...o},l)=>{let s=i.useRef(null);return i.useImperativeHandle(l,()=>s.current),i.useLayoutEffect(()=>void(null==t||t(s.current))),i.createElement("mesh",(0,n.Z)({ref:s},o),i.createElement(a,{attach:"geometry",args:e}),r)})}let l=o("box");o("circle"),o("cone"),o("cylinder"),o("sphere"),o("plane"),o("tube"),o("torus"),o("torusKnot"),o("tetrahedron"),o("ring"),o("polyhedron"),o("icosahedron"),o("octahedron"),o("dodecahedron"),o("extrude"),o("lathe"),o("capsule"),o("shape",({geometry:e})=>{let t=e.attributes.position,a=new r.Box3().setFromBufferAttribute(t),n=new r.Vector3;a.getSize(n);let i=[],o=0,l=0,s=0,d=0;for(let e=0;e<t.count;e++)o=t.getX(e),l=t.getY(e),s=(o-a.min.x)/n.x,d=(l-a.min.y)/n.y,i.push(s,d);e.setAttribute("uv",new r.Float32BufferAttribute(i,2))})},6687:function(e,t,a){"use strict";var n=a(1527),i=a(959),r=a(5542),o=a(3387);t.Z=e=>{let t,{size:a,scale:l}=e,s=(0,i.useRef)();return(0,r.A)((e,t)=>{s.current.rotation.x=s.current.rotation.y+=t*Math.PI}),null!==a?t=a:l&&(console.log(l),t=l.xy.min()),(0,n.jsx)(o.xu,{ref:s,scale:t,children:(0,n.jsx)("meshNormalMaterial",{})})}},7676:function(e,t,a){"use strict";a.d(t,{Z:function(){return p}});var n=a(1527),i=a(83),r=a(959),o=a(6468),l=a(4125),s=a(4661),d=a.n(s),u=a(7848),f=a.n(u);let c=[{id:1,name:"Heart",url:"heart"},{id:2,name:"Skateboard",url:"skateboard"},{id:3,name:"Watch",url:"watch"},{id:4,name:"Helmet",url:"helmet"},{id:5,name:"Sword",url:"sword"},{id:6,name:"Shield",url:"shield"},{id:7,name:"Duck",url:"duck"}];function p(e){let[t,a]=(0,r.useState)(1),s=(0,l.useRouter)(),{pathname:u}=s;return(0,r.useEffect)(()=>{let e=parseInt(u.substring(20));a(e)},[u]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f(),{children:(0,n.jsx)("title",{children:"Labs - Raytracer"})}),(0,n.jsxs)("section",{className:"lab_show",children:[(0,n.jsxs)(i.Xz,{dpr:1.5,camera:{position:[0,.5,8],fov:35},children:[e.children,(0,n.jsx)(o.z,{makeDefault:!0,dampingFactor:.2})]}),(0,n.jsxs)("div",{className:"ray_menu",children:[(0,n.jsx)("h2",{className:"ray_title",children:"RayTracer Demos"}),(0,n.jsx)("ul",{className:"ray_list",children:c.map(e=>(0,n.jsx)("li",{className:"ray_item ".concat(e.id===t?"current":""),children:(0,n.jsx)(d(),{className:"line_btn",href:"/labs/raytracer/"+e.url,children:(0,n.jsxs)("div",{className:"line_btn__inner",children:[(0,n.jsx)("div",{className:"line_btn__text",children:e.name}),(0,n.jsx)("div",{className:"line_btn__line"})]})})},e.id))})]})]})]})}},1762:function(e,t,a){"use strict";var n=a(4806);let i={movingDownsampling:{value:!0,label:"移动过程中降低采样"},useTileRenderer:{value:!1,label:"使用Tile渲染器"},samples:{value:32,min:8,max:256,step:4,label:"采样"},bounces:{value:1,min:1,max:10,step:1,label:"反弹次数"},envMapIntensity:{value:1,min:0,max:3,label:"环境纹理亮度"},denoise:(0,n.so)({enableDenoise:{value:!0,label:"开启降噪"},enableTemporalDenoise:{value:!0,label:"开启实时降噪"},enableSpatialDenoise:{value:!0,label:"开启立体空间降噪"}})};t.Z=i},1674:function(e,t,a){"use strict";var n=a(1527),i=a(959),r=a(5542),o=a(4134),l=a(4771),s=a(7371);let d=i.forwardRef((e,t)=>{let{children:a,renderIndex:d=1,samples:u=64,...f}=e,c=i.useRef(null),p=i.useRef(),{scene:m,controls:L,camera:h,gl:x,size:v,viewport:A}=(0,r.z)();i.useEffect(()=>{p.current=new s.LGLTracerRenderer({canvas:{getContext:x.getContext,getExtension:x.getExtension},loadingCallback:{onProgress:()=>null,onComplete:()=>null}}),p.current.canvas=x.domElement,p.current.gl=x.getContext();let e=!1;return Array.isArray(a)?(a.forEach((t,n)=>{if("rectAreaLight"===t.type||"directionalLight"===t.type||"pointLight"===t.type||"sphereAreaLight"===t.type){let e=t.props.color?t.props.color:"#fff",i=t.props.intensity?t.props.intensity:1,r=t.props.radius?t.props.radius:1,o=t.props.width?t.props.width:1,l=t.props.height?t.props.height:1,d={rectAreaLight:new s.RectAreaLight(e,i,o,l),directionalLight:new s.DirectionalLight(e,i),pointLight:new s.PointLight(e,i),sphereAreaLight:new s.SphereAreaLight(e,i,r)},u=d[t.type],f=t.props.position?t.props.position:[0,0,0],p=t.props.target?t.props.target:[0,0,0];u.position.set(f[0],f[1],f[2]),("rectAreaLight"===t.type||"directionalLight"===t.type)&&u.target.set(p[0],p[1],p[2]),c.current.add(u),a=Array.from(a).splice(n,1)}else if("Environment"===t.type.name||"HO"===t.type.name||t.props.files){e=!0;let i=t.props.files,r=new o.x().setDataType(l.FloatType),s=r.load(i,()=>{});c.current.environment=s,p.current.enviromentVisible=!1,a=Array.from(a).splice(n,1)}}),e||(p.current.enviromentVisible=!!m.background,c.current.environment=m.environment),p.current.needsUpdate=!0,p.current.pipeline&&p.current.render(c.current,h)):(p.current.enviromentVisible=!!m.background,c.current.environment=m.environment),()=>{p.current.canvas=null,p.current.gl=null,p.current.pipeline=null}},[]);let _=i.useCallback(()=>{p.current&&(p.current.needsUpdate=!0,p.current.pipeline&&p.current.render(c.current,h))},[]);return i.useEffect(()=>{let{denoiseColorBlendFactor:e,denoiseMomentBlendFactor:t,denoiseColorFactor:a,denoisePositionFactor:n,...i}=f;Object.assign(p.current,i),void 0!==e&&p.current.setDenoiseColorBlendFactor(e),void 0!==t&&p.current.setDenoiseMomentBlendFactor(t),void 0!==a&&p.current.setDenoiseColorFactor(a),void 0!==n&&p.current.setDenoisePositionFactor(n),_()},[f]),i.useEffect(()=>{if(L)return L.addEventListener("start",_),()=>L.removeEventListener("start",_)},[L]),i.useEffect(()=>{p.current.setSize(v.width,v.height),p.current.setPixelRatio(A.dpr),_()},[v,A]),i.useEffect(()=>void p.current.buildScene(c.current,h).then(_),[]),i.useImperativeHandle(t,()=>p.current,[]),(0,r.A)(()=>{p.current&&p.current.pipeline&&p.current.getTotalSamples()<u&&p.current.render(c.current,h)},d),(0,n.jsx)("scene",{ref:c,children:a})});t.Z=d},7371:function(e,t,a){/*
@license
MIT license statement included in LGLTracer:

GLSL-PathTracer:
Copyright 2019-2021 Asif Ali. MIT License

ray-tracing-renderer:
Copyright 2019 HOVER. MIT License

LGLTracer is not open source, but for this closed source version, you can use it freely (including commercially). 
If you have any questions, please feel free to contact me by email(lg2lugang@gmail.com).
*/var n=Object.defineProperty,i=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,d=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,u=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&d(e,a,t[a]);if(o)for(var a of o(t))s.call(t,a)&&d(e,a,t[a]);return e},f=(e,t)=>i(e,r(t));!function(e,t){"use strict";let a;function n(e,t){let a={};for(let n of t)a[n]=e.getExtension(n);for(let e in a)if(!a[e])return console.error("".concat(e," no supported!")),!1;return a}function i(e,t,a){return Math.min(Math.max(e,t),a)}function r(e,t){return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-4;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>a)return!1;return!0}(e.matrixWorld.elements,t.matrixWorld.elements)&&e.aspect===t.aspect&&e.fov===t.fov}let o=["EXT_color_buffer_float","EXT_float_blend"],l=["OES_texture_float_linear"];function s(e,t){let{color:a,depth:n}=t,i=e.createFramebuffer();function r(){e.bindFramebuffer(e.FRAMEBUFFER,i)}function o(){e.bindFramebuffer(e.FRAMEBUFFER,null)}return function(){r();let t=[];for(let n in a){void 0===(n=Number(n))&&console.error("invalid location");let i=a[n];e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,i.target,i.texture,0),t.push(e.COLOR_ATTACHMENT0+n)}e.drawBuffers(t),n&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,n.target,n.texture),o()}(),{color:a,bind:r,unbind:o,dispose:function(){e.deleteFramebuffer(i)}}}var d={source:"layout(location=0)in vec2 a_position;out vec2 vCoord;void main(){vCoord=a_position;gl_Position=vec4(2.*a_position-1.,0,1);}"};function c(e,t){return{values:"uniform".concat(e).concat(t),array:"uniform".concat(e).concat(t,"v")}}function p(e,t){return{matrix:e===t?"uniformMatrix".concat(e,"fv"):"uniformMatrix".concat(e,"x").concat(t,"fv")}}function m(e){let t={};for(let a=0;a<e.length;a++)t[e[a]]=a;return t}function L(e,t,a,n){let i="#version 300 es\nprecision mediump float;\nprecision mediump int;\nprecision lowp isampler2D;\n";return n&&(i+=function(e){let t="";for(let a in e){let n=e[a];n&&(t+="#define ".concat(a," ").concat(n,"\n"))}return t}(n)),t===e.FRAGMENT_SHADER&&a.outputs&&(i+=function(e){let t="",a=m(e);for(let e in a)t+="layout(location = ".concat(a[e],") out vec4 out_").concat(e,";\n");return t}(a.outputs)),a.includes&&(i+=function(e,t){let a="";for(let n of e)a+="function"==typeof n?n(t):n;return a}(a.includes,n)),"function"==typeof a.source?i+=a.source(n):i+=a.source,function(e,t,a){let n=e.createShader(t);if(e.shaderSource(n,a),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))return n;let i=a.split("\n").map((e,t)=>"".concat(t+1,": ").concat(e)).join("\n");throw console.log(i),e.getShaderInfoLog(n)}(e,t,i)}function h(e,t){let{defines:a,vertex:n}=t;return L(e,e.VERTEX_SHADER,n,a)}function x(e,t){let{fragment:n,vertex:i}=t,r=i instanceof WebGLShader?i:h(e,t),o=n instanceof WebGLShader?n:function(e,t){let{defines:a,fragment:n}=t;return L(e,e.FRAGMENT_SHADER,n,a)}(e,t),l=function(e,t,a,n,i){let r=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,a),n&&e.transformFeedbackVaryings(r,n,void 0),e.linkProgram(r),e.detachShader(r,t),e.detachShader(r,a),e.getProgramParameter(r,e.LINK_STATUS))return r;throw e.getProgramInfoLog(r)}(e,r,o);return f(u({},function(e,t){let n=function(e,t){let n=function(e,t){let a={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;i++){let{name:n,type:r}=e.getActiveUniform(t,i),o=e.getUniformLocation(t,n);o&&(a[n]={type:r,location:o})}return a}(e,t),i={},r=[];for(let e in n){let{type:t,location:a}=n[e],r={type:t,location:a,v0:0,v1:0,v2:0,v3:0};i[e]=r}let o=new Set;return a=a||{[e.FLOAT]:c(1,"f"),[e.FLOAT_VEC2]:c(2,"f"),[e.FLOAT_VEC3]:c(3,"f"),[e.FLOAT_VEC4]:c(4,"f"),[e.INT]:c(1,"i"),[e.INT_VEC2]:c(2,"i"),[e.INT_VEC3]:c(3,"i"),[e.INT_VEC4]:c(4,"i"),[e.SAMPLER_2D]:c(1,"i"),[e.SAMPLER_2D_ARRAY]:c(1,"i"),[e.FLOAT_MAT2]:p(2,2),[e.FLOAT_MAT3]:p(3,3),[e.FLOAT_MAT4]:p(4,4)},{setUniform:function(e,t,a,n,l){let s=i[e];s?(s.v0=t,s.v1=a,s.v2=n,s.v3=l,r.push(s)):o.has(e)||o.add(e)},upload:function(){for(;r.length>0;){let{type:t,location:n,v0:i,v1:o,v2:l,v3:s}=r.pop(),d=a[t];if(i&&i.length){if(d.matrix){let t=o||!1;e[d.matrix](n,t,i)}else e[d.array](n,i)}else e[d.values](n,i,o,l,s)}}}}(e,t),i={},r=1;function o(){for(let t in i){let{tex:a,unit:n}=i[t];e.activeTexture(e.TEXTURE0+n),e.bindTexture(a.target,a.texture)}}return{attribLocs:function(e,t){let a={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){let{name:n}=e.getActiveAttrib(t,i);n&&(a[n]=e.getAttribLocation(t,n))}return a}(e,t),bindTextures:o,program:t,setTexture:function(e,t){if(t){if(i[e])i[e].tex=t;else{let a=r++;n.setUniform(e,a),i[e]={unit:a,tex:t}}}},setUniform:n.setUniform,textures:i,useProgram:function(){let a=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e.useProgram(t),n.upload(),a&&o()},dispose:function(){for(let t in i){let{tex:a}=i[t];e.deleteTexture(a.texture)}e.deleteProgram(t)}}}(e,l)),{outputLocs:n.outputs?m(n.outputs):{}})}function v(e,t){let a,n,{width:r=null,height:o=null,data:l=null,length:s=1,channels:d=null,storage:u=null,flipY:f=!1,gammaCorrection:c=!1,wrapS:p=e.CLAMP_TO_EDGE,wrapT:m=e.CLAMP_TO_EDGE,minFilter:L=e.NEAREST,magFilter:h=e.NEAREST}=t;r=r||l.width||0,o=o||l.height||0;let x=e.createTexture();Array.isArray(l)&&(l=(n=l)[0]),a=n||s>1?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D,e.activeTexture(e.TEXTURE0),e.bindTexture(a,x),e.texParameteri(a,e.TEXTURE_WRAP_S,p),e.texParameteri(a,e.TEXTURE_WRAP_T,m),e.texParameteri(a,e.TEXTURE_MIN_FILTER,L),e.texParameteri(a,e.TEXTURE_MAG_FILTER,h),d||(d=l&&l.length?l.length/(r*o):4),d=i(d,1,4);let{type:v,format:A,internalFormat:_}=function(e,t,a,n,i){let r,o;let l=n instanceof Uint8Array||n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof ImageData||n instanceof ImageBitmap,s=n instanceof Float32Array;return"byte"===a||!a&&l?(o=({1:e.R8,2:e.RG8,3:i?e.SRGB8:e.RGB8,4:i?e.SRGB8_ALPHA8:e.RGBA8})[t],r=e.UNSIGNED_BYTE):"float"===a||!a&&s?(o=({1:e.R32F,2:e.RG32F,3:e.RGB32F,4:e.RGBA32F})[t],r=e.FLOAT):"halfFloat"===a?(o=({1:e.R16F,2:e.RG16F,3:e.RGB16F,4:e.RGBA16F})[t],r=e.HALF_FLOAT):"snorm"===a&&(o=({1:e.R8_SNORM,2:e.RG8_SNORM,3:e.RGB8_SNORM,4:e.RGBA8_SNORM})[t],r=e.UNSIGNED_BYTE),{format:({1:e.RED,2:e.RG,3:e.RGB,4:e.RGBA})[t],internalFormat:o,type:r}}(e,d,u,l,c);if(n){e.texStorage3D(a,1,_,r,o,n.length);for(let t=0;t<n.length;t++){let i=n[t].width||r,l=n[t].height||o;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,Array.isArray(f)?f[t]:f),e.texSubImage3D(a,0,0,0,t,i,l,1,A,v,n[t])}}else s>1?e.texStorage3D(a,1,_,r,o,s):(e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,f),e.texStorage2D(a,1,_,r,o),l&&e.texSubImage2D(a,0,0,0,r,o,A,v,l));return e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),{target:a,texture:x}}class A extends t.Material{copy(e){super.copy(e),this.materialType=e.materialType,this.isRayTracingMaterial=e.isRayTracingMaterial}constructor(){super(),this.materialType=null,this.isRayTracingMaterial=!0}}class _ extends A{copy(e){return this.color=(new t.Color).copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.emissive=(new t.Color).copy(e.emissive),this.emissiveMap=e.emissiveMap,this.normalMap=e.normalMap,this.normalScale=(new t.Vector2).copy(e.normalScale),this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.specularTint=e.specularTint,this.sheen=e.sheen,this.sheenTint=e.sheenTint,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,this.subsurface=e.subsurface,this.transmission=e.transmission,this.ior=e.ior,this.atDistance=e.atDistance,this.anisotropic=e.anisotropic,this.extinction=(new t.Color).copy(e.extinction),this.alpha=e.alpha,this}clone(){return(new this.constructor).copy(this)}fromBasicMaterial(e){return this.name=e.name,e.color&&this.color.copy(e.color),e.map&&(this.map=e.map),this}fromStandardMaterial(e){return this.name=e.name,this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.transmission=e.transmission||0,this.ior=e.ior||1.5,this.clearcoat=e.clearcoat||0,this.clearcoatRoughness=e.clearcoatRoughness||0,this.sheen=e.sheen||0,this.sheenTint=e.sheenTint||.5,this.alpha=e.opacity,this.map=e.map,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,e.isGLTFSpecularGlossinessMaterial&&(this.workflow="Specular",this.specularColor.copy(e.specular),this.glossiness=e.glossiness,this.specularMap=e.specularMap,this.glossinessMap=e.glossinessMap),this}constructor(e){super(),this.materialType="Disney",this.workflow="Metalness",this.color=new t.Color(16777215),this.roughness=.5,this.metalness=0,this.map=null,this.emissive=new t.Color(0),this.emissiveMap=null,this.normalMap=null,this.normalScale=new t.Vector2(1,1),this.roughnessMap=null,this.metalnessMap=null,this.specularTint=0,this.sheen=0,this.sheenTint=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.subsurface=0,this.alpha=1,this.ior=1.5,this.transmission=0,this.atDistance=1,this.extinction=new t.Color(16777215),this.anisotropic=0,this.specularColor=new t.Color(16777215),this.glossiness=1,this.specularMap=null,this.glossinessMap=null,this.setValues(e)}}function g(e,a){let n=[],i=[];e.traverse(e=>{e.isMesh&&(e.geometry?e.material?(e.material.isMeshStandardMaterial?e.material=(new _).fromStandardMaterial(e.material):e.material.isRayTracingMaterial||(e.material=(new _).fromBasicMaterial(e.material)),n.push(e)):console.warn(e,"must have a material property."):console.warn(e,"must have a geometry property")),e.isLight&&i.push(e)});let r={data:e.environment,intensity:e.envMapIntensity||1},o=r.data&&r.data.isTexture,l=i.length||0,s=null;l&&(s=function(e){let t={};return t.position=e.map(e=>e.position),t.emission=e.map(e=>e.emission),t.p1=e.map(e=>e.p1),t.p2=e.map(e=>e.p2),t.radius=e.map(e=>e.radius),t.area=e.map(e=>e.area),t.type=e.map(e=>e.type),t.visible=e.map(e=>e.visible),t.position=[].concat(...t.position.map(e=>e.toArray())),t.emission=[].concat(...t.emission.map(e=>e.toArray())),t.p1=[].concat(...t.p1.map(e=>e.toArray())),t.p2=[].concat(...t.p2.map(e=>e.toArray())),t.params=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let n=0;for(let e=0;e<t.length;e++){let a=t[e],i=a.data?a.data.length/a.channels:0;n=Math.max(n,i)}let i=[];for(let e=0;e<n;e++)for(let a=0;a<t.length;a++){let{data:n=[],channels:r}=t[a];for(let t=0;t<r;t++)i.push(n[e*r+t])}return i}({data:t.radius,channels:1},{data:t.area,channels:1},{data:t.type,channels:1},{data:t.visible,channels:1}),t}(i.map(e=>{let a={},n=new t.Vector3;switch(e.getWorldPosition(n),a.position=n,a.emission=e.color.multiplyScalar(e.intensity),a.radius=e.radius||0,a.area=0,a.visible=Number(e.visible),a.p1=new t.Vector3,a.p2=new t.Vector3,e.type){case"RectAreaLight":if(a.type=0,e.width&&e.height){let n=new t.PlaneGeometry(e.width,e.height),i=new t.Vector3;e.target&&i.copy(e.target);let r=(new t.Vector3).subVectors(e.position,i),o=(new t.Vector3).copy(r).negate();n.lookAt(o);let l=n.attributes.position.array,s=new t.Vector3(l[0],l[1],l[2]).add(e.position);new t.Vector3(l[3],l[4],l[5]).add(e.position);let d=new t.Vector3(l[6],l[7],l[8]).add(e.position),u=new t.Vector3(l[9],l[10],l[11]).add(e.position);a.position.copy(d),a.p1=u.sub(d),a.p2=s.sub(d),a.area=(new t.Vector3).crossVectors(a.p1,a.p2).length()}break;case"QuadLight":a.type=1,a.p1=e.v1.sub(e.position),a.p2=e.v2.sub(e.position),a.area=(new t.Vector3).crossVectors(a.p1,a.p2).length();break;case"SphereAreaLight":a.type=2,a.area=4*Math.PI*e.radius*e.radius;break;case"PointLight":a.type=4,a.area=0;break;case"DirectionalLight":a.type=3,e.target&&a.p1.copy(e.target),a.area=0;break;default:console.warn("Not support light type: ".concat(e.type))}return a})));let d=new Map;for(let e of n){if(!e.visible)continue;let t=e.material,a=d.get(t);void 0===a&&(a=d.size,d.set(t,a))}return{environment:r,isTextureEnv:o,camera:a,meshes:n,meshLights:s,meshLightsNum:l,materialIndexMap:d,materials:Array.from(d.keys())}}function S(e,t,a,n,i,r,o){let l=Math.min(o.length/r,a);for(let a=0;a<l;a++)for(let l=0;l<r;l++)e[t](n+a*i+4*l,o[r*a+l],!0)}function M(e,t){let a={textures:[],indices:{}};for(let n of t)a.indices[n]=F(e,n,a.textures);return a}function F(e,t,a){let n=[];for(let i of e)if(i[t]&&i[t].image){let e=a.length;for(let n=0;n<a.length;n++)if(a[n]===i[t]){e=n;break}e===a.length&&a.push(i[t]),n.push(e)}else n.push(-1);return n}function T(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let n=0;for(let e=0;e<t.length;e++){let a=t[e],i=a.data?a.data.length/a.channels:0;n=Math.max(n,i)}let i=[];for(let e=0;e<n;e++)for(let a=0;a<t.length;a++){let{data:n=[],channels:r}=t[a];for(let t=0;t<r;t++)i.push(n[e*r+t])}return i}function I(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,i=t.map(e=>e.image),r=t.map(e=>e.flipY),{maxSize:o,relativeSizes:l}=function(e){let t={width:0,height:0};for(let a of e)t.width=Math.max(t.width,a.width),t.height=Math.max(t.height,a.height);let a=[];for(let n of e)a.push(n.width/t.width),a.push(n.height/t.height);return{maxSize:t,relativeSizes:a}}(i);return{texture:v(e,{width:o.width,height:o.height,gammaCorrection:a,data:i,flipY:r,channels:n,minFilter:e.LINEAR,magFilter:e.LINEAR}),relativeSizes:l}}function G(e,t){let a=function(e,t){let a={};for(let n of t){let t=[];a[n]={indices:F(e,n,t),textures:t}}return a}(t,["map","normalMap","emissiveMap"]),n=M(t,["roughnessMap","metalnessMap"]),i=M(t,["specularMap","glossinessMap"]),r={},o={};if(o.color=t.map(e=>e.color),o.roughness=t.map(e=>e.roughness),o.metalness=t.map(e=>e.metalness),o.normalScale=t.map(e=>e.normalScale),o.specularTint=t.map(e=>e.specularTint),o.sheen=t.map(e=>e.sheen),o.sheenTint=t.map(e=>e.sheenTint),o.clearcoat=t.map(e=>e.clearcoat),o.clearcoatRoughness=t.map(e=>e.clearcoatRoughness),o.transmission=t.map(e=>e.transmission),o.subsurface=t.map(e=>e.subsurface),o.ior=t.map(e=>e.ior),o.atDistance=t.map(e=>e.atDistance),o.extinction=t.map(e=>e.extinction),o.alpha=t.map(e=>e.alpha),o.workflow=t.map(e=>"Metalness"===e.workflow?0:1),o.specularColor=t.map(e=>e.specularColor),o.glossiness=t.map(e=>e.glossiness),o.type=t.map(e=>0),a.map.textures.length>0){let{relativeSizes:t,texture:n}=I(e,a.map.textures,!0,4);r.diffuseMap=n,o.diffuseMapSize=t,o.diffuseMapIndex=a.map.indices}if(a.normalMap.textures.length>0){let{relativeSizes:t,texture:n}=I(e,a.normalMap.textures,!1);r.normalMap=n,o.normalMapSize=t,o.normalMapIndex=a.normalMap.indices}if(n.textures.length>0){let{relativeSizes:t,texture:a}=I(e,n.textures,!1);r.pbrMap=a,o.pbrMapSize=t,o.roughnessMapIndex=n.indices.roughnessMap,o.metalnessMapIndex=n.indices.metalnessMap}if(i.textures.length>0){let{relativeSizes:t,texture:a}=I(e,i.textures,!1,4);r.pbrSGMap=a,o.pbrMapSize=t,o.specularMapIndex=i.indices.specularMap,o.glossinessMapIndex=i.indices.glossinessMap}if(a.emissiveMap.textures.length>0){let{relativeSizes:t,texture:n}=I(e,a.emissiveMap.textures,!0);r.emissiveMap=n,o.pbrMapSize||(o.pbrMapSize=t),o.emissiveMapIndex=a.emissiveMap.indices}let l={NUM_MATERIALS:t.length,NUM_DIFFUSE_MAPS:a.map.textures.length,NUM_NORMAL_MAPS:a.normalMap.textures.length,NUM_DIFFUSE_NORMAL_MAPS:Math.max(a.map.textures.length,a.normalMap.textures.length),NUM_PBR_MAPS:n.textures.length,NUM_PBR_SG_MAPS:i.textures.length,NUM_EMISSIVE_MAPS:a.emissiveMap.textures.length},s=x(e,{vertex:{source:"void main() {}"},fragment:{includes:["uniform Materials {\r\n	vec4 colorAndMaterialType[NUM_MATERIALS];\r\n	vec4 roughnessMetalnessNormalScale[NUM_MATERIALS];\r\n	vec4 alphaSpecularTintSheenSheenTint[NUM_MATERIALS];\r\n	vec4 clearcoaRoughnessSubfaceTransmission[NUM_MATERIALS];\r\n	vec4 iorAtDistanceAnisotropicWorkflow[NUM_MATERIALS];\r\n	vec4 extinction[NUM_MATERIALS];\r\n	vec4 specularColorGlossiness[NUM_MATERIALS];\r\n\r\n	#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS) || defined(NUM_PBR_MAPS)\r\n		ivec4 diffuseNormalRoughnessMetalnessMapIndex[NUM_MATERIALS];\r\n	#endif\r\n\r\n	#if defined(NUM_EMISSIVE_MAPS) || defined(NUM_PBR_SG_MAPS)\r\n		ivec4 emissiveSpecularGlossinessMapIndex[NUM_MATERIALS];\r\n	#endif\r\n\r\n	#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS)\r\n		vec4 diffuseNormalMapSize[NUM_DIFFUSE_NORMAL_MAPS];\r\n	#endif\r\n\r\n	#if defined(NUM_PBR_MAPS)\r\n		vec2 pbrMapSize[NUM_PBR_MAPS];\r\n	#else\r\n		#if defined(NUM_PBR_SG_MAPS)\r\n			vec2 pbrMapSize[NUM_PBR_SG_MAPS];\r\n		#else\r\n			#if defined(NUM_EMISSIVE_MAPS)\r\n				vec2 pbrMapSize[NUM_EMISSIVE_MAPS];\r\n			#endif\r\n		#endif\r\n	#endif\r\n} materials;\r\n\r\n#ifdef NUM_DIFFUSE_MAPS\r\n	uniform mediump sampler2DArray diffuseMap;\r\n#endif\r\n\r\n#ifdef NUM_NORMAL_MAPS\r\n	uniform mediump sampler2DArray normalMap;\r\n#endif\r\n\r\n#ifdef NUM_PBR_MAPS\r\n	uniform mediump sampler2DArray pbrMap;\r\n#endif\r\n\r\n#ifdef NUM_PBR_SG_MAPS\r\n	uniform mediump sampler2DArray pbrSGMap;\r\n#endif\r\n\r\n#ifdef NUM_EMISSIVE_MAPS\r\n	uniform mediump sampler2DArray emissiveMap;\r\n#endif\r\n\r\nfloat getMatType(int materialIndex) {\r\n	return materials.colorAndMaterialType[materialIndex].w;\r\n}\r\n\r\nfloat getMatWorkflow(int materialIndex) {\r\n	return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].w;\r\n}\r\n\r\nvec3 getMatEmissive(int materialIndex, vec2 uv) {\r\n	vec3 emissive = vec3(0.0);\r\n\r\n	#ifdef NUM_EMISSIVE_MAPS\r\n		int emissiveMapIndex = materials.emissiveSpecularGlossinessMapIndex[materialIndex].x;\r\n		if (emissiveMapIndex >= 0) {\r\n			emissive = texture(emissiveMap, vec3(uv * materials.pbrMapSize[emissiveMapIndex].xy, emissiveMapIndex)).rgb;\r\n		}\r\n	#endif\r\n	\r\n	return emissive;\r\n}\r\n\r\nvec3 getMatSpecularColor(int materialIndex, vec2 uv) {\r\n	vec3 specularColor = materials.specularColorGlossiness[materialIndex].rgb;\r\n\r\n	#ifdef NUM_PBR_SG_MAPS\r\n		int specularMapIndex = materials.emissiveSpecularGlossinessMapIndex[materialIndex].y;\r\n		if (specularMapIndex >= 0) {\r\n			vec3 texelSpecular = texture(pbrSGMap, vec3(uv * materials.pbrMapSize[specularMapIndex].xy, specularMapIndex)).rgb;\r\n			texelSpecular = pow(texelSpecular, vec3(2.2));\r\n			specularColor *= texelSpecular;\r\n		}\r\n	#endif\r\n\r\n	return specularColor;\r\n}\r\n\r\nfloat getMatGlossiness(int materialIndex, vec2 uv) {\r\n	float glossiness = materials.specularColorGlossiness[materialIndex].a;\r\n	#ifdef NUM_PBR_SG_MAPS\r\n		int glossinessMapIndex = materials.emissiveSpecularGlossinessMapIndex[materialIndex].z;\r\n		if (glossinessMapIndex >= 0) {\r\n			float texelGlossiness = texture(pbrSGMap, vec3(uv * materials.pbrMapSize[glossinessMapIndex].xy, glossinessMapIndex)).a;\r\n			glossiness *= texelGlossiness;\r\n		}\r\n	#endif\r\n	return glossiness;\r\n}\r\n\r\nfloat getMatRoughness(int materialIndex, vec2 uv) {\r\n	float workflow = getMatWorkflow(materialIndex);\r\n	float roughness = 0.0;\r\n	if (workflow > 0.1) {\r\n		roughness = 1.0 - getMatGlossiness(materialIndex, uv);\r\n	} else {\r\n		roughness = materials.roughnessMetalnessNormalScale[materialIndex].x;\r\n\r\n		#ifdef NUM_PBR_MAPS\r\n			int roughnessMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].z;\r\n			if (roughnessMapIndex >= 0) {\r\n				roughness *= texture(pbrMap, vec3(uv * materials.pbrMapSize[roughnessMapIndex].xy, roughnessMapIndex)).g;\r\n			}\r\n		#endif\r\n	}\r\n	// Remap\r\n	return roughness * roughness;\r\n}\r\n\r\nfloat max3(const vec3 v) {\r\n	return max(v.x, max(v.y, v.z));\r\n}\r\n\r\nfloat computeMetallicFromSpecularColor(const vec3 specularColor) {\r\n	return max3(specularColor);\r\n}\r\n\r\nvec3 computeDiffuseColor(const vec3 baseColor, float metallic) {\r\n	return baseColor * (1.0 - metallic);\r\n}\r\n\r\nfloat getMatMetalness(int materialIndex, vec2 uv) {\r\n	float workflow = getMatWorkflow(materialIndex);\r\n	float metalness = 0.0;\r\n	if (workflow > 0.1) {\r\n		vec3 specularFactor = getMatSpecularColor(materialIndex, uv);\r\n		metalness = computeMetallicFromSpecularColor(specularFactor);\r\n	} else {\r\n		metalness = materials.roughnessMetalnessNormalScale[materialIndex].y;\r\n\r\n		#ifdef NUM_PBR_MAPS\r\n			int metalnessMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].w;\r\n			if (metalnessMapIndex >= 0) {\r\n				metalness *= texture(pbrMap, vec3(uv * materials.pbrMapSize[metalnessMapIndex].xy, metalnessMapIndex)).b;\r\n			}\r\n		#endif\r\n	}\r\n\r\n	return metalness;\r\n}\r\n\r\nvec3 getMatColor(int materialIndex, vec2 uv) {\r\n	// if (enableAlbedo && bounce == 0) return vec3(1.);\r\n	vec3 color = materials.colorAndMaterialType[materialIndex].rgb;\r\n	#ifdef NUM_DIFFUSE_MAPS\r\n		int diffuseMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;\r\n		if (diffuseMapIndex >= 0) {\r\n			color *= texture(diffuseMap, vec3(uv * materials.diffuseNormalMapSize[diffuseMapIndex].xy, diffuseMapIndex)).rgb;\r\n		}\r\n	#endif\r\n\r\n	float workflow = getMatWorkflow(materialIndex);\r\n	if (workflow > 0.1) {\r\n		vec3 specularFactor = getMatSpecularColor(materialIndex, uv);\r\n		color = computeDiffuseColor(color, computeMetallicFromSpecularColor(specularFactor));\r\n	}\r\n\r\n	return color;\r\n}\r\n\r\nvec3 getMatNormal(int materialIndex, vec2 uv, vec3 normal, vec3 dp1, vec3 dp2, vec2 duv1, vec2 duv2, inout vec3 tangent, inout vec3 bitangent) {\r\n	// http://www.thetenthplanet.de/archives/1180\r\n	// Compute co-tangent and co-bitangent vectors\r\n	vec3 dp2perp = cross(dp2, normal);\r\n	vec3 dp1perp = cross(normal, dp1);\r\n	vec3 dpdu = dp2perp * duv1.x + dp1perp * duv2.x;\r\n	vec3 dpdv = dp2perp * duv1.y + dp1perp * duv2.y;\r\n	float invmax = inversesqrt(max(dot(dpdu, dpdu), dot(dpdv, dpdv)));\r\n	dpdu *= invmax;\r\n	dpdv *= invmax;\r\n\r\n	// All world space\r\n	// /3ed-2018/Materials/BSDFs => WorldToLocal/LocalToWorld\r\n	tangent = normalize(dpdu);\r\n	bitangent = normalize(dpdv);\r\n\r\n#ifdef NUM_NORMAL_MAPS\r\n	int normalMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].y;\r\n	if (normalMapIndex >= 0) {\r\n		vec3 n = 2.0 * texture(normalMap, vec3(uv * materials.diffuseNormalMapSize[normalMapIndex].zw, normalMapIndex)).rgb - 1.0;\r\n		n.xy *= materials.roughnessMetalnessNormalScale[materialIndex].zw;\r\n\r\n		mat3 tbn = mat3(dpdu, dpdv, normal);\r\n\r\n		return normalize(tbn * n);\r\n	} else {\r\n		return normal;\r\n	}\r\n#endif\r\n\r\n	return normal;\r\n}\r\n\r\n// alphaSpecularTintSheenSheenTint\r\nfloat getMatAlpha(int materialIndex, vec2 uv) {\r\n	float alpha =  materials.alphaSpecularTintSheenSheenTint[materialIndex].x;\r\n	#ifdef NUM_DIFFUSE_MAPS\r\n		int diffuseMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;\r\n		if (diffuseMapIndex >= 0) {\r\n			alpha *= texture(diffuseMap, vec3(uv * materials.diffuseNormalMapSize[diffuseMapIndex].xy, diffuseMapIndex)).a;\r\n		}\r\n	#endif\r\n	return alpha;\r\n}\r\n\r\nfloat getMatSpecularTint(int materialIndex) {\r\n	return materials.alphaSpecularTintSheenSheenTint[materialIndex].y;\r\n}\r\n\r\nfloat getMatSheen(int materialIndex) {\r\n	return materials.alphaSpecularTintSheenSheenTint[materialIndex].z;\r\n}\r\n\r\nfloat getMatSheenTint(int materialIndex) {\r\n	return materials.alphaSpecularTintSheenSheenTint[materialIndex].w;\r\n}\r\n\r\n// clearcoaRoughnessSubfaceTransmission\r\nfloat getMatClearcoat(int materialIndex) {\r\n	return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].x;\r\n}\r\n\r\nfloat getMatClearcoatRoughness(int materialIndex) {\r\n	return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].y;\r\n}\r\n\r\nfloat getMatSubface(int materialIndex) {\r\n	return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].z;\r\n}\r\n\r\nfloat getMatTransmission(int materialIndex) {\r\n	return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].w;\r\n}\r\n\r\n// iorAtDistanceAnisotropicWorkflow\r\nfloat getMatIOR(int materialIndex) {\r\n	return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].x;\r\n}\r\n\r\nfloat getMatAtDistance(int materialIndex) {\r\n	return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].y;\r\n}\r\n\r\nfloat getMatAnisotropic(int materialIndex) {\r\n	return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].z;\r\n}\r\n\r\nvec3 getMatExtinction(int materialIndex) {\r\n	return materials.extinction[materialIndex].rgb;\r\n}"],source:"void main() {}"},defines:l}),d=function(e,t,a){let n=function(e,t,a){let n=e.getUniformBlockIndex(t,a),i=e.getActiveUniformBlockParameter(t,n,e.UNIFORM_BLOCK_DATA_SIZE),r=function(e,t,a){let n=e.getActiveUniformBlockParameter(t,a,e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),i=e.getActiveUniforms(t,n,e.UNIFORM_OFFSET),r=e.getActiveUniforms(t,n,e.UNIFORM_ARRAY_STRIDE),o={};for(let a=0;a<n.length;a++){let{name:l,type:s,size:d}=e.getActiveUniform(t,n[a]);o[l]={type:s,size:d,offset:i[a],stride:r[a]}}return o}(e,t,n),o=e.createBuffer();e.bindBuffer(e.UNIFORM_BUFFER,o),e.bufferData(e.UNIFORM_BUFFER,i,e.STATIC_DRAW);let l=new DataView(new ArrayBuffer(i));return{set:function(t,a){if(!r[t])return;let{type:n,size:i,offset:o,stride:s}=r[t];switch(n){case e.FLOAT:S(l,"setFloat32",i,o,s,1,a);break;case e.FLOAT_VEC2:S(l,"setFloat32",i,o,s,2,a);break;case e.FLOAT_VEC3:S(l,"setFloat32",i,o,s,3,a);break;case e.FLOAT_VEC4:S(l,"setFloat32",i,o,s,4,a);break;case e.INT:S(l,"setInt32",i,o,s,1,a);break;case e.INT_VEC2:S(l,"setInt32",i,o,s,2,a);break;case e.INT_VEC3:S(l,"setInt32",i,o,s,3,a);break;case e.INT_VEC4:S(l,"setInt32",i,o,s,4,a);break;case e.BOOL:S(l,"setUint32",i,o,s,1,a);break;default:console.warn("UniformBuffer: Unsupported type")}},bind:function(t){e.bindBuffer(e.UNIFORM_BUFFER,o),e.bufferSubData(e.UNIFORM_BUFFER,0,l),e.bindBufferBase(e.UNIFORM_BUFFER,t,o)},dispose:function(){e.deleteBuffer(o)}}}(e,t,"Materials");return n.set("Materials.colorAndMaterialType[0]",T({data:[].concat(...a.color.map(e=>e.toArray())),channels:3},{data:a.type,channels:1})),n.set("Materials.roughnessMetalnessNormalScale[0]",T({data:a.roughness,channels:1},{data:a.metalness,channels:1},{data:[].concat(...a.normalScale.map(e=>e.toArray())),channels:2})),n.set("Materials.alphaSpecularTintSheenSheenTint[0]",T({data:a.alpha,channels:1},{data:a.specularTint,channels:1},{data:a.sheen,channels:1},{data:a.sheenTint,channels:1})),n.set("Materials.clearcoaRoughnessSubfaceTransmission[0]",T({data:a.clearcoat,channels:1},{data:a.clearcoatRoughness,channels:1},{data:a.subsurface,channels:1},{data:a.transmission,channels:1})),n.set("Materials.iorAtDistanceAnisotropicWorkflow[0]",T({data:a.ior,channels:1},{data:a.atDistance,channels:1},{data:a.anisotropic,channels:1},{data:a.workflow,channels:1})),n.set("Materials.specularColorGlossiness[0]",T({data:[].concat(...a.specularColor.map(e=>e.toArray())),channels:3},{data:a.glossiness,channels:1})),n.set("Materials.extinction[0]",T({data:[].concat(...a.extinction.map(e=>e.toArray())),channels:3},{data:a.anisotropic,channels:1})),n.set("Materials.diffuseNormalRoughnessMetalnessMapIndex[0]",T({data:a.diffuseMapIndex,channels:1},{data:a.normalMapIndex,channels:1},{data:a.roughnessMapIndex,channels:1},{data:a.metalnessMapIndex,channels:1})),n.set("Materials.emissiveSpecularGlossinessMapIndex[0]",T({data:a.emissiveMapIndex,channels:1},{data:a.specularMapIndex,channels:1},{data:a.glossinessMapIndex,channels:1},{data:a.emissiveMapIndex,channels:1})),n.set("Materials.diffuseNormalMapSize[0]",T({data:a.diffuseMapSize,channels:2},{data:a.normalMapSize,channels:2})),n.set("Materials.pbrMapSize[0]",a.pbrMapSize),n.bind(0),n}(e,s.program,o);return{defines:l,textures:r,dispose:function(){s.dispose(),d.dispose()}}}class b{length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}normalize(){return this.divideScalar(this.length()||1)}crossVectors(e,t){let a=e.x,n=e.y,i=e.z,r=t.x,o=t.y,l=t.z;return this.x=n*l-i*o,this.y=i*r-a*l,this.z=a*o-n*r,this}fromBufferAttribute(e,t,a){return void 0!==a&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}constructor(e=0,t=0,a=0){this.x=e,this.y=t,this.z=a}}class y{isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}constructor(e=new b(1/0,1/0,1/0),t=new b(-1/0,-1/0,-1/0)){this.min=e,this.max=t}}function N(e,t,a){let n=e[a];e[a]=e[t],e[t]=n}let P=0,R=0,E=null,U=!1,X=new b;function B(e,t){return{primitives:e,bounds:t}}function C(e,t,a){let n=a[t]-e.min[t];return e.max[t]>e.min[t]&&(n/=e.max[t]-e.min[t]),n}function z(e){return e.getSize(X),2*(X.x*X.z+X.x*X.y+X.z*X.y)}function V(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length,i=a,r=a+n-1;for(;i<r;){let a=i+r>>1;e[a]<t?i=a+1:r=a}return i-a}var w={source:e=>"\n#define PI 3.14159265359\n#define TWOPI 6.28318530718\n#define INVPI 0.31830988618\n#define INVPI2 0.10132118364\n#define EPS 0.0001\n#define ONE_MINUS_EPS 0.999999\n#define INF 1000000.0\n#define ROUGHNESS_MIN 0.001\n#define DISNEY 0\nconst vec3 LGL_Ag=vec3(0.2126,0.7152,0.0722);float LGL_Af(vec3 color){return dot(color,LGL_Ag);}\n#define RAY_MAX_DISTANCE 9999.0\nstruct Ray{vec3 o;vec3 d;vec3 LGL_BZ;float LGL_Ba;};struct Path{Ray ray;vec3 li;float alpha;vec3 beta;bool LGL_Bc;float LGL_Bd;vec3 LGL_Be;};struct Camera{mat4 transform;float aspect;float fov;float focus;float aperture;};\n#if defined(NUM_LIGHTS)\nstruct Lights{vec3 position[NUM_LIGHTS];vec3 emission[NUM_LIGHTS];vec3 p1[NUM_LIGHTS];vec3 p2[NUM_LIGHTS];vec4 params[NUM_LIGHTS];};struct Light{vec3 position;vec3 emission;vec3 p1;vec3 p2;float radius;float area;float type;float LGL_s;};\n#endif\nstruct SurfaceInteraction{bool LGL_BW;bool LGL_BU;float t;vec3 position;vec3 normal;vec3 LGL_BY;vec3 LGL_BX;vec3 tangent;vec3 bitangent;vec3 color;vec3 extinction;vec3 emissive;int LGL_BT;float roughness;float metalness;float LGL_BR;float LGL_BN;float LGL_BK;float sheen;float LGL_BL;float clearcoat;float LGL_BM;float LGL_BO;float ior;float LGL_BQ;float eta;float LGL_BP;vec3 specularColor;float LGL_BS;};struct BsdfSampleRec{vec3 L;vec3 f;float pdf;};struct LightSampleRec{vec3 normal;vec3 emission;vec3 direction;float dist;float pdf;};void LGL_Ah(inout Ray ray,vec3 origin,vec3 direction){ray.o=origin;ray.d=direction;ray.LGL_BZ=1.0/ray.d;ray.LGL_Ba=RAY_MAX_DISTANCE;}void LGL_Ah(inout Ray ray,vec3 origin,vec3 direction,float rMax){ray.o=origin;ray.d=direction;ray.LGL_BZ=1.0/ray.d;ray.LGL_Ba=rMax;}ivec2 LGL_Ai(int i,int LGL_Bf){ivec2 u;u.y=i>>LGL_Bf;u.x=i-(u.y<<LGL_Bf);return u;}vec4 LGL_Aj(sampler2D s,int i,int LGL_Bf){return texelFetch(s,LGL_Ai(i,LGL_Bf),0);}ivec4 LGL_Aj(isampler2D s,int i,int LGL_Bf){return texelFetch(s,LGL_Ai(i,LGL_Bf),0);}uniform Camera camera;uniform vec2 pixelSize;uniform vec2 jitter;uniform float frameCount;in vec2 vCoord;\n#if defined(NUM_LIGHTS)\nuniform Lights lights;\n#endif\nuniform int bounces;uniform vec3 backgroundColor;uniform float envMapIntensity;uniform float enviromentVisible;uniform int useBackgroundColor;uniform mat3 envRotMatrix;uniform mat3 invEnvRotMatrix;uniform sampler2D noiseTex;uniform float stratifiedSamples[71];uniform float strataSize;float pixelSeed;float LGL_AX(vec2 p){return fract(sin(dot(p,vec2(12.9898,78.233)))*43758.5453);}uvec4 seed;ivec2 pixel;void LGL_AY(float frame){pixel=ivec2(vCoord/pixelSize);seed=uvec4(pixel,int(frame),pixel.x+pixel.y);}void LGL_AZ(inout uvec4 v){v=v*1664525u+1013904223u;v.x+=v.y*v.w;v.y+=v.z*v.x;v.z+=v.x*v.y;v.w+=v.y*v.z;v=v ^(v>>16u);v.x+=v.y*v.w;v.y+=v.z*v.x;v.z+=v.x*v.y;v.w+=v.y*v.z;}float LGL_Aa(){LGL_AZ(seed);return float(seed.x)/float(0xffffffffu);}vec2 LGL_Aa2(){LGL_AZ(seed);return vec2(seed.xy)/float(0xffffffffu);}void LGL_Ac(float frame){vec2 noiseSize=vec2(textureSize(noiseTex,0));pixelSeed=texture(noiseTex,vCoord/(pixelSize*noiseSize)).r;LGL_AY(frame);}int sampleIndex=0;float LGL_AaomSample(){float stratifiedSample=stratifiedSamples[sampleIndex++];float LGL_Aaom=fract((stratifiedSample+pixelSeed)*strataSize);return EPS+(1.0-2.0*EPS)*LGL_Aaom;}vec2 LGL_AaomSampleVec2(){return vec2(LGL_AaomSample(),LGL_AaomSample());}struct MaterialSamples{vec2 s1;vec2 s2;vec2 s3;vec2 s4;};MaterialSamples getRandomMaterialSamples(){MaterialSamples samples;samples.s1=LGL_AaomSampleVec2();samples.s2=LGL_AaomSampleVec2();samples.s3=LGL_AaomSampleVec2();samples.s4=LGL_AaomSampleVec2();return samples;}vec4 LGL_Az(sampler2D map,vec2 uv){\n#ifdef OES_texture_float_linear\nreturn texture(map,uv);\n#else\nvec2 size=vec2(textureSize(map,0));vec2 texelSize=1.0/size;uv=uv*size-0.5;vec2 f=fract(uv);uv=floor(uv)+0.5;vec4 s1=texture(map,(uv+vec2(0,0))*texelSize);vec4 s2=texture(map,(uv+vec2(1,0))*texelSize);vec4 s3=texture(map,(uv+vec2(0,1))*texelSize);vec4 s4=texture(map,(uv+vec2(1,1))*texelSize);return mix(mix(s1,s2,f.x),mix(s3,s4,f.x),f.y);\n#endif\n}uniform Materials{vec4 colorAndMaterialType[NUM_MATERIALS];vec4 roughnessMetalnessNormalScale[NUM_MATERIALS];vec4 alphaSpecularTintSheenSheenTint[NUM_MATERIALS];vec4 clearcoaRoughnessSubfaceTransmission[NUM_MATERIALS];vec4 iorAtDistanceAnisotropicWorkflow[NUM_MATERIALS];vec4 extinction[NUM_MATERIALS];vec4 specularColorGlossiness[NUM_MATERIALS];\n#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS) || defined(NUM_PBR_MAPS)\nivec4 diffuseNormalRoughnessMetalnessMapIndex[NUM_MATERIALS];\n#endif\n#if defined(NUM_EMISSIVE_MAPS) || defined(NUM_PBR_SG_MAPS)\nivec4 emissiveSpecularGlossinessMapIndex[NUM_MATERIALS];\n#endif\n#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS)\nvec4 diffuseNormalMapSize[NUM_DIFFUSE_NORMAL_MAPS];\n#endif\n#if defined(NUM_PBR_MAPS)\nvec2 pbrMapSize[NUM_PBR_MAPS];\n#else\n#if defined(NUM_PBR_SG_MAPS)\nvec2 pbrMapSize[NUM_PBR_SG_MAPS];\n#else\n#if defined(NUM_EMISSIVE_MAPS)\nvec2 pbrMapSize[NUM_EMISSIVE_MAPS];\n#endif\n#endif\n#endif\n}materials;\n#ifdef NUM_DIFFUSE_MAPS\nuniform mediump sampler2DArray diffuseMap;\n#endif\n#ifdef NUM_NORMAL_MAPS\nuniform mediump sampler2DArray normalMap;\n#endif\n#ifdef NUM_PBR_MAPS\nuniform mediump sampler2DArray pbrMap;\n#endif\n#ifdef NUM_PBR_SG_MAPS\nuniform mediump sampler2DArray pbrSGMap;\n#endif\n#ifdef NUM_EMISSIVE_MAPS\nuniform mediump sampler2DArray emissiveMap;\n#endif\nfloat LGL_w(int materialIndex){return materials.colorAndMaterialType[materialIndex].w;}float LGL_x(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].w;}vec3 LGL_y(int materialIndex,vec2 uv){vec3 emissive=vec3(0.0);\n#ifdef NUM_EMISSIVE_MAPS\nint emissiveMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].x;if(emissiveMapIndex>=0){emissive=texture(emissiveMap,vec3(uv*materials.pbrMapSize[emissiveMapIndex].xy,emissiveMapIndex)).rgb;}\n#endif\nreturn emissive;}vec3 LGL_z(int materialIndex,vec2 uv){vec3 specularColor=materials.specularColorGlossiness[materialIndex].rgb;\n#ifdef NUM_PBR_SG_MAPS\nint specularMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].y;if(specularMapIndex>=0){vec3 LGL_AV=texture(pbrSGMap,vec3(uv*materials.pbrMapSize[specularMapIndex].xy,specularMapIndex)).rgb;LGL_AV=pow(LGL_AV,vec3(2.2));specularColor*=LGL_AV;}\n#endif\nreturn specularColor;}float LGL_AA(int materialIndex,vec2 uv){float glossiness=materials.specularColorGlossiness[materialIndex].a;\n#ifdef NUM_PBR_SG_MAPS\nint glossinessMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].z;if(glossinessMapIndex>=0){float LGL_AW=texture(pbrSGMap,vec3(uv*materials.pbrMapSize[glossinessMapIndex].xy,glossinessMapIndex)).a;glossiness*=LGL_AW;}\n#endif\nreturn glossiness;}float LGL_AB(int materialIndex,vec2 uv){float LGL_BS=LGL_x(materialIndex);float roughness=0.0;if(LGL_BS>0.1){roughness=1.0-LGL_AA(materialIndex,uv);}else{roughness=materials.roughnessMetalnessNormalScale[materialIndex].x;\n#ifdef NUM_PBR_MAPS\nint roughnessMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].z;if(roughnessMapIndex>=0){roughness*=texture(pbrMap,vec3(uv*materials.pbrMapSize[roughnessMapIndex].xy,roughnessMapIndex)).g;}\n#endif\n}return roughness*roughness;}float LGL_AC(const vec3 v){return max(v.x,max(v.y,v.z));}float LGL_AD(const vec3 specularColor){return LGL_AC(specularColor);}vec3 LGL_AE(const vec3 baseColor,float metallic){return baseColor*(1.0-metallic);}float LGL_AF(int materialIndex,vec2 uv){float LGL_BS=LGL_x(materialIndex);float metalness=0.0;if(LGL_BS>0.1){vec3 specularFactor=LGL_z(materialIndex,uv);metalness=LGL_AD(specularFactor);}else{metalness=materials.roughnessMetalnessNormalScale[materialIndex].y;\n#ifdef NUM_PBR_MAPS\nint metalnessMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].w;if(metalnessMapIndex>=0){metalness*=texture(pbrMap,vec3(uv*materials.pbrMapSize[metalnessMapIndex].xy,metalnessMapIndex)).b;}\n#endif\n}return metalness;}vec3 LGL_AG(int materialIndex,vec2 uv){vec3 color=materials.colorAndMaterialType[materialIndex].rgb;\n#ifdef NUM_DIFFUSE_MAPS\nint diffuseMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;if(diffuseMapIndex>=0){color*=texture(diffuseMap,vec3(uv*materials.diffuseNormalMapSize[diffuseMapIndex].xy,diffuseMapIndex)).rgb;}\n#endif\nfloat LGL_BS=LGL_x(materialIndex);if(LGL_BS>0.1){vec3 specularFactor=LGL_z(materialIndex,uv);color=LGL_AE(color,LGL_AD(specularFactor));}return color;}vec3 LGL_AI(int materialIndex,vec2 uv,vec3 normal,vec3 dp1,vec3 dp2,vec2 duv1,vec2 duv2,inout vec3 tangent,inout vec3 bitangent){vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 dpdu=dp2perp*duv1.x+dp1perp*duv2.x;vec3 dpdv=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(dpdu,dpdu),dot(dpdv,dpdv)));dpdu*=invmax;dpdv*=invmax;tangent=normalize(dpdu);bitangent=normalize(dpdv);\n#ifdef NUM_NORMAL_MAPS\nint normalMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].y;if(normalMapIndex>=0){vec3 n=2.0*texture(normalMap,vec3(uv*materials.diffuseNormalMapSize[normalMapIndex].zw,normalMapIndex)).rgb-1.0;n.xy*=materials.roughnessMetalnessNormalScale[materialIndex].zw;mat3 tbn=mat3(dpdu,dpdv,normal);return normalize(tbn*n);}else{return normal;}\n#endif\nreturn normal;}float LGL_AL(int materialIndex,vec2 uv){float alpha=materials.alphaSpecularTintSheenSheenTint[materialIndex].x;\n#ifdef NUM_DIFFUSE_MAPS\nint diffuseMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;if(diffuseMapIndex>=0){alpha*=texture(diffuseMap,vec3(uv*materials.diffuseNormalMapSize[diffuseMapIndex].xy,diffuseMapIndex)).a;}\n#endif\nreturn alpha;}float LGL_AJ(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].y;}float LGL_AK(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].z;}float LGL_AKTint(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].w;}float LGL_AN(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].x;}float LGL_ANRoughness(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].y;}float LGL_AP(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].z;}float LGL_AQ(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].w;}float LGL_AR(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].x;}float LGL_AS(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].y;}float LGL_AT(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].z;}vec3 LGL_AU(int materialIndex){return materials.extinction[materialIndex].rgb;}uniform sampler2D positionBuffer;uniform sampler2D normalBuffer;uniform sampler2D uvBuffer;uniform sampler2D bvhBuffer;struct Triangle{vec3 p0;vec3 p1;vec3 p2;};struct Box{vec3 min;vec3 max;};struct TriangleIntersect{float t;vec3 barycentric;};float LGL_f(float rad,vec3 pos,Ray r){vec3 op=pos-r.o;float eps=0.001;float b=dot(op,r.d);float det=b*b-dot(op,op)+rad*rad;if(det<0.0)return INF;det=sqrt(det);float t1=b-det;if(t1>eps)return t1;float t2=b+det;if(t2>eps)return t2;return INF;}float LGL_g(in vec3 pos,in vec3 u,in vec3 v,in vec4 plane,in Ray r){vec3 n=vec3(plane);float dt=dot(r.d,n);float t=(plane.w-dot(n,r.o))/dt;if(t>EPS){vec3 p=r.o+r.d*t;vec3 vi=p-pos;float a1=dot(u,vi);if(a1>=0.&&a1<=1.){float a2=dot(v,vi);if(a2>=0.&&a2<=1.)return t;}}return INF;}float LGL_h(vec3 v0,vec3 v1,vec3 v2,Ray r,bool isDoubleSided){vec3 edge1=v1-v0;vec3 edge2=v2-v0;vec3 pvec=cross(r.d,edge2);float det=1.0/dot(edge1,pvec);if(!isDoubleSided&&det<0.0)return INF;vec3 tvec=r.o-v0;float u=dot(tvec,pvec)*det;vec3 qvec=cross(tvec,edge1);float v=dot(r.d,qvec)*det;float t=dot(edge2,qvec)*det;return(u<0.0||u>1.0||v<0.0||u+v>1.0||t<=0.0)? INF : t;}float LGL_gClassic(vec3 v1,vec3 v2,vec3 v3,vec3 v4,Ray r,bool isDoubleSided){return min(LGL_h(v1,v3,v2,r,isDoubleSided),LGL_h(v2,v3,v4,r,isDoubleSided));}void LGL_j(inout SurfaceInteraction si,Triangle tri,vec3 barycentric,ivec3 index,vec3 LGL_BY,int materialIndex){si.LGL_BW=true;si.LGL_BY=LGL_BY;si.position=barycentric.x*tri.p0+barycentric.y*tri.p1+barycentric.z*tri.p2;ivec2 i0=LGL_Ai(index.x,VERTEX_COLUMNS);ivec2 i1=LGL_Ai(index.y,VERTEX_COLUMNS);ivec2 i2=LGL_Ai(index.z,VERTEX_COLUMNS);vec3 n0=texelFetch(normalBuffer,i0,0).xyz;vec3 n1=texelFetch(normalBuffer,i1,0).xyz;vec3 n2=texelFetch(normalBuffer,i2,0).xyz;vec3 normal=normalize(barycentric.x*n0+barycentric.y*n1+barycentric.z*n2);vec2 uv0=texelFetch(uvBuffer,i0,0).xy;vec2 uv1=texelFetch(uvBuffer,i1,0).xy;vec2 uv2=texelFetch(uvBuffer,i2,0).xy;\n#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS) || defined(NUM_PBR_MAPS)\nvec2 uv=fract(barycentric.x*uv0+barycentric.y*uv1+barycentric.z*uv2);\n#else\nvec2 uv=vec2(0.0);\n#endif\nsi.LGL_BT=int(LGL_w(materialIndex));si.color=LGL_AG(materialIndex,uv);si.roughness=LGL_AB(materialIndex,uv);si.metalness=LGL_AF(materialIndex,uv);si.specularColor=LGL_z(materialIndex,uv);si.LGL_BS=LGL_x(materialIndex);si.emissive=LGL_y(materialIndex,uv);vec3 dp1=tri.p0-tri.p2;vec3 dp2=tri.p1-tri.p2;vec2 duv1=uv0-uv2;vec2 duv2=uv1-uv2;si.normal=LGL_AI(materialIndex,uv,normal,dp1,dp2,duv1,duv2,si.tangent,si.bitangent);si.LGL_BK=LGL_AJ(materialIndex);si.sheen=LGL_AK(materialIndex);si.LGL_BL=LGL_AKTint(materialIndex);si.clearcoat=LGL_AN(materialIndex);si.LGL_BM=LGL_ANRoughness(materialIndex);si.LGL_BN=LGL_AP(materialIndex);si.LGL_BO=LGL_AQ(materialIndex);si.LGL_BP=LGL_AL(materialIndex,uv);si.ior=LGL_AR(materialIndex);si.LGL_BQ=LGL_AS(materialIndex);si.LGL_BR=LGL_AT(materialIndex);si.extinction=LGL_AU(materialIndex);}TriangleIntersect LGL_k(Ray r,Triangle tri){vec3 v0=tri.p0;vec3 v1=tri.p1;vec3 v2=tri.p2;TriangleIntersect ti;vec3 e0=v1-v0;vec3 e1=v2-v0;vec3 pv=cross(r.d,e1);float det=dot(e0,pv);vec3 tv=r.o-v0;vec3 qv=cross(tv,e0);vec4 uvt;uvt.x=dot(tv,pv);uvt.y=dot(r.d,qv);uvt.z=dot(e1,qv);uvt.xyz=uvt.xyz/det;uvt.w=1.0-uvt.x-uvt.y;if(uvt.z>=r.LGL_Ba){return ti;}if(all(greaterThanEqual(uvt,vec4(0.0)))&&uvt.z<INF){ti.t=uvt.z;ti.barycentric=uvt.wxy;}return ti;}float LGL_l(Ray r,Box b){vec3 tBot=(b.min-r.o)*r.LGL_BZ;vec3 tTop=(b.max-r.o)*r.LGL_BZ;vec3 tNear=min(tBot,tTop);vec3 tFar=max(tBot,tTop);float t0=max(tNear.x,max(tNear.y,tNear.z));float t1=min(tFar.x,min(tFar.y,tFar.z));return(t0>t1||t0>r.LGL_Ba)?-1.0 :(t0>0.0 ? t0 : t1);}bool LGL_m(inout Ray ray,float maxDist){\n#if defined(NUM_LIGHTS)\nfor(int i=0;i<NUM_LIGHTS;i++){vec3 position=lights.position[i];vec3 emission=lights.emission[i];vec3 p1=lights.p1[i];vec3 p2=lights.p2[i];vec4 params=lights.params[i];float radius=params.x;float area=params.y;float type=params.z;float LGL_s=params.w;if(type==0.||type==1.){vec3 normal=normalize(cross(p1,p2));if(dot(normal,ray.d)>0.)continue;vec4 plane=vec4(normal,dot(normal,position));p1*=1.0/dot(p1,p1);p2*=1.0/dot(p2,p2);float d=LGL_g(position,p1,p2,plane,ray);if(d>0.&&d<maxDist)return true;}if(type==1.){float d=LGL_f(radius,position,ray);if(d>0.&&d<maxDist)return true;}}\n#endif\nint LGL_p[STACK_SIZE];LGL_p[0]=0;int LGL_t=0;while(LGL_t>=0){int i=LGL_p[LGL_t--];vec4 r1=LGL_Aj(bvhBuffer,i,BVH_COLUMNS);vec4 r2=LGL_Aj(bvhBuffer,i+1,BVH_COLUMNS);int LGL_q=int(r1.w);if(LGL_q>=0){int LGL_r=LGL_q;Box bbox=Box(r1.xyz,r2.xyz);if(LGL_l(ray,bbox)>0.0){if(ray.d[LGL_r]>0.0){LGL_p[++LGL_t]=int(r2.w);LGL_p[++LGL_t]=i+2;}else{LGL_p[++LGL_t]=i+2;LGL_p[++LGL_t]=int(r2.w);}}}else{ivec3 index=ivec3(r1.xyz);Triangle tri=Triangle(LGL_Aj(positionBuffer,index.x,VERTEX_COLUMNS).xyz,LGL_Aj(positionBuffer,index.y,VERTEX_COLUMNS).xyz,LGL_Aj(positionBuffer,index.z,VERTEX_COLUMNS).xyz);TriangleIntersect LGL_BW=LGL_k(ray,tri);if(LGL_BW.t>0.0&&LGL_BW.t<maxDist){return true;}}}return false;}void LGL_n(inout Ray ray,inout SurfaceInteraction si,inout LightSampleRec lightSampleRec,int bounce){si.LGL_BW=false;float t=INF;float d;\n#if defined(NUM_LIGHTS)\nfor(int i=0;i<NUM_LIGHTS;i++){vec4 params=lights.params[i];float radius=params.x;float area=params.y;float type=params.z;float LGL_s=params.w;if(bounce==0&&LGL_s<0.1)continue;vec3 position=lights.position[i];vec3 emission=lights.emission[i];vec3 p1=lights.p1[i];vec3 p2=lights.p2[i];if(type==0.||type==1.){vec3 normal=normalize(cross(p1,p2));if(dot(normal,ray.d)>0.)continue;vec4 plane=vec4(normal,dot(normal,position));p1*=1.0/dot(p1,p1);p2*=1.0/dot(p2,p2);d=LGL_g(position,p1,p2,plane,ray);if(d<0.)d=INF;if(d<t){t=d;float cosTheta=dot(-ray.d,normal);float pdf=(t*t)/(area*cosTheta);lightSampleRec.emission=emission;lightSampleRec.pdf=pdf;si.LGL_BW=true;si.LGL_BU=true;ray.LGL_Ba=t;}}if(type==2.){d=LGL_f(radius,position,ray);if(d<0.)d=INF;if(d<t){t=d;float pdf=(t*t)/area;lightSampleRec.emission=emission;lightSampleRec.pdf=pdf;si.LGL_BW=true;si.LGL_BU=true;ray.LGL_Ba=t;}}}\n#endif\nint LGL_p[STACK_SIZE];LGL_p[0]=0;int LGL_t=0;while(LGL_t>=0){int i=LGL_p[LGL_t--];vec4 r1=LGL_Aj(bvhBuffer,i,BVH_COLUMNS);vec4 r2=LGL_Aj(bvhBuffer,i+1,BVH_COLUMNS);int LGL_q=int(r1.w);if(LGL_q>=0){int LGL_r=LGL_q;Box bbox=Box(r1.xyz,r2.xyz);if(LGL_l(ray,bbox)>0.0){if(ray.d[LGL_r]>0.0){LGL_p[++LGL_t]=int(r2.w);LGL_p[++LGL_t]=i+2;}else{LGL_p[++LGL_t]=i+2;LGL_p[++LGL_t]=int(r2.w);}}}else{ivec3 index=ivec3(r1.xyz);Triangle tri=Triangle(LGL_Aj(positionBuffer,index.x,VERTEX_COLUMNS).xyz,LGL_Aj(positionBuffer,index.y,VERTEX_COLUMNS).xyz,LGL_Aj(positionBuffer,index.z,VERTEX_COLUMNS).xyz);TriangleIntersect LGL_BW=LGL_k(ray,tri);if(LGL_BW.t>0.0){int materialIndex=int(r2.w);vec3 LGL_BY=r2.xyz;si.t=LGL_BW.t;si.LGL_BU=false;ray.LGL_Ba=LGL_BW.t;LGL_j(si,tri,LGL_BW.barycentric,index,LGL_BY,materialIndex);si.LGL_BX=dot(si.LGL_BY,ray.d)<=0.0 ? si.normal :-si.normal;}}}si.roughness=clamp(si.roughness,ROUGHNESS_MIN,1.0);si.metalness=clamp(si.metalness,0.0,1.0);}void LGL_o(inout Ray ray,inout SurfaceInteraction si,inout LightSampleRec lightSampleRec,int depth){if(si.LGL_BW&&!si.LGL_BU&&si.LGL_BP<1.0){float LGL_BV=LGL_Aa();float LGL_v=0.;while(si.LGL_BW&&!si.LGL_BU&&LGL_BV>si.LGL_BP&&LGL_v<2.){LGL_Ah(ray,si.position+EPS*ray.d,ray.d);LGL_n(ray,si,lightSampleRec,depth);LGL_v++;}}}\n#ifndef CONST_COLOR_ENV\nuniform sampler2D envMap;uniform float totalSumValue;uniform sampler2D envMarginalWeights;uniform sampler2D envConditionalWeights;vec2 equirectDirToUV(vec3 pointOnSphere){float phi=atan(pointOnSphere.z,pointOnSphere.x)/TWOPI;float theta=acos(pointOnSphere.y);return vec2(phi+0.5,theta*INVPI);}vec3 equirectUVToDir(vec2 uv){uv.x-=0.5;float theta=uv.x*2.0*PI;float phi=uv.y*PI;float sinPhi=sin(phi);return vec3(sinPhi*cos(theta),cos(phi),sinPhi*sin(theta));}vec3 LGL_Z(vec3 d){vec2 uv=equirectDirToUV(d);return LGL_Az(envMap,uv).rgb;}float equirectDirectionPdf(vec3 dir){vec2 uv=equirectDirToUV(dir);float sinTheta=sin(uv.y*PI);if(sinTheta==0.0){return 0.0;}return INVPI2/(2.0*sinTheta);}float LGL_c(vec3 dir){vec2 uv=equirectDirToUV(dir);vec3 color=texture(envMap,uv).rgb;float lum=LGL_Af(color);vec2 size=vec2(textureSize(envMap,0));return(size.x*size.y)*(lum/totalSumValue)*equirectDirectionPdf(dir);}vec3 LGL_d(vec2 LGL_Aaom,out vec2 uv,out float pdf){vec2 size=vec2(textureSize(envMap,0));float sizeMarginalWeights=size.y;float v=texelFetch(envMarginalWeights,ivec2(LGL_Aaom.x*sizeMarginalWeights,0),0).x;float u=texelFetch(envConditionalWeights,ivec2(LGL_Aaom.y*size.x,v*size.y),0).x;uv=vec2(u,v);vec3 dir=equirectUVToDir(uv);vec3 color=texture(envMap,uv).rgb;float lum=LGL_Af(color);pdf=(size.x*size.y)*(lum/totalSumValue)*equirectDirectionPdf(dir);return dir;}\n#endif\nvoid LGL_Al(in vec3 N,inout vec3 T,inout vec3 B){if(N.z<-0.999999){T=vec3(0.,-1.,0.);B=vec3(-1.,0.,0.);}else{float a=1.0/(1.+N.z);float b=-N.x*N.y*a;T=vec3(1.0-N.x*N.x*a,b,-N.x);B=vec3(b,1.-N.y*N.y*a,-N.y);}}vec3 LGL_Ay(vec3 V,float rgh,float r1,float r2){vec3 Vh=normalize(vec3(rgh*V.x,rgh*V.y,V.z));float lensq=Vh.x*Vh.x+Vh.y*Vh.y;vec3 T1=lensq>0. ? vec3(-Vh.y,Vh.x,0)*inversesqrt(lensq): vec3(1.,0.,0.);vec3 T2=cross(Vh,T1);float r=sqrt(r1);float phi=2.0*PI*r2;float t1=r*cos(phi);float t2=r*sin(phi);float s=0.5*(1.0+Vh.z);t2=(1.0-s)*sqrt(1.0-t1*t1)+s*t2;vec3 Nh=t1*T1+t2*T2+sqrt(max(0.0,1.0-t1*t1-t2*t2))*Vh;return normalize(vec3(rgh*Nh.x,rgh*Nh.y,max(0.0,Nh.z)));}vec2 LGL_Am(vec2 p){p=2.0*p-1.0;bool greater=abs(p.x)>abs(p.y);float r=greater ? p.x : p.y;float theta=greater ? 0.25*PI*p.y/p.x : PI*(0.5-0.25*p.x/p.y);return r*vec2(cos(theta),sin(theta));}vec3 LGL_An(vec2 p){vec2 h=LGL_Am(p);float z=sqrt(max(0.0,1.0-h.x*h.x-h.y*h.y));return vec3(h,z);}vec3 LGL_Ao(float r1,float r2){float z=1.0-2.0*r1;float r=sqrt(max(0.0,1.0-z*z));float phi=TWOPI*r2;return vec3(r*cos(phi),r*sin(phi),z);}vec3 LGL_Ap(vec3 LGL_BY,vec3 viewDir,mat3 basis,float roughness,vec2 LGL_Aaom){float phi=TWOPI*LGL_Aaom.y;float alpha=roughness*roughness;float cosTheta=sqrt((1.0-LGL_Aaom.x)/(1.0+(alpha*alpha-1.0)*LGL_Aaom.x));float sinTheta=sqrt(1.0-cosTheta*cosTheta);vec3 halfVector=basis*sign(dot(LGL_BY,viewDir))*vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);vec3 lightDir=reflect(-viewDir,halfVector);return lightDir;}vec3 LGL_Aq(vec3 LGL_BY,vec3 viewDir,mat3 basis,vec2 LGL_Aaom){return basis*sign(dot(LGL_BY,viewDir))*LGL_An(LGL_Aaom);}float LGL_Ar(float f,float g){return(f*f)/(f*f+g*g);}vec3 LGL_As(in Ray r,int depth,in LightSampleRec lightSampleRec,in BsdfSampleRec bsdfSampleRec){vec3 Le;if(depth==0){Le=lightSampleRec.emission;}else{Le=LGL_Ar(bsdfSampleRec.pdf,lightSampleRec.pdf)*lightSampleRec.emission;}return Le;}\n#if defined(NUM_LIGHTS)\nvoid LGL_At(in Light light,in vec3 surfacePos,inout LightSampleRec lightSampleRec,vec2 LGL_Aaom){float r1=LGL_Aaom.x;float r2=LGL_Aaom.y;vec3 lightSurfacePos=light.position+LGL_Ao(r1,r2)*light.radius;lightSampleRec.direction=lightSurfacePos-surfacePos;lightSampleRec.dist=length(lightSampleRec.direction);float distSq=lightSampleRec.dist*lightSampleRec.dist;lightSampleRec.direction/=lightSampleRec.dist;lightSampleRec.normal=normalize(lightSurfacePos-light.position);lightSampleRec.emission=light.emission*float(NUM_LIGHTS);lightSampleRec.pdf=distSq/(light.area*abs(dot(lightSampleRec.normal,lightSampleRec.direction)));}void LGL_Av(in Light light,in vec3 surfacePos,inout LightSampleRec lightSampleRec,vec2 LGL_Aaom){float r1=LGL_Aaom.x;float r2=LGL_Aaom.y;vec3 lightSurfacePos=light.position+light.p1*r1+light.p2*r2;lightSampleRec.direction=lightSurfacePos-surfacePos;lightSampleRec.dist=length(lightSampleRec.direction);float distSq=lightSampleRec.dist*lightSampleRec.dist;lightSampleRec.direction/=lightSampleRec.dist;lightSampleRec.normal=normalize(cross(light.p1,light.p2));lightSampleRec.emission=light.emission*float(NUM_LIGHTS);lightSampleRec.pdf=distSq/(light.area*abs(dot(lightSampleRec.normal,lightSampleRec.direction)));}void LGL_Aw(in Light light,in vec3 surfacePos,inout LightSampleRec lightSampleRec){lightSampleRec.direction=normalize(light.position-light.p1);lightSampleRec.normal=normalize(surfacePos-light.position);if(dot(lightSampleRec.direction,lightSampleRec.normal)>0.0){lightSampleRec.normal=-lightSampleRec.normal;}lightSampleRec.emission=light.emission*float(NUM_LIGHTS);lightSampleRec.dist=INF;lightSampleRec.pdf=1.0;}void samplePointLight(in Light light,in vec3 surfacePos,inout LightSampleRec lightSampleRec){lightSampleRec.direction=light.position-surfacePos;lightSampleRec.dist=length(lightSampleRec.direction);float distSq=lightSampleRec.dist*lightSampleRec.dist;lightSampleRec.direction=normalize(lightSampleRec.direction);lightSampleRec.normal=normalize(surfacePos-light.position);lightSampleRec.emission=light.emission*float(NUM_LIGHTS)/distSq;lightSampleRec.pdf=1.0;}void LGL_Ax(in Light light,in vec3 surfacePos,inout LightSampleRec lightSampleRec,vec2 LGL_Aaom){int type=int(light.type);if(type==0||type==1){LGL_Av(light,surfacePos,lightSampleRec,LGL_Aaom);}else if(type==2){LGL_At(light,surfacePos,lightSampleRec,LGL_Aaom);}else if(type==3){LGL_Aw(light,surfacePos,lightSampleRec);}else if(type==4){samplePointLight(light,surfacePos,lightSampleRec);}}\n#endif\nvec3 LocalToWorld(vec3 X,vec3 Y,vec3 Z,vec3 V){return vec3(X.x*V.x+Y.x*V.y+Z.x*V.z,X.y*V.x+Y.y*V.y+Z.y*V.z,X.z*V.x+Y.z*V.y+Z.z*V.z);}vec3 WorldToLocal(vec3 X,vec3 Y,vec3 Z,vec3 V){return vec3(dot(V,X),dot(V,Y),dot(V,Z));}vec3 LGL_A(float r1,float r2){vec3 dir;float r=sqrt(r1);float phi=TWOPI*r2;dir.x=r*cos(phi);dir.y=r*sin(phi);dir.z=sqrt(max(0.0,1.0-dir.x*dir.x-dir.y*dir.y));return dir;}float LGL_B(float eta){float sqrtR0=(eta-1.)/(eta+1.);return sqrtR0*sqrtR0;}vec3 LGL_C(vec3 baseColor){float LGL_Ag=LGL_Af(baseColor);return(LGL_Ag>0.0)? baseColor/LGL_Ag : vec3(1.);}void LGL_D(SurfaceInteraction si,out vec3 Cspec0,out vec3 Csheen){vec3 tint=LGL_C(si.color);if(si.LGL_BS>0.1){Cspec0=si.specularColor;}else{Cspec0=mix(LGL_B(si.ior)*mix(vec3(1.0),tint,min(si.LGL_BK,0.99)),si.color,si.metalness);}Csheen=mix(vec3(1.0),tint,si.LGL_BL);}float LGL_E(float u){float m=clamp(1.0-u,0.0,1.0);float m2=m*m;return m2*m2*m;}float LGL_F(float F0,float cosTheta){return mix(F0,1.0,LGL_E(cosTheta));}vec3 LGL_F(vec3 F0,float cosTheta){return mix(F0,vec3(1.),LGL_E(cosTheta));}float LGL_G(float cosThetaI,float eta){float sinThetaTSq=eta*eta*(1.0f-cosThetaI*cosThetaI);if(sinThetaTSq>1.0)return 1.0;float cosThetaT=sqrt(max(1.0-sinThetaTSq,0.0));float rs=(eta*cosThetaT-cosThetaI)/(eta*cosThetaT+cosThetaI);float rp=(eta*cosThetaI-cosThetaT)/(eta*cosThetaI+cosThetaT);return 0.5*(rs*rs+rp*rp);}vec3 LGL_H(vec3 F0,float metalness,float eta,float cosThetaI){vec3 FrSchlick=LGL_F(F0,cosThetaI);float FrDielectric=LGL_G(cosThetaI,eta);return mix(vec3(FrDielectric),FrSchlick,metalness);}float LGL_H(float metalness,float eta,float cosThetaI){float FrSchlick=LGL_E(cosThetaI);float FrDielectric=LGL_G(cosThetaI,eta);return mix(FrDielectric,FrSchlick,metalness);}float LGL_I(float NDotV,float alphaG){float a=alphaG*alphaG;float b=NDotV*NDotV;return 1.0/(NDotV+sqrt(a+b-a*b));}float LGL_J(float NDotH,float alpha){float alpha2=alpha*alpha;float t=1.0+(alpha2-1.0)*NDotH*NDotH;return(alpha2-1.0)/(PI*log(alpha2)*t);}float LGL_K(float NDotH,float a){float a2=a*a;float t=1.0+(a2-1.0)*NDotH*NDotH;return a2/(PI*t*t);}vec3 ImportanceSampleLGL_J(float rgh,float r1,float r2){float a=max(0.001,rgh);float a2=a*a;float phi=r1*TWOPI;float cosTheta=sqrt((1.0-pow(a2,1.0-r1))/(1.0-a2));float sinTheta=clamp(sqrt(1.0-(cosTheta*cosTheta)),0.0,1.0);float sinPhi=sin(phi);float cosPhi=cos(phi);return vec3(sinTheta*cosPhi,sinTheta*sinPhi,cosTheta);}vec3 ImportanceSampleLGL_K(float rgh,float r1,float r2){float a=max(0.001,rgh);float phi=r1*TWOPI;float cosTheta=sqrt((1.0-r2)/(1.0+(a*a-1.0)*r2));float sinTheta=clamp(sqrt(1.0-(cosTheta*cosTheta)),0.0,1.0);float sinPhi=sin(phi);float cosPhi=cos(phi);return vec3(sinTheta*cosPhi,sinTheta*sinPhi,cosTheta);}vec3 LGL_N(SurfaceInteraction si,vec3 Csheen,vec3 V,vec3 L,vec3 H,out float pdf){pdf=0.0;if(L.z<=0.0)return vec3(0.0);pdf=L.z*INVPI;float LDotH=dot(L,H);float FL=LGL_E(L.z);float FV=LGL_E(V.z);float Fh=LGL_E(LDotH);float Fd90=0.5+2.0*LDotH*LDotH*si.roughness;float Fd=mix(1.0,Fd90,FL)*mix(1.0,Fd90,FV);float Fss90=LDotH*LDotH*si.roughness;float Fss=mix(1.0,Fss90,FL)*mix(1.0,Fss90,FV);float DisneyFakeSS=1.25*(Fss*(1.0/(L.z+V.z)-0.5)+0.5);vec3 Fsheen=Fh*si.sheen*Csheen;return(INVPI*mix(Fd,DisneyFakeSS,si.LGL_BN)*si.color+Fsheen)*(1.0-si.metalness)*(1.0-si.LGL_BO);}vec3 LGL_O(SurfaceInteraction si,vec3 Cspec0,vec3 V,vec3 L,vec3 H,out float pdf){pdf=0.0;if(L.z<=0.0)return vec3(0.0);float LDotH=dot(L,H);float D=LGL_K(H.z,si.roughness);pdf=D*H.z/(4.0*LDotH);vec3 F=LGL_H(Cspec0,si.metalness,si.eta,LDotH);float G=LGL_I(abs(L.z),si.roughness)*LGL_I(abs(V.z),si.roughness);return F*D*G;}vec3 LGL_P(SurfaceInteraction si,vec3 Cspec0,vec3 V,vec3 L,vec3 H,out float pdf){pdf=0.0;if(L.z>=0.0)return vec3(0.0);float F=LGL_G(abs(dot(V,H)),si.eta);float D=LGL_K(H.z,si.roughness);float denomSqrt=dot(L,H)+dot(V,H)*si.eta;pdf=D*H.z*abs(dot(L,H))/(denomSqrt*denomSqrt);float G=LGL_I(abs(L.z),si.roughness)*LGL_I(abs(V.z),si.roughness);vec3 specColor=pow(si.color,vec3(0.5));return specColor*(1.0-si.metalness)*si.LGL_BO*(1.0-F)*D*G*abs(dot(V,H))*abs(dot(L,H))*4.0*si.eta*si.eta/(denomSqrt*denomSqrt);}vec3 LGL_Q(SurfaceInteraction si,vec3 V,vec3 L,vec3 H,out float pdf){pdf=0.0;if(L.z<=0.0)return vec3(0.0);float LDotH=dot(L,H);float F=LGL_F(.04,LDotH);float D=LGL_J(H.z,mix(0.1,0.001,1.-si.LGL_BM));pdf=D*H.z/(4.0*LDotH);float G=LGL_I(L.z,0.25)*LGL_I(V.z,0.25);return vec3(0.25*si.clearcoat*F*D*G);}void LGL_R(SurfaceInteraction si,vec3 Cspec0,float fresnelWeight,out float LGL_S,out float LGL_T,out float LGL_U,out float LGL_V){LGL_S=max(LGL_Af(si.color),si.sheen)*(1.0-si.metalness)*(1.0-si.LGL_BO);LGL_T=LGL_Af(Cspec0);LGL_U=(1.0-fresnelWeight)*(1.0-si.metalness)*si.LGL_BO*LGL_Af(si.color);LGL_V=si.clearcoat*(1.0-si.metalness);float weightSum=LGL_S+LGL_T+LGL_U+LGL_V;LGL_S/=weightSum;LGL_T/=weightSum;LGL_U/=weightSum;LGL_V/=weightSum;}vec3 LGL_W(SurfaceInteraction si,vec3 V,vec3 N,out vec3 L,out float pdf,MaterialSamples LGL_AaomSamples){pdf=0.0;vec3 f=vec3(0.0);vec2 bounceDirSample=LGL_AaomSamples.s3;vec2 diffuseOrSpecular=LGL_AaomSamples.s4;float r1=bounceDirSample.x;float r2=bounceDirSample.y;vec3 Cspec0,Csheen;LGL_D(si,Cspec0,Csheen);vec3 T,B;LGL_Al(N,T,B);V=WorldToLocal(T,B,N,V);float LGL_S,LGL_T,LGL_U,LGL_V;float fresnelWeight=LGL_H(si.metalness,si.eta,V.z);LGL_R(si,Cspec0,fresnelWeight,LGL_S,LGL_T,LGL_U,LGL_V);float cdf[4];cdf[0]=LGL_S;cdf[1]=cdf[0]+LGL_T;cdf[2]=cdf[1]+LGL_U;cdf[3]=cdf[2]+LGL_V;if(r1<cdf[0]){r1/=cdf[0];L=LGL_A(r1,r2);vec3 H=normalize(L+V);f=LGL_N(si,Csheen,V,L,H,pdf);pdf*=LGL_S;}else if(r1<cdf[1]){r1=(r1-cdf[0])/(cdf[1]-cdf[0]);vec3 H=ImportanceSampleLGL_K(si.roughness,r1,r2);if(dot(V,H)<0.0)H=-H;L=normalize(reflect(-V,H));f=LGL_O(si,Cspec0,V,L,H,pdf);pdf*=LGL_T;}else if(r1<cdf[2]){r1=(r1-cdf[1])/(cdf[2]-cdf[1]);vec3 H=ImportanceSampleLGL_K(si.roughness,r1,r2);if(dot(V,H)<0.0)H=-H;vec3 R=reflect(-V,H);L=normalize(refract(-V,H,si.eta));f=LGL_P(si,Cspec0,V,L,H,pdf);pdf*=LGL_U;}else{r1=(r1-cdf[2])/(1.0-cdf[2]);vec3 H=ImportanceSampleLGL_J(mix(0.1,0.001,1.-si.LGL_BM),r1,r2);if(dot(V,H)<0.0)H=-H;L=normalize(reflect(-V,H));f=LGL_Q(si,V,L,H,pdf);pdf*=LGL_V;}L=LocalToWorld(T,B,N,L);return f*abs(dot(N,L));}vec3 LGL_X(inout SurfaceInteraction si,vec3 V,vec3 L,out float bsdfPdf){bsdfPdf=0.0;vec3 f=vec3(0.0);vec3 N=si.LGL_BX;vec3 T,B;LGL_Al(N,T,B);V=WorldToLocal(T,B,N,V);L=WorldToLocal(T,B,N,L);vec3 H;if(L.z>0.0){H=normalize(L+V);}else{H=normalize(L+V*si.eta);}if(dot(V,H)<0.0){H=-H;}vec3 Cspec0,Csheen;LGL_D(si,Cspec0,Csheen);float LGL_S,LGL_T,LGL_U,LGL_V;float fresnelWeight=LGL_H(si.metalness,si.eta,abs(dot(L,H)));LGL_R(si,Cspec0,fresnelWeight,LGL_S,LGL_T,LGL_U,LGL_V);float pdf;if(LGL_S>0.0&&L.z>0.0){f+=LGL_N(si,Csheen,V,L,H,pdf);bsdfPdf+=pdf*LGL_S;}if(LGL_T>0.0&&L.z>0.0&&V.z>0.0){f+=LGL_O(si,Cspec0,V,L,H,pdf);bsdfPdf+=pdf*LGL_T;}if(LGL_U>0.0&&L.z<0.0){f+=LGL_P(si,Cspec0,V,L,H,pdf);bsdfPdf+=pdf*LGL_U;}if(LGL_V>0.0&&L.z>0.0&&V.z>0.0){f+=LGL_Q(si,V,L,H,pdf);bsdfPdf+=pdf*LGL_V;}return f*abs(L.z);}vec3 LGL_e(inout SurfaceInteraction si,in Path path,in vec2 s1,in vec2 s2){si.eta=dot(si.normal,si.LGL_BX)>0.0 ?(1.0/si.ior): si.ior;vec3 viewDir=-path.ray.d;vec3 surfacePos=si.position+EPS*si.LGL_BX;vec3 Li=vec3(0.0);BsdfSampleRec bsdfSampleRec;vec2 lightDirSample=s1;vec2 envDirSample=s2;vec3 lightDir;vec2 uv;float lightPdf;bool brdfSample=false;\n#ifndef CONST_COLOR_ENV\nlightDir=invEnvRotMatrix*LGL_d(envDirSample,uv,lightPdf);LGL_Ah(path.ray,surfacePos,lightDir);if(!LGL_m(path.ray,INF-EPS)){vec3 irr=LGL_Az(envMap,uv).rgb*envMapIntensity;bsdfSampleRec.f=LGL_X(si,viewDir,lightDir,bsdfSampleRec.pdf);if(bsdfSampleRec.pdf>0.0){float LGL_Bd=LGL_Ar(lightPdf,bsdfSampleRec.pdf);if(LGL_Bd>0.0){Li+=LGL_Bd*bsdfSampleRec.f*irr/lightPdf;}}}\n#endif\n#if defined(NUM_LIGHTS)\nLightSampleRec lightSampleRec;Light light;int i=int(lightDirSample.x*float(NUM_LIGHTS));vec3 position=lights.position[i];vec3 emission=lights.emission[i];vec3 p1=lights.p1[i];vec3 p2=lights.p2[i];vec4 params=lights.params[i];float radius=params.x;float area=params.y;float type=params.z;float LGL_s=params.w;light=Light(position,emission,p1,p2,radius,area,type,LGL_s);LGL_Ax(light,surfacePos,lightSampleRec,lightDirSample);if(dot(lightSampleRec.direction,lightSampleRec.normal)<0.0){LGL_Ah(path.ray,surfacePos,lightSampleRec.direction);if(!LGL_m(path.ray,lightSampleRec.dist-EPS)){bsdfSampleRec.f=LGL_X(si,viewDir,lightSampleRec.direction,bsdfSampleRec.pdf);float LGL_Bd=1.0;if(light.area>0.0&&bsdfSampleRec.pdf>0.0){LGL_Bd=LGL_Ar(lightSampleRec.pdf,bsdfSampleRec.pdf);}if(LGL_Bd>0.0){Li+=LGL_Bd*bsdfSampleRec.f*lightSampleRec.emission/lightSampleRec.pdf;}}}\n#endif\nreturn Li;}layout(location=0)out vec4 out_light;void bounce(inout Path path,int depth,inout SurfaceInteraction si,inout BsdfSampleRec bsdfSampleRec,in LightSampleRec lightSampleRec){if(!si.LGL_BW){if(depth==0&&enviromentVisible==0.){path.alpha=0.0;path.LGL_Bc=true;return;}if(depth==0&&useBackgroundColor==1){path.li+=backgroundColor*path.beta;path.LGL_Bc=true;return;}\n#ifdef CONST_COLOR_ENV\npath.li+=backgroundColor*path.beta;path.LGL_Bc=true;return;\n#else\nfloat LGL_Bd=1.0;vec3 envSampleDir=envRotMatrix*path.ray.d;if(depth>0){float lightPdf=LGL_c(envSampleDir);LGL_Bd=LGL_Ar(bsdfSampleRec.pdf,lightPdf);}vec3 irr=LGL_Z(envSampleDir)*envMapIntensity;path.li+=LGL_Bd*path.beta*irr;path.LGL_Bc=true;return;\n#endif\n}if(si.LGL_BU){path.li+=LGL_As(path.ray,depth,lightSampleRec,bsdfSampleRec)*path.beta;path.LGL_Bc=true;return;}if(dot(si.normal,si.LGL_BX)>0.0){path.LGL_Be=vec3(0.0);}path.li+=path.beta*si.emissive;path.beta*=exp(-path.LGL_Be*si.t);MaterialSamples LGL_AaomSamples=getRandomMaterialSamples();if(si.LGL_BT==DISNEY){path.li+=LGL_e(si,path,LGL_AaomSamples.s1,LGL_AaomSamples.s2)*path.beta;}bsdfSampleRec.f=LGL_W(si,-path.ray.d,si.LGL_BX,bsdfSampleRec.L,bsdfSampleRec.pdf,LGL_AaomSamples);if(dot(si.LGL_BX,bsdfSampleRec.L)<0.0){path.LGL_Be=-log(si.extinction)/si.LGL_BQ;}if(bsdfSampleRec.pdf>0.0){path.beta*=bsdfSampleRec.f/bsdfSampleRec.pdf;}else{path.LGL_Bc=true;return;}if(depth>=2){float q=1.0-LGL_Af(path.beta);if(LGL_AaomSample()<q){path.LGL_Bc=true;return;}path.beta/=1.0-q;}LGL_Ah(path.ray,si.position+EPS*bsdfSampleRec.L,bsdfSampleRec.L);}vec4 LGL_BA(inout Ray ray){SurfaceInteraction si;Path path;BsdfSampleRec bsdfSampleRec;LightSampleRec lightSampleRec;path.ray=ray;path.li=vec3(0);path.alpha=1.0;path.LGL_Bc=false;path.LGL_Bd=1.0;path.LGL_Be=vec3(0.0);path.beta=vec3(1.0);for(int i=0;i<bounces;i++){if(path.LGL_Bc){return vec4(path.li,path.alpha);}LGL_n(path.ray,si,lightSampleRec,i);LGL_o(path.ray,si,lightSampleRec,i);bounce(path,i,si,bsdfSampleRec,lightSampleRec);}return vec4(path.li,path.alpha);}void main(){LGL_Ac(frameCount);vec2 vCoordAntiAlias=vCoord+jitter;vec3 direction=normalize(vec3(vCoordAntiAlias-0.5,-1.0)*vec3(camera.aspect,1.0,camera.fov));vec3 origin=camera.transform[3].xyz;direction=mat3(camera.transform)*direction;Ray cam;LGL_Ah(cam,origin,direction);vec4 LGL_Ak=LGL_BA(cam);if(!(LGL_Ak.x<INF&&LGL_Ak.x>-EPS)){LGL_Ak=vec4(0,0,0,1);}out_light=LGL_Ak;}"};function D(e,t){let a=[];for(let n of t)a.push(function(e,t){let a=[],n=e**t;for(let e=0;e<n;e++)a[e]=e;let i=a.length,r=[];function o(){i=0}return{next:function(){i>=a.length&&(function(e){for(let t=e.length-1;t>0;t--){let a=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[a],e[a]=n}}(a),o());let n=a[i++];for(let a=0;a<t;a++)r[a]=n%e+Math.random(),n=Math.floor(n/e);return r},restart:o,strataCount:e}}(e,n));let n=[];return{next:function(){let e=0;for(let t of a){let a=t.next();for(let t of a)n[e++]=t}return n},restart:function(){for(let e of a)e.restart()},strataCount:e}}let Y="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIHR7Y29uc3RydWN0b3IodD0wLGU9MCxuPTApe3RoaXMueD10LHRoaXMueT1lLHRoaXMuej1ufWxlbmd0aCgpe3JldHVybiBNYXRoLnNxcnQodGhpcy54KnRoaXMueCt0aGlzLnkqdGhpcy55K3RoaXMueip0aGlzLnopfWFkZFZlY3RvcnModCxlKXtyZXR1cm4gdGhpcy54PXQueCtlLngsdGhpcy55PXQueStlLnksdGhpcy56PXQueitlLnosdGhpc31zdWJWZWN0b3JzKHQsZSl7cmV0dXJuIHRoaXMueD10LngtZS54LHRoaXMueT10LnktZS55LHRoaXMuej10LnotZS56LHRoaXN9bXVsdGlwbHlTY2FsYXIodCl7cmV0dXJuIHRoaXMueCo9dCx0aGlzLnkqPXQsdGhpcy56Kj10LHRoaXN9ZGl2aWRlKHQpe3JldHVybiB0aGlzLngvPXQueCx0aGlzLnkvPXQueSx0aGlzLnovPXQueix0aGlzfWRpdmlkZVNjYWxhcih0KXtyZXR1cm4gdGhpcy5tdWx0aXBseVNjYWxhcigxL3QpfW1pbih0KXtyZXR1cm4gdGhpcy54PU1hdGgubWluKHRoaXMueCx0LngpLHRoaXMueT1NYXRoLm1pbih0aGlzLnksdC55KSx0aGlzLno9TWF0aC5taW4odGhpcy56LHQueiksdGhpc31tYXgodCl7cmV0dXJuIHRoaXMueD1NYXRoLm1heCh0aGlzLngsdC54KSx0aGlzLnk9TWF0aC5tYXgodGhpcy55LHQueSksdGhpcy56PU1hdGgubWF4KHRoaXMueix0LnopLHRoaXN9ZG90KHQpe3JldHVybiB0aGlzLngqdC54K3RoaXMueSp0LnkrdGhpcy56KnQuen1ub3JtYWxpemUoKXtyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIodGhpcy5sZW5ndGgoKXx8MSl9Y3Jvc3NWZWN0b3JzKHQsZSl7Y29uc3Qgbj10LngsaT10Lnkscj10Lnoscz1lLngsbz1lLnksaD1lLno7cmV0dXJuIHRoaXMueD1pKmgtcipvLHRoaXMueT1yKnMtbipoLHRoaXMuej1uKm8taSpzLHRoaXN9ZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LGUsbil7cmV0dXJuIHZvaWQgMCE9PW4mJmNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yMzogb2Zmc2V0IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSAuZnJvbUJ1ZmZlckF0dHJpYnV0ZSgpLiIpLHRoaXMueD10LmdldFgoZSksdGhpcy55PXQuZ2V0WShlKSx0aGlzLno9dC5nZXRaKGUpLHRoaXN9fWNsYXNzIGV7Y29uc3RydWN0b3IoZT1uZXcgdCgxLzAsMS8wLDEvMCksbj1uZXcgdCgtMS8wLC0xLzAsLTEvMCkpe3RoaXMubWluPWUsdGhpcy5tYXg9bn1pc0VtcHR5KCl7cmV0dXJuIHRoaXMubWF4Lng8dGhpcy5taW4ueHx8dGhpcy5tYXgueTx0aGlzLm1pbi55fHx0aGlzLm1heC56PHRoaXMubWluLnp9Z2V0Q2VudGVyKHQpe3JldHVybiB0aGlzLmlzRW1wdHkoKT90LnNldCgwLDAsMCk6dC5hZGRWZWN0b3JzKHRoaXMubWluLHRoaXMubWF4KS5tdWx0aXBseVNjYWxhciguNSl9Z2V0U2l6ZSh0KXtyZXR1cm4gdGhpcy5pc0VtcHR5KCk/dC5zZXQoMCwwLDApOnQuc3ViVmVjdG9ycyh0aGlzLm1heCx0aGlzLm1pbil9ZXhwYW5kQnlQb2ludCh0KXtyZXR1cm4gdGhpcy5taW4ubWluKHQpLHRoaXMubWF4Lm1heCh0KSx0aGlzfXVuaW9uKHQpe3JldHVybiB0aGlzLm1pbi5taW4odC5taW4pLHRoaXMubWF4Lm1heCh0Lm1heCksdGhpc319ZnVuY3Rpb24gbih0LGUsbil7Y29uc3QgaT10W25dO3Rbbl09dFtlXSx0W2VdPWl9bGV0IGk9MCxyPTAscz1udWxsLG89ITE7Y29uc3QgaD1uZXcgdDtmdW5jdGlvbiBhKHQsZSl7cmV0dXJue3ByaW1pdGl2ZXM6dCxib3VuZHM6ZX19ZnVuY3Rpb24gbCh0LGUsbil7bGV0IGk9bltlXS10Lm1pbltlXTtyZXR1cm4gdC5tYXhbZV0+dC5taW5bZV0mJihpLz10Lm1heFtlXS10Lm1pbltlXSksaX1mdW5jdGlvbiB1KHQpe3JldHVybiB0LmdldFNpemUoaCksMiooaC54KmgueitoLngqaC55K2gueipoLnkpfWZ1bmN0aW9uIGModCxtLHgpe2NvbnN0IGY9bmV3IGU7Zm9yKGxldCBlPW07ZTx4O2UrKylmLnVuaW9uKHRbZV0uYm91bmRzKTtpZihvKXtyKz0xLHMoci9pKX1jb25zdCB5PXgtbTtpZigxPT09eSlyZXR1cm4gYSh0LnNsaWNlKG0seCksZik7e2NvbnN0IGk9bmV3IGU7Zm9yKGxldCBlPW07ZTx4O2UrKylpLmV4cGFuZEJ5UG9pbnQodFtlXS5jZW50ZXIpO2NvbnN0IHI9KGkuZ2V0U2l6ZShoKSxoLng+aC56P2gueD5oLnk/IngiOiJ5IjpoLno+aC55PyJ6IjoieSIpO2xldCBzPU1hdGguZmxvb3IoKG0reCkvMik7aWYoeTw9NCkhZnVuY3Rpb24odCxlLGk9MCxyPXQubGVuZ3RoLHM9TWF0aC5mbG9vcigoaStyKS8yKSl7Zm9yKGxldCBvPWk7bzw9cztvKyspe2xldCBpPW8scz10W29dO2ZvcihsZXQgaD1vKzE7aDxyO2grKyllKHMsdFtoXSl8fChpPWgscz10W2hdLG4odCxvLGkpKX19KHQsKCh0LGUpPT50LmNlbnRlcltyXTxlLmNlbnRlcltyXSksbSx4LHMpO2Vsc2V7aWYoaS5tYXhbcl09PT1pLm1pbltyXSlyZXR1cm4gYSh0LnNsaWNlKG0seCksZik7e2NvbnN0IG89MTIsaD1bXTtmb3IobGV0IHQ9MDt0PG87dCsrKWgucHVzaCh7Ym91bmRzOm5ldyBlLGNvdW50OjB9KTtmb3IobGV0IGU9bTtlPHg7ZSsrKXtsZXQgbj1NYXRoLmZsb29yKG8qbChpLHIsdFtlXS5jZW50ZXIpKTtuPT09aC5sZW5ndGgmJihuPWgubGVuZ3RoLTEpLGhbbl0uY291bnQrKyxoW25dLmJvdW5kcy51bmlvbih0W2VdLmJvdW5kcyl9Y29uc3QgYT1bXTtmb3IobGV0IHQ9MDt0PGgubGVuZ3RoLTE7dCsrKXtjb25zdCBuPW5ldyBlLGk9bmV3IGU7bGV0IHI9MCxzPTA7Zm9yKGxldCBlPTA7ZTw9dDtlKyspbi51bmlvbihoW2VdLmJvdW5kcykscis9aFtlXS5jb3VudDtmb3IobGV0IGU9dCsxO2U8aC5sZW5ndGg7ZSsrKWkudW5pb24oaFtlXS5ib3VuZHMpLHMrPWhbZV0uY291bnQ7YS5wdXNoKC4xKyhyKnUobikrcyp1KGkpKS91KGYpKX1sZXQgYz1hWzBdLHk9MDtmb3IobGV0IHQ9MTt0PGEubGVuZ3RoO3QrKylhW3RdPGMmJihjPWFbdF0seT10KTtzPWZ1bmN0aW9uKHQsZSxpPTAscj10Lmxlbmd0aCl7Zm9yKDtpIT09cjspe2Zvcig7ZSh0W2ldKTspaWYoKytpPT09cilyZXR1cm4gaTtkb3tpZihpPT09LS1yKXJldHVybiBpfXdoaWxlKCFlKHRbcl0pKTtuKHQsaSxyKSxpKyt9cmV0dXJuIGl9KHQsKHQ9PntsZXQgZT1NYXRoLmZsb29yKGgubGVuZ3RoKmwoaSxyLHQuY2VudGVyKSk7cmV0dXJuIGU9PT1oLmxlbmd0aCYmKGU9aC5sZW5ndGgtMSksZTw9eX0pLG0seCl9fXJldHVybiB6PXIsZD1jKHQsbSxzKSxnPWModCxzLHgpLHtjaGlsZDA6ZCxjaGlsZDE6Zyxib3VuZHM6KG5ldyBlKS51bmlvbihkLmJvdW5kcykudW5pb24oZy5ib3VuZHMpLHNwbGl0QXhpczp6fX12YXIgeixkLGd9ZnVuY3Rpb24gbShuLHIpe2NvbnN0IGg9ZnVuY3Rpb24obil7Y29uc3QgaT1bXSxyPW4uZ2V0SW5kZXg/bi5nZXRJbmRleCgpLmFycmF5Om4uaW5kZXguYXJyYXkscz1uLmdldEF0dHJpYnV0ZT9uLmdldEF0dHJpYnV0ZSgicG9zaXRpb24iKTpuLmF0dHJpYnV0ZXMucG9zaXRpb24sbz1uLmdldEF0dHJpYnV0ZT9uLmdldEF0dHJpYnV0ZSgibWF0ZXJpYWxNZXNoSW5kZXgiKTpuLmF0dHJpYnV0ZXMubWF0ZXJpYWxNZXNoSW5kZXgsaD1uZXcgdCxhPW5ldyB0LGw9bmV3IHQsdT1uZXcgdCxjPW5ldyB0O2ZvcihsZXQgbT0wO208ci5sZW5ndGg7bSs9Myl7Y29uc3Qgbj1yW21dLHg9clttKzFdLGY9clttKzJdLHk9bmV3IGU7cy5nZXRYPyhoLmZyb21CdWZmZXJBdHRyaWJ1dGUocyxuKSxhLmZyb21CdWZmZXJBdHRyaWJ1dGUocyx4KSxsLmZyb21CdWZmZXJBdHRyaWJ1dGUocyxmKSk6KGgueD1zLmFycmF5W24qcy5pdGVtU2l6ZV0saC55PXMuYXJyYXlbbipzLml0ZW1TaXplKzFdLGguej1zLmFycmF5W24qcy5pdGVtU2l6ZSsyXSxhLng9cy5hcnJheVt4KnMuaXRlbVNpemVdLGEueT1zLmFycmF5W3gqcy5pdGVtU2l6ZSsxXSxhLno9cy5hcnJheVt4KnMuaXRlbVNpemUrMl0sbC54PXMuYXJyYXlbZipzLml0ZW1TaXplXSxsLnk9cy5hcnJheVtmKnMuaXRlbVNpemUrMV0sbC56PXMuYXJyYXlbZipzLml0ZW1TaXplKzJdKSx5LmV4cGFuZEJ5UG9pbnQoaCkseS5leHBhbmRCeVBvaW50KGEpLHkuZXhwYW5kQnlQb2ludChsKSx1LnN1YlZlY3RvcnMobCxoKSxjLnN1YlZlY3RvcnMoYSxoKTtjb25zdCB6PShuZXcgdCkuY3Jvc3NWZWN0b3JzKGMsdSkubm9ybWFsaXplKCksZD17Ym91bmRzOnksY2VudGVyOnkuZ2V0Q2VudGVyKG5ldyB0KSxpbmRpY2VzOltuLHgsZl0sZmFjZU5vcm1hbDp6LG1hdGVyaWFsSW5kZXg6by5nZXRYP28uZ2V0WChuKTpvLmFycmF5W24qby5pdGVtU2l6ZV19O2kucHVzaChkKX1yZXR1cm4gaX0obik7ciYmKGk9MipoLmxlbmd0aC0xLG89ITAscz1yKTtyZXR1cm4gYyhoLDAsaC5sZW5ndGgpfXNlbGYub25tZXNzYWdlPWZ1bmN0aW9uKHtkYXRhOnR9KXtjb25zdHtnZW9tZXRyeTplfT10O2xldCBuPXBlcmZvcm1hbmNlLm5vdygpO2NvbnN0IGk9dD0+e2NvbnN0IGU9cGVyZm9ybWFuY2Uubm93KCk7KGUtbj49MTB8fDE9PT10KSYmKG49ZSxzZWxmLnBvc3RNZXNzYWdlKHtlcnJvcjpudWxsLGZsYXR0ZW5lZEJ2aDpudWxsLHByb2dyZXNzOnR9KSl9O3RyeXtjb25zdCB0PWZ1bmN0aW9uKHQpe2NvbnN0IGU9W10sbj1bXSxpPXt4OjAseToxLHo6Mn07bGV0IHI9MTtjb25zdCBzPSh0LG89MSk9PntpZihyPU1hdGgubWF4KG8sciksdC5wcmltaXRpdmVzKWZvcihsZXQgaT0wO2k8dC5wcmltaXRpdmVzLmxlbmd0aDtpKyspe2NvbnN0IHI9dC5wcmltaXRpdmVzW2ldO2UucHVzaChyLmluZGljZXNbMF0sci5pbmRpY2VzWzFdLHIuaW5kaWNlc1syXSx0LnByaW1pdGl2ZXMubGVuZ3RoLHIuZmFjZU5vcm1hbC54LHIuZmFjZU5vcm1hbC55LHIuZmFjZU5vcm1hbC56LHIubWF0ZXJpYWxJbmRleCksbi5wdXNoKCExKX1lbHNle2NvbnN0IHI9dC5ib3VuZHM7ZS5wdXNoKHIubWluLngsci5taW4ueSxyLm1pbi56LGlbdC5zcGxpdEF4aXNdLHIubWF4Lngsci5tYXgueSxyLm1heC56LG51bGwpO2NvbnN0IGg9ZS5sZW5ndGgtMTtuLnB1c2goITApLHModC5jaGlsZDAsbysxKSxlW2hdPWUubGVuZ3RoLzQscyh0LmNoaWxkMSxvKzEpfX07cyh0KTtjb25zdCBvPW5ldyBBcnJheUJ1ZmZlcig0KmUubGVuZ3RoKSxoPW5ldyBGbG9hdDMyQXJyYXkobyk7Zm9yKGxldCBhPTA7YTxuLmxlbmd0aDthKyspe2xldCB0PTgqYTtuW2FdPyhoW3RdPWVbdF0saFt0KzFdPWVbdCsxXSxoW3QrMl09ZVt0KzJdLGhbdCszXT1lW3QrM10pOihoW3RdPWVbdF0saFt0KzFdPWVbdCsxXSxoW3QrMl09ZVt0KzJdLGhbdCszXT0tZVt0KzNdKSxoW3QrNF09ZVt0KzRdLGhbdCs1XT1lW3QrNV0saFt0KzZdPWVbdCs2XSxoW3QrN109ZVt0KzddfXJldHVybnttYXhEZXB0aDpyLGNvdW50OmUubGVuZ3RoLzQsYnVmZmVyOmh9fShtKGUsaSkpO3NlbGYucG9zdE1lc3NhZ2Uoe2Vycm9yOm51bGwscHJvZ3Jlc3M6bnVsbCxmbGF0dGVuZWRCdmg6dH0pfWNhdGNoKHIpe3NlbGYucG9zdE1lc3NhZ2Uoe2Vycm9yOnIscHJvZ3Jlc3M6bnVsbCxmbGF0dGVuZWRCdmg6bnVsbH0pfX19KCk7Cg==",W=window.Blob&&new Blob([atob(Y)],{type:"text/javascript;charset=utf-8"});function Q(){let e=W&&(window.URL||window.webkitURL).createObjectURL(W);try{return e?new Worker(e):new Worker("data:application/javascript;base64,"+Y,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}class H{build(e,t){if(this.building)throw Error("BVHWorker is building");this.building=!0;let{worker:a}=this;return new Promise((n,i)=>{a.onmessage=e=>{this.building=!1;let{flattenedBvh:r,error:o,progress:l}=e.data;o?i(Error(o)):r?(a.onmessage=null,n(r)):null!=l&&t(l)},a.postMessage({geometry:e})})}constructor(){this.worker=new Q,this.building=!1}}function k(e){let t=Math.round(Math.log2(Math.sqrt(e))),a=2**t,n=Math.ceil(e/a);return{columnsLog:t,columns:a,rows:n,size:n*a}}function Z(e,t,a){let n=k(t.length/a);return v(e,{data:function(e,t){let a=new e.constructor(t);return a.set(e),a}(t,a*n.size),width:n.columns,height:n.rows})}async function O(e,a){let n,{bounces:r,decomposedScene:o,fullscreenQuad:l,materialBuffer:s,mergedMesh:d,optionalExtensions:f,envMapIntensity:c,useBackgroundColor:p,backgroundColor:m,enviromentVisible:L,useWorker:h,loadingCallback:A}=a,_=await async function(e){let{decomposedScene:t,fullscreenQuad:a,gl:n,materialBuffer:i,mergedMesh:r,optionalExtensions:o,useWorker:l,loadingCallback:s}=e,{OES_texture_float_linear:d}=o,{camera:f,meshLightsNum:c,isTextureEnv:p}=t,{geometry:m,materials:L}=r,h=await function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],a=arguments.length>2?arguments[2]:void 0;return t&&window.Worker?(new H).build(e,a):new Promise(t=>{let a=function(e){let t=[],a=[],n={x:0,y:1,z:2},i=1,r=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(i=Math.max(o,i),e.primitives)for(let n=0;n<e.primitives.length;n++){let i=e.primitives[n];t.push(i.indices[0],i.indices[1],i.indices[2],e.primitives.length,i.faceNormal.x,i.faceNormal.y,i.faceNormal.z,i.materialIndex),a.push(!1)}else{let i=e.bounds;t.push(i.min.x,i.min.y,i.min.z,n[e.splitAxis],i.max.x,i.max.y,i.max.z,null);let l=t.length-1;a.push(!0),r(e.child0,o+1),t[l]=t.length/4,r(e.child1,o+1)}};r(e);let o=new ArrayBuffer(4*t.length),l=new Float32Array(o);for(let e=0;e<a.length;e++){let n=8*e;a[e]?(l[n]=t[n],l[n+1]=t[n+1],l[n+2]=t[n+2],l[n+3]=t[n+3]):(l[n]=t[n],l[n+1]=t[n+1],l[n+2]=t[n+2],l[n+3]=-t[n+3]),l[n+4]=t[n+4],l[n+5]=t[n+5],l[n+6]=t[n+6],l[n+7]=t[n+7]}return{maxDepth:i,count:t.length/4,buffer:l}}(function(e,t){let a=function(e){let t=[],a=e.getIndex?e.getIndex().array:e.index.array,n=e.getAttribute?e.getAttribute("position"):e.attributes.position,i=e.getAttribute?e.getAttribute("materialMeshIndex"):e.attributes.materialMeshIndex,r=new b,o=new b,l=new b,s=new b,d=new b;for(let e=0;e<a.length;e+=3){let u=a[e],f=a[e+1],c=a[e+2],p=new y;n.getX?(r.fromBufferAttribute(n,u),o.fromBufferAttribute(n,f),l.fromBufferAttribute(n,c)):(r.x=n.array[u*n.itemSize],r.y=n.array[u*n.itemSize+1],r.z=n.array[u*n.itemSize+2],o.x=n.array[f*n.itemSize],o.y=n.array[f*n.itemSize+1],o.z=n.array[f*n.itemSize+2],l.x=n.array[c*n.itemSize],l.y=n.array[c*n.itemSize+1],l.z=n.array[c*n.itemSize+2]),p.expandByPoint(r),p.expandByPoint(o),p.expandByPoint(l),s.subVectors(l,r),d.subVectors(o,r);let m=(new b).crossVectors(d,s).normalize(),L={bounds:p,center:p.getCenter(new b),indices:[u,f,c],faceNormal:m,materialIndex:i.getX?i.getX(u):i.array[u*i.itemSize]};t.push(L)}return t}(e);return t&&(P=2*a.length-1,U=!0,E=t),function e(t,a,n){var i,r;let o=new y;for(let e=a;e<n;e++)o.union(t[e].bounds);U&&(R+=1,E(R/P));let l=n-a;if(1===l)return B(t.slice(a,n),o);{let s=new y;for(let e=a;e<n;e++)s.expandByPoint(t[e].center);let d=(s.getSize(X),X.x>X.z?X.x>X.y?"x":"y":X.z>X.y?"z":"y"),u=Math.floor((a+n)/2);if(l<=4)!function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Math.floor((a+n)/2);for(let r=a;r<=i;r++){let a=r,i=e[r];for(let o=r+1;o<n;o++)t(i,e[o])||(a=o,i=e[o],N(e,r,a))}}(t,(e,t)=>e.center[d]<t.center[d],a,n,u);else{if(s.max[d]===s.min[d])return B(t.slice(a,n),o);{let e=[];for(let t=0;t<12;t++)e.push({bounds:new y,count:0});for(let i=a;i<n;i++){let a=Math.floor(12*C(s,d,t[i].center));a===e.length&&(a=e.length-1),e[a].count++,e[a].bounds.union(t[i].bounds)}let i=[];for(let t=0;t<e.length-1;t++){let a=new y,n=new y,r=0,l=0;for(let n=0;n<=t;n++)a.union(e[n].bounds),r+=e[n].count;for(let a=t+1;a<e.length;a++)n.union(e[a].bounds),l+=e[a].count;i.push(.1+(r*z(a)+l*z(n))/z(o))}let r=i[0],l=0;for(let e=1;e<i.length;e++)i[e]<r&&(r=i[e],l=e);u=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;for(;a!==n;){for(;t(e[a]);)if(++a===n)return a;do if(a===--n)return a;while(!t(e[n]));N(e,a,n),a++}return a}(t,t=>{let a=Math.floor(e.length*C(s,d,t.center));return a===e.length&&(a=e.length-1),a<=l},a,n)}}return{child0:i=e(t,a,u),child1:r=e(t,u,n),bounds:(new y).union(i.bounds).union(r.bounds),splitAxis:d}}}(a,0,a.length)}(e));t(a)})}(m,l,s.onProgress),v=m.index.count/3,A=x(n,{defines:u({OES_texture_float_linear:d,BVH_COLUMNS:k(h.count).columnsLog,INDEX_COLUMNS:k(v).columnsLog,VERTEX_COLUMNS:k(m.attributes.position.count).columnsLog,STACK_SIZE:h.maxDepth,NUM_LIGHTS:c,CONST_COLOR_ENV:!p},i.defines),fragment:w,vertex:a.vertexShader});return A.setTexture("diffuseMap",i.textures.diffuseMap),A.setTexture("normalMap",i.textures.normalMap),A.setTexture("pbrMap",i.textures.pbrMap),A.setTexture("pbrSGMap",i.textures.pbrSGMap),i.textures.emissiveMap&&A.setTexture("emissiveMap",i.textures.emissiveMap),A.setTexture("positionBuffer",Z(n,m.getAttribute("position").array,3)),A.setTexture("normalBuffer",Z(n,m.getAttribute("normal").array,3)),A.setTexture("uvBuffer",Z(n,m.getAttribute("uv").array,2)),A.setTexture("bvhBuffer",Z(n,h.buffer,4)),A}({bounces:r,decomposedScene:o,fullscreenQuad:l,gl:e,materialBuffer:s,mergedMesh:d,optionalExtensions:f,useWorker:h,loadingCallback:A}),g=[],S=new t.Matrix3;function M(e){g.length=0,e=i(e,2,8);for(let t=1;t<=e;t++)g.push(2,2,2,2),t>=2&&g.push(1);_.setUniform("bounces",e),n&&(n.strataCount=-1)}function F(a){let{OES_texture_float_linear:n}=f,{environment:i,isTextureEnv:r}=a;if(r){let a,r;let o=(i&&i.data&&i.data.isTexture?(r={width:i.data.image.width,height:i.data.image.height,data:i.data.image.data,dataFormat:"float"},i.data.type===t.UnsignedByteType?r.data?r.data=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=e.length/4,n=new Float32Array(3*a),i=[];for(let e=0;e<255;e++)i[e]=t*Math.pow(2,e-128)/255;for(let t=0;t<a;t++){let a=e[4*t],r=e[4*t+1],o=e[4*t+2],l=i[e[4*t+3]];n[3*t]=a*l,n[3*t+1]=r*l,n[3*t+2]=o*l}return n}(r.data,i.intensity):(r.data=function(e){let t=document.createElement("canvas"),a=t.getContext("2d");return t.width=e.width,t.height=e.height,a.drawImage(e,0,0),a.getImageData(0,0,t.width,t.height).data}(i.data.image),r.dataFormat="byte"):i.data.type==t.HalfFloatType?console.error("Please use 'new RGBELoader().setDataType(THREE.FloatType)' to load hdr env map. Half-Float type will loss of precision and have an impression of the effect."):i.data.type!==t.FloatType&&console.error("No support environmentLight's data type: ".concat(i.data.type.toString())),a=r):console.warn("No support environment type: ".concat(i.data)),a),l=o.width,s=o.height;if(o){let t=v(e,{data:o.data,storage:o.dataFormat,minFilter:n?e.LINEAR:e.NEAREST,magFilter:n?e.LINEAR:e.NEAREST,width:o.width,height:o.height});_.setTexture("envMap",t);let{marginalDataArray:a,conditionalDataArray:i,totalSumValue:r}=function(e){let{width:t,height:a,data:n}=e,i=new Float32Array(t*a),r=new Float32Array(t*a),o=new Float32Array(a),l=new Float32Array(a),s=0,d=0;for(let e=0;e<a;e++){let a=0;for(let o=0;o<t;o++){let l=e*t+o,d=.2126*n[4*l+0]+.7152*n[4*l+1]+.0722*n[4*l+2];a+=d,s+=d,i[l]=d,r[l]=a}if(0!==a)for(let n=e*t,o=e*t+t;n<o;n++)i[n]/=a,r[n]/=a;d+=a,o[e]=a,l[e]=d}if(0!==d)for(let e=0,t=o.length;e<t;e++)o[e]/=d,l[e]/=d;let u=new Float32Array(a),f=new Float32Array(t*a);for(let e=0;e<a;e++){let t=V(l,(e+1)/a);u[e]=(t+.5)/a}for(let e=0;e<a;e++)for(let a=0;a<t;a++){let n=e*t+a,i=V(r,(a+1)/t,e*t,t);f[n]=(i+.5)/t}return{marginalDataArray:u,conditionalDataArray:f,totalSumValue:s}}(o);_.setUniform("totalSumValue",r),_.setTexture("envMarginalWeights",v(e,{data:a,storage:"float",channels:1,width:s,height:1})),_.setTexture("envConditionalWeights",v(e,{data:i,storage:"float",channels:1,width:l,height:s})),_.setUniform("useBackgroundColor",Number(p)),m&&m.isColor?_.setUniform("backgroundColor",[m.r,m.g,m.b]):_.setUniform("backgroundColor",[1,1,1])}}else{let e=i.data;e&&e.isColor?_.setUniform("backgroundColor",[e.r,e.g,e.b]):_.setUniform("backgroundColor",[0,0,0])}_.setUniform("envMapIntensity",c),I(L)}function T(e){let{meshLights:t}=e;t&&(_.setUniform("lights.position[0]",t.position),_.setUniform("lights.emission[0]",t.emission),_.setUniform("lights.p1[0]",t.p1),_.setUniform("lights.p2[0]",t.p2),_.setUniform("lights.params[0]",t.params))}function I(e){_.setUniform("enviromentVisible",Number(e))}function G(){_.setUniform("stratifiedSamples[0]",n.next())}return M(r),F(o),T(o),n=D(1,g),{bindTextures:function(){_.bindTextures()},draw:function(){_.useProgram(!1),l.draw()},outputLocs:_.outputLocs,textures:_.textures,setSize:function(e,t){_.setUniform("pixelSize",1/e,1/t)},setCamera:function(e){_.setUniform("camera.transform",e.matrixWorld.elements),_.setUniform("camera.aspect",e.aspect),_.setUniform("camera.fov",.5/Math.tan(.5*Math.PI*e.fov/180)),e.isLensCamera&&(_.setUniform("camera.aperture",e.aperture),_.setUniform("camera.focus",e.focus))},setGBuffers:function(e){let{position:t}=e;_.setTexture("gPosition",t)},setNoise:function(t){_.setTexture("noiseTex",v(e,{data:t,wrapS:e.REPEAT,wrapT:e.REPEAT,storage:"halfFloat"}))},setJitter:function(e,t){_.setUniform("jitter",e,t)},setFrameCount:function(e){_.setUniform("frameCount",e)},setStrataCount:function(e){e>1&&e!==n.strataCount?n=D(e,g):n.restart(),_.setUniform("strataSize",1/e),G()},nextSeed:G,setEnvMapIntensity:function(e){_.setUniform("envMapIntensity",e)},setEnviromentVisible:I,updateBounces:M,updateEnvLight:F,updateMeshLight:T,updateMeshMaterial:function(e){_.setTexture("diffuseMap",e.textures.diffuseMap),_.setTexture("normalMap",e.textures.normalMap),_.setTexture("pbrMap",e.textures.pbrMap),_.setTexture("pbrSGMap",e.textures.pbrSGMap),e.textures.emissiveMap&&_.setTexture("emissiveMap",e.textures.emissiveMap)},dispose:function(){_.dispose()},toggleBackgroundColor:function(e){_.setUniform("useBackgroundColor",Number(e))},setBackgroundColor:function(e){e.isColor?_.setUniform("backgroundColor",[e.r,e.g,e.b]):console.log("illegal color value!")},setEnvRotMatrix:function(e){_.setUniform("envRotMatrix",e.elements),S.copy(e).invert(),_.setUniform("invEnvRotMatrix",S.elements)}}}var K={source:"in vec3 aPosition;in vec3 aNormal;in vec2 aUv;in ivec2 aMaterialMeshIndex;uniform mat4 projView;out vec3 vPosition;out vec3 vNormal;out vec2 vUv;flat out ivec2 vMaterialMeshIndex;void main(){vPosition=aPosition;vNormal=aNormal;vUv=aUv;vMaterialMeshIndex=aMaterialMeshIndex;gl_Position=projView*vec4(aPosition,1);}"},q={source:"\n#define PI 3.14159265359\n#define TWOPI 6.28318530718\n#define INVPI 0.31830988618\n#define INVPI2 0.10132118364\n#define EPS 0.0001\n#define ONE_MINUS_EPS 0.999999\n#define INF 1000000.0\n#define ROUGHNESS_MIN 0.001\nuniform Materials{vec4 colorAndMaterialType[NUM_MATERIALS];vec4 roughnessMetalnessNormalScale[NUM_MATERIALS];vec4 alphaSpecularTintSheenSheenTint[NUM_MATERIALS];vec4 clearcoaRoughnessSubfaceTransmission[NUM_MATERIALS];vec4 iorAtDistanceAnisotropicWorkflow[NUM_MATERIALS];vec4 extinction[NUM_MATERIALS];vec4 specularColorGlossiness[NUM_MATERIALS];\n#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS) || defined(NUM_PBR_MAPS)\nivec4 diffuseNormalRoughnessMetalnessMapIndex[NUM_MATERIALS];\n#endif\n#if defined(NUM_EMISSIVE_MAPS) || defined(NUM_PBR_SG_MAPS)\nivec4 emissiveSpecularGlossinessMapIndex[NUM_MATERIALS];\n#endif\n#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS)\nvec4 diffuseNormalMapSize[NUM_DIFFUSE_NORMAL_MAPS];\n#endif\n#if defined(NUM_PBR_MAPS)\nvec2 pbrMapSize[NUM_PBR_MAPS];\n#else\n#if defined(NUM_PBR_SG_MAPS)\nvec2 pbrMapSize[NUM_PBR_SG_MAPS];\n#else\n#if defined(NUM_EMISSIVE_MAPS)\nvec2 pbrMapSize[NUM_EMISSIVE_MAPS];\n#endif\n#endif\n#endif\n}materials;\n#ifdef NUM_DIFFUSE_MAPS\nuniform mediump sampler2DArray diffuseMap;\n#endif\n#ifdef NUM_NORMAL_MAPS\nuniform mediump sampler2DArray normalMap;\n#endif\n#ifdef NUM_PBR_MAPS\nuniform mediump sampler2DArray pbrMap;\n#endif\n#ifdef NUM_PBR_SG_MAPS\nuniform mediump sampler2DArray pbrSGMap;\n#endif\n#ifdef NUM_EMISSIVE_MAPS\nuniform mediump sampler2DArray emissiveMap;\n#endif\nfloat LGL_w(int materialIndex){return materials.colorAndMaterialType[materialIndex].w;}float LGL_x(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].w;}vec3 LGL_y(int materialIndex,vec2 uv){vec3 emissive=vec3(0.0);\n#ifdef NUM_EMISSIVE_MAPS\nint emissiveMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].x;if(emissiveMapIndex>=0){emissive=texture(emissiveMap,vec3(uv*materials.pbrMapSize[emissiveMapIndex].xy,emissiveMapIndex)).rgb;}\n#endif\nreturn emissive;}vec3 LGL_z(int materialIndex,vec2 uv){vec3 specularColor=materials.specularColorGlossiness[materialIndex].rgb;\n#ifdef NUM_PBR_SG_MAPS\nint specularMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].y;if(specularMapIndex>=0){vec3 LGL_AV=texture(pbrSGMap,vec3(uv*materials.pbrMapSize[specularMapIndex].xy,specularMapIndex)).rgb;LGL_AV=pow(LGL_AV,vec3(2.2));specularColor*=LGL_AV;}\n#endif\nreturn specularColor;}float LGL_AA(int materialIndex,vec2 uv){float glossiness=materials.specularColorGlossiness[materialIndex].a;\n#ifdef NUM_PBR_SG_MAPS\nint glossinessMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].z;if(glossinessMapIndex>=0){float LGL_AW=texture(pbrSGMap,vec3(uv*materials.pbrMapSize[glossinessMapIndex].xy,glossinessMapIndex)).a;glossiness*=LGL_AW;}\n#endif\nreturn glossiness;}float LGL_AB(int materialIndex,vec2 uv){float LGL_BS=LGL_x(materialIndex);float roughness=0.0;if(LGL_BS>0.1){roughness=1.0-LGL_AA(materialIndex,uv);}else{roughness=materials.roughnessMetalnessNormalScale[materialIndex].x;\n#ifdef NUM_PBR_MAPS\nint roughnessMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].z;if(roughnessMapIndex>=0){roughness*=texture(pbrMap,vec3(uv*materials.pbrMapSize[roughnessMapIndex].xy,roughnessMapIndex)).g;}\n#endif\n}return roughness*roughness;}float LGL_AC(const vec3 v){return max(v.x,max(v.y,v.z));}float LGL_AD(const vec3 specularColor){return LGL_AC(specularColor);}vec3 LGL_AE(const vec3 baseColor,float metallic){return baseColor*(1.0-metallic);}float LGL_AF(int materialIndex,vec2 uv){float LGL_BS=LGL_x(materialIndex);float metalness=0.0;if(LGL_BS>0.1){vec3 specularFactor=LGL_z(materialIndex,uv);metalness=LGL_AD(specularFactor);}else{metalness=materials.roughnessMetalnessNormalScale[materialIndex].y;\n#ifdef NUM_PBR_MAPS\nint metalnessMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].w;if(metalnessMapIndex>=0){metalness*=texture(pbrMap,vec3(uv*materials.pbrMapSize[metalnessMapIndex].xy,metalnessMapIndex)).b;}\n#endif\n}return metalness;}vec3 LGL_AG(int materialIndex,vec2 uv){vec3 color=materials.colorAndMaterialType[materialIndex].rgb;\n#ifdef NUM_DIFFUSE_MAPS\nint diffuseMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;if(diffuseMapIndex>=0){color*=texture(diffuseMap,vec3(uv*materials.diffuseNormalMapSize[diffuseMapIndex].xy,diffuseMapIndex)).rgb;}\n#endif\nfloat LGL_BS=LGL_x(materialIndex);if(LGL_BS>0.1){vec3 specularFactor=LGL_z(materialIndex,uv);color=LGL_AE(color,LGL_AD(specularFactor));}return color;}vec3 LGL_AI(int materialIndex,vec2 uv,vec3 normal,vec3 dp1,vec3 dp2,vec2 duv1,vec2 duv2,inout vec3 tangent,inout vec3 bitangent){vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 dpdu=dp2perp*duv1.x+dp1perp*duv2.x;vec3 dpdv=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(dpdu,dpdu),dot(dpdv,dpdv)));dpdu*=invmax;dpdv*=invmax;tangent=normalize(dpdu);bitangent=normalize(dpdv);\n#ifdef NUM_NORMAL_MAPS\nint normalMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].y;if(normalMapIndex>=0){vec3 n=2.0*texture(normalMap,vec3(uv*materials.diffuseNormalMapSize[normalMapIndex].zw,normalMapIndex)).rgb-1.0;n.xy*=materials.roughnessMetalnessNormalScale[materialIndex].zw;mat3 tbn=mat3(dpdu,dpdv,normal);return normalize(tbn*n);}else{return normal;}\n#endif\nreturn normal;}float LGL_AL(int materialIndex,vec2 uv){float alpha=materials.alphaSpecularTintSheenSheenTint[materialIndex].x;\n#ifdef NUM_DIFFUSE_MAPS\nint diffuseMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;if(diffuseMapIndex>=0){alpha*=texture(diffuseMap,vec3(uv*materials.diffuseNormalMapSize[diffuseMapIndex].xy,diffuseMapIndex)).a;}\n#endif\nreturn alpha;}float LGL_AJ(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].y;}float LGL_AK(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].z;}float LGL_AKTint(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].w;}float LGL_AN(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].x;}float LGL_ANRoughness(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].y;}float LGL_AP(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].z;}float LGL_AQ(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].w;}float LGL_AR(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].x;}float LGL_AS(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].y;}float LGL_AT(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].z;}vec3 LGL_AU(int materialIndex){return materials.extinction[materialIndex].rgb;}layout(location=0)out vec4 out_position;layout(location=1)out vec4 out_normal;layout(location=2)out vec4 out_color;in vec3 vPosition;in vec3 vNormal;in vec2 vUv;flat in ivec2 vMaterialMeshIndex;vec3 LGL_BYs(vec3 pos){vec3 fdx=dFdx(pos);vec3 fdy=dFdy(pos);return cross(fdx,fdy);}void main(){int materialIndex=vMaterialMeshIndex.x;int meshIndex=vMaterialMeshIndex.y;vec2 uv=fract(vUv);vec3 color=LGL_AG(materialIndex,uv);float LGL_BT=LGL_w(materialIndex);vec3 normal=normalize(vNormal);vec3 LGL_BY=normalize(LGL_BYs(vPosition));normal*=sign(dot(normal,LGL_BY));\n#ifdef NUM_NORMAL_MAPS\nvec3 dp1=dFdx(vPosition);vec3 dp2=dFdy(vPosition);vec2 duv1=dFdx(vUv);vec2 duv2=dFdy(vUv);vec3 tangent,bitangent;normal=LGL_AI(materialIndex,uv,normal,dp1,dp2,duv1,duv2,tangent,bitangent);\n#endif\nout_position=vec4(vPosition,float(meshIndex)+EPS);out_normal=vec4(normal,LGL_BT);out_color=vec4(color,0.);}"};function j(e,t,a){if(void 0===t)return;let{itemSize:n,array:i}=a;if(e.enableVertexAttribArray(t),e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),i instanceof Float32Array)e.vertexAttribPointer(t,n,e.FLOAT,!1,0,0);else{if(!(i instanceof Int32Array))throw"Unsupported buffer type";e.vertexAttribIPointer(t,n,e.INT,0,0)}}var J={source:"layout(location=0)out vec4 out_color;in vec2 vCoord;uniform sampler2D lightTex;uniform vec2 lightScale;uniform int toneMappingFun;vec3 linear(vec3 color){return color;}vec3 LGL_BH(vec3 color){return clamp(color/(vec3(1.0)+color),vec3(0.0),vec3(1.0));}vec3 LGL_BI(vec3 color){color=max(vec3(0.0),color-0.004);return pow((color*(6.2*color+0.5))/(color*(6.2*color+1.7)+0.06),vec3(2.2));}vec3 LGL_BJ(vec3 color){return clamp((color*(2.51*color+0.03))/(color*(2.43*color+0.59)+0.14),vec3(0.0),vec3(1.0));}void main(){vec4 upscaledLight=texture(lightTex,lightScale*vCoord);vec3 light=upscaledLight.rgb/upscaledLight.a;if(toneMappingFun==0){light=linear(light);}if(toneMappingFun==1){light=LGL_BJ(light);}if(toneMappingFun==2){light=LGL_BH(light);}if(toneMappingFun==3){light=LGL_BI(light);}light=pow(light,vec3(1.0/2.2));if(upscaledLight.a==0.){out_color=vec4(light,0.0);}else{out_color=vec4(light,1.0);}}"};let $={[t.LinearToneMapping]:0,[t.ACESFilmicToneMapping]:1,[t.ReinhardToneMapping]:2,[t.CineonToneMapping]:3};var ee={source:"layout(location=0)out vec4 out_color;uniform sampler2D inputBuffer;uniform vec2 resolution;in vec2 vCoord;\n#define FXAA_PC 1\n#define FXAA_GLSL_100 1\n#define FXAA_QUALITY_PRESET 12\n#define FXAA_GREEN_AS_LUMA 1\n#ifndef FXAA_PC_CONSOLE\n#define FXAA_PC_CONSOLE 0\n#endif\n#ifndef FXAA_GLSL_120\n#define FXAA_GLSL_120 0\n#endif\n#ifndef FXAA_GLSL_130\n#define FXAA_GLSL_130 0\n#endif\n#ifndef FXAA_HLSL_3\n#define FXAA_HLSL_3 0\n#endif\n#ifndef FXAA_HLSL_4\n#define FXAA_HLSL_4 0\n#endif\n#ifndef FXAA_HLSL_5\n#define FXAA_HLSL_5 0\n#endif\n#ifndef FXAA_GREEN_AS_LUMA\n#define FXAA_GREEN_AS_LUMA 0\n#endif\n#ifndef FXAA_EARLY_EXIT\n#define FXAA_EARLY_EXIT 1\n#endif\n#ifndef FXAA_DISCARD\n#define FXAA_DISCARD 0\n#endif\n#ifndef FXAA_FAST_PIXEL_OFFSET\n#ifdef GL_EXT_gpu_shader4\n#define FXAA_FAST_PIXEL_OFFSET 1\n#endif\n#ifdef GL_NV_gpu_shader5\n#define FXAA_FAST_PIXEL_OFFSET 1\n#endif\n#ifdef GL_ARB_gpu_shader5\n#define FXAA_FAST_PIXEL_OFFSET 1\n#endif\n#ifndef FXAA_FAST_PIXEL_OFFSET\n#define FXAA_FAST_PIXEL_OFFSET 0\n#endif\n#endif\n#ifndef FXAA_GATHER4_ALPHA\n#if (FXAA_HLSL_5 == 1)\n#define FXAA_GATHER4_ALPHA 1\n#endif\n#ifdef GL_ARB_gpu_shader5\n#define FXAA_GATHER4_ALPHA 1\n#endif\n#ifdef GL_NV_gpu_shader5\n#define FXAA_GATHER4_ALPHA 1\n#endif\n#ifndef FXAA_GATHER4_ALPHA\n#define FXAA_GATHER4_ALPHA 0\n#endif\n#endif\n/*============================================================================FXAA QUALITY-TUNING KNOBS------------------------------------------------------------------------------NOTE the other tuning knobs are now in the shader function inputs!============================================================================*/\n#ifndef FXAA_QUALITY_PRESET\n#define FXAA_QUALITY_PRESET 12\n#endif\n/*============================================================================FXAA QUALITY-PRESETS============================================================================*//*============================================================================FXAA QUALITY-MEDIUM DITHER PRESETS============================================================================*/\n#if (FXAA_QUALITY_PRESET == 10)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 3.0\n#define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 3.0\n#define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 4.0\n#define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 4.0\n#define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 4.0\n#define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n#endif\n/*============================================================================FXAA QUALITY-LOW DITHER PRESETS============================================================================*/\n#if (FXAA_QUALITY_PRESET == 20)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 2.0\n#define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 3.0\n#define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n#define FXAA_QUALITY_PS 9\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 4.0\n#define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n#define FXAA_QUALITY_PS 10\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 4.0\n#define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n#define FXAA_QUALITY_PS 11\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 4.0\n#define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n/*============================================================================FXAA QUALITY-EXTREME QUALITY============================================================================*/\n#if (FXAA_QUALITY_PRESET == 39)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.0\n#define FXAA_QUALITY_P2 1.0\n#define FXAA_QUALITY_P3 1.0\n#define FXAA_QUALITY_P4 1.0\n#define FXAA_QUALITY_P5 1.5\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n/*============================================================================API PORTING============================================================================*/\n#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n#define FxaaBool bool\n#define FxaaDiscard discard\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 ivec2\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTex sampler2D\n#else\n#define FxaaBool bool\n#define FxaaDiscard clip(-1)\n#define FxaaFloat float\n#define FxaaFloat2 float2\n#define FxaaFloat3 float3\n#define FxaaFloat4 float4\n#define FxaaHalf half\n#define FxaaHalf2 half2\n#define FxaaHalf3 half3\n#define FxaaHalf4 half4\n#define FxaaSat(x) saturate(x)\n#endif\n#if (FXAA_GLSL_100 == 1)\n#define FxaaTexTop(t, p) texture(t, p, 0.0)\n#define FxaaTexOff(t, p, o, r) texture(t, p + (o * r), 0.0)\n#endif\n#if (FXAA_GLSL_120 == 1)\n#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n#if (FXAA_FAST_PIXEL_OFFSET == 1)\n#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n#else\n#define FxaaTexOff(t, p, o, r) textureLod(t, p + (o * r), 0.0)\n#endif\n#if (FXAA_GATHER4_ALPHA == 1)\n#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n#endif\n#endif\n#if (FXAA_GLSL_130 == 1)\n#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n#if (FXAA_GATHER4_ALPHA == 1)\n#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n#endif\n#endif\n#if (FXAA_HLSL_3 == 1)\n#define FxaaInt2 float2\n#define FxaaTex sampler2D\n#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n#endif\n#if (FXAA_HLSL_4 == 1)\n#define FxaaInt2 int2\nstruct FxaaTex{SamplerState smpl;texture tex;};\n#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n#endif\n#if (FXAA_HLSL_5 == 1)\n#define FxaaInt2 int2\nstruct FxaaTex{SamplerState smpl;texture tex;};\n#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n#endif\n/*============================================================================GREEN AS LUMA OPTION SUPPORT FUNCTION============================================================================*/\n#if (FXAA_GREEN_AS_LUMA == 0)\nFxaaFloat FxaaLuma(FxaaFloat4 rgba){return rgba.w;}\n#else\nFxaaFloat FxaaLuma(FxaaFloat4 rgba){return rgba.y;}\n#endif\n/*============================================================================FXAA3 QUALITY-PC============================================================================*/\n#if (FXAA_PC == 1)\nFxaaFloat4 FxaaPixelShader(FxaaFloat2 pos,FxaaFloat4 fxaaConsolePosPos,FxaaTex tex,FxaaTex fxaaConsole360TexExpBiasNegOne,FxaaTex fxaaConsole360TexExpBiasNegTwo,FxaaFloat2 fxaaQualityRcpFrame,FxaaFloat4 fxaaConsoleRcpFrameOpt,FxaaFloat4 fxaaConsoleRcpFrameOpt2,FxaaFloat4 fxaaConsole360RcpFrameOpt2,FxaaFloat fxaaQualitySubpix,FxaaFloat fxaaQualityEdgeThreshold,FxaaFloat fxaaQualityEdgeThresholdMin,FxaaFloat fxaaConsoleEdgeSharpness,FxaaFloat fxaaConsoleEdgeThreshold,FxaaFloat fxaaConsoleEdgeThresholdMin,FxaaFloat4 fxaaConsole360ConstDir){FxaaFloat2 posM;posM.x=pos.x;posM.y=pos.y;\n#if (FXAA_GATHER4_ALPHA == 1)\n#if (FXAA_DISCARD == 0)\nFxaaFloat4 rgbyM=FxaaTexTop(tex,posM);\n#if (FXAA_GREEN_AS_LUMA == 0)\n#define lumaM rgbyM.w\n#else\n#define lumaM rgbyM.y\n#endif\n#endif\n#if (FXAA_GREEN_AS_LUMA == 0)\nFxaaFloat4 luma4A=FxaaTexAlpha4(tex,posM);FxaaFloat4 luma4B=FxaaTexOffAlpha4(tex,posM,FxaaInt2(-1,-1));\n#else\nFxaaFloat4 luma4A=FxaaTexGreen4(tex,posM);FxaaFloat4 luma4B=FxaaTexOffGreen4(tex,posM,FxaaInt2(-1,-1));\n#endif\n#if (FXAA_DISCARD == 1)\n#define lumaM luma4A.w\n#endif\n#define lumaE luma4A.z\n#define lumaS luma4A.x\n#define lumaSE luma4A.y\n#define lumaNW luma4B.w\n#define lumaN luma4B.z\n#define lumaW luma4B.x\n#else\nFxaaFloat4 rgbyM=FxaaTexTop(tex,posM);\n#if (FXAA_GREEN_AS_LUMA == 0)\n#define lumaM rgbyM.w\n#else\n#define lumaM rgbyM.y\n#endif\n#if (FXAA_GLSL_100 == 1)\nFxaaFloat lumaS=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(0.0,1.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaE=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(1.0,0.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaN=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(0.0,-1.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaW=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(-1.0,0.0),fxaaQualityRcpFrame.xy));\n#else\nFxaaFloat lumaS=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,0),fxaaQualityRcpFrame.xy));FxaaFloat lumaN=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,0),fxaaQualityRcpFrame.xy));\n#endif\n#endif\nFxaaFloat maxSM=max(lumaS,lumaM);FxaaFloat minSM=min(lumaS,lumaM);FxaaFloat maxESM=max(lumaE,maxSM);FxaaFloat minESM=min(lumaE,minSM);FxaaFloat maxWN=max(lumaN,lumaW);FxaaFloat minWN=min(lumaN,lumaW);FxaaFloat rangeMax=max(maxWN,maxESM);FxaaFloat rangeMin=min(minWN,minESM);FxaaFloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;FxaaFloat range=rangeMax-rangeMin;FxaaFloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);FxaaBool earlyExit=range<rangeMaxClamped;if(earlyExit)\n#if (FXAA_DISCARD == 1)\nFxaaDiscard;\n#else\nreturn rgbyM;\n#endif\n#if (FXAA_GATHER4_ALPHA == 0)\n#if (FXAA_GLSL_100 == 1)\nFxaaFloat lumaNW=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(-1.0,-1.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaSE=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(1.0,1.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaNE=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(1.0,-1.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaSW=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(-1.0,1.0),fxaaQualityRcpFrame.xy));\n#else\nFxaaFloat lumaNW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaNE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,1),fxaaQualityRcpFrame.xy));\n#endif\n#else\nFxaaFloat lumaNE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,1),fxaaQualityRcpFrame.xy));\n#endif\nFxaaFloat lumaNS=lumaN+lumaS;FxaaFloat lumaWE=lumaW+lumaE;FxaaFloat subpixRcpRange=1.0/range;FxaaFloat subpixNSWE=lumaNS+lumaWE;FxaaFloat edgeHorz1=(-2.0*lumaM)+lumaNS;FxaaFloat edgeVert1=(-2.0*lumaM)+lumaWE;FxaaFloat lumaNESE=lumaNE+lumaSE;FxaaFloat lumaNWNE=lumaNW+lumaNE;FxaaFloat edgeHorz2=(-2.0*lumaE)+lumaNESE;FxaaFloat edgeVert2=(-2.0*lumaN)+lumaNWNE;FxaaFloat lumaNWSW=lumaNW+lumaSW;FxaaFloat lumaSWSE=lumaSW+lumaSE;FxaaFloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);FxaaFloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);FxaaFloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;FxaaFloat edgeVert3=(-2.0*lumaS)+lumaSWSE;FxaaFloat edgeHorz=abs(edgeHorz3)+edgeHorz4;FxaaFloat edgeVert=abs(edgeVert3)+edgeVert4;FxaaFloat subpixNWSWNESE=lumaNWSW+lumaNESE;FxaaFloat lengthSign=fxaaQualityRcpFrame.x;FxaaBool horzSpan=edgeHorz>=edgeVert;FxaaFloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;if(!horzSpan)lumaN=lumaW;if(!horzSpan)lumaS=lumaE;if(horzSpan)lengthSign=fxaaQualityRcpFrame.y;FxaaFloat subpixB=(subpixA*(1.0/12.0))-lumaM;FxaaFloat gradientN=lumaN-lumaM;FxaaFloat gradientS=lumaS-lumaM;FxaaFloat lumaNN=lumaN+lumaM;FxaaFloat lumaSS=lumaS+lumaM;FxaaBool pairN=abs(gradientN)>=abs(gradientS);FxaaFloat gradient=max(abs(gradientN),abs(gradientS));if(pairN)lengthSign=-lengthSign;FxaaFloat subpixC=FxaaSat(abs(subpixB)*subpixRcpRange);FxaaFloat2 posB;posB.x=posM.x;posB.y=posM.y;FxaaFloat2 offNP;offNP.x=(!horzSpan)? 0.0 : fxaaQualityRcpFrame.x;offNP.y=(horzSpan)? 0.0 : fxaaQualityRcpFrame.y;if(!horzSpan)posB.x+=lengthSign*0.5;if(horzSpan)posB.y+=lengthSign*0.5;FxaaFloat2 posN;posN.x=posB.x-offNP.x*FXAA_QUALITY_P0;posN.y=posB.y-offNP.y*FXAA_QUALITY_P0;FxaaFloat2 posP;posP.x=posB.x+offNP.x*FXAA_QUALITY_P0;posP.y=posB.y+offNP.y*FXAA_QUALITY_P0;FxaaFloat subpixD=((-2.0)*subpixC)+3.0;FxaaFloat lumaEndN=FxaaLuma(FxaaTexTop(tex,posN));FxaaFloat subpixE=subpixC*subpixC;FxaaFloat lumaEndP=FxaaLuma(FxaaTexTop(tex,posP));if(!pairN)lumaNN=lumaSS;FxaaFloat gradientScaled=gradient*1.0/4.0;FxaaFloat lumaMM=lumaM-lumaNN*0.5;FxaaFloat subpixF=subpixD*subpixE;FxaaBool lumaMLTZero=lumaMM<0.0;lumaEndN-=lumaNN*0.5;lumaEndP-=lumaNN*0.5;FxaaBool doneN=abs(lumaEndN)>=gradientScaled;FxaaBool doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P1;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P1;FxaaBool doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P1;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P1;if(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P2;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P2;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P2;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P2;\n#if (FXAA_QUALITY_PS > 3)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P3;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P3;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P3;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P3;\n#if (FXAA_QUALITY_PS > 4)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P4;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P4;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P4;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P4;\n#if (FXAA_QUALITY_PS > 5)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P5;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P5;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P5;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P5;\n#if (FXAA_QUALITY_PS > 6)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P6;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P6;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P6;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P6;\n#if (FXAA_QUALITY_PS > 7)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P7;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P7;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P7;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P7;\n#if (FXAA_QUALITY_PS > 8)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P8;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P8;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P8;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P8;\n#if (FXAA_QUALITY_PS > 9)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P9;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P9;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P9;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P9;\n#if (FXAA_QUALITY_PS > 10)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P10;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P10;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P10;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P10;\n#if (FXAA_QUALITY_PS > 11)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P11;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P11;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P11;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P11;\n#if (FXAA_QUALITY_PS > 12)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P12;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P12;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P12;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P12;}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}FxaaFloat dstN=posM.x-posN.x;FxaaFloat dstP=posP.x-posM.x;if(!horzSpan)dstN=posM.y-posN.y;if(!horzSpan)dstP=posP.y-posM.y;FxaaBool goodSpanN=(lumaEndN<0.0)!=lumaMLTZero;FxaaFloat spanLength=(dstP+dstN);FxaaBool goodSpanP=(lumaEndP<0.0)!=lumaMLTZero;FxaaFloat spanLengthRcp=1.0/spanLength;FxaaBool directionN=dstN<dstP;FxaaFloat dst=min(dstN,dstP);FxaaBool goodSpan=directionN ? goodSpanN : goodSpanP;FxaaFloat subpixG=subpixF*subpixF;FxaaFloat pixelOffset=(dst*(-spanLengthRcp))+0.5;FxaaFloat subpixH=subpixG*fxaaQualitySubpix;FxaaFloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;FxaaFloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);if(!horzSpan)posM.x+=pixelOffsetSubpix*lengthSign;if(horzSpan)posM.y+=pixelOffsetSubpix*lengthSign;\n#if (FXAA_DISCARD == 1)\nreturn FxaaTexTop(tex,posM);\n#else\nreturn FxaaFloat4(FxaaTexTop(tex,posM).xyz,lumaM);\n#endif\n}\n#endif\nvoid main(){out_color=FxaaPixelShader(vCoord,vec4(0.0),inputBuffer,inputBuffer,inputBuffer,resolution,vec4(0.0),vec4(0.0),vec4(0.0),0.75,0.166,0.0833,0.0,0.0,0.0,vec4(0.0));out_color.a=texture(inputBuffer,vCoord).a;}"},et={source:"vec4 LGL_Az(sampler2D map,vec2 uv){\n#ifdef OES_texture_float_linear\nreturn texture(map,uv);\n#else\nvec2 size=vec2(textureSize(map,0));vec2 texelSize=1.0/size;uv=uv*size-0.5;vec2 f=fract(uv);uv=floor(uv)+0.5;vec4 s1=texture(map,(uv+vec2(0,0))*texelSize);vec4 s2=texture(map,(uv+vec2(1,0))*texelSize);vec4 s3=texture(map,(uv+vec2(0,1))*texelSize);vec4 s4=texture(map,(uv+vec2(1,1))*texelSize);return mix(mix(s1,s2,f.x),mix(s3,s4,f.x),f.y);\n#endif\n}layout(location=0)out vec4 out_light;layout(location=1)out vec4 out_momentLengthVariance;in vec2 vCoord;uniform mediump sampler2D lightTex;uniform mediump sampler2D positionTex;uniform mediump sampler2D colorTex;uniform mediump sampler2D previousLightTex;uniform mediump sampler2D previousPositionTex;uniform mediump sampler2D previousColorTex;uniform mediump sampler2D previousMomentLengthVarianceTex;uniform mat4 historyCamera;uniform float colorBlendFactor;uniform float momentBlendFactor;uniform float demodulateAlbedo;vec2 LGL_BE(vec3 position){vec4 historyCoord=historyCamera*vec4(position,1.0);return 0.5*historyCoord.xy/historyCoord.w+0.5;}float LGL_BF(sampler2D meshIdTex,vec2 vCoord){return floor(texture(meshIdTex,vCoord).w);}float LGL_BG(float histMeshId,float currentMeshId,ivec2 coord,ivec2 size){if(histMeshId!=currentMeshId){return 0.0;}if(any(greaterThanEqual(coord,size))){return 0.0;}return 1.0;}void main(){vec3 currentPosition=LGL_Az(positionTex,vCoord).xyz;float currentMeshId=LGL_BF(positionTex,vCoord);vec4 accumulatedLight=texture(lightTex,vCoord);vec3 currentLight=accumulatedLight.rgb/accumulatedLight.a;vec2 hCoord=LGL_BE(currentPosition);vec2 hSizef=vec2(textureSize(previousLightTex,0));vec2 hSizeInv=1.0/hSizef;ivec2 hSize=ivec2(hSizef);vec2 hTexelf=hCoord*hSizef-0.5;ivec2 hTexel=ivec2(hTexelf);vec2 f=fract(hTexelf);ivec2 texel[]=ivec2[](hTexel+ivec2(0,0),hTexel+ivec2(1,0),hTexel+ivec2(0,1),hTexel+ivec2(1,1));float weights[]=float[]((1.0-f.x)*(1.0-f.y),f.x*(1.0-f.y),(1.0-f.x)*f.y,f.x*f.y);vec4 historyLight=vec4(0.);;vec2 historyMoment=vec2(0.);float historyLength=0.;float sum=0.;float LGL_Ag=0.2126*currentLight.x+0.7152*currentLight.y+0.0722*currentLight.z;float N=texelFetch(previousMomentLengthVarianceTex,hTexel,0).b;if(N>0.0&&currentMeshId>0.0){for(int i=0;i<4;i++){vec2 gCoord=(vec2(texel[i])+0.5)*hSizeInv;float histMeshId=LGL_BF(previousPositionTex,gCoord);float isValid=LGL_BG(histMeshId,currentMeshId,texel[i],hSize);float weight=isValid*weights[i];historyLight+=weight*texelFetch(previousLightTex,texel[i],0);historyMoment+=weight*texelFetch(previousMomentLengthVarianceTex,texel[i],0).rg;sum+=weight;}if(sum>0.0){historyLight/=sum;historyMoment/=sum;}else{hTexel=ivec2(hTexelf+0.5);for(int x=-1;x<=1;x++){for(int y=-1;y<=1;y++){ivec2 texel=hTexel+ivec2(x,y);vec2 gCoord=(vec2(texel)+0.5)*hSizeInv;float histMeshId=LGL_BF(previousPositionTex,gCoord);float isValid=LGL_BG(histMeshId,currentMeshId,texel,hSize);float weight=isValid;historyLight+=weight*texelFetch(previousLightTex,texel,0);historyMoment+=weight*texelFetch(previousMomentLengthVarianceTex,texel,0).rg;sum+=weight;}}historyLight=sum>0.0 ? historyLight/sum : historyLight;historyMoment=sum>0.0 ? historyMoment/sum : historyMoment;}if(sum>0.0){historyLength=N+1.;float color_alpha_min=colorBlendFactor;float moment_alpha_min=momentBlendFactor;float color_alpha=max(1.0/historyLength,color_alpha_min);float moment_alpha=max(1.0/historyLength,moment_alpha_min);out_light=color_alpha*accumulatedLight+historyLight*(1.-color_alpha);float first_moment=moment_alpha*historyMoment.x+(1.0-moment_alpha)*LGL_Ag;float second_moment=moment_alpha*historyMoment.y+(1.0-moment_alpha)*LGL_Ag*LGL_Ag;float variance=second_moment-first_moment*first_moment;out_momentLengthVariance=vec4(first_moment,second_moment,historyLength,variance);return;}}out_light=accumulatedLight;out_momentLengthVariance=vec4(LGL_Ag,LGL_Ag*LGL_Ag,1.,100.);}"},ea={source:"layout(location=0)out vec4 out_color;in vec2 vCoord;uniform sampler2D lightTex;uniform sampler2D LGL_BEDataTex;uniform sampler2D gPosition;uniform sampler2D gNormal;uniform sampler2D gColor;uniform float colorFactor;uniform float normalFactor;uniform float positionFactor;uniform float stepwidth;uniform int level;uniform float useMomentVariance;uniform float demodulateAlbedo;float LGL_BB(float v){return acos(min(max(v,0.0),1.0));}float LGL_BC(vec2 uv){return max(texture(LGL_BEDataTex,uv).a,0.);}vec4 LGL_BD(){vec4 upscaledLight=texture(lightTex,vCoord);float sampleFrame=upscaledLight.a;float sf2=sampleFrame*sampleFrame;vec3 color=upscaledLight.rgb/upscaledLight.a;vec3 normal=texture(gNormal,vCoord).rgb;vec4 positionAndMeshIndex=texture(gPosition,vCoord);vec3 position=positionAndMeshIndex.rgb;float meshIndex=positionAndMeshIndex.w;bool isBG=meshIndex>0.0 ? false : true;if(isBG){return upscaledLight;}vec2 size=vec2(textureSize(lightTex,0));int kernelRadius=9;float dx=1./size.x;float dy=1./size.y;float kernel[9]=float[9](1.0/16.0,1.0/8.0,1.0/16.0,1.0/8.0,1.0/4.0,1.0/8.0,1.0/16.0,1.0/8.0,1.0/16.0);vec2 offset[9]=vec2[9](vec2(-dx,-dy),vec2(0,-dy),vec2(dx,-dy),vec2(-dx,0),vec2(0,0),vec2(dx,0),vec2(-dx,dy),vec2(0,dy),vec2(dx,dy));vec3 colorSum=vec3(0.);float weightSum=0.;float var;float varSum;float varSumWeight;if(useMomentVariance>0.){for(int i=0;i<kernelRadius;i++){vec2 uv=vCoord+offset[i];if(uv.x<0.0||uv.x>1.0||uv.y<0.0||uv.y>1.0){continue;}vec4 positionAndMeshIndex=texture(gPosition,uv);float meshIndex=positionAndMeshIndex.w;bool isBG=meshIndex>0.0 ? false : true;if(isBG){continue;}varSum+=kernel[i]*LGL_BC(uv);varSumWeight+=kernel[i];}if(varSumWeight>0.0){var=max(varSum/varSumWeight,0.0);}else{var=max(LGL_BC(vCoord),0.0);}}for(int i=0;i<kernelRadius;i++){vec2 uv=vCoord+offset[i]*float(stepwidth);if(uv.x<0.0||uv.x>1.0||uv.y<0.0||uv.y>1.0){continue;}vec4 positionAndMeshIndex=texture(gPosition,uv);float meshIndex=positionAndMeshIndex.w;bool isBG=meshIndex>0.0 ? false : true;if(isBG){continue;}vec4 upscaledLight=texture(lightTex,uv);vec3 kernelColor=upscaledLight.rgb/upscaledLight.a;float Dc=distance(color,kernelColor);float Wc;if(useMomentVariance>0.){Wc=min(exp(-Dc/((1.+sqrt(var))*colorFactor+1e-6)),1.0);}else{Wc=min(exp(-Dc/(colorFactor+1e-6)),1.0);}vec3 kernelNormal=texture(gNormal,uv).rgb;float Dn=distance(normal,kernelNormal);float dist2=max(Dn/(stepwidth*stepwidth+1e-6),0.0);float Wn=min(exp(-(dist2)/normalFactor+1e-6),1.0);vec3 kernelPosition=positionAndMeshIndex.rgb;float Dp=distance(position,kernelPosition);float Wp=min(exp(-Dp/(positionFactor+1e-6)),1.0);float weight=Wc*Wn*Wp*kernel[i];weightSum+=weight;colorSum+=kernelColor*weight;}colorSum=colorSum/weightSum;return vec4(colorSum*sampleFrame,sampleFrame);}void main(){vec4 light=LGL_BD();out_color=light;}"};async function en(e){let a,n,o,l,u,f,{gl:c,optionalExtensions:p,scene:m,camera:L,toneMapping:A,bounces:_,envMapIntensity:S,useBackgroundColor:M,backgroundColor:F,enviromentVisible:T,movingDownsampling:I,enableDenoise:b,enableTemporalDenoise:y,enableSpatialDenoise:N,useWorker:P,loadingCallback:R}=e,E=new t.PerspectiveCamera,U=function(e){let a,n,r,o,l=new t.Vector2(1,1),s=function(e){let t=e.getParameter(e.MAX_RENDERBUFFER_SIZE);return t<=8192?8e4:16384===t?15e4:t>=32768?4e5:void 0}(e);function d(){let e=a/n;r=Math.round(i(Math.sqrt(s*e),1,a)),o=Math.round(i(r/e,1,n)),l.set(r/a,o/n)}return{adjustSize:function(e){e&&(s+=600*(20-e),s=i(s,8192,a*n),d())},setSize:function(e,t){a=e,n=t,d()},scale:l,get width(){return r},get height(){return o}}}(c),X=function(e){let t,a,n,r,o,l=-1,s=1,d=!1,u=0,f=0,c=function(e){let t=e.getParameter(e.MAX_RENDERBUFFER_SIZE);return t<=8192?2e5:16384===t?4e5:t>=32768?6e5:void 0}(e);function p(){let e=u/f;a=d?Math.ceil((t=Math.ceil(u/Math.sqrt(s)))/e):Math.ceil((t=Math.ceil(u/Math.round(u/Math.sqrt(c*e))))/e),s=(n=Math.ceil(u/t))*(r=Math.ceil(f/a))}function m(){l=-1,o=NaN}return{nextTile:function(e){l++,o+=e,l%s==0&&(o&&(function(){let e=21-o/s;c+=5e3*Math.sign(e)*Math.sqrt(Math.abs(e)),c=i(c,8192,u*f)}(),p()),o=0,l=0);let d=l===s-1,m=l%n,L=Math.floor(l/n)%r;return{x:m*t,y:L*a,tileWidth:t,tileHeight:a,isFirstTile:0===l,isLastTile:d}},reset:m,setSize:function(e,t){u=e,f=t,m(),p()},setTileSlicesNumber:function(e){e?(d=!0,s=e):d=!1}}}(c),B=g(m,L),C=function(e,a){let n=0,i=0,r=[];for(let o of e){if(!o.visible)continue;let e=o.geometry.isBufferGeometry?function(e,a){let n=new t.BufferGeometry;for(let t of a){let a=e.getAttribute(t);a&&("function"!=typeof n.setAttribute&&(n.setAttribute=n.addAttribute),n.setAttribute(t,a.clone()))}let i=e.getIndex();return i&&n.setIndex(i),n}(o.geometry,["position","normal","uv"]):(new t.BufferGeometry).fromGeometry(o.geometry);e.getIndex()||function(e){let a=e.getAttribute("position");if(!a)return void console.warn("No position attribute");let n=new Uint32Array(a.count);for(let e=0;e<n.length;e++)n[e]=e;e.setIndex(new t.BufferAttribute(n,1,!1))}(e),e.applyMatrix4?e.applyMatrix4(o.matrixWorld):e.applyMatrix(o.matrixWorld),e.getAttribute("normal")?e.normalizeNormals():e.computeVertexNormals(),n+=e.getAttribute("position").count,i+=e.getIndex().count;let l=o.material,s=a.get(l);r.push({geometry:e,materialIndex:s})}return{geometry:function(e,a,n){let i=new t.BufferAttribute(new Float32Array(3*a),3,!1),r=new t.BufferAttribute(new Float32Array(3*a),3,!1),o=new t.BufferAttribute(new Float32Array(2*a),2,!1),l=new t.BufferAttribute(new Int32Array(2*a),2,!1),s=new t.BufferAttribute(new Uint32Array(n),1,!1),d=new t.BufferGeometry;"function"!=typeof d.setAttribute&&(d.setAttribute=d.addAttribute),d.setAttribute("position",i),d.setAttribute("normal",r),d.setAttribute("uv",o),d.setAttribute("materialMeshIndex",l),d.setIndex(s);let u=0,f=0,c=1;for(let{geometry:t,materialIndex:a}of e){let e=t.getAttribute("position").count;["position","normal","uv"].forEach(e=>{let a=t.getAttribute(e);a&&d.getAttribute(e).array.set(a.array,u*a.itemSize)});let n=t.getIndex();for(let e=0;e<n.count;e++)s.setX(f+e,u+n.getX(e));for(let t=0;t<e;t++)l.setXY(u+t,a,c);u+=e,f+=n.count,c++}return d}(r,n,i)}}(B.meshes,B.materialIndexMap),z=G(c,B.materials),V=function(e){let t=e.createVertexArray();return e.bindVertexArray(t),e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.bindVertexArray(null),{draw:function(){e.bindVertexArray(t),e.drawArrays(e.TRIANGLES,0,6)},vertexShader:h(e,{vertex:d})}}(c),w=function(e,a){let{materialBuffer:n,mergedMesh:i}=a,r=x(e,{defines:n.defines,vertex:K,fragment:q});r.setTexture("diffuseMap",n.textures.diffuseMap),r.setTexture("normalMap",n.textures.normalMap);let o=i.geometry,l=o.getIndex().count,s=e.createVertexArray();e.bindVertexArray(s),j(e,r.attribLocs.aPosition,o.getAttribute("position")),j(e,r.attribLocs.aNormal,o.getAttribute("normal")),j(e,r.attribLocs.aUv,o.getAttribute("uv")),j(e,r.attribLocs.aMaterialMeshIndex,o.getAttribute("materialMeshIndex")),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o.getIndex().array,e.STATIC_DRAW),e.bindVertexArray(null);let d,u=0,f=0,c=new t.Matrix4;return{draw:function(){c.copy(d.projectionMatrix),c.elements[8]+=2*u,c.elements[9]+=2*f,c.multiply(d.matrixWorldInverse),r.setUniform("projView",c.elements),e.bindVertexArray(s),r.useProgram(),e.enable(e.DEPTH_TEST),e.drawElements(e.TRIANGLES,l,e.UNSIGNED_INT,0),e.disable(e.DEPTH_TEST)},outputLocs:r.outputLocs,setCamera:function(e){d=e},setJitter:function(e,t){u=e,f=t},dispose:function(){r.dispose()}}}(c,{materialBuffer:z,mergedMesh:C}),D=function(e,a){let n;let{fullscreenQuad:i,toneMapping:r}=a,o={gl:e,vertex:i.vertexShader,fragment:J},l=x(e,o);l.setUniform("toneMappingFun",$[r]);let d=new t.Vector2(1,1);return{draw:function(t,a){let{light:r,lightScale:o}=t;if(o=o||d,l.setTexture("lightTex",r),l.setUniform("lightScale",o.x,o.y),a)return n.bind(),e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),l.useProgram(),i.draw(),n.unbind(),n;l.useProgram(),i.draw()},setToneMapping:function(e){l.setUniform("toneMappingFun",$[e])},setSize:function(t,a){n=s(e,{color:{0:v(e,{width:t,height:a,storage:"byte",magFilter:e.LINEAR,minFilter:e.LINEAR})}})},dispose:function(){l.dispose()}}}(c,{fullscreenQuad:V,toneMapping:A}),Y=function(e,t){let{fullscreenQuad:a}=t,n=x(e,{gl:e,vertex:a.vertexShader,fragment:ee});return{draw:function(e){let{light:t}=e;n.setTexture("inputBuffer",t),n.useProgram(),a.draw()},setSize:function(e,t){n.setUniform("resolution",1/e,1/t)},dispose:function(){n.dispose()}}}(c,{fullscreenQuad:V}),W=function(e,a){let{fullscreenQuad:n,maxReprojectedSamples:i}=a,r=x(e,{defines:{MAX_SAMPLES:i.toFixed(1)},vertex:n.vertexShader,fragment:et}),o=new t.Matrix4,l=.2,s=.2;return{draw:function(e){let{light:t,position:a,color:i,previousColor:o,previousLight:d,previousPosition:u,previousMomentLengthVariance:f}=e;r.setTexture("lightTex",t),r.setTexture("positionTex",a),r.setTexture("colorTex",i),r.setTexture("previousLightTex",d),r.setTexture("previousPositionTex",u),r.setTexture("previousColorTex",o),r.setTexture("previousMomentLengthVarianceTex",f),r.setUniform("colorBlendFactor",l),r.setUniform("momentBlendFactor",s),r.useProgram(),n.draw()},setJitter:function(e,t){r.setUniform("jitter",e,t)},setPreviousCamera:function(e){o.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),r.setUniform("historyCamera",o.elements)},setDenoiseColorBlendFactor:function(e){l=e},setDenoiseMomentBlendFactor:function(e){s=e},setDemodulateAlbedo:function(e){r.setUniform("demodulateAlbedo",e)},getDenoiseFactors:()=>({colorBlendFactor:l,momentBlendFactor:s}),dispose:function(){r.dispose()}}}(c,{fullscreenQuad:V,maxReprojectedSamples:20}),Q=function(e,t){let a,n;let{fullscreenQuad:i}=t,r={gl:e,vertex:i.vertexShader,fragment:ea},o=x(e,r),l=.5,d=.02,u=.35;return{draw:function(t){let{light:r,reprojectData:s}=t;for(let t=0;t<3;t++)o.setUniform("level",t),o.setUniform("colorFactor",1/(1<<t)*l),o.setUniform("normalFactor",1/(1<<t)*d),o.setUniform("positionFactor",1/(1<<t)*u),o.setUniform("stepwidth",(1<<t+1)-1),0===t?o.setTexture("lightTex",r):o.setTexture("lightTex",a.color[0]),s?(o.setUniform("useMomentVariance",1),o.setTexture("reprojectDataTex",s)):(o.setUniform("useMomentVariance",0),o.setTexture("reprojectDataTex",null)),n.bind(),e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),o.useProgram(),i.draw(),n.unbind(),function(){let e=n;n=a,a=e}();return a},setGBuffers:function(e){let{position:t,normal:a,color:n}=e;o.setTexture("gPosition",t),o.setTexture("gNormal",a),o.setTexture("gColor",n)},setColorFactor:function(e){l=e},setNormalFactor:function(e){d=e},setPositionFactor:function(e){u=e},setDemodulateAlbedo:function(e){o.setUniform("demodulateAlbedo",e)},getDenoiseFactors:()=>({colorFactor:l,normalFactor:d,positionFactor:u}),setSize:function(t,i){!function(t,i){let r=()=>s(e,{color:{0:v(e,{width:t,height:i,storage:"float",magFilter:e.NEAREST,minFilter:e.NEAREST})}});a=r(),n=r()}(t,i)},dispose:function(){o.dispose()}}}(c,{fullscreenQuad:V,toneMapping:A}),H,k,Z=!1,en=0,ei=!0,er=!1,eo=()=>{},el=await O(c,{bounces:_,decomposedScene:B,fullscreenQuad:V,materialBuffer:z,mergedMesh:C,optionalExtensions:p,scene:m,envMapIntensity:S,useBackgroundColor:M,backgroundColor:F,enviromentVisible:T,useWorker:P,loadingCallback:R}),es=new Image;es.src="data:image/png;base64,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",es.onload=()=>{el.setNoise(es),Z=!0};let ed=!!p.OES_texture_float_linear;function eu(){let e=u;u=f,f=e}function ef(){let e=a;a=n,n=e}function ec(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=Number(e&&y&&N);W.setDemodulateAlbedo(t),Q.setDemodulateAlbedo(t)}ec(!1);let ep=0,em=0;function eL(e,t){el.setCamera(e),w.setCamera(e),W.setPreviousCamera(t),t.copy(e)}function eh(e,t){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2];el.setSize(e,t),el.setFrameCount(en),b||el.setJitter(a?(Math.random()-.5)/e:0,a?(Math.random()-.5)/t:0),0===en?el.setStrataCount(1):4===en?el.setStrataCount(6):el.nextSeed()}function ex(e){e.bind(),c.clear(c.COLOR_BUFFER_BIT),e.unbind()}function ev(e,t,a){e.bind(),c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ONE,c.ONE),c.enable(c.BLEND),c.viewport(0,0,t,a),el.draw(),c.disable(c.BLEND),e.unbind()}function eA(e,t){c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight),D.draw({light:e,lightScale:t}),l=e}function e_(e){let t=D.draw({light:e},!0);Y.draw({light:t.color[0]})}function eg(){a.bind(),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),c.viewport(0,0,ep,em),w.draw(),a.unbind(),Q.setGBuffers({position:a.color[0],normal:a.color[1],color:a.color[2]})}function eS(){y&&(u.bind(),c.viewport(0,0,ep,em),W.draw({light:o.color[0],position:a.color[0],color:a.color[2],previousLight:l,previousPosition:n.color[0],previousColor:n.color[2],previousMomentLengthVariance:f.color[1]}),u.unbind(),N||(e_(u.color[0]),l=u.color[0])),N&&(y?(e_(Q.draw({light:u.color[0],reprojectData:f.color[1]}).color[0]),l=u.color[0]):(e_(Q.draw({light:o.color[0],reprojectData:null}).color[0]),l=o.color[0]))}function eM(){var e,t,a;eh(U.width,U.height,!1),el.bindTextures(),e=o,t=U.width,a=U.height,e.bind(),c.viewport(0,0,t,a),el.draw(),e.unbind(),eA(o.color[0],U.scale),ex(o)}return{draw:function(e){Z&&(!r(e,E)||er?(er=!1,eL(e,E),ei?ei=!1:eM(),en=0,X.reset()):function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{x:a,y:n,tileWidth:i,tileHeight:r,isFirstTile:s,isLastTile:d}=X.nextTile(k);s&&(0===en&&(ex(o),W.setPreviousCamera(E)),eh(ep,em,!0),b&&(y||N)&&eg(),el.bindTextures()),e=o,c.scissor(a,n,i,r),c.enable(c.SCISSOR_TEST),ev(e,ep,em),c.disable(c.SCISSOR_TEST),t&&!d&&eA(o.color[0]),d&&(b&&(y||N)?(l=o.color[0],eS(),l=o.color[0]):eA(o.color[0]),eu(),ef(),en++,eo())}())},fullDraw:function(e){if(Z){if(ef(),eu(),!r(e,E)||er){if(er=!1,I)return eL(e,E),en=0,void eM();en=0,ex(o)}else en++;eL(e,E),eh(ep,em,!0),b&&(y||N)&&eg(),el.bindTextures(),ev(o,ep,em),b&&(y||N)?eS():eA(o.color[0]),eo()}},setSize:function(e,t){ep=e,em=t,X.setSize(e,t),U.setSize(e,t),function(e,t){let i=ed?"float":"halfFloat";l=(o=s(c,{color:{0:v(c,{width:e,height:t,storage:i,magFilter:c.LINEAR,minFilter:c.LINEAR})}})).color[0];let r=()=>s(c,{color:{0:v(c,{width:e,height:t,storage:i,magFilter:c.LINEAR,minFilter:c.LINEAR}),1:v(c,{width:e,height:t,storage:i,channels:4,magFilter:c.LINEAR,minFilter:c.LINEAR})}});u=r(),f=r();let d=v(c,{width:e,height:t,storage:"halfFloat"}),p=v(c,{width:e,height:t,storage:"float"}),m=function(e,t,a){let n=e.createRenderbuffer(),i=e.RENDERBUFFER;return e.bindRenderbuffer(i,n),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT24,t,a),e.bindRenderbuffer(i,null),{target:i,texture:n}}(c,e,t),L=()=>s(c,{color:{0:v(c,{width:e,height:t,storage:"float"}),1:d,2:p},depth:m});a=L(),n=L()}(e,t),Q.setSize(e,t),D.setSize(e,t),Y.setSize(e,t),ei=!0},time:function(e){k=e-H,H=e},reset:function(){er=!0,en=0,X.reset(),ex(o),ex(u),ex(f)},getTotalSamplesRendered:()=>en,setfullSampleCallbackCallBack(e){eo=e},setTileSlicesNumber:function(e){X.setTileSlicesNumber(e)},updateBounces:function(e){el.updateBounces(e)},updateEnvLight:function(){let e=g(m,L);el.updateEnvLight(e)},updateMeshLight:function(){let e=g(m,L);el.updateMeshLight(e)},setEnvMapIntensity:function(e){el.setEnvMapIntensity(e)},setEnviromentVisible:function(e){el.setEnviromentVisible(e)},setToneMapping:function(e){D.setToneMapping(e)},setMovingDownsampling:function(e){I=e},setDenoiseStatus:function(e){b=e},setTemporalDenoiseStatus:function(e){y=e,ec()},setDenoiseColorBlendFactor:function(e){W.setDenoiseColorBlendFactor(e)},setDenoiseMomentBlendFactor:function(e){W.setDenoiseMomentBlendFactor(e)},setSpatialDenoiseStatus:function(e){N=e,ec()},setDenoiseColorFactor:function(e){Q.setColorFactor(e)},setDenoiseNormalFactor:function(e){Q.setNormalFactor(e)},setDenoisePositionFactor:function(e){Q.setPositionFactor(e)},getDenoiseFactors:function(){return Object.assign(Q.getDenoiseFactors(),W.getDenoiseFactors())},setDemodulateAlbedo:ec,updateMeshMaterial:function(){let e=g(m,L),t=G(c,e.materials);el.updateMeshMaterial(t)},dispose:function(){el.dispose(),w.dispose(),D.dispose(),Y.dispose(),W.dispose(),Q.dispose(),a.dispose(),n.dispose(),o.dispose(),u.dispose(),f.dispose(),z.dispose()},setEnvRotMatrix:function(e){el.setEnvRotMatrix(e)},toggleBackgroundColor:function(e){el.toggleBackgroundColor(e)},setBackgroundColor:function(e){el.setBackgroundColor(e)},checkIsCameraMove:function(e){return r(e,E)}}}class ei extends t.Light{copy(e){super.copy(e),this.width=e.width,this.height=e.height}constructor(e,a,n=10,i=10){super(e,a),this.type="RectAreaLight",this.width=n,this.height=i,this.target=new t.Vector3}}class er extends t.Light{constructor(e,t,a,n){super(e,t),this.type="QuadLight",this.v1=a,this.v2=n}}class eo extends t.Light{constructor(e,t,a=1){super(e,t),this.type="SphereAreaLight",this.radius=a}}class el extends t.Light{constructor(e,t){super(e,t),this.type="PointLight"}}class es extends t.Light{constructor(e,a){super(e,a),this.type="DirectionalLight",this.target=new t.Vector3}}e.DirectionalLight=es,e.DisneyMaterial=_,e.LGLTracerRenderer=class{static isSupported(){let e=document.createElement("canvas").getContext("webgl2",{failIfMajorPerformanceCaveat:!0});if(!e)return console.error("webgl2 no supported!"),!1;let t=n(e,o);for(let e in t)if(!t[e])return!1;return!0}async buildScene(e,t){let{gl:a,optionalExtensions:n,bounces:i,size:r,toneMapping:o,envMapIntensity:l,enviromentVisible:s,movingDownsampling:d,enableDenoise:u,enableTemporalDenoise:f,enableSpatialDenoise:c,useWorker:p,tileSlicesNum:m,loadingCallback:L,useBackgroundColor:h,backgroundColor:x}=this;this._isBuilding=!0,e.updateMatrixWorld(),this.pipeline=await en({gl:a,optionalExtensions:n,scene:e,camera:t,toneMapping:o,bounces:i,envMapIntensity:l,useBackgroundColor:h,backgroundColor:x,enviromentVisible:s,movingDownsampling:d,enableDenoise:u,enableTemporalDenoise:f,enableSpatialDenoise:c,useWorker:p,loadingCallback:L}),this.setSize(r.width,r.height),this.setTileSlicesNumber(m),this.pipeline.setEnvRotMatrix(this._envRotMatrix),this.pipeline.setBackgroundColor(this.backgroundColor),this._isBuilding=!1,L&&L.onComplete&&"function"==typeof L.onComplete&&L.onComplete("Complete!")}set bounces(e){this._bounces=e,this.pipeline&&this.pipeline.updateBounces(e)}get bounces(){return this._bounces}set envMapIntensity(e){e=Number(e),this._envMapIntensity=e,this.pipeline&&this.pipeline.setEnvMapIntensity(e)}get envMapIntensity(){return this._envMapIntensity}set useBackgroundColor(e){this._useBackgroundColor=e,this.pipeline&&this.pipeline.toggleBackgroundColor(e)}get useBackgroundColor(){return this._useBackgroundColor}set toneMapping(e){this._toneMapping=e,this.pipeline&&this.pipeline.setToneMapping(e)}get toneMapping(){return this._toneMapping}set enviromentVisible(e){this._enviromentVisible=e,this.pipeline&&this.pipeline.setEnviromentVisible(e)}get enviromentVisible(){return this._enviromentVisible}set movingDownsampling(e){e=!!e,this._movingDownsampling=e,this.pipeline&&this.pipeline.setMovingDownsampling(e)}get movingDownsampling(){return this._movingDownsampling}set enableDenoise(e){e=!!e,this._enableDenoise=e,this.pipeline&&this.pipeline.setDenoiseStatus(e)}get enableDenoise(){return this._enableDenoise}set enableTemporalDenoise(e){e=!!e,this._enableTemporalDenoise=e,this.pipeline&&this.pipeline.setTemporalDenoiseStatus(e)}get enableTemporalDenoise(){return this._enableTemporalDenoise}set enableSpatialDenoise(e){e=!!e,this._enableSpatialDenoise=e,this.pipeline&&this.pipeline.setSpatialDenoiseStatus(e)}get enableSpatialDenoise(){return this._enableSpatialDenoise}set fullSampleCallback(e){e&&"function"==typeof e&&(this._fullSampleCallback=e,this.pipeline&&this.pipeline.setfullSampleCallbackCallBack(e))}get fullSampleCallback(){return this._fullSampleCallback}get sampleCount(){return this.pipeline?this.pipeline.getTotalSamplesRendered():0}setEnvRotation(e){this.envRotation=e,this._envRotMatrix.setFromMatrix4((new t.Matrix4).makeRotationY(e*Math.PI/180)),this.pipeline&&this.pipeline.setEnvRotMatrix(this._envRotMatrix)}updateBackgroundColor(e){this.backgroundColor.set(e),this.pipeline&&this.pipeline.setBackgroundColor(this.backgroundColor)}getContext(){return this.gl}setTileSlicesNumber(e){e=Number(e),this.pipeline&&this.pipeline.setTileSlicesNumber(e)}updateMeshMaterial(){this.pipeline&&this.pipeline.updateMeshMaterial()}updateEnvLight(){this.pipeline&&this.pipeline.updateEnvLight()}updateMeshLight(){this.pipeline&&this.pipeline.updateMeshLight()}setDenoiseColorBlendFactor(e){this.pipeline&&this.pipeline.setDenoiseColorBlendFactor(e)}setDenoiseMomentBlendFactor(e){this.pipeline&&this.pipeline.setDenoiseMomentBlendFactor(e)}setDenoiseColorFactor(e){this.pipeline&&this.pipeline.setDenoiseColorFactor(e)}setDenoiseNormalFactor(e){this.pipeline&&this.pipeline.setDenoiseNormalFactor(e)}setDenoisePositionFactor(e){this.pipeline&&this.pipeline.setDenoisePositionFactor(e)}setDemodulateAlbedo(e){this.pipeline&&this.pipeline.setDemodulateAlbedo(e),this.needsUpdate=!0}getDenoiseFactors(){if(this.pipeline)return this.pipeline.getDenoiseFactors()}setSize(e,t){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{size:n,canvas:i,pipeline:r,pixelRatio:o}=this;n.set(e,t),i.width=n.width*o,i.height=n.height*o,a&&(i.style.width="".concat(n.width,"px"),i.style.height="".concat(n.height,"px")),this.pipeline&&r.setSize(n.width*o,n.height*o)}getSize(e){let{size:a}=this;return e||(e=new t.Vector2),e.copy(a)}setPixelRatio(e){let{size:t}=this;e&&(this.pixelRatio=e,this.setSize(t.width,t.height,!1))}getPixelRatio(){return this.pixelRatio}getTotalSamples(){if(this.pipeline)return this.pipeline.getTotalSamplesRendered()}restartTimer(){this.isValidTime=NaN}render(e,t){if(this._isBuilding)return;if(!this.pipeline)return void console.error("Pipeline not initialized, The scene needs to be built first!");if(this.needsUpdate&&(this.needsUpdate=!1,this.pipeline.reset()),0!=this.targetSampleCount&&this.pipeline.getTotalSamplesRendered()>=this.targetSampleCount&&this.pipeline.checkIsCameraMove(t)&&!this.forceUpdateOneFullSample)return;this.currentTime=performance.now(),this.pipeline.time(this.isValidTime*this.currentTime),this.isValidTime=1,this.currentTime=NaN;let a=this.pipeline.getTotalSamplesRendered();t.updateMatrixWorld(),this.useTileRender?this.pipeline.draw(t):this.pipeline.fullDraw(t),a!=this.pipeline.getTotalSamplesRendered()&&this.forceUpdateOneFullSample&&(this.forceUpdateOneFullSample=!1)}dispose(){this.pipeline&&this.pipeline.dispose(),this.pipeline=null}constructor(e={}){if(this.canvas=e.canvas||document.createElement("canvas"),this.gl=e.context||this.canvas.getContext("webgl2",{alpha:e.canvasAlpha||!1,depth:!1,stencil:!1,antialias:e.antialias||!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),!this.gl)throw Error("webgl2 no supported!");n(this.gl,o),this.optionalExtensions=n(this.gl,l),this._bounces=2,this._envMapIntensity=1,this._useBackgroundColor=!1,this._envRotMatrix=new t.Matrix3,this.envRotation=0,this.backgroundColor=new t.Color(16777215),this._toneMapping=t.LinearToneMapping,this._movingDownsampling=!1,this._enableDenoise=!1,this._enableTemporalDenoise=!0,this._enableSpatialDenoise=!0,this._fullSampleCallback=null,this._enviromentVisible=!0,this.useTileRender=!1,this.renderWhenOffFocus=!0,this.useWorker=e.useWorker||!0,this.tileSlicesNum=0,this.loadingCallback=e.loadingCallback||{onProgress:()=>{},onComplete:()=>{}},this._isBuilding=!0,this.needsUpdate=!1,this.size=new t.Vector2(this.canvas.width,this.canvas.height),this.pixelRatio=1,this.pipeline=null,this.currentTime=NaN,this.isValidTime=1,this.lastFocus=!1,this.domElement=this.canvas,this.targetSampleCount=0,this.forceUpdateOneFullSample=!1}},e.PointLight=el,e.QuadLight=er,e.RectAreaLight=ei,e.SphereAreaLight=eo,Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module"}(t,a(5340))}}]);