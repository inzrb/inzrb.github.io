(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8390],{3936:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/labs/weapon_hud",function(){return t(143)}])},6687:function(e,a,t){"use strict";var s=t(1527),i=t(959),r=t(5542),n=t(3387);a.Z=e=>{let a,{size:t,scale:o}=e,l=(0,i.useRef)();return(0,r.A)((e,a)=>{l.current.rotation.x=l.current.rotation.y+=a*Math.PI}),null!==t?a=t:o&&(console.log(o),a=o.xy.min()),(0,s.jsx)(n.xu,{ref:l,scale:a,children:(0,s.jsx)("meshNormalMaterial",{})})}},143:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return M}});var s=t(1527),i=t(959),r=t(1193),n=t(4799),o=t(6468),l=t(302),c=t(83),m=t(5542),u=t(9718),d=t(670),p=t(853);let h=()=>({damage:0,fireRate:0,range:0,accuracy:0,recoilControl:0,mobility:0,handling:0}),_=(0,p.sj)({sum:h(),update:h(),temp:h(),tempIndex:-1,currIndex:-1,showPlugin:!1,currentType:"",preview:!1,selected:[-1,-1,-1,-1,-1,-1]});var g=t(1021);let x=[{id:0,name:"消声器",type:"muzzle",position:[-7,3.4,0]},{id:1,name:"握把",type:"underbarrel",position:[-5.5,.7,0]},{id:2,name:"弹夹",type:"ammo",position:[-2.5,-.2,0]},{id:3,name:"镭射",type:"laser",position:[-2.5,3.8,0]},{id:4,name:"瞄准镜",type:"optic",position:[2,3.8,0]},{id:5,name:"枪托",type:"grip",position:[4.5,-.2,0]}],y=[{id:0,name:"damage",text:"伤害",value:75},{id:1,name:"fireRate",text:"射速",value:65},{id:2,name:"range",text:"射程",value:60},{id:3,name:"accuracy",text:"准确度",value:67},{id:4,name:"recoilControl",text:"后坐强度",value:73},{id:5,name:"mobility",text:"机动性",value:79},{id:6,name:"handling",text:"操控",value:70}],w={muzzle:[{id:0,name:"影击消声器",image:"/assets/labs/gun/muzzle_2.png",data:{recoilControl:9,handling:-4}},{id:1,name:"轻语者消声器",image:"/assets/labs/gun/muzzle_1.png",data:{recoilControl:7,mobility:3,handling:-3}}],underbarrel:[{id:0,name:"STT88握把",image:"/assets/labs/gun/underbarrel_1.png",data:{accuracy:-3,recoilControl:7}},{id:1,name:"锦标赛战术握把",image:"/assets/labs/gun/underbarrel_2.png",data:{accuracy:-2,recoilControl:4,handling:5}}],ammo:[{id:0,name:"30发弹匣",image:"/assets/labs/gun/ammo_1.png",data:{mobility:-2,handling:-2}},{id:1,name:"45发弹匣",image:"/assets/labs/gun/ammo_2.png",data:{mobility:-4,handling:-3}}],laser:[{id:0,name:"斜置7型镭射",image:"/assets/labs/gun/laser_1.png",data:{accuracy:4,recoilControl:-4,handling:4}},{id:1,name:"1毫瓦镭射",image:"/assets/labs/gun/laser_2.png",data:{recoilControl:3,recoilControl:3}}],optic:[{id:0,name:"斜式反射瞄准镜",image:"/assets/labs/gun/optic_1.png",data:{range:4,accuracy:3,handling:-2}},{id:1,name:"英特斯CAS-14瞄准镜",image:"/assets/labs/gun/optic_3.png",data:{range:6,accuracy:4}},{id:2,name:"索洛佐微型瞄准镜",image:"/assets/labs/gun/optic_2.png",data:{range:2,accuracy:5}}],grip:[{id:0,name:"重型支援枪托",image:"/assets/labs/gun/grip_1.png",data:{accuracy:9,mobility:-5}},{id:1,name:"TL3轻型精英枪托",image:"/assets/labs/gun/grip_2.png",data:{accuracy:-2,mobility:8}}]},v=e=>{let a={};for(let t in e)a[t]=e[t];return a},j=e=>{for(let a in e)e[a]=0;return e};var b=i.memo(e=>{let{unit:a,unitId:t}=e,r=(0,g.R)(_),{type:n,name:o}=x[a.id],[l,c]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(t>=0){let e=w[n];c(e[t])}else c(null)},[t]);let m=e=>{if(e.stopPropagation(),r.showPlugin){let e=x.findIndex(e=>e.type===_.currentType);_.sum=v(r.temp),_.selected[e]=r.tempIndex,_.currentType=n;let a=x.findIndex(e=>e.type===n),t=r.selected[a];if(_.temp=v(_.sum),_.tempIndex=t,_.currIndex=t,t>=0){let{data:e}=w[n][t];y.forEach(a=>{_.update[a.name]=e[a.name]?e[a.name]:0,_.sum[a.name]=r.sum[a.name]-r.update[a.name]})}}else _.showPlugin=!0,_.currentType=n};return(0,s.jsxs)("div",{className:"army_unit",children:[(0,s.jsx)("svg",{style:{display:"none"},version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("symbol",{id:"icon_slot",viewBox:"0 0 24 24",children:(0,s.jsx)("polygon",{points:"2,22 2,2 22,2 22,18 18,22"})})}),(0,s.jsx)("div",{className:"army_unit_shape",children:l?(0,s.jsxs)("div",{className:"army_equip",children:[(0,s.jsxs)("div",{className:"army_equip__icon",onClick:m,children:[(0,s.jsx)("svg",{className:"army_equip__svg",children:(0,s.jsx)("use",{xlinkHref:"#icon_slot"})}),(0,s.jsx)("img",{src:l.image,alt:"",className:"army_equip__img"})]}),(0,s.jsxs)("div",{className:"army_equip__content",children:[(0,s.jsx)("p",{className:"army_equip__title",children:l.name}),(0,s.jsx)("p",{className:"army_equip__type",children:o})]})]}):(0,s.jsxs)("div",{className:"amy_empty",children:[(0,s.jsx)("div",{className:"empty_shape",onClick:m,children:(0,s.jsx)("div",{className:"empty_shape__inner"})}),(0,s.jsx)("div",{className:"amy_empty__name",children:o})]})})]})}),f=t(8634),S=t(4771),N=t(3156),P=t(7212);t(4806);var O=e=>{let a=(0,N.m)("/assets/images/texture/water-rough1.jpeg");return(0,i.useEffect)(()=>{a.wrapS=S.RepeatWrapping,a.wrapT=S.RepeatWrapping,a.repeat.set(4,4),a.needsUpdate=!0},[a]),(0,s.jsxs)("mesh",{"rotation-x":-.5*Math.PI,"position-y":-1.8,receiveShadow:!0,...e,children:[(0,s.jsx)("circleGeometry",{args:[17,64]}),(0,s.jsx)(P.Q,{roughnessMap:a,resolution:2048,color:"#fff",roughness:1,metalness:.9,envMapIntensity:.03,blur:512,mixBlur:8,mixStrength:5,mixContrast:1.2,mirror:.3,debug:0})]})};function Z(e){let{children:a,...t}=e;return(0,s.jsx)(u.V,{...t,scale:.55,transform:!0,occlude:!0,children:a})}function k(e){let{nodes:a,materials:t}=(0,d.L)("/models/gun_m4.glb"),r=(0,g.R)(_),n=(0,i.useRef)();return(0,i.useEffect)(()=>{switch(r.currentType){case"muzzle":f.ZP.to(n.current.rotation,{x:-.1,y:.2,duration:.7,ease:"power2.inOut"}),f.ZP.to(n.current.position,{x:5,y:-1.4,z:4,duration:.7,ease:"power2.inOut"});break;case"underbarrel":f.ZP.to(n.current.rotation,{x:-.1,y:.6,duration:.7,ease:"power2.inOut"}),f.ZP.to(n.current.position,{x:.8,y:-1.2,z:4.5,duration:.7,ease:"power2.inOut"});break;case"ammo":f.ZP.to(n.current.rotation,{x:-.1,y:.3,duration:.7,ease:"power2.inOut"}),f.ZP.to(n.current.position,{x:-.5,y:0,z:4.8,duration:.7,ease:"power2.inOut"});break;case"laser":f.ZP.to(n.current.rotation,{x:.1,y:2.4,duration:.7,ease:"power2.inOut"}),f.ZP.to(n.current.position,{x:-.3,y:-2.1,z:6.4,duration:.7,ease:"power2.inOut"});break;case"optic":f.ZP.to(n.current.rotation,{x:0,y:-.6,duration:.7,ease:"power2.inOut"}),f.ZP.to(n.current.position,{x:-1.5,y:-2.4,z:4.8,duration:.7,ease:"power2.inOut"});break;case"grip":f.ZP.to(n.current.rotation,{x:0,y:0,duration:.7,ease:"power2.inOut"}),f.ZP.to(n.current.position,{x:-3.5,y:-1.4,z:4,duration:.7,ease:"power2.inOut"});break;default:f.ZP.to(n.current.rotation,{x:0,y:0,duration:.7,ease:"power2.inOut"}),f.ZP.to(n.current.position,{x:0,y:0,z:0,duration:.7,ease:"power2.inOut"})}},[r.currentType]),(0,s.jsxs)("group",{...e,dispose:null,ref:n,children:[(0,s.jsxs)("group",{position:[-8.5,-1.5,0],scale:.001,children:[(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0.geometry,material:t.grip_3,visible:0===r.selected[1]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_1.geometry,material:t.grip_2,visible:1===r.selected[1]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_2.geometry,material:t.khafe_kon1,visible:0===r.selected[0]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_3.geometry,material:t.khafe_kon_2,visible:1===r.selected[0]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_4.geometry,material:t.sight_1,visible:1===r.selected[4]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_5.geometry,material:t.sight_2,visible:2===r.selected[4]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_6.geometry,material:t.lambert_scope,visible:0===r.selected[4]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_7.geometry,material:t.lambert_3}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_8.geometry,material:t.btts_1,visible:1===r.selected[5]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_9.geometry,material:t.lambert_tail_4,visible:0===r.selected[5]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_10.geometry,material:t.lambert_tail_2,visible:0===r.selected[5]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_11.geometry,material:t.lambert_ammo_1,visible:0===r.selected[2]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_12.geometry,material:t.lambert_ammo_2,visible:1===r.selected[2]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_13.geometry,material:t.lambert_5}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_14.geometry,material:t.sight_3,visible:1===r.selected[3]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_15.geometry,material:t.lambert_4}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_16.geometry,material:t.lambert_7}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_17.geometry,material:t.lambert_6}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_18.geometry,material:t.lambert_8,visible:0===r.selected[3]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_19.geometry,material:t.lambert_aux,visible:0===r.selected[3]}),(0,s.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_20.geometry,material:t.lambert_ammo_s,visible:r.selected[2]<0})]}),(0,s.jsx)("group",{position:[0,0,.5],children:x.map(e=>(0,s.jsx)(Z,{position:e.position,style:{display:r.showPlugin||r.preview?"none":"block"},children:(0,s.jsx)(b,{unit:e,unitId:r.selected[e.id]})},e.id))}),(0,s.jsx)(O,{})]})}function z(e){let{list:a=[]}=e,t=(0,g.R)(_),i=x.findIndex(e=>e.type===t.currentType);_.currIndex=i;let r=e=>{let{data:a,id:t}=e;y.forEach(e=>{_.update[e.name]=a[e.name]?a[e.name]:0}),_.selected[i]=t};return(0,s.jsx)(s.Fragment,{children:a.map((e,a)=>(0,s.jsx)("div",{className:"plugin_unit ".concat(a===t.selected[_.currIndex]?"current":""),onClick:()=>{r(e)},children:(0,s.jsxs)("div",{className:"plugin_unit__pane",children:[(0,s.jsx)("div",{className:"plugin_unit__thumb",children:(0,s.jsx)("img",{className:"plugin_unit__img",src:e.image})}),(0,s.jsx)("div",{className:"plugin_unit__name",children:e.name})]})},a))})}d.L.preload("/models/gun_m4.glb");var C=()=>{let e=(0,g.R)(_),a=(0,i.useRef)(),t=(0,i.useRef)(),r=(0,i.useRef)(),n=(0,i.useRef)(),o=(0,i.useRef)(),[l,c]=(0,i.useState)(!1),[m,u]=(0,i.useState)(null),d=a=>{if(a){for(let a in _.sum)_.sum[a]=e.sum[a]+e.update[a];j(_.update)}else _.sum=v(e.temp),j(_.update),_.selected[m]=e.tempIndex;_.currentType="",_.showPlugin=!1};return(0,i.useEffect)(()=>{if(e.showPlugin){f.ZP.to(t.current,{y:-200,duration:.5,ease:"power2.inOut",onStart:()=>{c(!0)}}),f.ZP.to(a.current,{y:0,duration:.5,ease:"power2.inOut",onStart:()=>{c(!0)}});let s=x.findIndex(a=>a.type===e.currentType),i=e.selected[s];if(_.currIndex=i,_.temp=v(_.sum),_.tempIndex=i,i>=0){let{data:a}=w[e.currentType][i];y.forEach(e=>{_.update[e.name]=a[e.name]?a[e.name]:0,_.sum[e.name]=_.sum[e.name]-_.update[e.name]})}f.ZP.to(n.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"})}else f.ZP.to(t.current,{y:0,duration:.5,ease:"power2.inOut",onStart:()=>{c(!0)}}),f.ZP.to(a.current,{y:"110%",duration:.5,ease:"power2.inOut",onComplete:()=>{c(!1)}}),f.ZP.to(n.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"})},[e.showPlugin]),(0,i.useEffect)(()=>{e.preview?(f.ZP.to(n.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}),f.ZP.to(t.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}),f.ZP.to(r.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}),f.ZP.to(o.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"})):(f.ZP.to(n.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"}),f.ZP.to(t.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"}),f.ZP.to(r.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"}),f.ZP.to(o.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}))},[e.preview]),(0,s.jsxs)("section",{className:"hud_box",children:[(0,s.jsxs)("div",{className:"weapon_info",ref:r,children:[(0,s.jsx)("div",{className:"weapon_info__subtit",children:(0,s.jsx)("span",{className:"weapon_info__subtit_txt",children:"突击步枪"})}),(0,s.jsx)("h2",{className:"weapon_info__title",children:"M4A1 Carbine"}),(0,s.jsx)("p",{className:"weapon_info__level",children:"等级：5"})]}),(0,s.jsx)("div",{className:"plugin_box",style:{visibility:l?"visible":"hidden"},children:(0,s.jsxs)("div",{className:"plugin_wrap",ref:a,children:[(0,s.jsxs)("div",{className:"plugin_list",children:[(0,s.jsx)("div",{className:"plugin_unit ".concat(-1===_.selected[_.currIndex]?"current":""),onClick:()=>{j(_.update);let a=x.findIndex(a=>a.type===e.currentType);u(a),_.selected[a]=-1},children:(0,s.jsx)("div",{className:"plugin_unit__empty"})}),(0,s.jsx)(z,{list:w[e.currentType]})]}),(0,s.jsxs)("div",{className:"plugin_action",children:[(0,s.jsx)("div",{className:"weapon_btn weapon_btn--primary",onClick:e=>{e.stopPropagation(),d(!0)},children:"确定"}),(0,s.jsx)("div",{className:"weapon_btn",onClick:e=>{e.stopPropagation(),d(!1)},children:"取消"})]})]})}),(0,s.jsx)("div",{className:"status_box",ref:t,children:y.map((a,t)=>(0,s.jsxs)("div",{className:"status_unit",children:[(0,s.jsx)("p",{className:"status_unit__name",children:a.text}),(0,s.jsx)("div",{className:"status_unit__data",children:(0,s.jsx)("div",{className:"status_unit__bar",children:(0,s.jsxs)("div",{className:"status_unit__bar_wrap",children:[(0,s.jsx)("div",{className:"status_unit__bar_curr",style:{width:a.value+_.sum[a.name]+"%"}}),(0,s.jsx)("div",{className:"status_unit__bar_update ".concat(e.update[a.name]>0?"good":"bad"),style:{width:Math.abs(e.update[a.name])+"%"}})]})})})]},t))}),(0,s.jsx)("div",{className:"return_box",ref:o,children:(0,s.jsx)("div",{className:"weapon_btn",onClick:()=>{_.preview=!1},children:"返回"})}),(0,s.jsx)("div",{className:"action_box",ref:n,children:(0,s.jsx)("div",{className:"action_btn",onClick:()=>{_.preview=!0},children:"预览"})})]})},I=t(7848),R=t.n(I),T=t(6687);function A(e){return(0,s.jsx)(r.P,{castShadow:!0,penumbra:1,distance:24,decay:.9,angle:.5,attenuation:11,anglePower:3,intensity:8,...e})}function E(){return(0,s.jsxs)("group",{children:[(0,s.jsx)(A,{color:"#fc3131",position:[7,10,2]}),(0,s.jsx)(A,{color:"#2D00F7",position:[-7,10,2]}),(0,s.jsx)(o.z,{makeDefault:!0,autoRotate:!0})]})}function q(){let{gl:e,camera:a}=(0,m.z)(),t=(0,g.R)(_);return(0,i.useEffect)(()=>{t.preview||(f.ZP.to(a.rotation,{x:0,y:0,z:0,duration:.5,ease:"power2.inOut"}),f.ZP.to(a.position,{x:0,y:0,z:10,duration:.5,ease:"power2.inOut"}))},[t.preview]),(0,s.jsx)("group",{position:[0,0,-8],children:(0,s.jsx)(l.P,{count:80,scale:15,size:6,speed:.4})})}var M=()=>{let e=(0,g.R)(_);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(R(),{children:(0,s.jsx)("title",{children:"Labs - Weapon HUD"})}),(0,s.jsxs)("section",{className:"lab_show",children:[(0,s.jsxs)(c.Xz,{camera:{position:[0,0,10],fov:60,near:.01,far:1e4},children:[(0,s.jsxs)(i.Suspense,{fallback:(0,s.jsx)(T.Z,{size:.6}),children:[(0,s.jsx)(k,{}),(0,s.jsx)(n.qA,{files:"/hdrs/empty_warehouse_01_1k.hdr"})]}),(0,s.jsx)(q,{}),e.preview&&(0,s.jsx)(E,{})]}),(0,s.jsx)(C,{})]})]})}}},function(e){e.O(0,[511,83,3045,670,8517,9689,6468,6256,7214,9774,2888,179],function(){return e(e.s=3936)}),_N_E=e.O()}]);