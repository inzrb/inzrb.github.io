(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9689],{4799:function(e,r,t){"use strict";t.d(r,{qA:function(){return eu}});var n=t(8126),a=t(959),i=t(5542),o=t(4771);let l=e=>e&&e.isCubeTexture;class s extends o.Mesh{constructor(e,r){var t,n;let a=l(e),i=null!=(n=a?null==(t=e.image[0])?void 0:t.width:e.image.width)?n:1024,s=Math.floor(Math.log2(i/4)),u=Math.pow(2,s),f=[a?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/(3*Math.max(u,112))}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*u)}`,`#define CUBEUV_MAX_MIP ${s}.0`],c=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,v=f.join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(o.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,d={map:{value:e},height:{value:(null==r?void 0:r.height)||15},radius:{value:(null==r?void 0:r.radius)||100}},h=new o.IcosahedronGeometry(1,16),p=new o.ShaderMaterial({uniforms:d,fragmentShader:v,vertexShader:c,side:o.DoubleSide});super(h,p)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var u=t(4134),f={},c=Uint8Array,v=Uint16Array,d=Uint32Array,h=new c([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),p=new c([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),w=new c([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=function(e,r){for(var t=new v(31),n=0;n<31;++n)t[n]=r+=1<<e[n-1];for(var a=new d(t[30]),n=1;n<30;++n)for(var i=t[n];i<t[n+1];++i)a[i]=i-t[n]<<5|n;return[t,a]},m=g(h,2),y=m[0],b=m[1];y[28]=258,b[258]=28;for(var E=g(p,0),S=E[0],U=E[1],k=new v(32768),A=0;A<32768;++A){var M=(43690&A)>>>1|(21845&A)<<1;M=(61680&(M=(52428&M)>>>2|(13107&M)<<2))>>>4|(3855&M)<<4,k[A]=((65280&M)>>>8|(255&M)<<8)>>>1}for(var C=function(e,r,t){for(var n,a=e.length,i=0,o=new v(r);i<a;++i)++o[e[i]-1];var l=new v(r);for(i=0;i<r;++i)l[i]=l[i-1]+o[i-1]<<1;if(t){n=new v(1<<r);var s=15-r;for(i=0;i<a;++i)if(e[i])for(var u=i<<4|e[i],f=r-e[i],c=l[e[i]-1]++<<f,d=c|(1<<f)-1;c<=d;++c)n[k[c]>>>s]=u}else for(i=0,n=new v(a);i<a;++i)e[i]&&(n[i]=k[l[e[i]-1]++]>>>15-e[i]);return n},x=new c(288),A=0;A<144;++A)x[A]=8;for(var A=144;A<256;++A)x[A]=9;for(var A=256;A<280;++A)x[A]=7;for(var A=280;A<288;++A)x[A]=8;for(var _=new c(32),A=0;A<32;++A)_[A]=5;var P=C(x,9,1),R=C(_,5,1),z=function(e){for(var r=e[0],t=1;t<e.length;++t)e[t]>r&&(r=e[t]);return r},F=function(e,r,t){var n=r/8|0;return(e[n]|e[n+1]<<8)>>(7&r)&t},I=function(e,r){var t=r/8|0;return(e[t]|e[t+1]<<8|e[t+2]<<16)>>(7&r)},T=function(e){return(e/8|0)+(7&e&&1)},O=function(e,r,t){(null==r||r<0)&&(r=0),(null==t||t>e.length)&&(t=e.length);var n=new(e instanceof v?v:e instanceof d?d:c)(t-r);return n.set(e.subarray(r,t)),n},L=function(e,r,t){var n=e.length;if(!n||t&&!t.l&&n<5)return r||new c(0);var a=!r||t,i=!t||t.i;t||(t={}),r||(r=new c(3*n));var o=function(e){var t=r.length;if(e>t){var n=new c(Math.max(2*t,e));n.set(r),r=n}},l=t.f||0,s=t.p||0,u=t.b||0,f=t.l,v=t.d,d=t.m,g=t.n,m=8*n;do{if(!f){t.f=l=F(e,s,1);var b=F(e,s+1,3);if(s+=3,b){if(1==b)f=P,v=R,d=9,g=5;else if(2==b){var E=F(e,s,31)+257,U=F(e,s+10,15)+4,k=E+F(e,s+5,31)+1;s+=14;for(var A=new c(k),M=new c(19),x=0;x<U;++x)M[w[x]]=F(e,s+3*x,7);s+=3*U;for(var _=z(M),L=(1<<_)-1,D=C(M,_,1),x=0;x<k;){var B=D[F(e,s,L)];s+=15&B;var N=B>>>4;if(N<16)A[x++]=N;else{var H=0,W=0;for(16==N?(W=3+F(e,s,3),s+=2,H=A[x-1]):17==N?(W=3+F(e,s,7),s+=3):18==N&&(W=11+F(e,s,127),s+=7);W--;)A[x++]=H}}var V=A.subarray(0,E),X=A.subarray(E);d=z(V),g=z(X),f=C(V,d,1),v=C(X,g,1)}else throw"invalid block type"}else{var N=T(s)+4,G=e[N-4]|e[N-3]<<8,j=N+G;if(j>n){if(i)throw"unexpected EOF";break}a&&o(u+G),r.set(e.subarray(N,j),u),t.b=u+=G,t.p=s=8*j;continue}if(s>m){if(i)throw"unexpected EOF";break}}a&&o(u+131072);for(var Y=(1<<d)-1,Z=(1<<g)-1,$=s;;$=s){var H=f[I(e,s)&Y],q=H>>>4;if((s+=15&H)>m){if(i)throw"unexpected EOF";break}if(!H)throw"invalid length/literal";if(q<256)r[u++]=q;else if(256==q){$=s,f=null;break}else{var J=q-254;if(q>264){var x=q-257,K=h[x];J=F(e,s,(1<<K)-1)+y[x],s+=K}var Q=v[I(e,s)&Z],ee=Q>>>4;if(!Q)throw"invalid distance";s+=15&Q;var X=S[ee];if(ee>3){var K=p[ee];X+=I(e,s)&(1<<K)-1,s+=K}if(s>m){if(i)throw"unexpected EOF";break}a&&o(u+131072);for(var er=u+J;u<er;u+=4)r[u]=r[u-X],r[u+1]=r[u+1-X],r[u+2]=r[u+2-X],r[u+3]=r[u+3-X];u=er}}t.l=f,t.p=$,t.b=u,f&&(l=1,t.m=d,t.d=v,t.n=g)}while(!l);return u==r.length?r:O(r,0,u)},D=function(e,r,t){t<<=7&r;var n=r/8|0;e[n]|=t,e[n+1]|=t>>>8},B=function(e,r,t){t<<=7&r;var n=r/8|0;e[n]|=t,e[n+1]|=t>>>8,e[n+2]|=t>>>16},N=function(e,r){for(var t=[],n=0;n<e.length;++n)e[n]&&t.push({s:n,f:e[n]});var a=t.length,i=t.slice();if(!a)return[Y,0];if(1==a){var o=new c(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(e,r){return e.f-r.f}),t.push({s:-1,f:25001});var l=t[0],s=t[1],u=0,f=1,d=2;for(t[0]={s:-1,f:l.f+s.f,l:l,r:s};f!=a-1;)l=t[t[u].f<t[d].f?u++:d++],s=t[u!=f&&t[u].f<t[d].f?u++:d++],t[f++]={s:-1,f:l.f+s.f,l:l,r:s};for(var h=i[0].s,n=1;n<a;++n)i[n].s>h&&(h=i[n].s);var p=new v(h+1),w=H(t[f-1],p,0);if(w>r){var n=0,g=0,m=w-r,y=1<<m;for(i.sort(function(e,r){return p[r.s]-p[e.s]||e.f-r.f});n<a;++n){var b=i[n].s;if(p[b]>r)g+=y-(1<<w-p[b]),p[b]=r;else break}for(g>>>=m;g>0;){var E=i[n].s;p[E]<r?g-=1<<r-p[E]++-1:++n}for(;n>=0&&g;--n){var S=i[n].s;p[S]==r&&(--p[S],++g)}w=r}return[new c(p),w]},H=function(e,r,t){return -1==e.s?Math.max(H(e.l,r,t+1),H(e.r,r,t+1)):r[e.s]=t},W=function(e){for(var r=e.length;r&&!e[--r];);for(var t=new v(++r),n=0,a=e[0],i=1,o=function(e){t[n++]=e},l=1;l<=r;++l)if(e[l]==a&&l!=r)++i;else{if(!a&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(a),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(a);i=1,a=e[l]}return[t.subarray(0,n),r]},V=function(e,r){for(var t=0,n=0;n<r.length;++n)t+=e[n]*r[n];return t},X=function(e,r,t){var n=t.length,a=T(r+2);e[a]=255&n,e[a+1]=n>>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var i=0;i<n;++i)e[a+i+4]=t[i];return(a+4+n)*8},G=function(e,r,t,n,a,i,o,l,s,u,f){D(r,f++,t),++a[256];for(var c,d,g,m,y=N(a,15),b=y[0],E=y[1],S=N(i,15),U=S[0],k=S[1],A=W(b),M=A[0],P=A[1],R=W(U),z=R[0],F=R[1],I=new v(19),T=0;T<M.length;++T)I[31&M[T]]++;for(var T=0;T<z.length;++T)I[31&z[T]]++;for(var O=N(I,7),L=O[0],H=O[1],G=19;G>4&&!L[w[G-1]];--G);var j=u+5<<3,Y=V(a,x)+V(i,_)+o,Z=V(a,b)+V(i,U)+o+14+3*G+V(I,L)+(2*I[16]+3*I[17]+7*I[18]);if(j<=Y&&j<=Z)return X(r,f,e.subarray(s,s+u));if(D(r,f,1+(Z<Y)),f+=2,Z<Y){c=C(b,E,0),d=b,g=C(U,k,0),m=U;var $=C(L,H,0);D(r,f,P-257),D(r,f+5,F-1),D(r,f+10,G-4),f+=14;for(var T=0;T<G;++T)D(r,f+3*T,L[w[T]]);f+=3*G;for(var q=[M,z],J=0;J<2;++J)for(var K=q[J],T=0;T<K.length;++T){var Q=31&K[T];D(r,f,$[Q]),f+=L[Q],Q>15&&(D(r,f,K[T]>>>5&127),f+=K[T]>>>12)}}else c=null,d=x,g=null,m=_;for(var T=0;T<l;++T)if(n[T]>255){var Q=n[T]>>>18&31;B(r,f,c[Q+257]),f+=d[Q+257],Q>7&&(D(r,f,n[T]>>>23&31),f+=h[Q]);var ee=31&n[T];B(r,f,g[ee]),f+=m[ee],ee>3&&(B(r,f,n[T]>>>5&8191),f+=p[ee])}else B(r,f,c[n[T]]),f+=d[n[T]];return B(r,f,c[256]),f+d[256]},j=new d([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Y=new c(0),Z=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function $(e,r){return L((Z(e),e.subarray(2,-4)),r)}var q="undefined"!=typeof TextDecoder&&new TextDecoder;try{q.decode(Y,{stream:!0})}catch(e){}let J="colorSpace"in new o.Texture;class K extends o.DataTextureLoader{constructor(e){super(e),this.type=o.HalfFloatType}parse(e){let r={l:0,c:0,lc:0};function t(e,t,n,a,i){for(;n<e;)t=t<<8|M(a,i),n+=8;n-=e,r.l=t>>n&(1<<e)-1,r.c=t,r.lc=n}let n=Array(59),a={c:0,lc:0};function i(e,r,t,n){e=e<<8|M(t,n),r+=8,a.c=e,a.lc=r}let l={c:0,lc:0};function s(e,r,t,n,o,s,u,f,c,v){if(e==r){n<8&&(i(t,n,o,u),t=a.c,n=a.lc);var d=t>>(n-=8),d=new Uint8Array([d])[0];if(c.value+d>v)return!1;for(var h=f[c.value-1];d-- >0;)f[c.value++]=h}else{if(!(c.value<v))return!1;f[c.value++]=e}l.c=t,l.lc=n}function u(e){var r=65535&e;return r>32767?r-65536:r}let f={a:0,b:0};function c(e,r){var t=u(e),n=u(r),a=t+(1&n)+(n>>1),i=a-n;f.a=a,f.b=i}function v(e,r){var t=65535&r,n=(65535&e)-(t>>1)&65535;f.a=t+n-32768&65535,f.b=n}function d(e,o,u,f,c,v){var d=u.value,h=A(o,u),p=A(o,u);u.value+=4;var w=A(o,u);if(u.value+=4,h<0||h>=65537||p<0||p>=65537)throw"Something wrong with HUF_ENCSIZE";var g=Array(65537),m=Array(16384);!function(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}(m);var y=f-(u.value-d);if(!function(e,a,i,o,l,s,u){for(var f=0,c=0;l<=s;l++){if(i.value-i.value>o)return!1;t(6,f,c,e,i);var v=r.l;if(f=r.c,c=r.lc,u[l]=v,63==v){if(i.value-i.value>o)throw"Something wrong with hufUnpackEncTable";t(8,f,c,e,i);var d=r.l+6;if(f=r.c,c=r.lc,l+d>s+1)throw"Something wrong with hufUnpackEncTable";for(;d--;)u[l++]=0;l--}else if(v>=59){var d=v-59+2;if(l+d>s+1)throw"Something wrong with hufUnpackEncTable";for(;d--;)u[l++]=0;l--}}!function(e){for(var r=0;r<=58;++r)n[r]=0;for(var r=0;r<65537;++r)n[e[r]]+=1;for(var t=0,r=58;r>0;--r){var a=t+n[r]>>1;n[r]=t,t=a}for(var r=0;r<65537;++r){var i=e[r];i>0&&(e[r]=i|n[i]++<<6)}}(u)}(e,0,u,y,h,p,g),w>8*(f-(u.value-d)))throw"Something wrong with hufUncompress";!function(e,r,t,n){for(;r<=t;r++){var a=e[r]>>6,i=63&e[r];if(a>>i)throw"Invalid table entry";if(i>14){var o=n[a>>i-14];if(o.len)throw"Invalid table entry";if(o.lit++,o.p){var l=o.p;o.p=Array(o.lit);for(var s=0;s<o.lit-1;++s)o.p[s]=l[s]}else o.p=[,];o.p[o.lit-1]=r}else if(i)for(var u=0,s=1<<14-i;s>0;s--){var o=n[(a<<14-i)+u];if(o.len||o.p)throw"Invalid table entry";o.len=i,o.lit=r,u++}}}(g,h,p,m),function(e,r,t,n,o,u,f,c,v,d){for(var h=0,p=0,w=Math.trunc(o.value+(u+7)/8);o.value<w;)for(i(h,p,t,o),h=a.c,p=a.lc;p>=14;){var g=r[h>>p-14&16383];if(g.len)p-=g.len,s(g.lit,f,h,p,t,n,o,v,d,c),h=l.c,p=l.lc;else{if(!g.p)throw"hufDecode issues";for(m=0;m<g.lit;m++){for(var m,y=63&e[g.p[m]];p<y&&o.value<w;)i(h,p,t,o),h=a.c,p=a.lc;if(p>=y&&e[g.p[m]]>>6==(h>>p-y&(1<<y)-1)){p-=y,s(g.p[m],f,h,p,t,n,o,v,d,c),h=l.c,p=l.lc;break}}if(m==g.lit)throw"hufDecode issues"}}var b=8-u&7;for(h>>=b,p-=b;p>0;){var g=r[h<<14-p&16383];if(g.len)p-=g.len,s(g.lit,f,h,p,t,n,o,v,d,c),h=l.c,p=l.lc;else throw"hufDecode issues"}}(g,m,e,o,u,w,p,v,c,{value:0})}function h(e){for(var r=1;r<e.length;r++){var t=e[r-1]+e[r]-128;e[r]=t}}function p(e,r){for(var t=0,n=Math.floor((e.length+1)/2),a=0,i=e.length-1;!(a>i)&&(r[a++]=e[t++],!(a>i));)r[a++]=e[n++]}function w(e){for(var r=e.byteLength,t=[],n=0,a=new DataView(e);r>0;){var i=a.getInt8(n++);if(i<0){var o=-i;r-=o+1;for(var l=0;l<o;l++)t.push(a.getUint8(n++))}else{var o=i;r-=2;for(var s=a.getUint8(n++),l=0;l<o+1;l++)t.push(s)}}return t}function g(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function m(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),t=new Uint8Array(w(r)),n=new Uint8Array(t.length);return h(t),p(t,n),new DataView(n.buffer)}function y(e){var r=$(e.array.slice(e.offset.value,e.offset.value+e.size)),t=new Uint8Array(r.length);return h(r),p(r,t),new DataView(t.buffer)}function b(e){for(var r=e.viewer,t={value:e.offset.value},n=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),a=new Uint8Array(8192),i=0,o=Array(e.channels),l=0;l<e.channels;l++)o[l]={},o[l].start=i,o[l].end=o[l].start,o[l].nx=e.width,o[l].ny=e.lines,o[l].size=e.type,i+=o[l].nx*o[l].ny*o[l].size;var s=z(r,t),u=z(r,t);if(u>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(s<=u)for(var l=0;l<u-s+1;l++)a[l+s]=C(r,t);var h=new Uint16Array(65536),p=function(e,r){for(var t=0,n=0;n<65536;++n)(0==n||e[n>>3]&1<<(7&n))&&(r[t++]=n);for(var a=t-1;t<65536;)r[t++]=0;return a}(a,h),w=A(r,t);d(e.array,r,t,w,n,i);for(var l=0;l<e.channels;++l)for(var g=o[l],m=0;m<o[l].size;++m)!function(e,r,t,n,a,i,o){for(var l=o<16384,s=t>a?a:t,u=1;u<=s;)u<<=1;for(u>>=1,d=u,u>>=1;u>=1;){for(var d,h,p,w,g,m=0,y=0+i*(a-d),b=i*u,E=i*d,S=n*u,U=n*d;m<=y;m+=E){for(var k=m,A=m+n*(t-d);k<=A;k+=U){var M=k+S,C=k+b,x=C+S;l?(c(e[k+r],e[C+r]),h=f.a,w=f.b,c(e[M+r],e[x+r]),p=f.a,g=f.b,c(h,p),e[k+r]=f.a,e[M+r]=f.b,c(w,g)):(v(e[k+r],e[C+r]),h=f.a,w=f.b,v(e[M+r],e[x+r]),p=f.a,g=f.b,v(h,p),e[k+r]=f.a,e[M+r]=f.b,v(w,g)),e[C+r]=f.a,e[x+r]=f.b}if(t&u){var C=k+b;l?c(e[k+r],e[C+r]):v(e[k+r],e[C+r]),h=f.a,e[C+r]=f.b,e[k+r]=h}}if(a&u)for(var k=m,A=m+n*(t-d);k<=A;k+=U){var M=k+S;l?c(e[k+r],e[M+r]):v(e[k+r],e[M+r]),h=f.a,e[M+r]=f.b,e[k+r]=h}d=u,u>>=1}}(n,g.start+m,g.nx,g.size,g.ny,g.nx*g.size,p);!function(e,r,t){for(var n=0;n<t;++n)r[n]=e[r[n]]}(h,n,i);for(var y=0,b=new Uint8Array(n.buffer.byteLength),E=0;E<e.lines;E++)for(var S=0;S<e.channels;S++){var g=o[S],U=g.nx*g.size,k=new Uint8Array(n.buffer,2*g.end,2*U);b.set(k,y),y+=2*U,g.end+=U}return new DataView(b.buffer)}function E(e){var r=$(e.array.slice(e.offset.value,e.offset.value+e.size));let t=e.lines*e.channels*e.width,n=1==e.type?new Uint16Array(t):new Uint32Array(t),a=0,i=0,o=[,,,,];for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:o[0]=a,o[1]=o[0]+e.width,a=o[1]+e.width;for(let a=0;a<e.width;++a){let e=r[o[0]++]<<8|r[o[1]++];t+=e,n[i]=t,i++}break;case 2:o[0]=a,o[1]=o[0]+e.width,o[2]=o[1]+e.width,a=o[2]+e.width;for(let a=0;a<e.width;++a){let e=r[o[0]++]<<24|r[o[1]++]<<16|r[o[2]++]<<8;t+=e,n[i]=t,i++}}}return new DataView(n.buffer)}function S(e){var r=e.viewer,t={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),a={version:x(r,t),unknownUncompressedSize:x(r,t),unknownCompressedSize:x(r,t),acCompressedSize:x(r,t),dcCompressedSize:x(r,t),rleCompressedSize:x(r,t),rleUncompressedSize:x(r,t),rleRawSize:x(r,t),totalAcUncompressedCount:x(r,t),totalDcUncompressedCount:x(r,t),acCompression:x(r,t)};if(a.version<2)throw"EXRLoader.parse: "+L.compression+" version "+a.version+" is unsupported";for(var i=[],l=z(r,t)-2;l>0;){var s=U(r.buffer,t),u=C(r,t),f=u>>2&3,c=(u>>4)-1,v=new Int8Array([c])[0],h=C(r,t);i.push({name:s,index:v,type:h,compression:f}),l-=s.length+3}for(var p=L.channels,g=Array(e.channels),m=0;m<e.channels;++m){var b=g[m]={},E=p[m];b.name=E.name,b.compression=0,b.decoded=!1,b.type=E.pixelType,b.pLinear=E.pLinear,b.width=e.width,b.height=e.lines}for(var S={idx:[,,,]},k=0;k<e.channels;++k)for(var b=g[k],m=0;m<i.length;++m){var A=i[m];b.name==A.name&&(b.compression=A.compression,A.index>=0&&(S.idx[A.index]=k),b.offset=k)}if(a.acCompressedSize>0)switch(a.acCompression){case 0:var M=new Uint16Array(a.totalAcUncompressedCount);d(e.array,r,t,a.acCompressedSize,M,a.totalAcUncompressedCount);break;case 1:var _=e.array.slice(t.value,t.value+a.totalAcUncompressedCount),P=$(_),M=new Uint16Array(P.buffer);t.value+=a.totalAcUncompressedCount}if(a.dcCompressedSize>0){var F={array:e.array,offset:t,size:a.dcCompressedSize},I=new Uint16Array(y(F).buffer);t.value+=a.dcCompressedSize}if(a.rleRawSize>0){var _=e.array.slice(t.value,t.value+a.rleCompressedSize),P=$(_),T=w(P.buffer);t.value+=a.rleCompressedSize}for(var O=0,D=Array(g.length),m=0;m<D.length;++m)D[m]=[];for(var B=0;B<e.lines;++B)for(var N=0;N<g.length;++N)D[N].push(O),O+=g[N].width*e.type*2;!function(e,r,t,n,a,i){var l=new DataView(i.buffer),s=t[e.idx[0]].width,u=t[e.idx[0]].height,f=Math.floor(s/8),c=Math.ceil(s/8),v=Math.ceil(u/8),d=s-(c-1)*8,h=u-(v-1)*8,p={value:0},w=[,,,],g=[,,,],m=[,,,],y=[,,,],b=[,,,];for(let t=0;t<3;++t)b[t]=r[e.idx[t]],w[t]=t<1?0:w[t-1]+c*v,g[t]=new Float32Array(64),m[t]=new Uint16Array(64),y[t]=new Uint16Array(64*c);for(let r=0;r<v;++r){var E,S,U=8;r==v-1&&(U=h);var k=8;for(let e=0;e<c;++e){e==c-1&&(k=d);for(let e=0;e<3;++e)m[e].fill(0),m[e][0]=a[w[e]++],function(e,r,t){for(var n,a=1;a<64;)65280==(n=r[e.value])?a=64:n>>8==255?a+=255&n:(t[a]=n,a++),e.value++}(p,n,m[e]),E=m[e],(S=g[e])[0]=R(E[0]),S[1]=R(E[1]),S[2]=R(E[5]),S[3]=R(E[6]),S[4]=R(E[14]),S[5]=R(E[15]),S[6]=R(E[27]),S[7]=R(E[28]),S[8]=R(E[2]),S[9]=R(E[4]),S[10]=R(E[7]),S[11]=R(E[13]),S[12]=R(E[16]),S[13]=R(E[26]),S[14]=R(E[29]),S[15]=R(E[42]),S[16]=R(E[3]),S[17]=R(E[8]),S[18]=R(E[12]),S[19]=R(E[17]),S[20]=R(E[25]),S[21]=R(E[30]),S[22]=R(E[41]),S[23]=R(E[43]),S[24]=R(E[9]),S[25]=R(E[11]),S[26]=R(E[18]),S[27]=R(E[24]),S[28]=R(E[31]),S[29]=R(E[40]),S[30]=R(E[44]),S[31]=R(E[53]),S[32]=R(E[10]),S[33]=R(E[19]),S[34]=R(E[23]),S[35]=R(E[32]),S[36]=R(E[39]),S[37]=R(E[45]),S[38]=R(E[52]),S[39]=R(E[54]),S[40]=R(E[20]),S[41]=R(E[22]),S[42]=R(E[33]),S[43]=R(E[38]),S[44]=R(E[46]),S[45]=R(E[51]),S[46]=R(E[55]),S[47]=R(E[60]),S[48]=R(E[21]),S[49]=R(E[34]),S[50]=R(E[37]),S[51]=R(E[47]),S[52]=R(E[50]),S[53]=R(E[56]),S[54]=R(E[59]),S[55]=R(E[61]),S[56]=R(E[35]),S[57]=R(E[36]),S[58]=R(E[48]),S[59]=R(E[49]),S[60]=R(E[57]),S[61]=R(E[58]),S[62]=R(E[62]),S[63]=R(E[63]),function(e){let r=.5*Math.cos(3.14159/16),t=.5*Math.cos(3.14159/8),n=.5*Math.cos(3*3.14159/16),a=.5*Math.cos(3*3.14159/8);for(var i=[,,,,],o=[,,,,],l=[,,,,],s=[,,,,],u=0;u<8;++u){var f=8*u;i[0]=t*e[f+2],i[1]=a*e[f+2],i[2]=t*e[f+6],i[3]=a*e[f+6],o[0]=r*e[f+1]+n*e[f+3]+.2777854612564676*e[f+5]+.09754573032714427*e[f+7],o[1]=n*e[f+1]-.09754573032714427*e[f+3]-r*e[f+5]-.2777854612564676*e[f+7],o[2]=.2777854612564676*e[f+1]-r*e[f+3]+.09754573032714427*e[f+5]+n*e[f+7],o[3]=.09754573032714427*e[f+1]-.2777854612564676*e[f+3]+n*e[f+5]-r*e[f+7],l[0]=.35355362513961314*(e[f+0]+e[f+4]),l[3]=.35355362513961314*(e[f+0]-e[f+4]),l[1]=i[0]+i[3],l[2]=i[1]-i[2],s[0]=l[0]+l[1],s[1]=l[3]+l[2],s[2]=l[3]-l[2],s[3]=l[0]-l[1],e[f+0]=s[0]+o[0],e[f+1]=s[1]+o[1],e[f+2]=s[2]+o[2],e[f+3]=s[3]+o[3],e[f+4]=s[3]-o[3],e[f+5]=s[2]-o[2],e[f+6]=s[1]-o[1],e[f+7]=s[0]-o[0]}for(var c=0;c<8;++c)i[0]=t*e[16+c],i[1]=a*e[16+c],i[2]=t*e[48+c],i[3]=a*e[48+c],o[0]=r*e[8+c]+n*e[24+c]+.2777854612564676*e[40+c]+.09754573032714427*e[56+c],o[1]=n*e[8+c]-.09754573032714427*e[24+c]-r*e[40+c]-.2777854612564676*e[56+c],o[2]=.2777854612564676*e[8+c]-r*e[24+c]+.09754573032714427*e[40+c]+n*e[56+c],o[3]=.09754573032714427*e[8+c]-.2777854612564676*e[24+c]+n*e[40+c]-r*e[56+c],l[0]=.35355362513961314*(e[c]+e[32+c]),l[3]=.35355362513961314*(e[c]-e[32+c]),l[1]=i[0]+i[3],l[2]=i[1]-i[2],s[0]=l[0]+l[1],s[1]=l[3]+l[2],s[2]=l[3]-l[2],s[3]=l[0]-l[1],e[0+c]=s[0]+o[0],e[8+c]=s[1]+o[1],e[16+c]=s[2]+o[2],e[24+c]=s[3]+o[3],e[32+c]=s[3]-o[3],e[40+c]=s[2]-o[2],e[48+c]=s[1]-o[1],e[56+c]=s[0]-o[0]}(g[e]);!function(e){for(var r=0;r<64;++r){var t=e[0][r],n=e[1][r],a=e[2][r];e[0][r]=t+1.5747*a,e[1][r]=t-.1873*n-.4682*a,e[2][r]=t+1.8556*n}}(g);for(let r=0;r<3;++r)!function(e,r,t){for(var n,a=0;a<64;++a)r[t+a]=o.DataUtils.toHalfFloat((n=e[a])<=1?Math.sign(n)*Math.pow(Math.abs(n),2.2):Math.sign(n)*Math.pow(9.025013291561939,Math.abs(n)-1))}(g[r],y[r],64*e)}let i=0;for(let n=0;n<3;++n){let a=t[e.idx[n]].type;for(let e=8*r;e<8*r+U;++e){i=b[n][e];for(let r=0;r<f;++r){let t=64*r+(7&e)*8;l.setUint16(i+0*a,y[n][t+0],!0),l.setUint16(i+2*a,y[n][t+1],!0),l.setUint16(i+4*a,y[n][t+2],!0),l.setUint16(i+6*a,y[n][t+3],!0),l.setUint16(i+8*a,y[n][t+4],!0),l.setUint16(i+10*a,y[n][t+5],!0),l.setUint16(i+12*a,y[n][t+6],!0),l.setUint16(i+14*a,y[n][t+7],!0),i+=16*a}}if(f!=c)for(let e=8*r;e<8*r+U;++e){let r=b[n][e]+8*f*2*a,t=64*f+(7&e)*8;for(let e=0;e<k;++e)l.setUint16(r+2*e*a,y[n][t+e],!0)}}}for(var A=new Uint16Array(s),l=new DataView(i.buffer),M=0;M<3;++M){t[e.idx[M]].decoded=!0;var C=t[e.idx[M]].type;if(2==t[M].type)for(var x=0;x<u;++x){let e=b[M][x];for(var _=0;_<s;++_)A[_]=l.getUint16(e+2*_*C,!0);for(var _=0;_<s;++_)l.setFloat32(e+2*_*C,R(A[_]),!0)}}}(S,D,g,M,I,n);for(var m=0;m<g.length;++m){var b=g[m];if(!b.decoded){if(2===b.compression)for(var H=0,W=0,B=0;B<e.lines;++B){for(var V=D[m][H],X=0;X<b.width;++X){for(var G=0;G<2*b.type;++G)n[V++]=T[W+G*b.width*b.height];W++}H++}else throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(n.buffer)}function U(e,r){for(var t=new Uint8Array(e),n=0;0!=t[r.value+n];)n+=1;var a=new TextDecoder().decode(t.slice(r.value,r.value+n));return r.value=r.value+n+1,a}function k(e,r){var t=e.getInt32(r.value,!0);return r.value=r.value+4,t}function A(e,r){var t=e.getUint32(r.value,!0);return r.value=r.value+4,t}function M(e,r){var t=e[r.value];return r.value=r.value+1,t}function C(e,r){var t=e.getUint8(r.value);return r.value=r.value+1,t}let x=function(e,r){let t;return t="getBigInt64"in DataView.prototype?Number(e.getBigInt64(r.value,!0)):e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,t};function _(e,r){var t=e.getFloat32(r.value,!0);return r.value+=4,t}function P(e,r){return o.DataUtils.toHalfFloat(_(e,r))}function R(e){var r=(31744&e)>>10,t=1023&e;return(e>>15?-1:1)*(r?31===r?t?NaN:1/0:Math.pow(2,r-15)*(1+t/1024):6103515625e-14*(t/1024))}function z(e,r){var t=e.getUint16(r.value,!0);return r.value+=2,t}function F(e,r){return R(z(e,r))}let I=new DataView(e),T=new Uint8Array(e),O={value:0},L=function(e,r,t){let n={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";n.version=e.getUint8(4);let a=e.getUint8(5);n.spec={singleTile:!!(2&a),longName:!!(4&a),deepFormat:!!(8&a),multiPart:!!(16&a)},t.value=8;for(var i=!0;i;){var o=U(r,t);if(0==o)i=!1;else{var l=U(r,t),s=A(e,t),u=function(e,r,t,n,a){var i,o,l,s,u;if("string"===n||"stringvector"===n||"iccProfile"===n)return i=new TextDecoder().decode(new Uint8Array(r).slice(t.value,t.value+a)),t.value=t.value+a,i;if("chlist"===n)return function(e,r,t,n){for(var a=t.value,i=[];t.value<a+n-1;){var o=U(r,t),l=k(e,t),s=C(e,t);t.value+=3;var u=k(e,t),f=k(e,t);i.push({name:o,pixelType:l,pLinear:s,xSampling:u,ySampling:f})}return t.value+=1,i}(e,r,t,a);if("chromaticities"===n)return o=_(e,t),l=_(e,t),s=_(e,t),u=_(e,t),{redX:o,redY:l,greenX:s,greenY:u,blueX:_(e,t),blueY:_(e,t),whiteX:_(e,t),whiteY:_(e,t)};if("compression"===n)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][C(e,t)];if("box2i"===n)return{xMin:A(e,t),yMin:A(e,t),xMax:A(e,t),yMax:A(e,t)};if("lineOrder"===n)return["INCREASING_Y"][C(e,t)];if("float"===n)return _(e,t);else if("v2f"===n)return[_(e,t),_(e,t)];else if("v3f"===n)return[_(e,t),_(e,t),_(e,t)];else if("int"===n)return k(e,t);else if("rational"===n)return[k(e,t),A(e,t)];else if("timecode"===n)return[A(e,t),A(e,t)];else return"preview"===n?(t.value+=a,"skipped"):void(t.value+=a)}(e,r,t,l,s);void 0===u?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${l}'.`):n[o]=u}}if(0!=a)throw console.error("EXRHeader:",n),"THREE.EXRLoader: provided file is currently unsupported.";return n}(I,e,O),D=function(e,r,t,n,a){let i={size:0,viewer:r,array:t,offset:n,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[J?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":i.lines=1,i.uncompress=g;break;case"RLE_COMPRESSION":i.lines=1,i.uncompress=m;break;case"ZIPS_COMPRESSION":i.lines=1,i.uncompress=y;break;case"ZIP_COMPRESSION":i.lines=16,i.uncompress=y;break;case"PIZ_COMPRESSION":i.lines=32,i.uncompress=b;break;case"PXR24_COMPRESSION":i.lines=16,i.uncompress=E;break;case"DWAA_COMPRESSION":i.lines=32,i.uncompress=S;break;case"DWAB_COMPRESSION":i.lines=256,i.uncompress=S;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(i.scanlineBlockSize=i.lines,1==i.type)switch(a){case o.FloatType:i.getter=F,i.inputSize=2;break;case o.HalfFloatType:i.getter=z,i.inputSize=2}else if(2==i.type)switch(a){case o.FloatType:i.getter=_,i.inputSize=4;break;case o.HalfFloatType:i.getter=P,i.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+i.type+" for "+e.compression+".";i.blockCount=(e.dataWindow.yMax+1)/i.scanlineBlockSize;for(var l=0;l<i.blockCount;l++)x(r,n);i.outputChannels=3==i.channels?4:i.channels;let s=i.width*i.height*i.outputChannels;switch(a){case o.FloatType:i.byteArray=new Float32Array(s),i.channels<i.outputChannels&&i.byteArray.fill(1,0,s);break;case o.HalfFloatType:i.byteArray=new Uint16Array(s),i.channels<i.outputChannels&&i.byteArray.fill(15360,0,s);break;default:console.error("THREE.EXRLoader: unsupported type: ",a)}return i.bytesPerLine=i.width*i.inputSize*i.channels,4==i.outputChannels?i.format=o.RGBAFormat:i.format=o.RedFormat,J?i.colorSpace="srgb-linear":i.encoding=3e3,i}(L,I,T,O,this.type),B={value:0},N={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<D.height/D.scanlineBlockSize;e++){let r=A(I,O);D.size=A(I,O),D.lines=r+D.scanlineBlockSize>D.height?D.height-r:D.scanlineBlockSize;let t=D.size<D.lines*D.bytesPerLine,n=t?D.uncompress(D):g(D);O.value+=D.size;for(let r=0;r<D.scanlineBlockSize;r++){let t=r+e*D.scanlineBlockSize;if(t>=D.height)break;for(let e=0;e<D.channels;e++){let a=N[L.channels[e].name];for(let i=0;i<D.width;i++){B.value=(r*(D.channels*D.width)+e*D.width+i)*D.inputSize;let o=(D.height-1-t)*(D.width*D.outputChannels)+i*D.outputChannels+a;D.byteArray[o]=D.getter(n,B)}}}}return{header:L,width:D.width,height:D.height,data:D.byteArray,format:D.format,[J?"colorSpace":"encoding"]:D[J?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,r,t,n){return super.load(e,function(e,t){J?e.colorSpace=t.colorSpace:e.encoding=t.encoding,e.minFilter=o.LinearFilter,e.magFilter=o.LinearFilter,e.generateMipmaps=!1,e.flipY=!1,r&&r(e,t)},t,n)}}let Q={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},ee=e=>Array.isArray(e);function er({files:e=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:r="",preset:t,encoding:n,extensions:a}={}){var l;let s;let f=null,c=!1;if(t){if(!(t in Q))throw Error("Preset must be one of: "+Object.keys(Q).join(", "));e=Q[t],r="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/"}if(c=ee(e),s=ee(e)?"cube":e.startsWith("data:application/exr")?"exr":e.startsWith("data:application/hdr")?"hdr":null==(l=e.split(".").pop())||null==(l=l.split("?"))||null==(l=l.shift())?void 0:l.toLowerCase(),!(f=c?o.CubeTextureLoader:"hdr"===s?u.x:"exr"===s?K:null))throw Error("useEnvironment: Unrecognized file extension: "+e);let v=(0,i.D)(f,c?[e]:e,e=>{null==e.setPath||e.setPath(r),a&&a(e)}),d=c?v[0]:v;return d.mapping=c?o.CubeReflectionMapping:o.EquirectangularReflectionMapping,"colorSpace"in d?d.colorSpace=(null!=n?n:c)?"srgb":"srgb-linear":d.encoding=(null!=n?n:c)?3001:3e3,d}let et=e=>e.current&&e.current.isScene,en=e=>et(e)?e.current:e;function ea(e,r,t,n,a=0){let i=en(r||t),o=i.background,l=i.environment,s=i.backgroundBlurriness||0;return"only"!==e&&(i.environment=n),e&&(i.background=n),e&&void 0!==i.backgroundBlurriness&&(i.backgroundBlurriness=a),()=>{"only"!==e&&(i.environment=l),e&&(i.background=o),e&&void 0!==i.backgroundBlurriness&&(i.backgroundBlurriness=s)}}function ei({scene:e,background:r=!1,blur:t,map:n}){let o=(0,i.z)(e=>e.scene);return a.useLayoutEffect(()=>{if(n)return ea(r,e,o,n,t)},[o,e,n,r,t]),null}function eo({background:e=!1,scene:r,blur:t,...n}){let o=er(n),l=(0,i.z)(e=>e.scene);return a.useLayoutEffect(()=>ea(e,r,l,o,t),[o,e,r,l,t]),null}function el({children:e,near:r=1,far:t=1e3,resolution:n=256,frames:l=1,map:s,background:u=!1,blur:f,scene:c,files:v,path:d,preset:h,extensions:p}){let w=(0,i.z)(e=>e.gl),g=(0,i.z)(e=>e.scene),m=a.useRef(null),[y]=a.useState(()=>new o.Scene),b=a.useMemo(()=>{let e=new o.WebGLCubeRenderTarget(n);return e.texture.type=o.HalfFloatType,e},[n]);a.useLayoutEffect(()=>(1===l&&m.current.update(w,y),ea(u,c,g,b.texture,f)),[e,y,b.texture,c,g,u,l,w]);let E=1;return(0,i.A)(()=>{(l===1/0||E<l)&&(m.current.update(w,y),E++)}),a.createElement(a.Fragment,null,(0,i.g)(a.createElement(a.Fragment,null,e,a.createElement("cubeCamera",{ref:m,args:[r,t,b]}),v||h?a.createElement(eo,{background:!0,files:v,preset:h,path:d,extensions:p}):s?a.createElement(ei,{background:!0,map:s,extensions:p}):null),y))}function es(e){var r,t,o,l;let u=er(e),f=e.map||u;a.useMemo(()=>(0,i.e)({GroundProjectedEnvImpl:s}),[]);let c=a.useMemo(()=>[f],[f]),v=null==(r=e.ground)?void 0:r.height,d=null==(t=e.ground)?void 0:t.radius,h=null!==(o=null==(l=e.ground)?void 0:l.scale)&&void 0!==o?o:1e3;return a.createElement(a.Fragment,null,a.createElement(ei,(0,n.Z)({},e,{map:f})),a.createElement("groundProjectedEnvImpl",{args:c,scale:h,height:v,radius:d}))}function eu(e){return e.ground?a.createElement(es,e):e.map?a.createElement(ei,e):e.children?a.createElement(el,e):a.createElement(eo,e)}},7848:function(e,r,t){e.exports=t(3397)},4134:function(e,r,t){"use strict";t.d(r,{x:function(){return a}});var n=t(4771);class a extends n.DataTextureLoader{constructor(e){super(e),this.type=n.HalfFloatType}parse(e){let r=function(e,r){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(r||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(r||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(r||""));break;default:console.error("THREE.RGBELoader: Error: "+(r||""))}return -1},t=function(e,r,t){r=r||1024;let n=e.pos,a=-1,i=0,o="",l=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(a=l.indexOf("\n"))&&i<r&&n<e.byteLength;)o+=l,i+=l.length,n+=128,l+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return -1<a&&(!1!==t&&(e.pos+=i+a+1),o+l.slice(0,a))},a=new Uint8Array(e);a.pos=0;let i=function(e){let n,a;let i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,l=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(n=t(e)))return r(1,"no header found");if(!(a=n.match(/^#\?(\S+)/)))return r(3,"bad initial token");for(u.valid|=1,u.programtype=a[1],u.string+=n+"\n";!1!==(n=t(e));){if(u.string+=n+"\n","#"===n.charAt(0)){u.comments+=n+"\n";continue}if((a=n.match(i))&&(u.gamma=parseFloat(a[1])),(a=n.match(o))&&(u.exposure=parseFloat(a[1])),(a=n.match(l))&&(u.valid|=2,u.format=a[1]),(a=n.match(s))&&(u.valid|=4,u.height=parseInt(a[1],10),u.width=parseInt(a[2],10)),2&u.valid&&4&u.valid)break}return 2&u.valid?4&u.valid?u:r(3,"missing image size specifier"):r(3,"missing format specifier")}(a);if(-1!==i){let e=i.width,t=i.height,o=function(e,t,n){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(t!==(e[2]<<8|e[3]))return r(3,"wrong scanline width");let a=new Uint8Array(4*t*n);if(!a.length)return r(4,"unable to allocate buffer space");let i=0,o=0,l=4*t,s=new Uint8Array(4),u=new Uint8Array(l),f=n;for(;f>0&&o<e.byteLength;){if(o+4>e.byteLength)return r(1);if(s[0]=e[o++],s[1]=e[o++],s[2]=e[o++],s[3]=e[o++],2!=s[0]||2!=s[1]||(s[2]<<8|s[3])!=t)return r(3,"bad rgbe scanline format");let n=0,c;for(;n<l&&o<e.byteLength;){c=e[o++];let t=c>128;if(t&&(c-=128),0===c||n+c>l)return r(3,"bad scanline data");if(t){let r=e[o++];for(let e=0;e<c;e++)u[n++]=r}else u.set(e.subarray(o,o+c),n),n+=c,o+=c}for(let e=0;e<t;e++){let r=0;a[i]=u[e+r],r+=t,a[i+1]=u[e+r],r+=t,a[i+2]=u[e+r],r+=t,a[i+3]=u[e+r],i+=4}f--}return a}(a.subarray(a.pos),e,t);if(-1!==o){let r,a,l;switch(this.type){case n.FloatType:l=o.length/4;let s=new Float32Array(4*l);for(let e=0;e<l;e++)!function(e,r,t,n){let a=e[r+3],i=Math.pow(2,a-128)/255;t[n+0]=e[r+0]*i,t[n+1]=e[r+1]*i,t[n+2]=e[r+2]*i,t[n+3]=1}(o,4*e,s,4*e);r=s,a=n.FloatType;break;case n.HalfFloatType:l=o.length/4;let u=new Uint16Array(4*l);for(let e=0;e<l;e++)!function(e,r,t,a){let i=e[r+3],o=Math.pow(2,i-128)/255;t[a+0]=n.DataUtils.toHalfFloat(Math.min(e[r+0]*o,65504)),t[a+1]=n.DataUtils.toHalfFloat(Math.min(e[r+1]*o,65504)),t[a+2]=n.DataUtils.toHalfFloat(Math.min(e[r+2]*o,65504)),t[a+3]=n.DataUtils.toHalfFloat(1)}(o,4*e,u,4*e);r=u,a=n.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:t,data:r,header:i.string,gamma:i.gamma,exposure:i.exposure,type:a}}}return null}setDataType(e){return this.type=e,this}load(e,r,t,a){return super.load(e,function(e,t){switch(e.type){case n.FloatType:case n.HalfFloatType:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=n.LinearFilter,e.magFilter=n.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}r&&r(e,t)},t,a)}}}}]);