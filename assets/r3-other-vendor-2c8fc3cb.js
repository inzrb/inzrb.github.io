import{d as e,C as t,aR as n,al as r,aE as i,b7 as a,U as o,b8 as s,V as l,aS as c,b9 as u,ba as d,bb as f,aU as p,b as h,j as m,u as v,aV as g,q as x,P as y,S as b,r as _,a3 as L,x as S,aN as w,D as M,as as A,a4 as T,bc as E,bd as C,B as R,p as P,M as F,T as I,aI as N,aJ as U,k as z,aC as G,aD as B,aF as D,ac as k,az as O,a7 as j,Y as V,aL as H,Q as X,be as W,R as Y,bf as $,aH as Z,bg as Q,aP as K,bh as q,bi as J,ag as ee,bj as te,Z as ne,bk as re,b0 as ie,a8 as ae,$ as oe,ae as se,bl as le,s as ce,bm as ue,bn as de,aQ as fe,A as pe,bo as he,bp as me}from"./three-vendor-6d04682c.js";import{a as ve,_ as ge,b as xe,R as ye,t as be,g as _e,u as Le}from"./react-vendor-670efa73.js";import{u as Se,s as we,P as Me,c as Ae,a as Te,b as Ee,d as Ce,e as Re,f as Pe,g as Fe,h as Ie,T as Ne,C as Ue,i as ze}from"./r3-extend-vendor-ed1023dc.js";var Ge={exports:{}},Be={},De=ve,ke=Symbol.for("react.element"),Oe=Symbol.for("react.fragment"),je=Object.prototype.hasOwnProperty,Ve=De.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,He={key:!0,ref:!0,__self:!0,__source:!0};function Xe(e,t,n){var r,i={},a=null,o=null;for(r in void 0!==n&&(a=""+n),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(o=t.ref),t)je.call(t,r)&&!He.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:ke,type:e,key:a,ref:o,props:i,_owner:Ve.current}}Be.Fragment=Oe,Be.jsx=Xe,Be.jsxs=Xe,Ge.exports=Be;var We=Ge.exports;const Ye={},$e=function(e,t,n){if(!t||0===t.length)return e();const r=document.getElementsByTagName("link");return Promise.all(t.map((e=>{if((e=function(e){return"/"+e}(e))in Ye)return;Ye[e]=!0;const t=e.endsWith(".css"),i=t?'[rel="stylesheet"]':"";if(!!n)for(let n=r.length-1;n>=0;n--){const i=r[n];if(i.href===e&&(!t||"stylesheet"===i.rel))return}else if(document.querySelector(`link[href="${e}"]${i}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script",a.crossOrigin=""),a.href=e,document.head.appendChild(a),t?new Promise(((t,n)=>{a.addEventListener("load",t),a.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e()))};function Ze(...e){return t=>e.forEach((e=>{return r=t,void("function"==typeof(n=e)?n(r):null!=n&&(n.current=r));var n,r}))}function Qe(...e){return ve.useCallback(Ze(...e),e)}const Ke=ve.forwardRef(((e,t)=>{const{children:n,...r}=e;return ve.Children.toArray(n).some(et)?ve.createElement(ve.Fragment,null,ve.Children.map(n,(e=>et(e)?ve.createElement(qe,ge({},r,{ref:t}),e.props.children):e))):ve.createElement(qe,ge({},r,{ref:t}),n)}));Ke.displayName="Slot";const qe=ve.forwardRef(((e,t)=>{const{children:n,...r}=e;return ve.isValidElement(n)?ve.cloneElement(n,{...tt(r,n.props),ref:Ze(t,n.ref)}):ve.Children.count(n)>1?ve.Children.only(null):null}));qe.displayName="SlotClone";const Je=({children:e})=>ve.createElement(ve.Fragment,null,e);function et(e){return ve.isValidElement(e)&&e.type===Je}function tt(e,t){const n={...t};for(const r in t){const i=e[r],a=t[r];/^on[A-Z]/.test(r)?n[r]=(...e)=>{null==a||a(...e),null==i||i(...e)}:"style"===r?n[r]={...i,...a}:"className"===r&&(n[r]=[i,a].filter(Boolean).join(" "))}return{...e,...n}}const nt=["a","button","div","h2","h3","img","li","nav","ol","p","span","svg","ul"].reduce(((e,t)=>({...e,[t]:ve.forwardRef(((e,n)=>{const{asChild:r,...i}=e,a=r?Ke:t;return ve.useEffect((()=>{window[Symbol.for("radix-ui")]=!0}),[]),ve.createElement(a,ge({},i,{ref:n}))}))})),{}),rt=Boolean(null===globalThis||void 0===globalThis?void 0:globalThis.document)?ve.useLayoutEffect:()=>{},it=ve.forwardRef(((e,t)=>{var n,r;const{containerRef:i,style:a,...o}=e,s=null!==(n=null==i?void 0:i.current)&&void 0!==n?n:null===globalThis||void 0===globalThis||null===(r=globalThis.document)||void 0===r?void 0:r.body,[,l]=ve.useState({});return rt((()=>{l({})}),[]),s?xe.createPortal(ve.createElement(nt.div,ge({"data-radix-portal":""},o,{ref:t,style:s===document.body?{position:"absolute",top:0,left:0,zIndex:2147483647,...a}:void 0})),s):null}));var at=Object.prototype.hasOwnProperty;function ot(e,t){var n,r;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((r=e.length)===t.length)for(;r--&&ot(e[r],t[r]););return-1===r}if(!n||"object"==typeof e){for(n in r=0,e){if(at.call(e,n)&&++r&&!at.call(t,n))return!1;if(!(n in t)||!ot(e[n],t[n]))return!1}return Object.keys(t).length===r}}return e!=e&&t!=t}var st=function(e,t,n,r){this.name=e,this.fn=t,this.args=n,this.modifiers=r};function lt(e,t){return void 0===t&&(t="simple"),"object"==typeof e?e[t]:e}function ct(e,t,n){if(e.length){var r=e.shift(),i=ct(e,t,n);return r.perform(i,n)}return lt(t)}function ut(e,t,n){if(e.length){var r=e.shift(),i=ut(e,t,n);return r.performAsync(i,n)}return function(e){return Promise.resolve(lt(t,"async")(e))}}st.prototype._test=function(e){var t=this.fn;try{ct(this.modifiers.slice(),t,this)(e)}catch(n){t=function(){return!1}}try{return ct(this.modifiers.slice(),t,this)(e)}catch(r){return!1}},st.prototype._check=function(e){try{ct(this.modifiers.slice(),this.fn,this)(e)}catch(t){if(ct(this.modifiers.slice(),(function(e){return e}),this)(!1))return}if(!ct(this.modifiers.slice(),this.fn,this)(e))throw null},st.prototype._testAsync=function(e){var t=this;return new Promise((function(n,r){ut(t.modifiers.slice(),t.fn,t)(e).then((function(t){t?n(e):r(null)})).catch((function(e){return r(e)}))}))};var dt=function(e,t,n){this.name=e,this.perform=t,this.performAsync=n},ft=function(e){function t(n,r,i,a){for(var o=[],s=arguments.length-4;s-- >0;)o[s]=arguments[s+4];e.call(this,o),e.captureStackTrace&&e.captureStackTrace(this,t),this.rule=n,this.value=r,this.cause=i,this.target=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),pt=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.chain=e,this.nextRuleModifiers=t};function ht(e,t,n,r){if(t.length){var i=t.shift();i._testAsync(e).then((function(){ht(e,t,n,r)}),(function(t){r(new ft(i,e,t))}))}else n(e)}pt.prototype._applyRule=function(e,t){var n=this;return function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return n.chain.push(new st(t,e.apply(n,r),r,n.nextRuleModifiers)),n.nextRuleModifiers=[],n}},pt.prototype._applyModifier=function(e,t){return this.nextRuleModifiers.push(new dt(t,e.simple,e.async)),this},pt.prototype._clone=function(){return new pt(this.chain.slice(),this.nextRuleModifiers.slice())},pt.prototype.test=function(e){return this.chain.every((function(t){return t._test(e)}))},pt.prototype.testAll=function(e){var t=[];return this.chain.forEach((function(n){try{n._check(e)}catch(r){t.push(new ft(n,e,r))}})),t},pt.prototype.check=function(e){this.chain.forEach((function(t){try{t._check(e)}catch(n){throw new ft(t,e,n)}}))},pt.prototype.testAsync=function(e){var t=this;return new Promise((function(n,r){ht(e,t.chain.slice(),n,r)}))};var mt=function(e,t){return!(!t||"string"!=typeof e||0!==e.trim().length)||null==e};function vt(){return"undefined"!=typeof Proxy?xt(new pt):yt(new pt)}var gt={};function xt(e){return new Proxy(e,{get:function(t,n){if(n in t)return t[n];var r=xt(e._clone());return n in bt?r._applyModifier(bt[n],n):n in gt?r._applyRule(gt[n],n):n in St?r._applyRule(St[n],n):void 0}})}function yt(e){var t=function(e,t){return Object.keys(e).forEach((function(n){t[n]=function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return yt(t._clone())._applyRule(e[n],n).apply(void 0,r)}})),t},n=t(St,e),r=t(gt,n);return Object.keys(bt).forEach((function(e){Object.defineProperty(r,e,{get:function(){return yt(r._clone())._applyModifier(bt[e],e)}})})),r}vt.extend=function(e){Object.assign(gt,e)},vt.clearCustomRules=function(){gt={}};var bt={not:{simple:function(e){return function(t){return!e(t)}},async:function(e){return function(t){return Promise.resolve(e(t)).then((function(e){return!e})).catch((function(){return!0}))}}},some:{simple:function(e){return function(t){return Lt(t).some((function(t){try{return e(t)}catch(n){return!1}}))}},async:function(e){return function(t){return Promise.all(Lt(t).map((function(t){try{return e(t).catch((function(){return!1}))}catch(n){return!1}}))).then((function(e){return e.some(Boolean)}))}}},every:{simple:function(e){return function(t){return!1!==t&&Lt(t).every(e)}},async:function(e){return function(t){return Promise.all(Lt(t).map(e)).then((function(e){return e.every(Boolean)}))}}},strict:{simple:function(e,t){return function(n){return _t(t)&&n&&"object"==typeof n?Object.keys(t.args[0]).length===Object.keys(n).length&&e(n):e(n)}},async:function(e,t){return function(n){return Promise.resolve(e(n)).then((function(e){return _t(t)&&n&&"object"==typeof n?Object.keys(t.args[0]).length===Object.keys(n).length&&e:e})).catch((function(){return!1}))}}}};function _t(e){return e&&"schema"===e.name&&e.args.length>0&&"object"==typeof e.args[0]}function Lt(e){return"string"==typeof e?e.split(""):e}var St={equal:function(e){return function(t){return t==e}},exact:function(e){return function(t){return t===e}},number:function(e){return void 0===e&&(e=!0),function(t){return"number"==typeof t&&(e||isFinite(t))}},integer:function(){return function(e){return(Number.isInteger||Mt)(e)}},numeric:function(){return function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},string:function(){return wt("string")},boolean:function(){return wt("boolean")},undefined:function(){return wt("undefined")},null:function(){return wt("null")},array:function(){return wt("array")},object:function(){return wt("object")},instanceOf:function(e){return function(t){return t instanceof e}},pattern:function(e){return function(t){return e.test(t)}},lowercase:function(){return function(e){return"boolean"==typeof e||e===e.toLowerCase()&&""!==e.trim()}},uppercase:function(){return function(e){return e===e.toUpperCase()&&""!==e.trim()}},vowel:function(){return function(e){return/^[aeiou]+$/i.test(e)}},consonant:function(){return function(e){return/^(?=[^aeiou])([a-z]+)$/i.test(e)}},first:function(e){return function(t){return t[0]==e}},last:function(e){return function(t){return t[t.length-1]==e}},empty:function(){return function(e){return 0===e.length}},length:function(e,t){return function(n){return n.length>=e&&n.length<=(t||e)}},minLength:function(e){return function(t){return t.length>=e}},maxLength:function(e){return function(t){return t.length<=e}},negative:function(){return function(e){return e<0}},positive:function(){return function(e){return e>=0}},between:function(e,t){return function(n){return n>=e&&n<=t}},range:function(e,t){return function(n){return n>=e&&n<=t}},lessThan:function(e){return function(t){return t<e}},lessThanOrEqual:function(e){return function(t){return t<=e}},greaterThan:function(e){return function(t){return t>e}},greaterThanOrEqual:function(e){return function(t){return t>=e}},even:function(){return function(e){return e%2==0}},odd:function(){return function(e){return e%2!=0}},includes:function(e){return function(t){return~t.indexOf(e)}},schema:function(e){return function(e){return{simple:function(t){var n=[];if(Object.keys(e).forEach((function(r){var i=e[r];try{i.check((t||{})[r])}catch(a){a.target=r,n.push(a)}})),n.length>0)throw n;return!0},async:function(t){var n=[],r=Object.keys(e).map((function(r){return e[r].testAsync((t||{})[r]).catch((function(e){e.target=r,n.push(e)}))}));return Promise.all(r).then((function(){if(n.length>0)throw n;return!0}))}}}(e)},passesAnyOf:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return function(t){return e.some((function(e){return e.test(t)}))}},optional:function(e,t){return void 0===t&&(t=!1),{simple:function(n){return mt(n,t)||void 0===e.check(n)},async:function(n){return mt(n,t)||e.testAsync(n)}}}};function wt(e){return function(t){return Array.isArray(t)&&"array"===e||null===t&&"null"===e||typeof t===e}}function Mt(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}var At,Tt="colors",Et="sizes",Ct="space",Rt={gap:Ct,gridGap:Ct,columnGap:Ct,gridColumnGap:Ct,rowGap:Ct,gridRowGap:Ct,inset:Ct,insetBlock:Ct,insetBlockEnd:Ct,insetBlockStart:Ct,insetInline:Ct,insetInlineEnd:Ct,insetInlineStart:Ct,margin:Ct,marginTop:Ct,marginRight:Ct,marginBottom:Ct,marginLeft:Ct,marginBlock:Ct,marginBlockEnd:Ct,marginBlockStart:Ct,marginInline:Ct,marginInlineEnd:Ct,marginInlineStart:Ct,padding:Ct,paddingTop:Ct,paddingRight:Ct,paddingBottom:Ct,paddingLeft:Ct,paddingBlock:Ct,paddingBlockEnd:Ct,paddingBlockStart:Ct,paddingInline:Ct,paddingInlineEnd:Ct,paddingInlineStart:Ct,top:Ct,right:Ct,bottom:Ct,left:Ct,scrollMargin:Ct,scrollMarginTop:Ct,scrollMarginRight:Ct,scrollMarginBottom:Ct,scrollMarginLeft:Ct,scrollMarginX:Ct,scrollMarginY:Ct,scrollMarginBlock:Ct,scrollMarginBlockEnd:Ct,scrollMarginBlockStart:Ct,scrollMarginInline:Ct,scrollMarginInlineEnd:Ct,scrollMarginInlineStart:Ct,scrollPadding:Ct,scrollPaddingTop:Ct,scrollPaddingRight:Ct,scrollPaddingBottom:Ct,scrollPaddingLeft:Ct,scrollPaddingX:Ct,scrollPaddingY:Ct,scrollPaddingBlock:Ct,scrollPaddingBlockEnd:Ct,scrollPaddingBlockStart:Ct,scrollPaddingInline:Ct,scrollPaddingInlineEnd:Ct,scrollPaddingInlineStart:Ct,fontSize:"fontSizes",background:Tt,backgroundColor:Tt,backgroundImage:Tt,borderImage:Tt,border:Tt,borderBlock:Tt,borderBlockEnd:Tt,borderBlockStart:Tt,borderBottom:Tt,borderBottomColor:Tt,borderColor:Tt,borderInline:Tt,borderInlineEnd:Tt,borderInlineStart:Tt,borderLeft:Tt,borderLeftColor:Tt,borderRight:Tt,borderRightColor:Tt,borderTop:Tt,borderTopColor:Tt,caretColor:Tt,color:Tt,columnRuleColor:Tt,fill:Tt,outline:Tt,outlineColor:Tt,stroke:Tt,textDecorationColor:Tt,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Et,minBlockSize:Et,maxBlockSize:Et,inlineSize:Et,minInlineSize:Et,maxInlineSize:Et,width:Et,minWidth:Et,maxWidth:Et,height:Et,minHeight:Et,maxHeight:Et,flexBasis:Et,gridTemplateColumns:Et,gridTemplateRows:Et,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},Pt=(e,t)=>"function"==typeof t?{"()":Function.prototype.toString.call(t)}:t,Ft=()=>{const e=Object.create(null);return(t,n,...r)=>{const i=(a=t,JSON.stringify(a,Pt));var a;return i in e?e[i]:e[i]=n(t,...r)}},It=Symbol.for("sxs.internal"),Nt=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),Ut=e=>{for(const t in e)return!0;return!1},{hasOwnProperty:zt}=Object.prototype,Gt=e=>e.includes("-")?e:e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),Bt=/\s+(?![^()]*\))/,Dt=e=>t=>e(..."string"==typeof t?String(t).split(Bt):[t]),kt={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),maskSize:e=>({WebkitMaskSize:e,maskSize:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),textSizeAdjust:e=>({WebkitTextSizeAdjust:e,textSizeAdjust:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:Dt(((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e}))),marginInline:Dt(((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e}))),maxSize:Dt(((e,t)=>({maxBlockSize:e,maxInlineSize:t||e}))),minSize:Dt(((e,t)=>({minBlockSize:e,minInlineSize:t||e}))),paddingBlock:Dt(((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e}))),paddingInline:Dt(((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e})))},Ot=/([\d.]+)([^]*)/,jt=(e,t)=>e.length?e.reduce(((e,n)=>(e.push(...t.map((e=>e.includes("&")?e.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(e)?`:is(${n})`:n):n+" "+e))),e)),[]):t,Vt=(e,t)=>e in Ht&&"string"==typeof t?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((t,n,r,i)=>n+("stretch"===r?`-moz-available${i};${Gt(e)}:${n}-webkit-fill-available`:`-moz-fit-content${i};${Gt(e)}:${n}fit-content`)+i)):String(t),Ht={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Xt=e=>e?e+"-":"",Wt=(e,t,n)=>e.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((e,r,i,a,o)=>"$"==a==!!i?e:(r||"--"==a?"calc(":"")+"var(--"+("$"===a?Xt(t)+(o.includes("$")?"":Xt(n))+o.replace(/\$/g,"-"):o)+")"+(r||"--"==a?"*"+(r||"")+(i||"1")+")":""))),Yt=/\s*,\s*(?![^()]*\))/,$t=Object.prototype.toString,Zt=(e,t,n,r,i)=>{let a,o,s;const l=(e,t,n)=>{let c,u;const d=e=>{for(c in e){const h=64===c.charCodeAt(0),m=h&&Array.isArray(e[c])?e[c]:[e[c]];for(u of m){const e=/[A-Z]/.test(p=c)?p:p.replace(/-[^]/g,(e=>e[1].toUpperCase())),m="object"==typeof u&&u&&u.toString===$t&&(!r.utils[e]||!t.length);if(e in r.utils&&!m){const t=r.utils[e];if(t!==o){o=t,d(t(u)),o=null;continue}}else if(e in kt){const t=kt[e];if(t!==s){s=t,d(t(u)),s=null;continue}}if(h&&(f=c.slice(1)in r.media?"@media "+r.media[c.slice(1)]:c,c=f.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((e,t,n,r,i,a)=>{const o=Ot.test(t),s=.0625*(o?-1:1),[l,c]=o?[r,t]:[t,r];return"("+("="===n[0]?"":">"===n[0]===o?"max-":"min-")+l+":"+("="!==n[0]&&1===n.length?c.replace(Ot,((e,t,r)=>Number(t)+s*(">"===n?1:-1)+r)):c)+(i?") and ("+(">"===i[0]?"min-":"max-")+l+":"+(1===i.length?a.replace(Ot,((e,t,n)=>Number(t)+s*(">"===i?-1:1)+n)):a):"")+")"}))),m){const e=h?n.concat(c):[...n],r=h?[...t]:jt(t,c.split(Yt));void 0!==a&&i(Qt(...a)),a=void 0,l(u,r,e)}else void 0===a&&(a=[[],t,n]),c=h||36!==c.charCodeAt(0)?c:`--${Xt(r.prefix)}${c.slice(1).replace(/\$/g,"-")}`,u=m?u:"number"==typeof u?u&&e in Kt?String(u)+"px":String(u):Wt(Vt(e,null==u?"":u),r.prefix,r.themeMap[e]),a[0].push(`${h?`${c} `:`${Gt(c)}:`}${u}`)}}var f,p};d(e),void 0!==a&&i(Qt(...a)),a=void 0};l(e,t,n)},Qt=(e,t,n)=>`${n.map((e=>`${e}{`)).join("")}${t.length?`${t.join(",")}{`:""}${e.join(";")}${t.length?"}":""}${Array(n.length?n.length+1:0).join("}")}`,Kt={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},qt=e=>String.fromCharCode(e+(e>25?39:97)),Jt=e=>(e=>{let t,n="";for(t=Math.abs(e);t>52;t=t/52|0)n=qt(t%52)+n;return qt(t%52)+n})(((e,t)=>{let n=t.length;for(;n;)e=33*e^t.charCodeAt(--n);return e})(5381,JSON.stringify(e))>>>0),en=["themed","global","styled","onevar","resonevar","allvar","inline"],tn=e=>{if(e.href&&!e.href.startsWith(location.origin))return!1;try{return!!e.cssRules}catch(t){return!1}},nn=e=>{let t;const n=()=>{const{cssRules:e}=t.sheet;return[].map.call(e,((n,r)=>{const{cssText:i}=n;let a="";if(i.startsWith("--sxs"))return"";if(e[r-1]&&(a=e[r-1].cssText).startsWith("--sxs")){if(!n.cssRules.length)return"";for(const e in t.rules)if(t.rules[e].group===n)return`--sxs{--sxs:${[...t.rules[e].cache].join(" ")}}${i}`;return n.cssRules.length?`${a}${i}`:""}return i})).join("")},r=()=>{if(t){const{rules:e,sheet:n}=t;if(!n.deleteRule){for(;3===Object(Object(n.cssRules)[0]).type;)n.cssRules.splice(0,1);n.cssRules=[]}for(const t in e)delete e[t]}const i=Object(e).styleSheets||[];for(const e of i)if(tn(e)){for(let i=0,a=e.cssRules;a[i];++i){const o=Object(a[i]);if(1!==o.type)continue;const s=Object(a[i+1]);if(4!==s.type)continue;++i;const{cssText:l}=o;if(!l.startsWith("--sxs"))continue;const c=l.slice(14,-3).trim().split(/\s+/),u=en[c[0]];u&&(t||(t={sheet:e,reset:r,rules:{},toString:n}),t.rules[u]={group:s,index:i,cache:new Set(c)})}if(t)break}if(!t){const i=(e,t)=>({type:t,cssRules:[],insertRule(e,t){this.cssRules.splice(t,0,i(e,{import:3,undefined:1}[(e.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return"@media{}"===e?`@media{${[].map.call(this.cssRules,(e=>e.cssText)).join("")}}`:e}});t={sheet:e?(e.head||e).appendChild(document.createElement("style")).sheet:i("","text/css"),rules:{},reset:r,toString:n}}const{sheet:a,rules:o}=t;for(let e=en.length-1;e>=0;--e){const t=en[e];if(!o[t]){const n=en[e+1],r=o[n]?o[n].index:a.cssRules.length;a.insertRule("@media{}",r),a.insertRule(`--sxs{--sxs:${e}}`,r),o[t]={group:a.cssRules[r+1],index:r,cache:new Set([e])}}rn(o[t])}};return r(),t},rn=e=>{const t=e.group;let n=t.cssRules.length;e.apply=e=>{try{t.insertRule(e,n),++n}catch(r){}}},an=Symbol(),on=Ft(),sn=(e,t)=>on(e,(()=>(...n)=>{let r={type:null,composers:new Set};for(const t of n)if(null!=t)if(t[It]){null==r.type&&(r.type=t[It].type);for(const e of t[It].composers)r.composers.add(e)}else t.constructor!==Object||t.$$typeof?null==r.type&&(r.type=t):r.composers.add(ln(t,e));return null==r.type&&(r.type="span"),r.composers.size||r.composers.add(["PJLV",{},[],[],{},[]]),cn(e,r,t)})),ln=({variants:e,compoundVariants:t,defaultVariants:n,...r},i)=>{const a=`${Xt(i.prefix)}c-${Jt(r)}`,o=[],s=[],l=Object.create(null),c=[];for(const f in n)l[f]=String(n[f]);if("object"==typeof e&&e)for(const f in e){u=l,d=f,zt.call(u,d)||(l[f]="undefined");const t=e[f];for(const e in t){const n={[f]:String(e)};"undefined"===String(e)&&c.push(f);const r=t[e],i=[n,r,!Ut(r)];o.push(i)}}var u,d;if("object"==typeof t&&t)for(const f of t){let{css:e,...t}=f;e="object"==typeof e&&e||{};for(const r in t)t[r]=String(t[r]);const n=[t,e,!Ut(e)];s.push(n)}return[a,r,o,s,l,c]},cn=(e,t,n)=>{const[r,i,a,o]=un(t.composers),s="function"==typeof t.type||t.type.$$typeof?(e=>{function t(){for(let n=0;n<t[an].length;n++){const[r,i]=t[an][n];e.rules[r].apply(i)}return t[an]=[],null}return t[an]=[],t.rules={},en.forEach((e=>t.rules[e]={apply:n=>t[an].push([e,n])})),t})(n):null,l=(s||n).rules,c=`.${r}${i.length>1?`:where(.${i.slice(1).join(".")})`:""}`,u=u=>{u="object"==typeof u&&u||fn;const{css:d,...f}=u,p={};for(const e in a)if(delete f[e],e in u){let t=u[e];"object"==typeof t&&t?p[e]={"@initial":a[e],...t}:(t=String(t),p[e]="undefined"!==t||o.has(e)?t:a[e])}else p[e]=a[e];const h=new Set([...i]);for(const[r,i,a,o]of t.composers){n.rules.styled.cache.has(r)||(n.rules.styled.cache.add(r),Zt(i,[`.${r}`],[],e,(e=>{l.styled.apply(e)})));const t=dn(a,p,e.media),s=dn(o,p,e.media,!0);for(const i of t)if(void 0!==i)for(const[t,a,o]of i){const i=`${r}-${Jt(a)}-${t}`;h.add(i);const s=(o?n.rules.resonevar:n.rules.onevar).cache,c=o?l.resonevar:l.onevar;s.has(i)||(s.add(i),Zt(a,[`.${i}`],[],e,(e=>{c.apply(e)})))}for(const i of s)if(void 0!==i)for(const[t,a]of i){const i=`${r}-${Jt(a)}-${t}`;h.add(i),n.rules.allvar.cache.has(i)||(n.rules.allvar.cache.add(i),Zt(a,[`.${i}`],[],e,(e=>{l.allvar.apply(e)})))}}if("object"==typeof d&&d){const t=`${r}-i${Jt(d)}-css`;h.add(t),n.rules.inline.cache.has(t)||(n.rules.inline.cache.add(t),Zt(d,[`.${t}`],[],e,(e=>{l.inline.apply(e)})))}for(const e of String(u.className||"").trim().split(/\s+/))e&&h.add(e);const m=f.className=[...h].join(" ");return{type:t.type,className:m,selector:c,props:f,toString:()=>m,deferredInjector:s}};return Nt(u,{className:r,selector:c,[It]:t,toString:()=>(n.rules.styled.cache.has(r)||u(),r)})},un=e=>{let t="";const n=[],r={},i=[];for(const[a,,,,o,s]of e){""===t&&(t=a),n.push(a),i.push(...s);for(const e in o){const t=o[e];(void 0===r[e]||"undefined"!==t||s.includes(t))&&(r[e]=t)}}return[t,n,r,new Set(i)]},dn=(e,t,n,r)=>{const i=[];e:for(let[a,o,s]of e){if(s)continue;let e,l=0,c=!1;for(e in a){const r=a[e];let i=t[e];if(i!==r){if("object"!=typeof i||!i)continue e;{let e,t,a=0;for(const o in i){if(r===String(i[o])){if("@initial"!==o){const e=o.slice(1);(t=t||[]).push(e in n?n[e]:o.replace(/^@media ?/,"")),c=!0}l+=a,e=!0}++a}if(t&&t.length&&(o={["@media "+t.join(", ")]:o}),!e)continue e}}}(i[l]=i[l]||[]).push([r?"cv":`${e}-${a[e]}`,o,c])}return i},fn={},pn=Ft(),hn=(e,t)=>pn(e,(()=>(...n)=>{const r=()=>{for(let r of n){r="object"==typeof r&&r||{};let n=Jt(r);if(!t.rules.global.cache.has(n)){if(t.rules.global.cache.add(n),"@import"in r){let e=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let n of[].concat(r["@import"]))n=n.includes('"')||n.includes("'")?n:`"${n}"`,t.sheet.insertRule(`@import ${n};`,e++);delete r["@import"]}Zt(r,[],[],e,(e=>{t.rules.global.apply(e)}))}}return""};return Nt(r,{toString:r})})),mn=Ft(),vn=(e,t)=>mn(e,(()=>n=>{const r=`${Xt(e.prefix)}k-${Jt(n)}`,i=()=>{if(!t.rules.global.cache.has(r)){t.rules.global.cache.add(r);const i=[];Zt(n,[],[],e,(e=>i.push(e)));const a=`@keyframes ${r}{${i.join("")}}`;t.rules.global.apply(a)}return r};return Nt(i,{get name(){return i()},toString:i})})),gn=class{constructor(e,t,n,r){this.token=null==e?"":String(e),this.value=null==t?"":String(t),this.scale=null==n?"":String(n),this.prefix=null==r?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Xt(this.prefix)+Xt(this.scale)+this.token}toString(){return this.computedValue}},xn=Ft(),yn=(e,t)=>xn(e,(()=>(n,r)=>{r="object"==typeof n&&n||Object(r);const i=`.${n=(n="string"==typeof n?n:"")||`${Xt(e.prefix)}t-${Jt(r)}`}`,a={},o=[];for(const t in r){a[t]={};for(const n in r[t]){const i=`--${Xt(e.prefix)}${t}-${n}`,s=Wt(String(r[t][n]),e.prefix,t);a[t][n]=new gn(n,s,t,e.prefix),o.push(`${i}:${s}`)}}const s=()=>{if(o.length&&!t.rules.themed.cache.has(n)){t.rules.themed.cache.add(n);const i=`${r===e.theme?":root,":""}.${n}{${o.join(";")}}`;t.rules.themed.apply(i)}return n};return{...a,get className(){return s()},selector:i,toString:s}})),bn=Ft(),_n=Ft(),Ln=e=>{const t=(e=>{let t=!1;const n=bn(e,(e=>{t=!0;const n="prefix"in(e="object"==typeof e&&e||{})?String(e.prefix):"",r="object"==typeof e.media&&e.media||{},i="object"==typeof e.root?e.root||null:globalThis.document||null,a="object"==typeof e.theme&&e.theme||{},o={prefix:n,media:r,theme:a,themeMap:"object"==typeof e.themeMap&&e.themeMap||{...Rt},utils:"object"==typeof e.utils&&e.utils||{}},s=nn(i),l={css:sn(o,s),globalCss:hn(o,s),keyframes:vn(o,s),createTheme:yn(o,s),reset(){s.reset(),l.theme.toString()},theme:{},sheet:s,config:o,prefix:n,getCssText:s.toString,toString:s.toString};return String(l.theme=l.createTheme(a)),l}));return t||n.reset(),n})(e);return t.styled=(({config:e,sheet:t})=>_n(e,(()=>{const n=sn(e,t);return(...e)=>{const t=n(...e),r=t[It].type,i=ye.forwardRef(((e,n)=>{const i=e&&e.as||r,{props:a,deferredInjector:o}=t(e);return delete a.as,a.ref=n,o?ye.createElement(ye.Fragment,null,ye.createElement(i,a),ye.createElement(o,null)):ye.createElement(i,a)}));return i.className=t.className,i.displayName=`Styled.${r.displayName||r.name||r}`,i.selector=t.selector,i.toString=()=>t.selector,i[It]=t[It],i}})))(t),t},Sn=(...e)=>(At||(At=Ln())).styled(...e);const wn=be["useId".toString()]||(()=>{});let Mn=0;const An=["a","button","div","h2","h3","img","li","nav","p","span","svg","ul"].reduce(((e,t)=>({...e,[t]:ve.forwardRef(((e,n)=>{const{asChild:r,...i}=e,a=r?Ke:t;return ve.useEffect((()=>{window[Symbol.for("radix-ui")]=!0}),[]),e.as&&console.error(Tn),ve.createElement(a,ge({},i,{ref:n}))}))})),{}),Tn="Warning: The `as` prop has been removed in favour of `asChild`. For details, see https://radix-ui.com/docs/primitives/overview/styling#changing-the-rendered-element",En=ve.forwardRef(((e,t)=>ve.createElement(An.span,ge({},e,{ref:t,style:{...e.style,position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}})))),Cn=ve.forwardRef(((e,t)=>{var n,r;const{containerRef:i,style:a,...o}=e,s=null!==(n=null==i?void 0:i.current)&&void 0!==n?n:null===globalThis||void 0===globalThis||null===(r=globalThis.document)||void 0===r?void 0:r.body,[,l]=ve.useState({});return rt((()=>{l({})}),[]),s?xe.createPortal(ve.createElement(An.div,ge({"data-radix-portal":""},o,{ref:t,style:s===document.body?{position:"absolute",top:0,left:0,zIndex:2147483647,...a}:void 0})),s):null})),Rn=ve.forwardRef(((e,t)=>{const{children:n,width:r=10,height:i=5,...a}=e;return ve.createElement(An.svg,ge({},a,{ref:t,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),e.asChild?n:ve.createElement("polygon",{points:"0,0 30,0 15,10"}))}));function Pn(e){const[t,n]=ve.useState(void 0);return ve.useEffect((()=>{if(e){const t=new ResizeObserver((t=>{if(!Array.isArray(t))return;if(!t.length)return;const r=t[0];let i,a;if("borderBoxSize"in r){const e=r.borderBoxSize,t=Array.isArray(e)?e[0]:e;i=t.inlineSize,a=t.blockSize}else{const t=e.getBoundingClientRect();i=t.width,a=t.height}n({width:i,height:a})}));return t.observe(e,{box:"border-box"}),()=>{n(void 0),t.unobserve(e)}}}),[e]),t}let Fn;const In=new Map;function Nn(){const e=[];In.forEach(((t,n)=>{const r=n.getBoundingClientRect();var i,a;a=r,((i=t.rect).width!==a.width||i.height!==a.height||i.top!==a.top||i.right!==a.right||i.bottom!==a.bottom||i.left!==a.left)&&(t.rect=r,e.push(t))})),e.forEach((e=>{e.callbacks.forEach((t=>t(e.rect)))})),Fn=requestAnimationFrame(Nn)}function Un(e){const[t,n]=ve.useState();return ve.useEffect((()=>{if(e){const t=function(e,t){const n=In.get(e);return void 0===n?(In.set(e,{rect:{},callbacks:[t]}),1===In.size&&(Fn=requestAnimationFrame(Nn))):(n.callbacks.push(t),t(e.getBoundingClientRect())),()=>{const n=In.get(e);if(void 0===n)return;const r=n.callbacks.indexOf(t);r>-1&&n.callbacks.splice(r,1),0===n.callbacks.length&&(In.delete(e),0===In.size&&cancelAnimationFrame(Fn))}}(e,n);return()=>{n(void 0),t()}}}),[e]),t}function zn(e,t=[]){let n=[];const r=()=>{const t=n.map((e=>ve.createContext(e)));return function(n){const r=(null==n?void 0:n[e])||t;return ve.useMemo((()=>({[`__scope${e}`]:{...n,[e]:r}})),[n,r])}};return r.scopeName=e,[function(t,r){const i=ve.createContext(r),a=n.length;function o(t){const{scope:n,children:r,...o}=t,s=(null==n?void 0:n[e][a])||i,l=ve.useMemo((()=>o),Object.values(o));return ve.createElement(s.Provider,{value:l},r)}return n=[...n,r],o.displayName=t+"Provider",[o,function(n,o){const s=(null==o?void 0:o[e][a])||i,l=ve.useContext(s);if(l)return l;if(void 0!==r)return r;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},Gn(r,...t)]}function Gn(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(e){const r=n.reduce(((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]})),{});return ve.useMemo((()=>({[`__scope${t.scopeName}`]:r})),[r])}};return n.scopeName=t.scopeName,n}function Bn(e,t,n){const r=e["x"===n?"left":"top"],i="x"===n?"width":"height",a=e[i],o=t[i];return{before:r-o,start:r,center:r+(a-o)/2,end:r+a-o,after:r+a}}function Dn(e){return{position:"absolute",top:0,left:0,minWidth:"max-content",willChange:"transform",transform:`translate3d(${Math.round(e.x+window.scrollX)}px, ${Math.round(e.y+window.scrollY)}px, 0)`}}function kn(e,t,n,r,i){const a="top"===t||"bottom"===t,o=i?i.width:0,s=i?i.height:0,l=o/2+r;let c="",u="";return a?(c={start:`${l}px`,center:"center",end:e.width-l+"px"}[n],u="top"===t?`${e.height+s}px`:-s+"px"):(c="left"===t?`${e.width+s}px`:-s+"px",u={start:`${l}px`,center:"center",end:e.height-l+"px"}[n]),`${c} ${u}`}const On={position:"fixed",top:0,left:0,opacity:0,transform:"translate3d(0, -200%, 0)"},jn={position:"absolute",opacity:0};function Vn({popperSize:e,arrowSize:t,arrowOffset:n,side:r,align:i}){const a=(e.width-t.width)/2,o=(e.height-t.width)/2,s={top:0,right:90,bottom:180,left:-90}[r],l=Math.max(t.width,t.height),c={width:`${l}px`,height:`${l}px`,transform:`rotate(${s}deg)`,willChange:"transform",position:"absolute",[r]:"100%",direction:Hn(r,i)};return"top"!==r&&"bottom"!==r||("start"===i&&(c.left=`${n}px`),"center"===i&&(c.left=`${a}px`),"end"===i&&(c.right=`${n}px`)),"left"!==r&&"right"!==r||("start"===i&&(c.top=`${n}px`),"center"===i&&(c.top=`${o}px`),"end"===i&&(c.bottom=`${n}px`)),c}function Hn(e,t){return("top"!==e&&"right"!==e||"end"!==t)&&("bottom"!==e&&"left"!==e||"end"===t)?"ltr":"rtl"}function Xn(e){return{top:"bottom",right:"left",bottom:"top",left:"right"}[e]}function Wn(e,t){return{top:e.top<t.top,right:e.right>t.right,bottom:e.bottom>t.bottom,left:e.left<t.left}}const[Yn,$n]=zn("Popper"),[Zn,Qn]=Yn("Popper"),Kn=ve.forwardRef(((e,t)=>{const{__scopePopper:n,virtualRef:r,...i}=e,a=Qn("PopperAnchor",n),o=ve.useRef(null),s=Qe(t,o);return ve.useEffect((()=>{a.onAnchorChange((null==r?void 0:r.current)||o.current)})),r?null:ve.createElement(An.div,ge({},i,{ref:s}))})),[qn,Jn]=Yn("PopperContent"),er=ve.forwardRef(((e,t)=>{const{__scopePopper:n,side:r="bottom",sideOffset:i,align:a="center",alignOffset:o,collisionTolerance:s,avoidCollisions:l=!0,...c}=e,u=Qn("PopperContent",n),[d,f]=ve.useState(),p=Un(u.anchor),[h,m]=ve.useState(null),v=Pn(h),[g,x]=ve.useState(null),y=Pn(g),b=Qe(t,(e=>m(e))),_=function(){const[e,t]=ve.useState(void 0);return ve.useEffect((()=>{let e;function n(){t({width:window.innerWidth,height:window.innerHeight})}function r(){window.clearTimeout(e),e=window.setTimeout(n,100)}return n(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)}),[]),e}(),L=_?DOMRect.fromRect({..._,x:0,y:0}):void 0,{popperStyles:S,arrowStyles:w,placedSide:M,placedAlign:A}=function({anchorRect:e,popperSize:t,arrowSize:n,arrowOffset:r=0,side:i,sideOffset:a=0,align:o,alignOffset:s=0,shouldAvoidCollisions:l=!0,collisionBoundariesRect:c,collisionTolerance:u=0}){if(!e||!t||!c)return{popperStyles:On,arrowStyles:jn};const d=function(e,t,n=0,r=0,i){const a=i?i.height:0,o=Bn(t,e,"x"),s=Bn(t,e,"y"),l=s.before-n-a,c=s.after+n+a,u=o.before-n-a,d=o.after+n+a;return{top:{start:{x:o.start+r,y:l},center:{x:o.center,y:l},end:{x:o.end-r,y:l}},right:{start:{x:d,y:s.start+r},center:{x:d,y:s.center},end:{x:d,y:s.end-r}},bottom:{start:{x:o.start+r,y:c},center:{x:o.center,y:c},end:{x:o.end-r,y:c}},left:{start:{x:u,y:s.start+r},center:{x:u,y:s.center},end:{x:u,y:s.end-r}}}}(t,e,a,s,n),f=d[i][o];if(!1===l){const e=Dn(f);let a=jn;return n&&(a=Vn({popperSize:t,arrowSize:n,arrowOffset:r,side:i,align:o})),{popperStyles:{...e,"--radix-popper-transform-origin":kn(t,i,o,r,n)},arrowStyles:a,placedSide:i,placedAlign:o}}const p=DOMRect.fromRect({...t,...f}),h=(m=c,v=u,DOMRect.fromRect({width:m.width-2*v,height:m.height-2*v,x:m.left+v,y:m.top+v}));var m,v;const g=Wn(p,h),x=d[Xn(i)][o],y=function(e,t,n){const r=Xn(e);return t[e]&&!n[r]?r:e}(i,g,Wn(DOMRect.fromRect({...t,...x}),h)),b=function(e,t,n,r,i){const a="top"===n||"bottom"===n,o=a?"left":"top",s=a?"right":"bottom",l=a?"width":"height",c=t[l]>e[l];return"start"!==r&&"center"!==r||!(i[o]&&c||i[s]&&!c)?"end"!==r&&"center"!==r||!(i[s]&&c||i[o]&&!c)?r:"start":"end"}(t,e,i,o,g),_=Dn(d[y][b]);let L=jn;return n&&(L=Vn({popperSize:t,arrowSize:n,arrowOffset:r,side:y,align:b})),{popperStyles:{..._,"--radix-popper-transform-origin":kn(t,y,b,r,n)},arrowStyles:L,placedSide:y,placedAlign:b}}({anchorRect:p,popperSize:v,arrowSize:y,arrowOffset:d,side:r,sideOffset:i,align:a,alignOffset:o,shouldAvoidCollisions:l,collisionBoundariesRect:L,collisionTolerance:s}),T=void 0!==M;return ve.createElement("div",{style:S,"data-radix-popper-content-wrapper":""},ve.createElement(qn,{scope:n,arrowStyles:w,onArrowChange:x,onArrowOffsetChange:f},ve.createElement(An.div,ge({"data-side":M,"data-align":A},c,{style:{...c.style,animation:T?void 0:"none"},ref:b}))))})),tr=ve.forwardRef((function(e,t){const{__scopePopper:n,offset:r,...i}=e,a=Jn("PopperArrow",n),{onArrowOffsetChange:o}=a;return ve.useEffect((()=>o(r)),[o,r]),ve.createElement("span",{style:{...a.arrowStyles,pointerEvents:"none"}},ve.createElement("span",{ref:a.onArrowChange,style:{display:"inline-block",verticalAlign:"top",pointerEvents:"auto"}},ve.createElement(Rn,ge({},i,{ref:t,style:{...i.style,display:"block"}}))))})),nr=e=>{const{__scopePopper:t,children:n}=e,[r,i]=ve.useState(null);return ve.createElement(Zn,{scope:t,anchor:r,onAnchorChange:i},n)},rr=Kn,ir=er,ar=tr,or=e=>{const{present:t,children:n}=e,r=function(e){const[t,n]=ve.useState(),r=ve.useRef({}),i=ve.useRef(e),a=ve.useRef("none"),o=e?"mounted":"unmounted",[s,l]=(c=o,u={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},ve.useReducer(((e,t)=>{const n=u[e][t];return null!=n?n:e}),c));var c,u;return ve.useEffect((()=>{const e=sr(r.current);a.current="mounted"===s?e:"none"}),[s]),rt((()=>{const t=r.current,n=i.current;if(n!==e){const r=a.current,o=sr(t);if(e)l("MOUNT");else if("none"===o||"none"===(null==t?void 0:t.display))l("UNMOUNT");else{l(n&&r!==o?"ANIMATION_OUT":"UNMOUNT")}i.current=e}}),[e,l]),rt((()=>{if(t){const e=e=>{const n=sr(r.current).includes(e.animationName);e.target===t&&n&&l("ANIMATION_END")},n=e=>{e.target===t&&(a.current=sr(r.current))};return t.addEventListener("animationstart",n),t.addEventListener("animationcancel",e),t.addEventListener("animationend",e),()=>{t.removeEventListener("animationstart",n),t.removeEventListener("animationcancel",e),t.removeEventListener("animationend",e)}}}),[t,l]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:ve.useCallback((e=>{e&&(r.current=getComputedStyle(e)),n(e)}),[])}}(t),i="function"==typeof n?n({present:r.isPresent}):ve.Children.only(n),a=Qe(r.ref,i.ref);return"function"==typeof n||r.isPresent?ve.cloneElement(i,{ref:a}):null};function sr(e){return(null==e?void 0:e.animationName)||"none"}function lr(e){const t=ve.useRef(e);return ve.useEffect((()=>{t.current=e}),[e]),t.current}function cr(e){const t=ve.useRef(e);return ve.useEffect((()=>{t.current=e})),ve.useMemo((()=>(...e)=>{var n;return null===(n=t.current)||void 0===n?void 0:n.call(t,...e)}),[])}function ur(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(null==e||e(r),!1===n||!r.defaultPrevented)return null==t?void 0:t(r)}}or.displayName="Presence";const[dr,fr]=zn("Tooltip",[$n]),pr=$n(),[hr,mr]=dr("TooltipProvider",{isOpenDelayed:!0,delayDuration:700,onOpen:()=>{},onClose:()=>{}}),[vr,gr]=dr("Tooltip"),xr=ve.forwardRef(((e,t)=>{const{__scopeTooltip:n,...r}=e,i=gr("TooltipTrigger",n),a=pr(n),o=Qe(t,i.onTriggerChange),s=ve.useRef(!1),l=ve.useCallback((()=>s.current=!1),[]);return ve.useEffect((()=>()=>document.removeEventListener("mouseup",l)),[l]),ve.createElement(rr,ge({asChild:!0},a),ve.createElement(An.button,ge({"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute},r,{ref:o,onMouseEnter:ur(e.onMouseEnter,i.onTriggerEnter),onMouseLeave:ur(e.onMouseLeave,i.onClose),onMouseDown:ur(e.onMouseDown,(()=>{i.onClose(),s.current=!0,document.addEventListener("mouseup",l,{once:!0})})),onFocus:ur(e.onFocus,(()=>{s.current||i.onOpen()})),onBlur:ur(e.onBlur,i.onClose),onClick:ur(e.onClick,i.onClose)})))})),yr=ve.forwardRef(((e,t)=>{const{forceMount:n,...r}=e,i=gr("TooltipContent",e.__scopeTooltip);return ve.createElement(or,{present:n||i.open},ve.createElement(br,ge({ref:t},r)))})),br=ve.forwardRef(((e,t)=>{const{__scopeTooltip:n,children:r,"aria-label":i,portalled:a=!0,...o}=e,s=gr("TooltipContent",n),l=pr(n),c=a?Cn:ve.Fragment,{onClose:u}=s;return function(e){const t=cr(e);ve.useEffect((()=>{const e=e=>{"Escape"===e.key&&t(e)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[t])}((()=>u())),ve.useEffect((()=>(document.addEventListener("tooltip.open",u),()=>document.removeEventListener("tooltip.open",u))),[u]),ve.createElement(c,null,ve.createElement(Lr,{__scopeTooltip:n}),ve.createElement(ir,ge({"data-state":s.stateAttribute},l,o,{ref:t,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)"}}),ve.createElement(Je,null,r),ve.createElement(En,{id:s.contentId,role:"tooltip"},i||r)))})),_r=ve.forwardRef(((e,t)=>{const{__scopeTooltip:n,...r}=e,i=pr(n);return ve.createElement(ar,ge({},i,r,{ref:t}))}));function Lr(e){const{__scopeTooltip:t}=e,n=gr("CheckTriggerMoved",t),r=Un(n.trigger),i=null==r?void 0:r.left,a=lr(i),o=null==r?void 0:r.top,s=lr(o),l=n.onClose;return ve.useEffect((()=>{(void 0!==a&&a!==i||void 0!==s&&s!==o)&&l()}),[l,a,s,i,o]),null}const Sr=e=>{const{__scopeTooltip:t,children:n,open:r,defaultOpen:i=!1,onOpenChange:a,delayDuration:o}=e,s=mr("Tooltip",t),l=pr(t),[c,u]=ve.useState(null),d=function(e){const[t,n]=ve.useState(wn());return rt((()=>{e||n((e=>null!=e?e:String(Mn++)))}),[e]),e||(t?`radix-${t}`:"")}(),f=ve.useRef(0),p=null!=o?o:s.delayDuration,h=ve.useRef(!1),{onOpen:m,onClose:v}=s,[g=!1,x]=function({prop:e,defaultProp:t,onChange:n=(()=>{})}){const[r,i]=function({defaultProp:e,onChange:t}){const n=ve.useState(e),[r]=n,i=ve.useRef(r),a=cr(t);return ve.useEffect((()=>{i.current!==r&&(a(r),i.current=r)}),[r,i,a]),n}({defaultProp:t,onChange:n}),a=void 0!==e,o=a?e:r,s=cr(n);return[o,ve.useCallback((t=>{if(a){const n="function"==typeof t?t(e):t;n!==e&&s(n)}else i(t)}),[a,e,i,s])]}({prop:r,defaultProp:i,onChange:e=>{e&&(document.dispatchEvent(new CustomEvent("tooltip.open")),m()),null==a||a(e)}}),y=ve.useMemo((()=>g?h.current?"delayed-open":"instant-open":"closed"),[g]),b=ve.useCallback((()=>{window.clearTimeout(f.current),h.current=!1,x(!0)}),[x]),_=ve.useCallback((()=>{window.clearTimeout(f.current),f.current=window.setTimeout((()=>{h.current=!0,x(!0)}),p)}),[p,x]);return ve.useEffect((()=>()=>window.clearTimeout(f.current)),[]),ve.createElement(nr,l,ve.createElement(vr,{scope:t,contentId:d,open:g,stateAttribute:y,trigger:c,onTriggerChange:u,onTriggerEnter:ve.useCallback((()=>{s.isOpenDelayed?_():b()}),[s.isOpenDelayed,_,b]),onOpen:ve.useCallback(b,[b]),onClose:ve.useCallback((()=>{window.clearTimeout(f.current),x(!1),v()}),[x,v])},n))},wr=xr,Mr=yr,Ar=_r;function Tr(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let Er;var Cr;(Cr=Er||(Er={}))[Cr.UNSUPPORTED_INPUT=0]="UNSUPPORTED_INPUT",Cr[Cr.NO_COMPONENT_FOR_TYPE=1]="NO_COMPONENT_FOR_TYPE",Cr[Cr.UNKNOWN_INPUT=2]="UNKNOWN_INPUT",Cr[Cr.DUPLICATE_KEYS=3]="DUPLICATE_KEYS",Cr[Cr.ALREADY_REGISTERED_TYPE=4]="ALREADY_REGISTERED_TYPE",Cr[Cr.CLIPBOARD_ERROR=5]="CLIPBOARD_ERROR",Cr[Cr.THEME_ERROR=6]="THEME_ERROR",Cr[Cr.PATH_DOESNT_EXIST=7]="PATH_DOESNT_EXIST",Cr[Cr.INPUT_TYPE_OVERRIDE=8]="INPUT_TYPE_OVERRIDE",Cr[Cr.EMPTY_KEY=9]="EMPTY_KEY";const Rr={[Er.UNSUPPORTED_INPUT]:(e,t)=>[`An input with type \`${e}\` input was found at path \`${t}\` but it's not supported yet.`],[Er.NO_COMPONENT_FOR_TYPE]:(e,t)=>[`Type \`${e}\` found at path \`${t}\` can't be displayed in panel because no component supports it yet.`],[Er.UNKNOWN_INPUT]:(e,t)=>[`input at path \`${e}\` is not recognized.`,t],[Er.DUPLICATE_KEYS]:(e,t,n)=>[`Key \`${e}\` of path \`${t}\` already exists at path \`${n}\`. Even nested keys need to be unique. Rename one of the keys.`],[Er.ALREADY_REGISTERED_TYPE]:e=>[`Type ${e} has already been registered. You can't register a component with the same type.`],[Er.CLIPBOARD_ERROR]:e=>["Error copying the value",e],[Er.THEME_ERROR]:(e,t)=>[`Error accessing the theme \`${e}.${t}\` value.`],[Er.PATH_DOESNT_EXIST]:e=>[`Error getting the value at path \`${e}\`. There is probably an error in your \`render\` function.`],[Er.PATH_DOESNT_EXIST]:e=>[`Error accessing the value at path \`${e}\``],[Er.INPUT_TYPE_OVERRIDE]:(e,t,n)=>[`Input at path \`${e}\` already exists with type: \`${t}\`. Its type cannot be overridden with type \`${n}\`.`],[Er.EMPTY_KEY]:()=>["Keys can not be empty, if you want to hide a label use whitespace."]};function Pr(e,t,...n){const[r,...i]=Rr[t](...n);console[e]("LEVA: "+r,...i)}const Fr=Pr.bind(null,"warn"),Ir=Pr.bind(null,"log"),Nr=["value"],Ur=["schema"],zr=["value"],Gr=[],Br={};function Dr(e){let{value:t}=e,n=Tr(e,Nr);for(let r of Gr){const e=r(t,n);if(e)return e}}function kr(e,t){let{schema:n}=t,r=Tr(t,Ur);e in Br?Fr(Er.ALREADY_REGISTERED_TYPE,e):(Gr.push(((t,r)=>n(t,r)&&e)),Br[e]=r)}function Or(e,t,n,r){const{normalize:i}=Br[e];if(i)return i(t,n,r);if("object"!=typeof t||!("value"in t))return{value:t};const{value:a}=t;return{value:a,settings:Tr(t,zr)}}function jr(e,t,n){const{format:r}=Br[e];return r?r(t,n):t}function Vr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Hr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hr(Object(n),!0).forEach((function(t){Vr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Wr=(e,t,n)=>e>n?n:e<t?t:e,Yr=e=>{if(""===e||"number"==typeof e)return e;try{const t=ii(e);if(!isNaN(t))return t}catch(t){}return parseFloat(e)},$r=Math.log(10);function Zr(e){let t=Math.abs(+String(e).replace(".",""));if(0===t)return.01;for(;0!==t&&t%10==0;)t/=10;const n=Math.floor(Math.log(t)/$r)+1,r=Math.floor(Math.log10(Math.abs(e))),i=Math.pow(10,r-n);return Math.max(i,.001)}const Qr=(e,t,n)=>{if(n===t)return 0;return(Wr(e,t,n)-t)/(n-t)},Kr=(e,t,n)=>e*(n-t)+t,qr=/\(([0-9+\-*/^ .]+)\)/,Jr=/(\d+(?:\.\d+)?) ?\^ ?(\d+(?:\.\d+)?)/,ei=/(\d+(?:\.\d+)?) ?\* ?(\d+(?:\.\d+)?)/,ti=/(\d+(?:\.\d+)?) ?\/ ?(\d+(?:\.\d+)?)/,ni=/(\d+(?:\.\d+)?) ?\+ ?(\d+(?:\.\d+)?)/,ri=/(\d+(?:\.\d+)?) ?- ?(\d+(?:\.\d+)?)/;function ii(e){if(isNaN(Number(e))){if(qr.test(e)){const t=e.replace(qr,((e,t)=>String(ii(t))));return ii(t)}if(Jr.test(e)){return ii(e.replace(Jr,((e,t,n)=>String(Math.pow(Number(t),Number(n))))))}if(ei.test(e)){return ii(e.replace(ei,((e,t,n)=>String(Number(t)*Number(n)))))}if(ti.test(e)){return ii(e.replace(ti,((e,t,n)=>{if(0!=n)return String(Number(t)/Number(n));throw new Error("Division by zero")})))}if(ni.test(e)){return ii(e.replace(ni,((e,t,n)=>String(Number(t)+Number(n)))))}if(ri.test(e)){return ii(e.replace(ri,((e,t,n)=>String(Number(t)-Number(n)))))}return Number(e)}return Number(e)}function ai(e){return"[object Object]"===Object.prototype.toString.call(e)}const oi=e=>ai(e)&&0===Object.keys(e).length;let si;var li;let ci;var ui;(li=si||(si={})).BUTTON="BUTTON",li.BUTTON_GROUP="BUTTON_GROUP",li.MONITOR="MONITOR",li.FOLDER="FOLDER",(ui=ci||(ci={})).SELECT="SELECT",ui.IMAGE="IMAGE",ui.NUMBER="NUMBER",ui.COLOR="COLOR",ui.STRING="STRING",ui.BOOLEAN="BOOLEAN",ui.INTERVAL="INTERVAL",ui.VECTOR3D="VECTOR3D",ui.VECTOR2D="VECTOR2D";const di=["type","__customInput"],fi=["render","label","optional","order","disabled","hint","onChange","onEditStart","onEditEnd","transient"],pi=["type"];function hi(e,t,n={},r){var i,a;if("object"!=typeof e||Array.isArray(e))return{type:r,input:e,options:Xr({key:t,label:t,optional:!1,disabled:!1,order:0},n)};if("__customInput"in e){const{type:n,__customInput:r}=e;return hi(r,t,Tr(e,di),n)}const{render:o,label:s,optional:l,order:c=0,disabled:u,hint:d,onChange:f,onEditStart:p,onEditEnd:h,transient:m}=e,v=Tr(e,fi),g=Xr({render:o,key:t,label:null!=s?s:t,hint:d,transient:null!=m?m:!!f,onEditStart:p,onEditEnd:h,disabled:u,optional:l,order:c},n);let x,{type:y}=v,b=Tr(v,pi);return y=null!=r?r:y,y in si?{type:y,input:b,options:g}:(x=r&&ai(b)&&"value"in b?b.value:oi(b)?void 0:b,{type:y,input:x,options:Xr(Xr({},g),{},{onChange:f,optional:null!==(i=g.optional)&&void 0!==i&&i,disabled:null!==(a=g.disabled)&&void 0!==a&&a})})}function mi(e,t,n,r){const i=hi(e,t),{type:a,input:o,options:s}=i;if(a)return a in si?i:{type:a,input:Or(a,o,n,r),options:s};let l=Dr(o);return l?{type:l,input:Or(l,o,n,r),options:s}:(l=Dr({value:o}),!!l&&{type:l,input:Or(l,{value:o},n,r),options:s})}function vi(e,t,n,r,i){const{value:a,type:o,settings:s}=e;e.value=xi({type:o,value:a,settings:s},t,n,r),e.fromPanel=i}const gi=function(e,t,n){this.type="LEVA_ERROR",this.message="LEVA: "+e,this.previousValue=t,this.error=n};function xi({type:e,value:t,settings:n},r,i,a){const o="SELECT"!==e&&"function"==typeof r?r(t):r;let s;try{s=function(e,t,n,r,i,a){const{sanitize:o}=Br[e];return o?o(t,n,r,i,a):t}(e,o,n,t,i,a)}catch(l){throw new gi(`The value \`${r}\` did not result in a correct value.`,t,l)}return ot(s,t)?t:s}const yi=(e,t,n=!1)=>{let r=0;return function(){const i=arguments,a=n&&!r,o=()=>e.apply(this,i);window.clearTimeout(r),r=window.setTimeout(o,t),a&&o()}},bi=e=>e.shiftKey?5:e.altKey?.2:1;const _i=["value"],Li=["min","max"],Si=(e,{min:t=-1/0,max:n=1/0,suffix:r})=>{const i=parseFloat(e);if(""===e||isNaN(i))throw Error("Invalid number");const a=Wr(i,t,n);return r?a+r:a},wi=e=>{let{value:t}=e,n=Tr(e,_i);const{min:r=-1/0,max:i=1/0}=n,a=Tr(n,Li);let o=parseFloat(t);const s="string"==typeof t?t.substring((""+o).length):void 0;o=Wr(o,r,i);let l=n.step;l||(Number.isFinite(r)?l=Number.isFinite(i)?+(Math.abs(i-r)/100).toPrecision(1):+(Math.abs(o-r)/100).toPrecision(1):Number.isFinite(i)&&(l=+(Math.abs(i-o)/100).toPrecision(1)));const c=l?10*Zr(l):Zr(o);l=l||c/10;return{value:s?o+s:o,settings:Xr({initialValue:o,step:l,pad:Math.round(Wr(Math.log10(1/c),0,2)),min:r,max:i,suffix:s},a)}},Mi=(e,{step:t,initialValue:n})=>n+Math.round((e-n)/t)*t;var Ai=Object.freeze({__proto__:null,schema:e=>{if("number"==typeof e)return!0;if("string"==typeof e){const t=parseFloat(e);if(isNaN(t))return!1;return e.substring((""+t).length).trim().length<4}return!1},sanitize:Si,format:(e,{pad:t=0,suffix:n})=>{const r=parseFloat(e).toFixed(t);return n?r+n:r},normalize:wi,sanitizeStep:Mi});function Ti(){return Ti=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ti.apply(this,arguments)}const Ei=ve.createContext({});function Ci(){return ve.useContext(Ei)}const Ri=ve.createContext(null),Pi=ve.createContext(null),Fi=ve.createContext(null);function Ii(){return ve.useContext(Pi)}const Ni=()=>({colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",folderWidgetColor:"$highlight2",folderTextColor:"$highlight3",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}});function Ui(e,t){const[n,r]=e.split(" "),i={};return"none"!==n&&(i.boxShadow=`${t.inset?"inset ":""}0 0 0 $borderWidths${[t.key]} $colors${"default"!==n&&n||t.borderColor}`),r&&(i.backgroundColor=r),i}const zi={$inputStyle:()=>e=>Ui(e,{key:"$input",borderColor:"$highlight1",inset:!0}),$focusStyle:()=>e=>Ui(e,{key:"$focus",borderColor:"$accent2"}),$hoverStyle:()=>e=>Ui(e,{key:"$hover",borderColor:"$accent1",inset:!0}),$activeStyle:()=>e=>Ui(e,{key:"$active",borderColor:"$accent1",inset:!0})},{styled:Gi,css:Bi,createTheme:Di,globalCss:ki,keyframes:Oi}=Ln({prefix:"leva",theme:Ni(),utils:Xr(Xr({},zi),{},{$flex:()=>({display:"flex",alignItems:"center"}),$flexCenter:()=>({display:"flex",alignItems:"center",justifyContent:"center"}),$reset:()=>({outline:"none",fontSize:"inherit",fontWeight:"inherit",color:"inherit",fontFamily:"inherit",border:"none",backgroundColor:"transparent",appearance:"none"}),$draggable:()=>({touchAction:"none",WebkitUserDrag:"none",userSelect:"none"}),$focus:e=>({"&:focus":zi.$focusStyle()(e)}),$focusWithin:e=>({"&:focus-within":zi.$focusStyle()(e)}),$hover:e=>({"&:hover":zi.$hoverStyle()(e)}),$active:e=>({"&:active":zi.$activeStyle()(e)})})}),ji=ki({".leva__panel__dragged":{WebkitUserDrag:"none",userSelect:"none",input:{userSelect:"none"},"*":{cursor:"ew-resize !important"}}});function Vi(e,t){const{theme:n}=ve.useContext(Ri);if(!(e in n)||!(t in n[e]))return Fr(Er.THEME_ERROR,e,t),"";let r=t;for(;;){let t=n[e][r];if("string"!=typeof t||"$"!==t.charAt(0))return t;r=t.substr(1)}}const Hi=Gi("input",{$reset:"",padding:"0 $sm",width:0,minWidth:0,flex:1,height:"100%",variants:{levaType:{number:{textAlign:"right"}},as:{textarea:{padding:"$sm"}}}}),Xi=Gi("div",{$draggable:"",height:"100%",$flexCenter:"",position:"relative",padding:"0 $xs",fontSize:"0.8em",opacity:.8,cursor:"default",touchAction:"none",[`& + ${Hi}`]:{paddingLeft:0}}),Wi=Gi(Xi,{cursor:"ew-resize",marginRight:"-$xs",textTransform:"uppercase",opacity:.3,"&:hover":{opacity:1},variants:{dragging:{true:{backgroundColor:"$accent2",opacity:1}}}}),Yi=Gi("div",{$flex:"",position:"relative",borderRadius:"$sm",overflow:"hidden",color:"inherit",height:"$rowHeight",backgroundColor:"$elevation3",$inputStyle:"$elevation1",$hover:"",$focusWithin:"",variants:{textArea:{true:{height:"auto"}}}}),$i=["innerLabel","value","onUpdate","onChange","onKeyDown","type","id","inputType","rows"],Zi=["onUpdate"];function Qi(e){let{innerLabel:t,value:n,onUpdate:r,onChange:i,onKeyDown:a,type:o,id:s,inputType:l="text",rows:c=0}=e,u=Tr(e,$i);const{id:d,emitOnEditStart:f,emitOnEditEnd:p,disabled:h}=Ci(),m=s||d,v=ve.useRef(null),g=c>0,x=g?"textarea":"input",y=ve.useCallback((e=>t=>{const n=t.currentTarget.value;e(n)}),[]);ye.useEffect((()=>{const e=v.current,t=y((e=>{r(e),p()}));return null==e||e.addEventListener("blur",t),()=>null==e?void 0:e.removeEventListener("blur",t)}),[y,r,p]);const b=ve.useCallback((e=>{"Enter"===e.key&&y(r)(e)}),[y,r]),_=Object.assign({as:x},g?{rows:c}:{},u);return ye.createElement(Yi,{textArea:g},t&&"string"==typeof t?ye.createElement(Xi,null,t):t,ye.createElement(Hi,Ti({levaType:o,ref:v,id:m,type:l,autoComplete:"off",spellCheck:"false",value:n,onChange:y(i),onFocus:()=>f(),onKeyPress:b,onKeyDown:a,disabled:h},_)))}function Ki(e){let{onUpdate:t}=e,n=Tr(e,Zi);const r=ve.useCallback((e=>t(Yr(e))),[t]),i=ve.useCallback((e=>{const n="ArrowUp"===e.key?1:"ArrowDown"===e.key?-1:0;if(n){e.preventDefault();const r=e.altKey?.1:e.shiftKey?10:1;t((e=>parseFloat(e)+n*r))}}),[t]);return ye.createElement(Qi,Ti({},n,{onUpdate:r,onKeyDown:i,type:"number"}))}const qi=Gi("div",{}),Ji=Gi("div",{position:"relative",background:"$elevation2",transition:"height 300ms ease",variants:{fill:{true:{},false:{}},flat:{false:{},true:{}},isRoot:{true:{},false:{paddingLeft:"$md","&::after":{content:'""',position:"absolute",left:0,top:0,width:"$borderWidths$folder",height:"100%",backgroundColor:"$folderWidgetColor",opacity:.4,transform:"translateX(-50%)"}}}},compoundVariants:[{isRoot:!0,fill:!1,css:{overflowY:"auto",maxHeight:"calc(100vh - 20px - $$titleBarHeight)"}},{isRoot:!0,flat:!1,css:{borderRadius:"$lg"}}]}),ea=Gi("div",{$flex:"",color:"$folderTextColor",userSelect:"none",cursor:"pointer",height:"$folderTitleHeight",fontWeight:"$folder","> svg":{marginLeft:-4,marginRight:4,cursor:"pointer",fill:"$folderWidgetColor",opacity:.6},"&:hover > svg":{fill:"$folderWidgetColor"},[`&:hover + ${Ji}::after`]:{opacity:.6},[`${qi}:hover > & + ${Ji}::after`]:{opacity:.6},[`${qi}:hover > & > svg`]:{opacity:1}}),ta=Gi("div",{position:"relative",display:"grid",gridTemplateColumns:"100%",rowGap:"$rowGap",transition:"opacity 250ms ease",variants:{toggled:{true:{opacity:1,transitionDelay:"250ms"},false:{opacity:0,transitionDelay:"0ms",pointerEvents:"none"}},isRoot:{true:{"& > div":{paddingLeft:"$md",paddingRight:"$md"},"& > div:first-of-type":{paddingTop:"$sm"},"& > div:last-of-type":{paddingBottom:"$sm"},[`> ${qi}:not(:first-of-type)`]:{paddingTop:"$sm",marginTop:"$md",borderTop:"$borderWidths$folder solid $colors$elevation1"}}}}}),na=Gi("div",{position:"relative",zIndex:100,display:"grid",rowGap:"$rowGap",gridTemplateRows:"minmax($sizes$rowHeight, max-content)",alignItems:"center",color:"$highlight2",[`${ta} > &`]:{"&:first-of-type":{marginTop:"$rowGap"},"&:last-of-type":{marginBottom:"$rowGap"}},variants:{disabled:{true:{pointerEvents:"none"},false:{"&:hover,&:focus-within":{color:"$highlight3"}}}}}),ra=Gi(na,{gridTemplateColumns:"auto $sizes$controlWidth",columnGap:"$colGap"}),ia=Gi("div",{$flex:"",height:"100%",position:"relative",overflow:"hidden","& > div":{marginLeft:"$colGap",padding:"0 $xs",opacity:.4},"& > div:hover":{opacity:.8},"& > div > svg":{display:"none",cursor:"pointer",width:13,minWidth:13,height:13,backgroundColor:"$elevation2"},"&:hover > div > svg":{display:"block"},variants:{align:{top:{height:"100%",alignItems:"flex-start",paddingTop:"$sm"}}}}),aa=Gi("input",{$reset:"",height:0,width:0,opacity:0,margin:0,"& + label":{position:"relative",$flexCenter:"",height:"100%",userSelect:"none",cursor:"pointer",paddingLeft:2,paddingRight:"$sm",pointerEvents:"auto"},"& + label:after":{content:'""',width:6,height:6,backgroundColor:"$elevation3",borderRadius:"50%",$activeStyle:""},"&:focus + label:after":{$focusStyle:""},"& + label:active:after":{backgroundColor:"$accent1",$focusStyle:""},"&:checked + label:after":{backgroundColor:"$accent1"}}),oa=Gi("label",{fontWeight:"$label",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","& > svg":{display:"block"}}),sa=Gi("div",{opacity:1,variants:{disabled:{true:{opacity:.6,pointerEvents:"none",[`& ${oa}`]:{pointerEvents:"auto"}}}}}),la=Gi("div",{position:"fixed",top:0,bottom:0,right:0,left:0,zIndex:1e3,userSelect:"none"}),ca=Gi("div",{background:"$toolTipBackground",fontFamily:"$sans",fontSize:"$toolTip",padding:"$xs $sm",color:"$toolTipText",borderRadius:"$xs",boxShadow:"$level2",maxWidth:260}),ua=Gi(Ar,{fill:"$toolTipBackground"});function da({children:e}){const{className:t}=ve.useContext(Ri);return ye.createElement(it,{className:t},e)}const fa=["align"];function pa(){const{id:e,disable:t,disabled:n}=Ci();return ye.createElement(ye.Fragment,null,ye.createElement(aa,{id:e+"__disable",type:"checkbox",checked:!n,onChange:()=>t(!n)}),ye.createElement("label",{htmlFor:e+"__disable"}))}function ha(e){const{id:t,optional:n,hint:r}=Ci(),i=e.htmlFor||(t?{htmlFor:t}:null),a=r||"string"!=typeof e.children?null:{title:e.children};return ye.createElement(ye.Fragment,null,n&&ye.createElement(pa,null),void 0!==r?ye.createElement(Sr,null,ye.createElement(wr,{asChild:!0},ye.createElement(oa,Ti({},i,e))),ye.createElement(Mr,{side:"top",sideOffset:2},ye.createElement(ca,null,r,ye.createElement(ua,null)))):ye.createElement(oa,Ti({},i,a,e)))}function ma(e){let{align:t}=e,n=Tr(e,fa);const{value:r,label:i,key:a,disabled:o}=Ci(),{hideCopyButton:s}=ve.useContext(Fi),l=!s&&void 0!==a,[c,u]=ve.useState(!1);return ye.createElement(ia,{align:t,onPointerLeave:()=>u(!1)},ye.createElement(ha,n),l&&!o&&ye.createElement("div",{title:`Click to copy ${"string"==typeof i?i:a} value`},c?ye.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},ye.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),ye.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):ye.createElement("svg",{onClick:async()=>{try{await navigator.clipboard.writeText(JSON.stringify({[a]:null!=r?r:""})),u(!0)}catch(e){Fr(Er.CLIPBOARD_ERROR,{[a]:r})}},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},ye.createElement("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),ye.createElement("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"}))))}const va=["toggled"],ga=Gi("svg",{fill:"currentColor",transition:"transform 350ms ease, fill 250ms ease"});function xa(e){let{toggled:t}=e,n=Tr(e,va);return ye.createElement(ga,Ti({width:"9",height:"5",viewBox:"0 0 9 5",xmlns:"http://www.w3.org/2000/svg",style:{transform:`rotate(${t?0:-90}deg)`}},n),ye.createElement("path",{d:"M3.8 4.4c.4.3 1 .3 1.4 0L8 1.7A1 1 0 007.4 0H1.6a1 1 0 00-.7 1.7l3 2.7z"}))}const ya=["input"];function ba(e){let{input:t}=e,n=Tr(e,ya);return t?ye.createElement(ra,n):ye.createElement(na,n)}function _a({value:e,type:t,settings:n,setValue:r}){const[i,a]=ve.useState(jr(t,e,n)),o=ve.useRef(e),s=ve.useRef(n);s.current=n;const l=ve.useCallback((e=>a(jr(t,e,s.current))),[t]),c=ve.useCallback((e=>{try{r(e)}catch(t){const{type:e,previousValue:n}=t;if("LEVA_ERROR"!==e)throw t;l(n)}}),[l,r]);return ve.useEffect((()=>{ot(e,o.current)||l(e),o.current=e}),[e,l]),{displayValue:i,onChange:a,onUpdate:c}}function La(e,t){const{emitOnEditStart:n,emitOnEditEnd:r}=Ci();return Se((t=>{t.first&&(document.body.classList.add("leva__panel__dragged"),null==n||n());const i=e(t);return t.last&&(document.body.classList.remove("leva__panel__dragged"),null==r||r()),i}),t)}function Sa(){const e=ve.useRef(null),t=ve.useRef({x:0,y:0}),n=ve.useCallback((n=>{Object.assign(t.current,n),e.current&&(e.current.style.transform=`translate3d(${t.current.x}px, ${t.current.y}px, 0)`)}),[]);return[e,n]}const wa=["__refCount"],Ma=(e,t)=>{if(!e[t])return null;return Tr(e[t],wa)};const Aa=Gi("div",{variants:{hasRange:{true:{position:"relative",display:"grid",gridTemplateColumns:"auto $sizes$numberInputMinWidth",columnGap:"$colGap",alignItems:"center"}}}}),Ta=Gi("div",{position:"relative",width:"100%",height:2,borderRadius:"$xs",backgroundColor:"$elevation1"}),Ea=Gi("div",{position:"absolute",width:"$scrubberWidth",height:"$scrubberHeight",borderRadius:"$xs",boxShadow:"0 0 0 2px $colors$elevation2",backgroundColor:"$accent2",cursor:"pointer",$active:"none $accent1",$hover:"none $accent3",variants:{position:{left:{borderTopRightRadius:0,borderBottomRightRadius:0,transform:"translateX(calc(-0.5 * ($sizes$scrubberWidth + 4px)))"},right:{borderTopLeftRadius:0,borderBottomLeftRadius:0,transform:"translateX(calc(0.5 * ($sizes$scrubberWidth + 4px)))"}}}}),Ca=Gi("div",{position:"relative",$flex:"",height:"100%",cursor:"pointer",touchAction:"none"}),Ra=Gi("div",{position:"absolute",height:"100%",backgroundColor:"$accent2"});function Pa({value:e,min:t,max:n,onDrag:r,step:i,initialValue:a}){const o=ve.useRef(null),s=ve.useRef(null),l=ve.useRef(0),c=Vi("sizes","scrubberWidth"),u=La((({event:u,first:d,xy:[f],movement:[p],memo:h})=>{if(d){const{width:r,left:i}=o.current.getBoundingClientRect();l.current=r-parseFloat(c);h=(null==u?void 0:u.target)===s.current?e:Kr((f-i)/r,t,n)}const m=h+Kr(p/l.current,0,n-t);return r(Mi(m,{step:i,initialValue:a})),h})),d=Qr(e,t,n);return ye.createElement(Ca,Ti({ref:o},u()),ye.createElement(Ta,null,ye.createElement(Ra,{style:{left:0,right:100*(1-d)+"%"}})),ye.createElement(Ea,{ref:s,style:{left:`calc(${d} * (100% - ${c}))`}}))}const Fa=ye.memo((({label:e,onUpdate:t,step:n,innerLabelTrim:r})=>{const[i,a]=ve.useState(!1),o=La((({active:e,delta:[r],event:i,memo:o=0})=>(a(e),o+=r/2,Math.abs(o)>=1&&(t((e=>parseFloat(e)+Math.floor(o)*n*bi(i))),o=0),o)));return ye.createElement(Wi,Ti({dragging:i,title:e.length>1?e:""},o()),e.slice(0,r))}));function Ia({label:e,id:t,displayValue:n,onUpdate:r,onChange:i,settings:a,innerLabelTrim:o=1}){const s=o>0&&ye.createElement(Fa,{label:e,step:a.step,onUpdate:r,innerLabelTrim:o});return ye.createElement(Ki,{id:t,value:String(n),onUpdate:r,onChange:i,innerLabel:s})}const{sanitizeStep:Na}=Ai;var Ua=Xr({component:function(){const e=Ci(),{label:t,value:n,onUpdate:r,settings:i,id:a}=e,{min:o,max:s}=i,l=s!==1/0&&o!==-1/0;return ye.createElement(ba,{input:!0},ye.createElement(ma,null,t),ye.createElement(Aa,{hasRange:l},l&&ye.createElement(Pa,Ti({value:parseFloat(n),onDrag:r},i)),ye.createElement(Ia,Ti({},e,{id:a,label:"value",innerLabelTrim:l?0:1}))))}},Tr(Ai,["sanitizeStep"]));var za=Object.freeze({__proto__:null,schema:(e,t)=>vt().schema({options:vt().passesAnyOf(vt().object(),vt().array())}).test(t),sanitize:(e,{values:t})=>{if(t.indexOf(e)<0)throw Error("Selected value doesn't match Select options");return e},format:(e,{values:t})=>t.indexOf(e),normalize:e=>{let t,n,{value:r,options:i}=e;return Array.isArray(i)?(n=i,t=i.map((e=>String(e)))):(n=Object.values(i),t=Object.keys(i)),"value"in e?n.includes(r)||(t.unshift(String(r)),n.unshift(r)):r=n[0],Object.values(i).includes(r)||(i[String(r)]=r),{value:r,settings:{keys:t,values:n}}}});const Ga=Gi("div",{$flexCenter:"",position:"relative","> svg":{pointerEvents:"none",position:"absolute",right:"$md"}}),Ba=Gi("select",{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0}),Da=Gi("div",{display:"flex",alignItems:"center",width:"100%",height:"$rowHeight",backgroundColor:"$elevation3",borderRadius:"$sm",padding:"0 $sm",cursor:"pointer",[`${Ba}:focus + &`]:{$focusStyle:""},[`${Ba}:hover + &`]:{$hoverStyle:""}});function ka({displayValue:e,value:t,onUpdate:n,id:r,settings:i,disabled:a}){const{keys:o,values:s}=i,l=ve.useRef();return t===s[e]&&(l.current=o[e]),ye.createElement(Ga,null,ye.createElement(Ba,{id:r,value:e,onChange:e=>n(s[Number(e.currentTarget.value)]),disabled:a},o.map(((e,t)=>ye.createElement("option",{key:e,value:t},e)))),ye.createElement(Da,null,l.current),ye.createElement(xa,{toggled:!0}))}var Oa=Xr({component:function(){const{label:e,value:t,displayValue:n,onUpdate:r,id:i,disabled:a,settings:o}=Ci();return ye.createElement(ba,{input:!0},ye.createElement(ma,null,e),ye.createElement(ka,{id:i,value:t,displayValue:n,onUpdate:r,settings:o,disabled:a}))}},za);var ja=Object.freeze({__proto__:null,schema:e=>vt().string().test(e),sanitize:e=>{if("string"!=typeof e)throw Error("Invalid string");return e},normalize:({value:e,editable:t=!0,rows:n=!1})=>({value:e,settings:{editable:t,rows:"number"==typeof n?n:n?5:0}})});const Va=["displayValue","onUpdate","onChange","editable"],Ha=Gi("div",{whiteSpace:"pre-wrap"});function Xa(e){let{displayValue:t,onUpdate:n,onChange:r,editable:i=!0}=e,a=Tr(e,Va);return i?ye.createElement(Qi,Ti({value:t,onUpdate:n,onChange:r},a)):ye.createElement(Ha,null,t)}var Wa=Xr({component:function(){const{label:e,settings:t,displayValue:n,onUpdate:r,onChange:i}=Ci();return ye.createElement(ba,{input:!0},ye.createElement(ma,null,e),ye.createElement(Xa,Ti({displayValue:n,onUpdate:r,onChange:i},t)))}},ja);var Ya=Object.freeze({__proto__:null,schema:e=>vt().boolean().test(e),sanitize:e=>{if("boolean"!=typeof e)throw Error("Invalid boolean");return e}});const $a=Gi("div",{position:"relative",$flex:"",height:"$rowHeight",input:{$reset:"",height:0,width:0,opacity:0,margin:0},label:{position:"relative",$flexCenter:"",userSelect:"none",cursor:"pointer",height:"$checkboxSize",width:"$checkboxSize",backgroundColor:"$elevation3",borderRadius:"$sm",$hover:""},"input:focus + label":{$focusStyle:""},"input:focus:checked + label, input:checked + label:hover":{$hoverStyle:"$accent3"},"input + label:active":{backgroundColor:"$accent1"},"input:checked + label:active":{backgroundColor:"$accent1"},"label > svg":{display:"none",width:"90%",height:"90%",stroke:"$highlight3"},"input:checked + label":{backgroundColor:"$accent2"},"input:checked + label > svg":{display:"block"}});function Za({value:e,onUpdate:t,id:n,disabled:r}){return ye.createElement($a,null,ye.createElement("input",{id:n,type:"checkbox",checked:e,onChange:e=>t(e.currentTarget.checked),disabled:r}),ye.createElement("label",{htmlFor:n},ye.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ye.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))))}var Qa=Xr({component:function(){const{label:e,value:t,onUpdate:n,disabled:r,id:i}=Ci();return ye.createElement(ba,{input:!0},ye.createElement(ma,null,e),ye.createElement(Za,{value:t,onUpdate:n,id:i,disabled:r}))}},Ya);const Ka=["locked"];function qa({value:e,id:t,valueKey:n,settings:r,onUpdate:i,innerLabelTrim:a}){const o=ve.useRef(e[n]);o.current=e[n];const s=ve.useCallback((e=>i({[n]:xi({type:"NUMBER",value:o.current,settings:r},e)})),[i,r,n]),l=_a({type:"NUMBER",value:e[n],settings:r,setValue:s});return ye.createElement(Ia,{id:t,label:n,value:e[n],displayValue:l.displayValue,onUpdate:l.onUpdate,onChange:l.onChange,settings:r,innerLabelTrim:a})}const Ja=Gi("div",{display:"grid",columnGap:"$colGap",gridAutoFlow:"column dense",alignItems:"center",variants:{withLock:{true:{gridTemplateColumns:"10px auto","> svg":{cursor:"pointer"}}}}});function eo(e){let{locked:t}=e,n=Tr(e,Ka);return ye.createElement("svg",Ti({width:"10",height:"10",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),t?ye.createElement("path",{d:"M5 4.63601C5 3.76031 5.24219 3.1054 5.64323 2.67357C6.03934 2.24705 6.64582 1.9783 7.5014 1.9783C8.35745 1.9783 8.96306 2.24652 9.35823 2.67208C9.75838 3.10299 10 3.75708 10 4.63325V5.99999H5V4.63601ZM4 5.99999V4.63601C4 3.58148 4.29339 2.65754 4.91049 1.99307C5.53252 1.32329 6.42675 0.978302 7.5014 0.978302C8.57583 0.978302 9.46952 1.32233 10.091 1.99162C10.7076 2.65557 11 3.57896 11 4.63325V5.99999H12C12.5523 5.99999 13 6.44771 13 6.99999V13C13 13.5523 12.5523 14 12 14H3C2.44772 14 2 13.5523 2 13V6.99999C2 6.44771 2.44772 5.99999 3 5.99999H4ZM3 6.99999H12V13H3V6.99999Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}):ye.createElement("path",{d:"M9 3.63601C9 2.76044 9.24207 2.11211 9.64154 1.68623C10.0366 1.26502 10.6432 1 11.5014 1C12.4485 1 13.0839 1.30552 13.4722 1.80636C13.8031 2.23312 14 2.84313 14 3.63325H15C15 2.68242 14.7626 1.83856 14.2625 1.19361C13.6389 0.38943 12.6743 0 11.5014 0C10.4294 0 9.53523 0.337871 8.91218 1.0021C8.29351 1.66167 8 2.58135 8 3.63601V6H1C0.447715 6 0 6.44772 0 7V13C0 13.5523 0.447715 14 1 14H10C10.5523 14 11 13.5523 11 13V7C11 6.44772 10.5523 6 10 6H9V3.63601ZM1 7H10V13H1V7Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}function to({value:e,onUpdate:t,settings:n,innerLabelTrim:r}){const{id:i,setSettings:a}=Ci(),{lock:o,locked:s}=n;return ye.createElement(Ja,{withLock:o},o&&ye.createElement(eo,{locked:s,onClick:()=>a({locked:!s})}),Object.keys(e).map(((a,o)=>ye.createElement(qa,{id:0===o?i:`${i}.${a}`,key:a,valueKey:a,value:e,settings:n[a],onUpdate:t,innerLabelTrim:r}))))}const no=(e,t)=>{const n={};let r=0,i=1/0;Object.entries(e).forEach((([e,a])=>{n[e]=wi(Xr({value:a},t[e])).settings,r=Math.max(r,n[e].step),i=Math.min(i,n[e].pad)}));for(let a in n){const{step:e,min:o,max:s}=t[a]||{};isFinite(e)||isFinite(o)&&isFinite(s)||(n[a].step=r,n[a].pad=i)}return n},ro=["lock"],io=["value"];function ao(e){const t=vt().array().length(e).every.number();return n=>t.test(n)||(t=>{if(!t||"object"!=typeof t)return!1;const n=Object.values(t);return n.length===e&&n.every((e=>isFinite(e)))})(n)}function oo(e,t,n){return function(e){return Array.isArray(e)?"array":"object"}(e)===t?e:"array"===t?Object.values(e):function(e,t){return e.reduce(((e,n,r)=>Object.assign(e,{[t[r]]:n})),{})}(e,n)}const so=e=>!!e&&("step"in e||"min"in e||"max"in e);function lo(e){return{schema:ao(e.length),normalize:t=>{let{value:n}=t;return function(e,t,n=[]){const{lock:r=!1}=t,i=Tr(t,ro),a=Array.isArray(e)?"array":"object",o="object"===a?Object.keys(e):n,s=oo(e,"object",o),l=so(i)?o.reduce(((e,t)=>Object.assign(e,{[t]:i})),{}):i;return{value:"array"===a?e:s,settings:Xr(Xr({},no(s,l)),{},{format:a,keys:o,lock:r,locked:!1})}}(n,Tr(t,io),e)},format:(e,t)=>((e,t)=>oo(e,"object",t.keys))(e,t),sanitize:(e,t,n)=>((e,t,n)=>{const r=oo(e,"object",t.keys);for(let o in r)r[o]=Si(r[o],t[o]);const i=Object.keys(r);let a={};if(i.length===t.keys.length)a=r;else{const e=oo(n,"object",t.keys);if(1===i.length&&t.locked){const t=i[0],n=r[t],o=e[t],s=0!==o?n/o:1;for(let r in e)r===t?a[t]=n:a[r]=e[r]*s}else a=Xr(Xr({},e),r)}return oo(a,t.format,t.keys)})(e,t,n)}}var co={grad:.9,turn:360,rad:360/(2*Math.PI)},uo=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},fo=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=Math.pow(10,t)),Math.round(n*e)/n+0},po=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),e>n?n:e>t?e:t},ho=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},mo=function(e){return{r:po(e.r,0,255),g:po(e.g,0,255),b:po(e.b,0,255),a:po(e.a)}},vo=function(e){return{r:fo(e.r),g:fo(e.g),b:fo(e.b),a:fo(e.a,3)}},go=/^#([0-9a-f]{3,8})$/i,xo=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},yo=function(e){var t=e.r,n=e.g,r=e.b,i=e.a,a=Math.max(t,n,r),o=a-Math.min(t,n,r),s=o?a===t?(n-r)/o:a===n?2+(r-t)/o:4+(t-n)/o:0;return{h:60*(s<0?s+6:s),s:a?o/a*100:0,v:a/255*100,a:i}},bo=function(e){var t=e.h,n=e.s,r=e.v,i=e.a;t=t/360*6,n/=100,r/=100;var a=Math.floor(t),o=r*(1-n),s=r*(1-(t-a)*n),l=r*(1-(1-t+a)*n),c=a%6;return{r:255*[r,s,o,o,l,r][c],g:255*[l,r,r,s,o,o][c],b:255*[o,o,l,r,r,s][c],a:i}},_o=function(e){return{h:ho(e.h),s:po(e.s,0,100),l:po(e.l,0,100),a:po(e.a)}},Lo=function(e){return{h:fo(e.h),s:fo(e.s),l:fo(e.l),a:fo(e.a,3)}},So=function(e){return bo((n=(t=e).s,{h:t.h,s:(n*=((r=t.l)<50?r:100-r)/100)>0?2*n/(r+n)*100:0,v:r+n,a:t.a}));var t,n,r},wo=function(e){return{h:(t=yo(e)).h,s:(i=(200-(n=t.s))*(r=t.v)/100)>0&&i<200?n*r/100/(i<=100?i:200-i)*100:0,l:i/2,a:t.a};var t,n,r,i},Mo=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ao=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,To=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Eo=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Co={string:[[function(e){var t=go.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?fo(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?fo(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=To.exec(e)||Eo.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:mo({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=Mo.exec(e)||Ao.exec(e);if(!t)return null;var n,r,i=_o({h:(n=t[1],r=t[2],void 0===r&&(r="deg"),Number(n)*(co[r]||1)),s:Number(t[3]),l:Number(t[4]),a:void 0===t[5]?1:Number(t[5])/(t[6]?100:1)});return So(i)},"hsl"]],object:[[function(e){var t=e.r,n=e.g,r=e.b,i=e.a,a=void 0===i?1:i;return uo(t)&&uo(n)&&uo(r)?mo({r:Number(t),g:Number(n),b:Number(r),a:Number(a)}):null},"rgb"],[function(e){var t=e.h,n=e.s,r=e.l,i=e.a,a=void 0===i?1:i;if(!uo(t)||!uo(n)||!uo(r))return null;var o=_o({h:Number(t),s:Number(n),l:Number(r),a:Number(a)});return So(o)},"hsl"],[function(e){var t=e.h,n=e.s,r=e.v,i=e.a,a=void 0===i?1:i;if(!uo(t)||!uo(n)||!uo(r))return null;var o,s=(o={h:Number(t),s:Number(n),v:Number(r),a:Number(a)},{h:ho(o.h),s:po(o.s,0,100),v:po(o.v,0,100),a:po(o.a)});return bo(s)},"hsv"]]},Ro=function(e,t){for(var n=0;n<t.length;n++){var r=t[n][0](e);if(r)return[r,t[n][1]]}return[null,void 0]},Po=function(e){return"string"==typeof e?Ro(e.trim(),Co.string):"object"==typeof e&&null!==e?Ro(e,Co.object):[null,void 0]},Fo=function(e,t){var n=wo(e);return{h:n.h,s:po(n.s+100*t,0,100),l:n.l,a:n.a}},Io=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},No=function(e,t){var n=wo(e);return{h:n.h,s:n.s,l:po(n.l+100*t,0,100),a:n.a}},Uo=function(){function e(e){this.parsed=Po(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return fo(Io(this.rgba),2)},e.prototype.isDark=function(){return Io(this.rgba)<.5},e.prototype.isLight=function(){return Io(this.rgba)>=.5},e.prototype.toHex=function(){return t=(e=vo(this.rgba)).r,n=e.g,r=e.b,a=(i=e.a)<1?xo(fo(255*i)):"","#"+xo(t)+xo(n)+xo(r)+a;var e,t,n,r,i,a},e.prototype.toRgb=function(){return vo(this.rgba)},e.prototype.toRgbString=function(){return t=(e=vo(this.rgba)).r,n=e.g,r=e.b,(i=e.a)<1?"rgba("+t+", "+n+", "+r+", "+i+")":"rgb("+t+", "+n+", "+r+")";var e,t,n,r,i},e.prototype.toHsl=function(){return Lo(wo(this.rgba))},e.prototype.toHslString=function(){return t=(e=Lo(wo(this.rgba))).h,n=e.s,r=e.l,(i=e.a)<1?"hsla("+t+", "+n+"%, "+r+"%, "+i+")":"hsl("+t+", "+n+"%, "+r+"%)";var e,t,n,r,i},e.prototype.toHsv=function(){return e=yo(this.rgba),{h:fo(e.h),s:fo(e.s),v:fo(e.v),a:fo(e.a,3)};var e},e.prototype.invert=function(){return zo({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return void 0===e&&(e=.1),zo(Fo(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),zo(Fo(this.rgba,-e))},e.prototype.grayscale=function(){return zo(Fo(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),zo(No(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),zo(No(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return"number"==typeof e?zo({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):fo(this.rgba.a,3);var t},e.prototype.hue=function(e){var t=wo(this.rgba);return"number"==typeof e?zo({h:e,s:t.s,l:t.l,a:t.a}):fo(t.h)},e.prototype.isEqual=function(e){return this.toHex()===zo(e).toHex()},e}(),zo=function(e){return e instanceof Uo?e:new Uo(e)},Go=[];function Bo(){return(Bo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Do(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t.indexOf(n=a[r])>=0||(i[n]=e[n]);return i}function ko(e){var t=ve.useRef(e),n=ve.useRef((function(e){t.current&&t.current(e)}));return t.current=e,n.current}var Oo=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),e>n?n:e<t?t:e},jo=function(e){return"touches"in e},Vo=function(e){return e&&e.ownerDocument.defaultView||self},Ho=function(e,t,n){var r=e.getBoundingClientRect(),i=jo(t)?function(e,t){for(var n=0;n<e.length;n++)if(e[n].identifier===t)return e[n];return e[0]}(t.touches,n):t;return{left:Oo((i.pageX-(r.left+Vo(e).pageXOffset))/r.width),top:Oo((i.pageY-(r.top+Vo(e).pageYOffset))/r.height)}},Xo=function(e){!jo(e)&&e.preventDefault()},Wo=ye.memo((function(e){var t=e.onMove,n=e.onKey,r=Do(e,["onMove","onKey"]),i=ve.useRef(null),a=ko(t),o=ko(n),s=ve.useRef(null),l=ve.useRef(!1),c=ve.useMemo((function(){var e=function(e){Xo(e),(jo(e)?e.touches.length>0:e.buttons>0)&&i.current?a(Ho(i.current,e,s.current)):n(!1)},t=function(){return n(!1)};function n(n){var r=l.current,a=Vo(i.current),o=n?a.addEventListener:a.removeEventListener;o(r?"touchmove":"mousemove",e),o(r?"touchend":"mouseup",t)}return[function(e){var t,r=e.nativeEvent,o=i.current;if(o&&(Xo(r),t=r,(!l.current||jo(t))&&o)){if(jo(r)){l.current=!0;var c=r.changedTouches||[];c.length&&(s.current=c[0].identifier)}o.focus(),a(Ho(o,r,s.current)),n(!0)}},function(e){var t=e.which||e.keyCode;t<37||t>40||(e.preventDefault(),o({left:39===t?.05:37===t?-.05:0,top:40===t?.05:38===t?-.05:0}))},n]}),[o,a]),u=c[0],d=c[1],f=c[2];return ve.useEffect((function(){return f}),[f]),ye.createElement("div",Bo({},r,{onTouchStart:u,onMouseDown:u,className:"react-colorful__interactive",ref:i,onKeyDown:d,tabIndex:0,role:"slider"}))})),Yo=function(e){return e.filter(Boolean).join(" ")},$o=function(e){var t=e.color,n=e.left,r=e.top,i=void 0===r?.5:r,a=Yo(["react-colorful__pointer",e.className]);return ye.createElement("div",{className:a,style:{top:100*i+"%",left:100*n+"%"}},ye.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},Zo=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=Math.pow(10,t)),Math.round(n*e)/n},Qo=function(e){var t=e.s,n=e.v,r=e.a,i=(200-t)*n/100;return{h:Zo(e.h),s:Zo(i>0&&i<200?t*n/100/(i<=100?i:200-i)*100:0),l:Zo(i/2),a:Zo(r,2)}},Ko=function(e){var t=Qo(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},qo=function(e){var t=Qo(e);return"hsla("+t.h+", "+t.s+"%, "+t.l+"%, "+t.a+")"},Jo=function(e){var t=e.h,n=e.s,r=e.v,i=e.a;t=t/360*6,n/=100,r/=100;var a=Math.floor(t),o=r*(1-n),s=r*(1-(t-a)*n),l=r*(1-(1-t+a)*n),c=a%6;return{r:Zo(255*[r,s,o,o,l,r][c]),g:Zo(255*[l,r,r,s,o,o][c]),b:Zo(255*[o,o,l,r,r,s][c]),a:Zo(i,2)}},es=function(e){var t=e.r,n=e.g,r=e.b,i=e.a,a=Math.max(t,n,r),o=a-Math.min(t,n,r),s=o?a===t?(n-r)/o:a===n?2+(r-t)/o:4+(t-n)/o:0;return{h:Zo(60*(s<0?s+6:s)),s:Zo(a?o/a*100:0),v:Zo(a/255*100),a:i}},ts=ye.memo((function(e){var t=e.hue,n=e.onChange,r=Yo(["react-colorful__hue",e.className]);return ye.createElement("div",{className:r},ye.createElement(Wo,{onMove:function(e){n({h:360*e.left})},onKey:function(e){n({h:Oo(t+360*e.left,0,360)})},"aria-label":"Hue","aria-valuenow":Zo(t),"aria-valuemax":"360","aria-valuemin":"0"},ye.createElement($o,{className:"react-colorful__hue-pointer",left:t/360,color:Ko({h:t,s:100,v:100,a:1})})))})),ns=ye.memo((function(e){var t=e.hsva,n=e.onChange,r={backgroundColor:Ko({h:t.h,s:100,v:100,a:1})};return ye.createElement("div",{className:"react-colorful__saturation",style:r},ye.createElement(Wo,{onMove:function(e){n({s:100*e.left,v:100-100*e.top})},onKey:function(e){n({s:Oo(t.s+100*e.left,0,100),v:Oo(t.v-100*e.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Zo(t.s)+"%, Brightness "+Zo(t.v)+"%"},ye.createElement($o,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:Ko(t)})))})),rs=function(e,t){if(e===t)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0};function is(e,t,n){var r=ko(n),i=ve.useState((function(){return e.toHsva(t)})),a=i[0],o=i[1],s=ve.useRef({color:t,hsva:a});ve.useEffect((function(){if(!e.equal(t,s.current.color)){var n=e.toHsva(t);s.current={hsva:n,color:t},o(n)}}),[t,e]),ve.useEffect((function(){var t;rs(a,s.current.hsva)||e.equal(t=e.fromHsva(a),s.current.color)||(s.current={hsva:a,color:t},r(t))}),[a,e,r]);var l=ve.useCallback((function(e){o((function(t){return Object.assign({},t,e)}))}),[]);return[a,l]}var as="undefined"!=typeof window?ve.useLayoutEffect:ve.useEffect,os=new Map,ss=function(e){as((function(){var t=e.current?e.current.ownerDocument:document;if(void 0!==t&&!os.has(t)){var n=t.createElement("style");n.innerHTML='.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url(\'data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>\')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}',os.set(t,n);var r="undefined"!=typeof __webpack_nonce__?__webpack_nonce__:void 0;r&&n.setAttribute("nonce",r),t.head.appendChild(n)}}),[])},ls=function(e){var t=e.className,n=e.colorModel,r=e.color,i=void 0===r?n.defaultColor:r,a=e.onChange,o=Do(e,["className","colorModel","color","onChange"]),s=ve.useRef(null);ss(s);var l=is(n,i,a),c=l[0],u=l[1],d=Yo(["react-colorful",t]);return ye.createElement("div",Bo({},o,{ref:s,className:d}),ye.createElement(ns,{hsva:c,onChange:u}),ye.createElement(ts,{hue:c.h,onChange:u,className:"react-colorful__last-control"}))},cs=function(e){var t=e.className,n=e.hsva,r=e.onChange,i={backgroundImage:"linear-gradient(90deg, "+qo(Object.assign({},n,{a:0}))+", "+qo(Object.assign({},n,{a:1}))+")"},a=Yo(["react-colorful__alpha",t]),o=Zo(100*n.a);return ye.createElement("div",{className:a},ye.createElement("div",{className:"react-colorful__alpha-gradient",style:i}),ye.createElement(Wo,{onMove:function(e){r({a:e.left})},onKey:function(e){r({a:Oo(n.a+e.left)})},"aria-label":"Alpha","aria-valuetext":o+"%","aria-valuenow":o,"aria-valuemin":"0","aria-valuemax":"100"},ye.createElement($o,{className:"react-colorful__alpha-pointer",left:n.a,color:qo(n)})))},us=function(e){var t=e.className,n=e.colorModel,r=e.color,i=void 0===r?n.defaultColor:r,a=e.onChange,o=Do(e,["className","colorModel","color","onChange"]),s=ve.useRef(null);ss(s);var l=is(n,i,a),c=l[0],u=l[1],d=Yo(["react-colorful",t]);return ye.createElement("div",Bo({},o,{ref:s,className:d}),ye.createElement(ns,{hsva:c,onChange:u}),ye.createElement(ts,{hue:c.h,onChange:u}),ye.createElement(cs,{hsva:c,onChange:u,className:"react-colorful__last-control"}))},ds={defaultColor:{r:0,g:0,b:0,a:1},toHsva:es,fromHsva:Jo,equal:rs},fs=function(e){return ye.createElement(us,Bo({},e,{colorModel:ds}))},ps={defaultColor:{r:0,g:0,b:0},toHsva:function(e){return es({r:e.r,g:e.g,b:e.b,a:1})},fromHsva:function(e){return{r:(t=Jo(e)).r,g:t.g,b:t.b};var t},equal:rs},hs=function(e){return ye.createElement(ls,Bo({},e,{colorModel:ps}))};function ms(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))}function vs(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(l){s=[6,l],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function gs(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}"function"==typeof SuppressedError&&SuppressedError;var xs=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function ys(e,t){var n=function(e){var t=e.name;if(t&&-1!==t.lastIndexOf(".")&&!e.type){var n=t.split(".").pop().toLowerCase(),r=xs.get(n);r&&Object.defineProperty(e,"type",{value:r,writable:!1,configurable:!1,enumerable:!0})}return e}(e);if("string"!=typeof n.path){var r=e.webkitRelativePath;Object.defineProperty(n,"path",{value:"string"==typeof t?t:"string"==typeof r&&r.length>0?r:e.name,writable:!1,configurable:!1,enumerable:!0})}return n}var bs=[".DS_Store","Thumbs.db"];function _s(e){return"object"==typeof e&&null!==e}function Ls(e){return As(e.target.files).map((function(e){return ys(e)}))}function Ss(e){return ms(this,void 0,void 0,(function(){return vs(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return e.getFile()})))];case 1:return[2,t.sent().map((function(e){return ys(e)}))]}}))}))}function ws(e,t){return ms(this,void 0,void 0,(function(){var n;return vs(this,(function(r){switch(r.label){case 0:return null===e?[2,[]]:e.items?(n=As(e.items).filter((function(e){return"file"===e.kind})),"drop"!==t?[2,n]:[4,Promise.all(n.map(Ts))]):[3,2];case 1:return[2,Ms(Es(r.sent()))];case 2:return[2,Ms(As(e.files).map((function(e){return ys(e)})))]}}))}))}function Ms(e){return e.filter((function(e){return-1===bs.indexOf(e.name)}))}function As(e){if(null===e)return[];for(var t=[],n=0;n<e.length;n++){var r=e[n];t.push(r)}return t}function Ts(e){if("function"!=typeof e.webkitGetAsEntry)return Cs(e);var t=e.webkitGetAsEntry();return t&&t.isDirectory?Ps(t):Cs(e)}function Es(e){return e.reduce((function(e,t){return function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(gs(arguments[t]));return e}(e,Array.isArray(t)?Es(t):[t])}),[])}function Cs(e){var t=e.getAsFile();if(!t)return Promise.reject(e+" is not a File");var n=ys(t);return Promise.resolve(n)}function Rs(e){return ms(this,void 0,void 0,(function(){return vs(this,(function(t){return[2,e.isDirectory?Ps(e):Fs(e)]}))}))}function Ps(e){var t=e.createReader();return new Promise((function(e,n){var r=[];!function i(){var a=this;t.readEntries((function(t){return ms(a,void 0,void 0,(function(){var a,o,s;return vs(this,(function(l){switch(l.label){case 0:if(t.length)return[3,5];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,Promise.all(r)];case 2:return a=l.sent(),e(a),[3,4];case 3:return o=l.sent(),n(o),[3,4];case 4:return[3,6];case 5:s=Promise.all(t.map(Rs)),r.push(s),i(),l.label=6;case 6:return[2]}}))}))}),(function(e){n(e)}))}()}))}function Fs(e){return ms(this,void 0,void 0,(function(){return vs(this,(function(t){return[2,new Promise((function(t,n){e.file((function(n){var r=ys(n,e.fullPath);t(r)}),(function(e){n(e)}))}))]}))}))}var Is=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),r=e.name||"",i=(e.type||"").toLowerCase(),a=i.replace(/\/.*$/,"");return n.some((function(e){var t=e.trim().toLowerCase();return"."===t.charAt(0)?r.toLowerCase().endsWith(t):t.endsWith("/*")?a===t.replace(/\/.*$/,""):i===t}))}return!0};function Ns(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Us(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ns(Object(n),!0).forEach((function(t){zs(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ns(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Bs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Bs(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ds=function(e){e=Array.isArray(e)&&1===e.length?e[0]:e;var t=Array.isArray(e)?"one of ".concat(e.join(", ")):e;return{code:"file-invalid-type",message:"File type must be ".concat(t)}},ks=function(e){return{code:"file-too-large",message:"File is larger than ".concat(e," ").concat(1===e?"byte":"bytes")}},Os=function(e){return{code:"file-too-small",message:"File is smaller than ".concat(e," ").concat(1===e?"byte":"bytes")}},js={code:"too-many-files",message:"Too many files"};function Vs(e,t){var n="application/x-moz-file"===e.type||Is(e,t);return[n,n?null:Ds(t)]}function Hs(e,t,n){if(Xs(e.size))if(Xs(t)&&Xs(n)){if(e.size>n)return[!1,ks(n)];if(e.size<t)return[!1,Os(t)]}else{if(Xs(t)&&e.size<t)return[!1,Os(t)];if(Xs(n)&&e.size>n)return[!1,ks(n)]}return[!0,null]}function Xs(e){return null!=e}function Ws(e){return"function"==typeof e.isPropagationStopped?e.isPropagationStopped():void 0!==e.cancelBubble&&e.cancelBubble}function Ys(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,(function(e){return"Files"===e||"application/x-moz-file"===e})):!!e.target&&!!e.target.files}function $s(e){e.preventDefault()}function Zs(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.some((function(t){return!Ws(e)&&t&&t.apply(void 0,[e].concat(r)),Ws(e)}))}}function Qs(e){return e="string"==typeof e?e.split(","):e,[{description:"everything",accept:Array.isArray(e)?e.filter((function(e){return"audio/*"===e||"video/*"===e||"image/*"===e||"text/*"===e||/\w+\/[-+.\w]+/g.test(e)})).reduce((function(e,t){return Us(Us({},e),{},zs({},t,[]))}),{}):{}}]}var Ks=["children"],qs=["open"],Js=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],el=["refKey","onChange","onClick"];function tl(e){return function(e){if(Array.isArray(e))return il(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||rl(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||rl(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rl(e,t){if(e){if("string"==typeof e)return il(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?il(e,t):void 0}}function il(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function al(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ol(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?al(Object(n),!0).forEach((function(t){sl(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):al(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function sl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ll(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var cl=ve.forwardRef((function(e,t){var n=e.children,r=fl(ll(e,Ks)),i=r.open,a=ll(r,qs);return ve.useImperativeHandle(t,(function(){return{open:i}}),[i]),ye.createElement(ve.Fragment,null,n(ol(ol({},a),{},{open:i})))}));cl.displayName="Dropzone";var ul={disabled:!1,getFilesFromEvent:function(e){return ms(this,void 0,void 0,(function(){return vs(this,(function(t){return _s(e)&&_s(e.dataTransfer)?[2,ws(e.dataTransfer,e.type)]:function(e){return _s(e)&&_s(e.target)}(e)?[2,Ls(e)]:Array.isArray(e)&&e.every((function(e){return"getFile"in e&&"function"==typeof e.getFile}))?[2,Ss(e)]:[2,[]]}))}))},maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0};cl.defaultProps=ul,cl.propTypes={children:Me.func,accept:Me.oneOfType([Me.string,Me.arrayOf(Me.string)]),multiple:Me.bool,preventDropOnDocument:Me.bool,noClick:Me.bool,noKeyboard:Me.bool,noDrag:Me.bool,noDragEventsBubbling:Me.bool,minSize:Me.number,maxSize:Me.number,maxFiles:Me.number,disabled:Me.bool,getFilesFromEvent:Me.func,onFileDialogCancel:Me.func,onFileDialogOpen:Me.func,useFsAccessApi:Me.bool,onDragEnter:Me.func,onDragLeave:Me.func,onDragOver:Me.func,onDrop:Me.func,onDropAccepted:Me.func,onDropRejected:Me.func,validator:Me.func};var dl={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function fl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=ol(ol({},ul),e),n=t.accept,r=t.disabled,i=t.getFilesFromEvent,a=t.maxSize,o=t.minSize,s=t.multiple,l=t.maxFiles,c=t.onDragEnter,u=t.onDragLeave,d=t.onDragOver,f=t.onDrop,p=t.onDropAccepted,h=t.onDropRejected,m=t.onFileDialogCancel,v=t.onFileDialogOpen,g=t.useFsAccessApi,x=t.preventDropOnDocument,y=t.noClick,b=t.noKeyboard,_=t.noDrag,L=t.noDragEventsBubbling,S=t.validator,w=ve.useMemo((function(){return"function"==typeof v?v:hl}),[v]),M=ve.useMemo((function(){return"function"==typeof m?m:hl}),[m]),A=ve.useRef(null),T=ve.useRef(null),E=nl(ve.useReducer(pl,dl),2),C=E[0],R=E[1],P=C.isFocused,F=C.isFileDialogActive,I=C.draggedFiles,N=ve.useRef("undefined"!=typeof window&&window.isSecureContext&&g&&"showOpenFilePicker"in window),U=function(){!N.current&&F&&setTimeout((function(){T.current&&(T.current.files.length||(R({type:"closeDialog"}),M()))}),300)};ve.useEffect((function(){return window.addEventListener("focus",U,!1),function(){window.removeEventListener("focus",U,!1)}}),[T,F,M,N]);var z=ve.useRef([]),G=function(e){A.current&&A.current.contains(e.target)||(e.preventDefault(),z.current=[])};ve.useEffect((function(){return x&&(document.addEventListener("dragover",$s,!1),document.addEventListener("drop",G,!1)),function(){x&&(document.removeEventListener("dragover",$s),document.removeEventListener("drop",G))}}),[A,x]);var B=ve.useCallback((function(e){e.preventDefault(),e.persist(),K(e),z.current=[].concat(tl(z.current),[e.target]),Ys(e)&&Promise.resolve(i(e)).then((function(t){Ws(e)&&!L||(R({draggedFiles:t,isDragActive:!0,type:"setDraggedFiles"}),c&&c(e))}))}),[i,c,L]),D=ve.useCallback((function(e){e.preventDefault(),e.persist(),K(e);var t=Ys(e);if(t&&e.dataTransfer)try{e.dataTransfer.dropEffect="copy"}catch(n){}return t&&d&&d(e),!1}),[d,L]),k=ve.useCallback((function(e){e.preventDefault(),e.persist(),K(e);var t=z.current.filter((function(e){return A.current&&A.current.contains(e)})),n=t.indexOf(e.target);-1!==n&&t.splice(n,1),z.current=t,t.length>0||(R({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),Ys(e)&&u&&u(e))}),[A,u,L]),O=ve.useCallback((function(e,t){var r=[],i=[];e.forEach((function(e){var t=nl(Vs(e,n),2),s=t[0],l=t[1],c=nl(Hs(e,o,a),2),u=c[0],d=c[1],f=S?S(e):null;if(s&&u&&!f)r.push(e);else{var p=[l,d];f&&(p=p.concat(f)),i.push({file:e,errors:p.filter((function(e){return e}))})}})),(!s&&r.length>1||s&&l>=1&&r.length>l)&&(r.forEach((function(e){i.push({file:e,errors:[js]})})),r.splice(0)),R({acceptedFiles:r,fileRejections:i,type:"setFiles"}),f&&f(r,i,t),i.length>0&&h&&h(i,t),r.length>0&&p&&p(r,t)}),[R,s,n,o,a,l,f,p,h,S]),j=ve.useCallback((function(e){e.preventDefault(),e.persist(),K(e),z.current=[],Ys(e)&&Promise.resolve(i(e)).then((function(t){Ws(e)&&!L||O(t,e)})),R({type:"reset"})}),[i,O,L]),V=ve.useCallback((function(){if(N.current){R({type:"openDialog"}),w();var e={multiple:s,types:Qs(n)};window.showOpenFilePicker(e).then((function(e){return i(e)})).then((function(e){O(e,null),R({type:"closeDialog"})})).catch((function(e){var t;(t=e)instanceof DOMException&&("AbortError"===t.name||t.code===t.ABORT_ERR)?(M(e),R({type:"closeDialog"})):function(e){return e instanceof DOMException&&("SecurityError"===e.name||e.code===e.SECURITY_ERR)}(e)&&(N.current=!1,T.current&&(T.current.value=null,T.current.click()))}))}else T.current&&(R({type:"openDialog"}),w(),T.current.value=null,T.current.click())}),[R,w,M,g,O,n,s]),H=ve.useCallback((function(e){A.current&&A.current.isEqualNode(e.target)&&(" "!==e.key&&"Enter"!==e.key&&32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),V()))}),[A,V]),X=ve.useCallback((function(){R({type:"focus"})}),[]),W=ve.useCallback((function(){R({type:"blur"})}),[]),Y=ve.useCallback((function(){y||(!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent;return function(e){return-1!==e.indexOf("MSIE")||-1!==e.indexOf("Trident/")}(e)||function(e){return-1!==e.indexOf("Edge/")}(e)}()?V():setTimeout(V,0))}),[y,V]),$=function(e){return r?null:e},Z=function(e){return b?null:$(e)},Q=function(e){return _?null:$(e)},K=function(e){L&&e.stopPropagation()},q=ve.useMemo((function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.refKey,n=void 0===t?"ref":t,i=e.role,a=e.onKeyDown,o=e.onFocus,s=e.onBlur,l=e.onClick,c=e.onDragEnter,u=e.onDragOver,d=e.onDragLeave,f=e.onDrop,p=ll(e,Js);return ol(ol(sl({onKeyDown:Z(Zs(a,H)),onFocus:Z(Zs(o,X)),onBlur:Z(Zs(s,W)),onClick:$(Zs(l,Y)),onDragEnter:Q(Zs(c,B)),onDragOver:Q(Zs(u,D)),onDragLeave:Q(Zs(d,k)),onDrop:Q(Zs(f,j)),role:"string"==typeof i&&""!==i?i:"button"},n,A),r||b?{}:{tabIndex:0}),p)}}),[A,H,X,W,Y,B,D,k,j,b,_,r]),J=ve.useCallback((function(e){e.stopPropagation()}),[]),ee=ve.useMemo((function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.refKey,r=void 0===t?"ref":t,i=e.onChange,a=e.onClick,o=ll(e,el);return ol(ol({},sl({accept:n,multiple:s,type:"file",style:{display:"none"},onChange:$(Zs(i,j)),onClick:$(Zs(a,J)),tabIndex:-1},r,T)),o)}}),[T,n,s,j,r]),te=I.length,ne=te>0&&function(e){var t=e.files,n=e.accept,r=e.minSize,i=e.maxSize,a=e.multiple,o=e.maxFiles;return!(!a&&t.length>1||a&&o>=1&&t.length>o)&&t.every((function(e){var t=Gs(Vs(e,n),1)[0],a=Gs(Hs(e,r,i),1)[0];return t&&a}))}({files:I,accept:n,minSize:o,maxSize:a,multiple:s,maxFiles:l}),re=te>0&&!ne;return ol(ol({},C),{},{isDragAccept:ne,isDragReject:re,isFocused:P&&!r,getRootProps:q,getInputProps:ee,rootRef:A,inputRef:T,open:$(V)})}function pl(e,t){switch(t.type){case"focus":return ol(ol({},e),{},{isFocused:!0});case"blur":return ol(ol({},e),{},{isFocused:!1});case"openDialog":return ol(ol({},dl),{},{isFileDialogActive:!0});case"closeDialog":return ol(ol({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":var n=t.isDragActive,r=t.draggedFiles;return ol(ol({},e),{},{draggedFiles:r,isDragActive:n});case"setFiles":return ol(ol({},e),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections});case"reset":return ol({},dl);default:return e}}function hl(){}
/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var ml=function(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)};
/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function vl(e){return!0===ml(e)&&"[object Object]"===Object.prototype.toString.call(e)}var gl=function(e){var t,n;return!1!==vl(e)&&("function"==typeof(t=e.constructor)&&(!1!==vl(n=t.prototype)&&!1!==n.hasOwnProperty("isPrototypeOf")))},xl=gl,yl=function(e){return xl(e)||"function"==typeof e||Array.isArray(e)},bl=yl,_l=function(e,t,n){for(var r in e)if(!1===t.call(n,e[r],r,e))break};
/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function Ll(e,t){for(var n=arguments.length,r=0;++r<n;){var i=arguments[r];wl(i)&&_l(i,Sl,e)}return e}function Sl(e,t){if(function(e){return"__proto__"!==e&&"constructor"!==e&&"prototype"!==e}(t)){var n=this[t];wl(e)&&wl(n)?Ll(n,e):this[t]=e}}function wl(e){return bl(e)&&!Array.isArray(e)}var Ml=Ll;
/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */function Al(e){return e?Array.isArray(e)?e.join("."):e:""}
/*!
 * assign-symbols <https://github.com/jonschlinkert/assign-symbols>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var Tl=yl,El=function(e,t){if(null==e)throw new TypeError("expected first argument to be an object.");if(void 0===t||"undefined"==typeof Symbol)return e;if("function"!=typeof Object.getOwnPropertySymbols)return e;for(var n=Object.prototype.propertyIsEnumerable,r=Object(e),i=arguments.length,a=0;++a<i;)for(var o=Object(arguments[a]),s=Object.getOwnPropertySymbols(o),l=0;l<s.length;l++){var c=s[l];n.call(o,c)&&(r[c]=o[c])}return r};function Cl(e,t){for(var n in t)Il(t,n)&&(e[n]=t[n])}function Rl(e){return e&&"string"==typeof e}function Pl(e){var t={};for(var n in e)t[n]=e[n];return t}function Fl(e){return e&&"object"==typeof e||Tl(e)}function Il(e,t){return Object.prototype.hasOwnProperty.call(e,t)}
/*!
 * split-string <https://github.com/jonschlinkert/split-string>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Nl=Object.assign||function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");Fl(e)||(e={});for(var t=1;t<arguments.length;t++){var n=arguments[t];Rl(n)&&(n=Pl(n)),Fl(n)&&(Cl(e,n),El(e,n))}return e};function Ul(e,t,n,r){var i=e.indexOf(t,n);return"\\"===e.charAt(i-1)?Ul(e,t,i+1):i}function zl(e,t){return!0===t.keepDoubleQuotes&&'"'===e||(!0===t.keepSingleQuotes&&"'"===e||t.keepQuotes)}function Gl(e,t,n){return"function"==typeof e.keepEscaping?e.keepEscaping(t,n):!0===e.keepEscaping||"\\"===t[n+1]}
/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var Bl=function(e){return null!=e&&("object"==typeof e||"function"==typeof e)},Dl=Bl;function kl(e,t){for(var n in t)Ol(t,n)&&(e[n]=t[n])}function Ol(e,t){return Object.prototype.hasOwnProperty.call(e,t)}
/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) 2014-2015, 2017, Jon Schlinkert.
 * Released under the MIT License.
 */var jl=function(e,t,n){if("string"!=typeof e)throw new TypeError("expected a string");"function"==typeof t&&(n=t,t=null),"string"==typeof t&&(t={sep:t});var r,i=Nl({sep:"."},t),a=i.quotes||['"',"'","`"];!0===i.brackets?r={"<":">","(":")","[":"]","{":"}"}:i.brackets&&(r=i.brackets);var o,s=[],l=[],c=[""],u=i.sep,d=e.length,f=-1;function p(){if(r&&l.length)return r[l[l.length-1]]}for(;++f<d;){var h=e[f],m=e[f+1],v={val:h,idx:f,arr:c,str:e};if(s.push(v),"\\"!==h){if(r&&r[h]){l.push(h);var g=p(),x=f+1;if(-1!==e.indexOf(g,x+1))for(;l.length&&x<d;){var y=e[++x];if("\\"!==y)if(-1===a.indexOf(y)){if(g=p(),l.length&&-1===e.indexOf(g,x+1))break;r[y]?l.push(y):g===y&&l.pop()}else x=Ul(e,y,x+1);else y++}if(-1===(o=x)){c[c.length-1]+=h;continue}h=e.slice(f,o+1),v.val=h,v.idx=f=o}if(-1!==a.indexOf(h)){if(-1===(o=Ul(e,h,f+1))){c[c.length-1]+=h;continue}h=!0===zl(h,i)?e.slice(f,o+1):e.slice(f+1,o),v.val=h,v.idx=f=o}"function"==typeof n&&(n(v,s),h=v.val,f=v.idx),v.val!==u||!1===v.split?c[c.length-1]+=v.val:c.push("")}else v.val=!0===Gl(i,e,f)?h+m:m,v.escaped=!0,"function"==typeof n&&n(v),c[c.length-1]+=v.val,f++}return c},Vl=function(e){Dl(e)||(e={});for(var t=arguments.length,n=1;n<t;n++){var r=arguments[n];Dl(r)&&kl(e,r)}return e},Hl=gl,Xl=Bl;function Wl(e){return"__proto__"!==e&&"constructor"!==e&&"prototype"!==e}var Yl=yl,$l=Ml,Zl=function(e,t,n,r,i){if(null===(a=e)||"object"!=typeof a&&"function"!=typeof a||!t)return e;var a;if(t=Al(t),n&&(t+="."+Al(n)),r&&(t+="."+Al(r)),i&&(t+="."+Al(i)),t in e)return e[t];for(var o=t.split("."),s=o.length,l=-1;e&&++l<s;){for(var c=o[l];"\\"===c[c.length-1];)c=c.slice(0,-1)+"."+o[++l];e=e[c]}return e},Ql=function(e,t,n){if(!Xl(e))return e;if(Array.isArray(t)&&(t=[].concat.apply([],t).join(".")),"string"!=typeof t)return e;for(var r=jl(t,{sep:".",brackets:!0}).filter(Wl),i=r.length,a=-1,o=e;++a<i;){var s=r[a];a===i-1?Hl(o[s])&&Hl(n)?o[s]=Vl({},o[s],n):o[s]=n:(Xl(o[s])||(o[s]={}),o=o[s])}return e};const Kl=_e((function(e,t,n){if(!Yl(e))throw new TypeError("expected an object");if("string"!=typeof t||null==n)return $l.apply(null,arguments);if("string"==typeof n)return Ql(e,t,n),e;var r=Zl(e,t);return Yl(n)&&Yl(r)&&(n=$l({},r,n)),Ql(e,t,n),e})),ql=(...e)=>e.filter(Boolean).join(".");function Jl(e,t){return ve.useMemo(e,function(e,t){const n=ve.useRef();return(t?ot:we)(e,n.current)||(n.current=e),n.current}(t,!0))}function ec(e,t,n){const r=e.useStore((e=>function(e,t){return Object.entries((n=e,r=t,r.reduce(((e,t)=>(n&&n.hasOwnProperty(t)&&(e[t]=n[t]),e)),{}))).reduce(((e,[,{value:t,disabled:n,key:r}])=>(e[r]=n?void 0:t,e)),{});var n,r}(Xr(Xr({},n),e.data),t)),we);return r}function tc(e=3){const t=ve.useRef(null),n=ve.useRef(null),[r,i]=ve.useState(!1),a=ve.useCallback((()=>i(!0)),[]),o=ve.useCallback((()=>i(!1)),[]);return ve.useLayoutEffect((()=>{if(r){const{bottom:r,top:i,left:a}=t.current.getBoundingClientRect(),{height:o}=n.current.getBoundingClientRect(),s=r+o>window.innerHeight-40?"up":"down";n.current.style.position="fixed",n.current.style.zIndex="10000",n.current.style.left=a+"px","down"===s?n.current.style.top=r+e+"px":n.current.style.bottom=window.innerHeight-i+e+"px"}}),[e,r]),{popinRef:t,wrapperRef:n,shown:r,show:a,hide:o}}[function(e,t){var n={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var i in n)r[n[i]]=i;var a={};e.prototype.toName=function(t){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var i,o,s=r[this.toHex()];if(s)return s;if(null==t?void 0:t.closest){var l=this.toRgb(),c=1/0,u="black";if(!a.length)for(var d in n)a[d]=new e(n[d]).toRgb();for(var f in n){var p=(i=l,o=a[f],Math.pow(i.r-o.r,2)+Math.pow(i.g-o.g,2)+Math.pow(i.b-o.b,2));p<c&&(c=p,u=f)}return u}},t.string.push([function(t){var r=t.toLowerCase(),i="transparent"===r?"#0000":n[r];return i?new e(i).toRgb():null},"name"])}].forEach((function(e){Go.indexOf(e)<0&&(e(Uo,Co),Go.push(e))}));const nc={rgb:"toRgb",hsl:"toHsl",hsv:"toHsv",hex:"toHex"};vt.extend({color:()=>e=>zo(e).isValid()});function rc(e,{format:t,hasAlpha:n,isString:r}){const i=e[nc[t]+(r&&"hex"!==t?"String":"")]();return"object"!=typeof i||n?i:function(e,t){const n=Xr({},e);return t.forEach((t=>t in e&&delete n[t])),n}(i,["a"])}const ic=(e,t)=>{const n=zo(e);if(!n.isValid())throw Error("Invalid color");return rc(n,t)};var ac=Object.freeze({__proto__:null,schema:e=>vt().color().test(e),sanitize:ic,format:(e,t)=>rc(zo(e),Xr(Xr({},t),{},{isString:!0,format:"hex"})),normalize:({value:e})=>{const t=function(e){return Po(e)[1]}(e),n={format:"name"===t?"hex":t,hasAlpha:"object"==typeof e?"a"in e:"hex"===t&&8===e.length||/^(rgba)|(hsla)|(hsva)/.test(e),isString:"string"==typeof e};return{value:ic(e,n),settings:n}}});const oc=Gi("div",{position:"relative",boxSizing:"border-box",borderRadius:"$sm",overflow:"hidden",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",backgroundColor:"#fff",backgroundImage:'url(\'data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>\')',$inputStyle:"",$hover:"",zIndex:1,variants:{active:{true:{$inputStyle:"$accent1"}}},"&::before":{content:'""',position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"currentColor",zIndex:1}}),sc=Gi("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto",columnGap:"$colGap",alignItems:"center"}),lc=Gi("div",{width:"$colorPickerWidth",height:"$colorPickerHeight",".react-colorful":{width:"100%",height:"100%",boxShadow:"$level2",cursor:"crosshair"},".react-colorful__saturation":{borderRadius:"$sm $sm 0 0"},".react-colorful__alpha, .react-colorful__hue":{height:10},".react-colorful__last-control":{borderRadius:"0 0 $sm $sm"},".react-colorful__pointer":{height:12,width:12}});function cc(e,t){return"rgb"!==t?zo(e).toRgb():e}function uc({value:e,displayValue:t,settings:n,onUpdate:r}){const{emitOnEditStart:i,emitOnEditEnd:a}=Ci(),{format:o,hasAlpha:s}=n,{popinRef:l,wrapperRef:c,shown:u,show:d,hide:f}=tc(),p=ve.useRef(0),[h,m]=ve.useState((()=>cc(e,o))),v=s?fs:hs,g=()=>{f(),a(),window.clearTimeout(p.current)};return ve.useEffect((()=>()=>window.clearTimeout(p.current)),[]),ye.createElement(ye.Fragment,null,ye.createElement(oc,{ref:l,active:u,onClick:()=>(m(cc(e,o)),d(),void i()),style:{color:t}}),u&&ye.createElement(da,null,ye.createElement(la,{onPointerUp:g}),ye.createElement(lc,{ref:c,onMouseEnter:()=>window.clearTimeout(p.current),onMouseLeave:e=>0===e.buttons&&void(p.current=window.setTimeout(g,500))},ye.createElement(v,{color:h,onChange:r}))))}var dc=Xr({component:function(){const{value:e,displayValue:t,label:n,onChange:r,onUpdate:i,settings:a}=Ci();return ye.createElement(ba,{input:!0},ye.createElement(ma,null,n),ye.createElement(sc,null,ye.createElement(uc,{value:e,displayValue:t,onChange:r,onUpdate:i,settings:a}),ye.createElement(Qi,{value:t,onChange:r,onUpdate:i})))}},ac);var fc=Xr({component:function(){const{label:e,displayValue:t,onUpdate:n,settings:r}=Ci();return ye.createElement(ba,{input:!0},ye.createElement(ma,null,e),ye.createElement(to,{value:t,settings:r,onUpdate:n}))}},lo(["x","y","z"]));const pc=Gi("div",{$flexCenter:"",position:"relative",backgroundColor:"$elevation3",borderRadius:"$sm",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",touchAction:"none",$draggable:"",$hover:"","&:active":{cursor:"none"},"&::after":{content:'""',backgroundColor:"$accent2",height:4,width:4,borderRadius:2}}),hc=Gi("div",{$flexCenter:"",width:"$joystickWidth",height:"$joystickHeight",borderRadius:"$sm",boxShadow:"$level2",position:"fixed",zIndex:1e4,overflow:"hidden",$draggable:"",transform:"translate(-50%, -50%)",variants:{isOutOfBounds:{true:{backgroundColor:"$elevation1"},false:{backgroundColor:"$elevation3"}}},"> div":{position:"absolute",$flexCenter:"",borderStyle:"solid",borderWidth:1,borderColor:"$highlight1",backgroundColor:"$elevation3",width:"80%",height:"80%","&::after,&::before":{content:'""',position:"absolute",zindex:10,backgroundColor:"$highlight1"},"&::before":{width:"100%",height:1},"&::after":{height:"100%",width:1}},"> span":{position:"relative",zindex:100,width:10,height:10,backgroundColor:"$accent2",borderRadius:"50%"}});function mc({value:e,settings:t,onUpdate:n}){const r=ve.useRef(),i=ve.useRef(0),a=ve.useRef(0),o=ve.useRef(1),[s,l]=ve.useState(!1),[c,u]=ve.useState(!1),[d,f]=Sa(),p=ve.useRef(null),h=ve.useRef(null);ve.useLayoutEffect((()=>{if(s){const{top:e,left:t,width:n,height:r}=p.current.getBoundingClientRect();h.current.style.left=t+n/2+"px",h.current.style.top=e+r/2+"px"}}),[s]);const{keys:[m,v],joystick:g}=t,x="invertY"===g?1:-1,{[m]:{step:y},[v]:{step:b}}=t,_=Vi("sizes","joystickWidth"),L=Vi("sizes","joystickHeight"),S=.8*parseFloat(_)/2,w=.8*parseFloat(L)/2,M=ve.useCallback((()=>{r.current||(u(!0),i.current&&f({x:i.current*S}),a.current&&f({y:a.current*-w}),r.current=window.setInterval((()=>{n((e=>{const t=y*i.current*o.current,n=x*b*a.current*o.current;return Array.isArray(e)?{[m]:e[0]+t,[v]:e[1]+n}:{[m]:e[m]+t,[v]:e[v]+n}}))}),16))}),[S,w,n,f,y,b,m,v,x]),A=ve.useCallback((()=>{window.clearTimeout(r.current),r.current=void 0,u(!1)}),[]);ve.useEffect((()=>{function e(e){o.current=bi(e)}return window.addEventListener("keydown",e),window.addEventListener("keyup",e),()=>{window.clearTimeout(r.current),window.removeEventListener("keydown",e),window.removeEventListener("keyup",e)}}),[]);const T=La((({first:t,active:r,delta:[s,c],movement:[u,d]})=>{t&&l(!0);const p=Wr(u,-S,S),h=Wr(d,-w,w);i.current=Math.abs(u)>Math.abs(p)?Math.sign(u-p):0,a.current=Math.abs(d)>Math.abs(h)?Math.sign(h-d):0;let g=e[m],_=e[v];r?(i.current||(g+=s*y*o.current,f({x:p})),a.current||(_-=x*c*b*o.current,f({y:h})),i.current||a.current?M():A(),n({[m]:g,[v]:_})):(l(!1),i.current=0,a.current=0,f({x:0,y:0}),A())}));return ye.createElement(pc,Ti({ref:p},T()),s&&ye.createElement(da,null,ye.createElement(hc,{ref:h,isOutOfBounds:c},ye.createElement("div",null),ye.createElement("span",{ref:d}))))}const vc=Gi("div",{display:"grid",columnGap:"$colGap",variants:{withJoystick:{true:{gridTemplateColumns:"$sizes$rowHeight auto"},false:{gridTemplateColumns:"auto"}}}});const gc=["joystick"],xc=lo(["x","y"]);var yc=Xr(Xr({component:function(){const{label:e,displayValue:t,onUpdate:n,settings:r}=Ci();return ye.createElement(ba,{input:!0},ye.createElement(ma,null,e),ye.createElement(vc,{withJoystick:!!r.joystick},r.joystick&&ye.createElement(mc,{value:t,settings:r,onUpdate:n}),ye.createElement(to,{value:t,settings:r,onUpdate:n})))}},xc),{},{normalize:e=>{let{joystick:t=!0}=e,n=Tr(e,gc);const{value:r,settings:i}=xc.normalize(n);return{value:r,settings:Xr(Xr({},i),{},{joystick:t})}}});var bc=Object.freeze({__proto__:null,sanitize:e=>{if(void 0!==e){if(e instanceof File)try{return URL.createObjectURL(e)}catch(t){return}if("string"==typeof e&&0===e.indexOf("blob:"))return e;throw Error("Invalid image format [undefined | blob | File].")}},schema:(e,t)=>"object"==typeof t&&"image"in t,normalize:({image:e})=>({value:e})});const _c=Gi("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto 20px",columnGap:"$colGap",alignItems:"center"}),Lc=Gi("div",{$flexCenter:"",overflow:"hidden",height:"$rowHeight",background:"$elevation3",textAlign:"center",color:"inherit",borderRadius:"$sm",outline:"none",userSelect:"none",cursor:"pointer",$inputStyle:"",$hover:"",$focusWithin:"",$active:"$accent1 $elevation1",variants:{isDragAccept:{true:{$inputStyle:"$accent1",backgroundColor:"$elevation1"}}}}),Sc=Gi("div",{boxSizing:"border-box",borderRadius:"$sm",height:"$rowHeight",width:"$rowHeight",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center",variants:{hasImage:{true:{cursor:"pointer",$hover:"",$active:""}}}}),wc=Gi("div",{$flexCenter:"",width:"$imagePreviewWidth",height:"$imagePreviewHeight",borderRadius:"$sm",boxShadow:"$level2",pointerEvents:"none",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center"}),Mc=Gi("div",{fontSize:"0.8em",height:"100%",padding:"$rowGap $md"}),Ac=Gi("div",{$flexCenter:"",top:"0",right:"0",marginRight:"$sm",height:"100%",cursor:"pointer",variants:{disabled:{true:{color:"$elevation3",cursor:"default"}}},"&::after,&::before":{content:'""',position:"absolute",height:2,width:10,borderRadius:1,backgroundColor:"currentColor"},"&::after":{transform:"rotate(45deg)"},"&::before":{transform:"rotate(-45deg)"}});var Tc=Xr({component:function(){const{label:e,value:t,onUpdate:n,disabled:r}=Ci(),{popinRef:i,wrapperRef:a,shown:o,show:s,hide:l}=tc(),c=ve.useCallback((e=>{e.length&&n(e[0])}),[n]),u=ve.useCallback((e=>{e.stopPropagation(),n(void 0)}),[n]),{getRootProps:d,getInputProps:f,isDragAccept:p}=fl({maxFiles:1,accept:"image/*",onDrop:c,disabled:r});return ye.createElement(ba,{input:!0},ye.createElement(ma,null,e),ye.createElement(_c,null,ye.createElement(Sc,{ref:i,hasImage:!!t,onPointerDown:()=>!!t&&s(),onPointerUp:l,style:{backgroundImage:t?`url(${t})`:"none"}}),o&&!!t&&ye.createElement(da,null,ye.createElement(la,{onPointerUp:l,style:{cursor:"pointer"}}),ye.createElement(wc,{ref:a,style:{backgroundImage:`url(${t})`}})),ye.createElement(Lc,d({isDragAccept:p}),ye.createElement("input",f()),ye.createElement(Mc,null,p?"drop image":"click or drop")),ye.createElement(Ac,{onClick:u,disabled:!t})))}},bc);const Ec=vt().number(),Cc=e=>({min:e[0],max:e[1]}),Rc=(e,{bounds:[t,n]},r)=>{const i=Array.isArray(e)?Cc(e):e,a={min:r[0],max:r[1]},{min:o,max:s}=Xr(Xr({},a),i);return[Wr(Number(o),t,Math.max(t,s)),Wr(Number(s),Math.min(n,o),n)]};var Pc=Object.freeze({__proto__:null,schema:(e,t)=>vt().array().length(2).every.number().test(e)&&vt().schema({min:Ec,max:Ec}).test(t),format:Cc,sanitize:Rc,normalize:({value:e,min:t,max:n})=>{const r={min:t,max:n},i=[t,n],a=Xr(Xr({},no(Cc(e),{min:r,max:r})),{},{bounds:i});return{value:Rc(Cc(e),a,e),settings:a}}});const Fc=["value","bounds","onDrag"],Ic=["bounds"],Nc=Gi("div",{display:"grid",columnGap:"$colGap",gridTemplateColumns:"auto calc($sizes$numberInputMinWidth * 2 + $space$rowGap)"});function Uc(e){let{value:t,bounds:[n,r],onDrag:i}=e,a=Tr(e,Fc);const o=ve.useRef(null),s=ve.useRef(null),l=ve.useRef(null),c=ve.useRef(0),u=Vi("sizes","scrubberWidth"),d=La((({event:e,first:d,xy:[f],movement:[p],memo:h={}})=>{if(d){const{width:i,left:a}=o.current.getBoundingClientRect();c.current=i-parseFloat(u);const d=(null==e?void 0:e.target)===s.current||(null==e?void 0:e.target)===l.current;h.pos=Kr((f-a)/i,n,r);const p=Math.abs(h.pos-t.min)-Math.abs(h.pos-t.max);h.key=p<0||0===p&&h.pos<=t.min?"min":"max",d&&(h.pos=t[h.key])}const m=h.pos+Kr(p/c.current,0,r-n);return i({[h.key]:Na(m,a[h.key])}),h})),f=`calc(${Qr(t.min,n,r)} * (100% - ${u} - 8px) + 4px)`,p=`calc(${1-Qr(t.max,n,r)} * (100% - ${u} - 8px) + 4px)`;return ye.createElement(Ca,Ti({ref:o},d()),ye.createElement(Ta,null,ye.createElement(Ra,{style:{left:f,right:p}})),ye.createElement(Ea,{position:"left",ref:s,style:{left:f}}),ye.createElement(Ea,{position:"right",ref:l,style:{right:p}}))}var zc=Xr({component:function(){const{label:e,displayValue:t,onUpdate:n,settings:r}=Ci(),i=Tr(r,Ic);return ye.createElement(ye.Fragment,null,ye.createElement(ba,{input:!0},ye.createElement(ma,null,e),ye.createElement(Nc,null,ye.createElement(Uc,Ti({value:t},r,{onDrag:n})),ye.createElement(to,{value:t,settings:i,onUpdate:n,innerLabelTrim:0}))))}},Pc);const Gc=["type","value"],Bc=["onChange","transient","onEditStart","onEditEnd"],Dc=new function(){const e=Ae(Te((()=>({data:{}})))),t=(()=>{const e=new Map;return{on:(t,n)=>{let r=e.get(t);void 0===r&&(r=new Set,e.set(t,r)),r.add(n)},off:(t,n)=>{const r=e.get(t);void 0!==r&&(r.delete(n),0===r.size&&e.delete(t))},emit:(t,...n)=>{const r=e.get(t);if(void 0!==r)for(const e of r)e(...n)}}})();this.storeId="_"+Math.random().toString(36).substr(2,9),this.useStore=e;const n={},r=new Set;this.getVisiblePaths=()=>{const e=this.getData(),t=Object.keys(e),i=[];Object.entries(n).forEach((([e,n])=>{n.render&&t.some((t=>0===t.indexOf(e)))&&!n.render(this.get)&&i.push(e+".")}));const a=[];return r.forEach((t=>{t in e&&e[t].__refCount>0&&i.every((e=>-1===t.indexOf(e)))&&(!e[t].render||e[t].render(this.get))&&a.push(t)})),a},this.setOrderedPaths=e=>{e.forEach((e=>r.add(e)))},this.orderPaths=e=>(this.setOrderedPaths(e),e),this.disposePaths=t=>{e.setState((e=>{const n=e.data;return t.forEach((e=>{if(e in n){const t=n[e];t.__refCount--,0===t.__refCount&&t.type in si&&delete n[e]}})),{data:n}}))},this.dispose=()=>{e.setState((()=>({data:{}})))},this.getFolderSettings=e=>n[e]||{},this.getData=()=>e.getState().data,this.addData=(t,n)=>{e.setState((e=>{const r=e.data;return Object.entries(t).forEach((([e,t])=>{let i=r[e];if(i){const{type:e,value:r}=t,a=Tr(t,Gc);e!==i.type?Fr(Er.INPUT_TYPE_OVERRIDE,e):((0===i.__refCount||n)&&Object.assign(i,a),i.__refCount++)}else r[e]=Xr(Xr({},t),{},{__refCount:1})})),{data:r}}))},this.setValueAtPath=(t,n,r)=>{e.setState((e=>{const i=e.data;return vi(i[t],n,t,this,r),{data:i}}))},this.setSettingsAtPath=(t,n)=>{e.setState((e=>{const r=e.data;return r[t].settings=Xr(Xr({},r[t].settings),n),{data:r}}))},this.disableInputAtPath=(t,n)=>{e.setState((e=>{const r=e.data;return r[t].disabled=n,{data:r}}))},this.set=(t,n)=>{e.setState((e=>{const r=e.data;return Object.entries(t).forEach((([e,t])=>{try{vi(r[e],t,void 0,void 0,n)}catch(i){}})),{data:r}}))},this.getInput=e=>{try{return this.getData()[e]}catch(t){Fr(Er.PATH_DOESNT_EXIST,e)}},this.get=e=>{var t;return null===(t=this.getInput(e))||void 0===t?void 0:t.value},this.emitOnEditStart=e=>{t.emit(`onEditStart:${e}`,this.get(e),e,Xr(Xr({},this.getInput(e)),{},{get:this.get}))},this.emitOnEditEnd=e=>{t.emit(`onEditEnd:${e}`,this.get(e),e,Xr(Xr({},this.getInput(e)),{},{get:this.get}))},this.subscribeToEditStart=(e,n)=>{const r=`onEditStart:${e}`;return t.on(r,n),()=>t.off(r,n)},this.subscribeToEditEnd=(e,n)=>{const r=`onEditEnd:${e}`;return t.on(r,n),()=>t.off(r,n)};const i=(e,t,r)=>{const a={};return Object.entries(e).forEach((([e,o])=>{if(""===e)return Fr(Er.EMPTY_KEY);let s=ql(t,e);if(o.type===si.FOLDER){const e=i(o.schema,s,r);Object.assign(a,e),s in n||(n[s]=o.settings)}else if(e in r)Fr(Er.DUPLICATE_KEYS,e,s,r[e].path);else{const t=mi(o,e,s,a);if(t){const{type:n,options:i,input:o}=t,{onChange:l,transient:c,onEditStart:u,onEditEnd:d}=i,f=Tr(i,Bc);a[s]=Xr(Xr(Xr({type:n},f),o),{},{fromPanel:!0}),r[e]={path:s,onChange:l,transient:c,onEditStart:u,onEditEnd:d}}else Fr(Er.UNKNOWN_INPUT,s,o)}})),a};this.getDataFromSchema=e=>{const t={};return[i(e,"",t),t]}},kc={collapsed:!1};function Oc(e,t){return{type:si.FOLDER,schema:e,settings:Xr(Xr({},kc),t)}}const jc=e=>"__levaInput"in e,Vc=["type","label","path","valueKey","value","settings","setValue","disabled"];function Hc(e){let{type:t,label:n,path:r,valueKey:i,value:a,settings:o,setValue:s,disabled:l}=e,c=Tr(e,Vc);const{displayValue:u,onChange:d,onUpdate:f}=_a({type:t,value:a,settings:o,setValue:s}),p=Br[t].component;return p?ye.createElement(Ei.Provider,{value:Xr({key:i,path:r,id:""+r,label:n,displayValue:u,value:a,onChange:d,onUpdate:f,settings:o,setValue:s,disabled:l},c)},ye.createElement(sa,{disabled:l},ye.createElement(p,null))):(Fr(Er.NO_COMPONENT_FOR_TYPE,t,r),null)}const Xc=Gi("button",{display:"block",$reset:"",fontWeight:"$button",height:"$rowHeight",borderStyle:"none",borderRadius:"$sm",backgroundColor:"$elevation1",color:"$highlight1","&:not(:disabled)":{color:"$highlight3",backgroundColor:"$accent2",cursor:"pointer",$hover:"$accent3",$active:"$accent3 $accent1",$focus:""}});const Wc=Gi("div",{$flex:"",justifyContent:"flex-end",gap:"$colGap"}),Yc=Gi("button",{$reset:"",cursor:"pointer",borderRadius:"$xs","&:hover":{backgroundColor:"$elevation3"}});const $c=Gi("canvas",{height:"$monitorHeight",width:"100%",display:"block",borderRadius:"$sm"});const Zc=ve.forwardRef((function({initialValue:e},t){const n=Vi("colors","highlight3"),r=Vi("colors","elevation2"),i=Vi("colors","highlight1"),[a,o]=ve.useMemo((()=>[zo(i).alpha(.4).toRgbString(),zo(i).alpha(.1).toRgbString()]),[i]),s=ve.useRef([e]),l=ve.useRef(e),c=ve.useRef(e),u=ve.useRef(),d=ve.useCallback(((e,t)=>{if(!e)return;const{width:i,height:u}=e,d=new Path2D,f=i/100,p=.05*u;for(let n=0;n<s.current.length;n++){const e=f*n,t=u-Qr(s.current[n],l.current,c.current)*(u-2*p)-p;d.lineTo(e,t)}t.clearRect(0,0,i,u);const h=new Path2D(d);h.lineTo(f*(s.current.length+1),u),h.lineTo(0,u),h.lineTo(0,0);const m=t.createLinearGradient(0,0,0,u);m.addColorStop(0,a),m.addColorStop(1,o),t.fillStyle=m,t.fill(h),t.strokeStyle=r,t.lineJoin="round",t.lineWidth=14,t.stroke(d),t.strokeStyle=n,t.lineWidth=2,t.stroke(d)}),[n,r,a,o]),[f,p]=function(e){const t=ve.useRef(null),n=ve.useRef(null),r=ve.useRef(!1);return ve.useEffect((()=>{const i=yi((()=>{t.current.width=t.current.offsetWidth*window.devicePixelRatio,t.current.height=t.current.offsetHeight*window.devicePixelRatio,e(t.current,n.current)}),250);return window.addEventListener("resize",i),r.current||(i(),r.current=!0),()=>window.removeEventListener("resize",i)}),[e]),ve.useEffect((()=>{n.current=t.current.getContext("2d")}),[]),[t,n]}(d);return ve.useImperativeHandle(t,(()=>({frame:e=>{(void 0===l.current||e<l.current)&&(l.current=e),(void 0===c.current||e>c.current)&&(c.current=e),function(e,t){e.push(t),e.length>100&&e.shift()}(s.current,e),u.current=requestAnimationFrame((()=>d(f.current,p.current)))}})),[f,p,d]),ve.useEffect((()=>()=>cancelAnimationFrame(u.current)),[]),ye.createElement($c,{ref:f})})),Qc=e=>Number.isFinite(e)?e.toPrecision(2):e.toString(),Kc=ve.forwardRef((function({initialValue:e},t){const[n,r]=ve.useState(Qc(e));return ve.useImperativeHandle(t,(()=>({frame:e=>r(Qc(e))})),[]),ye.createElement("div",null,n)}));function qc(e){return"function"==typeof e?e():e.current}const Jc=["type","label","key"],eu={[si.BUTTON]:function({onClick:e,settings:t,label:n}){const r=Ii();return ye.createElement(ba,null,ye.createElement(Xc,{disabled:t.disabled,onClick:()=>e(r.get)},n))},[si.BUTTON_GROUP]:function(e){const{label:t,opts:n}=(({label:e,opts:t})=>{let n="string"==typeof e&&""===e.trim()?null:e,r=t;return"object"==typeof t.opts&&(void 0!==r.label&&(n=t.label),r=t.opts),{label:n,opts:r}})(e),r=Ii();return ye.createElement(ba,{input:!!t},t&&ye.createElement(ma,null,t),ye.createElement(Wc,null,Object.entries(n).map((([e,t])=>ye.createElement(Yc,{key:e,onClick:()=>t(r.get)},e)))))},[si.MONITOR]:function({label:e,objectOrFn:t,settings:n}){const r=ve.useRef(),i=ve.useRef(qc(t));return ve.useEffect((()=>{const e=window.setInterval((()=>{var e;document.hidden||null===(e=r.current)||void 0===e||e.frame(qc(t))}),n.interval);return()=>window.clearInterval(e)}),[t,n.interval]),ye.createElement(ba,{input:!0},ye.createElement(ma,{align:"top"},e),n.graph?ye.createElement(Zc,{ref:r,initialValue:i.current}):ye.createElement(Kc,{ref:r,initialValue:i.current}))}},tu=ye.memo((({path:e})=>{const[t,{set:n,setSettings:r,disable:i,storeId:a,emitOnEditStart:o,emitOnEditEnd:s}]=function(e){const t=Ii(),[n,r]=ve.useState(Ma(t.getData(),e)),i=ve.useCallback((n=>t.setValueAtPath(e,n,!0)),[e,t]),a=ve.useCallback((n=>t.setSettingsAtPath(e,n)),[e,t]),o=ve.useCallback((n=>t.disableInputAtPath(e,n)),[e,t]),s=ve.useCallback((()=>t.emitOnEditStart(e)),[e,t]),l=ve.useCallback((()=>t.emitOnEditEnd(e)),[e,t]);return ve.useEffect((()=>{r(Ma(t.getData(),e));const n=t.useStore.subscribe((t=>Ma(t.data,e)),r,{equalityFn:we});return()=>n()}),[t,e]),[n,{set:i,setSettings:a,disable:o,storeId:t.storeId,emitOnEditStart:s,emitOnEditEnd:l}]}(e);if(!t)return null;const{type:l,label:c,key:u}=t,d=Tr(t,Jc);if(l in si){const t=eu[l];return ye.createElement(t,Ti({label:c,path:e},d))}return l in Br?ye.createElement(Hc,Ti({key:a+e,type:l,label:c,storeId:a,path:e,valueKey:u,setValue:n,setSettings:r,disable:i,emitOnEditStart:o,emitOnEditEnd:s},d)):(Ir(Er.UNSUPPORTED_INPUT,l,e),null)}));function nu({toggle:e,toggled:t,name:n}){return ye.createElement(ea,{onClick:()=>e()},ye.createElement(xa,{toggled:t}),ye.createElement("div",null,n))}const ru=({name:e,path:t,tree:n})=>{const r=Ii(),i=ql(t,e),{collapsed:a,color:o}=r.getFolderSettings(i),[s,l]=ve.useState(!a),c=ve.useRef(null),u=Vi("colors","folderWidgetColor"),d=Vi("colors","folderTextColor");return ve.useLayoutEffect((()=>{c.current.style.setProperty("--leva-colors-folderWidgetColor",o||u),c.current.style.setProperty("--leva-colors-folderTextColor",o||d)}),[o,u,d]),ye.createElement(qi,{ref:c},ye.createElement(nu,{name:e,toggled:s,toggle:()=>l((e=>!e))}),ye.createElement(iu,{parent:i,tree:n,toggled:s}))},iu=ye.memo((({isRoot:e=!1,fill:t=!1,flat:n=!1,parent:r,tree:i,toggled:a})=>{const{wrapperRef:o,contentRef:s}=function(e){const t=ve.useRef(null),n=ve.useRef(null),r=ve.useRef(!0);return ve.useLayoutEffect((()=>{e||(t.current.style.height="0px",t.current.style.overflow="hidden")}),[]),ve.useEffect((()=>{if(r.current)return void(r.current=!1);let i;const a=t.current,o=()=>{e&&(a.style.removeProperty("height"),a.style.removeProperty("overflow"),n.current.scrollIntoView({behavior:"smooth",block:"nearest"}))};a.addEventListener("transitionend",o,{once:!0});const{height:s}=n.current.getBoundingClientRect();return a.style.height=s+"px",e||(a.style.overflow="hidden",i=window.setTimeout((()=>a.style.height="0px"),50)),()=>{a.removeEventListener("transitionend",o),clearTimeout(i)}}),[e]),{wrapperRef:t,contentRef:n}}(a),l=Ii(),c=([e,t])=>{var n;return(jc(t)?null===(n=l.getInput(t.path))||void 0===n?void 0:n.order:l.getFolderSettings(ql(r,e)).order)||0},u=Object.entries(i).sort(((e,t)=>c(e)-c(t)));return ye.createElement(Ji,{ref:o,isRoot:e,fill:t,flat:n},ye.createElement(ta,{ref:s,isRoot:e,toggled:a},u.map((([e,t])=>jc(t)?ye.createElement(tu,{key:t.path,valueKey:t.valueKey,path:t.path}):ye.createElement(ru,{key:e,name:e,path:r,tree:t})))))})),au=Gi("div",{position:"relative",fontFamily:"$mono",fontSize:"$root",color:"$rootText",backgroundColor:"$elevation1",variants:{fill:{false:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,width:"$rootWidth"},true:{position:"relative",width:"100%"}},flat:{false:{borderRadius:"$lg",boxShadow:"$level1"}},oneLineLabels:{true:{[`${ra}`]:{gridTemplateColumns:"auto",gridAutoColumns:"minmax(max-content, 1fr)",gridAutoRows:"minmax($sizes$rowHeight), auto)",rowGap:0,columnGap:0,marginTop:"$rowGap"}}},hideTitleBar:{true:{$$titleBarHeight:"0px"},false:{$$titleBarHeight:"$sizes$titleBarHeight"}}},"&,*,*:after,*:before":{boxSizing:"border-box"},"*::selection":{backgroundColor:"$accent2"}}),ou=Gi("i",{$flexCenter:"",width:40,userSelect:"none",cursor:"pointer","> svg":{fill:"$highlight1",transition:"transform 350ms ease, fill 250ms ease"},"&:hover > svg":{fill:"$highlight3"},variants:{active:{true:{"> svg":{fill:"$highlight2"}}}}}),su=Gi("div",{display:"flex",alignItems:"stretch",justifyContent:"space-between",height:"$titleBarHeight",variants:{mode:{drag:{cursor:"grab"}}}}),lu=Gi("div",{$flex:"",position:"relative",width:"100%",overflow:"hidden",transition:"height 250ms ease",color:"$highlight3",paddingLeft:"$md",[`> ${ou}`]:{height:30},variants:{toggled:{true:{height:30},false:{height:0}}}}),cu=Gi("input",{$reset:"",flex:1,position:"relative",height:30,width:"100%",backgroundColor:"transparent",fontSize:"10px",borderRadius:"$root","&:focus":{},"&::placeholder":{color:"$highlight2"}}),uu=Gi("div",{touchAction:"none",$flexCenter:"",flex:1,"> svg":{fill:"$highlight1"},color:"$highlight1",variants:{drag:{true:{$draggable:"","> svg":{transition:"fill 250ms ease"},"&:hover":{color:"$highlight3"},"&:hover > svg":{fill:"$highlight3"}}},filterEnabled:{false:{paddingRight:40}}}}),du=ye.forwardRef((({setFilter:e,toggle:t},n)=>{const[r,i]=ve.useState(""),a=ve.useMemo((()=>yi(e,250)),[e]);return ve.useEffect((()=>{a(r)}),[r,a]),ye.createElement(ye.Fragment,null,ye.createElement(cu,{ref:n,value:r,placeholder:"[Open filter with CMD+SHIFT+L]",onPointerDown:e=>e.stopPropagation(),onChange:e=>{const n=e.currentTarget.value;t(!0),i(n)}}),ye.createElement(ou,{onClick:()=>(e(""),void i("")),style:{visibility:r?"visible":"hidden"}},ye.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 20 20",fill:"currentColor"},ye.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}))))}));function fu({setFilter:e,onDrag:t,onDragStart:n,onDragEnd:r,toggle:i,toggled:a,title:o,drag:s,filterEnabled:l,from:c}){const[u,d]=ve.useState(!1),f=ve.useRef(null);ve.useEffect((()=>{var e,t;u?null===(e=f.current)||void 0===e||e.focus():null===(t=f.current)||void 0===t||t.blur()}),[u]);const p=La((({offset:[e,i],first:a,last:o})=>{t({x:e,y:i}),a&&n({x:e,y:i}),o&&r({x:e,y:i})}),{filterTaps:!0,from:({offset:[e,t]})=>[(null==c?void 0:c.x)||e,(null==c?void 0:c.y)||t]});return ve.useEffect((()=>{const e=e=>{"L"===e.key&&e.shiftKey&&e.metaKey&&d((e=>!e))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[]),ye.createElement(ye.Fragment,null,ye.createElement(su,{mode:s?"drag":void 0},ye.createElement(ou,{active:!a,onClick:()=>i()},ye.createElement(xa,{toggled:a,width:12,height:8})),ye.createElement(uu,Ti({},s?p():{},{drag:s,filterEnabled:l}),void 0===o&&s?ye.createElement("svg",{width:"20",height:"10",viewBox:"0 0 28 14",xmlns:"http://www.w3.org/2000/svg"},ye.createElement("circle",{cx:"2",cy:"2",r:"2"}),ye.createElement("circle",{cx:"14",cy:"2",r:"2"}),ye.createElement("circle",{cx:"26",cy:"2",r:"2"}),ye.createElement("circle",{cx:"2",cy:"12",r:"2"}),ye.createElement("circle",{cx:"14",cy:"12",r:"2"}),ye.createElement("circle",{cx:"26",cy:"12",r:"2"})):o),l&&ye.createElement(ou,{active:u,onClick:()=>d((e=>!e))},ye.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 20 20"},ye.createElement("path",{d:"M9 9a2 2 0 114 0 2 2 0 01-4 0z"}),ye.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z",clipRule:"evenodd"})))),ye.createElement(lu,{toggled:u},ye.createElement(du,{ref:f,setFilter:e,toggle:i})))}const pu=["store","hidden","theme","collapsed"];function hu(e){let{store:t,hidden:n=!1,theme:r,collapsed:i=!1}=e,a=Tr(e,pu);const o=Jl((()=>function(e){const t=Ni();if(!e)return{theme:t,className:""};Object.keys(e).forEach((n=>{Object.assign(t[n],e[n])}));const n=Di(t);return{theme:t,className:n.className}}(r)),[r]),[s,l]=ve.useState(!i),c="object"==typeof i?!i.collapsed:s,u=ve.useMemo((()=>"object"==typeof i?e=>{"function"==typeof e?i.onChange(!e(!i.collapsed)):i.onChange(!e)}:l),[i]);return!t||n?null:ye.createElement(Ri.Provider,{value:o},ye.createElement(mu,Ti({store:t},a,{toggled:c,setToggle:u,rootClass:o.className})))}const mu=ye.memo((({store:e,rootClass:t,fill:n=!1,flat:r=!1,neverHide:i=!1,oneLineLabels:a=!1,titleBar:o={title:void 0,drag:!0,filter:!0,position:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0},hideCopyButton:s=!1,toggled:l,setToggle:c})=>{var u,d;const f=(e=>{const[t,n]=ve.useState(e.getVisiblePaths());return ve.useEffect((()=>{n(e.getVisiblePaths());const t=e.useStore.subscribe(e.getVisiblePaths,n,{equalityFn:we});return()=>t()}),[e]),t})(e),[p,h]=ve.useState(""),m=ve.useMemo((()=>((e,t)=>{const n={},r=t?t.toLowerCase():null;return e.forEach((e=>{const[t,i]=function(e){const t=e.split(".");return[t.pop(),t.join(".")||void 0]}(e);(!r||t.toLowerCase().indexOf(r)>-1)&&Kl(n,i,{[t]:{__levaInput:!0,path:e}})})),n})(f,p)),[f,p]),[v,g]=Sa(),x=i||f.length>0,y="object"==typeof o&&o.title||void 0,b="object"!=typeof o||(null===(u=o.drag)||void 0===u||u),_="object"!=typeof o||(null===(d=o.filter)||void 0===d||d),L="object"==typeof o&&o.position||void 0,S="object"==typeof o&&o.onDrag||void 0,w="object"==typeof o&&o.onDragStart||void 0,M="object"==typeof o&&o.onDragEnd||void 0;return ye.useEffect((()=>{g({x:null==L?void 0:L.x,y:null==L?void 0:L.y})}),[L,g]),ji(),ye.createElement(Fi.Provider,{value:{hideCopyButton:s}},ye.createElement(au,{ref:v,className:t,fill:n,flat:r,oneLineLabels:a,hideTitleBar:!o,style:{display:x?"block":"none"}},o&&ye.createElement(fu,{onDrag:e=>{g(e),null==S||S(e)},onDragStart:e=>null==w?void 0:w(e),onDragEnd:e=>null==M?void 0:M(e),setFilter:h,toggle:e=>c((t=>null!=e?e:!t)),toggled:l,title:y,drag:b,filterEnabled:_,from:L}),x&&ye.createElement(Pi.Provider,{value:e},ye.createElement(iu,{isRoot:!0,fill:n,flat:r,tree:m,toggled:l}))))})),vu=["isRoot"];let gu=!1,xu=null;function yu(e){let{isRoot:t=!1}=e,n=Tr(e,vu);return ve.useEffect((()=>(gu=!0,!t&&xu&&(xu.remove(),xu=null),()=>{t||(gu=!1)})),[t]),ye.createElement(hu,Ti({store:Dc},n))}function bu(e){ve.useEffect((()=>{e&&!gu&&(xu||(xu=document.getElementById("leva__root")||Object.assign(document.createElement("div"),{id:"leva__root"}),document.body&&(document.body.appendChild(xu),function(e,t){const n=console.error;console.error=()=>{},xe.render(e,t),console.error=n}(ye.createElement(yu,{isRoot:!0}),xu))),gu=!0)}),[e])}function _u(e,t,n,r,i){const{folderName:a,schema:o,folderSettings:s,hookSettings:l,deps:c}=function(e,t,n,r,i){let a,o,s,l,c;return"string"==typeof e?(o=e,a=t,Array.isArray(n)?c=n:n&&("store"in n?(l=n,c=r):(s=n,Array.isArray(r)?c=r:(l=r,c=i)))):(a=e,Array.isArray(t)?c=t:(l=t,c=n)),{schema:a,folderName:o,folderSettings:s,hookSettings:l,deps:c||[]}}(e,t,n,r,i),u="function"==typeof o,d=ve.useRef(!1),f=ve.useRef(!0),p=Jl((()=>{d.current=!0;const e="function"==typeof o?o():o;return a?{[a]:Oc(e,s)}:e}),c);bu(!(null!=l&&l.store));const[h]=ve.useState((()=>(null==l?void 0:l.store)||Dc)),[m,v]=ve.useMemo((()=>h.getDataFromSchema(p)),[h,p]),[g,x,y,b,_]=ve.useMemo((()=>{const e=[],t=[],n={},r={},i={};return Object.values(v).forEach((({path:a,onChange:o,onEditStart:s,onEditEnd:l,transient:c})=>{e.push(a),o?(n[a]=o,c||t.push(a)):t.push(a),s&&(r[a]=s),l&&(i[a]=l)})),[e,t,n,r,i]}),[v]),L=ve.useMemo((()=>h.orderPaths(g)),[g,h]),S=ec(h,x,m),w=ve.useCallback((e=>{const t=Object.entries(e).reduce(((e,[t,n])=>Object.assign(e,{[v[t].path]:n})),{});h.set(t,!1)}),[h,v]),M=ve.useCallback((e=>h.get(v[e].path)),[h,v]);return ve.useEffect((()=>{const e=!f.current&&d.current;return h.addData(m,e),f.current=!1,d.current=!1,()=>h.disposePaths(L)}),[h,L,m]),ve.useEffect((()=>{const e=[];return Object.entries(y).forEach((([t,n])=>{n(h.get(t),t,Xr({initial:!0,get:h.get},h.getInput(t)));const r=h.useStore.subscribe((e=>{const n=e.data[t];return[n.disabled?void 0:n.value,n]}),(([e,r])=>n(e,t,Xr({initial:!1,get:h.get},r))),{equalityFn:we});e.push(r)})),()=>e.forEach((e=>e()))}),[h,y]),ve.useEffect((()=>{const e=[];return Object.entries(b).forEach((([t,n])=>e.push(h.subscribeToEditStart(t,n)))),Object.entries(_).forEach((([t,n])=>e.push(h.subscribeToEditEnd(t,n)))),()=>e.forEach((e=>e()))}),[b,_,h]),u?[S,w,M]:S}kr(ci.SELECT,Oa),kr(ci.IMAGE,Tc),kr(ci.NUMBER,Ua),kr(ci.COLOR,dc),kr(ci.STRING,Wa),kr(ci.BOOLEAN,Qa),kr(ci.INTERVAL,zc),kr(ci.VECTOR3D,fc),kr(ci.VECTOR2D,yc);
/**
 * postprocessing v6.32.2 build Sat Jul 01 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rüschen
 * @license Zlib
 */
var Lu="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Su=class extends v{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new p(null),luminanceBuffer1:new p(null),minLuminance:new p(.01),deltaTime:new p(0),tau:new p(1)},extensions:{shaderTextureLOD:!0},blending:g,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <packing>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\nuniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));\n#if __VERSION__ < 300\nfloat l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;\n#else\nfloat l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;\n#endif\nl0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}",vertexShader:Lu})}set luminanceBuffer0(e){this.uniforms.luminanceBuffer0.value=e}setLuminanceBuffer0(e){this.uniforms.luminanceBuffer0.value=e}set luminanceBuffer1(e){this.uniforms.luminanceBuffer1.value=e}setLuminanceBuffer1(e){this.uniforms.luminanceBuffer1.value=e}set mipLevel1x1(e){this.defines.MIP_LEVEL_1X1=e.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(e){this.mipLevel1x1=e}set deltaTime(e){this.uniforms.deltaTime.value=e}setDeltaTime(e){this.uniforms.deltaTime.value=e}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(e){this.uniforms.minLuminance.value=e}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(e){this.uniforms.minLuminance.value=e}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(e){this.uniforms.tau.value=e}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(e){this.uniforms.tau.value=e}},wu="srgb",Mu="srgb-linear",Au=Number(x.replace(/\D+/g,"")),Tu=Au>=152,Eu=new Map([[E,Mu],[C,wu]]),Cu=new Map([[Mu,E],[wu,C]]);function Ru(e){return null===e?null:Tu?e.outputColorSpace:Eu.get(e.outputEncoding)}function Pu(e,t){null!==e&&(Tu?e.colorSpace=t:e.encoding=Cu.get(t))}function Fu(e){return Au<154?e.replace("colorspace_fragment","encodings_fragment"):e}var Iu=0,Nu=1,Uu=2,zu=3,Gu=4,Bu=5,Du=6,ku=7,Ou=8,ju=9,Vu=10,Hu=11,Xu=12,Wu=13,Yu=14,$u=15,Zu=16,Qu=17,Ku=18,qu=19,Ju=20,ed=21,td=22,nd=23,rd=24,id=25,ad=26,od=27,sd=28,ld=29,cd=30,ud=31,dd=32,fd=0,pd=1,hd=2,md={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},vd=2,gd=3,xd=0,yd=1,bd=2,_d=3,Ld=4,Sd=0,wd=1,Md=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Ad=class extends v{constructor(e=new z){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new p(null),texelSize:new p(new z),scale:new p(1),kernel:new p(0)},blending:g,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.fragmentShader=Fu(this.fragmentShader),this.setTexelSize(e.x,e.y),this.kernelSize=vd}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return Md[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,.5*e,.5*t)}setSize(e,t){const n=1/e,r=1/t;this.uniforms.texelSize.value.set(n,r,.5*n,.5*r)}},Td=class extends v{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new p(null),opacity:new p(1)},blending:g,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <colorspace_fragment>\n#include <dithering_fragment>\n}",vertexShader:Lu}),this.fragmentShader=Fu(this.fragmentShader)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},Ed=class extends v{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new p(null),normalBuffer:new p(null),texelSize:new p(new l)},blending:g,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\n#ifdef DOWNSAMPLE_NORMALS\nuniform lowp sampler2D normalBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}int findBestDepth(const in highp float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;highp float distances[]=float[4](abs(c-samples[0]),abs(c-samples[1]),abs(c-samples[2]),abs(c-samples[3]));float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){highp float d[]=float[4](readDepth(vUv0),readDepth(vUv1),readDepth(vUv2),readDepth(vUv3));int index=findBestDepth(d);\n#ifdef DOWNSAMPLE_NORMALS\nhighp vec3 n[]=vec3[4](texture2D(normalBuffer,vUv0).rgb,texture2D(normalBuffer,vUv1).rgb,texture2D(normalBuffer,vUv2).rgb,texture2D(normalBuffer,vUv3).rgb);\n#else\nhighp vec3 n[]=vec3[4](vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));\n#endif\ngl_FragColor=vec4(n[index],d[index]);}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}"})}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=a){this.depthBuffer=e,this.depthPacking=t}set normalBuffer(e){this.uniforms.normalBuffer.value=e,null!==e?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(e){this.normalBuffer=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Cd=class extends v{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new p(null),texelSize:new p(new l)},blending:g,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#define WEIGHT_INNER 0.125\n#define WEIGHT_OUTER 0.0555555\nvarying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.fragmentShader=Fu(this.fragmentShader)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Rd=class extends v{constructor(e,t,n,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:x.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new p(null),depthBuffer:new p(null),resolution:new p(new l),texelSize:new p(new l),cameraNear:new p(.3),cameraFar:new p(1e3),aspect:new p(1),time:new p(0)},blending:g,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),e&&this.setShaderParts(e),t&&this.setDefines(t),n&&this.setUniforms(n),this.copyCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=a){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#if DEPTH_PACKING == 3201\nuniform lowp sampler2D depthBuffer;\n#elif defined(GL_FRAGMENT_PRECISION_HIGH)\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if THREE_REVISION >= 137\nvec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE gl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <colorspace_fragment>\n#endif\n#include <dithering_fragment>\n}".replace(md.FRAGMENT_HEAD,e.get(md.FRAGMENT_HEAD)||"").replace(md.FRAGMENT_MAIN_UV,e.get(md.FRAGMENT_MAIN_UV)||"").replace(md.FRAGMENT_MAIN_IMAGE,e.get(md.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}".replace(md.VERTEX_HEAD,e.get(md.VERTEX_HEAD)||"").replace(md.VERTEX_MAIN_SUPPORT,e.get(md.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=Fu(this.fragmentShader),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof y?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const n=this.uniforms;n.resolution.value.set(e,t),n.texelSize.value.set(1/e,1/t),n.aspect.value=e/t}static get Section(){return md}},Pd=class extends v{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:x.replace(/\D+/g,"")},uniforms:{inputBuffer:new p(null),threshold:new p(0),smoothing:new p(1),range:new p(null)},blending:g,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l);\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*l,l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:Lu}),this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return null!==this.luminanceRange}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){null!==e?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},Fd=class extends v{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new p(null),supportBuffer:new p(null),texelSize:new p(new l),radius:new p(.85)},blending:g,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;\n#else\nuniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;\n#endif\nuniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.fragmentShader=Fu(this.fragmentShader)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}set supportBuffer(e){this.uniforms.supportBuffer.value=e}get radius(){return this.uniforms.radius.value}set radius(e){this.uniforms.radius.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Id=new e,Nd=null;var Ud=class e{constructor(e="Pass",t=new b,n=Id){this.name=e,this.renderer=null,this.scene=t,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;null!==t&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;null!==t?t.material=e:(t=new _(function(){if(null===Nd){const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);void 0!==(Nd=new R).setAttribute?(Nd.setAttribute("position",new P(e,3)),Nd.setAttribute("uv",new P(t,2))):(Nd.addAttribute("position",new P(e,3)),Nd.addAttribute("uv",new P(t,2)))}return Nd}(),e),t.frustumCulled=!1,null===this.scene&&(this.scene=new b),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=a){}render(e,t,n,r,i){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,n){}dispose(){for(const t of Object.keys(this)){const r=this[t];(r instanceof n||r instanceof F||r instanceof I||r instanceof e)&&this[t].dispose()}}},zd=class extends Ud{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new Td,this.needsSwap=!1,this.renderTarget=e,void 0===e&&(this.renderTarget=new n(1,1,{minFilter:L,magFilter:L,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,n,r,i){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,n){void 0!==n&&(this.renderTarget.texture.type=n,n!==o?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":Ru(e)===wu&&Pu(this.renderTarget.texture,wu))}},Gd=class extends Ud{constructor(e,{minLuminance:t=.01,adaptationRate:i=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new Su,this.needsSwap=!1,this.renderTargetPrevious=new n(1,1,{minFilter:r,magFilter:r,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const a=this.fullscreenMaterial;a.luminanceBuffer0=this.renderTargetPrevious.texture,a.luminanceBuffer1=e,a.minLuminance=t,a.adaptationRate=i,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new zd(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(e){this.fullscreenMaterial.mipLevel1x1=e}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(e){this.fullscreenMaterial.adaptationRate=e}render(e,t,n,r,i){this.fullscreenMaterial.deltaTime=r,e.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),e.render(this.scene,this.camera),this.copyPass.render(e,this.renderTargetAdapted)}},Bd=class extends Ud{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,n,r,i){const a=e.state.buffers.stencil;a.setLocked(!1),a.setTest(!1)}},Dd=new t,kd=class extends Ud{constructor(e=!0,t=!0,n=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,n){this.color=e,this.depth=t,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,n,r,i){const a=this.overrideClearColor,o=this.overrideClearAlpha,s=e.getClearAlpha(),l=null!==a,c=o>=0;l?(e.getClearColor(Dd),e.setClearColor(a,c?o:s)):c&&e.setClearAlpha(o),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(Dd,s):c&&e.setClearAlpha(s)}},Od=-1,jd=class extends S{constructor(e,t=-1,n=-1,r=1){super(),this.resizable=e,this.baseSize=new l(1,1),this.preferredSize=new l(t,n),this.target=this.preferredSize,this.s=r,this.effectiveSize=new l,this.addEventListener("change",(()=>this.updateEffectiveSize())),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,n=this.effectiveSize,r=this.scale;t.width!==Od?n.width=t.width:t.height!==Od?n.width=Math.round(t.height*(e.width/Math.max(e.height,1))):n.width=Math.round(e.width*r),t.height!==Od?n.height=t.height:t.width!==Od?n.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):n.height=Math.round(e.height*r)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(Od),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){this.baseSize.width===e&&this.baseSize.height===t||(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){this.preferredSize.width===e&&this.preferredSize.height===t||(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Od}},Vd=!1,Hd=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case M:t=this.materialsFlatShadedDoubleSide;break;case w:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded}else switch(e.material.side){case M:t=this.materialsDoubleSide;break;case w:t=this.materialsBackSide;break;default:t=this.materials}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof v))return e.clone();const t=e.uniforms,n=new Map;for(const i in t){const e=t[i].value;e.isRenderTargetTexture&&(t[i].value=null,n.set(i,e))}const r=e.clone();for(const i of n)t[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(e){if(this.disposeMaterials(),this.material=e,null!==e){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const n of t)n.uniforms=Object.assign({},e.uniforms),n.side=A;t[2].skinning=!0,this.materialsBackSide=t.map((t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},e.uniforms),n.side=w,n})),this.materialsDoubleSide=t.map((t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},e.uniforms),n.side=M,n})),this.materialsFlatShaded=t.map((t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n})),this.materialsFlatShadedBackSide=t.map((t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=w,n})),this.materialsFlatShadedDoubleSide=t.map((t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=M,n}))}}render(e,t,n){const r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Vd){const r=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,n);for(const e of r)e[0].material=e[1];this.meshCount!==r.size&&r.clear()}else{const r=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,n),t.overrideMaterial=r}e.shadowMap.enabled=r}disposeMaterials(){if(null!==this.material){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Vd}static set workaroundEnabled(e){Vd=e}},Xd=class extends Ud{constructor(e,t,n=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new kd,this.overrideMaterialManager=null===n?null:new Hd(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return null!==e?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new Hd(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,n,r,i){const a=this.scene,o=this.camera,s=this.selection,l=o.layers.mask,c=a.background,u=e.shadowMap.autoUpdate,d=this.renderToScreen?null:t;null!==s&&o.layers.set(s.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(a.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(d),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,a,o):e.render(a,o),o.layers.mask=l,a.background=c,e.shadowMap.autoUpdate=u}},Wd=class extends Ud{constructor(e,i,{renderTarget:a,resolutionScale:o=1,width:s=jd.AUTO_SIZE,height:l=jd.AUTO_SIZE,resolutionX:c=s,resolutionY:u=l}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Xd(e,i,new N({depthPacking:U}));const d=this.renderPass;d.skipShadowMapUpdate=!0,d.ignoreBackground=!0;const f=d.clearPass;f.overrideClearColor=new t(16777215),f.overrideClearAlpha=1,this.renderTarget=a,void 0===this.renderTarget&&(this.renderTarget=new n(1,1,{minFilter:r,magFilter:r}),this.renderTarget.texture.name="DepthPass.Target");const p=this.resolution=new jd(this,c,u,o);p.addEventListener("change",(e=>this.setSize(p.baseWidth,p.baseHeight)))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,n,r,i){const a=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,a)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}},Yd=class extends Ud{constructor({normalBuffer:e=null,resolutionScale:t=.5,width:a=jd.AUTO_SIZE,height:o=jd.AUTO_SIZE,resolutionX:s=a,resolutionY:l=o}={}){super("DepthDownsamplingPass");const c=new Ed;c.normalBuffer=e,this.fullscreenMaterial=c,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new n(1,1,{minFilter:r,magFilter:r,depthBuffer:!1,type:i}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const u=this.resolution=new jd(this,s,l,t);u.addEventListener("change",(e=>this.setSize(u.baseWidth,u.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(e,t=a){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t}render(e,t,n,r,i){e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.fullscreenMaterial.setSize(e,t)}initialize(e,t,n){const r=e.getContext();if(!(r.getExtension("EXT_color_buffer_float")||r.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}};function $d(e,t,n){for(const r of t){const t="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),i=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const e of n.entries())null!==e[1]&&n.set(e[0],e[1].replace(i,t))}}function Zd(e,t,n){let r=t.getFragmentShader(),i=t.getVertexShader();const a=void 0!==r&&/mainImage/.test(r),o=void 0!==r&&/mainUv/.test(r);if(n.attributes|=t.getAttributes(),void 0===r)throw new Error(`Missing fragment shader (${t.name})`);if(o&&0!=(n.attributes&hd))throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!a&&!o)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const s=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=n.shaderParts;let c=l.get(md.FRAGMENT_HEAD)||"",u=l.get(md.FRAGMENT_MAIN_UV)||"",d=l.get(md.FRAGMENT_MAIN_IMAGE)||"",f=l.get(md.VERTEX_HEAD)||"",p=l.get(md.VERTEX_MAIN_SUPPORT)||"";const h=new Set,m=new Set;if(o&&(u+=`\t${e}MainUv(UV);\n`,n.uvTransformation=!0),null!==i&&/mainSupport/.test(i)){const t=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);p+=`\t${e}MainSupport(`,p+=t?"vUv);\n":");\n";for(const e of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const t of e[1].split(/\s*,\s*/))n.varyings.add(t),h.add(t),m.add(t);for(const e of i.matchAll(s))m.add(e[1])}for(const e of r.matchAll(s))m.add(e[1]);for(const e of t.defines.keys())m.add(e.replace(/\([\w\s,]*\)/g,""));for(const e of t.uniforms.keys())m.add(e);m.delete("while"),m.delete("for"),m.delete("if"),t.uniforms.forEach(((t,r)=>n.uniforms.set(e+r.charAt(0).toUpperCase()+r.slice(1),t))),t.defines.forEach(((t,r)=>n.defines.set(e+r.charAt(0).toUpperCase()+r.slice(1),t)));const v=new Map([["fragment",r],["vertex",i]]);$d(e,m,n.defines),$d(e,m,v),r=v.get("fragment"),i=v.get("vertex");const g=t.blendMode;if(n.blendModes.set(g.blendFunction,g),a){null!==t.inputColorSpace&&t.inputColorSpace!==n.colorSpace&&(d+=t.inputColorSpace===wu?"color0 = LinearTosRGB(color0);\n\t":"color0 = sRGBToLinear(color0);\n\t"),""!==t.outputColorSpace?n.colorSpace=t.outputColorSpace:null!==t.inputColorSpace&&(n.colorSpace=t.inputColorSpace);const i=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${e}MainImage(color0, UV, `,0!=(n.attributes&pd)&&i.test(r)&&(d+="depth, ",n.readDepth=!0),d+="color1);\n\t";const a=e+"BlendOpacity";n.uniforms.set(a,g.opacity),d+=`color0 = blend${g.blendFunction}(color0, color1, ${a});\n\n\t`,c+=`uniform float ${a};\n\n`}if(c+=r+"\n",null!==i&&(f+=i+"\n"),l.set(md.FRAGMENT_HEAD,c),l.set(md.FRAGMENT_MAIN_UV,u),l.set(md.FRAGMENT_MAIN_IMAGE,d),l.set(md.VERTEX_HEAD,f),l.set(md.VERTEX_MAIN_SUPPORT,p),null!==t.extensions)for(const e of t.extensions)n.extensions.add(e)}}var Qd=class extends Ud{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new Rd(null,null,null,e),this.listener=e=>this.handleEvent(e),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort(((e,t)=>t.attributes-e.attributes));for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const e=new rf;let t=0;for(const o of this.effects)if(o.blendMode.blendFunction===ju)e.attributes|=o.getAttributes()&pd;else{if(0!=(e.attributes&o.getAttributes()&hd))throw new Error(`Convolution effects cannot be merged (${o.name})`);Zd("e"+t++,o,e)}let n=e.shaderParts.get(md.FRAGMENT_HEAD),r=e.shaderParts.get(md.FRAGMENT_MAIN_IMAGE),i=e.shaderParts.get(md.FRAGMENT_MAIN_UV);const a=/\bblend\b/g;for(const o of e.blendModes.values())n+=o.getShaderCode().replace(a,`blend${o.blendFunction}`)+"\n";0!=(e.attributes&pd)?(e.readDepth&&(r="float depth = readDepth(UV);\n\n\t"+r),this.needsDepthTexture=null===this.getDepthTexture()):this.needsDepthTexture=!1,e.colorSpace===wu&&(r+="color0 = sRGBToLinear(color0);\n\t"),e.uvTransformation?(i="vec2 transformedUv = vUv;\n"+i,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(md.FRAGMENT_HEAD,n),e.shaderParts.set(md.FRAGMENT_MAIN_IMAGE,r),e.shaderParts.set(md.FRAGMENT_MAIN_UV,i);for(const[o,s]of e.shaderParts)null!==s&&e.shaderParts.set(o,s.trim().replace(/^#/,"\n#"));this.skipRendering=0===t,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=a){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const n of this.effects)n.setDepthTexture(e,t)}render(e,t,n,r,i){for(const a of this.effects)a.update(e,t,r);if(!this.skipRendering||this.renderToScreen){const i=this.fullscreenMaterial;i.inputBuffer=t.texture,i.time+=r*this.timeScale,e.setRenderTarget(this.renderToScreen?null:n),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const n of this.effects)n.setSize(e,t)}initialize(e,t,n){this.renderer=e;for(const r of this.effects)r.initialize(e,t,n);this.updateMaterial(),void 0!==n&&n!==o&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){if("change"===e.type)this.recompile()}},Kd=class extends Ud{constructor({kernelSize:e=vd,resolutionScale:t=.5,width:r=jd.AUTO_SIZE,height:i=jd.AUTO_SIZE,resolutionX:a=r,resolutionY:o=i}={}){super("KawaseBlurPass"),this.renderTargetA=new n(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const s=this.resolution=new jd(this,a,o,t);s.addEventListener("change",(e=>this.setSize(s.baseWidth,s.baseHeight))),this._blurMaterial=new Ad,this._blurMaterial.kernelSize=e,this.copyMaterial=new Td}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,n,r,i){const a=this.scene,o=this.camera,s=this.renderTargetA,l=this.renderTargetB,c=this.blurMaterial,u=c.kernelSequence;let d=t;this.fullscreenMaterial=c;for(let f=0,p=u.length;f<p;++f){const t=0==(1&f)?s:l;c.kernel=u[f],c.inputBuffer=d.texture,e.setRenderTarget(t),e.render(a,o),d=t}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=d.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(a,o)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t);const r=n.width,i=n.height;this.renderTargetA.setSize(r,i),this.renderTargetB.setSize(r,i),this.blurMaterial.setSize(e,t)}initialize(e,t,n){void 0!==n&&(this.renderTargetA.texture.type=n,this.renderTargetB.texture.type=n,n!==o?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):Ru(e)===wu&&(Pu(this.renderTargetA.texture,wu),Pu(this.renderTargetB.texture,wu)))}static get AUTO_SIZE(){return jd.AUTO_SIZE}},qd=class extends Ud{constructor({renderTarget:e,luminanceRange:t,colorOutput:r,resolutionScale:i=1,width:a=jd.AUTO_SIZE,height:o=jd.AUTO_SIZE,resolutionX:s=a,resolutionY:l=o}={}){super("LuminancePass"),this.fullscreenMaterial=new Pd(r,t),this.needsSwap=!1,this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new n(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new jd(this,s,l,i);c.addEventListener("change",(e=>this.setSize(c.baseWidth,c.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,n,r,i){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}initialize(e,t,n){void 0!==n&&n!==o&&(this.renderTarget.texture.type=n,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Jd=class extends Ud{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new kd(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,n,r,i){const a=e.getContext(),o=e.state.buffers,s=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,d=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.stencil.setFunc(a.ALWAYS,u,4294967295),o.stencil.setClear(d),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,n))),this.renderToScreen?(e.setRenderTarget(null),e.render(s,l)):(e.setRenderTarget(t),e.render(s,l),e.setRenderTarget(n),e.render(s,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(a.EQUAL,1,4294967295),o.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.stencil.setLocked(!0)}},ef=class extends Ud{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new n(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Cd,this.upsamplingMaterial=new Fd,this.resolution=new l}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(e){if(this.levels!==e){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let n=0;n<e;++n){const e=t.clone();e.texture.name="Downsampling.Mipmap"+n,this.downsamplingMipmaps.push(e)}this.upsamplingMipmaps.push(t);for(let n=1,r=e-1;n<r;++n){const e=t.clone();e.texture.name="Upsampling.Mipmap"+n,this.upsamplingMipmaps.push(e)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(e){this.upsamplingMaterial.radius=e}render(e,t,n,r,i){const{scene:a,camera:o}=this,{downsamplingMaterial:s,upsamplingMaterial:l}=this,{downsamplingMipmaps:c,upsamplingMipmaps:u}=this;let d=t;this.fullscreenMaterial=s;for(let f=0,p=c.length;f<p;++f){const t=c[f];s.setSize(d.width,d.height),s.inputBuffer=d.texture,e.setRenderTarget(t),e.render(a,o),d=t}this.fullscreenMaterial=l;for(let f=u.length-1;f>=0;--f){const t=u[f];l.setSize(d.width,d.height),l.inputBuffer=d.texture,l.supportBuffer=c[f].texture,e.setRenderTarget(t),e.render(a,o),d=t}}setSize(e,t){const n=this.resolution;n.set(e,t);let r=n.width,i=n.height;for(let a=0,o=this.downsamplingMipmaps.length;a<o;++a)r=Math.round(.5*r),i=Math.round(.5*i),this.downsamplingMipmaps[a].setSize(r,i),a<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[a].setSize(r,i)}initialize(e,t,n){if(void 0!==n){const t=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const e of t)e.texture.type=n;if(n!==o)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(Ru(e)===wu)for(const e of t)Pu(e.texture,wu)}}dispose(){super.dispose();for(const e of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))e.dispose()}},tf=class extends Ud{constructor(e,i,{renderTarget:a,resolutionScale:o=1,width:l=jd.AUTO_SIZE,height:c=jd.AUTO_SIZE,resolutionX:u=l,resolutionY:d=c}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new Xd(e,i,new s);const f=this.renderPass;f.ignoreBackground=!0,f.skipShadowMapUpdate=!0;const p=f.getClearPass();p.overrideClearColor=new t(7829503),p.overrideClearAlpha=1,this.renderTarget=a,void 0===this.renderTarget&&(this.renderTarget=new n(1,1,{minFilter:r,magFilter:r}),this.renderTarget.texture.name="NormalPass.Target");const h=this.resolution=new jd(this,u,d,o);h.addEventListener("change",(e=>this.setSize(h.baseWidth,h.baseHeight)))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,n,r,i){const a=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,a,a)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}},nf=.001,rf=class{constructor(){this.shaderParts=new Map([[md.FRAGMENT_HEAD,null],[md.FRAGMENT_MAIN_UV,null],[md.FRAGMENT_MAIN_IMAGE,null],[md.VERTEX_HEAD,null],[md.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=fd,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Mu}},af=class extends Set{constructor(e,t=10){super(),this.l=t,this.exclusive=!1,void 0!==e&&this.set(e)}get layer(){return this.l}set layer(e){const t=this.l;for(const n of this)n.layers.disable(t),n.layers.enable(e);this.l=e}getLayer(){return this.layer}setLayer(e){this.layer=e}isExclusive(){return this.exclusive}setExclusive(e){this.exclusive=e}clear(){const e=this.layer;for(const t of this)t.layers.disable(e);return super.clear()}set(e){this.clear();for(const t of e)this.add(t);return this}indexOf(e){return this.has(e)?0:-1}add(e){return this.exclusive?e.layers.set(this.layer):e.layers.enable(this.layer),super.add(e)}delete(e){return this.has(e)&&e.layers.disable(this.layer),super.delete(e)}toggle(e){let t;return this.has(e)?(this.delete(e),t=!1):(this.add(e),t=!0),t}setVisible(e){for(const t of this)e?t.layers.enable(0):t.layers.disable(0);return this}},of=new Map([[Iu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}"],[Nu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}"],[Uu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}"],[zu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[Gu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}"],[Bu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}"],[Du,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}"],[ku,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}"],[Ou,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}"],[ju,null],[Vu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}"],[Hu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}"],[Xu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}"],[Wu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}"],[Yu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}"],[$u,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}"],[Zu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}"],[Qu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}"],[Ku,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}"],[qu,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}"],[Ju,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[ed,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}"],[td,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}"],[nd,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}"],[rd,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}"],[id,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}"],[ad,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}"],[od,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[sd,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}"],[ld,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}"],[cd,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}"],[ud,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}"],[dd,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}"]]),sf=class extends S{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new p(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return of.get(this.blendFunction)}},lf=class extends S{constructor(e,t,{attributes:n=fd,blendFunction:r=nd,defines:i=new Map,uniforms:a=new Map,extensions:o=null,vertexShader:s=null}={}){super(),this.name=e,this.renderer=null,this.attributes=n,this.fragmentShader=t,this.vertexShader=s,this.defines=i,this.uniforms=a,this.extensions=o,this.blendMode=new sf(r),this.blendMode.addEventListener("change",(e=>this.setChanged())),this._inputColorSpace=Mu,this._outputColorSpace=""}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=a){}update(e,t,n){}setSize(e,t){}initialize(e,t,n){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof n||t instanceof F||t instanceof I||t instanceof Ud)&&this[e].dispose()}}},cf=class extends lf{constructor({offset:e=new l(.001,5e-4),radialModulation:t=!1,modulationOffset:n=.15}={}){super("ChromaticAberrationEffect","#ifdef RADIAL_MODULATION\nuniform float modulationOffset;\n#endif\nvarying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;\n#ifdef RADIAL_MODULATION\nconst vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}\n#else\nif(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}\n#endif\noutputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",{vertexShader:"uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",attributes:hd,uniforms:new Map([["offset",new p(e)],["modulationOffset",new p(n)]])}),this.radialModulation=t}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(e){e?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(e){this.uniforms.get("modulationOffset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}};new h,new m;new t;var uf=.5*Math.PI,df=new h,ff=new h;let pf;class hf extends G{constructor(e){super(e),this.type=B}parse(e){const t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,n){t=t||1024;let r=e.pos,i=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;0>(i=s.indexOf("\n"))&&a<t&&r<e.byteLength;)o+=s,a+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<i&&(!1!==n&&(e.pos+=a+i+1),o+s.slice(0,i))},r=function(e,t,n,r){const i=e[t+3],a=Math.pow(2,i-128)/255;n[r+0]=e[t+0]*a,n[r+1]=e[t+1]*a,n[r+2]=e[t+2]*a,n[r+3]=1},a=function(e,t,n,r){const i=e[t+3],a=Math.pow(2,i-128)/255;n[r+0]=D.toHalfFloat(Math.min(e[t+0]*a,65504)),n[r+1]=D.toHalfFloat(Math.min(e[t+1]*a,65504)),n[r+2]=D.toHalfFloat(Math.min(e[t+2]*a,65504)),n[r+3]=D.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;const s=function(e){const r=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;if(e.pos>=e.byteLength||!(l=n(e)))return t(1,"no header found");if(!(c=l.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(s.valid|=1,s.programtype=c[1],s.string+=l+"\n";l=n(e),!1!==l;)if(s.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(r))&&(s.gamma=parseFloat(c[1])),(c=l.match(i))&&(s.exposure=parseFloat(c[1])),(c=l.match(a))&&(s.valid|=2,s.format=c[1]),(c=l.match(o))&&(s.valid|=4,s.height=parseInt(c[1],10),s.width=parseInt(c[2],10)),2&s.valid&&4&s.valid)break}else s.comments+=l+"\n";return 2&s.valid?4&s.valid?s:t(3,"missing image size specifier"):t(3,"missing format specifier")}(o);if(-1!==s){const e=s.width,n=s.height,l=function(e,n,r){const i=n;if(i<8||i>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(i!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");const a=new Uint8Array(4*n*r);if(!a.length)return t(4,"unable to allocate buffer space");let o=0,s=0;const l=4*i,c=new Uint8Array(4),u=new Uint8Array(l);let d=r;for(;d>0&&s<e.byteLength;){if(s+4>e.byteLength)return t(1);if(c[0]=e[s++],c[1]=e[s++],c[2]=e[s++],c[3]=e[s++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=i)return t(3,"bad rgbe scanline format");let n,r=0;for(;r<l&&s<e.byteLength;){n=e[s++];const i=n>128;if(i&&(n-=128),0===n||r+n>l)return t(3,"bad scanline data");if(i){const t=e[s++];for(let e=0;e<n;e++)u[r++]=t}else u.set(e.subarray(s,s+n),r),r+=n,s+=n}const f=i;for(let e=0;e<f;e++){let t=0;a[o]=u[e+t],t+=i,a[o+1]=u[e+t],t+=i,a[o+2]=u[e+t],t+=i,a[o+3]=u[e+t],o+=4}d--}return a}(o.subarray(o.pos),e,n);if(-1!==l){let t,o,c;switch(this.type){case i:c=l.length/4;const e=new Float32Array(4*c);for(let t=0;t<c;t++)r(l,4*t,e,4*t);t=e,o=i;break;case B:c=l.length/4;const n=new Uint16Array(4*c);for(let t=0;t<c;t++)a(l,4*t,n,4*t);t=n,o=B;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:n,data:t,header:s.string,gamma:s.gamma,exposure:s.exposure,type:o}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,(function(e,n){switch(e.type){case i:case B:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=L,e.magFilter=L,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,r)}}class mf extends k{constructor(e,t){const n=new R;n.setAttribute("position",new O([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere();super(n,new j({fog:!1})),this.light=e,this.color=t,this.type="RectAreaLightHelper";const r=new R;r.setAttribute("position",new O([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new _(r,new V({side:w,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}function vf(){return vf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},vf.apply(this,arguments)}var gf=0;function xf(e){return"__private_"+gf+++"_"+e}function yf(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var bf="#define GLSLIFY 1\nvarying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",_f="#define GLSLIFY 1\nuniform sampler2D inputTexture;uniform sampler2D accumulatedTexture;uniform sampler2D velocityTexture;uniform sampler2D lastVelocityTexture;uniform sampler2D depthTexture;uniform float temporalResolveCorrectionMix;varying vec2 vUv;\n#include <packing>\n#define min3(a, b, c) min(a, min(b, c))\n#define min4(a, b, c, d) min(a, min3(b, c, d))\n#define min5(a, b, c, d, e) min(a, min4(b, c, d, e))\n#define min6(a, b, c, d, e, f) min(a, min5(b, c, d, e, f))\n#define min7(a, b, c, d, e, f, g) min(a, min6(b, c, d, e, f, g))\n#define min8(a, b, c, d, e, f, g, h) min(a, min7(b, c, d, e, f, g, h))\n#define min9(a, b, c, d, e, f, g, h, i) min(a, min8(b, c, d, e, f, g, h, i))\n#define max3(a, b, c) max(a, max(b, c))\n#define max4(a, b, c, d) max(a, max3(b, c, d))\n#define max5(a, b, c, d, e) max(a, max4(b, c, d, e))\n#define max6(a, b, c, d, e, f) max(a, max5(b, c, d, e, f))\n#define max7(a, b, c, d, e, f, g) max(a, max6(b, c, d, e, f, g))\n#define max8(a, b, c, d, e, f, g, h) max(a, max7(b, c, d, e, f, g, h))\n#define max9(a, b, c, d, e, f, g, h, i) max(a, max8(b, c, d, e, f, g, h, i))\nvec2 getVelocity(sampler2D tex,vec2 uv,vec2 texSize){float closestDepth=100.0;vec2 closestUVOffset;for(int j=-1;j<=1;++j){for(int i=-1;i<=1;++i){vec2 uvOffset=vec2(i,j)/texSize;float neighborDepth=unpackRGBAToDepth(textureLod(depthTexture,vUv+uvOffset,0.));if(neighborDepth<closestDepth){closestUVOffset=uvOffset;closestDepth=neighborDepth;}}}return textureLod(velocityTexture,vUv+closestUVOffset,0.).xy;}void main(){vec4 inputTexel=texture2D(inputTexture,vUv);vec4 accumulatedTexel;vec3 outputColor;ivec2 size=textureSize(inputTexture,0);vec2 pxSize=vec2(float(size.x),float(size.y));vec2 velUv=texture2D(velocityTexture,vUv).xy;vec2 reprojectedUv=vUv-velUv;vec2 lastVelUv=texture2D(lastVelocityTexture,reprojectedUv).xy;float velocityLength=length(lastVelUv-velUv);float velocityDisocclusion=(velocityLength-0.000005)*10.;velocityDisocclusion*=velocityDisocclusion;\n#ifdef DILATION\nvelUv=getVelocity(velocityTexture,vUv,pxSize);reprojectedUv=vUv-velUv;\n#endif\nvec3 averageNeighborColor;bool didReproject=true;float movement=length(velUv)*100.;if(movement>0.){vec2 px=1./pxSize;vec3 c02=texture2D(inputTexture,vUv+vec2(-px.x,px.y)).rgb;vec3 c12=texture2D(inputTexture,vUv+vec2(0.,px.y)).rgb;vec3 c22=texture2D(inputTexture,vUv+vec2(px.x,px.y)).rgb;vec3 c01=texture2D(inputTexture,vUv+vec2(-px.x,0.)).rgb;vec3 c11=inputTexel.rgb;vec3 c21=texture2D(inputTexture,vUv+vec2(px.x,0.)).rgb;vec3 c00=texture2D(inputTexture,vUv+vec2(-px.x,-px.y)).rgb;vec3 c10=texture2D(inputTexture,vUv+vec2(0.,-px.y)).rgb;vec3 c20=texture2D(inputTexture,vUv+vec2(px.x,-px.y)).rgb;averageNeighborColor=c02+c12+c22+c01+c11+c21+c00+c10+c20;averageNeighborColor/=9.;if(reprojectedUv.x>=0.&&reprojectedUv.x<=1.&&reprojectedUv.y>=0.&&reprojectedUv.y<=1.){accumulatedTexel=texture2D(accumulatedTexture,reprojectedUv);vec3 minNeighborColor=min9(c02,c12,c22,c01,c11,c21,c00,c10,c20);vec3 maxNeighborColor=max9(c02,c12,c22,c01,c11,c21,c00,c10,c20);vec3 clampedColor=clamp(accumulatedTexel.rgb,minNeighborColor,maxNeighborColor);float mixFactor=temporalResolveCorrectionMix*(1.+movement);mixFactor=min(mixFactor,1.);accumulatedTexel.rgb=mix(accumulatedTexel.rgb,clampedColor,mixFactor);}else{accumulatedTexel.rgb=inputTexel.rgb;didReproject=false;}}else{accumulatedTexel=texture2D(accumulatedTexture,vUv);}\n#include <custom_compose_shader>\ngl_FragColor=vec4(vec3(outputColor),alpha);}";const Lf=`\n\t\tvec3 transformed;\n\n\t\t// Get the normal\n\t\t${H.skinbase_vertex}\n\t\t${H.beginnormal_vertex}\n\t\t${H.skinnormal_vertex}\n\t\t${H.defaultnormal_vertex}\n\n\t\t// Get the current vertex position\n\t\ttransformed = vec3( position );\n\t\t${H.skinning_vertex}\n\t\tnewPosition = velocityMatrix * vec4( transformed, 1.0 );\n\n\t\t// Get the previous vertex position\n\t\ttransformed = vec3( position );\n\t\t${H.skinbase_vertex.replace(/mat4 /g,"").replace(/getBoneMatrix/g,"getPrevBoneMatrix")}\n\t\t${H.skinning_vertex.replace(/vec4 /g,"")}\n\t\tprevPosition = prevVelocityMatrix * vec4( transformed, 1.0 );\n\n\t\tgl_Position = newPosition;\n\n\t`,Sf={uniforms:{prevVelocityMatrix:{value:new m},velocityMatrix:{value:new m},prevBoneTexture:{value:null},interpolateGeometry:{value:0},intensity:{value:1},boneTexture:{value:null},alphaTest:{value:0},map:{value:null},alphaMap:{value:null},opacity:{value:1}},vertexShader:`\n\t\t\t${H.skinning_pars_vertex}\n\t\t\t\n\t\t#ifdef USE_SKINNING\n\t\t#ifdef BONE_TEXTURE\n\t\t\tuniform sampler2D prevBoneTexture;\n\t\t\tmat4 getPrevBoneMatrix( const in float i ) {\n\t\t\t\tfloat j = i * 4.0;\n\t\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\t\ty = dy * ( y + 0.5 );\n\t\t\t\tvec4 v1 = texture2D( prevBoneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\t\tvec4 v2 = texture2D( prevBoneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\t\tvec4 v3 = texture2D( prevBoneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\t\tvec4 v4 = texture2D( prevBoneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\t\treturn bone;\n\t\t\t}\n\t\t#else\n\t\t\tuniform mat4 prevBoneMatrices[ MAX_BONES ];\n\t\t\tmat4 getPrevBoneMatrix( const in float i ) {\n\t\t\t\tmat4 bone = prevBoneMatrices[ int(i) ];\n\t\t\t\treturn bone;\n\t\t\t}\n\t\t#endif\n\t\t#endif\n\t\n\n\t\t\tuniform mat4 velocityMatrix;\n\t\t\tuniform mat4 prevVelocityMatrix;\n\t\t\tuniform float interpolateGeometry;\n\t\t\tvarying vec4 prevPosition;\n\t\t\tvarying vec4 newPosition;\n\n\t\t\tvoid main() {\n\n\t\t\t\t${Lf}\n\n\t\t\t}\n\t\t`,fragmentShader:"\n\t\t\tuniform float intensity;\n\t\t\tvarying vec4 prevPosition;\n\t\t\tvarying vec4 newPosition;\n\n\t\t\tvoid main() {\n\t\t\t\t#ifdef NEEDS_FULL_MOVEMENT\n\t\t\t\t\tgl_FragColor = vec4(1., 1., 1., 1. );\n\t\t\t\t\treturn;\n\t\t\t\t#endif\n\n\t\t\t\tvec2 pos0 = (prevPosition.xy / prevPosition.w) * 0.5 + 0.5;\n\t\t\t\tvec2 pos1 = (newPosition.xy / newPosition.w) * 0.5 + 0.5;\n\n\t\t\t\tvec2 vel = pos1 - pos0;\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4( vel, 0., 1. );\n\n\t\t\t}\n\t\t",defines:{MAX_BONES:256}};var wf=xf("cachedMaterials"),Mf=xf("setVelocityMaterialInScene"),Af=xf("unsetVelocityMaterialInScene");class Tf extends Ud{constructor(e,t){super("VelocityPass"),Object.defineProperty(this,Af,{value:Cf}),Object.defineProperty(this,Mf,{value:Ef}),Object.defineProperty(this,wf,{writable:!0,value:new WeakMap}),this._scene=e,this._camera=t,this.renderTarget=new n("undefined"!=typeof window?window.innerWidth:2e3,"undefined"!=typeof window?window.innerHeight:1e3,{minFilter:r,magFilter:r,type:B})}setSize(e,t){this.renderTarget.setSize(e,t)}render(e){yf(this,Mf)[Mf](),e.setRenderTarget(this.renderTarget),e.clear(),e.render(this._scene,this._camera),yf(this,Af)[Af]()}}function Ef(){this._scene.traverse((e=>{if(e.material){const t=e.material;let[n,r]=yf(this,wf)[wf].get(e)||[];yf(this,wf)[wf].has(e)&&t===n||(r=new v({uniforms:Z.clone(Sf.uniforms),vertexShader:Sf.vertexShader,fragmentShader:Sf.fragmentShader,side:A}),yf(this,wf)[wf].set(e,[t,r]));const i=e.material.userData.needsUpdatedReflections||e.material.map instanceof Q;i&&!Object.keys(r.defines).includes("NEEDS_FULL_MOVEMENT")?(r.defines.NEEDS_FULL_MOVEMENT="",r.needsUpdate=!0):!i&&Object.keys(r.defines).includes("NEEDS_FULL_MOVEMENT")&&(delete r.defines.NEEDS_FULL_MOVEMENT,r.needsUpdate=!0),r.uniforms.velocityMatrix.value.multiplyMatrices(this._camera.projectionMatrix,e.modelViewMatrix),e.material=r}}))}function Cf(){this._scene.traverse((e=>{if(e.material){e.material.uniforms.prevVelocityMatrix.value.multiplyMatrices(this._camera.projectionMatrix,e.modelViewMatrix);const[t]=yf(this,wf)[wf].get(e);e.material=t}}))}const Rf=new l;var Pf=xf("velocityPass");class Ff extends Ud{constructor(e,t,r,i={}){super("TemporalResolvePass"),Object.defineProperty(this,Pf,{writable:!0,value:null});const a=i.width||"undefined"!=typeof window?window.innerWidth:2e3,o=i.height||"undefined"!=typeof window?window.innerHeight:1e3;this.renderTarget=new n(a,o,{minFilter:L,magFilter:L,type:B,depthBuffer:!1}),yf(this,Pf)[Pf]=new Tf(e,t);const s=_f.replace("#include <custom_compose_shader>",r);this.fullscreenMaterial=new v({type:"TemporalResolveMaterial",uniforms:{inputTexture:new p(null),accumulatedTexture:new p(null),velocityTexture:new p(yf(this,Pf)[Pf].renderTarget.texture),lastVelocityTexture:new p(null),depthTexture:new p(null),temporalResolveMix:new p(0),temporalResolveCorrectionMix:new p(0)},vertexShader:bf,fragmentShader:s}),this.setupAccumulatedTexture(a,o)}dispose(){this.renderTarget.dispose(),this.accumulatedTexture.dispose(),this.fullscreenMaterial.dispose(),yf(this,Pf)[Pf].dispose()}setSize(e,t){this.renderTarget.setSize(e,t),yf(this,Pf)[Pf].setSize(e,t),this.setupAccumulatedTexture(e,t)}setupAccumulatedTexture(e,t){this.accumulatedTexture&&this.accumulatedTexture.dispose(),this.accumulatedTexture=new W(e,t,Y),this.accumulatedTexture.minFilter=L,this.accumulatedTexture.magFilter=L,this.accumulatedTexture.type=B,this.lastVelocityTexture=new W(e,t,Y),this.lastVelocityTexture.minFilter=r,this.lastVelocityTexture.magFilter=r,this.lastVelocityTexture.type=B,this.fullscreenMaterial.uniforms.accumulatedTexture.value=this.accumulatedTexture,this.fullscreenMaterial.uniforms.lastVelocityTexture.value=this.lastVelocityTexture,this.fullscreenMaterial.needsUpdate=!0}render(e){yf(this,Pf)[Pf].render(e),e.setRenderTarget(this.renderTarget),e.render(this.scene,this.camera),e.copyFramebufferToTexture(Rf,this.accumulatedTexture),e.setRenderTarget(yf(this,Pf)[Pf].renderTarget),e.copyFramebufferToTexture(Rf,this.lastVelocityTexture)}}var If="#define GLSLIFY 1\nvec3 getViewPosition(const float depth){float clipW=_projectionMatrix[2][3]*depth+_projectionMatrix[3][3];vec4 clipPosition=vec4((vec3(vUv,depth)-0.5)*2.0,1.0);clipPosition*=clipW;return(_inverseProjectionMatrix*clipPosition).xyz;}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}vec3 screenSpaceToWorldSpace(const vec2 uv,const float depth){vec4 ndc=vec4((uv.x-0.5)*2.0,(uv.y-0.5)*2.0,(depth-0.5)*2.0,1.0);vec4 clip=_inverseProjectionMatrix*ndc;vec4 view=cameraMatrixWorld*(clip/clip.w);return view.xyz;}\n#define Scale (vec3(0.8, 0.8, 0.8))\n#define K (19.19)\nvec3 hash(vec3 a){a=fract(a*Scale);a+=dot(a,a.yxz+K);return fract((a.xxy+a.yxx)*a.zyx);}float fresnel_dielectric_cos(float cosi,float eta){float c=abs(cosi);float g=eta*eta-1.0+c*c;float result;if(g>0.0){g=sqrt(g);float A=(g-c)/(g+c);float B=(c*(g+c)-1.0)/(c*(g-c)+1.0);result=0.5*A*A*(1.0+B*B);}else{result=1.0;}return result;}float fresnel_dielectric(vec3 Incoming,vec3 Normal,float eta){float cosine=dot(Incoming,Normal);return min(1.0,5.0*fresnel_dielectric_cos(cosine,eta));}float czm_luminance(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);return dot(rgb,W);}";class Nf extends v{constructor(){super({type:"MRTMaterial",defines:{USE_UV:"",TEMPORAL_RESOLVE:""},uniforms:{opacity:new p(1),normalMap:new p(null),normalScale:new p(new l(1,1)),uvTransform:new p(new K),roughness:new p(1),roughnessMap:new p(null)},vertexShader:"\n                 #ifdef USE_MRT\n                out vec2 vHighPrecisionZW;\n                #endif\n                #define NORMAL\n                #if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n                    varying vec3 vViewPosition;\n                #endif\n                #include <common>\n                #include <uv_pars_vertex>\n                #include <displacementmap_pars_vertex>\n                #include <normal_pars_vertex>\n                #include <morphtarget_pars_vertex>\n                #include <skinning_pars_vertex>\n                #include <logdepthbuf_pars_vertex>\n                #include <clipping_planes_pars_vertex>\n                void main() {\n                    #include <uv_vertex>\n                    #include <beginnormal_vertex>\n                    #include <morphnormal_vertex>\n                    #include <skinbase_vertex>\n                    #include <skinnormal_vertex>\n                    #include <defaultnormal_vertex>\n                    #include <normal_vertex>\n                    #include <begin_vertex>\n                    #include <morphtarget_vertex>\n                    #include <skinning_vertex>\n                    #include <displacementmap_vertex>\n                    #include <project_vertex>\n                    #include <logdepthbuf_vertex>\n                    #include <clipping_planes_vertex>\n                    #if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n                        vViewPosition = - mvPosition.xyz;\n                    #endif\n                    #ifdef USE_MRT\n                        vHighPrecisionZW = gl_Position.zw;\n                    #endif \n                    #ifdef USE_UV\n                        vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n                    #endif\n                }\n            ",fragmentShader:"\n                 #define NORMAL\n                #if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n                    varying vec3 vViewPosition;\n                #endif\n                #include <packing>\n                #include <uv_pars_fragment>\n                #include <normal_pars_fragment>\n                #include <bumpmap_pars_fragment>\n                #include <normalmap_pars_fragment>\n                #include <logdepthbuf_pars_fragment>\n                #include <clipping_planes_pars_fragment>\n                #include <roughnessmap_pars_fragment>\n                \n                #ifdef USE_MRT\n                layout(location = 0) out vec4 gNormal;\n                layout(location = 1) out vec4 gDepth;\n                \n                in vec2 vHighPrecisionZW;\n                #endif\n                uniform float roughness;\n                void main() {\n                    #include <clipping_planes_fragment>\n                    #include <logdepthbuf_fragment>\n                    #include <normal_fragment_begin>\n                    #include <normal_fragment_maps>\n\n                    float roughnessFactor = roughness;\n                    \n                    if(roughness > 10.0e9){\n                        roughnessFactor = 1.;\n                    }else{\n                        #ifdef USE_ROUGHNESSMAP\n                            vec4 texelRoughness = texture2D( roughnessMap, vUv );\n                            // reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n                            roughnessFactor *= texelRoughness.g;\n                        #endif\n                    }\n\n                    vec3 normalColor = packNormalToRGB( normal );\n                    #ifdef USE_MRT\n                        float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n                        vec4 depthColor = packDepthToRGBA( fragCoordZ );\n                        gNormal = vec4( normalColor, roughnessFactor );\n                        gDepth = depthColor;\n                    #else\n                        gl_FragColor = vec4(normalColor, roughnessFactor);\n                    #endif\n                }\n            ",toneMapped:!1}),this.normalMapType=q,this.normalScale=new l(1,1),Object.defineProperty(this,"glslVersion",{get(){return"USE_MRT"in this.defines?J:null},set(e){}})}}class Uf extends v{constructor(){super({type:"ReflectionsMaterial",uniforms:{inputTexture:new p(null),accumulatedTexture:new p(null),normalTexture:new p(null),depthTexture:new p(null),_projectionMatrix:new p(new m),_inverseProjectionMatrix:new p(new m),cameraMatrixWorld:new p(new m),cameraNear:new p(0),cameraFar:new p(0),rayStep:new p(.1),intensity:new p(1),roughnessFadeOut:new p(1),rayFadeOut:new p(0),thickness:new p(10),ior:new p(1.45),maxDepthDifference:new p(1),maxDepth:new p(1),jitter:new p(.5),jitterRough:new p(.5),jitterSpread:new p(1),maxRoughness:new p(1),samples:new p(0)},defines:{MAX_STEPS:20,NUM_BINARY_SEARCH_STEPS:5},fragmentShader:"#define GLSLIFY 1\nvarying vec2 vUv;uniform sampler2D inputTexture;uniform sampler2D accumulatedTexture;uniform sampler2D normalTexture;uniform sampler2D depthTexture;uniform mat4 _projectionMatrix;uniform mat4 _inverseProjectionMatrix;uniform mat4 cameraMatrixWorld;uniform float cameraNear;uniform float cameraFar;uniform float rayStep;uniform float intensity;uniform float maxDepthDifference;uniform float roughnessFadeOut;uniform float maxRoughness;uniform float maxDepth;uniform float rayFadeOut;uniform float thickness;uniform float ior;uniform float samples;\n#ifdef ENABLE_JITTERING\nuniform float jitter;uniform float jitterRough;uniform float jitterSpread;\n#endif\n#define FLOAT_EPSILON 0.00001\n#define EARLY_OUT_COLOR vec4(0., 0., 0., 1.)\nconst vec2 INVALID_RAY_COORDS=vec2(-1.);float _maxDepthDifference;float nearMinusFar;float nearMulFar;float farMinusNear;\n#include <packing>\n#include <helperFunctions>\nvec2 BinarySearch(inout vec3 dir,inout vec3 hitPos,inout float rayHitDepthDifference);vec2 RayMarch(vec3 dir,inout vec3 hitPos,inout float rayHitDepthDifference);float fastGetViewZ(const in float depth);void main(){vec4 depthTexel=textureLod(depthTexture,vUv,0.);if(dot(depthTexel.rgb,depthTexel.rgb)<FLOAT_EPSILON){gl_FragColor=EARLY_OUT_COLOR;return;}float unpackedDepth=unpackRGBAToDepth(depthTexel);if(unpackedDepth>maxDepth){gl_FragColor=EARLY_OUT_COLOR;return;}vec4 normalTexel=textureLod(normalTexture,vUv,0.);float roughness=normalTexel.a;if(roughness>maxRoughness||(roughness>1.-FLOAT_EPSILON&&roughnessFadeOut>1.-FLOAT_EPSILON)){gl_FragColor=EARLY_OUT_COLOR;return;}_maxDepthDifference=maxDepthDifference*0.01;nearMinusFar=cameraNear-cameraFar;nearMulFar=cameraNear*cameraFar;farMinusNear=cameraFar-cameraNear;float specular=1.-roughness;specular*=specular;normalTexel.rgb=unpackRGBToNormal(normalTexel.rgb);float depth=fastGetViewZ(unpackedDepth);vec3 viewNormal=normalTexel.xyz;vec3 viewPos=getViewPosition(depth);vec3 worldPos=screenSpaceToWorldSpace(vUv,unpackedDepth);vec3 jitt=vec3(0.);\n#ifdef ENABLE_JITTERING\nvec3 randomJitter=hash(5.*(samples*worldPos))-0.5;float spread=((2.-specular)+roughness*jitterRough)*jitterSpread;float jitterMix=jitter+jitterRough*roughness;if(jitterMix>1.)jitterMix=1.;jitt=mix(vec3(0.),randomJitter*spread,jitterMix);\n#endif\njitt=mix(jitt,vec3(0.),0.5);viewNormal+=jitt;vec3 reflected=normalize(reflect(normalize(viewPos),normalize(viewNormal)));vec3 rayDir=reflected*-viewPos.z;vec3 hitPos=viewPos;float rayHitDepthDifference;vec2 coords=RayMarch(rayDir,hitPos,rayHitDepthDifference);if(coords.x==-1.){gl_FragColor=EARLY_OUT_COLOR;return;}vec2 coordsNDC=(coords*2.0-1.0);float screenFade=0.1;float maxDimension=min(1.0,max(abs(coordsNDC.x),abs(coordsNDC.y)));float screenEdgefactor=1.0-(max(0.0,maxDimension-screenFade)/(1.0-screenFade));screenEdgefactor=max(0.,screenEdgefactor);vec4 SSRTexel=textureLod(inputTexture,coords.xy,0.);vec4 SSRTexelReflected=textureLod(accumulatedTexture,coords.xy,0.);vec3 SSR=SSRTexel.rgb+SSRTexelReflected.rgb;float roughnessFactor=mix(specular,1.,max(0.,1.-roughnessFadeOut));vec3 finalSSR=SSR*screenEdgefactor*roughnessFactor;if(rayFadeOut!=0.){vec3 hitWorldPos=screenSpaceToWorldSpace(coords,rayHitDepthDifference);float reflectionDistance=distance(hitWorldPos,worldPos);reflectionDistance+=1.;float opacity=1./(reflectionDistance*rayFadeOut*0.1);if(opacity>1.)opacity=1.;finalSSR*=opacity;}float fresnelFactor=fresnel_dielectric(normalize(viewPos),viewNormal,ior);finalSSR=finalSSR*fresnelFactor*intensity;finalSSR=min(vec3(1.),finalSSR);float alpha=hitPos.z==1. ? SSRTexel.a : SSRTexelReflected.a;gl_FragColor=vec4(finalSSR,alpha);}vec2 RayMarch(vec3 dir,inout vec3 hitPos,inout float rayHitDepthDifference){dir=normalize(dir);dir*=rayStep;float depth;vec4 projectedCoord;vec4 lastProjectedCoord;float unpackedDepth;float stepMultiplier=1.;vec4 depthTexel;for(int i=0;i<MAX_STEPS;i++){hitPos+=dir*stepMultiplier;projectedCoord=_projectionMatrix*vec4(hitPos,1.0);projectedCoord.xy/=projectedCoord.w;projectedCoord.xy=projectedCoord.xy*0.5+0.5;if(projectedCoord.x>1.||projectedCoord.y>1.){hitPos-=dir*stepMultiplier;stepMultiplier*=0.5;continue;}depthTexel=textureLod(depthTexture,projectedCoord.xy,0.);unpackedDepth=unpackRGBAToDepth(depthTexel);depth=fastGetViewZ(unpackedDepth);rayHitDepthDifference=depth-hitPos.z;if(rayHitDepthDifference>=0.&&rayHitDepthDifference<thickness){\n#if NUM_BINARY_SEARCH_STEPS == 0\nif(dot(depthTexel.rgb,depthTexel.rgb)<FLOAT_EPSILON)return INVALID_RAY_COORDS;\n#else\nreturn BinarySearch(dir,hitPos,rayHitDepthDifference);\n#endif\n}lastProjectedCoord=projectedCoord;}\n#ifndef STRETCH_MISSED_RAYS\nreturn INVALID_RAY_COORDS;\n#endif\nrayHitDepthDifference=unpackedDepth;hitPos.z=1.;return projectedCoord.xy;}vec2 BinarySearch(inout vec3 dir,inout vec3 hitPos,inout float rayHitDepthDifference){float depth;vec4 projectedCoord;vec2 lastMinProjectedCoordXY;float unpackedDepth;vec4 depthTexel;for(int i=0;i<NUM_BINARY_SEARCH_STEPS;i++){projectedCoord=_projectionMatrix*vec4(hitPos,1.0);projectedCoord.xy/=projectedCoord.w;projectedCoord.xy=projectedCoord.xy*0.5+0.5;if((lastMinProjectedCoordXY.x>1.||lastMinProjectedCoordXY.y>1.)&&(projectedCoord.x>1.||projectedCoord.y>1.))return INVALID_RAY_COORDS;depthTexel=textureLod(depthTexture,projectedCoord.xy,0.);unpackedDepth=unpackRGBAToDepth(depthTexel);depth=fastGetViewZ(unpackedDepth);rayHitDepthDifference=depth-hitPos.z;dir*=0.5;if(rayHitDepthDifference>0.0){hitPos-=dir;}else{hitPos+=dir;lastMinProjectedCoordXY=projectedCoord.xy;}}if(dot(depthTexel.rgb,depthTexel.rgb)<FLOAT_EPSILON)return INVALID_RAY_COORDS;if(abs(rayHitDepthDifference)>_maxDepthDifference)return INVALID_RAY_COORDS;projectedCoord=_projectionMatrix*vec4(hitPos,1.0);projectedCoord.xy/=projectedCoord.w;projectedCoord.xy=projectedCoord.xy*0.5+0.5;rayHitDepthDifference=unpackedDepth;return projectedCoord.xy;}float fastGetViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn nearMulFar/(farMinusNear*depth-cameraFar);\n#else\nreturn depth*nearMinusFar-cameraNear;\n#endif\n}".replace("#include <helperFunctions>",If),vertexShader:bf,toneMapped:!1,depthWrite:!1,depthTest:!1})}}var zf=xf("ssrEffect"),Gf=xf("cachedMaterials"),Bf=xf("USE_MRT"),Df=xf("webgl1DepthPass"),kf=xf("keepMaterialMapUpdated"),Of=xf("setMRTMaterialInScene"),jf=xf("unsetMRTMaterialInScene");class Vf extends Ud{constructor(e,t={}){super("ReflectionsPass"),Object.defineProperty(this,jf,{value:Wf}),Object.defineProperty(this,Of,{value:Xf}),Object.defineProperty(this,kf,{value:Hf}),Object.defineProperty(this,zf,{writable:!0,value:void 0}),Object.defineProperty(this,Gf,{writable:!0,value:new WeakMap}),Object.defineProperty(this,Bf,{writable:!0,value:!1}),Object.defineProperty(this,Df,{writable:!0,value:null}),yf(this,zf)[zf]=e,this._scene=e._scene,this._camera=e._camera,this.fullscreenMaterial=new Uf,e._camera.isPerspectiveCamera&&(this.fullscreenMaterial.defines.PERSPECTIVE_CAMERA="");const r=t.width||"undefined"!=typeof window?window.innerWidth:2e3,i=t.height||"undefined"!=typeof window?window.innerHeight:1e3;this.renderTarget=new n(r,i,{minFilter:L,magFilter:L,depthBuffer:!1}),this.renderPass=new Xd(this._scene,this._camera),yf(this,Bf)[Bf]=t.USE_MRT&&(()=>{try{const e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}})(),yf(this,Bf)[Bf]?(this.gBuffersRenderTarget=new $(r,i,2,{minFilter:L,magFilter:L}),this.normalTexture=this.gBuffersRenderTarget.texture[0],this.depthTexture=this.gBuffersRenderTarget.texture[1]):(yf(this,Df)[Df]=new Wd(this._scene,this._camera),yf(this,Df)[Df].renderTarget.minFilter=L,yf(this,Df)[Df].renderTarget.magFilter=L,yf(this,Df)[Df].renderTarget.texture.minFilter=L,yf(this,Df)[Df].renderTarget.texture.magFilter=L,yf(this,Df)[Df].setSize("undefined"!=typeof window?window.innerWidth:2e3,"undefined"!=typeof window?window.innerHeight:1e3),this.gBuffersRenderTarget=new n(r,i,{minFilter:L,magFilter:L}),this.normalTexture=this.gBuffersRenderTarget.texture,this.depthTexture=yf(this,Df)[Df].texture),this.fullscreenMaterial.uniforms.normalTexture.value=this.normalTexture,this.fullscreenMaterial.uniforms.depthTexture.value=this.depthTexture,this.fullscreenMaterial.uniforms.accumulatedTexture.value=yf(this,zf)[zf].temporalResolvePass.accumulatedTexture,this.fullscreenMaterial.uniforms.cameraMatrixWorld.value=this._camera.matrixWorld,this.fullscreenMaterial.uniforms._projectionMatrix.value=this._camera.projectionMatrix,this.fullscreenMaterial.uniforms._inverseProjectionMatrix.value=this._camera.projectionMatrixInverse}setSize(e,t){this.renderTarget.setSize(e*yf(this,zf)[zf].resolutionScale,t*yf(this,zf)[zf].resolutionScale),this.gBuffersRenderTarget.setSize(e*yf(this,zf)[zf].resolutionScale,t*yf(this,zf)[zf].resolutionScale),this.fullscreenMaterial.uniforms.accumulatedTexture.value=yf(this,zf)[zf].temporalResolvePass.accumulatedTexture,this.fullscreenMaterial.needsUpdate=!0}dispose(){this.renderTarget.dispose(),this.gBuffersRenderTarget.dispose(),this.renderPass.dispose(),yf(this,Bf)[Bf]||yf(this,Df)[Df].dispose(),this.fullscreenMaterial.dispose(),this.normalTexture=null,this.depthTexture=null,this.velocityTexture=null}render(e,t){yf(this,Of)[Of](),e.setRenderTarget(this.gBuffersRenderTarget),this.renderPass.render(e,this.gBuffersRenderTarget),yf(this,jf)[jf](),yf(this,Bf)[Bf]||yf(this,Df)[Df].renderPass.render(e,yf(this,Df)[Df].renderTarget),this.fullscreenMaterial.uniforms.inputTexture.value=t.texture,this.fullscreenMaterial.uniforms.samples.value=yf(this,zf)[zf].samples,this.fullscreenMaterial.uniforms.cameraNear.value=this._camera.near,this.fullscreenMaterial.uniforms.cameraFar.value=this._camera.far,e.setRenderTarget(this.renderTarget),e.render(this.scene,this.camera)}}function Hf(e,t,n,r){yf(this,zf)[zf][r]?t[n]!==e[n]&&(e[n]=t[n],e.uniforms[n].value=t[n],t[n]?e.defines[r]="":delete e.defines[r],e.needsUpdate=!0):void 0!==e[n]&&(e[n]=void 0,e.uniforms[n].value=void 0,delete e.defines[r],e.needsUpdate=!0)}function Xf(){this._scene.traverse((e=>{if(e.material){const t=e.material;let[n,r]=yf(this,Gf)[Gf].get(e)||[];if(!yf(this,Gf)[Gf].has(e)||t!==n){r&&r.dispose(),r=new Nf,yf(this,Bf)[Bf]&&(r.defines.USE_MRT=""),r.normalScale=t.normalScale,r.uniforms.normalScale.value=t.normalScale;const n=t.map||t.normalMap||t.roughnessMap||t.metalnessMap;n&&(r.uniforms.uvTransform.value=n.matrix),yf(this,Gf)[Gf].set(e,[t,r])}yf(this,kf)[kf](r,t,"normalMap","USE_NORMALMAP"),yf(this,kf)[kf](r,t,"roughnessMap","USE_ROUGHNESSMAP"),r.uniforms.roughness.value=0===yf(this,zf)[zf].selection.size||yf(this,zf)[zf].selection.has(e)?t.roughness||0:1e11,e.material=r}}))}function Wf(){this._scene.traverse((e=>{var t;if("MRTMaterial"===(null==(t=e.material)?void 0:t.type)){const[t]=yf(this,Gf)[Gf].get(e);e.material=t}}))}const Yf="#define GLSLIFY 1\n#define MODE_DEFAULT 0\n#define MODE_REFLECTIONS 1\n#define MODE_RAW_REFLECTION 2\n#define MODE_BLURRED_REFLECTIONS 3\n#define MODE_INPUT 4\n#define MODE_BLUR_MIX 5\n#define FLOAT_EPSILON 0.00001\n#define SQRT_3 1.7320508075688772 + FLOAT_EPSILON\nuniform sampler2D inputTexture;uniform sampler2D reflectionsTexture;\n#ifdef ENABLE_BLUR\nuniform sampler2D depthTexture;\n#endif\nuniform float samples;uniform float blurMix;\n#include <bilateralBlur>\nvoid mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 reflectionsTexel=texture2D(reflectionsTexture,vUv);vec3 reflectionClr=reflectionsTexel.xyz;\n#ifdef ENABLE_BLUR\nvec4 blurredReflectionsTexel=blur(reflectionsTexture,depthTexture);reflectionClr=mix(reflectionClr,blurredReflectionsTexel.xyz,blurMix);\n#endif\n#if RENDER_MODE == MODE_DEFAULT\noutputColor=vec4(inputColor.rgb+reflectionClr,1.);\n#endif\n#if RENDER_MODE == MODE_REFLECTIONS\noutputColor=vec4(reflectionClr,1.);\n#endif\n#if RENDER_MODE == MODE_RAW_REFLECTION\noutputColor=vec4(reflectionsTexel.xyz,1.);\n#endif\n#if RENDER_MODE == MODE_BLURRED_REFLECTIONS\n#ifdef ENABLE_BLUR\noutputColor=vec4(blurredReflectionsTexel.xyz,1.);\n#endif\n#endif\n#if RENDER_MODE == MODE_INPUT\noutputColor=vec4(inputColor.xyz,1.);\n#endif\n#if RENDER_MODE == MODE_BLUR_MIX\n#ifdef ENABLE_BLUR\noutputColor=vec4(vec3(blurMix),1.);\n#endif\n#endif\n}".replace("#include <helperFunctions>",If).replace("#include <bilateralBlur>","#define GLSLIFY 1\nconst float KERNEL_RADIUS=5.;uniform float g_Sharpness;uniform vec2 g_InvResolutionDirection;uniform float kernelRadius;float getViewZ(const float depth){return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);}vec4 BlurFunction(sampler2D texSource,sampler2D texLinearDepth,vec2 uv,float r,vec4 center_c,float center_d,inout float w_total,in float radius){vec4 c=texture2D(texSource,uv);float d=getViewZ(1./unpackRGBAToDepth(texture2D(texLinearDepth,uv)));float BlurSigma=radius*0.5;float BlurFalloff=1.0/(2.0*BlurSigma*BlurSigma);float ddiff=(d-center_d)*g_Sharpness*10.;float w=exp2(-r*r*BlurFalloff-ddiff*ddiff);w_total+=w;return c*w;}vec4 blur(sampler2D blurTexture,sampler2D depthTexture){vec4 center_c=texture2D(blurTexture,vUv);float center_d=getViewZ(1./unpackRGBAToDepth(texture2D(depthTexture,vUv)));float radius=kernelRadius;vec4 c_total=center_c;float w_total=1.0;vec2 uv;for(float r=1.;r<=radius;++r){uv=vUv+g_InvResolutionDirection*r;c_total+=BlurFunction(blurTexture,depthTexture,uv,r,center_c,center_d,w_total,radius);}for(float r=1.;r<=radius;++r){uv=vUv-g_InvResolutionDirection*r;c_total+=BlurFunction(blurTexture,depthTexture,uv,r,center_c,center_d,w_total,radius);}return c_total/w_total;}"),$f={temporalResolve:!0,temporalResolveMix:.9,temporalResolveCorrectionMix:1,maxSamples:256,resolutionScale:1,width:"undefined"!=typeof window?window.innerWidth:2e3,height:"undefined"!=typeof window?window.innerHeight:1e3,ENABLE_BLUR:!1,blurMix:.5,blurKernelSize:8,blurSharpness:.5,rayStep:.1,intensity:1,maxRoughness:.1,ENABLE_JITTERING:!1,jitter:.1,jitterSpread:.1,jitterRough:0,roughnessFadeOut:1,rayFadeOut:0,MAX_STEPS:20,NUM_BINARY_SEARCH_STEPS:5,maxDepthDifference:10,maxDepth:1,thickness:10,ior:1.45,STRETCH_MISSED_RAYS:!0,USE_MRT:!0,USE_NORMALMAP:!0,USE_ROUGHNESSMAP:!0},Zf=["ENABLE_BLUR","blurSharpness","blurKernelSize","blurMix"];var Qf=xf("lastSize"),Kf=xf("lastCameraTransform"),qf=xf("makeOptionsReactive");class Jf extends lf{constructor(e,t,n=$f){super("SSREffect",Yf,{type:"FinalSSRMaterial",uniforms:new Map([["inputTexture",new p(null)],["reflectionsTexture",new p(null)],["depthTexture",new p(null)],["samples",new p(0)],["blurMix",new p(0)],["g_Sharpness",new p(0)],["g_InvResolutionDirection",new p(new l)],["kernelRadius",new p(0)]]),defines:new Map([["RENDER_MODE","0"]])}),Object.defineProperty(this,qf,{value:ep}),this.samples=0,this.selection=new af,Object.defineProperty(this,Qf,{writable:!0,value:void 0}),Object.defineProperty(this,Kf,{writable:!0,value:{position:new h,quaternion:new X}}),this._scene=e,this._camera=t,n=vf({},$f,n),this.temporalResolvePass=new Ff(e,t,"",n),this.temporalResolvePass.fullscreenMaterial.uniforms.samples=new p(0),this.temporalResolvePass.fullscreenMaterial.uniforms.maxSamples=new p(0),this.temporalResolvePass.fullscreenMaterial.defines.EULER=2.718281828459045,this.temporalResolvePass.fullscreenMaterial.defines.FLOAT_EPSILON=1e-5,this.uniforms.get("reflectionsTexture").value=this.temporalResolvePass.renderTarget.texture,this.reflectionsPass=new Vf(this,n),this.temporalResolvePass.fullscreenMaterial.uniforms.inputTexture.value=this.reflectionsPass.renderTarget.texture,this.temporalResolvePass.fullscreenMaterial.uniforms.depthTexture.value=this.reflectionsPass.depthTexture,yf(this,Qf)[Qf]={width:n.width,height:n.height,resolutionScale:n.resolutionScale},yf(this,Kf)[Kf].position.copy(t.position),yf(this,Kf)[Kf].quaternion.copy(t.quaternion),this.setSize(n.width,n.height),yf(this,qf)[qf](n)}setSize(e,t){e===yf(this,Qf)[Qf].width&&t===yf(this,Qf)[Qf].height&&this.resolutionScale===yf(this,Qf)[Qf].resolutionScale||(this.temporalResolvePass.setSize(e,t),this.reflectionsPass.setSize(e,t),yf(this,Qf)[Qf]={width:e,height:t,resolutionScale:this.resolutionScale})}checkNeedsResample(){const e=yf(this,Kf)[Kf].position.distanceToSquared(this._camera.position),t=8*(1-yf(this,Kf)[Kf].quaternion.dot(this._camera.quaternion));(e>1e-6||t>1e-6)&&(this.samples=1,yf(this,Kf)[Kf].position.copy(this._camera.position),yf(this,Kf)[Kf].quaternion.copy(this._camera.quaternion))}dispose(){super.dispose(),this.reflectionsPass.dispose(),this.temporalResolvePass.dispose()}update(e,t){this.samples++,this.checkNeedsResample(),this.uniforms.get("samples").value=this.samples,this.reflectionsPass.render(e,t),this.temporalResolvePass.fullscreenMaterial.uniforms.samples.value=this.samples,this.temporalResolvePass.render(e)}}function ep(e){e.ENABLE_BLUR&&(this.uniforms.get("depthTexture").value=this.reflectionsPass.depthTexture,this.defines.set("ENABLE_BLUR",""),this.reflectionsPass.fullscreenMaterial.defines.ENABLE_BLUR="");const t=window.devicePixelRatio;let n=!1;const r=this.reflectionsPass.fullscreenMaterial.uniforms,i=Object.keys(r);for(const a of Object.keys(e))Object.defineProperty(this,a,{get:()=>e[a],set(o){if(e[a]!==o||!n)switch(e[a]=o,Zf.includes(a)||(this.samples=1),a){case"resolutionScale":this.setSize(e.width,e.height);break;case"width":if(void 0===o)return;this.setSize(o*t,e.height),this.uniforms.get("g_InvResolutionDirection").value.set(1/(o*t),1/e.height);break;case"height":if(void 0===o)return;this.setSize(e.width,o*t),this.uniforms.get("g_InvResolutionDirection").value.set(1/e.width,1/(o*t));break;case"maxSamples":this.temporalResolvePass.fullscreenMaterial.uniforms.maxSamples.value=this.maxSamples;break;case"blurMix":this.uniforms.get("blurMix").value=o;break;case"blurSharpness":this.uniforms.get("g_Sharpness").value=o;break;case"blurKernelSize":this.uniforms.get("kernelRadius").value=o;break;case"MAX_STEPS":this.reflectionsPass.fullscreenMaterial.defines.MAX_STEPS=parseInt(o),this.reflectionsPass.fullscreenMaterial.needsUpdate=n;break;case"NUM_BINARY_SEARCH_STEPS":this.reflectionsPass.fullscreenMaterial.defines.NUM_BINARY_SEARCH_STEPS=parseInt(o),this.reflectionsPass.fullscreenMaterial.needsUpdate=n;break;case"ENABLE_JITTERING":o?this.reflectionsPass.fullscreenMaterial.defines.ENABLE_JITTERING="":delete this.reflectionsPass.fullscreenMaterial.defines.ENABLE_JITTERING,this.reflectionsPass.fullscreenMaterial.needsUpdate=n;break;case"STRETCH_MISSED_RAYS":o?this.reflectionsPass.fullscreenMaterial.defines.STRETCH_MISSED_RAYS="":delete this.reflectionsPass.fullscreenMaterial.defines.STRETCH_MISSED_RAYS,this.reflectionsPass.fullscreenMaterial.needsUpdate=n;break;case"USE_NORMALMAP":case"USE_ROUGHNESSMAP":break;case"temporalResolve":const s=o?"#define GLSLIFY 1\nfloat alpha=min(inputTexel.a,accumulatedTexel.a);alpha=didReproject&&(samples<4.||velocityDisocclusion<FLOAT_EPSILON)?(0.05+alpha): 0.;if(maxSamples!=0.&&samples>maxSamples&&alpha>1.-FLOAT_EPSILON){gl_FragColor=accumulatedTexel;return;}if(!didReproject){gl_FragColor=vec4(averageNeighborColor,alpha);return;}if(length(accumulatedTexel.rgb)>FLOAT_EPSILON&&length(inputTexel.rgb)==0.){gl_FragColor=accumulatedTexel;return;}if(alpha<1.){outputColor=mix(accumulatedTexel.rgb,inputTexel.rgb,(1.-alpha*alpha)*temporalResolveCorrectionMix);}else if(samples>4.&&movement<FLOAT_EPSILON&&length(accumulatedTexel.rgb)<FLOAT_EPSILON){outputColor=accumulatedTexel.rgb;}else if(1./samples>=1.-temporalResolveMix){outputColor=accumulatedTexel.rgb*temporalResolveMix+inputTexel.rgb*(1.-temporalResolveMix);}else{float mixVal=(1./samples)/EULER;if(alpha<FLOAT_EPSILON&&samples<15.)mixVal+=0.3;outputColor=mix(accumulatedTexel.rgb,inputTexel.rgb,mixVal);}":"#define GLSLIFY 1\naccumulatedTexel=textureLod(accumulatedTexture,vUv,0.);float alpha=min(inputTexel.a,accumulatedTexel.a);alpha=samples<2.||movement<FLOAT_EPSILON ?(0.05+alpha): 0.;if(maxSamples!=0.&&samples>maxSamples&&alpha>1.-FLOAT_EPSILON){outputColor=accumulatedTexel.rgb;}else{float samplesMultiplier=pow(samples/32.,4.)+1.;if(samples>1.&&alpha>1.-FLOAT_EPSILON){outputColor=accumulatedTexel.rgb*(1.-1./(samples*samplesMultiplier))+inputTexel.rgb/(samples*samplesMultiplier);}else{outputColor=inputTexel.rgb;}}";let l=_f;if(!o){const e=l.slice(l.indexOf("// REPROJECT_START"),l.indexOf("// REPROJECT_END")+16);l=_f.replace(e,"")}l=l.replace("#include <custom_compose_shader>",s),l="\n\t\t\t\t\t\t\tuniform float samples;\n\t\t\t\t\t\t\tuniform float maxSamples;\n\t\t\t\t\t\t\tuniform float temporalResolveMix;\n\t\t\t\t\t\t\t"+l,this.temporalResolvePass.fullscreenMaterial.fragmentShader=l,this.temporalResolvePass.fullscreenMaterial.needsUpdate=!0;break;case"temporalResolveMix":this.temporalResolvePass.fullscreenMaterial.uniforms.temporalResolveMix.value=o;break;case"temporalResolveCorrectionMix":this.temporalResolvePass.fullscreenMaterial.uniforms.temporalResolveCorrectionMix.value=o;break;default:i.includes(a)&&(r[a].value=o)}}}),this[a]=e[a];n=!0}const tp=function(e,t){return void 0===t&&(t=nd),ve.forwardRef((function(n,r){let{blendFunction:i,opacity:a,...o}=n;const s=Ee((e=>e.invalidate)),l=ve.useMemo((()=>new e(o)),[o]);return ve.useLayoutEffect((()=>{l.blendMode.blendFunction=i||0===i?i:t,void 0!==a&&(l.blendMode.opacity.value=a),s()}),[i,l.blendMode,a]),ye.createElement("primitive",{ref:r,object:l,dispose:null})}))};tp(class extends lf{constructor({blendFunction:e=sd,luminanceThreshold:t=.9,luminanceSmoothing:r=.025,mipmapBlur:i=!1,intensity:a=1,radius:o=.85,levels:s=8,kernelSize:l=gd,resolutionScale:c=.5,width:u=jd.AUTO_SIZE,height:d=jd.AUTO_SIZE,resolutionX:f=u,resolutionY:h=d}={}){super("BloomEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=texture2D(map,uv)*intensity;}",{blendFunction:e,uniforms:new Map([["map",new p(null)],["intensity",new p(a)]])}),this.renderTarget=new n(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Kd({kernelSize:l}),this.luminancePass=new qd({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=r,this.mipmapBlurPass=new ef,this.mipmapBlurPass.enabled=i,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=s,this.uniforms.get("map").value=i?this.mipmapBlurPass.texture:this.renderTarget.texture;const m=this.resolution=new jd(this,f,h,c);m.addEventListener("change",(e=>this.setSize(m.baseWidth,m.baseHeight)))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,n){const r=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,i.renderTarget):this.blurPass.render(e,i.renderTarget,r)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,r)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.blurPass.resolution.copy(n),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}initialize(e,t,n){this.blurPass.initialize(e,t,n),this.luminancePass.initialize(e,t,n),this.mipmapBlurPass.initialize(e,t,n),void 0!==n&&(this.renderTarget.texture.type=n,Ru(e)===wu&&Pu(this.renderTarget.texture,wu))}},Iu),tp(class extends lf{constructor({blendFunction:e=cd,brightness:t=0,contrast:n=0}={}){super("BrightnessContrastEffect","uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",{blendFunction:e,uniforms:new Map([["brightness",new p(t)],["contrast",new p(n)]])}),this.inputColorSpace=wu}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(){return this.contrast}setContrast(e){this.contrast=e}});const np=ve.forwardRef((function(e,t){const n=((e,t)=>{const n=e[t];return ve.useMemo((()=>{if(n instanceof l)return(new l).set(n.x,n.y);if(Array.isArray(n)){const[e,t]=n;return(new l).set(e,t)}}),[n])})(e,"offset"),r=ve.useMemo((()=>new cf({...e,offset:n})),[n,e]);return ye.createElement("primitive",{ref:t,object:r,dispose:null})}));tp(class extends lf{constructor({blendFunction:e,bits:t=16}={}){super("ColorDepthEffect","uniform float factor;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(floor(inputColor.rgb*factor+0.5)/factor,inputColor.a);}",{blendFunction:e,uniforms:new Map([["factor",new p(1)]])}),this.bits=0,this.bitDepth=t}get bitDepth(){return this.bits}set bitDepth(e){this.bits=e,this.uniforms.get("factor").value=Math.pow(2,e/3)}getBitDepth(){return this.bitDepth}setBitDepth(e){this.bitDepth=e}}),tp(class extends lf{constructor({blendFunction:e=cd,inverted:t=!1}={}){super("DepthEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){\n#ifdef INVERTED\nvec3 color=vec3(1.0-depth);\n#else\nvec3 color=vec3(depth);\n#endif\noutputColor=vec4(color,inputColor.a);}",{blendFunction:e,attributes:pd}),this.inverted=t}get inverted(){return this.defines.has("INVERTED")}set inverted(e){this.inverted!==e&&(e?this.defines.set("INVERTED","1"):this.defines.delete("INVERTED"),this.setChanged())}isInverted(){return this.inverted}setInverted(e){this.inverted=e}});const rp=ve.createContext(null),ip=ye.memo(ve.forwardRef(((e,t)=>{let{children:r,camera:i,scene:a,resolutionScale:s,enabled:p=!0,renderPriority:h=1,autoClear:m=!0,depthBuffer:v,disableNormalPass:g,stencilBuffer:x,multisampling:y=8,frameBufferType:b=B}=e;const{gl:_,scene:S,camera:w,size:M}=Ee();a=a||S,i=i||w;const[A,T,E]=ve.useMemo((()=>{const e=function(){var e;if(void 0!==pf)return pf;try{let t;const n=document.createElement("canvas");return pf=!(!window.WebGL2RenderingContext||!(t=n.getContext("webgl2"))),t&&(null==(e=t.getExtension("WEBGL_lose_context"))||e.loseContext()),pf}catch(t){return pf=!1}}(),t=new class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:n=!1,multisampling:r=0,frameBufferType:i}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,n,i,r),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new zd,this.depthTexture=null,this.passes=[],this.timer=new class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){"undefined"!=typeof document&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*nf}get fixedDelta(){return this._fixedDelta*nf}set fixedDelta(e){this._fixedDelta=1e3*e}get elapsed(){return this._elapsed*nf}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(void 0!==e?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,n=this.multisampling;n>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):n!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,null!==e){const t=e.getSize(new l),n=e.getContext().getContextAttributes().alpha,r=this.inputBuffer.texture.type;r===o&&Ru(e)===wu&&(Pu(this.inputBuffer.texture,wu),Pu(this.outputBuffer.texture,wu),this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const i of this.passes)i.initialize(e,n,r)}}replaceRenderer(e,t=!0){const n=this.renderer,r=n.domElement.parentNode;return this.setRenderer(e),t&&null!==r&&(r.removeChild(n.domElement),r.appendChild(e.domElement)),n}createDepthTexture(){const e=this.depthTexture=new c;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=u,e.type=d):e.type=f,e}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,r,i){const a=this.renderer,s=null===a?new l:a.getDrawingBufferSize(new l),c={minFilter:L,magFilter:L,stencilBuffer:t,depthBuffer:e,type:r},u=new n(s.width,s.height,c);return i>0&&(u.ignoreDepthForMultisampleCopy=!1,u.samples=i),r===o&&Ru(a)===wu&&Pu(u.texture,wu),u.texture.name="EffectComposer.Buffer",u.texture.generateMipmaps=!1,u}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const n=this.passes,r=this.renderer,i=r.getDrawingBufferSize(new l),a=r.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(e.setRenderer(r),e.setSize(i.width,i.height),e.initialize(r,a,o),this.autoRenderToScreen&&(n.length>0&&(n[n.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==t?n.splice(t,0,e):n.push(e),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){const t=this.createDepthTexture();for(e of n)e.setDepthTexture(t)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,n=t.indexOf(e);if(-1!==n&&t.splice(n,1).length>0){if(null!==this.depthTexture){const n=(e,t)=>e||t.needsDepthTexture;t.reduce(n,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&n===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,n=this.copyPass;let r,i,a,o=this.inputBuffer,s=this.outputBuffer,l=!1;void 0===e&&(this.timer.update(),e=this.timer.delta);for(const c of this.passes)c.enabled&&(c.render(t,o,s,e,l),c.needsSwap&&(l&&(n.renderToScreen=c.renderToScreen,r=t.getContext(),i=t.state.buffers.stencil,i.setFunc(r.NOTEQUAL,1,4294967295),n.render(t,o,s,e,l),i.setFunc(r.EQUAL,1,4294967295)),a=o,o=s,s=a),c instanceof Jd?l=!0:c instanceof Bd&&(l=!1))}setSize(e,t,n){const r=this.renderer,i=r.getSize(new l);void 0!==e&&void 0!==t||(e=i.width,t=i.height),i.width===e&&i.height===t||r.setSize(e,t,n);const a=r.getDrawingBufferSize(new l);this.inputBuffer.setSize(a.width,a.height),this.outputBuffer.setSize(a.width,a.height);for(const o of this.passes)o.setSize(a.width,a.height)}reset(){const e=this.timer.autoReset;this.dispose(),this.autoRenderToScreen=!0,this.timer.autoReset=e}dispose(){for(const e of this.passes)e.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}}(_,{depthBuffer:v,stencilBuffer:x,multisampling:y>0&&e?y:0,frameBufferType:b});t.addPass(new Xd(a,i));let r=null,p=null;return g||(p=new tf(a,i),p.enabled=!1,t.addPass(p),void 0!==s&&e&&(r=new Yd({normalBuffer:p.texture,resolutionScale:s}),r.enabled=!1,t.addPass(r))),[t,p,r]}),[i,_,v,x,y,b,a,g,s]);ve.useEffect((()=>null==A?void 0:A.setSize(M.width,M.height)),[A,M]),Ce(((e,t)=>{p&&(_.autoClear=m,A.render(t))}),p?h:0);const C=ve.useRef(null);ve.useLayoutEffect((()=>{let e;return C.current&&C.current.__r3f&&A&&(e=new Qd(i,...C.current.__r3f.objects),e.renderToScreen=!0,A.addPass(e),T&&(T.enabled=!0),E&&(E.enabled=!0)),()=>{e&&(null==A||A.removePass(e)),T&&(T.enabled=!1),E&&(E.enabled=!1)}}),[A,r,i,T,E]);const R=ve.useMemo((()=>({composer:A,normalPass:T,downSamplingPass:E,resolutionScale:s,camera:i,scene:a})),[A,T,E,s,i,a]);return ve.useImperativeHandle(t,(()=>A),[A]),ye.createElement(rp.Provider,{value:R},ye.createElement("group",{ref:C},r))})));tp(class extends lf{constructor({blendFunction:e,angle:t=.5*Math.PI,scale:n=1}={}){super("DotScreenEffect","uniform vec2 angle;uniform float scale;float pattern(const in vec2 uv){vec2 point=scale*vec2(dot(angle.yx,vec2(uv.x,-uv.y)),dot(angle,uv));return(sin(point.x)*sin(point.y))*4.0;}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(inputColor.rgb*10.0-5.0+pattern(uv*resolution));outputColor=vec4(color,inputColor.a);}",{blendFunction:e,uniforms:new Map([["angle",new p(new l)],["scale",new p(n)]])}),this.angle=t}get angle(){return Math.acos(this.uniforms.get("angle").value.y)}set angle(e){this.uniforms.get("angle").value.set(Math.sin(e),Math.cos(e))}getAngle(){return this.angle}setAngle(e){this.angle=e}get scale(){return this.uniforms.get("scale").value}set scale(e){this.uniforms.get("scale").value=e}}),tp(class extends lf{constructor({blendFunction:e=cd,hue:t=0,saturation:n=0}={}){super("HueSaturationEffect","uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",{blendFunction:e,uniforms:new Map([["hue",new p(new h)],["saturation",new p(n)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){const e=this.uniforms.get("hue").value;return Math.acos((3*e.x-1)/2)}set hue(e){const t=Math.sin(e),n=Math.cos(e);this.uniforms.get("hue").value.set((2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}}),tp(class extends lf{constructor({blendFunction:e=sd,premultiply:t=!1}={}){super("NoiseEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));\n#ifdef PREMULTIPLY\noutputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);\n#else\noutputColor=vec4(noise,inputColor.a);\n#endif\n}",{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},Bu);const ap=ve.createContext(null);tp(class extends lf{constructor({blendFunction:e=rd,density:t=1.25,scrollSpeed:n=0}={}){super("ScanlineEffect","uniform float count;\n#ifdef SCROLL\nuniform float scrollSpeed;\n#endif\nvoid mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float y=uv.y;\n#ifdef SCROLL\ny+=time*scrollSpeed;\n#endif\nvec2 sl=vec2(sin(y*count),cos(y*count));outputColor=vec4(sl.xyx,inputColor.a);}",{blendFunction:e,uniforms:new Map([["count",new p(0)],["scrollSpeed",new p(0)]])}),this.resolution=new l,this.d=t,this.scrollSpeed=n}get density(){return this.d}set density(e){this.d=e,this.setSize(this.resolution.width,this.resolution.height)}getDensity(){return this.density}setDensity(e){this.density=e}get scrollSpeed(){return this.uniforms.get("scrollSpeed").value}set scrollSpeed(e){this.uniforms.get("scrollSpeed").value=e,0===e?this.defines.delete("SCROLL")&&this.setChanged():this.defines.has("SCROLL")||(this.defines.set("SCROLL","1"),this.setChanged())}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("count").value=Math.round(t*this.density)}},rd),tp(class extends lf{constructor({blendFunction:e,intensity:t=1}={}){super("SepiaEffect","uniform vec3 weightsR;uniform vec3 weightsG;uniform vec3 weightsB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,weightsR),dot(inputColor.rgb,weightsG),dot(inputColor.rgb,weightsB));outputColor=vec4(color,inputColor.a);}",{blendFunction:e,uniforms:new Map([["weightsR",new p(new h(.393,.769,.189))],["weightsG",new p(new h(.349,.686,.168))],["weightsB",new p(new h(.272,.534,.131))]])})}get intensity(){return this.blendMode.opacity.value}set intensity(e){this.blendMode.opacity.value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}get weightsR(){return this.uniforms.get("weightsR").value}get weightsG(){return this.uniforms.get("weightsG").value}get weightsB(){return this.uniforms.get("weightsB").value}});const op=tp(class extends lf{constructor({blendFunction:e=cd,adaptive:t=!1,mode:r=(t?bd:Ld),resolution:i=256,maxLuminance:a=4,whitePoint:o=a,middleGrey:s=.6,minLuminance:l=.01,averageLuminance:c=1,adaptationRate:u=1}={}){super("ToneMappingEffect","#include <tonemapping_pars_fragment>\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\nuniform float whitePoint;\n#if TONE_MAPPING_MODE == 1 || TONE_MAPPING_MODE == 2\nuniform float middleGrey;\n#if TONE_MAPPING_MODE == 2\nuniform lowp sampler2D luminanceBuffer;\n#else\nuniform float averageLuminance;\n#endif\nvec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);\n#if TONE_MAPPING_MODE == 2\nfloat lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));\n#else\nfloat lumAvg=averageLuminance;\n#endif\nfloat lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}\n#elif TONE_MAPPING_MODE == 5\n#define A 0.15\n#define B 0.50\n#define C 0.10\n#define D 0.20\n#define E 0.02\n#define F 0.30\nvec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}\n#endif\nvoid mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){\n#if TONE_MAPPING_MODE == 1 || TONE_MAPPING_MODE == 2\noutputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);\n#elif TONE_MAPPING_MODE == 5\noutputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);\n#else\noutputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);\n#endif\n}",{blendFunction:e,uniforms:new Map([["luminanceBuffer",new p(null)],["maxLuminance",new p(a)],["whitePoint",new p(o)],["middleGrey",new p(s)],["averageLuminance",new p(c)]])}),this.renderTargetLuminance=new n(1,1,{minFilter:T,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new qd({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new Gd(this.luminancePass.texture,{minLuminance:l,adaptationRate:u}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=i,this.mode=r}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(e){if(this.mode!==e){switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",e.toFixed(0)),e){case xd:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case _d:this.defines.set("toneMapping(texel)","OptimizedCineonToneMapping(texel)");break;case Ld:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel")}this.adaptiveLuminancePass.enabled=e===bd,this.setChanged()}}getMode(){return this.mode}setMode(e){this.mode=e}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(e){this.uniforms.get("whitePoint").value=e}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(e){this.uniforms.get("middleGrey").value=e}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(e){this.uniforms.get("averageLuminance").value=e}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(e){const t=Math.max(0,Math.ceil(Math.log2(e))),n=Math.pow(2,t);this.luminancePass.resolution.setPreferredSize(n,n),this.adaptiveLuminanceMaterial.mipLevel1x1=t}getResolution(){return this.resolution}setResolution(e){this.resolution=e}get adaptive(){return this.mode===bd}set adaptive(e){this.mode=e?bd:yd}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(e){this.adaptiveLuminanceMaterial.adaptationRate=e}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(e){console.warn(this.name,"distinction was removed.")}update(e,t,n){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(e,t),this.adaptiveLuminancePass.render(e,null,null,n))}initialize(e,t,n){this.adaptiveLuminancePass.initialize(e,t,n)}});tp(class extends lf{constructor({blendFunction:e,technique:t=Sd,eskil:n=!1,offset:r=.5,darkness:i=.5}={}){super("VignetteEffect","uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;\n#if VIGNETTE_TECHNIQUE == 0\nfloat d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));\n#else\nvec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));\n#endif\noutputColor=vec4(color,inputColor.a);}",{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new p(r)],["darkness",new p(i)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===wd}set eskil(e){this.technique=e?wd:Sd}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}}),tp(class extends lf{constructor(e,t=new h,{speed:n=2,maxRadius:r=1,waveSize:i=.2,amplitude:a=.05}={}){super("ShockWaveEffect","uniform bool active;uniform vec2 center;uniform float waveSize;uniform float radius;uniform float maxRadius;uniform float amplitude;varying float vSize;void mainUv(inout vec2 uv){if(active){vec2 aspectCorrection=vec2(aspect,1.0);vec2 difference=uv*aspectCorrection-center*aspectCorrection;float distance=sqrt(dot(difference,difference))*vSize;if(distance>radius){if(distance<radius+waveSize){float angle=(distance-radius)*PI2/waveSize;float cosSin=(1.0-cos(angle))*0.5;float extent=maxRadius+waveSize;float decay=max(extent-distance*distance,0.0)/extent;uv-=((cosSin*amplitude*difference)/distance)*decay;}}}}",{vertexShader:"uniform float size;uniform float cameraDistance;varying float vSize;void mainSupport(){vSize=(0.1*cameraDistance)/size;}",uniforms:new Map([["active",new p(!1)],["center",new p(new l(.5,.5))],["cameraDistance",new p(1)],["size",new p(1)],["radius",new p(-i)],["maxRadius",new p(r)],["waveSize",new p(i)],["amplitude",new p(a)]])}),this.position=t,this.speed=n,this.camera=e,this.screenPosition=this.uniforms.get("center").value,this.time=0,this.active=!1}set mainCamera(e){this.camera=e}get amplitude(){return this.uniforms.get("amplitude").value}set amplitude(e){this.uniforms.get("amplitude").value=e}get waveSize(){return this.uniforms.get("waveSize").value}set waveSize(e){this.uniforms.get("waveSize").value=e}get maxRadius(){return this.uniforms.get("maxRadius").value}set maxRadius(e){this.uniforms.get("maxRadius").value=e}get epicenter(){return this.position}set epicenter(e){this.position=e}getPosition(){return this.position}setPosition(e){this.position=e}getSpeed(){return this.speed}setSpeed(e){this.speed=e}explode(){this.time=0,this.active=!0,this.uniforms.get("active").value=!0}update(e,t,n){const r=this.position,i=this.camera,a=this.uniforms,o=a.get("active");if(this.active){const e=a.get("waveSize").value;i.getWorldDirection(df),ff.copy(i.position).sub(r),o.value=df.angleTo(ff)>uf,o.value&&(a.get("cameraDistance").value=i.position.distanceTo(r),df.copy(r).project(i),this.screenPosition.set(.5*(df.x+1),.5*(df.y+1))),this.time+=n*this.speed;const t=this.time-e;a.get("radius").value=t,t>=2*(a.get("maxRadius").value+e)&&(this.active=!1,o.value=!1)}}});const sp=ve.forwardRef((function(e,t){let{ENABLE_BLUR:n=!0,USE_MRT:r=!0,...i}=e;const{invalidate:a}=Ee(),{scene:o,camera:s}=ve.useContext(rp),l=ve.useMemo((()=>new Jf(o,s,{ENABLE_BLUR:n,USE_MRT:r,...i})),[Jf,o,s,n,r]);ve.useLayoutEffect((()=>{Object.keys(i).forEach((e=>l[e]=i[e])),a()}),[i]);const c=ve.useContext(ap);return ve.useEffect((()=>{var e;if(c&&c.enabled&&(null!=(e=c.selected)&&e.length))return l.selection.set(c.selected),a(),()=>{l.selection.clear(),a()}}),[c]),ye.createElement("primitive",{ref:t,object:l})}));var lp=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],cp=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"],up=lp.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"]),dp=cp,fp=(dp=dp.slice().filter((function(e){return!/^(gl\_|texture)/.test(e)}))).concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]),pp=function(e){var t,n,r,i=0,a=0,o=yp,s=[],l=[],c=1,u=0,d=0,f=!1,p=!1,h="",m=vp,v=hp;"300 es"===(e=e||{}).version&&(m=xp,v=gp);var g={},x={};for(i=0;i<m.length;i++)g[m[i]]=!0;for(i=0;i<v.length;i++)x[v[i]]=!0;return function(e){return l=[],null!==e?function(e){i=0,e.toString&&(e=e.toString());var n;h+=e.replace(/\r\n/g,"\n"),r=h.length;for(;t=h[i],i<r;){switch(n=i,o){case _p:i=w();break;case Lp:i=S();break;case Sp:i=L();break;case wp:i=M();break;case Mp:i=E();break;case Fp:i=T();break;case Ap:i=C();break;case bp:i=R();break;case Rp:i=_();break;case yp:i=b()}if(n!==i)if("\n"===h[n])u=0,++c;else++u}return a+=i,h=h.slice(i),l}(e):function(e){s.length&&y(s.join(""));return o=Pp,y("(eof)"),l}()};function y(e){e.length&&l.push({type:Ip[o],data:e,position:d,line:c,column:u})}function b(){return s=s.length?[]:s,"/"===n&&"*"===t?(d=a+i-1,o=_p,n=t,i+1):"/"===n&&"/"===t?(d=a+i-1,o=Lp,n=t,i+1):"#"===t?(o=Sp,d=a+i,i):/\s/.test(t)?(o=Rp,d=a+i,i):(f=/\d/.test(t),p=/[^\w_]/.test(t),d=a+i,o=f?Mp:p?wp:bp,i)}function _(){return/[^\s]/g.test(t)?(y(s.join("")),o=yp,i):(s.push(t),n=t,i+1)}function L(){return"\r"!==t&&"\n"!==t||"\\"===n?(s.push(t),n=t,i+1):(y(s.join("")),o=yp,i)}function S(){return L()}function w(){return"/"===t&&"*"===n?(s.push(t),y(s.join("")),o=yp,i+1):(s.push(t),n=t,i+1)}function M(){if("."===n&&/\d/.test(t))return o=Ap,i;if("/"===n&&"*"===t)return o=_p,i;if("/"===n&&"/"===t)return o=Lp,i;if("."===t&&s.length){for(;A(s););return o=Ap,i}if(";"===t||")"===t||"("===t){if(s.length)for(;A(s););return y(t),o=yp,i+1}var e=2===s.length&&"="!==t;if(/[\w_\d\s]/.test(t)||e){for(;A(s););return o=yp,i}return s.push(t),n=t,i+1}function A(e){for(var t,n,r=0;;){if(t=mp.indexOf(e.slice(0,e.length+r).join("")),n=mp[t],-1===t){if(r--+e.length>0)continue;n=e.slice(0,1).join("")}return y(n),d+=n.length,(s=s.slice(n.length)).length}}function T(){return/[^a-fA-F0-9]/.test(t)?(y(s.join("")),o=yp,i):(s.push(t),n=t,i+1)}function E(){return"."===t||/[eE]/.test(t)?(s.push(t),o=Ap,n=t,i+1):"x"===t&&1===s.length&&"0"===s[0]?(o=Fp,s.push(t),n=t,i+1):/[^\d]/.test(t)?(y(s.join("")),o=yp,i):(s.push(t),n=t,i+1)}function C(){return"f"===t&&(s.push(t),n=t,i+=1),/[eE]/.test(t)?(s.push(t),n=t,i+1):("-"!==t&&"+"!==t||!/[eE]/.test(n))&&/[^\d]/.test(t)?(y(s.join("")),o=yp,i):(s.push(t),n=t,i+1)}function R(){if(/[^\d\w_]/.test(t)){var e=s.join("");return o=x[e]?Cp:g[e]?Ep:Tp,y(s.join("")),o=yp,i}return s.push(t),n=t,i+1}},hp=lp,mp=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],vp=cp,gp=up,xp=fp,yp=999,bp=9999,_p=0,Lp=1,Sp=2,wp=3,Mp=4,Ap=5,Tp=6,Ep=7,Cp=8,Rp=9,Pp=10,Fp=11,Ip=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];var Np=pp;const Up=_e((function(e,t){var n=Np(t),r=[];return r=(r=r.concat(n(e))).concat(n(null))}));var zp,Gp,Bp,Dp,kp,Op,jp,Vp,Hp,Xp,Wp,Yp;function $p(){if(Yp)return Wp;Yp=1;var e=Vp?jp:(Vp=1,jp={"<<=":!0,">>=":!0,"++":!0,"--":!0,"+=":!0,"-=":!0,"*=":!0,"/=":!0,"%=":!0,"&=":!0,"^=":!0,"|=":!0,"=":!0}),t=Xp?Hp:(Xp=1,Hp={precision:!0,highp:!0,mediump:!0,lowp:!0,attribute:!0,const:!0,uniform:!0,varying:!0,break:!0,continue:!0,do:!0,for:!0,while:!0,if:!0,else:!0,in:!0,out:!0,inout:!0,true:!0,false:!0,return:!0});return Wp=function(n){for(var r=0,i=0;i<n.length;i++){var a=(l=n[i]).type;l.assignment=!1,l.declaration=!1,"ident"!==a&&"builtin"!==a||(r=i+1,c(),"operator"===n[r].type&&e[n[r].data]&&(l.assignment=!0))}for(i=0;i<n.length;i++){var o=n[i],s=(a=o.type,o.data);if(o.declaration=!1,"keyword"===a){if(t[s])continue}else if("ident"!==a)continue;if(r=i+1,u(),"ident"===n[r].type)if(n[r++].declaration=!0,u(),"("!==n[r].data){for(;n[r]&&";"!==n[r].data;)","===n[r].data?(r++,c(),(n[r].declaration="ident"===n[r].type)&&r++):(c(),d(),c(),r++);i=r}else{for(r++,c();n[r]&&")"!==n[r].data&&("keyword"===n[r].type||"ident"===n[r].type);)r++,c(),"ident"===n[r].type&&(n[r++].declaration=!0,c(),u(),c(),","===n[r].data&&(r++,c()));i=r}}for(i=0;i<n.length;i++){var l;if("keyword"===(l=n[i]).type&&("struct"===l.data&&(r=i+1,c(),"ident"===n[r].type&&(r++,c(),"{"===n[r++].data)))){for(c();"ident"===n[r].type||"keyword"===n[r].type;){do{r++,c(),n[r].structMember=!0,n[r].declaration=!1,r++,u()}while(","===n[r].data);";"===n[r].data&&r++,c()}if(r++,c(),"ident"===n[r].type)for(n[r].declaration=!0,c();","===n[++r].data;)c(),r++,c(),"ident"===n[r].type&&(n[r].declaration=!0),c()}}return n;function c(e){for(;n[r]&&"whitespace"===n[r].type;)r++}function u(){for(;n[r]&&("integer"===n[r].type||"["===n[r].data||"]"===n[r].data||"whitespace"===n[r].type);)r++}function d(){if(n[r]&&"("===n[r].data){var e=0;do{if(";"===n[r].data)break;"("===n[r].data&&e++,")"===n[r].data&&e--}while(e&&n[++r])}}}}const Zp=_e((function(e,t){(Gp?zp:(Gp=1,zp=function(e){for(var t=!1,n=0,r=0;r<e.length;r++)switch(t=t||"keyword"===e[r].type&&"for"===e[r].data,e[r].data){case"(":e[r].depth=t?n++:n;break;case"{":e[r].depth=t?n:n++,t=!1;break;case"}":e[r].depth=--n;break;default:e[r].depth=n}for(r=0;r<e.length;r++){var i=e[r],a=r+1;if(("ident"===i.type||"keyword"===i.type)&&(o(),"ident"===e[a].type&&(o(),a++,"("===e[a].data))){for(;e[a]&&";"!==e[a].data&&"{"!==e[a].data;)e[a++].depth++;e[a]&&"{"===e[a].data&&e[a].depth++}}return e;function o(){for(;e[a]&&("whitespace"===e[a].type||"["===e[a].data||"]"===e[a].data||"integer"===e[a].data);)a++}}))(e),(Dp?Bp:(Dp=1,Bp=function(e){var t=[0],n=t[0],r=0;if(!e||!e.length)return e;if(!("depth"in e[0]))throw new Error("glsl-token-scope: No scope depth defined on tokens! Use glsl-token-depth on these tokens first");for(var i=0;i<e.length;i++){var a=e[i],o=a.depth;o>r?t.push(++n):o<r&&t.splice(-1,1),a.scope=t[t.length-1],a.stack=t.slice(),r=a.depth}return e}))(e),(Op?kp:(Op=1,kp=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.property=!1,"ident"===n.type){for(var r=t;e[--r]&&"whitespace"===e[r].type;);e[r]&&"operator"===e[r].type&&"."===e[r].data&&(n.property=!0)}}return e}))(e),$p()(e);for(var n=function(e){for(var t={},n=0;n<e.length;n++){var r=e[n];r.declaration&&(t[r.scope]=t[r.scope]||{},t[r.scope][r.data]=r)}return t}(e),r=t||function(){var e=0;return function(t){return t+"_"+(e++).toString(36)}}(),i={},a=0;a<e.length;a++){var o=e[a],s=o.stack,l=o.data;if(o.descoped=!1,"ident"===o.type&&!o.property&&!o.structMember){for(var c=!1,u=s.length-1;u>=0;u--){var d=n[s[u]];if(d&&d[l]){if(c=!0,u)break;o.descoped=o.data,o.data=i[l]=i[l]||r(l,o)||o.data}}c||(o.descoped=o.data,o.data=i[l]=i[l]||r(l,o)||o.data)}}return e}));const Qp=_e((function(e){for(var t=[],n=0;n<e.length;n++)"eof"!==e[n].type&&t.push(e[n].data);return t.join("")}));function Kp(e){return function(t){return"operator"===t.type&&(!e||t.data===e)}}function qp(e){return"whitespace"!==e.type}const Jp=_e((function(e){var t,n,r,i=null,a=null,o=0,s=0,l=0,c=0,u=0,d=[];for(t=0;t<e.length;t++)if("{"===(r=e[t]).data){if(o&&o++)continue;if((n=p(t,Kp(")"),Kp()))<0)continue;if(c=n,(n=p(n,Kp("("),Kp(")")))<0)continue;if(u=n,(n=p(n,qp))<0)continue;if("ident"!==e[n].type)continue;if(a=e[n].data,(n=p(n,qp))<0)continue;o=1,s=t,i=e[n].data,l=n;var f=p(n,qp);switch(e[f]&&e[f].data){case"lowp":case"highp":case"mediump":l=f}}else if(o&&"}"===r.data){if(--o)continue;d.push({name:a,type:i,body:[s+1,t],args:[u,c+1],outer:[l,t+1]})}for(t=0;t<e.length;t++)if(";"===(r=e[t]).data){if((n=p(t,Kp(")"),Kp()))<0)continue;if(c=n,(n=p(n,Kp("("),Kp(")")))<0)continue;if(u=n,(n=p(n,qp))<0)continue;if("ident"!==e[n].type)continue;if(a=e[n].data,(n=p(n,qp))<0)continue;if("operator"===e[n].type)continue;if("return"===e[n].data)continue;i=e[n].data,d.push({name:a,type:i,body:!1,args:[u,c+1],outer:[n,t+1]})}return d.sort((function(e,t){return e.outer[0]-t.outer[0]}));function p(t,n,r){for(var i=t-1;i>=0;i--){if(n(e[i]))return i;if(r&&r(e[i]))return-1}return-1}}));function eh(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var th={exports:{}};th.exports=function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){if(!s&&eh)return eh(o);if(a)return a(o,!0);throw new Error("Cannot find module '"+o+"'")}s=n[o]={exports:{}},t[o][0].call(s.exports,(function(e){return i(t[o][1][e]||e)}),s,s.exports,e,t,n,r)}return n[o].exports}for(var a=eh,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){(function(r,i,a,o,s,l,c,u,d){var f=e("crypto");function p(e,t){var n;return void 0===(n="passthrough"!==(t=v(e,t)).algorithm?f.createHash(t.algorithm):new y).write&&(n.write=n.update,n.end=n.update),x(t,n).dispatch(e),n.update||n.end(""),n.digest?n.digest("buffer"===t.encoding?void 0:t.encoding):(e=n.read(),"buffer"!==t.encoding?e.toString(t.encoding):e)}(n=t.exports=p).sha1=function(e){return p(e)},n.keys=function(e){return p(e,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},n.MD5=function(e){return p(e,{algorithm:"md5",encoding:"hex"})},n.keysMD5=function(e){return p(e,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var h=f.getHashes?f.getHashes().slice():["sha1","md5"],m=(h.push("passthrough"),["buffer","hex","binary","base64"]);function v(e,t){var n={};if(n.algorithm=(t=t||{}).algorithm||"sha1",n.encoding=t.encoding||"hex",n.excludeValues=!!t.excludeValues,n.algorithm=n.algorithm.toLowerCase(),n.encoding=n.encoding.toLowerCase(),n.ignoreUnknown=!0===t.ignoreUnknown,n.respectType=!1!==t.respectType,n.respectFunctionNames=!1!==t.respectFunctionNames,n.respectFunctionProperties=!1!==t.respectFunctionProperties,n.unorderedArrays=!0===t.unorderedArrays,n.unorderedSets=!1!==t.unorderedSets,n.unorderedObjects=!1!==t.unorderedObjects,n.replacer=t.replacer||void 0,n.excludeKeys=t.excludeKeys||void 0,void 0===e)throw new Error("Object argument required.");for(var r=0;r<h.length;++r)h[r].toLowerCase()===n.algorithm.toLowerCase()&&(n.algorithm=h[r]);if(-1===h.indexOf(n.algorithm))throw new Error('Algorithm "'+n.algorithm+'"  not supported. supported values: '+h.join(", "));if(-1===m.indexOf(n.encoding)&&"passthrough"!==n.algorithm)throw new Error('Encoding "'+n.encoding+'"  not supported. supported values: '+m.join(", "));return n}function g(e){if("function"==typeof e)return null!=/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))}function x(e,t,n){function r(e){return t.update?t.update(e,"utf8"):t.write(e,"utf8")}return n=n||[],{dispatch:function(t){return this["_"+(null===(t=e.replacer?e.replacer(t):t)?"null":typeof t)](t)},_object:function(t){var i,o=Object.prototype.toString.call(t),s=/\[object (.*)\]/i.exec(o);if(s=(s=s?s[1]:"unknown:["+o+"]").toLowerCase(),0<=(o=n.indexOf(t)))return this.dispatch("[CIRCULAR:"+o+"]");if(n.push(t),void 0!==a&&a.isBuffer&&a.isBuffer(t))return r("buffer:"),r(t);if("object"===s||"function"===s||"asyncfunction"===s)return o=Object.keys(t),e.unorderedObjects&&(o=o.sort()),!1===e.respectType||g(t)||o.splice(0,0,"prototype","__proto__","constructor"),e.excludeKeys&&(o=o.filter((function(t){return!e.excludeKeys(t)}))),r("object:"+o.length+":"),i=this,o.forEach((function(n){i.dispatch(n),r(":"),e.excludeValues||i.dispatch(t[n]),r(",")}));if(!this["_"+s]){if(e.ignoreUnknown)return r("["+s+"]");throw new Error('Unknown object type "'+s+'"')}this["_"+s](t)},_array:function(t,i){i=void 0!==i?i:!1!==e.unorderedArrays;var a=this;if(r("array:"+t.length+":"),!i||t.length<=1)return t.forEach((function(e){return a.dispatch(e)}));var o=[];return i=t.map((function(t){var r=new y,i=n.slice();return x(e,r,i).dispatch(t),o=o.concat(i.slice(n.length)),r.read().toString()})),n=n.concat(o),i.sort(),this._array(i,!1)},_date:function(e){return r("date:"+e.toJSON())},_symbol:function(e){return r("symbol:"+e.toString())},_error:function(e){return r("error:"+e.toString())},_boolean:function(e){return r("bool:"+e.toString())},_string:function(e){r("string:"+e.length+":"),r(e.toString())},_function:function(t){r("fn:"),g(t)?this.dispatch("[native]"):this.dispatch(t.toString()),!1!==e.respectFunctionNames&&this.dispatch("function-name:"+String(t.name)),e.respectFunctionProperties&&this._object(t)},_number:function(e){return r("number:"+e.toString())},_xml:function(e){return r("xml:"+e.toString())},_null:function(){return r("Null")},_undefined:function(){return r("Undefined")},_regexp:function(e){return r("regex:"+e.toString())},_uint8array:function(e){return r("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint8clampedarray:function(e){return r("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},_int8array:function(e){return r("int8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint16array:function(e){return r("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_int16array:function(e){return r("int16array:"),this.dispatch(Array.prototype.slice.call(e))},_uint32array:function(e){return r("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_int32array:function(e){return r("int32array:"),this.dispatch(Array.prototype.slice.call(e))},_float32array:function(e){return r("float32array:"),this.dispatch(Array.prototype.slice.call(e))},_float64array:function(e){return r("float64array:"),this.dispatch(Array.prototype.slice.call(e))},_arraybuffer:function(e){return r("arraybuffer:"),this.dispatch(new Uint8Array(e))},_url:function(e){return r("url:"+e.toString())},_map:function(t){return r("map:"),t=Array.from(t),this._array(t,!1!==e.unorderedSets)},_set:function(t){return r("set:"),t=Array.from(t),this._array(t,!1!==e.unorderedSets)},_file:function(e){return r("file:"),this.dispatch([e.name,e.size,e.type,e.lastModfied])},_blob:function(){if(e.ignoreUnknown)return r("[blob]");throw Error('Hashing Blob objects is currently not supported\n(see https://github.com/puleos/object-hash/issues/26)\nUse "options.replacer" or "options.ignoreUnknown"\n')},_domwindow:function(){return r("domwindow")},_bigint:function(e){return r("bigint:"+e.toString())},_process:function(){return r("process")},_timer:function(){return r("timer")},_pipe:function(){return r("pipe")},_tcp:function(){return r("tcp")},_udp:function(){return r("udp")},_tty:function(){return r("tty")},_statwatcher:function(){return r("statwatcher")},_securecontext:function(){return r("securecontext")},_connection:function(){return r("connection")},_zlib:function(){return r("zlib")},_context:function(){return r("context")},_nodescript:function(){return r("nodescript")},_httpparser:function(){return r("httpparser")},_dataview:function(){return r("dataview")},_signal:function(){return r("signal")},_fsevent:function(){return r("fsevent")},_tlswrap:function(){return r("tlswrap")}}}function y(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}n.writeToStream=function(e,t,n){return void 0===n&&(n=t,t={}),x(t=v(e,t),n).dispatch(e)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(e,t,n){(function(e,t,r,i,a,o,s,l,c){!function(e){var t="undefined"!=typeof Uint8Array?Uint8Array:Array,n="+".charCodeAt(0),r="/".charCodeAt(0),i="0".charCodeAt(0),a="a".charCodeAt(0),o="A".charCodeAt(0),s="-".charCodeAt(0),l="_".charCodeAt(0);function c(e){return(e=e.charCodeAt(0))===n||e===s?62:e===r||e===l?63:e<i?-1:e<i+10?e-i+26+26:e<o+26?e-o:e<a+26?e-a+26:void 0}e.toByteArray=function(e){var n,r;if(0<e.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.length,a=(i="="===e.charAt(i-2)?2:"="===e.charAt(i-1)?1:0,new t(3*e.length/4-i)),o=0<i?e.length-4:e.length,s=0;function l(e){a[s++]=e}for(n=0;n<o;n+=4,0)l((16711680&(r=c(e.charAt(n))<<18|c(e.charAt(n+1))<<12|c(e.charAt(n+2))<<6|c(e.charAt(n+3))))>>16),l((65280&r)>>8),l(255&r);return 2==i?l(255&(r=c(e.charAt(n))<<2|c(e.charAt(n+1))>>4)):1==i&&(l((r=c(e.charAt(n))<<10|c(e.charAt(n+1))<<4|c(e.charAt(n+2))>>2)>>8&255),l(255&r)),a},e.fromByteArray=function(e){var t,n,r,i,a=e.length%3,o="";function s(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)}for(t=0,r=e.length-a;t<r;t+=3)o+=s((i=n=(e[t]<<16)+(e[t+1]<<8)+e[t+2])>>18&63)+s(i>>12&63)+s(i>>6&63)+s(63&i);switch(a){case 1:o=(o+=s((n=e[e.length-1])>>2))+s(n<<4&63)+"==";break;case 2:o=(o=(o+=s((n=(e[e.length-2]<<8)+e[e.length-1])>>10))+s(n>>4&63))+s(n<<2&63)+"="}return o}}(void 0===n?this.base64js={}:n)}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(e,t,n){(function(t,r,i,a,o,s,l,c,u){var d=e("base64-js"),f=e("ieee754");function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);var r,a,o,s,l=typeof e;if("base64"===t&&"string"==l)for(e=(s=e).trim?s.trim():s.replace(/^\s+|\s+$/g,"");e.length%4!=0;)e+="=";if("number"==l)r=R(e);else if("string"==l)r=i.byteLength(e,t);else{if("object"!=l)throw new Error("First argument needs to be a number, array or string.");r=R(e.length)}if(i._useTypedArrays?a=i._augment(new Uint8Array(r)):((a=this).length=r,a._isBuffer=!0),i._useTypedArrays&&"number"==typeof e.byteLength)a._set(e);else if(P(s=e)||i.isBuffer(s)||s&&"object"==typeof s&&"number"==typeof s.length)for(o=0;o<r;o++)i.isBuffer(e)?a[o]=e.readUInt8(o):a[o]=e[o];else if("string"==l)a.write(e,0,t);else if("number"==l&&!i._useTypedArrays&&!n)for(o=0;o<r;o++)a[o]=0;return a}function p(e,t,n,r){return i._charsWritten=U(function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function h(e,t,n,r){return i._charsWritten=U(function(e){for(var t,n,r=[],i=0;i<e.length;i++)t=(n=e.charCodeAt(i))>>8,n%=256,r.push(n),r.push(t);return r}(t),e,n,r)}function m(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r}function v(e,t,n,r){var i;if(r||(k("boolean"==typeof n,"missing or invalid endian"),k(null!=t,"missing offset"),k(t+1<e.length,"Trying to read beyond buffer length")),!((r=e.length)<=t))return n?(i=e[t],t+1<r&&(i|=e[t+1]<<8)):(i=e[t]<<8,t+1<r&&(i|=e[t+1])),i}function g(e,t,n,r){var i;if(r||(k("boolean"==typeof n,"missing or invalid endian"),k(null!=t,"missing offset"),k(t+3<e.length,"Trying to read beyond buffer length")),!((r=e.length)<=t))return n?(t+2<r&&(i=e[t+2]<<16),t+1<r&&(i|=e[t+1]<<8),i|=e[t],t+3<r&&(i+=e[t+3]<<24>>>0)):(t+1<r&&(i=e[t+1]<<16),t+2<r&&(i|=e[t+2]<<8),t+3<r&&(i|=e[t+3]),i+=e[t]<<24>>>0),i}function x(e,t,n,r){if(r||(k("boolean"==typeof n,"missing or invalid endian"),k(null!=t,"missing offset"),k(t+1<e.length,"Trying to read beyond buffer length")),!(e.length<=t))return 32768&(r=v(e,t,n,!0))?-1*(65535-r+1):r}function y(e,t,n,r){if(r||(k("boolean"==typeof n,"missing or invalid endian"),k(null!=t,"missing offset"),k(t+3<e.length,"Trying to read beyond buffer length")),!(e.length<=t))return 2147483648&(r=g(e,t,n,!0))?-1*(4294967295-r+1):r}function b(e,t,n,r){return r||(k("boolean"==typeof n,"missing or invalid endian"),k(t+3<e.length,"Trying to read beyond buffer length")),f.read(e,t,n,23,4)}function _(e,t,n,r){return r||(k("boolean"==typeof n,"missing or invalid endian"),k(t+7<e.length,"Trying to read beyond buffer length")),f.read(e,t,n,52,8)}function L(e,t,n,r,i){if(i||(k(null!=t,"missing value"),k("boolean"==typeof r,"missing or invalid endian"),k(null!=n,"missing offset"),k(n+1<e.length,"trying to write beyond buffer length"),G(t,65535)),!((i=e.length)<=n))for(var a=0,o=Math.min(i-n,2);a<o;a++)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function S(e,t,n,r,i){if(i||(k(null!=t,"missing value"),k("boolean"==typeof r,"missing or invalid endian"),k(null!=n,"missing offset"),k(n+3<e.length,"trying to write beyond buffer length"),G(t,4294967295)),!((i=e.length)<=n))for(var a=0,o=Math.min(i-n,4);a<o;a++)e[n+a]=t>>>8*(r?a:3-a)&255}function w(e,t,n,r,i){i||(k(null!=t,"missing value"),k("boolean"==typeof r,"missing or invalid endian"),k(null!=n,"missing offset"),k(n+1<e.length,"Trying to write beyond buffer length"),B(t,32767,-32768)),e.length<=n||L(e,0<=t?t:65535+t+1,n,r,i)}function M(e,t,n,r,i){i||(k(null!=t,"missing value"),k("boolean"==typeof r,"missing or invalid endian"),k(null!=n,"missing offset"),k(n+3<e.length,"Trying to write beyond buffer length"),B(t,2147483647,-2147483648)),e.length<=n||S(e,0<=t?t:4294967295+t+1,n,r,i)}function A(e,t,n,r,i){i||(k(null!=t,"missing value"),k("boolean"==typeof r,"missing or invalid endian"),k(null!=n,"missing offset"),k(n+3<e.length,"Trying to write beyond buffer length"),D(t,34028234663852886e22,-34028234663852886e22)),e.length<=n||f.write(e,t,n,r,23,4)}function T(e,t,n,r,i){i||(k(null!=t,"missing value"),k("boolean"==typeof r,"missing or invalid endian"),k(null!=n,"missing offset"),k(n+7<e.length,"Trying to write beyond buffer length"),D(t,17976931348623157e292,-17976931348623157e292)),e.length<=n||f.write(e,t,n,r,52,8)}n.Buffer=i,n.SlowBuffer=i,n.INSPECT_MAX_BYTES=50,i.poolSize=8192,i._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(n){return!1}}(),i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.isBuffer=function(e){return!(null==e||!e._isBuffer)},i.byteLength=function(e,t){var n;switch(e+="",t||"utf8"){case"hex":n=e.length/2;break;case"utf8":case"utf-8":n=I(e).length;break;case"ascii":case"binary":case"raw":n=e.length;break;case"base64":n=N(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=2*e.length;break;default:throw new Error("Unknown encoding")}return n},i.concat=function(e,t){if(k(P(e),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===e.length)return new i(0);if(1===e.length)return e[0];if("number"!=typeof t)for(a=t=0;a<e.length;a++)t+=e[a].length;for(var n=new i(t),r=0,a=0;a<e.length;a++){var o=e[a];o.copy(n,r),r+=o.length}return n},i.prototype.write=function(e,t,n,r){isFinite(t)?isFinite(n)||(r=n,n=void 0):(c=r,r=t,t=n,n=c),t=Number(t)||0;var a,o,s,l,c=this.length-t;switch((!n||c<(n=Number(n)))&&(n=c),r=String(r||"utf8").toLowerCase()){case"hex":a=function(e,t,n,r){n=Number(n)||0;var a=e.length-n;(!r||a<(r=Number(r)))&&(r=a),k((a=t.length)%2==0,"Invalid hex string"),a/2<r&&(r=a/2);for(var o=0;o<r;o++){var s=parseInt(t.substr(2*o,2),16);k(!isNaN(s),"Invalid hex string"),e[n+o]=s}return i._charsWritten=2*o,o}(this,e,t,n);break;case"utf8":case"utf-8":o=this,s=t,l=n,a=i._charsWritten=U(I(e),o,s,l);break;case"ascii":case"binary":a=p(this,e,t,n);break;case"base64":o=this,s=t,l=n,a=i._charsWritten=U(N(e),o,s,l);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":a=h(this,e,t,n);break;default:throw new Error("Unknown encoding")}return a},i.prototype.toString=function(e,t,n){var r,i,a,o,s=this;if(e=String(e||"utf8").toLowerCase(),t=Number(t)||0,(n=void 0!==n?Number(n):s.length)===t)return"";switch(e){case"hex":r=function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||r<n)&&(n=r);for(var i="",a=t;a<n;a++)i+=F(e[a]);return i}(s,t,n);break;case"utf8":case"utf-8":r=function(e,t,n){var r="",i="";n=Math.min(e.length,n);for(var a=t;a<n;a++)e[a]<=127?(r+=z(i)+String.fromCharCode(e[a]),i=""):i+="%"+e[a].toString(16);return r+z(i)}(s,t,n);break;case"ascii":case"binary":r=m(s,t,n);break;case"base64":i=s,o=n,r=0===(a=t)&&o===i.length?d.fromByteArray(i):d.fromByteArray(i.slice(a,o));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=function(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}(s,t,n);break;default:throw new Error("Unknown encoding")}return r},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},i.prototype.copy=function(e,t,n,r){if(t=t||0,(r=r||0===r?r:this.length)!==(n=n||0)&&0!==e.length&&0!==this.length){k(n<=r,"sourceEnd < sourceStart"),k(0<=t&&t<e.length,"targetStart out of bounds"),k(0<=n&&n<this.length,"sourceStart out of bounds"),k(0<=r&&r<=this.length,"sourceEnd out of bounds"),r>this.length&&(r=this.length);var a=(r=e.length-t<r-n?e.length-t+n:r)-n;if(a<100||!i._useTypedArrays)for(var o=0;o<a;o++)e[o+t]=this[o+n];else e._set(this.subarray(n,n+a),t)}},i.prototype.slice=function(e,t){var n=this.length;if(e=C(e,n,0),t=C(t,n,n),i._useTypedArrays)return i._augment(this.subarray(e,t));for(var r=t-e,a=new i(r,void 0,!0),o=0;o<r;o++)a[o]=this[o+e];return a},i.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},i.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},i.prototype.readUInt8=function(e,t){if(t||(k(null!=e,"missing offset"),k(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return this[e]},i.prototype.readUInt16LE=function(e,t){return v(this,e,!0,t)},i.prototype.readUInt16BE=function(e,t){return v(this,e,!1,t)},i.prototype.readUInt32LE=function(e,t){return g(this,e,!0,t)},i.prototype.readUInt32BE=function(e,t){return g(this,e,!1,t)},i.prototype.readInt8=function(e,t){if(t||(k(null!=e,"missing offset"),k(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return 128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16LE=function(e,t){return x(this,e,!0,t)},i.prototype.readInt16BE=function(e,t){return x(this,e,!1,t)},i.prototype.readInt32LE=function(e,t){return y(this,e,!0,t)},i.prototype.readInt32BE=function(e,t){return y(this,e,!1,t)},i.prototype.readFloatLE=function(e,t){return b(this,e,!0,t)},i.prototype.readFloatBE=function(e,t){return b(this,e,!1,t)},i.prototype.readDoubleLE=function(e,t){return _(this,e,!0,t)},i.prototype.readDoubleBE=function(e,t){return _(this,e,!1,t)},i.prototype.writeUInt8=function(e,t,n){n||(k(null!=e,"missing value"),k(null!=t,"missing offset"),k(t<this.length,"trying to write beyond buffer length"),G(e,255)),t>=this.length||(this[t]=e)},i.prototype.writeUInt16LE=function(e,t,n){L(this,e,t,!0,n)},i.prototype.writeUInt16BE=function(e,t,n){L(this,e,t,!1,n)},i.prototype.writeUInt32LE=function(e,t,n){S(this,e,t,!0,n)},i.prototype.writeUInt32BE=function(e,t,n){S(this,e,t,!1,n)},i.prototype.writeInt8=function(e,t,n){n||(k(null!=e,"missing value"),k(null!=t,"missing offset"),k(t<this.length,"Trying to write beyond buffer length"),B(e,127,-128)),t>=this.length||(0<=e?this.writeUInt8(e,t,n):this.writeUInt8(255+e+1,t,n))},i.prototype.writeInt16LE=function(e,t,n){w(this,e,t,!0,n)},i.prototype.writeInt16BE=function(e,t,n){w(this,e,t,!1,n)},i.prototype.writeInt32LE=function(e,t,n){M(this,e,t,!0,n)},i.prototype.writeInt32BE=function(e,t,n){M(this,e,t,!1,n)},i.prototype.writeFloatLE=function(e,t,n){A(this,e,t,!0,n)},i.prototype.writeFloatBE=function(e,t,n){A(this,e,t,!1,n)},i.prototype.writeDoubleLE=function(e,t,n){T(this,e,t,!0,n)},i.prototype.writeDoubleBE=function(e,t,n){T(this,e,t,!1,n)},i.prototype.fill=function(e,t,n){if(t=t||0,n=n||this.length,k("number"==typeof(e="string"==typeof(e=e||0)?e.charCodeAt(0):e)&&!isNaN(e),"value is not a number"),k(t<=n,"end < start"),n!==t&&0!==this.length){k(0<=t&&t<this.length,"start out of bounds"),k(0<=n&&n<=this.length,"end out of bounds");for(var r=t;r<n;r++)this[r]=e}},i.prototype.inspect=function(){for(var e=[],t=this.length,r=0;r<t;r++)if(e[r]=F(this[r]),r===n.INSPECT_MAX_BYTES){e[r+1]="...";break}return"<Buffer "+e.join(" ")+">"},i.prototype.toArrayBuffer=function(){if("undefined"==typeof Uint8Array)throw new Error("Buffer.toArrayBuffer not supported in this browser");if(i._useTypedArrays)return new i(this).buffer;for(var e=new Uint8Array(this.length),t=0,n=e.length;t<n;t+=1)e[t]=this[t];return e.buffer};var E=i.prototype;function C(e,t,n){return"number"!=typeof e?n:t<=(e=~~e)?t:0<=e||0<=(e+=t)?e:0}function R(e){return(e=~~Math.ceil(+e))<0?0:e}function P(e){return(Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)})(e)}function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function I(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127)t.push(e.charCodeAt(n));else for(var i=n,a=(55296<=r&&r<=57343&&n++,encodeURIComponent(e.slice(i,n+1)).substr(1).split("%")),o=0;o<a.length;o++)t.push(parseInt(a[o],16))}return t}function N(e){return d.toByteArray(e)}function U(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);i++)t[i+n]=e[i];return i}function z(e){try{return decodeURIComponent(e)}catch(t){return String.fromCharCode(65533)}}function G(e,t){k("number"==typeof e,"cannot write a non-number as a number"),k(0<=e,"specified a negative value for writing an unsigned value"),k(e<=t,"value is larger than maximum value for type"),k(Math.floor(e)===e,"value has a fractional component")}function B(e,t,n){k("number"==typeof e,"cannot write a non-number as a number"),k(e<=t,"value larger than maximum allowed value"),k(n<=e,"value smaller than minimum allowed value"),k(Math.floor(e)===e,"value has a fractional component")}function D(e,t,n){k("number"==typeof e,"cannot write a non-number as a number"),k(e<=t,"value larger than maximum allowed value"),k(n<=e,"value smaller than minimum allowed value")}function k(e,t){if(!e)throw new Error(t||"Failed assertion")}i._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=E.get,e.set=E.set,e.write=E.write,e.toString=E.toString,e.toLocaleString=E.toString,e.toJSON=E.toJSON,e.copy=E.copy,e.slice=E.slice,e.readUInt8=E.readUInt8,e.readUInt16LE=E.readUInt16LE,e.readUInt16BE=E.readUInt16BE,e.readUInt32LE=E.readUInt32LE,e.readUInt32BE=E.readUInt32BE,e.readInt8=E.readInt8,e.readInt16LE=E.readInt16LE,e.readInt16BE=E.readInt16BE,e.readInt32LE=E.readInt32LE,e.readInt32BE=E.readInt32BE,e.readFloatLE=E.readFloatLE,e.readFloatBE=E.readFloatBE,e.readDoubleLE=E.readDoubleLE,e.readDoubleBE=E.readDoubleBE,e.writeUInt8=E.writeUInt8,e.writeUInt16LE=E.writeUInt16LE,e.writeUInt16BE=E.writeUInt16BE,e.writeUInt32LE=E.writeUInt32LE,e.writeUInt32BE=E.writeUInt32BE,e.writeInt8=E.writeInt8,e.writeInt16LE=E.writeInt16LE,e.writeInt16BE=E.writeInt16BE,e.writeInt32LE=E.writeInt32LE,e.writeInt32BE=E.writeInt32BE,e.writeFloatLE=E.writeFloatLE,e.writeFloatBE=E.writeFloatBE,e.writeDoubleLE=E.writeDoubleLE,e.writeDoubleBE=E.writeDoubleBE,e.fill=E.fill,e.inspect=E.inspect,e.toArrayBuffer=E.toArrayBuffer,e}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(e,t,n){(function(n,r,i,a,o,s,l,c,u){i=e("buffer").Buffer;var d=4,f=new i(d);f.fill(0),t.exports={hash:function(e,t,n,r){for(var a=t(function(e,t){e.length%d!=0&&(n=e.length+(d-e.length%d),e=i.concat([e,f],n));for(var n,r=[],a=t?e.readInt32BE:e.readInt32LE,o=0;o<e.length;o+=d)r.push(a.call(e,o));return r}(e=i.isBuffer(e)?e:new i(e),r),8*e.length),o=(t=r,new i(n)),s=t?o.writeInt32BE:o.writeInt32LE,l=0;l<a.length;l++)s.call(o,a[l],4*l,!0);return o}}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(e,t,n){(function(t,r,i,a,o,s,l,c,u){i=e("buffer").Buffer;var d=e("./sha"),f=e("./sha256"),p=e("./rng"),h={sha1:d,sha256:f,md5:e("./md5")},m=64,v=new i(m);function g(e,t){var n=h[e=e||"sha1"],r=[];return n||x("algorithm:",e,"is not yet supported"),{update:function(e){return i.isBuffer(e)||(e=new i(e)),r.push(e),e.length,this},digest:function(e){var a=i.concat(r);return a=t?function(e,t,n){i.isBuffer(t)||(t=new i(t)),i.isBuffer(n)||(n=new i(n)),t.length>m?t=e(t):t.length<m&&(t=i.concat([t,v],m));for(var r=new i(m),a=new i(m),o=0;o<m;o++)r[o]=54^t[o],a[o]=92^t[o];return n=e(i.concat([r,n])),e(i.concat([a,n]))}(n,t,a):n(a),r=null,e?a.toString(e):a}}}function x(){var e=[].slice.call(arguments).join(" ");throw new Error([e,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}v.fill(0),n.createHash=function(e){return g(e)},n.createHmac=g,n.randomBytes=function(e,t){if(!t||!t.call)return new i(p(e));try{t.call(this,void 0,new i(p(e)))}catch(n){t(n)}};var y,b=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],_=function(e){n[e]=function(){x("sorry,",e,"is not implemented yet")}};for(y in b)_(b[y])}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(e,t,n){(function(n,r,i,a,o,s,l,c,u){var d=e("./helpers");function f(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,a=271733878,o=0;o<e.length;o+=16){var s=n,l=r,c=i,u=a;n=h(n,r,i,a,e[o+0],7,-680876936),a=h(a,n,r,i,e[o+1],12,-389564586),i=h(i,a,n,r,e[o+2],17,606105819),r=h(r,i,a,n,e[o+3],22,-1044525330),n=h(n,r,i,a,e[o+4],7,-176418897),a=h(a,n,r,i,e[o+5],12,1200080426),i=h(i,a,n,r,e[o+6],17,-1473231341),r=h(r,i,a,n,e[o+7],22,-45705983),n=h(n,r,i,a,e[o+8],7,1770035416),a=h(a,n,r,i,e[o+9],12,-1958414417),i=h(i,a,n,r,e[o+10],17,-42063),r=h(r,i,a,n,e[o+11],22,-1990404162),n=h(n,r,i,a,e[o+12],7,1804603682),a=h(a,n,r,i,e[o+13],12,-40341101),i=h(i,a,n,r,e[o+14],17,-1502002290),n=m(n,r=h(r,i,a,n,e[o+15],22,1236535329),i,a,e[o+1],5,-165796510),a=m(a,n,r,i,e[o+6],9,-1069501632),i=m(i,a,n,r,e[o+11],14,643717713),r=m(r,i,a,n,e[o+0],20,-373897302),n=m(n,r,i,a,e[o+5],5,-701558691),a=m(a,n,r,i,e[o+10],9,38016083),i=m(i,a,n,r,e[o+15],14,-660478335),r=m(r,i,a,n,e[o+4],20,-405537848),n=m(n,r,i,a,e[o+9],5,568446438),a=m(a,n,r,i,e[o+14],9,-1019803690),i=m(i,a,n,r,e[o+3],14,-187363961),r=m(r,i,a,n,e[o+8],20,1163531501),n=m(n,r,i,a,e[o+13],5,-1444681467),a=m(a,n,r,i,e[o+2],9,-51403784),i=m(i,a,n,r,e[o+7],14,1735328473),n=v(n,r=m(r,i,a,n,e[o+12],20,-1926607734),i,a,e[o+5],4,-378558),a=v(a,n,r,i,e[o+8],11,-2022574463),i=v(i,a,n,r,e[o+11],16,1839030562),r=v(r,i,a,n,e[o+14],23,-35309556),n=v(n,r,i,a,e[o+1],4,-1530992060),a=v(a,n,r,i,e[o+4],11,1272893353),i=v(i,a,n,r,e[o+7],16,-155497632),r=v(r,i,a,n,e[o+10],23,-1094730640),n=v(n,r,i,a,e[o+13],4,681279174),a=v(a,n,r,i,e[o+0],11,-358537222),i=v(i,a,n,r,e[o+3],16,-722521979),r=v(r,i,a,n,e[o+6],23,76029189),n=v(n,r,i,a,e[o+9],4,-640364487),a=v(a,n,r,i,e[o+12],11,-421815835),i=v(i,a,n,r,e[o+15],16,530742520),n=g(n,r=v(r,i,a,n,e[o+2],23,-995338651),i,a,e[o+0],6,-198630844),a=g(a,n,r,i,e[o+7],10,1126891415),i=g(i,a,n,r,e[o+14],15,-1416354905),r=g(r,i,a,n,e[o+5],21,-57434055),n=g(n,r,i,a,e[o+12],6,1700485571),a=g(a,n,r,i,e[o+3],10,-1894986606),i=g(i,a,n,r,e[o+10],15,-1051523),r=g(r,i,a,n,e[o+1],21,-2054922799),n=g(n,r,i,a,e[o+8],6,1873313359),a=g(a,n,r,i,e[o+15],10,-30611744),i=g(i,a,n,r,e[o+6],15,-1560198380),r=g(r,i,a,n,e[o+13],21,1309151649),n=g(n,r,i,a,e[o+4],6,-145523070),a=g(a,n,r,i,e[o+11],10,-1120210379),i=g(i,a,n,r,e[o+2],15,718787259),r=g(r,i,a,n,e[o+9],21,-343485551),n=x(n,s),r=x(r,l),i=x(i,c),a=x(a,u)}return Array(n,r,i,a)}function p(e,t,n,r,i,a){return x((t=x(x(t,e),x(r,a)))<<i|t>>>32-i,n)}function h(e,t,n,r,i,a,o){return p(t&n|~t&r,e,t,i,a,o)}function m(e,t,n,r,i,a,o){return p(t&r|n&~r,e,t,i,a,o)}function v(e,t,n,r,i,a,o){return p(t^n^r,e,t,i,a,o)}function g(e,t,n,r,i,a,o){return p(n^(t|~r),e,t,i,a,o)}function x(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}t.exports=function(e){return d.hash(e,f,16)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(e,t,n){(function(e,n,r,i,a,o,s,l,c){t.exports=function(e){for(var t,n=new Array(e),r=0;r<e;r++)0==(3&r)&&(t=4294967296*Math.random()),n[r]=t>>>((3&r)<<3)&255;return n}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(e,t,n){(function(n,r,i,a,o,s,l,c,u){var d=e("./helpers");function f(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var n,r,i,a=Array(80),o=1732584193,s=-271733879,l=-1732584194,c=271733878,u=-1009589776,d=0;d<e.length;d+=16){for(var f=o,m=s,v=l,g=c,x=u,y=0;y<80;y++){a[y]=y<16?e[d+y]:h(a[y-3]^a[y-8]^a[y-14]^a[y-16],1);var b=p(p(h(o,5),(b=s,r=l,i=c,(n=y)<20?b&r|~b&i:!(n<40)&&n<60?b&r|b&i|r&i:b^r^i)),p(p(u,a[y]),(n=y)<20?1518500249:n<40?1859775393:n<60?-1894007588:-899497514));u=c,c=l,l=h(s,30),s=o,o=b}o=p(o,f),s=p(s,m),l=p(l,v),c=p(c,g),u=p(u,x)}return Array(o,s,l,c,u)}function p(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function h(e,t){return e<<t|e>>>32-t}t.exports=function(e){return d.hash(e,f,20,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(e,t,n){(function(n,r,i,a,o,s,l,c,u){function d(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function f(e,t){var n,r=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),i=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),a=new Array(64);e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var o,s,l=0;l<e.length;l+=16){for(var c=i[0],u=i[1],f=i[2],p=i[3],v=i[4],g=i[5],x=i[6],y=i[7],b=0;b<64;b++)a[b]=b<16?e[b+l]:d(d(d((s=a[b-2],h(s,17)^h(s,19)^m(s,10)),a[b-7]),(s=a[b-15],h(s,7)^h(s,18)^m(s,3))),a[b-16]),n=d(d(d(d(y,h(s=v,6)^h(s,11)^h(s,25)),v&g^~v&x),r[b]),a[b]),o=d(h(o=c,2)^h(o,13)^h(o,22),c&u^c&f^u&f),y=x,x=g,g=v,v=d(p,n),p=f,f=u,u=c,c=d(n,o);i[0]=d(c,i[0]),i[1]=d(u,i[1]),i[2]=d(f,i[2]),i[3]=d(p,i[3]),i[4]=d(v,i[4]),i[5]=d(g,i[5]),i[6]=d(x,i[6]),i[7]=d(y,i[7])}return i}var p=e("./helpers"),h=function(e,t){return e>>>t|e<<32-t},m=function(e,t){return e>>>t};t.exports=function(e){return p.hash(e,f,32,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(e,t,n){(function(e,t,r,i,a,o,s,l,c){n.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,l=(1<<s)-1,c=l>>1,u=-7,d=n?i-1:0,f=n?-1:1;for(i=e[t+d],d+=f,a=i&(1<<-u)-1,i>>=-u,u+=s;0<u;a=256*a+e[t+d],d+=f,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;0<u;o=256*o+e[t+d],d+=f,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(i?-1:1);o+=Math.pow(2,r),a-=c}return(i?-1:1)*o*Math.pow(2,a-r)},n.write=function(e,t,n,r,i,a){var o,s,l=8*a-i-1,c=(1<<l)-1,u=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1;for(a=t<0||0===t&&1/t<0?1:0,t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-o))<1&&(o--,r*=2),2<=(t+=1<=o+u?d/r:d*Math.pow(2,1-u))*r&&(o++,r/=2),c<=o+u?(s=0,o=c):1<=o+u?(s=(t*r-1)*Math.pow(2,i),o+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,i),o=0));8<=i;e[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,l+=i;0<l;e[n+f]=255&o,f+=p,o/=256,l-=8);e[n+f-p]|=128*a}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(e,t,n){(function(e,n,r,i,a,o,s,l,c){var u,d,f;function p(){}(e=t.exports={}).nextTick=(d="undefined"!=typeof window&&window.setImmediate,f="undefined"!=typeof window&&window.postMessage&&window.addEventListener,d?function(e){return window.setImmediate(e)}:f?(u=[],window.addEventListener("message",(function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),0<u.length&&u.shift()())}),!0),function(e){u.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=p,e.addListener=p,e.once=p,e.off=p,e.removeListener=p,e.removeAllListeners=p,e.emit=p,e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1);const nh=_e(th.exports);var rh="csm_Position",ih="csm_PositionRaw",ah="csm_PointSize",oh="csm_FragColor",sh="csm_DiffuseColor",lh="csm_Normal",ch="csm_Roughness",uh="csm_Metalness",dh="csm_Emissive";const fh={[`${lh}`]:{"#include <beginnormal_vertex>":`\n    vec3 objectNormal = ${lh};\n    #ifdef USE_TANGENT\n\t    vec3 objectTangent = vec3( tangent.xyz );\n    #endif\n    `},[`${rh}`]:{"#include <begin_vertex>":`\n    vec3 transformed = ${rh};\n  `},[`${ih}`]:{"#include <begin_vertex>":`\n    vec4 csm_positionUnprojected = ${ih};\n    mat4x4 csm_unprojectMatrix = projectionMatrix * modelViewMatrix;\n    #ifdef USE_INSTANCING\n      csm_unprojectMatrix = csm_unprojectMatrix * instanceMatrix;\n    #endif\n    csm_positionUnprojected = inverse(csm_unprojectMatrix) * csm_positionUnprojected;\n    vec3 transformed = csm_positionUnprojected.xyz;\n  `},[`${ah}`]:{"gl_PointSize = size;":`\n    gl_PointSize = ${ah};\n    `},[`${sh}`]:{"#include <color_fragment>":`\n    #include <color_fragment>\n    diffuseColor = ${sh};\n  `},[`${oh}`]:{"#include <dithering_fragment>":`\n    #include <dithering_fragment>\n    gl_FragColor  = ${oh};\n  `},[`${dh}`]:{"vec3 totalEmissiveRadiance = emissive;":`\n    vec3 totalEmissiveRadiance = ${dh};\n    `},[`${ch}`]:{"#include <roughnessmap_fragment>":`\n    #include <roughnessmap_fragment>\n    roughnessFactor = ${ch};\n    `},[`${uh}`]:{"#include <metalnessmap_fragment>":`\n    #include <metalnessmap_fragment>\n    metalnessFactor = ${uh};\n    `}},ph={[`${rh}`]:{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( ${rh}, 1.0 );\n  `},[`${ih}`]:{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`\n    gl_Position = ${rh};\n  `},[`${sh}`]:{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`\n    gl_FragColor = ${sh};\n  `},[`${oh}`]:{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`\n    gl_FragColor = ${oh};\n  `}};class hh extends F{constructor({baseMaterial:e,fragmentShader:t,vertexShader:n,uniforms:r,patchMap:i,cacheKey:a,...o}){let s;if(!function(e){try{new e}catch(t){if(t.message.indexOf("is not a constructor")>=0)return!1}return!0}(e)?(s=e,Object.assign(s,o)):s=new e(o),"RawShaderMaterial"===s.type)throw new Error("CustomShaderMaterial does not support RawShaderMaterial");super(),this.uniforms=r||{},this._customPatchMap=i||{},this._fs=t||"",this._vs=n||"",this._cacheKey=a,this._base=e,this._type=s.type,this._instanceID=ee.generateUUID();for(const l in s){let e=l;l.startsWith("_")&&(e=l.split("_")[1]),void 0===this[e]&&(this[e]=0),this[e]=s[e]}this.update({fragmentShader:t,vertexShader:n,uniforms:r,cacheKey:a})}update(e){const t=(null==e?void 0:e.uniforms)||{},n=(null==e?void 0:e.fragmentShader)||this._fs,r=(null==e?void 0:e.vertexShader)||this._vs,i=Object.values(t).reduce(((e,{value:t})=>e+JSON.stringify(t)),"");this.uuid=(null==e||null==e.cacheKey?void 0:e.cacheKey())||nh([n,r,i,this._instanceID]),this.generateMaterial({fragmentShader:n,vertexShader:r,uniforms:t})}clone(){const e=new this.constructor({baseMaterial:this._base,fragmentShader:this._fs,vertexShader:this._vs,patchMap:this._customPatchMap,uniforms:this.uniforms,cacheKey:this._cacheKey});for(const t in this)"uuid"!==t&&(e[t]=this[t]);return e}generateMaterial({fragmentShader:e,vertexShader:t,uniforms:n}){const r=this.parseShader(e),i=this.parseShader(t);this.uniforms=n||{},this.customProgramCacheKey=()=>this.uuid,this.onBeforeCompile=e=>{if(r){const t=this.patchShader(r,e.fragmentShader);e.fragmentShader=this.getMaterialDefine()+t}if(i){const t=this.patchShader(i,e.vertexShader);e.vertexShader="#define IS_VERTEX;\n"+t,e.vertexShader=this.getMaterialDefine()+e.vertexShader}e.uniforms={...e.uniforms,...this.uniforms},this.uniforms=e.uniforms},this.needsUpdate=!0}getMaterialDefine(){return`#define IS_${this._type.toUpperCase()};\n`}getPatchMapForMaterial(){return"ShaderMaterial"===this._type?ph:fh}patchShader(e,t){let n=t;const r={...this.getPatchMapForMaterial(),...this._customPatchMap};return Object.keys(r).forEach((t=>{Object.keys(r[t]).forEach((i=>{var a,o;a=e.main,new RegExp(`\\b${o=t,o.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}\\b`).test(a)&&(n=((e,t,n)=>e.split(t).join(n))(n,i,r[t][i]))}))})),n=n.replace("void main() {",`\n          ${e.header}\n          void main() {\n            \n\n#ifdef IS_VERTEX\n    vec3 csm_Position = position;\n    vec4 csm_PositionRaw = projectionMatrix * modelViewMatrix * vec4(position, 1.);\n    vec3 csm_Normal = normal;\n#else\n    #if defined IS_SHADERMATERIAL || defined IS_MESHDEPTHMATERIAL || defined IS_MESHNORMALMATERIAL\n        vec4 csm_DiffuseColor = vec4(1., 0., 1., 1.);\n        vec4 csm_FragColor = vec4(1., 0., 1., 1.);\n    #else\n        #if defined IS_MESHSTANDARDMATERIAL || defined IS_MESHPHYSICALMATERIAL\n            vec3 csm_Emissive = emissive;\n            float csm_Roughness = roughness;\n            float csm_Metalness = metalness;\n        #endif\n        \n        #ifdef USE_MAP\n            vec4 _csm_sampledDiffuseColor = texture2D(map, vUv);\n\n            #ifdef DECODE_VIDEO_TEXTURE\n            // inline sRGB decode (TODO: Remove this code when https://crbug.com/1256340 is solved)\n            _csm_sampledDiffuseColor = vec4(mix(pow(_csm_sampledDiffuseColor.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), _csm_sampledDiffuseColor.rgb * 0.0773993808, vec3(lessThanEqual(_csm_sampledDiffuseColor.rgb, vec3(0.04045)))), _csm_sampledDiffuseColor.w);\n            #endif\n\n            vec4 csm_DiffuseColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;\n            vec4 csm_FragColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;\n        #else\n            vec4 csm_DiffuseColor = vec4(diffuse, opacity);\n            vec4 csm_FragColor = vec4(diffuse, opacity);\n        #endif\n    #endif\n#endif\n\n            ${e.main}\n          `),n=e.defines+n,n}parseShader(e){if(!e)return;const t=e.replace(/\/\*\*(.*?)\*\/|\/\/(.*?)\n/gm,""),n=Up(t),r=Jp(n),i=r.map((e=>e.name)).indexOf("main");return{defines:"",header:Qp(n.slice(0,i>=0?r[i].outer[0]:void 0)),main:i>=0?this.getShaderFromIndex(n,r[i].body):""}}getShaderFromIndex(e,t){return Qp(e.slice(t[0],t[1]))}}function mh(e){return"string"==typeof e?new t(e).convertLinearToSRGB():e}function vh(e){switch(e){case"alpha":return{min:0,max:1};case"scale":return{min:0};case"map":return{image:void 0};default:return{}}}function gh(e){return e instanceof h||e instanceof l||e instanceof z||e instanceof K||e instanceof m}function xh(e){return gh(e)?e.toArray():e instanceof t?"#"+e.clone().convertLinearToSRGB().getHexString():e instanceof I?e.image.src:e}const yh={normal:"normal",add:"add",subtract:"subtract",multiply:"multiply",lighten:"lighten",darken:"darken",divide:"divide",overlay:"overlay",screen:"screen",softlight:"softlight",negation:"negation",reflect:"reflect"},bh={perlin:"perlin",simplex:"simplex",cell:"cell",curl:"curl",white:"white"},_h={local:"local",world:"world",uv:"uv"},Lh={phong:te,physical:ne,toon:re,basic:V,lambert:ie,standard:ae};class Sh{constructor(e,n,r){this.uuid=ee.generateUUID().replace(/-/g,"_"),this.name="LayerMaterial",this.mode="normal",this.visible=!0;const i=Object.getOwnPropertyNames(e).filter((e=>e.startsWith("u_"))).reduce(((n,r)=>{var i;let a=null==(i=Object.getOwnPropertyDescriptor(e,r))?void 0:i.value;return(gh(a)||a instanceof t)&&(a=a.clone()),{...n,[r.slice(1)]:a}}),{});for(const t in i){const e=t.split("_")[1];void 0!==(null==n?void 0:n[e])&&(i[t]=n[e])}n&&Object.keys(n).map((e=>{void 0!==n[e]&&(this[e]=n[e])})),this.uniforms={},this.schema=[];const a={};Object.keys(i).map((e=>{const t=e.split("_")[1];this.uniforms[`u_${this.uuid}_${t}`]={value:mh(i[e])},this.schema.push({value:i[e],label:t}),a[t]={set:e=>{this.uniforms[`u_${this.uuid}_${t}`].value=mh(e)},get:()=>this.uniforms[`u_${this.uuid}_${t}`].value}})),null!=n&&n.name&&(this.name=n.name),null!=n&&n.mode&&(this.mode=n.mode),null!=n&&n.visible&&(this.visible=n.visible),Object.defineProperties(this,a),this.vertexShader="",this.fragmentShader="",this.vertexVariables="",this.fragmentVariables="",this.onParse=r,this.buildShaders(e),this.schema.push({value:this.mode,label:"mode",options:Object.values(yh)}),this.schema.push({value:this.visible,label:"visible"})}buildShaders(e){var t;const n=Object.getOwnPropertyNames(e).filter((e=>"fragmentShader"===e||"vertexShader"===e)).reduce(((t,n)=>{var r;return{...t,[n]:null==(r=Object.getOwnPropertyDescriptor(e,n))?void 0:r.value}}),{}),r={vert:Up(n.vertexShader||""),frag:Up(n.fragmentShader||"")},i={vert:Zp(r.vert,this.renameTokens.bind(this)),frag:Zp(r.frag,this.renameTokens.bind(this))},a={vert:Jp(i.vert),frag:Jp(i.frag)},o=a.vert.map((e=>e.name)).indexOf("main"),s=a.frag.map((e=>e.name)).indexOf("main"),l={vert:o>=0?Qp(i.vert.slice(0,a.vert[o].outer[0])):"",frag:s>=0?Qp(i.frag.slice(0,a.frag[s].outer[0])):""},c={vert:o>=0?this.getShaderFromIndex(i.vert,a.vert[o].body):"",frag:s>=0?this.getShaderFromIndex(i.frag,a.frag[s].body):""};this.vertexShader=this.processFinal(c.vert,!0),this.fragmentShader=this.processFinal(c.frag),this.vertexVariables=l.vert,this.fragmentVariables=l.frag,null==(t=this.onParse)||t.call(this,this),this.schema=this.schema.filter(((e,t)=>{const n=e.label;return t===this.schema.findIndex((e=>e.label===n))}))}renameTokens(e){if(e.startsWith("u_")){const t=e.slice(2);return`u_${this.uuid}_${t}`}if(e.startsWith("v_")){const t=e.slice(2);return`v_${this.uuid}_${t}`}if(e.startsWith("f_")){const t=e.slice(2);return`f_${this.uuid}_${t}`}return e}processFinal(e,t){const n=e.replace(/\sf_/gm,` f_${this.uuid}_`).replace(/\(f_/gm,`(f_${this.uuid}_`),r=n.match(/^.*return.*$/gm);let i=n.replace(/^.*return.*$/gm,"");if(null!=r&&r[0]){const e=r[0].replace("return","").trim().replace(";",""),n=this.getBlendMode(e,"lamina_finalColor");i+=t?`lamina_finalPosition = ${e};`:`lamina_finalColor = ${n};`}return i}getShaderFromIndex(e,t){return Qp(e.slice(t[0],t[1]))}getBlendMode(e,t){switch(this.mode){default:case"normal":return`lamina_blend_alpha(${t}, ${e}, ${e}.a)`;case"add":return`lamina_blend_add(${t}, ${e}, ${e}.a)`;case"subtract":return`lamina_blend_subtract(${t}, ${e}, ${e}.a)`;case"multiply":return`lamina_blend_multiply(${t}, ${e}, ${e}.a)`;case"lighten":return`lamina_blend_lighten(${t}, ${e}, ${e}.a)`;case"darken":return`lamina_blend_darken(${t}, ${e}, ${e}.a)`;case"divide":return`lamina_blend_divide(${t}, ${e}, ${e}.a)`;case"overlay":return`lamina_blend_overlay(${t}, ${e}, ${e}.a)`;case"screen":return`lamina_blend_screen(${t}, ${e}, ${e}.a)`;case"softlight":return`lamina_blend_softlight(${t}, ${e}, ${e}.a)`;case"reflect":return`lamina_blend_reflect(${t}, ${e}, ${e}.a)`;case"negation":return`lamina_blend_negation(${t}, ${e}, ${e}.a)`}}getSchema(){return this.schema.map((({label:e,options:t,...n})=>({label:e,options:t,...vh(e),...n,value:xh(this[e])})))}serialize(){const e=this.constructor.name.split("$")[0];let t=Object.keys(this);t=t.filter((e=>!["uuid","uniforms","schema","fragmentShader","vertexShader","fragmentVariables","vertexVariables","attribs","events","__r3f","onParse"].includes(e)));const n={};t.forEach((e=>{n[e]=this[e]}));const r={};for(const i in this.uniforms){r[i.replace(`u_${this.uuid}_`,"")]=xh(this.uniforms[i].value)}return{constructor:e,properties:{...r,...n}}}}class wh extends Sh{constructor(e){super(wh,{name:"Depth",...e},(e=>{e.schema.push({value:e.mapping,label:"mapping",options:["vector","world","camera"]});const t=wh.getMapping(e.uuid,e.mapping);e.fragmentShader=e.fragmentShader.replace("lamina_mapping_template",t)})),this.mapping="vector"}static getMapping(e,t){switch(t){default:case"vector":return`length(v_${e}_worldPosition - u_${e}_origin)`;case"world":return`length(v_${e}_position - vec3(0.))`;case"camera":return`length(v_${e}_worldPosition - cameraPosition)`}}}wh.u_near=2,wh.u_far=10,wh.u_origin=new h(0,0,0),wh.u_colorA="white",wh.u_colorB="black",wh.u_alpha=1,wh.vertexShader="\n  varying vec3 v_worldPosition;\n  varying vec3 v_position;\n\n  void main() {\n    v_worldPosition = (vec4(position, 1.0) * modelMatrix).xyz;\n    v_position = position;\n  }\n  ",wh.fragmentShader="   \n    uniform float u_alpha;\n    uniform float u_near;\n    uniform float u_far;\n    uniform float u_isVector;\n    uniform vec3 u_origin;\n    uniform vec3 u_colorA;\n    uniform vec3 u_colorB;\n\n    varying vec3 v_worldPosition;\n    varying vec3 v_position;\n\n    void main() {\n      float f_dist = lamina_mapping_template;\n      float f_depth = (f_dist - u_near) / (u_far - u_near);\n\t\t\tvec3 f_depthColor =  mix(u_colorB, u_colorA, 1.0 - clamp(f_depth, 0., 1.));\n  \n  \n      return vec4(f_depthColor, u_alpha);\n    }\n  ";class Mh extends Sh{constructor(e){super(Mh,{name:"Color",...e})}}Mh.u_color="red",Mh.u_alpha=1,Mh.fragmentShader="   \n    uniform vec3 u_color;\n    uniform float u_alpha;\n\n    void main() {\n      return vec4(u_color, u_alpha);\n    }\n  ";class Ah extends Sh{constructor(e){super(Ah,{name:"noise",...e},(e=>{e.schema.push({value:e.type,label:"type",options:Object.values(bh)}),e.schema.push({value:e.mapping,label:"mapping",options:Object.values(_h)});const t=Ah.getNoiseFunction(e.type),n=Ah.getMapping(e.mapping);e.vertexShader=e.vertexShader.replace("lamina_mapping_template",n),e.fragmentShader=e.fragmentShader.replace("lamina_noise_template",t)})),this.type="perlin",this.mapping="local"}static getNoiseFunction(e){switch(e){default:case"perlin":return"lamina_noise_perlin";case"simplex":return"lamina_noise_simplex";case"cell":return"lamina_noise_worley";case"white":return"lamina_noise_white";case"curl":return"lamina_noise_swirl"}}static getMapping(e){switch(e){default:case"local":return"position";case"world":return"(modelMatrix * vec4(position,1.0)).xyz";case"uv":return"vec3(uv, 0.)"}}}Ah.u_colorA="#666666",Ah.u_colorB="#666666",Ah.u_colorC="#FFFFFF",Ah.u_colorD="#FFFFFF",Ah.u_alpha=1,Ah.u_scale=1,Ah.u_offset=new h(0,0,0),Ah.vertexShader="\n    varying vec3 v_position;\n\n    void main() {\n        v_position = lamina_mapping_template;\n    }\n  ",Ah.fragmentShader="   \n    uniform vec3 u_colorA;\n    uniform vec3 u_colorB;\n    uniform vec3 u_colorC;\n    uniform vec3 u_colorD;\n    uniform vec3 u_offset;\n\n    uniform float u_alpha;\n    uniform float u_scale;\n\n    varying vec3 v_position;\n\n\n    void main() {\n        float f_n = lamina_noise_template((v_position + u_offset) * u_scale);\n\n        float f_step1 = 0.;\n        float f_step2 = 0.2;\n        float f_step3 = 0.6;\n        float f_step4 = 1.;\n\n        vec3 f_color = mix(u_colorA, u_colorB, smoothstep(f_step1, f_step2, f_n));\n        f_color = mix(f_color, u_colorC, smoothstep(f_step2, f_step3, f_n));\n        f_color = mix(f_color, u_colorD, smoothstep(f_step3, f_step4, f_n));\n\n        return vec4(f_color, u_alpha);\n    }\n  ";class Th extends Sh{constructor(e){super(Th,{name:"Fresnel",...e})}}Th.u_color="white",Th.u_alpha=1,Th.u_bias=0,Th.u_intensity=1,Th.u_power=2,Th.u_factor=1,Th.vertexShader="\n    varying vec3 v_worldPosition;\n    varying vec3 v_worldNormal;\n\n    void main() {\n        v_worldPosition = vec3(-viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2]);\n        v_worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\n        \n    }\n  ",Th.fragmentShader="   \n    uniform vec3 u_color;\n    uniform float u_alpha;\n    uniform float u_bias;\n    uniform float u_intensity;\n    uniform float u_power;\n    uniform float u_factor;\n\n    varying vec3 v_worldPosition;\n    varying vec3 v_worldNormal;\n\n    void main() {\n        float f_a = (u_factor  + dot(v_worldPosition, v_worldNormal));\n        float f_fresnel = u_bias + u_intensity * pow(abs(f_a), u_power);\n\n        f_fresnel = clamp(f_fresnel, 0.0, 1.0);\n        return vec4(f_fresnel * u_color, u_alpha);\n    }\n  ";class Eh extends Sh{constructor(e){super(Eh,{name:"Gradient",...e},(e=>{e.schema.push({value:e.axes,label:"axes",options:["x","y","z"]}),e.schema.push({value:e.mapping,label:"mapping",options:Object.values(_h)});const t=Eh.getMapping(e.mapping);e.vertexShader=e.vertexShader.replace("lamina_mapping_template",t||"local"),e.fragmentShader=e.fragmentShader.replace("axes_template",e.axes||"x")})),this.axes="x",this.mapping="local"}static getMapping(e){switch(e){default:case"local":return"position";case"world":return"(modelMatrix * vec4(position,1.0)).xyz";case"uv":return"vec3(uv, 0.)"}}}Eh.u_colorA="white",Eh.u_colorB="black",Eh.u_alpha=1,Eh.u_start=1,Eh.u_end=-1,Eh.u_contrast=1,Eh.vertexShader="\n\t\tvarying vec3 v_position;\n\n\t\tvod main() {\n      v_position = lamina_mapping_template;\n\t\t}\n  ",Eh.fragmentShader="   \n    uniform vec3 u_colorA;\n    uniform vec3 u_colorB;\n    uniform vec3 u_axis;\n    uniform float u_alpha;\n    uniform float u_start;\n    uniform float u_end;\n    uniform float u_contrast;\n\n\t\tvarying vec3 v_position;\n\n    void main() {\n\n      float f_step = smoothstep(u_start, u_end, v_position.axes_template * u_contrast);\n      vec3 f_color = mix(u_colorA, u_colorB, f_step);\n\n      return vec4(f_color, u_alpha);\n    }\n  ";class Ch extends Sh{constructor(e){super(Ch,{name:"Matcap",...e})}}Ch.u_alpha=1,Ch.u_map=void 0,Ch.vertexShader="\n    varying vec3 v_position;\n    varying vec3 v_normal;\n    \n    void main() {\n      v_position = normalize( vec3( modelViewMatrix * vec4( position, 1.0 ) ) );\n      v_normal = normalize( normalMatrix * normal );\n    }\n    ",Ch.fragmentShader=" \n\t\tuniform sampler2D u_map;  \n\t\tuniform float u_alpha;  \n\t\tvarying vec3 v_position;\n\t\tvarying vec3 v_normal;\n\n\t\t\n    void main() {\n\t\t\tvec3 f_r = reflect( v_position, v_normal );\n\t\t\tfloat f_m = 2. * sqrt( pow( f_r.x, 2. ) + pow( f_r.y, 2. ) + pow( f_r.z + 1., 2. ) );\n\t\t\tvec2 f_vN = f_r.xy / f_m + .5;\n\n\t\t\tvec3 f_base = texture2D(u_map, f_vN).rgb;\n\n      return vec4(f_base, u_alpha);\n    }\n  ";class Rh extends Sh{constructor(e){super(Rh,{name:"Texture",...e})}}Rh.u_alpha=1,Rh.u_map=void 0,Rh.vertexShader="\n    varying vec2 v_uv;\n    \n    void main() {\n        v_uv = uv;\n    }\n    ",Rh.fragmentShader=" \n\t\tuniform sampler2D u_map;  \n\t\tuniform float u_alpha;  \n\t\tvarying vec2 v_uv;\n\n    void main() {\n\t\t\tvec4 f_color = texture2D(u_map, v_uv);\n      return vec4(f_color.rgb, f_color.a * u_alpha);\n    }\n  ";class Ph extends Sh{constructor(e){super(Ph,{name:"Displace",...e},(e=>{e.schema.push({value:e.type,label:"type",options:Object.values(bh)}),e.schema.push({value:e.mapping,label:"mapping",options:Object.values(_h)});const t=Ph.getNoiseFunction(e.type),n=Ph.getMapping(e.mapping);e.vertexVariables=e.vertexVariables.replace("lamina_mapping_template",n),e.vertexVariables=e.vertexVariables.replace("lamina_noise_template",t)})),this.type="perlin",this.mapping="local"}static getNoiseFunction(e){switch(e){default:case"perlin":return"lamina_noise_perlin";case"simplex":return"lamina_noise_simplex";case"cell":return"lamina_noise_worley";case"white":return"lamina_noise_white";case"curl":return"lamina_noise_swirl"}}static getMapping(e){switch(e){default:case"local":return"p";case"world":return"(modelMatrix * vec4(p,1.0)).xyz";case"uv":return"vec3(uv, 0.)"}}}Ph.u_strength=1,Ph.u_scale=1,Ph.u_offset=new h(0,0,0),Ph.vertexShader="\n       \n      uniform float u_strength;\n      uniform float u_scale;\n      uniform vec3 u_offset;\n\n      vec3 displace(vec3 p) {\n\t\t\t\tvec3 f_position = lamina_mapping_template;\n        float f_n = lamina_noise_template((f_position + u_offset) * u_scale) * u_strength;\n        vec3 f_newPosition = p + (f_n * normal);\n\n\t\t\t\treturn f_newPosition;\n      }\n\n      \n\t\t\tvec3 orthogonal(vec3 v) {\n  \t\t  return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0)\n  \t\t  : vec3(0.0, -v.z, v.y));\n  \t\t}\n  \t\tvec3 recalcNormals(vec3 newPos) {\n  \t\t  float offset = 0.001;\n  \t\t  vec3 tangent = orthogonal(normal);\n  \t\t  vec3 bitangent = normalize(cross(normal, tangent));\n  \t\t  vec3 neighbour1 = position + tangent * offset;\n  \t\t  vec3 neighbour2 = position + bitangent * offset;\n  \t\t  vec3 displacedNeighbour1 = displace(neighbour1);\n  \t\t  vec3 displacedNeighbour2 = displace(neighbour2);\n  \t\t  vec3 displacedTangent = displacedNeighbour1 - newPos;\n  \t\t  vec3 displacedBitangent = displacedNeighbour2 - newPos;\n  \t\t  return normalize(cross(displacedTangent, displacedBitangent));\n  \t\t}\n  \n  \n      void main() {\n       \n\t\t\t\tvec3 f_newPosition = displace(position);\n        lamina_finalNormal = recalcNormals(f_newPosition);\n\n        return f_newPosition;\n      }\n    ";class Fh extends Sh{constructor(e){super(Fh,{name:"Normal",...e})}}Fh.u_alpha=1,Fh.u_direction=new h(1,1,1),Fh.vertexShader="   \n  varying vec3 v_normals; \n\n  void main() {\n    v_normals = normal;\n  }\n",Fh.fragmentShader="   \n  \tuniform float u_alpha;\n  \tuniform vec3 u_color;\n  \tuniform vec3 u_direction;\n\n\t\tvarying vec3 v_normals;\n\n    void main() {\n\t\t\tvec3 f_normalColor = vec3(1.);\n      f_normalColor.x = v_normals.x * u_direction.x;\n      f_normalColor.y = v_normals.y * u_direction.y;\n      f_normalColor.z = v_normals.z * u_direction.z;\n\n      return vec4(f_normalColor, u_alpha);\n    }\n  ";var Ih="\n\n// From: https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n// Huge thanks to the creators of these algorithms\n\nfloat lamina_noise_mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 lamina_noise_mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 lamina_noise_perm(vec4 x){return lamina_noise_mod289(((x * 34.0) + 1.0) * x);}\nvec4 lamina_noise_permute(vec4 x) { return mod(((x * 34.0) + 1.0) * x, 289.0); }\nvec4 lamina_noise_taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\n\n\nfloat lamina_noise_white(vec2 p) {\n  return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) *\n               (0.1 + abs(sin(p.y * 13.0 + p.x))));\n}\n\nfloat lamina_noise_white(vec3 p) {\n  return lamina_noise_white(p.xy);\n}\n\n\nvec3 lamina_noise_fade(vec3 t) { return t * t * t * (t * (t * 6.0 - 15.0) + 10.0); }\n\nfloat lamina_noise_perlin(vec3 P) {\n  vec3 Pi0 = floor(P);        // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec3 Pf0 = fract(P);        // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = lamina_noise_permute(lamina_noise_permute(ix) + iy);\n  vec4 ixy0 = lamina_noise_permute(ixy + iz0);\n  vec4 ixy1 = lamina_noise_permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 / 7.0;\n  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 / 7.0;\n  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);\n  vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);\n  vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);\n  vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);\n  vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);\n  vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);\n  vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);\n  vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);\n\n  vec4 norm0 = lamina_noise_taylorInvSqrt(\n      vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = lamina_noise_taylorInvSqrt(\n      vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = lamina_noise_fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111),\n                 fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n  return lamina_normalize(2.2 * n_xyz);\n}\n\nfloat lamina_noise_simplex(vec3 v) {\n  const vec2 C = vec2(1.0 / 6.0, 1.0 / 3.0);\n  const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\n  // First corner\n  vec3 i = floor(v + dot(v, C.yyy));\n  vec3 x0 = v - i + dot(i, C.xxx);\n\n  // Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min(g.xyz, l.zxy);\n  vec3 i2 = max(g.xyz, l.zxy);\n\n  //  x0 = x0 - 0. + 0.0 * C\n  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\n  // Permutations\n  i = mod(i, 289.0);\n  vec4 p = lamina_noise_permute(lamina_noise_permute(lamina_noise_permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y +\n                             vec4(0.0, i1.y, i2.y, 1.0)) +\n                    i.x + vec4(0.0, i1.x, i2.x, 1.0));\n\n  // Gradients\n  // ( N*N points uniformly over a square, mapped onto an octahedron.)\n  float n_ = 1.0 / 7.0; // N=7\n  vec3 ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z); //  mod(p,N*N)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_); // mod(j,N)\n\n  vec4 x = x_ * ns.x + ns.yyyy;\n  vec4 y = y_ * ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4(x.xy, y.xy);\n  vec4 b1 = vec4(x.zw, y.zw);\n\n  vec4 s0 = floor(b0) * 2.0 + 1.0;\n  vec4 s1 = floor(b1) * 2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;\n  vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;\n\n  vec3 p0 = vec3(a0.xy, h.x);\n  vec3 p1 = vec3(a0.zw, h.y);\n  vec3 p2 = vec3(a1.xy, h.z);\n  vec3 p3 = vec3(a1.zw, h.w);\n\n  // Normalise gradients\n  vec4 norm =\n      lamina_noise_taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n  // Mix final noise value\n  vec4 m =\n      max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);\n  m = m * m;\n  return lamina_normalize(42.0 *\n         dot(m * m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3))));\n}\n\nvec3 lamina_noise_simplex3(vec3 x) {\n  float s = lamina_noise_simplex(vec3(x));\n  float s1 = lamina_noise_simplex(vec3(x.y - 19.1, x.z + 33.4, x.x + 47.2));\n  float s2 = lamina_noise_simplex(vec3(x.z + 74.2, x.x - 124.5, x.y + 99.4));\n  vec3 c = vec3(s, s1, s2);\n  return c;\n}\n\nvec3 lamina_noise_curl(vec3 p) {\n  const float e = .1;\n  vec3 dx = vec3(e, 0.0, 0.0);\n  vec3 dy = vec3(0.0, e, 0.0);\n  vec3 dz = vec3(0.0, 0.0, e);\n\n  vec3 p_x0 = lamina_noise_simplex3(p - dx);\n  vec3 p_x1 = lamina_noise_simplex3(p + dx);\n  vec3 p_y0 = lamina_noise_simplex3(p - dy);\n  vec3 p_y1 = lamina_noise_simplex3(p + dy);\n  vec3 p_z0 = lamina_noise_simplex3(p - dz);\n  vec3 p_z1 = lamina_noise_simplex3(p + dz);\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / (2.0 * e);\n  return normalize(vec3(x, y, z) * divisor);\n}\n\nvec3 lamina_permute(vec3 x) {\n  return mod((34.0 * x + 1.0) * x, 289.0);\n}\n\nvec3 lamina_dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance) {\n  return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\n}\n\n// From: https://github.com/Erkaman/glsl-worley\nfloat lamina_noise_worley(vec3 P) {\n  float jitter = 1.;\n  bool manhattanDistance = false; \n\n  float K = 0.142857142857; // 1/7\n  float Ko = 0.428571428571; // 1/2-K/2\n  float  K2 = 0.020408163265306; // 1/(7*7)\n  float Kz = 0.166666666667; // 1/6\n  float Kzo = 0.416666666667; // 1/2-1/6*2\n\n\tvec3 Pi = mod(floor(P), 289.0);\n \tvec3 Pf = fract(P) - 0.5;\n\n\tvec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\n\tvec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\n\tvec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\n\n\tvec3 p = lamina_permute(Pi.x + vec3(-1.0, 0.0, 1.0));\n\tvec3 p1 = lamina_permute(p + Pi.y - 1.0);\n\tvec3 p2 = lamina_permute(p + Pi.y);\n\tvec3 p3 = lamina_permute(p + Pi.y + 1.0);\n\n\tvec3 p11 = lamina_permute(p1 + Pi.z - 1.0);\n\tvec3 p12 = lamina_permute(p1 + Pi.z);\n\tvec3 p13 = lamina_permute(p1 + Pi.z + 1.0);\n\n\tvec3 p21 = lamina_permute(p2 + Pi.z - 1.0);\n\tvec3 p22 = lamina_permute(p2 + Pi.z);\n\tvec3 p23 = lamina_permute(p2 + Pi.z + 1.0);\n\n\tvec3 p31 = lamina_permute(p3 + Pi.z - 1.0);\n\tvec3 p32 = lamina_permute(p3 + Pi.z);\n\tvec3 p33 = lamina_permute(p3 + Pi.z + 1.0);\n\n\tvec3 ox11 = fract(p11*K) - Ko;\n\tvec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\n\tvec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\n\n\tvec3 ox12 = fract(p12*K) - Ko;\n\tvec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\n\tvec3 oz12 = floor(p12*K2)*Kz - Kzo;\n\n\tvec3 ox13 = fract(p13*K) - Ko;\n\tvec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\n\tvec3 oz13 = floor(p13*K2)*Kz - Kzo;\n\n\tvec3 ox21 = fract(p21*K) - Ko;\n\tvec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\n\tvec3 oz21 = floor(p21*K2)*Kz - Kzo;\n\n\tvec3 ox22 = fract(p22*K) - Ko;\n\tvec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\n\tvec3 oz22 = floor(p22*K2)*Kz - Kzo;\n\n\tvec3 ox23 = fract(p23*K) - Ko;\n\tvec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\n\tvec3 oz23 = floor(p23*K2)*Kz - Kzo;\n\n\tvec3 ox31 = fract(p31*K) - Ko;\n\tvec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\n\tvec3 oz31 = floor(p31*K2)*Kz - Kzo;\n\n\tvec3 ox32 = fract(p32*K) - Ko;\n\tvec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\n\tvec3 oz32 = floor(p32*K2)*Kz - Kzo;\n\n\tvec3 ox33 = fract(p33*K) - Ko;\n\tvec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\n\tvec3 oz33 = floor(p33*K2)*Kz - Kzo;\n\n\tvec3 dx11 = Pfx + jitter*ox11;\n\tvec3 dy11 = Pfy.x + jitter*oy11;\n\tvec3 dz11 = Pfz.x + jitter*oz11;\n\n\tvec3 dx12 = Pfx + jitter*ox12;\n\tvec3 dy12 = Pfy.x + jitter*oy12;\n\tvec3 dz12 = Pfz.y + jitter*oz12;\n\n\tvec3 dx13 = Pfx + jitter*ox13;\n\tvec3 dy13 = Pfy.x + jitter*oy13;\n\tvec3 dz13 = Pfz.z + jitter*oz13;\n\n\tvec3 dx21 = Pfx + jitter*ox21;\n\tvec3 dy21 = Pfy.y + jitter*oy21;\n\tvec3 dz21 = Pfz.x + jitter*oz21;\n\n\tvec3 dx22 = Pfx + jitter*ox22;\n\tvec3 dy22 = Pfy.y + jitter*oy22;\n\tvec3 dz22 = Pfz.y + jitter*oz22;\n\n\tvec3 dx23 = Pfx + jitter*ox23;\n\tvec3 dy23 = Pfy.y + jitter*oy23;\n\tvec3 dz23 = Pfz.z + jitter*oz23;\n\n\tvec3 dx31 = Pfx + jitter*ox31;\n\tvec3 dy31 = Pfy.z + jitter*oy31;\n\tvec3 dz31 = Pfz.x + jitter*oz31;\n\n\tvec3 dx32 = Pfx + jitter*ox32;\n\tvec3 dy32 = Pfy.z + jitter*oy32;\n\tvec3 dz32 = Pfz.y + jitter*oz32;\n\n\tvec3 dx33 = Pfx + jitter*ox33;\n\tvec3 dy33 = Pfy.z + jitter*oy33;\n\tvec3 dz33 = Pfz.z + jitter*oz33;\n\n\tvec3 d11 = lamina_dist(dx11, dy11, dz11, manhattanDistance);\n\tvec3 d12 = lamina_dist(dx12, dy12, dz12, manhattanDistance);\n\tvec3 d13 = lamina_dist(dx13, dy13, dz13, manhattanDistance);\n\tvec3 d21 = lamina_dist(dx21, dy21, dz21, manhattanDistance);\n\tvec3 d22 = lamina_dist(dx22, dy22, dz22, manhattanDistance);\n\tvec3 d23 = lamina_dist(dx23, dy23, dz23, manhattanDistance);\n\tvec3 d31 = lamina_dist(dx31, dy31, dz31, manhattanDistance);\n\tvec3 d32 = lamina_dist(dx32, dy32, dz32, manhattanDistance);\n\tvec3 d33 = lamina_dist(dx33, dy33, dz33, manhattanDistance);\n\n\tvec3 d1a = min(d11, d12);\n\td12 = max(d11, d12);\n\td11 = min(d1a, d13); // Smallest now not in d12 or d13\n\td13 = max(d1a, d13);\n\td12 = min(d12, d13); // 2nd smallest now not in d13\n\tvec3 d2a = min(d21, d22);\n\td22 = max(d21, d22);\n\td21 = min(d2a, d23); // Smallest now not in d22 or d23\n\td23 = max(d2a, d23);\n\td22 = min(d22, d23); // 2nd smallest now not in d23\n\tvec3 d3a = min(d31, d32);\n\td32 = max(d31, d32);\n\td31 = min(d3a, d33); // Smallest now not in d32 or d33\n\td33 = max(d3a, d33);\n\td32 = min(d32, d33); // 2nd smallest now not in d33\n\tvec3 da = min(d11, d21);\n\td21 = max(d11, d21);\n\td11 = min(da, d31); // Smallest now in d11\n\td31 = max(da, d31); // 2nd smallest now not in d31\n\td11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\n\td11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\n\td12 = min(d12, d21); // 2nd smallest now not in d21\n\td12 = min(d12, d22); // nor in d22\n\td12 = min(d12, d31); // nor in d31\n\td12 = min(d12, d32); // nor in d32\n\td11.yz = min(d11.yz,d12.xy); // nor in d12.yz\n\td11.y = min(d11.y,d12.z); // Only two more to go\n\td11.y = min(d11.y,d11.z); // Done! (Phew!)\n\n  vec2 F = sqrt(d11.xy);\n\treturn F.x; // F1, F2\n\n}\n\nfloat lamina_noise_swirl(vec3 position) {\n    float scale = 0.1;\n    float freq = 4. * scale;\n    float t = 1.;\n\n    vec3 pos = (position * scale) + lamina_noise_curl(position * 7. * scale);\n\n    float worley1 = 1. - lamina_noise_worley((pos * (freq * 2.)) +  (t * 2.));\n    float worley2 = 1. - lamina_noise_worley((pos * (freq * 4.)) +  (t * 4.));\n    float worley3 = 1. - lamina_noise_worley((pos * (freq * 8.)) +  (t * 8.));\n    float worley4 = 1. - lamina_noise_worley((pos * (freq * 16.)) +  (t * 16.));\n    \n    float fbm1 = worley1 * .625 + worley2 * .25 + worley3 * .125;\n    float fbm2 = worley2 * .625 + worley3 * .25 + worley4 * .125;\n    float fbm3 = worley3 * .75 + worley4 * .25;\n\n    vec3 curlWorleyFbm = vec3(fbm1, fbm2, fbm3);\n    float curlWorley = curlWorleyFbm.r * .625 + curlWorleyFbm.g * .25 + \n        curlWorleyFbm.b * .125;\n\n    return curlWorley;\n}\n  \n  \n",Nh="\n\nfloat lamina_map(float value, float min1, float max1, float min2, float max2) {\n  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n}\n\nfloat lamina_normalize(float v) { return lamina_map(v, -1.0, 1.0, 0.0, 1.0); }\n";class Uh extends hh{constructor({color:e,alpha:n,lighting:r,layers:i,name:a,...o}={}){super({baseMaterial:Lh[r||"basic"],...o}),this.name="LayerMaterial",this.layers=[],this.lighting="basic";const s=e||"white",l=null!=n?n:1;this.uniforms={u_lamina_color:{value:"string"==typeof s?new t(s).convertSRGBToLinear():s},u_lamina_alpha:{value:l}},this.layers=i||this.layers,this.lighting=r||this.lighting,this.name=a||this.name,this.refresh()}genShaders(){let e="",t="",n="",r="",i={};return this.layers.filter((e=>e.visible)).forEach((a=>{e+=a.vertexVariables+"\n",t+=a.fragmentVariables+"\n",n+=a.vertexShader+"\n",r+=a.fragmentShader+"\n",i={...i,...a.uniforms}})),i={...i,...this.uniforms},{uniforms:i,vertexShader:`\n        ${Nh}\n        ${Ih}\n        ${e}\n\n        void main() {\n          vec3 lamina_finalPosition = position;\n          vec3 lamina_finalNormal = normal;\n\n          ${n}\n\n          csm_Position = lamina_finalPosition;\n          csm_Normal = lamina_finalNormal;\n        }\n        `,fragmentShader:`\n        ${Nh}\n        ${Ih}\n        \nvec4 lamina_blend_add(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\treturn vec4(min(x.xyz + y.xyz, 1.0) * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nvec3 lamina_blend_alpha(const in vec3 x, const in vec3 y, const in float opacity) {\n\n\treturn y * opacity + x * (1.0 - opacity);\n\n}\n\nvec4 lamina_blend_alpha(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\tfloat a = min(y.a, opacity);\n\n\treturn vec4(lamina_blend_alpha(x.rgb, y.rgb, a), x.a);\n\n}\nvec4 lamina_blend_average(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\treturn vec4((x.xyz + y.xyz) * 0.5 * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nfloat lamina_blend_color_burn(const in float x, const in float y) {\n\n\treturn (y == 0.0) ? y : max(1.0 - (1.0 - x) / y, 0.0);\n\n}\n\nvec4 lamina_blend_color_burn(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\tvec4 z = vec4(\n\t\tlamina_blend_color_burn(x.r, y.r),\n\t\tlamina_blend_color_burn(x.g, y.g),\n\t\tlamina_blend_color_burn(x.b, y.b),\n\t\tlamina_blend_color_burn(x.a, y.a)\n\t);\n\n\treturn vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nfloat lamina_blend_color_dodge(const in float x, const in float y) {\n\n\treturn (y == 1.0) ? y : min(x / (1.0 - y), 1.0);\n\n}\n\nvec4 lamina_blend_color_dodge(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\tvec4 z = vec4(\n\t\tlamina_blend_color_dodge(x.r, y.r),\n\t\tlamina_blend_color_dodge(x.g, y.g),\n\t\tlamina_blend_color_dodge(x.b, y.b),\n\t\tlamina_blend_color_dodge(x.a, y.a)\n\t);\n\n\treturn vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nvec4 lamina_blend_darken(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\treturn vec4(min(x.xyz, y.xyz) * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nvec4 lamina_blend_difference(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\treturn vec4(abs(x.xyz - y.xyz) * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nfloat lamina_blend_divide(const in float x, const in float y) {\n\n\treturn (y > 0.0) ? min(x / y, 1.0) : 1.0;\n\n}\n\nvec4 lamina_blend_divide(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\tvec4 z = vec4(\n\t\tlamina_blend_divide(x.r, y.r),\n\t\tlamina_blend_divide(x.g, y.g),\n\t\tlamina_blend_divide(x.b, y.b),\n\t\tlamina_blend_divide(x.a, y.a)\n\t);\n\n\treturn vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nvec4 lamina_blend_exclusion(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\treturn vec4((x.xyz + y.xyz - 2.0 * x.xyz * y.xyz) * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nvec4 lamina_blend_lighten(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\treturn vec4(max(x.xyz, y.xyz) * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nvec4 lamina_blend_multiply(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\treturn vec4( x.xyz * y.xyz * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nvec4 lamina_blend_negation(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\treturn vec4((1.0 - abs(1.0 - x.xyz - y.xyz)) * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nvec4 lamina_blend_normal(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\treturn vec4(y.xyz * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nfloat lamina_blend_overlay(const in float x, const in float y) {\n\n\treturn (x < 0.5) ? (2.0 * x * y) : (1.0 - 2.0 * (1.0 - x) * (1.0 - y));\n\n}\n\nvec4 lamina_blend_overlay(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\tvec4 z = vec4(\n\t\tlamina_blend_overlay(x.r, y.r),\n\t\tlamina_blend_overlay(x.g, y.g),\n\t\tlamina_blend_overlay(x.b, y.b),\n\t\tlamina_blend_overlay(x.a, y.a)\n\t);\n\n\treturn vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nfloat lamina_blend_reflect(const in float x, const in float y) {\n\n\treturn (y == 1.0) ? y : min(x * x / (1.0 - y), 1.0);\n\n}\n\nvec4 lamina_blend_reflect(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\tvec4 z = vec4(\n\t\tlamina_blend_reflect(x.r, y.r),\n\t\tlamina_blend_reflect(x.g, y.g),\n\t\tlamina_blend_reflect(x.b, y.b),\n\t\tlamina_blend_reflect(x.a, y.a)\n\t);\n\n\treturn vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nvec4 lamina_blend_screen(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\treturn vec4((1.0 - (1.0 - x.xyz) * (1.0 - y.xyz)) * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nfloat lamina_blend_softlight(const in float x, const in float y) {\n\n\treturn (y < 0.5) ?\n\t\t(2.0 * x * y + x * x * (1.0 - 2.0 * y)) :\n\t\t(sqrt(x) * (2.0 * y - 1.0) + 2.0 * x * (1.0 - y));\n\n}\n\nvec4 lamina_blend_softlight(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\tvec4 z = vec4(\n\t\tlamina_blend_softlight(x.r, y.r),\n\t\tlamina_blend_softlight(x.g, y.g),\n\t\tlamina_blend_softlight(x.b, y.b),\n\t\tlamina_blend_softlight(x.a, y.a)\n\t);\n\n\treturn vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\nvec4 lamina_blend_subtract(const in vec4 x, const in vec4 y, const in float opacity) {\n\n\treturn vec4(max(x.xyz + y.xyz - 1.0, 0.0) * opacity + x.xyz * (1.0 - opacity), x.a);\n\n}\n\n\n        ${t}\n\n        uniform vec3 u_lamina_color;\n        uniform float u_lamina_alpha;\n\n        void main() {\n          vec4 lamina_finalColor = vec4(u_lamina_color, u_lamina_alpha);\n\n          ${r}\n\n          csm_DiffuseColor = lamina_finalColor;\n         \n        }\n        `}}refresh(){const{uniforms:e,fragmentShader:t,vertexShader:n}=this.genShaders();super.update({fragmentShader:t,vertexShader:n,uniforms:e})}serialize(){return{constructor:"LayerMaterial",properties:{color:this.color,alpha:this.alpha,name:this.name,lighting:this.lighting}}}set color(e){var n,r;null!=(n=this.uniforms)&&null!=(r=n.u_lamina_color)&&r.value&&(this.uniforms.u_lamina_color.value="string"==typeof e?new t(e).convertSRGBToLinear():e)}get color(){var e,t;return null==(e=this.uniforms)||null==(t=e.u_lamina_color)?void 0:t.value}set alpha(e){this.uniforms.u_lamina_alpha.value=e}get alpha(){return this.uniforms.u_lamina_alpha.value}}Re({LayerMaterial:Uh}),Re({LayerMaterial:Uh,Depth_:wh,Color_:Mh,Noise_:Ah,Fresnel_:Th,Gradient_:Eh,Matcap_:Ch,Texture_:Rh,Displace_:Ph,Normal_:Fh});const zh=ye.forwardRef((({children:e,...t},n)=>{const r=ye.useRef(null);ve.useImperativeHandle(n,(()=>r.current)),ye.useLayoutEffect((()=>{r.current.layers=r.current.__r3f.objects,r.current.refresh()}),[e]);const[i,a]=ve.useMemo((()=>function({color:e,alpha:t,lighting:n,name:r,...i}={}){return[{color:e,alpha:t,lighting:n,name:r},i]}(t)),[t]);return ye.createElement("layerMaterial",ge({args:[i],ref:r},a),e)}));function Gh(e){return[{mode:null==e?void 0:e.mode,visible:null==e?void 0:e.visible,type:null==e?void 0:e.type,mapping:null==e?void 0:e.mapping,map:null==e?void 0:e.map,axes:null==e?void 0:e.axes}]}const Bh=ye.forwardRef(((e,t)=>ye.createElement("depth_",ge({args:Gh(e),ref:t},e)))),Dh=ye.forwardRef(((e,t)=>ye.createElement("fresnel_",ge({ref:t,args:Gh(e)},e)))),kh=ye.forwardRef(((e,t)=>ye.createElement("displace_",ge({ref:t,args:Gh(e)},e)))),Oh=e=>{let t;const n=new Set,r=(e,r)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=r?r:"object"!=typeof i)?i:Object.assign({},t,i),n.forEach((n=>n(t,e)))}},i=()=>t,a={setState:r,getState:i,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(r,i,a),a},{useSyncExternalStoreWithSelector:jh}=Le;const Vh=e=>{const t="function"==typeof e?(e=>e?Oh(e):Oh)(e):e,n=(e,n)=>function(e,t=e.getState,n){const r=jh(e.subscribe,e.getState,e.getServerState||e.getState,t,n);return ve.useDebugValue(r),r}(t,e,n);return Object.assign(n,t),n};function Hh(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,r]of e)if(!Object.is(r,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(let r=0;r<n.length;r++)if(!Object.prototype.hasOwnProperty.call(t,n[r])||!Object.is(e[n[r]],t[n[r]]))return!1;return!0}const Xh=(Wh=(e,t)=>({log:null,paused:!1,triggerProgramsUpdate:0,startTime:0,customData:0,fpsLimit:60,overclockingFps:!1,accumulated:{totalFrames:0,gl:{calls:0,triangles:0,points:0,lines:0,counts:0},log:{gpu:0,cpu:0,mem:0,fps:0},max:{gl:{calls:0,triangles:0,points:0,lines:0,counts:0},log:{gpu:0,cpu:0,mem:0,fps:0}}},chart:{data:{fps:[],cpu:[],gpu:[],mem:[]},circularId:0},gl:void 0,objectWithMaterials:null,scene:void 0,programs:new Map,sceneLength:void 0,tab:"infos",getReport:function(){var e;const{accumulated:n,startTime:r,infos:i}=t(),a=null==(e=t().log)?void 0:e.maxMemory,{totalFrames:o,log:s,gl:l,max:c}=n,u={calls:l.calls/o,triangles:l.triangles/o,points:l.points/o,lines:l.lines/o},d={gpu:s.gpu/o,cpu:s.cpu/o,mem:s.mem/o,fps:s.fps/o};return{sessionTime:(window.performance.now()-r)/1e3,infos:i,log:d,gl:u,max:c,maxMemory:a,totalFrames:o}}}))?Vh(Wh):Vh;var Wh;const Yh=e=>Xh(e,Hh);Object.assign(Yh,Xh);const{getState:$h,setState:Zh}=Xh,Qh={value:0,fpsLimit:60,isOverLimit:0},Kh=e=>(null==e?void 0:e.reduce(((e,t)=>e+t),0))/e.length;class qh{constructor(e={}){this.names=[""],this.finished=[],this.paused=!1,this.overClock=!1,this.queryHasResult=!1,this.queryCreated=!1,this.isWebGL2=!0,this.memAccums=[],this.gpuAccums=[],this.activeAccums=[],this.logsAccums={mem:[],gpu:[],cpu:[],fps:[],fpsFixed:[]},this.fpsChart=[],this.gpuChart=[],this.cpuChart=[],this.memChart=[],this.paramLogger=()=>{},this.glFinish=()=>{},this.chartLogger=()=>{},this.chartLen=60,this.logsPerSecond=10,this.maxMemory=1500,this.chartHz=10,this.startCpuProfiling=!1,this.lastCalculateFixed=0,this.chartFrame=0,this.gpuTimeProcess=0,this.chartTime=0,this.activeQueries=0,this.circularId=0,this.detected=0,this.frameId=0,this.rafId=0,this.idleCbId=0,this.checkQueryId=0,this.uuid=void 0,this.currentCpu=0,this.currentMem=0,this.paramFrame=0,this.paramTime=0,this.now=()=>{},this.t0=0,window.GLPerf=window.GLPerf||{},Object.assign(this,e),this.fpsChart=new Array(this.chartLen).fill(0),this.gpuChart=new Array(this.chartLen).fill(0),this.cpuChart=new Array(this.chartLen).fill(0),this.memChart=new Array(this.chartLen).fill(0),this.now=()=>window.performance&&window.performance.now?window.performance.now():Date.now(),this.initGpu(),this.is120hz()}initGpu(){this.uuid=ee.generateUUID(),this.gl&&(this.isWebGL2=!0,this.extension||(this.extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")),null===this.extension&&(this.isWebGL2=!1))}is120hz(){let e=0;const t=n=>{++e<20?this.rafId=window.requestAnimationFrame(t):(this.detected=Math.ceil(1e3*e/(n-this.t0)/70),window.cancelAnimationFrame(this.rafId)),this.t0||(this.t0=n)};this.rafId=window.requestAnimationFrame(t)}addUI(e){-1===this.names.indexOf(e)&&(this.names.push(e),this.gpuAccums.push(0),this.activeAccums.push(!1))}nextFps(e){const t=1e3/60,n=t-e.timeRemaining(),r=t*Qh.fpsLimit/10/n;r<0||(Qh.value=r,Qh.isOverLimit<25?Qh.isOverLimit++:Zh({overclockingFps:!0}))}nextFrame(e){this.frameId++;const t=e||this.now();let n=t-this.paramTime,r=0;if(this.frameId<=1)this.paramFrame=this.frameId,this.paramTime=t;else if(t>=this.paramTime){this.maxMemory=window.performance.memory?window.performance.memory.jsHeapSizeLimit/1048576:0;const i=this.frameId-this.paramFrame,a=1e3*i/n,o=$h().overclockingFps?Qh.value:a;if(r=this.isWebGL2?this.gpuAccums[0]:this.gpuAccums[0]/n,this.isWebGL2?this.gpuAccums[0]=0:Promise.all(this.finished).then((()=>{this.gpuAccums[0]=0,this.finished=[]})),this.currentMem=Math.round(window.performance&&window.performance.memory?window.performance.memory.usedJSHeapSize/1048576:0),window.performance&&this.startCpuProfiling){window.performance.mark("cpu-finished");const e=performance.measure("cpu-duration","cpu-started","cpu-finished");this.currentCpu=e.duration,this.logsAccums.cpu.push(this.currentCpu),this.startCpuProfiling=!1}this.logsAccums.mem.push(this.currentMem),this.logsAccums.fpsFixed.push(a),this.logsAccums.fps.push(o),this.logsAccums.gpu.push(r),this.overClock&&void 0!==window.requestIdleCallback&&(Qh.isOverLimit>0&&o>a?Qh.isOverLimit--:$h().overclockingFps&&Zh({overclockingFps:!1})),t>=this.paramTime+1e3/this.logsPerSecond&&(this.paramLogger({cpu:Kh(this.logsAccums.cpu),gpu:Kh(this.logsAccums.gpu),mem:Kh(this.logsAccums.mem),fps:Kh(this.logsAccums.fps),duration:Math.round(n),maxMemory:this.maxMemory,frameCount:i}),this.logsAccums.mem=[],this.logsAccums.fps=[],this.logsAccums.gpu=[],this.logsAccums.cpu=[],this.paramFrame=this.frameId,this.paramTime=t),this.overClock&&t-this.lastCalculateFixed>=2e3&&(this.lastCalculateFixed=e,Qh.fpsLimit=100*Math.round(Kh(this.logsAccums.fpsFixed)/10),Zh({fpsLimit:Qh.fpsLimit/10}),this.logsAccums.fpsFixed=[],this.paramFrame=this.frameId,this.paramTime=t)}if(this.detected&&this.chartFrame){const e=t-this.chartTime;let r=this.chartHz*e/1e3;for(;--r>0&&this.detected;){const r=(this.frameId-this.chartFrame)/e*1e3,i=$h().overclockingFps?Qh.value:r;this.fpsChart[this.circularId%this.chartLen]=i;const a=1e3/this.currentMem,o=this.currentCpu,s=(this.isWebGL2?2*this.gpuAccums[1]:Math.round(this.gpuAccums[1]/n*100))+4;s>0&&(this.gpuChart[this.circularId%this.chartLen]=s),o>0&&(this.cpuChart[this.circularId%this.chartLen]=o),a>0&&(this.memChart[this.circularId%this.chartLen]=a);for(let e=0;e<this.names.length;e++)this.chartLogger({i:e,data:{fps:this.fpsChart,gpu:this.gpuChart,cpu:this.cpuChart,mem:this.memChart},circularId:this.circularId});this.circularId++,this.chartFrame=this.frameId,this.chartTime=t}}else this.chartFrame=this.frameId,this.chartTime=t,this.circularId=0}startGpu(){const e=this.gl,t=this.extension;if(e&&t&&this.isWebGL2){let n,r,i=!1;if(this.query){this.queryHasResult=!1;let a=this.query;if(i=e.getQueryParameter(a,e.QUERY_RESULT_AVAILABLE),n=e.getParameter(t.GPU_DISJOINT_EXT),i&&!n){r=e.getQueryParameter(this.query,e.QUERY_RESULT);const t=1e-6*r;(i||n)&&(e.deleteQuery(this.query),a=null),i&&t>0&&(n||this.activeAccums.forEach(((e,n)=>{this.gpuAccums[n]=t})))}}!i&&this.query||(this.queryCreated=!0,this.query=e.createQuery(),e.beginQuery(t.TIME_ELAPSED_EXT,this.query))}}endGpu(){const e=this.extension,t=this.gl;this.isWebGL2&&this.queryCreated&&t.getQuery(e.TIME_ELAPSED_EXT,t.CURRENT_QUERY)&&t.endQuery(e.TIME_ELAPSED_EXT)}begin(e){this.startGpu(),this.updateAccums(e)}end(e){this.endGpu(),this.updateAccums(e)}updateAccums(e){let t=this.names.indexOf(e);-1===t&&(t=this.names.length,this.addUI(e));const n=this.now();this.activeAccums[t]=!this.activeAccums[t],this.t0=n}}var Jh={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,a||e,o),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=new Array(a);i<a;i++)o[i]=r[i].fn;return o},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,a,o){var s=n?n+e:e;if(!this._events[s])return!1;var l,c,u=this._events[s],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,a),!0;case 6:return u.fn.call(u.context,t,r,i,a,o),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var f,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!l)for(f=1,l=new Array(d-1);f<d;f++)l[f-1]=arguments[f];u[c].fn.apply(u[c].context,l)}}return!0},s.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||o(this,a);else{for(var l=0,c=[],u=s.length;l<u;l++)(s[l].fn!==t||i&&!s[l].once||r&&s[l].context!==r)&&c.push(s[l]);c.length?this._events[a]=1===c.length?c[0]:c:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(Jh);const em=new(_e(Jh.exports));function tm(e,t,n=[],r){const i=ve.useRef(t);ve.useEffect((()=>{i.current=t}),[t]),ve.useEffect((()=>{const t=e=>{var t;return null==(t=i.current)?void 0:t.call(i,e)},n=function(e,t,n){return(null==n?void 0:n.once)?em.once(e,t):em.on(e,t)}(e,t,r);return()=>function(e,t,n){var r;em.removeListener(e,t,null!=(r=null==n?void 0:n.context)?r:null,null==n?void 0:n.once)}(e,t,{...r,context:n})}),[e,null==r?void 0:r.once,...n])}const nm=oe.prototype.updateMatrixWorld,rm=oe.prototype.updateWorldMatrix,im=oe.prototype.updateMatrix,am=["calls","triangles","points","lines"],om=["gpu","cpu","mem","fps"];let sm={value:0},lm={value:0};const cm=(e,t)=>{e.defines||(e.defines={}),e.defines&&!e.defines.muiPerf&&(e.defines=Object.assign(e.defines||{},{muiPerf:e.uuid}));const n=e.uuid;return t[n]||(t[n]={meshes:{},material:e},e.needsUpdate=!0),e.needsUpdate=!1,n},um=e=>"muiPerf"===e,dm=({overClock:e,logsPerSecond:t,chart:n,deepAnalyze:r,matrixUpdate:i})=>{const{gl:a,scene:o}=Ee();Zh({gl:a,scene:o});const s=ve.useMemo((()=>{const r=new qh({trackGPU:!0,overClock:e,chartLen:n?n.length:120,chartHz:n?n.hz:60,logsPerSecond:t||10,gl:a.getContext(),chartLogger:e=>{Zh({chart:e})},paramLogger:e=>{const t={maxMemory:e.maxMemory,gpu:e.gpu,cpu:e.cpu,mem:e.mem,fps:e.fps,totalTime:e.duration,frameCount:e.frameCount};Zh({log:t});const{accumulated:n}=$h(),r=a.info.render;n.totalFrames++,n.gl.calls+=r.calls,n.gl.triangles+=r.triangles,n.gl.points+=r.points,n.gl.lines+=r.lines,n.log.gpu+=e.gpu,n.log.cpu+=e.cpu,n.log.mem+=e.mem,n.log.fps+=e.fps;for(let a=0;a<am.length;a++){const e=am[a],t=r[e];t>n.max.gl[e]&&(n.max.gl[e]=t)}for(let a=0;a<om.length;a++){const t=om[a],r=e[t];r>n.max.log[t]&&(n.max.log[t]=r)}var i,o;Zh({accumulated:n}),i="log",o=[t,a],em.emit(i,o)}}),i=a.getContext();let o=null,s=null;const l=i.getExtension("WEBGL_debug_renderer_info"),c=i.getParameter(i.VERSION);null!=l&&(o=i.getParameter(l.UNMASKED_RENDERER_WEBGL),s=i.getParameter(l.UNMASKED_VENDOR_WEBGL)),s||(s="Unknown vendor"),o||(o=i.getParameter(i.RENDERER)),Zh({startTime:window.performance.now(),infos:{version:c,renderer:o,vendor:s}});const u=new Map,d=new Map;return Object.defineProperty(b.prototype,"onBeforeRender",{get(){return(...e)=>{var t;r&&r.begin("profiler"),null==(t=u.get(this))||t(...e)}},set(e){u.set(this,e)},configurable:!0}),Object.defineProperty(b.prototype,"onAfterRender",{get(){return(...e)=>{var t;r&&r.end("profiler"),null==(t=d.get(this))||t(...e)}},set(e){d.set(this,e)},configurable:!0}),r}),[]);return ve.useEffect((()=>{s&&(s.overClock=e||!1,!1===e&&(Zh({overclockingFps:!1}),Qh.value=0,Qh.isOverLimit=0),s.chartHz=(null==n?void 0:n.hz)||60,s.chartLen=(null==n?void 0:n.length)||120)}),[e,s,null==n?void 0:n.length,null==n?void 0:n.hz]),ve.useEffect((()=>{i&&(oe.prototype.updateMatrixWorld=function(){(this.matrixWorldNeedsUpdate||arguments[0])&&sm.value++,nm.apply(this,arguments)},oe.prototype.updateWorldMatrix=function(){sm.value++,rm.apply(this,arguments)},oe.prototype.updateMatrix=function(){lm.value++,im.apply(this,arguments)}),a.info.autoReset=!1;let t=null,n=null;if(a.info)return t=Pe((function(){$h().paused&&Zh({paused:!1}),window.performance&&(window.performance.mark("cpu-started"),s.startCpuProfiling=!0),lm.value-=1,sm.value=0,lm.value=0,a.info&&a.info.reset()})),n=Fe((function(){var t,n;if(s&&!s.paused&&(s.nextFrame(window.performance.now()),e&&void 0!==window.requestIdleCallback&&(s.idleCbId=requestIdleCallback(s.nextFps))),r){const e={},r=new Map;o.traverse((function(t){if((t instanceof _||t instanceof se)&&t.material){let n=t.material.uuid;const r=Array.isArray(t.material)&&t.material.length>1;n=cm(r?t.material[1]:t.material,e),e[n].meshes[t.uuid]=t}})),null==(n=null==(t=null==a?void 0:a.info)?void 0:t.programs)||n.forEach((t=>{const n=t.cacheKey.split(","),i=n[n.findIndex(um)+1];if((e=>{let t=""+e;return t=t.match("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"),null!==t})(i)&&e[i]){const{material:n,meshes:a}=e[i];r.set(i,{program:t,material:n,meshes:a,drawCounts:{total:0,type:"triangle",data:[]},expand:!1,visible:!0})}})),r.size!==$h().programs.size&&((e=>{e.forEach(((e,t)=>{const{meshes:n}=e;if(!n)return;let r={total:0,type:"Triangle",data:[]};Object.keys(n).forEach((e=>{const t=n[e],{geometry:i,material:a}=t;let o=i.index;const s=i.attributes.position;if(!s)return;let l=1;!0===a.wireframe&&(l=0);const c=null!==o?o.count:s.count,u=i.drawRange.start*l,d=i.drawRange.count*l,f=u,p=Math.min(c,u+d)-1;let h=1;const m=t.count||1;let v="Triangle",g=0;t.isMesh?!0===a.wireframe?(v="Line",h/=2):(v="Triangle",h/=3):t.isLine?(v="Line",t.isLineSegments?h/=2:t.isLineLoop||(h-=1)):t.isPoints?v="Point":t.isSprite&&(v="Triangle",h/=3);const x=Math.round(Math.max(0,p-f+1)*(h*m));x>g&&(g=x,r.type=v),r.total+=x,r.data.push({drawCount:x,type:v}),t.userData.drawCount={type:v,count:x}})),e.drawCounts=r}))})(r),Zh({programs:r,triggerProgramsUpdate:$h().triggerProgramsUpdate++}))}})),()=>{s&&(void 0!==window.cancelIdleCallback&&window.cancelIdleCallback(s.idleCbId),window.cancelAnimationFrame(s.rafId),window.cancelAnimationFrame(s.checkQueryId)),i&&(oe.prototype.updateMatrixWorld=im),t(),n()}}),[s,a,n,i]),ve.useEffect((()=>{const e=Ie((function(){return s&&(s.paused=!0,lm.value=0,sm.value=0,Zh({paused:!0,log:{maxMemory:0,gpu:0,mem:0,cpu:0,fps:0,totalTime:0,frameCount:0}})),!1}));return()=>{e()}}),[]),null},fm=Sn("div",{position:"fixed",top:0,right:0,zIndex:9999,fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif",backgroundColor:"rgba(36, 36, 36, .9)",color:"#fff",margin:0,minHeight:"100px",padding:"4px 0","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale",userSelect:"none","&.top-left":{right:"initial",left:0},"&.bottom-left":{right:"initial",top:"initial",bottom:0,left:0,".__perf_toggle":{top:"-20px",bottom:"initial"}},"&.bottom-right":{top:"initial",bottom:0,".__perf_toggle":{top:"-20px",bottom:"initial"}},"&.minimal":{backgroundColor:"rgba(36, 36, 36, .75)"},"*":{margin:"0",padding:"0",border:"0",fontSize:"100%",lineHeight:"1",verticalAlign:"baseline"}}),pm=Sn("small",{position:"absolute",right:0,fontSize:"10px"}),hm=Sn("div",{display:"inline-flex",fontStyle:"normal",padding:0,lineHeight:"13px",fontSize:"14px",width:"62px",position:"relative",pointerEvents:"auto",cursor:"default",fontWeight:500,letterSpacing:"0px",textAlign:"left",height:"29px",whiteSpace:"nowrap",justifyContent:"space-evenly",fontVariantNumeric:"tabular-nums",small:{paddingLeft:"12px"},svg:{padding:0,color:"rgba(145, 145, 145, 0.3)",fontSize:"40px",position:"absolute",zIndex:1,maxHeight:"20px",left:" 50%",marginLeft:"-23px",top:"4px"}}),mm=Sn("span",{verticalAlign:"bottom",position:"absolute",bottom:"5px",color:"rgba(101, 197, 188, 1)",textAlign:"right",letterSpacing:"1px",fontSize:"8px",fontWeight:"500",width:"60px"}),vm=Sn("div",{display:"flex"}),gm=Sn("div",{backgroundColor:"#404040",padding:"6px",display:"block",fontSize:"12px",marginBottom:"6px",cursor:"pointer","*":{cursor:"pointer !important"},"> span":{},small:{fontSize:"9px"},"> b":{marginRight:"4px",cursor:"pointer"}}),xm=Sn("div",{height:"66px",overflow:"hidden",position:"absolute",pointerEvents:"none",display:"flex",top:"0px",justifyContent:"center",width:"100%",minWidth:"310px",margin:"0 auto",canvas:{background:"transparent !important",position:"absolute !important"}}),ym=Sn("div",{textAlign:"center",fontWeight:700,fontSize:"12px",lineHeight:"12px",display:"flex",justifyContent:"center",alignItems:"center",verticalAlign:"middle",color:"#f1f1f1",padding:"7px",width:"100%",backgroundColor:"rgba(36, 36, 37, 0.8)",zIndex:1,position:"absolute",height:"100%"}),bm=Sn("div",{pointerEvents:"auto",justifyContent:"center",cursor:"pointer",fontSize:"12px",backgroundColor:"rgb(41, 43, 45)",marginTop:"6px",width:"auto",margin:"0",color:"rgba(145, 145, 145, 1)",textAlign:"center",display:"inline-block",verticalAlign:"middle",padding:"4px 6px","&.__perf_toggle_tab_active":{backgroundColor:"rgb(31 31 31)"},svg:{width:"12px",height:"12px",float:"left"}}),_m=Sn("div",{pointerEvents:"auto",justifyContent:"center",cursor:"pointer",fontSize:"12px",float:"right",backgroundColor:"rgb(41, 43, 45)",width:"auto",margin:"0",color:"rgba(145, 145, 145, 1)",textAlign:"center",display:"inline-block",verticalAlign:"middle",padding:"4px 6px","&.__perf_toggle_tab_active":{backgroundColor:"rgb(31 31 31)"},svg:{width:"12px",height:"12px",float:"left"}}),Lm=Sn("div",{padding:"4px 6px",fontSize:"12px",pointerEvents:"auto"}),Sm=Sn("span",{fontWeight:"bold",letterSpacing:"0.08em",maxWidth:"145px",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",verticalAlign:"middle",fontSize:"11px",marginRight:"10px"}),wm=Sn("div",{maxHeight:"50vh",overflowY:"auto",marginTop:"38px"}),Mm=Sn("div",{marginTop:"0"}),Am=Sn("div",{display:"flex",position:"relative",fontWeight:"bold",color:"#fff",lineHeight:"14px",svg:{marginRight:"4px",display:"inline-block"}}),Tm=Sn("ul",{display:"block",position:"relative",paddingLeft:"10px",margin:"6px 6px",img:{maxHeight:"60px",maxWidth:"100%",margin:"6px auto",display:"block"},"&:after":{content:"",position:"absolute",left:"0px",top:"0px",width:"1px",height:"100%",backgroundColor:"grey",transform:"translateX(-50%)",maxHeight:"50vh",overflowY:"auto"},li:{borderBottom:"1px solid #313131",display:"block",padding:"4px",margin:0,lineHeight:1,verticalAlign:"middle",height:"24px"},b:{fontWeight:"bold"},small:{textAlign:"revert",letterSpacing:"1px",fontSize:"10px",fontWeight:"500",marginLeft:"2px",color:"rgb(101, 197, 188)"}}),Em=Sn("button",{fontWeight:"bold",letterSpacing:"0.02em",backgroundColor:"rgb(41, 43, 45)",color:"rgb(211, 211, 211)",overflow:"hidden",textOverflow:"ellipsis",cursor:"pointer",display:"block",verticalAlign:"middle",fontSize:"11px",padding:"5px",margin:"4px auto"}),Cm=Sn("div",{display:"flex",justifyContent:"center",cursor:"pointer",fontSize:"12px",backgroundColor:"rgb(41, 43, 45)",marginTop:"6px",width:"auto",margin:"0 auto",color:"rgba(145, 145, 145, 1)",textAlign:"center",position:"absolute",right:0,bottom:" -20px",svg:{width:"12px",height:"12px",float:"left"}}),Rm=Sn("li",{display:"flex !important",height:"auto !important",span:{height:"40px",display:"block",position:"relative"},b:{paddingLeft:"12px"}});function Pm(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}var Fm=["color"],Im=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,Fm);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M0 1.5C0 1.22386 0.223858 1 0.5 1H2.5C2.77614 1 3 1.22386 3 1.5C3 1.77614 2.77614 2 2.5 2H0.5C0.223858 2 0 1.77614 0 1.5ZM4 1.5C4 1.22386 4.22386 1 4.5 1H14.5C14.7761 1 15 1.22386 15 1.5C15 1.77614 14.7761 2 14.5 2H4.5C4.22386 2 4 1.77614 4 1.5ZM4 4.5C4 4.22386 4.22386 4 4.5 4H11.5C11.7761 4 12 4.22386 12 4.5C12 4.77614 11.7761 5 11.5 5H4.5C4.22386 5 4 4.77614 4 4.5ZM0 7.5C0 7.22386 0.223858 7 0.5 7H2.5C2.77614 7 3 7.22386 3 7.5C3 7.77614 2.77614 8 2.5 8H0.5C0.223858 8 0 7.77614 0 7.5ZM4 7.5C4 7.22386 4.22386 7 4.5 7H14.5C14.7761 7 15 7.22386 15 7.5C15 7.77614 14.7761 8 14.5 8H4.5C4.22386 8 4 7.77614 4 7.5ZM4 10.5C4 10.2239 4.22386 10 4.5 10H11.5C11.7761 10 12 10.2239 12 10.5C12 10.7761 11.7761 11 11.5 11H4.5C4.22386 11 4 10.7761 4 10.5ZM0 13.5C0 13.2239 0.223858 13 0.5 13H2.5C2.77614 13 3 13.2239 3 13.5C3 13.7761 2.77614 14 2.5 14H0.5C0.223858 14 0 13.7761 0 13.5ZM4 13.5C4 13.2239 4.22386 13 4.5 13H14.5C14.7761 13 15 13.2239 15 13.5C15 13.7761 14.7761 14 14.5 14H4.5C4.22386 14 4 13.7761 4 13.5Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),Nm=["color"],Um=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,Nm);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M11.5 1C11.7761 1 12 1.22386 12 1.5V13.5C12 13.7761 11.7761 14 11.5 14C11.2239 14 11 13.7761 11 13.5V1.5C11 1.22386 11.2239 1 11.5 1ZM9.5 3C9.77614 3 10 3.22386 10 3.5V13.5C10 13.7761 9.77614 14 9.5 14C9.22386 14 9 13.7761 9 13.5V3.5C9 3.22386 9.22386 3 9.5 3ZM13.5 3C13.7761 3 14 3.22386 14 3.5V13.5C14 13.7761 13.7761 14 13.5 14C13.2239 14 13 13.7761 13 13.5V3.5C13 3.22386 13.2239 3 13.5 3ZM5.5 4C5.77614 4 6 4.22386 6 4.5V13.5C6 13.7761 5.77614 14 5.5 14C5.22386 14 5 13.7761 5 13.5V4.5C5 4.22386 5.22386 4 5.5 4ZM1.5 5C1.77614 5 2 5.22386 2 5.5V13.5C2 13.7761 1.77614 14 1.5 14C1.22386 14 1 13.7761 1 13.5V5.5C1 5.22386 1.22386 5 1.5 5ZM7.5 5C7.77614 5 8 5.22386 8 5.5V13.5C8 13.7761 7.77614 14 7.5 14C7.22386 14 7 13.7761 7 13.5V5.5C7 5.22386 7.22386 5 7.5 5ZM3.5 7C3.77614 7 4 7.22386 4 7.5V13.5C4 13.7761 3.77614 14 3.5 14C3.22386 14 3 13.7761 3 13.5V7.5C3 7.22386 3.22386 7 3.5 7Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),zm=["color"],Gm=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,zm);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M2 5H13C13.5523 5 14 5.44772 14 6V9C14 9.55228 13.5523 10 13 10H2C1.44772 10 1 9.55228 1 9V6C1 5.44772 1.44772 5 2 5ZM0 6C0 4.89543 0.895431 4 2 4H13C14.1046 4 15 4.89543 15 6V9C15 10.1046 14.1046 11 13 11H2C0.89543 11 0 10.1046 0 9V6ZM4.5 6.75C4.08579 6.75 3.75 7.08579 3.75 7.5C3.75 7.91421 4.08579 8.25 4.5 8.25C4.91421 8.25 5.25 7.91421 5.25 7.5C5.25 7.08579 4.91421 6.75 4.5 6.75ZM6.75 7.5C6.75 7.08579 7.08579 6.75 7.5 6.75C7.91421 6.75 8.25 7.08579 8.25 7.5C8.25 7.91421 7.91421 8.25 7.5 8.25C7.08579 8.25 6.75 7.91421 6.75 7.5ZM10.5 6.75C10.0858 6.75 9.75 7.08579 9.75 7.5C9.75 7.91421 10.0858 8.25 10.5 8.25C10.9142 8.25 11.25 7.91421 11.25 7.5C11.25 7.08579 10.9142 6.75 10.5 6.75Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),Bm=["color"],Dm=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,Bm);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M7.28856 0.796908C7.42258 0.734364 7.57742 0.734364 7.71144 0.796908L13.7114 3.59691C13.8875 3.67906 14 3.85574 14 4.05V10.95C14 11.1443 13.8875 11.3209 13.7114 11.4031L7.71144 14.2031C7.57742 14.2656 7.42258 14.2656 7.28856 14.2031L1.28856 11.4031C1.11252 11.3209 1 11.1443 1 10.95V4.05C1 3.85574 1.11252 3.67906 1.28856 3.59691L7.28856 0.796908ZM2 4.80578L7 6.93078V12.9649L2 10.6316V4.80578ZM8 12.9649L13 10.6316V4.80578L8 6.93078V12.9649ZM7.5 6.05672L12.2719 4.02866L7.5 1.80176L2.72809 4.02866L7.5 6.05672Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),km=["color"],Om=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,km);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M7.5 9.125C8.39746 9.125 9.125 8.39746 9.125 7.5C9.125 6.60254 8.39746 5.875 7.5 5.875C6.60254 5.875 5.875 6.60254 5.875 7.5C5.875 8.39746 6.60254 9.125 7.5 9.125ZM7.5 10.125C8.94975 10.125 10.125 8.94975 10.125 7.5C10.125 6.05025 8.94975 4.875 7.5 4.875C6.05025 4.875 4.875 6.05025 4.875 7.5C4.875 8.94975 6.05025 10.125 7.5 10.125Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),jm=["color"],Vm=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,jm);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M7.49999 3.09998C7.27907 3.09998 7.09999 3.27906 7.09999 3.49998C7.09999 3.72089 7.27907 3.89998 7.49999 3.89998H14.5C14.7209 3.89998 14.9 3.72089 14.9 3.49998C14.9 3.27906 14.7209 3.09998 14.5 3.09998H7.49999ZM7.49998 5.1C7.27907 5.1 7.09998 5.27908 7.09998 5.5C7.09998 5.72091 7.27907 5.9 7.49998 5.9H14.5C14.7209 5.9 14.9 5.72091 14.9 5.5C14.9 5.27908 14.7209 5.1 14.5 5.1H7.49998ZM7.1 7.5C7.1 7.27908 7.27909 7.1 7.5 7.1H14.5C14.7209 7.1 14.9 7.27908 14.9 7.5C14.9 7.72091 14.7209 7.9 14.5 7.9H7.5C7.27909 7.9 7.1 7.72091 7.1 7.5ZM7.49998 9.1C7.27907 9.1 7.09998 9.27908 7.09998 9.5C7.09998 9.72091 7.27907 9.9 7.49998 9.9H14.5C14.7209 9.9 14.9 9.72091 14.9 9.5C14.9 9.27908 14.7209 9.1 14.5 9.1H7.49998ZM7.09998 11.5C7.09998 11.2791 7.27907 11.1 7.49998 11.1H14.5C14.7209 11.1 14.9 11.2791 14.9 11.5C14.9 11.7209 14.7209 11.9 14.5 11.9H7.49998C7.27907 11.9 7.09998 11.7209 7.09998 11.5ZM2.5 9.25003L5 6.00003H0L2.5 9.25003Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),Hm=["color"],Xm=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,Hm);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M13.3536 2.35355C13.5488 2.15829 13.5488 1.84171 13.3536 1.64645C13.1583 1.45118 12.8417 1.45118 12.6464 1.64645L10.6828 3.61012C9.70652 3.21671 8.63759 3 7.5 3C4.30786 3 1.65639 4.70638 0.0760002 7.23501C-0.0253338 7.39715 -0.0253334 7.60288 0.0760014 7.76501C0.902945 9.08812 2.02314 10.1861 3.36061 10.9323L1.64645 12.6464C1.45118 12.8417 1.45118 13.1583 1.64645 13.3536C1.84171 13.5488 2.15829 13.5488 2.35355 13.3536L4.31723 11.3899C5.29348 11.7833 6.36241 12 7.5 12C10.6921 12 13.3436 10.2936 14.924 7.76501C15.0253 7.60288 15.0253 7.39715 14.924 7.23501C14.0971 5.9119 12.9769 4.81391 11.6394 4.06771L13.3536 2.35355ZM9.90428 4.38861C9.15332 4.1361 8.34759 4 7.5 4C4.80285 4 2.52952 5.37816 1.09622 7.50001C1.87284 8.6497 2.89609 9.58106 4.09974 10.1931L9.90428 4.38861ZM5.09572 10.6114L10.9003 4.80685C12.1039 5.41894 13.1272 6.35031 13.9038 7.50001C12.4705 9.62183 10.1971 11 7.5 11C6.65241 11 5.84668 10.8639 5.09572 10.6114Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),Wm=["color"],Ym=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,Wm);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M7.5 11C4.80285 11 2.52952 9.62184 1.09622 7.50001C2.52952 5.37816 4.80285 4 7.5 4C10.1971 4 12.4705 5.37816 13.9038 7.50001C12.4705 9.62183 10.1971 11 7.5 11ZM7.5 3C4.30786 3 1.65639 4.70638 0.0760002 7.23501C-0.0253338 7.39715 -0.0253334 7.60288 0.0760014 7.76501C1.65639 10.2936 4.30786 12 7.5 12C10.6921 12 13.3436 10.2936 14.924 7.76501C15.0253 7.60288 15.0253 7.39715 14.924 7.23501C13.3436 4.70638 10.6921 3 7.5 3ZM7.5 9.5C8.60457 9.5 9.5 8.60457 9.5 7.5C9.5 6.39543 8.60457 5.5 7.5 5.5C6.39543 5.5 5.5 6.39543 5.5 7.5C5.5 8.60457 6.39543 9.5 7.5 9.5Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),$m=["color"],Zm=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,$m);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M2.5 1H12.5C13.3284 1 14 1.67157 14 2.5V12.5C14 13.3284 13.3284 14 12.5 14H2.5C1.67157 14 1 13.3284 1 12.5V2.5C1 1.67157 1.67157 1 2.5 1ZM2.5 2C2.22386 2 2 2.22386 2 2.5V8.3636L3.6818 6.6818C3.76809 6.59551 3.88572 6.54797 4.00774 6.55007C4.12975 6.55216 4.24568 6.60372 4.32895 6.69293L7.87355 10.4901L10.6818 7.6818C10.8575 7.50607 11.1425 7.50607 11.3182 7.6818L13 9.3636V2.5C13 2.22386 12.7761 2 12.5 2H2.5ZM2 12.5V9.6364L3.98887 7.64753L7.5311 11.4421L8.94113 13H2.5C2.22386 13 2 12.7761 2 12.5ZM12.5 13H10.155L8.48336 11.153L11 8.6364L13 10.6364V12.5C13 12.7761 12.7761 13 12.5 13ZM6.64922 5.5C6.64922 5.03013 7.03013 4.64922 7.5 4.64922C7.96987 4.64922 8.35078 5.03013 8.35078 5.5C8.35078 5.96987 7.96987 6.35078 7.5 6.35078C7.03013 6.35078 6.64922 5.96987 6.64922 5.5ZM7.5 3.74922C6.53307 3.74922 5.74922 4.53307 5.74922 5.5C5.74922 6.46693 6.53307 7.25078 7.5 7.25078C8.46693 7.25078 9.25078 6.46693 9.25078 5.5C9.25078 4.53307 8.46693 3.74922 7.5 3.74922Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),Qm=["color"],Km=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,Qm);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M5.49998 0.5C5.49998 0.223858 5.72383 0 5.99998 0H7.49998H8.99998C9.27612 0 9.49998 0.223858 9.49998 0.5C9.49998 0.776142 9.27612 1 8.99998 1H7.99998V2.11922C9.09832 2.20409 10.119 2.56622 10.992 3.13572C11.0116 3.10851 11.0336 3.08252 11.058 3.05806L12.058 2.05806C12.3021 1.81398 12.6978 1.81398 12.9419 2.05806C13.186 2.30214 13.186 2.69786 12.9419 2.94194L11.967 3.91682C13.1595 5.07925 13.9 6.70314 13.9 8.49998C13.9 12.0346 11.0346 14.9 7.49998 14.9C3.96535 14.9 1.09998 12.0346 1.09998 8.49998C1.09998 5.13361 3.69904 2.3743 6.99998 2.11922V1H5.99998C5.72383 1 5.49998 0.776142 5.49998 0.5ZM2.09998 8.49998C2.09998 5.51764 4.51764 3.09998 7.49998 3.09998C10.4823 3.09998 12.9 5.51764 12.9 8.49998C12.9 11.4823 10.4823 13.9 7.49998 13.9C4.51764 13.9 2.09998 11.4823 2.09998 8.49998ZM7.49998 8.49998V4.09998C5.06992 4.09998 3.09998 6.06992 3.09998 8.49998C3.09998 10.93 5.06992 12.9 7.49998 12.9C8.715 12.9 9.815 12.4075 10.6112 11.6112L7.49998 8.49998Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),qm=["color"],Jm=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,qm);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M7.75432 0.819537C7.59742 0.726821 7.4025 0.726821 7.24559 0.819537L1.74559 4.06954C1.59336 4.15949 1.49996 4.32317 1.49996 4.5C1.49996 4.67683 1.59336 4.84051 1.74559 4.93046L7.24559 8.18046C7.4025 8.27318 7.59742 8.27318 7.75432 8.18046L13.2543 4.93046C13.4066 4.84051 13.5 4.67683 13.5 4.5C13.5 4.32317 13.4066 4.15949 13.2543 4.06954L7.75432 0.819537ZM7.49996 7.16923L2.9828 4.5L7.49996 1.83077L12.0171 4.5L7.49996 7.16923ZM1.5695 7.49564C1.70998 7.2579 2.01659 7.17906 2.25432 7.31954L7.49996 10.4192L12.7456 7.31954C12.9833 7.17906 13.2899 7.2579 13.4304 7.49564C13.5709 7.73337 13.4921 8.03998 13.2543 8.18046L7.75432 11.4305C7.59742 11.5232 7.4025 11.5232 7.24559 11.4305L1.74559 8.18046C1.50786 8.03998 1.42901 7.73337 1.5695 7.49564ZM1.56949 10.4956C1.70998 10.2579 2.01658 10.1791 2.25432 10.3195L7.49996 13.4192L12.7456 10.3195C12.9833 10.1791 13.2899 10.2579 13.4304 10.4956C13.5709 10.7334 13.4921 11.04 13.2543 11.1805L7.75432 14.4305C7.59742 14.5232 7.4025 14.5232 7.24559 14.4305L1.74559 11.1805C1.50785 11.04 1.42901 10.7334 1.56949 10.4956Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),ev=["color"],tv=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,ev);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M8.69667 0.0403541C8.90859 0.131038 9.03106 0.354857 8.99316 0.582235L8.0902 6.00001H12.5C12.6893 6.00001 12.8625 6.10701 12.9472 6.27641C13.0319 6.4458 13.0136 6.6485 12.8999 6.80001L6.89997 14.8C6.76167 14.9844 6.51521 15.0503 6.30328 14.9597C6.09135 14.869 5.96888 14.6452 6.00678 14.4178L6.90974 9H2.49999C2.31061 9 2.13748 8.893 2.05278 8.72361C1.96809 8.55422 1.98636 8.35151 2.09999 8.2L8.09997 0.200038C8.23828 0.0156255 8.48474 -0.0503301 8.69667 0.0403541ZM3.49999 8.00001H7.49997C7.64695 8.00001 7.78648 8.06467 7.88148 8.17682C7.97648 8.28896 8.01733 8.43723 7.99317 8.5822L7.33027 12.5596L11.5 7.00001H7.49997C7.353 7.00001 7.21347 6.93534 7.11846 6.8232C7.02346 6.71105 6.98261 6.56279 7.00678 6.41781L7.66968 2.44042L3.49999 8.00001Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),nv=["color"],rv=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,nv);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M1.49988 2.00012C1.77602 2.00012 1.99988 1.77626 1.99988 1.50012C1.99988 1.22398 1.77602 1.00012 1.49988 1.00012C1.22374 1.00012 0.999878 1.22398 0.999878 1.50012C0.999878 1.77626 1.22374 2.00012 1.49988 2.00012ZM4.49988 2.00012C4.77602 2.00012 4.99988 1.77626 4.99988 1.50012C4.99988 1.22398 4.77602 1.00012 4.49988 1.00012C4.22374 1.00012 3.99988 1.22398 3.99988 1.50012C3.99988 1.77626 4.22374 2.00012 4.49988 2.00012ZM7.99988 1.50012C7.99988 1.77626 7.77602 2.00012 7.49988 2.00012C7.22374 2.00012 6.99988 1.77626 6.99988 1.50012C6.99988 1.22398 7.22374 1.00012 7.49988 1.00012C7.77602 1.00012 7.99988 1.22398 7.99988 1.50012ZM10.4999 2.00012C10.776 2.00012 10.9999 1.77626 10.9999 1.50012C10.9999 1.22398 10.776 1.00012 10.4999 1.00012C10.2237 1.00012 9.99988 1.22398 9.99988 1.50012C9.99988 1.77626 10.2237 2.00012 10.4999 2.00012ZM13.9999 1.50012C13.9999 1.77626 13.776 2.00012 13.4999 2.00012C13.2237 2.00012 12.9999 1.77626 12.9999 1.50012C12.9999 1.22398 13.2237 1.00012 13.4999 1.00012C13.776 1.00012 13.9999 1.22398 13.9999 1.50012ZM1.49988 14.0001C1.77602 14.0001 1.99988 13.7763 1.99988 13.5001C1.99988 13.224 1.77602 13.0001 1.49988 13.0001C1.22374 13.0001 0.999878 13.224 0.999878 13.5001C0.999878 13.7763 1.22374 14.0001 1.49988 14.0001ZM1.99988 10.5001C1.99988 10.7763 1.77602 11.0001 1.49988 11.0001C1.22374 11.0001 0.999878 10.7763 0.999878 10.5001C0.999878 10.224 1.22374 10.0001 1.49988 10.0001C1.77602 10.0001 1.99988 10.224 1.99988 10.5001ZM1.49988 8.00012C1.77602 8.00012 1.99988 7.77626 1.99988 7.50012C1.99988 7.22398 1.77602 7.00012 1.49988 7.00012C1.22374 7.00012 0.999878 7.22398 0.999878 7.50012C0.999878 7.77626 1.22374 8.00012 1.49988 8.00012ZM1.99988 4.50012C1.99988 4.77626 1.77602 5.00012 1.49988 5.00012C1.22374 5.00012 0.999878 4.77626 0.999878 4.50012C0.999878 4.22398 1.22374 4.00012 1.49988 4.00012C1.77602 4.00012 1.99988 4.22398 1.99988 4.50012ZM13.4999 11.0001C13.776 11.0001 13.9999 10.7763 13.9999 10.5001C13.9999 10.224 13.776 10.0001 13.4999 10.0001C13.2237 10.0001 12.9999 10.224 12.9999 10.5001C12.9999 10.7763 13.2237 11.0001 13.4999 11.0001ZM13.9999 7.50012C13.9999 7.77626 13.776 8.00012 13.4999 8.00012C13.2237 8.00012 12.9999 7.77626 12.9999 7.50012C12.9999 7.22398 13.2237 7.00012 13.4999 7.00012C13.776 7.00012 13.9999 7.22398 13.9999 7.50012ZM13.4999 5.00012C13.776 5.00012 13.9999 4.77626 13.9999 4.50012C13.9999 4.22398 13.776 4.00012 13.4999 4.00012C13.2237 4.00012 12.9999 4.22398 12.9999 4.50012C12.9999 4.77626 13.2237 5.00012 13.4999 5.00012ZM4.99988 13.5001C4.99988 13.7763 4.77602 14.0001 4.49988 14.0001C4.22374 14.0001 3.99988 13.7763 3.99988 13.5001C3.99988 13.224 4.22374 13.0001 4.49988 13.0001C4.77602 13.0001 4.99988 13.224 4.99988 13.5001ZM7.49988 14.0001C7.77602 14.0001 7.99988 13.7763 7.99988 13.5001C7.99988 13.224 7.77602 13.0001 7.49988 13.0001C7.22374 13.0001 6.99988 13.224 6.99988 13.5001C6.99988 13.7763 7.22374 14.0001 7.49988 14.0001ZM10.9999 13.5001C10.9999 13.7763 10.776 14.0001 10.4999 14.0001C10.2237 14.0001 9.99988 13.7763 9.99988 13.5001C9.99988 13.224 10.2237 13.0001 10.4999 13.0001C10.776 13.0001 10.9999 13.224 10.9999 13.5001ZM13.4999 14.0001C13.776 14.0001 13.9999 13.7763 13.9999 13.5001C13.9999 13.224 13.776 13.0001 13.4999 13.0001C13.2237 13.0001 12.9999 13.224 12.9999 13.5001C12.9999 13.7763 13.2237 14.0001 13.4999 14.0001ZM3.99988 5.00012C3.99988 4.44784 4.44759 4.00012 4.99988 4.00012H9.99988C10.5522 4.00012 10.9999 4.44784 10.9999 5.00012V10.0001C10.9999 10.5524 10.5522 11.0001 9.99988 11.0001H4.99988C4.44759 11.0001 3.99988 10.5524 3.99988 10.0001V5.00012ZM4.99988 5.00012H9.99988V10.0001H4.99988V5.00012Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),iv=["color"],av=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,iv);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M2.25 7.5C2.25 7.22386 2.47386 7 2.75 7H12.25C12.5261 7 12.75 7.22386 12.75 7.5C12.75 7.77614 12.5261 8 12.25 8H2.75C2.47386 8 2.25 7.77614 2.25 7.5Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),ov=["color"],sv=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,ov);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M6.04995 2.74998C6.04995 2.44623 5.80371 2.19998 5.49995 2.19998C5.19619 2.19998 4.94995 2.44623 4.94995 2.74998V12.25C4.94995 12.5537 5.19619 12.8 5.49995 12.8C5.80371 12.8 6.04995 12.5537 6.04995 12.25V2.74998ZM10.05 2.74998C10.05 2.44623 9.80371 2.19998 9.49995 2.19998C9.19619 2.19998 8.94995 2.44623 8.94995 2.74998V12.25C8.94995 12.5537 9.19619 12.8 9.49995 12.8C9.80371 12.8 10.05 12.5537 10.05 12.25V2.74998Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),lv=["color"],cv=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,lv);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M6.85357 3.85355L7.65355 3.05353C8.2981 2.40901 9.42858 1.96172 10.552 1.80125C11.1056 1.72217 11.6291 1.71725 12.0564 1.78124C12.4987 1.84748 12.7698 1.97696 12.8965 2.10357C13.0231 2.23018 13.1526 2.50125 13.2188 2.94357C13.2828 3.37086 13.2779 3.89439 13.1988 4.44801C13.0383 5.57139 12.591 6.70188 11.9464 7.34645L7.49999 11.7929L6.35354 10.6465C6.15827 10.4512 5.84169 10.4512 5.64643 10.6465C5.45117 10.8417 5.45117 11.1583 5.64643 11.3536L7.14644 12.8536C7.34171 13.0488 7.65829 13.0488 7.85355 12.8536L8.40073 12.3064L9.57124 14.2572C9.65046 14.3893 9.78608 14.4774 9.9389 14.4963C10.0917 14.5151 10.2447 14.4624 10.3535 14.3536L12.3535 12.3536C12.4648 12.2423 12.5172 12.0851 12.495 11.9293L12.0303 8.67679L12.6536 8.05355C13.509 7.19808 14.0117 5.82855 14.1887 4.58943C14.2784 3.9618 14.2891 3.33847 14.2078 2.79546C14.1287 2.26748 13.9519 1.74482 13.6035 1.39645C13.2552 1.04809 12.7325 0.871332 12.2045 0.792264C11.6615 0.710945 11.0382 0.721644 10.4105 0.8113C9.17143 0.988306 7.80189 1.491 6.94644 2.34642L6.32322 2.96968L3.07071 2.50504C2.91492 2.48278 2.75773 2.53517 2.64645 2.64646L0.646451 4.64645C0.537579 4.75533 0.484938 4.90829 0.50375 5.0611C0.522563 5.21391 0.61073 5.34954 0.742757 5.42876L2.69364 6.59928L2.14646 7.14645C2.0527 7.24022 2.00002 7.3674 2.00002 7.50001C2.00002 7.63261 2.0527 7.75979 2.14646 7.85356L3.64647 9.35356C3.84173 9.54883 4.15831 9.54883 4.35357 9.35356C4.54884 9.1583 4.54884 8.84172 4.35357 8.64646L3.20712 7.50001L3.85357 6.85356L6.85357 3.85355ZM10.0993 13.1936L9.12959 11.5775L11.1464 9.56067L11.4697 11.8232L10.0993 13.1936ZM3.42251 5.87041L5.43935 3.85356L3.17678 3.53034L1.80638 4.90074L3.42251 5.87041ZM2.35356 10.3535C2.54882 10.1583 2.54882 9.8417 2.35356 9.64644C2.1583 9.45118 1.84171 9.45118 1.64645 9.64644L0.646451 10.6464C0.451188 10.8417 0.451188 11.1583 0.646451 11.3535C0.841713 11.5488 1.1583 11.5488 1.35356 11.3535L2.35356 10.3535ZM3.85358 11.8536C4.04884 11.6583 4.04885 11.3417 3.85359 11.1465C3.65833 10.9512 3.34175 10.9512 3.14648 11.1465L1.14645 13.1464C0.95119 13.3417 0.951187 13.6583 1.14645 13.8535C1.34171 14.0488 1.65829 14.0488 1.85355 13.8536L3.85358 11.8536ZM5.35356 13.3535C5.54882 13.1583 5.54882 12.8417 5.35356 12.6464C5.1583 12.4512 4.84171 12.4512 4.64645 12.6464L3.64645 13.6464C3.45119 13.8417 3.45119 14.1583 3.64645 14.3535C3.84171 14.5488 4.1583 14.5488 4.35356 14.3535L5.35356 13.3535ZM9.49997 6.74881C10.1897 6.74881 10.7488 6.1897 10.7488 5.5C10.7488 4.8103 10.1897 4.25118 9.49997 4.25118C8.81026 4.25118 8.25115 4.8103 8.25115 5.5C8.25115 6.1897 8.81026 6.74881 9.49997 6.74881Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),uv=["color"],dv=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,uv);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M0.5 4C0.223858 4 0 4.22386 0 4.5V10.5C0 10.7761 0.223858 11 0.5 11H14.5C14.7761 11 15 10.7761 15 10.5V4.5C15 4.22386 14.7761 4 14.5 4H0.5ZM1 10V5H2.075V7.5C2.075 7.73472 2.26528 7.925 2.5 7.925C2.73472 7.925 2.925 7.73472 2.925 7.5V5H4.075V6.5C4.075 6.73472 4.26528 6.925 4.5 6.925C4.73472 6.925 4.925 6.73472 4.925 6.5V5H6.075V6.5C6.075 6.73472 6.26528 6.925 6.5 6.925C6.73472 6.925 6.925 6.73472 6.925 6.5V5H8.075V7.5C8.075 7.73472 8.26528 7.925 8.5 7.925C8.73472 7.925 8.925 7.73472 8.925 7.5V5H10.075V6.5C10.075 6.73472 10.2653 6.925 10.5 6.925C10.7347 6.925 10.925 6.73472 10.925 6.5V5H12.075V6.5C12.075 6.73472 12.2653 6.925 12.5 6.925C12.7347 6.925 12.925 6.73472 12.925 6.5V5H14V10H1Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),fv=["color"],pv=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,fv);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M2.5 4C2.22386 4 2 4.22386 2 4.5C2 4.77614 2.22386 5 2.5 5H12.5C12.7761 5 13 4.77614 13 4.5C13 4.22386 12.7761 4 12.5 4H2.5ZM2 7.5C2 7.22386 2.22386 7 2.5 7H12.5C12.7761 7 13 7.22386 13 7.5C13 7.77614 12.7761 8 12.5 8H2.5C2.22386 8 2 7.77614 2 7.5ZM2 10.5C2 10.2239 2.22386 10 2.5 10H12.5C12.7761 10 13 10.2239 13 10.5C13 10.7761 12.7761 11 12.5 11H2.5C2.22386 11 2 10.7761 2 10.5Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))})),hv=["color"],mv=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,hv);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M4 6H11L7.5 10.5L4 6Z",fill:r}))})),vv=["color"],gv=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,vv);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M4 9H11L7.5 4.5L4 9Z",fill:r}))})),xv=["color"],yv=ve.forwardRef((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,i=Pm(e,xv);return ve.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:t}),ve.createElement("path",{d:"M7.49998 1L6.92321 2.00307L1.17498 12L0.599976 13H1.7535H13.2464H14.4L13.825 12L8.07674 2.00307L7.49998 1ZM7.49998 3.00613L2.3285 12H12.6714L7.49998 3.00613Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))}));const bv=ve.memo((({isPerf:e,color:t,colorBlind:n,customData:r,isMemory:i,isShadersInfo:a,metric:o,fontSize:s,offsetY:l=0,offsetX:c,round:u,hasInstance:d})=>{const{width:f,height:p}=Ee((e=>e.viewport)),h=ve.useRef(null),m=ve.useRef(null);return tm("log",(function([t,c]){var f;if(!t||!h.current)return;if(r&&(h.current.text=(Math.round($h().customData*Math.pow(10,u))/Math.pow(10,u)).toFixed(u)),!o)return;let v=t[o];if(a)v=null==(f=c.info.programs)?void 0:f.length;else if("matriceCount"===o)v=lm.value;else if(!e&&c.info.render){v=(i?c.info.memory:c.info.render)[o]}if("fps"===o&&(h.current.color=$h().overclockingFps?Fv(n).overClock.toString():`rgb(${Fv(n).fps.toString()})`),h.current.text=(Math.round(v*Math.pow(10,u))/Math.pow(10,u)).toFixed(u),d){const e=c.info.instance;if(void 0===e&&"matriceCount"!==o)return;let t;t="matriceCount"===o?sm.value:e[o],t>0?(h.current.fontSize=s/1.15,m.current.fontSize=v>0?s/1.4:s,h.current.position.y=p/2-l-s/1.9,m.current.text=" ±\t"+(Math.round(t*Math.pow(10,u))/Math.pow(10,u)).toFixed(u)):(m.current.text&&(m.current.text=""),h.current.position.y=p/2-l-s,h.current.fontSize=s)}lm.value-=1,h.current.updateMatrix(),h.current.matrixWorld.copy(h.current.matrix)})),We.jsxs(ve.Suspense,{fallback:null,children:[We.jsxs(Ne,{textAlign:"justify",matrixAutoUpdate:!1,ref:h,fontSize:s,position:[-f/2+c+s,p/2-l-s,0],color:t,characters:"0123456789",onUpdate:e=>{e.updateMatrix(),lm.value-=1,e.matrixWorld.copy(e.matrix)},children:[We.jsx("meshBasicMaterial",{blending:le}),"0"]}),d&&We.jsx(Ne,{textAlign:"justify",matrixAutoUpdate:!1,ref:m,fontSize:8,position:[-f/2+c+s,p/2-l-1.15*s,0],color:"lightgrey",characters:"0123456789",onUpdate:e=>{e.updateMatrix(),lm.value-=1,e.matrixWorld.copy(e.matrix)},children:We.jsx("meshBasicMaterial",{blending:le})})]})})),_v=({colorBlind:e,customData:t,minimal:n,matrixUpdate:r})=>{const i=14;return We.jsxs(We.Fragment,{children:[We.jsx(bv,{colorBlind:e,color:`rgb(${Fv(e).fps.toString()})`,isPerf:!0,metric:"fps",fontSize:i,offsetX:140,round:0}),We.jsx(bv,{color:`rgb(${Fv(e).cpu.toString()})`,isPerf:!0,metric:"cpu",fontSize:i,offsetX:72,round:3}),We.jsx(bv,{color:`rgb(${Fv(e).gpu.toString()})`,isPerf:!0,metric:"gpu",fontSize:i,offsetX:10,round:3}),n?null:We.jsxs(We.Fragment,{children:[We.jsx(bv,{metric:"calls",fontSize:i,offsetX:200,round:0,hasInstance:!0}),We.jsx(bv,{metric:"triangles",fontSize:i,offsetX:260,round:0,hasInstance:!0}),We.jsx(bv,{isMemory:!0,metric:"geometries",fontSize:i,offsetY:30,offsetX:0,round:0}),We.jsx(bv,{isMemory:!0,metric:"textures",fontSize:i,offsetY:30,offsetX:80,round:0}),We.jsx(bv,{isShadersInfo:!0,metric:"programs",fontSize:i,offsetY:30,offsetX:140,round:0}),We.jsx(bv,{metric:"lines",fontSize:i,offsetY:30,offsetX:200,round:0,hasInstance:!0}),We.jsx(bv,{metric:"points",fontSize:i,offsetY:30,offsetX:260,round:0,hasInstance:!0}),r&&We.jsx(bv,{isPerf:!0,metric:"matriceCount",fontSize:i,offsetY:30,offsetX:320,round:0,hasInstance:!0})]}),t&&We.jsx(bv,{color:`rgb(${Fv(e).custom.toString()})`,customData:t,fontSize:i,offsetY:0,offsetX:n?200:320,round:t.round||2})]})},Lv=({colorBlind:e,minimal:t,chart:n={length:120,hz:60}})=>{const r=ve.useMemo((()=>({fps:new Float32Array(3*n.length),cpu:new Float32Array(3*n.length),gpu:new Float32Array(3*n.length)})),[n]),i=ve.useRef(null),a=ve.useRef(null),o=ve.useRef(null),s=ve.useRef(null),l=ve.useMemo((()=>new h(0,0,0)),[]),c=(e,n=1,r,i)=>{let a=0;const{width:o,height:s}=i,c=$h().chart.data[e];if(!c||0===c.length)return;const u=t?2:6,d=t?12:50;let f=c.length;for(let t=0;t<f;t++){let e=($h().chart.circularId+t+1)%f;void 0!==c[e]&&(c[e]>a&&(a=c[e]*n),l.set(u+t/(f-1)*(o-2*u)-o/2,Math.min(100,c[e])*n/100*(s-2*u-d)-s/2,0),l.toArray(r.attributes.position.array,3*t))}r.attributes.position.needsUpdate=!0};return Ce((function({viewport:t}){c("fps",1,i.current,t),a.current&&a.current.color.set($h().overclockingFps?Fv(e).overClock.toString():`rgb(${Fv(e).fps.toString()})`),c("gpu",5,o.current,t),c("cpu",5,s.current,t)})),We.jsxs(We.Fragment,{children:[We.jsxs("line",{onUpdate:e=>{e.updateMatrix(),lm.value-=1,e.matrixWorld.copy(e.matrix)},children:[We.jsx("bufferGeometry",{ref:i,children:We.jsx("bufferAttribute",{attach:"attributes-position",count:n.length,array:r.fps,itemSize:3,usage:ce,needsUpdate:!0})}),We.jsx("lineBasicMaterial",{ref:a,color:`rgb(${Fv(e).fps.toString()})`,transparent:!0,opacity:.5})]}),We.jsxs("line",{onUpdate:e=>{e.updateMatrix(),lm.value-=1,e.matrixWorld.copy(e.matrix)},children:[We.jsx("bufferGeometry",{ref:o,children:We.jsx("bufferAttribute",{attach:"attributes-position",count:n.length,array:r.gpu,itemSize:3,usage:ce,needsUpdate:!0})}),We.jsx("lineBasicMaterial",{color:`rgb(${Fv(e).gpu.toString()})`,transparent:!0,opacity:.5})]}),We.jsxs("line",{onUpdate:e=>{e.updateMatrix(),lm.value-=1,e.matrixWorld.copy(e.matrix)},children:[We.jsx("bufferGeometry",{ref:s,children:We.jsx("bufferAttribute",{attach:"attributes-position",count:n.length,array:r.cpu,itemSize:3,usage:ce,needsUpdate:!0})}),We.jsx("lineBasicMaterial",{color:`rgb(${Fv(e).cpu.toString()})`,transparent:!0,opacity:.5})]})]})},Sv=({colorBlind:e,chart:t,customData:n,matrixUpdate:r,showGraph:i=!0,antialias:a=!0,minimal:o})=>{const s=ve.useRef(void 0),l=Yh((e=>e.paused));return We.jsxs(xm,{style:{display:"flex",position:"absolute",height:(o?37:i?100:60)+"px",minWidth:""+(o?"100px":n?"370px":"310px")},children:[We.jsx(Ue,{ref:s,orthographic:!0,dpr:a?[1,2]:1,gl:{antialias:!0,alpha:!0,stencil:!1,depth:!1},onCreated:({scene:e})=>{e.traverse((e=>{e.matrixWorldAutoUpdate=!1,e.matrixAutoUpdate=!1}))},flat:!0,style:{marginBottom:"-42px",position:"relative",pointerEvents:"none",background:"transparent !important",height:(o?37:i?100:60)+"px"},children:l?null:We.jsxs(We.Fragment,{children:[We.jsx(wv,{}),We.jsx(_v,{customData:n,minimal:o,matrixUpdate:r}),i&&We.jsx(Lv,{colorBlind:e,minimal:o,chart:t})]})}),l&&We.jsxs(ym,{children:[We.jsx(sv,{})," PAUSED"]})]})},wv=()=>(Ce((function({gl:e,scene:t,camera:n}){n.updateMatrix(),lm.value-=1,n.matrixWorld.copy(n.matrix),n.matrixWorldInverse.copy(n.matrixWorld).invert(),e.render(t,n),sm.value=0,lm.value=0}),1/0),null),Mv=ve.forwardRef((({portal:e,className:t,children:n,name:r,...i},a)=>{const o=Ee((e=>e.gl)),s=ve.useRef(null),l=ve.useRef(null),c=null!=(null==e?void 0:e.current)?e.current:o.domElement.parentNode;return ve.useLayoutEffect((()=>{if(!s.current||!c)return;const e=document.createElement("div"),t=l.current=ze(e);return c.appendChild(e),()=>{t.unmount(),l.current=null,c.removeChild(e)}}),[c]),ve.useLayoutEffect((()=>{const e=l.current;e&&e.render(We.jsx("div",{ref:a,className:t,children:n}))})),We.jsx("group",{name:r,...i,ref:s})}));function Av(e){let t=0;for(let r in e.attributes){const n=e.getAttribute(r);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}const Tv=(e,t)=>({name:e,url:t.image.currentSrc,encoding:(e=>{switch(e){case 3e3:return"LinearEncoding";case 3001:return"sRGBEncoding";case 3002:return"RGBEEncoding";case 3003:return"LogLuvEncoding";case 3004:return"RGBM7Encoding";case 3005:return"RGBM16Encoding";case 3006:return"RGBDEncoding";case 3007:return"GammaEncoding";default:return"ClampToEdgeWrapping"}})(t.encoding),wrapT:(e=>{switch(e){case 1e3:return"RepeatWrapping";case 1001:default:return"ClampToEdgeWrapping";case 1002:return"MirroredRepeatWrapping"}})(t.wrapT),flipY:t.flipY.toString()}),Ev=({program:e,material:t,setTexNumber:n})=>{const r=Yh((e=>e.gl)),[i,a]=ve.useState(null);return ve.useEffect((()=>{if(r){const r=null==e?void 0:e.getUniforms();let i=0;const o=new Map;r.seq.forEach((e=>{if(!e.id.includes("uTroika")&&"isOrthographic"!==e.id&&"uvTransform"!==e.id&&"lightProbe"!==e.id&&"projectionMatrix"!==e.id&&"viewMatrix"!==e.id&&"normalMatrix"!==e.id&&"modelMatrix"!==e.id&&"modelViewMatrix"!==e.id){let n=[],r={name:e.id};e.cache&&(e.cache.forEach((e=>{void 0!==e&&n.push(e.toString().substring(0,4))})),r.value=n.join(),t[e.id]&&t[e.id].image&&t[e.id].image&&(i++,r.value=Tv(e.id,t[e.id])),r.value||(r.value="empty"),o.set(e.id,r))}})),t.uniforms&&Object.keys(t.uniforms).forEach((e=>{const n=t.uniforms[e];if(n.value){const{value:t}=n;let a={name:e};if(e.includes("uTroika"))return;if(t.isTexture)i++,a.value=Tv(e,t);else{let e=JSON.stringify(t);try{e=JSON.stringify(t)}catch(r){e=t.toString()}a.value=e}o.set(e,a)}})),i>0&&n(i),a(o)}}),[]),We.jsx(Tm,{children:i&&Array.from(i.values()).map((e=>We.jsx("span",{children:"string"==typeof e.value?We.jsx("li",{children:We.jsxs("span",{children:[e.name," :"," ",We.jsxs("b",{children:[e.value.substring(0,30),e.value.length>30?"...":""]})]})}):We.jsxs(We.Fragment,{children:[We.jsx("li",{children:We.jsxs("b",{children:[e.value.name,":"]})}),We.jsxs("div",{children:[Object.keys(e.value).map((t=>"name"!==t?We.jsx("div",{children:"url"===t?We.jsx("a",{href:e.value[t],target:"_blank",children:We.jsx("img",{src:e.value[t]})}):We.jsxs("li",{children:[t,": ",We.jsx("b",{children:e.value[t]})]})},t):null)),We.jsxs(Em,{onClick:()=>{var n;console.info(t[e.value.name]||(null==(n=null==t?void 0:t.uniforms[e.value.name])?void 0:n.value))},children:["console.info(",e.value.name,");"]})]})]})},e.name)))})},Cv=({el:e})=>{Yh((e=>e.log));const t=Yh((e=>e.gl));return We.jsx(We.Fragment,{children:e.drawCounts.total>0&&We.jsxs(hm,{style:{height:"auto",width:"auto",margin:"0 4px"},children:["Triangle"===e.drawCounts.type?We.jsx(yv,{style:{top:"-1px"}}):We.jsx(Im,{style:{top:"-1px"}}),e.drawCounts.total,We.jsxs("small",{children:[e.drawCounts.type,"s"]}),t&&We.jsxs(mm,{style:{bottom:"-10px",width:"40px",fontWeight:"bold"},children:[e.visible&&!e.material.wireframe?(e=>{if(!t)return 0;const n=Math.round(e.drawCounts.total/(t.info.render.triangles+t.info.render.lines+t.info.render.points)*100*10)/10;return isFinite(n)&&n||0})(e):0,"%"]})]})})},Rv=({el:e})=>{const[t,n]=ve.useState(e.visible),[r,i]=ve.useState(e.expand),[a,o]=ve.useState(0),{meshes:s,program:l,material:c}=e;return We.jsxs(Lm,{children:[We.jsxs(gm,{onClick:()=>{e.expand=!r,Object.keys(s).forEach((e=>{s[e].material.wireframe=!1})),i(!r)},children:[We.jsx(bm,{style:{marginRight:"6px"},children:r?We.jsx("span",{children:We.jsx(mv,{})}):We.jsx("span",{children:We.jsx(gv,{})})}),l&&We.jsxs("span",{children:[We.jsx(Sm,{children:l.name}),We.jsxs(hm,{style:{height:"auto",width:"auto",margin:"0 4px"},children:[We.jsx(Jm,{style:{top:"-1px"}}),Object.keys(s).length,We.jsx("small",{children:Object.keys(s).length>1?"users":"user"})]}),a>0&&We.jsxs(hm,{style:{height:"auto",width:"auto",margin:"0 4px"},children:[We.jsx(Zm,{style:{top:"-1px"}}),a,We.jsx("small",{children:"tex"})]}),We.jsx(Cv,{el:e}),"300 es"===c.glslVersion&&We.jsxs(hm,{style:{height:"auto",width:"auto",margin:"0 4px"},children:[We.jsx(cv,{style:{top:"-1px"}}),"300",We.jsx("small",{children:"es"}),We.jsx(mm,{style:{bottom:"-10px",width:"40px"},children:"glsl"})]})]}),We.jsx(_m,{onPointerEnter:()=>{Object.keys(s).forEach((e=>{s[e].material.wireframe=!0}))},onPointerLeave:()=>{Object.keys(s).forEach((e=>{s[e].material.wireframe=!1}))},onClick:r=>{r.stopPropagation(),Object.keys(s).forEach((r=>{const i=s[r],a=!t;i.visible=a,e.visible=a,n(a)}))},children:t?We.jsx(Ym,{}):We.jsx(Xm,{})})]}),We.jsxs("div",{style:{maxHeight:r?"9999px":0,overflow:"hidden"},children:[We.jsxs(Am,{children:[We.jsx(Gm,{})," Uniforms:"]}),We.jsx(Ev,{program:l,material:c,setTexNumber:o}),We.jsxs(Am,{children:[We.jsx(Dm,{})," Geometries:"]}),We.jsx(Tm,{children:s&&Object.keys(s).map((e=>s[e]&&s[e].geometry&&We.jsxs(Rm,{children:[We.jsxs("span",{children:[s[e].geometry.type,": "]}),s[e].userData&&s[e].userData.drawCount&&We.jsxs("b",{children:[We.jsxs("div",{children:[s[e].userData.drawCount.count,We.jsxs("small",{children:[" ",s[e].userData.drawCount.type,"s"]})]}),We.jsx("br",{}),We.jsxs("div",{children:[Math.round(Av(s[e].geometry)/1024*1e3)/1e3,"Kb",We.jsx("small",{children:" memory used"})]})]})]},e)))}),We.jsxs(Em,{onClick:()=>{console.info(c)},children:["console.info(",c.type,")"]})]})]})},Pv=()=>{Yh((e=>e.triggerProgramsUpdate));const e=Yh((e=>e.programs));return We.jsx(Mm,{children:e&&Array.from(e.values()).map((e=>e&&e?We.jsx(Rv,{el:e},e.material.uuid):null))})},Fv=e=>({overClock:"#ff6eff",fps:e?"100, 143, 255":"238,38,110",cpu:e?"254, 254, 98":"66,226,46",gpu:e?"254,254,254":"253,151,31",custom:e?"86,180,233":"40,255,255"}),Iv=({showGraph:e,colorBlind:t})=>{const n=Yh((e=>e.overclockingFps)),r=Yh((e=>e.fpsLimit));return We.jsxs(mm,{style:e?{color:n?Fv(t).overClock.toString():`rgb(${Fv(t).fps})`}:{},children:["FPS ",n?`${r}🚀`:""]})},Nv=({showGraph:e,colorBlind:t,customData:n,minimal:r})=>{const i=Yh((e=>e.gl));return i?We.jsxs(vm,{children:[We.jsxs(hm,{children:[We.jsx(tv,{}),We.jsx(mm,{style:e?{color:`rgb(${Fv(t).gpu.toString()})`}:{},children:"GPU"}),We.jsx(pm,{children:"ms"})]}),We.jsxs(hm,{children:[We.jsx(dv,{}),We.jsx(mm,{style:e?{color:`rgb(${Fv(t).cpu.toString()})`}:{},children:"CPU"}),We.jsx(pm,{children:"ms"})]}),We.jsxs(hm,{children:[We.jsx(Km,{}),We.jsx(Iv,{showGraph:e,colorBlind:t})]}),!r&&i&&We.jsxs(hm,{children:[We.jsx(pv,{}),We.jsx(mm,{children:1===i.info.render.calls?"call":"calls"})]}),!r&&i&&We.jsxs(hm,{children:[We.jsx(yv,{}),We.jsx(mm,{children:"Triangles"})]}),n&&We.jsxs(hm,{children:[We.jsx(Um,{}),We.jsx(mm,{style:e?{color:`rgb(${Fv(t).custom})`}:{},children:n.name}),n.info&&We.jsx(pm,{children:n.info})]})]}):null},Uv=({showGraph:e,colorBlind:t,deepAnalyze:n,customData:r,matrixUpdate:i,openByDefault:a,minimal:o})=>We.jsxs(We.Fragment,{children:[We.jsx(Nv,{showGraph:e,colorBlind:t,customData:r,minimal:o}),!o&&We.jsx(Bv,{matrixUpdate:i,openByDefault:a,deepAnalyze:n,showGraph:e})]}),zv=({matrixUpdate:e})=>We.jsxs("div",{children:[We.jsxs(hm,{children:[We.jsx(rv,{}),We.jsx(mm,{children:"Geometries"})]}),We.jsxs(hm,{children:[We.jsx(Zm,{}),We.jsx(mm,{children:"Textures"})]}),We.jsxs(hm,{children:[We.jsx(Im,{}),We.jsx(mm,{children:"shaders"})]}),We.jsxs(hm,{children:[We.jsx(av,{}),We.jsx(mm,{children:"Lines"})]}),We.jsxs(hm,{children:[We.jsx(Om,{}),We.jsx(mm,{children:"Points"})]}),e&&We.jsxs(hm,{children:[We.jsx(Vm,{}),We.jsx(mm,{children:"Matrices"})]})]}),Gv=({tab:e,title:t,set:n})=>{const r=Yh((e=>e.tab));return We.jsx(bm,{className:""+(r===e?" __perf_toggle_tab_active":""),onClick:()=>{n(!0),Zh({tab:e})},children:We.jsx("span",{children:t})})},Bv=({openByDefault:e,showGraph:t,deepAnalyze:n,matrixUpdate:r})=>{const[i,a]=ye.useState(e);return We.jsxs("span",{children:[We.jsx(Dv,{show:i,showGraph:t,matrixUpdate:r}),e&&!n?null:We.jsxs(Cm,{className:"__perf_toggle",children:[n&&We.jsx(Gv,{tab:"programs",title:"Programs",set:a}),n&&We.jsx(Gv,{tab:"infos",title:"Infos",set:a}),We.jsx(bm,{onClick:()=>{a(!i)},children:i?We.jsxs("span",{children:[We.jsx(mv,{})," Minimize"]}):We.jsxs("span",{children:[We.jsx(gv,{})," More"]})})]})]})},Dv=({show:e,showGraph:t,matrixUpdate:n})=>{const r=Yh((e=>e.tab));return We.jsxs(We.Fragment,{children:[We.jsx(zv,{matrixUpdate:n}),e&&We.jsx("div",{children:We.jsx(wm,{style:{marginTop:t?"38px":0},children:"programs"===r&&We.jsx(Pv,{})})})]})},kv=({showGraph:e=!0,colorBlind:t=!1,openByDefault:n=!0,className:r,overClock:i=!1,style:a,position:o="top-right",chart:s,logsPerSecond:l,deepAnalyze:c=!1,antialias:u=!0,customData:d,matrixUpdate:f,minimal:p})=>{const h=ve.useRef(null);return We.jsxs(We.Fragment,{children:[We.jsx(dm,{logsPerSecond:l,chart:s,overClock:i,deepAnalyze:c,matrixUpdate:f}),We.jsx(Mv,{name:"r3f-perf",children:We.jsxs(fm,{className:(r?" ".concat(r):" ")+` ${o||""} ${p?"minimal":""}`,style:{minHeight:p?"37px":e?"100px":"60px",...a},ref:h,children:[We.jsx(Sv,{perfContainerRef:h,colorBlind:t,chart:s,showGraph:e,antialias:u,customData:d,minimal:p,matrixUpdate:f}),We.jsx(Uv,{colorBlind:t,showGraph:e,deepAnalyze:c,openByDefault:n,customData:d,matrixUpdate:f,minimal:p})]})})]})};
/*
@license
MIT license statement included in LGLTracer:

GLSL-PathTracer:
Copyright 2019-2021 Asif Ali. MIT License

ray-tracing-renderer:
Copyright 2019 HOVER. MIT License

LGLTracer is not open source, but for this closed source version, you can use it freely (including commercially). 
If you have any questions, please feel free to contact me by email(lg2lugang@gmail.com).
*/
var Ov=Object.defineProperty,jv=Object.defineProperties,Vv=Object.getOwnPropertyDescriptors,Hv=Object.getOwnPropertySymbols,Xv=Object.prototype.hasOwnProperty,Wv=Object.prototype.propertyIsEnumerable,Yv=(e,t,n)=>t in e?Ov(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$v=(e,t)=>{for(var n in t||(t={}))Xv.call(t,n)&&Yv(e,n,t[n]);if(Hv)for(var n of Hv(t))Wv.call(t,n)&&Yv(e,n,t[n]);return e};function Zv(e,t){const n={};for(const r of t)n[r]=e.getExtension(r);for(let r in n)if(!n[r])return console.error(`${r} no supported!`),!1;return n}function Qv(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const{name:r}=e.getActiveAttrib(t,i);r&&(n[r]=e.getAttribLocation(t,r))}return n}function Kv(e,t,n){return Math.min(Math.max(e,t),n)}function qv(e,t){return function(e,t,n=1e-4){for(let r=0;r<e.length;r++)if(Math.abs(e[r]-t[r])>n)return!1;return!0}(e.matrixWorld.elements,t.matrixWorld.elements)&&e.aspect===t.aspect&&e.fov===t.fov}const Jv=["EXT_color_buffer_float","EXT_float_blend"],eg=["OES_texture_float_linear"];function tg(e,{color:t,depth:n}){const r=e.createFramebuffer();function i(){e.bindFramebuffer(e.FRAMEBUFFER,r)}function a(){e.bindFramebuffer(e.FRAMEBUFFER,null)}return function(){i();const r=[];for(let n in t){n=Number(n),void 0===n&&console.error("invalid location");const i=t[n];e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,i.target,i.texture,0),r.push(e.COLOR_ATTACHMENT0+n)}e.drawBuffers(r),n&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,n.target,n.texture),a()}(),{color:t,bind:i,unbind:a,dispose:function(){e.deleteFramebuffer(r)}}}var ng={source:"layout(location=0)in vec2 a_position;out vec2 vCoord;void main(){vCoord=a_position;gl_Position=vec4(2.*a_position-1.,0,1);}"};let rg;function ig(e,t){return{values:`uniform${e}${t}`,array:`uniform${e}${t}v`}}function ag(e,t){return{matrix:e===t?`uniformMatrix${e}fv`:`uniformMatrix${e}x${t}fv`}}function og(e){let t={};for(let n=0;n<e.length;n++)t[e[n]]=n;return t}function sg(e,t,n,r){let i="#version 300 es\nprecision mediump float;\nprecision mediump int;\nprecision lowp isampler2D;\n";return r&&(i+=function(e){let t="";for(const n in e){const r=e[n];r&&(t+=`#define ${n} ${r}\n`)}return t}(r)),t===e.FRAGMENT_SHADER&&n.outputs&&(i+=function(e){let t="";const n=og(e);for(let r in n)t+=`layout(location = ${n[r]}) out vec4 out_${r};\n`;return t}(n.outputs)),n.includes&&(i+=function(e,t){let n="";for(let r of e)n+="function"==typeof r?r(t):r;return n}(n.includes,r)),"function"==typeof n.source?i+=n.source(r):i+=n.source,function(e,t,n){const r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))return r;const i=n.split("\n").map(((e,t)=>`${t+1}: ${e}`)).join("\n");throw console.log(i),e.getShaderInfoLog(r)}(e,t,i)}function lg(e,{defines:t,vertex:n}){return sg(e,e.VERTEX_SHADER,n,t)}function cg(e,t){const{fragment:n,vertex:r}=t,i=function(e,t,n,r,i){const a=e.createProgram();if(e.attachShader(a,t),e.attachShader(a,n),e.linkProgram(a),e.detachShader(a,t),e.detachShader(a,n),e.getProgramParameter(a,e.LINK_STATUS))return a;throw e.getProgramInfoLog(a)}(e,r instanceof WebGLShader?r:lg(e,t),n instanceof WebGLShader?n:function(e,{defines:t,fragment:n}){return sg(e,e.FRAGMENT_SHADER,n,t)}(e,t));return a=$v({},function(e,t){const n=function(e,t){const n=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;i++){const{name:r,type:a}=e.getActiveUniform(t,i),o=e.getUniformLocation(t,r);o&&(n[r]={type:a,location:o})}return n}(e,t),r={},i=[];for(let s in n){const{type:e,location:t}=n[s],i={type:e,location:t,v0:0,v1:0,v2:0,v3:0};r[s]=i}const a=new Set;return rg=rg||{[(o=e).FLOAT]:ig(1,"f"),[o.FLOAT_VEC2]:ig(2,"f"),[o.FLOAT_VEC3]:ig(3,"f"),[o.FLOAT_VEC4]:ig(4,"f"),[o.INT]:ig(1,"i"),[o.INT_VEC2]:ig(2,"i"),[o.INT_VEC3]:ig(3,"i"),[o.INT_VEC4]:ig(4,"i"),[o.SAMPLER_2D]:ig(1,"i"),[o.SAMPLER_2D_ARRAY]:ig(1,"i"),[o.FLOAT_MAT2]:ag(2,2),[o.FLOAT_MAT3]:ag(3,3),[o.FLOAT_MAT4]:ag(4,4)},{setUniform:function(e,t,n,o,s){const l=r[e];l?(l.v0=t,l.v1=n,l.v2=o,l.v3=s,i.push(l)):a.has(e)||a.add(e)},upload:function(){for(;i.length>0;){const{type:t,location:n,v0:r,v1:a,v2:o,v3:s}=i.pop(),l=rg[t];if(r&&r.length)if(l.matrix){const t=r,i=a||!1;e[l.matrix](n,i,t)}else e[l.array](n,r);else e[l.values](n,r,a,o,s)}}};var o}(e,t),r={};let i=1;function a(){for(let t in r){const{tex:n,unit:i}=r[t];e.activeTexture(e.TEXTURE0+i),e.bindTexture(n.target,n.texture)}}return{attribLocs:Qv(e,t),bindTextures:a,program:t,setTexture:function(e,t){if(t)if(r[e])r[e].tex=t;else{const a=i++;n.setUniform(e,a),r[e]={unit:a,tex:t}}},setUniform:n.setUniform,textures:r,useProgram:function(r=!0){e.useProgram(t),n.upload(),r&&a()},dispose:function(){for(const t in r){const{tex:n}=r[t];e.deleteTexture(n.texture)}e.deleteProgram(t)}}}(e,i)),o={outputLocs:n.outputs?og(n.outputs):{}},jv(a,Vv(o));var a,o}function ug(e,t){let{width:n=null,height:r=null,data:i=null,length:a=1,channels:o=null,storage:s=null,flipY:l=!1,gammaCorrection:c=!1,wrapS:u=e.CLAMP_TO_EDGE,wrapT:d=e.CLAMP_TO_EDGE,minFilter:f=e.NEAREST,magFilter:p=e.NEAREST}=t;n=n||i.width||0,r=r||i.height||0;const h=e.createTexture();let m,v;Array.isArray(i)&&(v=i,i=v[0]),m=v||a>1?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D,e.activeTexture(e.TEXTURE0),e.bindTexture(m,h),e.texParameteri(m,e.TEXTURE_WRAP_S,u),e.texParameteri(m,e.TEXTURE_WRAP_T,d),e.texParameteri(m,e.TEXTURE_MIN_FILTER,f),e.texParameteri(m,e.TEXTURE_MAG_FILTER,p),o||(o=i&&i.length?i.length/(n*r):4),o=Kv(o,1,4);const{type:g,format:x,internalFormat:y}=function(e,t,n,r,i){let a,o;const s=r instanceof Uint8Array||r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof ImageData||r instanceof ImageBitmap,l=r instanceof Float32Array;return"byte"===n||!n&&s?(o={1:e.R8,2:e.RG8,3:i?e.SRGB8:e.RGB8,4:i?e.SRGB8_ALPHA8:e.RGBA8}[t],a=e.UNSIGNED_BYTE):"float"===n||!n&&l?(o={1:e.R32F,2:e.RG32F,3:e.RGB32F,4:e.RGBA32F}[t],a=e.FLOAT):"halfFloat"===n?(o={1:e.R16F,2:e.RG16F,3:e.RGB16F,4:e.RGBA16F}[t],a=e.HALF_FLOAT):"snorm"===n&&(o={1:e.R8_SNORM,2:e.RG8_SNORM,3:e.RGB8_SNORM,4:e.RGBA8_SNORM}[t],a=e.UNSIGNED_BYTE),{format:dg(e,t),internalFormat:o,type:a}}(e,o,s,i,c);if(v){e.texStorage3D(m,1,y,n,r,v.length);for(let t=0;t<v.length;t++){const i=v[t].width||n,a=v[t].height||r;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,Array.isArray(l)?l[t]:l),e.texSubImage3D(m,0,0,0,t,i,a,1,x,g,v[t])}}else a>1?e.texStorage3D(m,1,y,n,r,a):(e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,l),e.texStorage2D(m,1,y,n,r),i&&e.texSubImage2D(m,0,0,0,n,r,x,g,i));return e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),{target:m,texture:h}}function dg(e,t){return{1:e.RED,2:e.RG,3:e.RGB,4:e.RGBA}[t]}class fg extends F{constructor(){super(),this.materialType=null,this.isRayTracingMaterial=!0}copy(e){super.copy(e),this.materialType=e.materialType,this.isRayTracingMaterial=e.isRayTracingMaterial}}class pg extends fg{constructor(e){super(),this.materialType="Disney",this.workflow="Metalness",this.color=new t(16777215),this.roughness=.5,this.metalness=0,this.map=null,this.emissive=new t(0),this.emissiveMap=null,this.normalMap=null,this.normalScale=new l(1,1),this.roughnessMap=null,this.metalnessMap=null,this.specularTint=0,this.sheen=0,this.sheenTint=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.subsurface=0,this.alpha=1,this.ior=1.5,this.transmission=0,this.atDistance=1,this.extinction=new t(16777215),this.anisotropic=0,this.specularColor=new t(16777215),this.glossiness=1,this.specularMap=null,this.glossinessMap=null,this.setValues(e)}copy(e){return this.color=(new t).copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.emissive=(new t).copy(e.emissive),this.emissiveMap=e.emissiveMap,this.normalMap=e.normalMap,this.normalScale=(new l).copy(e.normalScale),this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.specularTint=e.specularTint,this.sheen=e.sheen,this.sheenTint=e.sheenTint,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,this.subsurface=e.subsurface,this.transmission=e.transmission,this.ior=e.ior,this.atDistance=e.atDistance,this.anisotropic=e.anisotropic,this.extinction=(new t).copy(e.extinction),this.alpha=e.alpha,this}clone(){return(new this.constructor).copy(this)}fromBasicMaterial(e){return this.name=e.name,e.color&&this.color.copy(e.color),e.map&&(this.map=e.map),this}fromStandardMaterial(e){return this.name=e.name,this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.transmission=e.transmission||0,this.ior=e.ior||1.5,this.clearcoat=e.clearcoat||0,this.clearcoatRoughness=e.clearcoatRoughness||0,this.sheen=e.sheen||0,this.sheenTint=e.sheenTint||.5,this.alpha=e.opacity,this.map=e.map,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,e.isGLTFSpecularGlossinessMaterial&&(this.workflow="Specular",this.specularColor.copy(e.specular),this.glossiness=e.glossiness,this.specularMap=e.specularMap,this.glossinessMap=e.glossinessMap),this}}function hg(e,t){const n=[],r=[];e.traverse((e=>{e.isMesh&&(e.geometry?e.material?(e.material.isMeshStandardMaterial?e.material=(new pg).fromStandardMaterial(e.material):e.material.isRayTracingMaterial||(e.material=(new pg).fromBasicMaterial(e.material)),n.push(e)):console.warn(e,"must have a material property."):console.warn(e,"must have a geometry property")),e.isLight&&r.push(e)}));const i={data:e.environment,intensity:e.envMapIntensity||1},a=i.data&&i.data.isTexture,o=r.length||0;let s=null;o&&(s=function(e){const t={};return t.position=e.map((e=>e.position)),t.emission=e.map((e=>e.emission)),t.p1=e.map((e=>e.p1)),t.p2=e.map((e=>e.p2)),t.radius=e.map((e=>e.radius)),t.area=e.map((e=>e.area)),t.type=e.map((e=>e.type)),t.visible=e.map((e=>e.visible)),t.position=[].concat(...t.position.map((e=>e.toArray()))),t.emission=[].concat(...t.emission.map((e=>e.toArray()))),t.p1=[].concat(...t.p1.map((e=>e.toArray()))),t.p2=[].concat(...t.p2.map((e=>e.toArray()))),t.params=function(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r],i=n.data?n.data.length/n.channels:0;t=Math.max(t,i)}const n=[];for(let r=0;r<t;r++)for(let t=0;t<e.length;t++){const{data:i=[],channels:a}=e[t];for(let e=0;e<a;e++)n.push(i[r*a+e])}return n}({data:t.radius,channels:1},{data:t.area,channels:1},{data:t.type,channels:1},{data:t.visible,channels:1}),t}(r.map((e=>{const t={},n=new h;switch(e.getWorldPosition(n),t.position=n,t.emission=e.color.multiplyScalar(e.intensity),t.radius=e.radius||0,t.area=0,t.visible=Number(e.visible),t.p1=new h,t.p2=new h,e.type){case"RectAreaLight":if(t.type=0,e.width&&e.height){const n=new fe(e.width,e.height),r=new h;e.target&&r.copy(e.target);const i=(new h).subVectors(e.position,r),a=(new h).copy(i).negate();n.lookAt(a);const o=n.attributes.position.array,s=new h(o[0],o[1],o[2]).add(e.position);new h(o[3],o[4],o[5]).add(e.position);const l=new h(o[6],o[7],o[8]).add(e.position),c=new h(o[9],o[10],o[11]).add(e.position);t.position.copy(l),t.p1=c.sub(l),t.p2=s.sub(l),t.area=(new h).crossVectors(t.p1,t.p2).length()}break;case"QuadLight":t.type=1,t.p1=e.v1.sub(e.position),t.p2=e.v2.sub(e.position),t.area=(new h).crossVectors(t.p1,t.p2).length();break;case"SphereAreaLight":t.type=2,t.area=4*Math.PI*e.radius*e.radius;break;case"PointLight":t.type=4,t.area=0;break;case"DirectionalLight":t.type=3,e.target&&t.p1.copy(e.target),t.area=0;break;default:console.warn(`Not support light type: ${e.type}`)}return t}))));const l=new Map;for(const c of n){if(!c.visible)continue;const e=c.material;let t=l.get(e);void 0===t&&(t=l.size,l.set(e,t))}return{environment:i,isTextureEnv:a,camera:t,meshes:n,meshLights:s,meshLightsNum:o,materialIndexMap:l,materials:Array.from(l.keys())}}function mg(e,t){const n=new R;for(const i of t){const t=e.getAttribute(i);t&&("function"!=typeof n.setAttribute&&(n.setAttribute=n.addAttribute),n.setAttribute(i,t.clone()))}const r=e.getIndex();return r&&n.setIndex(r),n}function vg(e){const t=e.getAttribute("position");if(!t)return void console.warn("No position attribute");const n=new Uint32Array(t.count);for(let r=0;r<n.length;r++)n[r]=r;return e.setIndex(new P(n,1,!1)),e}function gg(e,t,n,r,i,a,o){const s=Math.min(o.length/a,n);for(let l=0;l<s;l++)for(let n=0;n<a;n++)e[t](r+l*i+4*n,o[a*l+n],!0)}function xg(e,t){const n={textures:[],indices:{}};for(const r of t)n.indices[r]=yg(e,r,n.textures);return n}function yg(e,t,n){const r=[];for(const i of e)if(i[t]&&i[t].image){let e=n.length;for(let r=0;r<n.length;r++)if(n[r]===i[t]){e=r;break}e===n.length&&n.push(i[t]),r.push(e)}else r.push(-1);return r}function bg(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r],i=n.data?n.data.length/n.channels:0;t=Math.max(t,i)}const n=[];for(let r=0;r<t;r++)for(let t=0;t<e.length;t++){const{data:i=[],channels:a}=e[t];for(let e=0;e<a;e++)n.push(i[r*a+e])}return n}function _g(e,t,n=!1,r=3){const i=t.map((e=>e.image)),a=t.map((e=>e.flipY)),{maxSize:o,relativeSizes:s}=function(e){const t={width:0,height:0};for(const r of e)t.width=Math.max(t.width,r.width),t.height=Math.max(t.height,r.height);const n=[];for(const r of e)n.push(r.width/t.width),n.push(r.height/t.height);return{maxSize:t,relativeSizes:n}}(i);return{texture:ug(e,{width:o.width,height:o.height,gammaCorrection:n,data:i,flipY:a,channels:r,minFilter:e.LINEAR,magFilter:e.LINEAR}),relativeSizes:s}}function Lg(e,t){const n=function(e,t){const n={};for(const r of["map","normalMap","emissiveMap"]){const t=[];n[r]={indices:yg(e,r,t),textures:t}}return n}(t),r=xg(t,["roughnessMap","metalnessMap"]),i=xg(t,["specularMap","glossinessMap"]),a={},o={};if(o.color=t.map((e=>e.color)),o.roughness=t.map((e=>e.roughness)),o.metalness=t.map((e=>e.metalness)),o.normalScale=t.map((e=>e.normalScale)),o.specularTint=t.map((e=>e.specularTint)),o.sheen=t.map((e=>e.sheen)),o.sheenTint=t.map((e=>e.sheenTint)),o.clearcoat=t.map((e=>e.clearcoat)),o.clearcoatRoughness=t.map((e=>e.clearcoatRoughness)),o.transmission=t.map((e=>e.transmission)),o.subsurface=t.map((e=>e.subsurface)),o.ior=t.map((e=>e.ior)),o.atDistance=t.map((e=>e.atDistance)),o.extinction=t.map((e=>e.extinction)),o.alpha=t.map((e=>e.alpha)),o.workflow=t.map((e=>"Metalness"===e.workflow?0:1)),o.specularColor=t.map((e=>e.specularColor)),o.glossiness=t.map((e=>e.glossiness)),o.type=t.map((e=>0)),n.map.textures.length>0){const{relativeSizes:t,texture:r}=_g(e,n.map.textures,!0,4);a.diffuseMap=r,o.diffuseMapSize=t,o.diffuseMapIndex=n.map.indices}if(n.normalMap.textures.length>0){const{relativeSizes:t,texture:r}=_g(e,n.normalMap.textures,!1);a.normalMap=r,o.normalMapSize=t,o.normalMapIndex=n.normalMap.indices}if(r.textures.length>0){const{relativeSizes:t,texture:n}=_g(e,r.textures,!1);a.pbrMap=n,o.pbrMapSize=t,o.roughnessMapIndex=r.indices.roughnessMap,o.metalnessMapIndex=r.indices.metalnessMap}if(i.textures.length>0){const{relativeSizes:t,texture:n}=_g(e,i.textures,!1,4);a.pbrSGMap=n,o.pbrMapSize=t,o.specularMapIndex=i.indices.specularMap,o.glossinessMapIndex=i.indices.glossinessMap}if(n.emissiveMap.textures.length>0){const{relativeSizes:t,texture:r}=_g(e,n.emissiveMap.textures,!0);a.emissiveMap=r,o.pbrMapSize||(o.pbrMapSize=t),o.emissiveMapIndex=n.emissiveMap.indices}const s={NUM_MATERIALS:t.length,NUM_DIFFUSE_MAPS:n.map.textures.length,NUM_NORMAL_MAPS:n.normalMap.textures.length,NUM_DIFFUSE_NORMAL_MAPS:Math.max(n.map.textures.length,n.normalMap.textures.length),NUM_PBR_MAPS:r.textures.length,NUM_PBR_SG_MAPS:i.textures.length,NUM_EMISSIVE_MAPS:n.emissiveMap.textures.length},l=cg(e,{vertex:{source:"void main() {}"},fragment:{includes:["uniform Materials {\r\n\tvec4 colorAndMaterialType[NUM_MATERIALS];\r\n\tvec4 roughnessMetalnessNormalScale[NUM_MATERIALS];\r\n\tvec4 alphaSpecularTintSheenSheenTint[NUM_MATERIALS];\r\n\tvec4 clearcoaRoughnessSubfaceTransmission[NUM_MATERIALS];\r\n\tvec4 iorAtDistanceAnisotropicWorkflow[NUM_MATERIALS];\r\n\tvec4 extinction[NUM_MATERIALS];\r\n\tvec4 specularColorGlossiness[NUM_MATERIALS];\r\n\r\n\t#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS) || defined(NUM_PBR_MAPS)\r\n\t\tivec4 diffuseNormalRoughnessMetalnessMapIndex[NUM_MATERIALS];\r\n\t#endif\r\n\r\n\t#if defined(NUM_EMISSIVE_MAPS) || defined(NUM_PBR_SG_MAPS)\r\n\t\tivec4 emissiveSpecularGlossinessMapIndex[NUM_MATERIALS];\r\n\t#endif\r\n\r\n\t#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS)\r\n\t\tvec4 diffuseNormalMapSize[NUM_DIFFUSE_NORMAL_MAPS];\r\n\t#endif\r\n\r\n\t#if defined(NUM_PBR_MAPS)\r\n\t\tvec2 pbrMapSize[NUM_PBR_MAPS];\r\n\t#else\r\n\t\t#if defined(NUM_PBR_SG_MAPS)\r\n\t\t\tvec2 pbrMapSize[NUM_PBR_SG_MAPS];\r\n\t\t#else\r\n\t\t\t#if defined(NUM_EMISSIVE_MAPS)\r\n\t\t\t\tvec2 pbrMapSize[NUM_EMISSIVE_MAPS];\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t#endif\r\n} materials;\r\n\r\n#ifdef NUM_DIFFUSE_MAPS\r\n\tuniform mediump sampler2DArray diffuseMap;\r\n#endif\r\n\r\n#ifdef NUM_NORMAL_MAPS\r\n\tuniform mediump sampler2DArray normalMap;\r\n#endif\r\n\r\n#ifdef NUM_PBR_MAPS\r\n\tuniform mediump sampler2DArray pbrMap;\r\n#endif\r\n\r\n#ifdef NUM_PBR_SG_MAPS\r\n\tuniform mediump sampler2DArray pbrSGMap;\r\n#endif\r\n\r\n#ifdef NUM_EMISSIVE_MAPS\r\n\tuniform mediump sampler2DArray emissiveMap;\r\n#endif\r\n\r\nfloat getMatType(int materialIndex) {\r\n\treturn materials.colorAndMaterialType[materialIndex].w;\r\n}\r\n\r\nfloat getMatWorkflow(int materialIndex) {\r\n\treturn materials.iorAtDistanceAnisotropicWorkflow[materialIndex].w;\r\n}\r\n\r\nvec3 getMatEmissive(int materialIndex, vec2 uv) {\r\n\tvec3 emissive = vec3(0.0);\r\n\r\n\t#ifdef NUM_EMISSIVE_MAPS\r\n\t\tint emissiveMapIndex = materials.emissiveSpecularGlossinessMapIndex[materialIndex].x;\r\n\t\tif (emissiveMapIndex >= 0) {\r\n\t\t\temissive = texture(emissiveMap, vec3(uv * materials.pbrMapSize[emissiveMapIndex].xy, emissiveMapIndex)).rgb;\r\n\t\t}\r\n\t#endif\r\n\t\r\n\treturn emissive;\r\n}\r\n\r\nvec3 getMatSpecularColor(int materialIndex, vec2 uv) {\r\n\tvec3 specularColor = materials.specularColorGlossiness[materialIndex].rgb;\r\n\r\n\t#ifdef NUM_PBR_SG_MAPS\r\n\t\tint specularMapIndex = materials.emissiveSpecularGlossinessMapIndex[materialIndex].y;\r\n\t\tif (specularMapIndex >= 0) {\r\n\t\t\tvec3 texelSpecular = texture(pbrSGMap, vec3(uv * materials.pbrMapSize[specularMapIndex].xy, specularMapIndex)).rgb;\r\n\t\t\ttexelSpecular = pow(texelSpecular, vec3(2.2));\r\n\t\t\tspecularColor *= texelSpecular;\r\n\t\t}\r\n\t#endif\r\n\r\n\treturn specularColor;\r\n}\r\n\r\nfloat getMatGlossiness(int materialIndex, vec2 uv) {\r\n\tfloat glossiness = materials.specularColorGlossiness[materialIndex].a;\r\n\t#ifdef NUM_PBR_SG_MAPS\r\n\t\tint glossinessMapIndex = materials.emissiveSpecularGlossinessMapIndex[materialIndex].z;\r\n\t\tif (glossinessMapIndex >= 0) {\r\n\t\t\tfloat texelGlossiness = texture(pbrSGMap, vec3(uv * materials.pbrMapSize[glossinessMapIndex].xy, glossinessMapIndex)).a;\r\n\t\t\tglossiness *= texelGlossiness;\r\n\t\t}\r\n\t#endif\r\n\treturn glossiness;\r\n}\r\n\r\nfloat getMatRoughness(int materialIndex, vec2 uv) {\r\n\tfloat workflow = getMatWorkflow(materialIndex);\r\n\tfloat roughness = 0.0;\r\n\tif (workflow > 0.1) {\r\n\t\troughness = 1.0 - getMatGlossiness(materialIndex, uv);\r\n\t} else {\r\n\t\troughness = materials.roughnessMetalnessNormalScale[materialIndex].x;\r\n\r\n\t\t#ifdef NUM_PBR_MAPS\r\n\t\t\tint roughnessMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].z;\r\n\t\t\tif (roughnessMapIndex >= 0) {\r\n\t\t\t\troughness *= texture(pbrMap, vec3(uv * materials.pbrMapSize[roughnessMapIndex].xy, roughnessMapIndex)).g;\r\n\t\t\t}\r\n\t\t#endif\r\n\t}\r\n\t// Remap\r\n\treturn roughness * roughness;\r\n}\r\n\r\nfloat max3(const vec3 v) {\r\n\treturn max(v.x, max(v.y, v.z));\r\n}\r\n\r\nfloat computeMetallicFromSpecularColor(const vec3 specularColor) {\r\n\treturn max3(specularColor);\r\n}\r\n\r\nvec3 computeDiffuseColor(const vec3 baseColor, float metallic) {\r\n\treturn baseColor * (1.0 - metallic);\r\n}\r\n\r\nfloat getMatMetalness(int materialIndex, vec2 uv) {\r\n\tfloat workflow = getMatWorkflow(materialIndex);\r\n\tfloat metalness = 0.0;\r\n\tif (workflow > 0.1) {\r\n\t\tvec3 specularFactor = getMatSpecularColor(materialIndex, uv);\r\n\t\tmetalness = computeMetallicFromSpecularColor(specularFactor);\r\n\t} else {\r\n\t\tmetalness = materials.roughnessMetalnessNormalScale[materialIndex].y;\r\n\r\n\t\t#ifdef NUM_PBR_MAPS\r\n\t\t\tint metalnessMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].w;\r\n\t\t\tif (metalnessMapIndex >= 0) {\r\n\t\t\t\tmetalness *= texture(pbrMap, vec3(uv * materials.pbrMapSize[metalnessMapIndex].xy, metalnessMapIndex)).b;\r\n\t\t\t}\r\n\t\t#endif\r\n\t}\r\n\r\n\treturn metalness;\r\n}\r\n\r\nvec3 getMatColor(int materialIndex, vec2 uv) {\r\n\t// if (enableAlbedo && bounce == 0) return vec3(1.);\r\n\tvec3 color = materials.colorAndMaterialType[materialIndex].rgb;\r\n\t#ifdef NUM_DIFFUSE_MAPS\r\n\t\tint diffuseMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;\r\n\t\tif (diffuseMapIndex >= 0) {\r\n\t\t\tcolor *= texture(diffuseMap, vec3(uv * materials.diffuseNormalMapSize[diffuseMapIndex].xy, diffuseMapIndex)).rgb;\r\n\t\t}\r\n\t#endif\r\n\r\n\tfloat workflow = getMatWorkflow(materialIndex);\r\n\tif (workflow > 0.1) {\r\n\t\tvec3 specularFactor = getMatSpecularColor(materialIndex, uv);\r\n\t\tcolor = computeDiffuseColor(color, computeMetallicFromSpecularColor(specularFactor));\r\n\t}\r\n\r\n\treturn color;\r\n}\r\n\r\nvec3 getMatNormal(int materialIndex, vec2 uv, vec3 normal, vec3 dp1, vec3 dp2, vec2 duv1, vec2 duv2, inout vec3 tangent, inout vec3 bitangent) {\r\n\t// http://www.thetenthplanet.de/archives/1180\r\n\t// Compute co-tangent and co-bitangent vectors\r\n\tvec3 dp2perp = cross(dp2, normal);\r\n\tvec3 dp1perp = cross(normal, dp1);\r\n\tvec3 dpdu = dp2perp * duv1.x + dp1perp * duv2.x;\r\n\tvec3 dpdv = dp2perp * duv1.y + dp1perp * duv2.y;\r\n\tfloat invmax = inversesqrt(max(dot(dpdu, dpdu), dot(dpdv, dpdv)));\r\n\tdpdu *= invmax;\r\n\tdpdv *= invmax;\r\n\r\n\t// All world space\r\n\t// /3ed-2018/Materials/BSDFs => WorldToLocal/LocalToWorld\r\n\ttangent = normalize(dpdu);\r\n\tbitangent = normalize(dpdv);\r\n\r\n#ifdef NUM_NORMAL_MAPS\r\n\tint normalMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].y;\r\n\tif (normalMapIndex >= 0) {\r\n\t\tvec3 n = 2.0 * texture(normalMap, vec3(uv * materials.diffuseNormalMapSize[normalMapIndex].zw, normalMapIndex)).rgb - 1.0;\r\n\t\tn.xy *= materials.roughnessMetalnessNormalScale[materialIndex].zw;\r\n\r\n\t\tmat3 tbn = mat3(dpdu, dpdv, normal);\r\n\r\n\t\treturn normalize(tbn * n);\r\n\t} else {\r\n\t\treturn normal;\r\n\t}\r\n#endif\r\n\r\n\treturn normal;\r\n}\r\n\r\n// alphaSpecularTintSheenSheenTint\r\nfloat getMatAlpha(int materialIndex, vec2 uv) {\r\n\tfloat alpha =  materials.alphaSpecularTintSheenSheenTint[materialIndex].x;\r\n\t#ifdef NUM_DIFFUSE_MAPS\r\n\t\tint diffuseMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;\r\n\t\tif (diffuseMapIndex >= 0) {\r\n\t\t\talpha *= texture(diffuseMap, vec3(uv * materials.diffuseNormalMapSize[diffuseMapIndex].xy, diffuseMapIndex)).a;\r\n\t\t}\r\n\t#endif\r\n\treturn alpha;\r\n}\r\n\r\nfloat getMatSpecularTint(int materialIndex) {\r\n\treturn materials.alphaSpecularTintSheenSheenTint[materialIndex].y;\r\n}\r\n\r\nfloat getMatSheen(int materialIndex) {\r\n\treturn materials.alphaSpecularTintSheenSheenTint[materialIndex].z;\r\n}\r\n\r\nfloat getMatSheenTint(int materialIndex) {\r\n\treturn materials.alphaSpecularTintSheenSheenTint[materialIndex].w;\r\n}\r\n\r\n// clearcoaRoughnessSubfaceTransmission\r\nfloat getMatClearcoat(int materialIndex) {\r\n\treturn materials.clearcoaRoughnessSubfaceTransmission[materialIndex].x;\r\n}\r\n\r\nfloat getMatClearcoatRoughness(int materialIndex) {\r\n\treturn materials.clearcoaRoughnessSubfaceTransmission[materialIndex].y;\r\n}\r\n\r\nfloat getMatSubface(int materialIndex) {\r\n\treturn materials.clearcoaRoughnessSubfaceTransmission[materialIndex].z;\r\n}\r\n\r\nfloat getMatTransmission(int materialIndex) {\r\n\treturn materials.clearcoaRoughnessSubfaceTransmission[materialIndex].w;\r\n}\r\n\r\n// iorAtDistanceAnisotropicWorkflow\r\nfloat getMatIOR(int materialIndex) {\r\n\treturn materials.iorAtDistanceAnisotropicWorkflow[materialIndex].x;\r\n}\r\n\r\nfloat getMatAtDistance(int materialIndex) {\r\n\treturn materials.iorAtDistanceAnisotropicWorkflow[materialIndex].y;\r\n}\r\n\r\nfloat getMatAnisotropic(int materialIndex) {\r\n\treturn materials.iorAtDistanceAnisotropicWorkflow[materialIndex].z;\r\n}\r\n\r\nvec3 getMatExtinction(int materialIndex) {\r\n\treturn materials.extinction[materialIndex].rgb;\r\n}"],source:"void main() {}"},defines:s}),c=function(e,t,n){const r=function(e,t,n){const r=e.getUniformBlockIndex(t,"Materials"),i=e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_DATA_SIZE),a=function(e,t,n){const r=e.getActiveUniformBlockParameter(t,n,e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),i=e.getActiveUniforms(t,r,e.UNIFORM_OFFSET),a=e.getActiveUniforms(t,r,e.UNIFORM_ARRAY_STRIDE),o={};for(let s=0;s<r.length;s++){const{name:n,type:l,size:c}=e.getActiveUniform(t,r[s]);o[n]={type:l,size:c,offset:i[s],stride:a[s]}}return o}(e,t,r),o=e.createBuffer();e.bindBuffer(e.UNIFORM_BUFFER,o),e.bufferData(e.UNIFORM_BUFFER,i,e.STATIC_DRAW);const s=new DataView(new ArrayBuffer(i));return{set:function(t,n){if(!a[t])return;const{type:r,size:i,offset:o,stride:l}=a[t];switch(r){case e.FLOAT:gg(s,"setFloat32",i,o,l,1,n);break;case e.FLOAT_VEC2:gg(s,"setFloat32",i,o,l,2,n);break;case e.FLOAT_VEC3:gg(s,"setFloat32",i,o,l,3,n);break;case e.FLOAT_VEC4:gg(s,"setFloat32",i,o,l,4,n);break;case e.INT:gg(s,"setInt32",i,o,l,1,n);break;case e.INT_VEC2:gg(s,"setInt32",i,o,l,2,n);break;case e.INT_VEC3:gg(s,"setInt32",i,o,l,3,n);break;case e.INT_VEC4:gg(s,"setInt32",i,o,l,4,n);break;case e.BOOL:gg(s,"setUint32",i,o,l,1,n);break;default:console.warn("UniformBuffer: Unsupported type")}},bind:function(t){e.bindBuffer(e.UNIFORM_BUFFER,o),e.bufferSubData(e.UNIFORM_BUFFER,0,s),e.bindBufferBase(e.UNIFORM_BUFFER,t,o)},dispose:function(){e.deleteBuffer(o)}}}(e,t);return r.set("Materials.colorAndMaterialType[0]",bg({data:[].concat(...n.color.map((e=>e.toArray()))),channels:3},{data:n.type,channels:1})),r.set("Materials.roughnessMetalnessNormalScale[0]",bg({data:n.roughness,channels:1},{data:n.metalness,channels:1},{data:[].concat(...n.normalScale.map((e=>e.toArray()))),channels:2})),r.set("Materials.alphaSpecularTintSheenSheenTint[0]",bg({data:n.alpha,channels:1},{data:n.specularTint,channels:1},{data:n.sheen,channels:1},{data:n.sheenTint,channels:1})),r.set("Materials.clearcoaRoughnessSubfaceTransmission[0]",bg({data:n.clearcoat,channels:1},{data:n.clearcoatRoughness,channels:1},{data:n.subsurface,channels:1},{data:n.transmission,channels:1})),r.set("Materials.iorAtDistanceAnisotropicWorkflow[0]",bg({data:n.ior,channels:1},{data:n.atDistance,channels:1},{data:n.anisotropic,channels:1},{data:n.workflow,channels:1})),r.set("Materials.specularColorGlossiness[0]",bg({data:[].concat(...n.specularColor.map((e=>e.toArray()))),channels:3},{data:n.glossiness,channels:1})),r.set("Materials.extinction[0]",bg({data:[].concat(...n.extinction.map((e=>e.toArray()))),channels:3},{data:n.anisotropic,channels:1})),r.set("Materials.diffuseNormalRoughnessMetalnessMapIndex[0]",bg({data:n.diffuseMapIndex,channels:1},{data:n.normalMapIndex,channels:1},{data:n.roughnessMapIndex,channels:1},{data:n.metalnessMapIndex,channels:1})),r.set("Materials.emissiveSpecularGlossinessMapIndex[0]",bg({data:n.emissiveMapIndex,channels:1},{data:n.specularMapIndex,channels:1},{data:n.glossinessMapIndex,channels:1},{data:n.emissiveMapIndex,channels:1})),r.set("Materials.diffuseNormalMapSize[0]",bg({data:n.diffuseMapSize,channels:2},{data:n.normalMapSize,channels:2})),r.set("Materials.pbrMapSize[0]",n.pbrMapSize),r.bind(0),r}(e,l.program,o);return{defines:s,textures:a,dispose:function(){l.dispose(),c.dispose()}}}class Sg{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}normalize(){return this.divideScalar(this.length()||1)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}class wg{constructor(e=new Sg(1/0,1/0,1/0),t=new Sg(-1/0,-1/0,-1/0)){this.min=e,this.max=t}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}}function Mg(e,t,n){const r=e[n];e[n]=e[t],e[t]=r}let Ag=0,Tg=0,Eg=null,Cg=!1;const Rg=new Sg;function Pg(e,t){return{primitives:e,bounds:t}}function Fg(e,t,n){let r=n[t]-e.min[t];return e.max[t]>e.min[t]&&(r/=e.max[t]-e.min[t]),r}function Ig(e){return e.getSize(Rg),2*(Rg.x*Rg.z+Rg.x*Rg.y+Rg.z*Rg.y)}function Ng(e,t,n){const r=new wg;for(let l=t;l<n;l++)r.union(e[l].bounds);Cg&&(Tg+=1,Eg(Tg/Ag));const i=n-t;if(1===i)return Pg(e.slice(t,n),r);{const l=new wg;for(let r=t;r<n;r++)l.expandByPoint(e[r].center);const c=(l.getSize(Rg),Rg.x>Rg.z?Rg.x>Rg.y?"x":"y":Rg.z>Rg.y?"z":"y");let u=Math.floor((t+n)/2);if(i<=4)!function(e,t,n=0,r=e.length,i=Math.floor((n+r)/2)){for(let a=n;a<=i;a++){let n=a,i=e[a];for(let o=a+1;o<r;o++)t(i,e[o])||(n=o,i=e[o],Mg(e,a,n))}}(e,((e,t)=>e.center[c]<t.center[c]),t,n,u);else{if(l.max[c]===l.min[c])return Pg(e.slice(t,n),r);{const i=12,a=[];for(let e=0;e<i;e++)a.push({bounds:new wg,count:0});for(let r=t;r<n;r++){let t=Math.floor(i*Fg(l,c,e[r].center));t===a.length&&(t=a.length-1),a[t].count++,a[t].bounds.union(e[r].bounds)}const o=[];for(let e=0;e<a.length-1;e++){const t=new wg,n=new wg;let i=0,s=0;for(let r=0;r<=e;r++)t.union(a[r].bounds),i+=a[r].count;for(let r=e+1;r<a.length;r++)n.union(a[r].bounds),s+=a[r].count;o.push(.1+(i*Ig(t)+s*Ig(n))/Ig(r))}let s=o[0],d=0;for(let e=1;e<o.length;e++)o[e]<s&&(s=o[e],d=e);u=function(e,t,n=0,r=e.length){for(;n!==r;){for(;t(e[n]);)if(++n===r)return n;do{if(n===--r)return n}while(!t(e[r]));Mg(e,n,r),n++}return n}(e,(e=>{let t=Math.floor(a.length*Fg(l,c,e.center));return t===a.length&&(t=a.length-1),t<=d}),t,n)}}return a=c,{child0:o=Ng(e,t,u),child1:s=Ng(e,u,n),bounds:(new wg).union(o.bounds).union(s.bounds),splitAxis:a}}var a,o,s}function Ug(e,t){const n=function(e){const t=[],n=e.getIndex?e.getIndex().array:e.index.array,r=e.getAttribute?e.getAttribute("position"):e.attributes.position,i=e.getAttribute?e.getAttribute("materialMeshIndex"):e.attributes.materialMeshIndex,a=new Sg,o=new Sg,s=new Sg,l=new Sg,c=new Sg;for(let u=0;u<n.length;u+=3){const e=n[u],d=n[u+1],f=n[u+2],p=new wg;r.getX?(a.fromBufferAttribute(r,e),o.fromBufferAttribute(r,d),s.fromBufferAttribute(r,f)):(a.x=r.array[e*r.itemSize],a.y=r.array[e*r.itemSize+1],a.z=r.array[e*r.itemSize+2],o.x=r.array[d*r.itemSize],o.y=r.array[d*r.itemSize+1],o.z=r.array[d*r.itemSize+2],s.x=r.array[f*r.itemSize],s.y=r.array[f*r.itemSize+1],s.z=r.array[f*r.itemSize+2]),p.expandByPoint(a),p.expandByPoint(o),p.expandByPoint(s),l.subVectors(s,a),c.subVectors(o,a);const h=(new Sg).crossVectors(c,l).normalize(),m={bounds:p,center:p.getCenter(new Sg),indices:[e,d,f],faceNormal:h,materialIndex:i.getX?i.getX(e):i.array[e*i.itemSize]};t.push(m)}return t}(e);return t&&(Ag=2*n.length-1,Cg=!0,Eg=t),Ng(n,0,n.length)}function zg(e,t,n){return.2126*e+.7152*t+.0722*n}function Gg(e,t,n=0,r=e.length){let i=n,a=n+r-1;for(;i<a;){const n=i+a>>1;e[n]<t?i=n+1:a=n}return i-n}var Bg={source:e=>"\n#define PI 3.14159265359\n#define TWOPI 6.28318530718\n#define INVPI 0.31830988618\n#define INVPI2 0.10132118364\n#define EPS 0.0001\n#define ONE_MINUS_EPS 0.999999\n#define INF 1000000.0\n#define ROUGHNESS_MIN 0.001\n#define DISNEY 0\nconst vec3 LGL_Ag=vec3(0.2126,0.7152,0.0722);float LGL_Af(vec3 color){return dot(color,LGL_Ag);}\n#define RAY_MAX_DISTANCE 9999.0\nstruct Ray{vec3 o;vec3 d;vec3 LGL_BZ;float LGL_Ba;};struct Path{Ray ray;vec3 li;float alpha;vec3 beta;bool LGL_Bc;float LGL_Bd;vec3 LGL_Be;};struct Camera{mat4 transform;float aspect;float fov;float focus;float aperture;};\n#if defined(NUM_LIGHTS)\nstruct Lights{vec3 position[NUM_LIGHTS];vec3 emission[NUM_LIGHTS];vec3 p1[NUM_LIGHTS];vec3 p2[NUM_LIGHTS];vec4 params[NUM_LIGHTS];};struct Light{vec3 position;vec3 emission;vec3 p1;vec3 p2;float radius;float area;float type;float LGL_s;};\n#endif\nstruct SurfaceInteraction{bool LGL_BW;bool LGL_BU;float t;vec3 position;vec3 normal;vec3 LGL_BY;vec3 LGL_BX;vec3 tangent;vec3 bitangent;vec3 color;vec3 extinction;vec3 emissive;int LGL_BT;float roughness;float metalness;float LGL_BR;float LGL_BN;float LGL_BK;float sheen;float LGL_BL;float clearcoat;float LGL_BM;float LGL_BO;float ior;float LGL_BQ;float eta;float LGL_BP;vec3 specularColor;float LGL_BS;};struct BsdfSampleRec{vec3 L;vec3 f;float pdf;};struct LightSampleRec{vec3 normal;vec3 emission;vec3 direction;float dist;float pdf;};void LGL_Ah(inout Ray ray,vec3 origin,vec3 direction){ray.o=origin;ray.d=direction;ray.LGL_BZ=1.0/ray.d;ray.LGL_Ba=RAY_MAX_DISTANCE;}void LGL_Ah(inout Ray ray,vec3 origin,vec3 direction,float rMax){ray.o=origin;ray.d=direction;ray.LGL_BZ=1.0/ray.d;ray.LGL_Ba=rMax;}ivec2 LGL_Ai(int i,int LGL_Bf){ivec2 u;u.y=i>>LGL_Bf;u.x=i-(u.y<<LGL_Bf);return u;}vec4 LGL_Aj(sampler2D s,int i,int LGL_Bf){return texelFetch(s,LGL_Ai(i,LGL_Bf),0);}ivec4 LGL_Aj(isampler2D s,int i,int LGL_Bf){return texelFetch(s,LGL_Ai(i,LGL_Bf),0);}uniform Camera camera;uniform vec2 pixelSize;uniform vec2 jitter;uniform float frameCount;in vec2 vCoord;\n#if defined(NUM_LIGHTS)\nuniform Lights lights;\n#endif\nuniform int bounces;uniform vec3 backgroundColor;uniform float envMapIntensity;uniform float enviromentVisible;uniform int useBackgroundColor;uniform mat3 envRotMatrix;uniform mat3 invEnvRotMatrix;uniform sampler2D noiseTex;uniform float stratifiedSamples[71];uniform float strataSize;float pixelSeed;float LGL_AX(vec2 p){return fract(sin(dot(p,vec2(12.9898,78.233)))*43758.5453);}uvec4 seed;ivec2 pixel;void LGL_AY(float frame){pixel=ivec2(vCoord/pixelSize);seed=uvec4(pixel,int(frame),pixel.x+pixel.y);}void LGL_AZ(inout uvec4 v){v=v*1664525u+1013904223u;v.x+=v.y*v.w;v.y+=v.z*v.x;v.z+=v.x*v.y;v.w+=v.y*v.z;v=v ^(v>>16u);v.x+=v.y*v.w;v.y+=v.z*v.x;v.z+=v.x*v.y;v.w+=v.y*v.z;}float LGL_Aa(){LGL_AZ(seed);return float(seed.x)/float(0xffffffffu);}vec2 LGL_Aa2(){LGL_AZ(seed);return vec2(seed.xy)/float(0xffffffffu);}void LGL_Ac(float frame){vec2 noiseSize=vec2(textureSize(noiseTex,0));pixelSeed=texture(noiseTex,vCoord/(pixelSize*noiseSize)).r;LGL_AY(frame);}int sampleIndex=0;float LGL_AaomSample(){float stratifiedSample=stratifiedSamples[sampleIndex++];float LGL_Aaom=fract((stratifiedSample+pixelSeed)*strataSize);return EPS+(1.0-2.0*EPS)*LGL_Aaom;}vec2 LGL_AaomSampleVec2(){return vec2(LGL_AaomSample(),LGL_AaomSample());}struct MaterialSamples{vec2 s1;vec2 s2;vec2 s3;vec2 s4;};MaterialSamples getRandomMaterialSamples(){MaterialSamples samples;samples.s1=LGL_AaomSampleVec2();samples.s2=LGL_AaomSampleVec2();samples.s3=LGL_AaomSampleVec2();samples.s4=LGL_AaomSampleVec2();return samples;}vec4 LGL_Az(sampler2D map,vec2 uv){\n#ifdef OES_texture_float_linear\nreturn texture(map,uv);\n#else\nvec2 size=vec2(textureSize(map,0));vec2 texelSize=1.0/size;uv=uv*size-0.5;vec2 f=fract(uv);uv=floor(uv)+0.5;vec4 s1=texture(map,(uv+vec2(0,0))*texelSize);vec4 s2=texture(map,(uv+vec2(1,0))*texelSize);vec4 s3=texture(map,(uv+vec2(0,1))*texelSize);vec4 s4=texture(map,(uv+vec2(1,1))*texelSize);return mix(mix(s1,s2,f.x),mix(s3,s4,f.x),f.y);\n#endif\n}uniform Materials{vec4 colorAndMaterialType[NUM_MATERIALS];vec4 roughnessMetalnessNormalScale[NUM_MATERIALS];vec4 alphaSpecularTintSheenSheenTint[NUM_MATERIALS];vec4 clearcoaRoughnessSubfaceTransmission[NUM_MATERIALS];vec4 iorAtDistanceAnisotropicWorkflow[NUM_MATERIALS];vec4 extinction[NUM_MATERIALS];vec4 specularColorGlossiness[NUM_MATERIALS];\n#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS) || defined(NUM_PBR_MAPS)\nivec4 diffuseNormalRoughnessMetalnessMapIndex[NUM_MATERIALS];\n#endif\n#if defined(NUM_EMISSIVE_MAPS) || defined(NUM_PBR_SG_MAPS)\nivec4 emissiveSpecularGlossinessMapIndex[NUM_MATERIALS];\n#endif\n#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS)\nvec4 diffuseNormalMapSize[NUM_DIFFUSE_NORMAL_MAPS];\n#endif\n#if defined(NUM_PBR_MAPS)\nvec2 pbrMapSize[NUM_PBR_MAPS];\n#else\n#if defined(NUM_PBR_SG_MAPS)\nvec2 pbrMapSize[NUM_PBR_SG_MAPS];\n#else\n#if defined(NUM_EMISSIVE_MAPS)\nvec2 pbrMapSize[NUM_EMISSIVE_MAPS];\n#endif\n#endif\n#endif\n}materials;\n#ifdef NUM_DIFFUSE_MAPS\nuniform mediump sampler2DArray diffuseMap;\n#endif\n#ifdef NUM_NORMAL_MAPS\nuniform mediump sampler2DArray normalMap;\n#endif\n#ifdef NUM_PBR_MAPS\nuniform mediump sampler2DArray pbrMap;\n#endif\n#ifdef NUM_PBR_SG_MAPS\nuniform mediump sampler2DArray pbrSGMap;\n#endif\n#ifdef NUM_EMISSIVE_MAPS\nuniform mediump sampler2DArray emissiveMap;\n#endif\nfloat LGL_w(int materialIndex){return materials.colorAndMaterialType[materialIndex].w;}float LGL_x(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].w;}vec3 LGL_y(int materialIndex,vec2 uv){vec3 emissive=vec3(0.0);\n#ifdef NUM_EMISSIVE_MAPS\nint emissiveMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].x;if(emissiveMapIndex>=0){emissive=texture(emissiveMap,vec3(uv*materials.pbrMapSize[emissiveMapIndex].xy,emissiveMapIndex)).rgb;}\n#endif\nreturn emissive;}vec3 LGL_z(int materialIndex,vec2 uv){vec3 specularColor=materials.specularColorGlossiness[materialIndex].rgb;\n#ifdef NUM_PBR_SG_MAPS\nint specularMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].y;if(specularMapIndex>=0){vec3 LGL_AV=texture(pbrSGMap,vec3(uv*materials.pbrMapSize[specularMapIndex].xy,specularMapIndex)).rgb;LGL_AV=pow(LGL_AV,vec3(2.2));specularColor*=LGL_AV;}\n#endif\nreturn specularColor;}float LGL_AA(int materialIndex,vec2 uv){float glossiness=materials.specularColorGlossiness[materialIndex].a;\n#ifdef NUM_PBR_SG_MAPS\nint glossinessMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].z;if(glossinessMapIndex>=0){float LGL_AW=texture(pbrSGMap,vec3(uv*materials.pbrMapSize[glossinessMapIndex].xy,glossinessMapIndex)).a;glossiness*=LGL_AW;}\n#endif\nreturn glossiness;}float LGL_AB(int materialIndex,vec2 uv){float LGL_BS=LGL_x(materialIndex);float roughness=0.0;if(LGL_BS>0.1){roughness=1.0-LGL_AA(materialIndex,uv);}else{roughness=materials.roughnessMetalnessNormalScale[materialIndex].x;\n#ifdef NUM_PBR_MAPS\nint roughnessMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].z;if(roughnessMapIndex>=0){roughness*=texture(pbrMap,vec3(uv*materials.pbrMapSize[roughnessMapIndex].xy,roughnessMapIndex)).g;}\n#endif\n}return roughness*roughness;}float LGL_AC(const vec3 v){return max(v.x,max(v.y,v.z));}float LGL_AD(const vec3 specularColor){return LGL_AC(specularColor);}vec3 LGL_AE(const vec3 baseColor,float metallic){return baseColor*(1.0-metallic);}float LGL_AF(int materialIndex,vec2 uv){float LGL_BS=LGL_x(materialIndex);float metalness=0.0;if(LGL_BS>0.1){vec3 specularFactor=LGL_z(materialIndex,uv);metalness=LGL_AD(specularFactor);}else{metalness=materials.roughnessMetalnessNormalScale[materialIndex].y;\n#ifdef NUM_PBR_MAPS\nint metalnessMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].w;if(metalnessMapIndex>=0){metalness*=texture(pbrMap,vec3(uv*materials.pbrMapSize[metalnessMapIndex].xy,metalnessMapIndex)).b;}\n#endif\n}return metalness;}vec3 LGL_AG(int materialIndex,vec2 uv){vec3 color=materials.colorAndMaterialType[materialIndex].rgb;\n#ifdef NUM_DIFFUSE_MAPS\nint diffuseMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;if(diffuseMapIndex>=0){color*=texture(diffuseMap,vec3(uv*materials.diffuseNormalMapSize[diffuseMapIndex].xy,diffuseMapIndex)).rgb;}\n#endif\nfloat LGL_BS=LGL_x(materialIndex);if(LGL_BS>0.1){vec3 specularFactor=LGL_z(materialIndex,uv);color=LGL_AE(color,LGL_AD(specularFactor));}return color;}vec3 LGL_AI(int materialIndex,vec2 uv,vec3 normal,vec3 dp1,vec3 dp2,vec2 duv1,vec2 duv2,inout vec3 tangent,inout vec3 bitangent){vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 dpdu=dp2perp*duv1.x+dp1perp*duv2.x;vec3 dpdv=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(dpdu,dpdu),dot(dpdv,dpdv)));dpdu*=invmax;dpdv*=invmax;tangent=normalize(dpdu);bitangent=normalize(dpdv);\n#ifdef NUM_NORMAL_MAPS\nint normalMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].y;if(normalMapIndex>=0){vec3 n=2.0*texture(normalMap,vec3(uv*materials.diffuseNormalMapSize[normalMapIndex].zw,normalMapIndex)).rgb-1.0;n.xy*=materials.roughnessMetalnessNormalScale[materialIndex].zw;mat3 tbn=mat3(dpdu,dpdv,normal);return normalize(tbn*n);}else{return normal;}\n#endif\nreturn normal;}float LGL_AL(int materialIndex,vec2 uv){float alpha=materials.alphaSpecularTintSheenSheenTint[materialIndex].x;\n#ifdef NUM_DIFFUSE_MAPS\nint diffuseMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;if(diffuseMapIndex>=0){alpha*=texture(diffuseMap,vec3(uv*materials.diffuseNormalMapSize[diffuseMapIndex].xy,diffuseMapIndex)).a;}\n#endif\nreturn alpha;}float LGL_AJ(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].y;}float LGL_AK(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].z;}float LGL_AKTint(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].w;}float LGL_AN(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].x;}float LGL_ANRoughness(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].y;}float LGL_AP(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].z;}float LGL_AQ(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].w;}float LGL_AR(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].x;}float LGL_AS(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].y;}float LGL_AT(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].z;}vec3 LGL_AU(int materialIndex){return materials.extinction[materialIndex].rgb;}uniform sampler2D positionBuffer;uniform sampler2D normalBuffer;uniform sampler2D uvBuffer;uniform sampler2D bvhBuffer;struct Triangle{vec3 p0;vec3 p1;vec3 p2;};struct Box{vec3 min;vec3 max;};struct TriangleIntersect{float t;vec3 barycentric;};float LGL_f(float rad,vec3 pos,Ray r){vec3 op=pos-r.o;float eps=0.001;float b=dot(op,r.d);float det=b*b-dot(op,op)+rad*rad;if(det<0.0)return INF;det=sqrt(det);float t1=b-det;if(t1>eps)return t1;float t2=b+det;if(t2>eps)return t2;return INF;}float LGL_g(in vec3 pos,in vec3 u,in vec3 v,in vec4 plane,in Ray r){vec3 n=vec3(plane);float dt=dot(r.d,n);float t=(plane.w-dot(n,r.o))/dt;if(t>EPS){vec3 p=r.o+r.d*t;vec3 vi=p-pos;float a1=dot(u,vi);if(a1>=0.&&a1<=1.){float a2=dot(v,vi);if(a2>=0.&&a2<=1.)return t;}}return INF;}float LGL_h(vec3 v0,vec3 v1,vec3 v2,Ray r,bool isDoubleSided){vec3 edge1=v1-v0;vec3 edge2=v2-v0;vec3 pvec=cross(r.d,edge2);float det=1.0/dot(edge1,pvec);if(!isDoubleSided&&det<0.0)return INF;vec3 tvec=r.o-v0;float u=dot(tvec,pvec)*det;vec3 qvec=cross(tvec,edge1);float v=dot(r.d,qvec)*det;float t=dot(edge2,qvec)*det;return(u<0.0||u>1.0||v<0.0||u+v>1.0||t<=0.0)? INF : t;}float LGL_gClassic(vec3 v1,vec3 v2,vec3 v3,vec3 v4,Ray r,bool isDoubleSided){return min(LGL_h(v1,v3,v2,r,isDoubleSided),LGL_h(v2,v3,v4,r,isDoubleSided));}void LGL_j(inout SurfaceInteraction si,Triangle tri,vec3 barycentric,ivec3 index,vec3 LGL_BY,int materialIndex){si.LGL_BW=true;si.LGL_BY=LGL_BY;si.position=barycentric.x*tri.p0+barycentric.y*tri.p1+barycentric.z*tri.p2;ivec2 i0=LGL_Ai(index.x,VERTEX_COLUMNS);ivec2 i1=LGL_Ai(index.y,VERTEX_COLUMNS);ivec2 i2=LGL_Ai(index.z,VERTEX_COLUMNS);vec3 n0=texelFetch(normalBuffer,i0,0).xyz;vec3 n1=texelFetch(normalBuffer,i1,0).xyz;vec3 n2=texelFetch(normalBuffer,i2,0).xyz;vec3 normal=normalize(barycentric.x*n0+barycentric.y*n1+barycentric.z*n2);vec2 uv0=texelFetch(uvBuffer,i0,0).xy;vec2 uv1=texelFetch(uvBuffer,i1,0).xy;vec2 uv2=texelFetch(uvBuffer,i2,0).xy;\n#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS) || defined(NUM_PBR_MAPS)\nvec2 uv=fract(barycentric.x*uv0+barycentric.y*uv1+barycentric.z*uv2);\n#else\nvec2 uv=vec2(0.0);\n#endif\nsi.LGL_BT=int(LGL_w(materialIndex));si.color=LGL_AG(materialIndex,uv);si.roughness=LGL_AB(materialIndex,uv);si.metalness=LGL_AF(materialIndex,uv);si.specularColor=LGL_z(materialIndex,uv);si.LGL_BS=LGL_x(materialIndex);si.emissive=LGL_y(materialIndex,uv);vec3 dp1=tri.p0-tri.p2;vec3 dp2=tri.p1-tri.p2;vec2 duv1=uv0-uv2;vec2 duv2=uv1-uv2;si.normal=LGL_AI(materialIndex,uv,normal,dp1,dp2,duv1,duv2,si.tangent,si.bitangent);si.LGL_BK=LGL_AJ(materialIndex);si.sheen=LGL_AK(materialIndex);si.LGL_BL=LGL_AKTint(materialIndex);si.clearcoat=LGL_AN(materialIndex);si.LGL_BM=LGL_ANRoughness(materialIndex);si.LGL_BN=LGL_AP(materialIndex);si.LGL_BO=LGL_AQ(materialIndex);si.LGL_BP=LGL_AL(materialIndex,uv);si.ior=LGL_AR(materialIndex);si.LGL_BQ=LGL_AS(materialIndex);si.LGL_BR=LGL_AT(materialIndex);si.extinction=LGL_AU(materialIndex);}TriangleIntersect LGL_k(Ray r,Triangle tri){vec3 v0=tri.p0;vec3 v1=tri.p1;vec3 v2=tri.p2;TriangleIntersect ti;vec3 e0=v1-v0;vec3 e1=v2-v0;vec3 pv=cross(r.d,e1);float det=dot(e0,pv);vec3 tv=r.o-v0;vec3 qv=cross(tv,e0);vec4 uvt;uvt.x=dot(tv,pv);uvt.y=dot(r.d,qv);uvt.z=dot(e1,qv);uvt.xyz=uvt.xyz/det;uvt.w=1.0-uvt.x-uvt.y;if(uvt.z>=r.LGL_Ba){return ti;}if(all(greaterThanEqual(uvt,vec4(0.0)))&&uvt.z<INF){ti.t=uvt.z;ti.barycentric=uvt.wxy;}return ti;}float LGL_l(Ray r,Box b){vec3 tBot=(b.min-r.o)*r.LGL_BZ;vec3 tTop=(b.max-r.o)*r.LGL_BZ;vec3 tNear=min(tBot,tTop);vec3 tFar=max(tBot,tTop);float t0=max(tNear.x,max(tNear.y,tNear.z));float t1=min(tFar.x,min(tFar.y,tFar.z));return(t0>t1||t0>r.LGL_Ba)?-1.0 :(t0>0.0 ? t0 : t1);}bool LGL_m(inout Ray ray,float maxDist){\n#if defined(NUM_LIGHTS)\nfor(int i=0;i<NUM_LIGHTS;i++){vec3 position=lights.position[i];vec3 emission=lights.emission[i];vec3 p1=lights.p1[i];vec3 p2=lights.p2[i];vec4 params=lights.params[i];float radius=params.x;float area=params.y;float type=params.z;float LGL_s=params.w;if(type==0.||type==1.){vec3 normal=normalize(cross(p1,p2));if(dot(normal,ray.d)>0.)continue;vec4 plane=vec4(normal,dot(normal,position));p1*=1.0/dot(p1,p1);p2*=1.0/dot(p2,p2);float d=LGL_g(position,p1,p2,plane,ray);if(d>0.&&d<maxDist)return true;}if(type==1.){float d=LGL_f(radius,position,ray);if(d>0.&&d<maxDist)return true;}}\n#endif\nint LGL_p[STACK_SIZE];LGL_p[0]=0;int LGL_t=0;while(LGL_t>=0){int i=LGL_p[LGL_t--];vec4 r1=LGL_Aj(bvhBuffer,i,BVH_COLUMNS);vec4 r2=LGL_Aj(bvhBuffer,i+1,BVH_COLUMNS);int LGL_q=int(r1.w);if(LGL_q>=0){int LGL_r=LGL_q;Box bbox=Box(r1.xyz,r2.xyz);if(LGL_l(ray,bbox)>0.0){if(ray.d[LGL_r]>0.0){LGL_p[++LGL_t]=int(r2.w);LGL_p[++LGL_t]=i+2;}else{LGL_p[++LGL_t]=i+2;LGL_p[++LGL_t]=int(r2.w);}}}else{ivec3 index=ivec3(r1.xyz);Triangle tri=Triangle(LGL_Aj(positionBuffer,index.x,VERTEX_COLUMNS).xyz,LGL_Aj(positionBuffer,index.y,VERTEX_COLUMNS).xyz,LGL_Aj(positionBuffer,index.z,VERTEX_COLUMNS).xyz);TriangleIntersect LGL_BW=LGL_k(ray,tri);if(LGL_BW.t>0.0&&LGL_BW.t<maxDist){return true;}}}return false;}void LGL_n(inout Ray ray,inout SurfaceInteraction si,inout LightSampleRec lightSampleRec,int bounce){si.LGL_BW=false;float t=INF;float d;\n#if defined(NUM_LIGHTS)\nfor(int i=0;i<NUM_LIGHTS;i++){vec4 params=lights.params[i];float radius=params.x;float area=params.y;float type=params.z;float LGL_s=params.w;if(bounce==0&&LGL_s<0.1)continue;vec3 position=lights.position[i];vec3 emission=lights.emission[i];vec3 p1=lights.p1[i];vec3 p2=lights.p2[i];if(type==0.||type==1.){vec3 normal=normalize(cross(p1,p2));if(dot(normal,ray.d)>0.)continue;vec4 plane=vec4(normal,dot(normal,position));p1*=1.0/dot(p1,p1);p2*=1.0/dot(p2,p2);d=LGL_g(position,p1,p2,plane,ray);if(d<0.)d=INF;if(d<t){t=d;float cosTheta=dot(-ray.d,normal);float pdf=(t*t)/(area*cosTheta);lightSampleRec.emission=emission;lightSampleRec.pdf=pdf;si.LGL_BW=true;si.LGL_BU=true;ray.LGL_Ba=t;}}if(type==2.){d=LGL_f(radius,position,ray);if(d<0.)d=INF;if(d<t){t=d;float pdf=(t*t)/area;lightSampleRec.emission=emission;lightSampleRec.pdf=pdf;si.LGL_BW=true;si.LGL_BU=true;ray.LGL_Ba=t;}}}\n#endif\nint LGL_p[STACK_SIZE];LGL_p[0]=0;int LGL_t=0;while(LGL_t>=0){int i=LGL_p[LGL_t--];vec4 r1=LGL_Aj(bvhBuffer,i,BVH_COLUMNS);vec4 r2=LGL_Aj(bvhBuffer,i+1,BVH_COLUMNS);int LGL_q=int(r1.w);if(LGL_q>=0){int LGL_r=LGL_q;Box bbox=Box(r1.xyz,r2.xyz);if(LGL_l(ray,bbox)>0.0){if(ray.d[LGL_r]>0.0){LGL_p[++LGL_t]=int(r2.w);LGL_p[++LGL_t]=i+2;}else{LGL_p[++LGL_t]=i+2;LGL_p[++LGL_t]=int(r2.w);}}}else{ivec3 index=ivec3(r1.xyz);Triangle tri=Triangle(LGL_Aj(positionBuffer,index.x,VERTEX_COLUMNS).xyz,LGL_Aj(positionBuffer,index.y,VERTEX_COLUMNS).xyz,LGL_Aj(positionBuffer,index.z,VERTEX_COLUMNS).xyz);TriangleIntersect LGL_BW=LGL_k(ray,tri);if(LGL_BW.t>0.0){int materialIndex=int(r2.w);vec3 LGL_BY=r2.xyz;si.t=LGL_BW.t;si.LGL_BU=false;ray.LGL_Ba=LGL_BW.t;LGL_j(si,tri,LGL_BW.barycentric,index,LGL_BY,materialIndex);si.LGL_BX=dot(si.LGL_BY,ray.d)<=0.0 ? si.normal :-si.normal;}}}si.roughness=clamp(si.roughness,ROUGHNESS_MIN,1.0);si.metalness=clamp(si.metalness,0.0,1.0);}void LGL_o(inout Ray ray,inout SurfaceInteraction si,inout LightSampleRec lightSampleRec,int depth){if(si.LGL_BW&&!si.LGL_BU&&si.LGL_BP<1.0){float LGL_BV=LGL_Aa();float LGL_v=0.;while(si.LGL_BW&&!si.LGL_BU&&LGL_BV>si.LGL_BP&&LGL_v<2.){LGL_Ah(ray,si.position+EPS*ray.d,ray.d);LGL_n(ray,si,lightSampleRec,depth);LGL_v++;}}}\n#ifndef CONST_COLOR_ENV\nuniform sampler2D envMap;uniform float totalSumValue;uniform sampler2D envMarginalWeights;uniform sampler2D envConditionalWeights;vec2 equirectDirToUV(vec3 pointOnSphere){float phi=atan(pointOnSphere.z,pointOnSphere.x)/TWOPI;float theta=acos(pointOnSphere.y);return vec2(phi+0.5,theta*INVPI);}vec3 equirectUVToDir(vec2 uv){uv.x-=0.5;float theta=uv.x*2.0*PI;float phi=uv.y*PI;float sinPhi=sin(phi);return vec3(sinPhi*cos(theta),cos(phi),sinPhi*sin(theta));}vec3 LGL_Z(vec3 d){vec2 uv=equirectDirToUV(d);return LGL_Az(envMap,uv).rgb;}float equirectDirectionPdf(vec3 dir){vec2 uv=equirectDirToUV(dir);float sinTheta=sin(uv.y*PI);if(sinTheta==0.0){return 0.0;}return INVPI2/(2.0*sinTheta);}float LGL_c(vec3 dir){vec2 uv=equirectDirToUV(dir);vec3 color=texture(envMap,uv).rgb;float lum=LGL_Af(color);vec2 size=vec2(textureSize(envMap,0));return(size.x*size.y)*(lum/totalSumValue)*equirectDirectionPdf(dir);}vec3 LGL_d(vec2 LGL_Aaom,out vec2 uv,out float pdf){vec2 size=vec2(textureSize(envMap,0));float sizeMarginalWeights=size.y;float v=texelFetch(envMarginalWeights,ivec2(LGL_Aaom.x*sizeMarginalWeights,0),0).x;float u=texelFetch(envConditionalWeights,ivec2(LGL_Aaom.y*size.x,v*size.y),0).x;uv=vec2(u,v);vec3 dir=equirectUVToDir(uv);vec3 color=texture(envMap,uv).rgb;float lum=LGL_Af(color);pdf=(size.x*size.y)*(lum/totalSumValue)*equirectDirectionPdf(dir);return dir;}\n#endif\nvoid LGL_Al(in vec3 N,inout vec3 T,inout vec3 B){if(N.z<-0.999999){T=vec3(0.,-1.,0.);B=vec3(-1.,0.,0.);}else{float a=1.0/(1.+N.z);float b=-N.x*N.y*a;T=vec3(1.0-N.x*N.x*a,b,-N.x);B=vec3(b,1.-N.y*N.y*a,-N.y);}}vec3 LGL_Ay(vec3 V,float rgh,float r1,float r2){vec3 Vh=normalize(vec3(rgh*V.x,rgh*V.y,V.z));float lensq=Vh.x*Vh.x+Vh.y*Vh.y;vec3 T1=lensq>0. ? vec3(-Vh.y,Vh.x,0)*inversesqrt(lensq): vec3(1.,0.,0.);vec3 T2=cross(Vh,T1);float r=sqrt(r1);float phi=2.0*PI*r2;float t1=r*cos(phi);float t2=r*sin(phi);float s=0.5*(1.0+Vh.z);t2=(1.0-s)*sqrt(1.0-t1*t1)+s*t2;vec3 Nh=t1*T1+t2*T2+sqrt(max(0.0,1.0-t1*t1-t2*t2))*Vh;return normalize(vec3(rgh*Nh.x,rgh*Nh.y,max(0.0,Nh.z)));}vec2 LGL_Am(vec2 p){p=2.0*p-1.0;bool greater=abs(p.x)>abs(p.y);float r=greater ? p.x : p.y;float theta=greater ? 0.25*PI*p.y/p.x : PI*(0.5-0.25*p.x/p.y);return r*vec2(cos(theta),sin(theta));}vec3 LGL_An(vec2 p){vec2 h=LGL_Am(p);float z=sqrt(max(0.0,1.0-h.x*h.x-h.y*h.y));return vec3(h,z);}vec3 LGL_Ao(float r1,float r2){float z=1.0-2.0*r1;float r=sqrt(max(0.0,1.0-z*z));float phi=TWOPI*r2;return vec3(r*cos(phi),r*sin(phi),z);}vec3 LGL_Ap(vec3 LGL_BY,vec3 viewDir,mat3 basis,float roughness,vec2 LGL_Aaom){float phi=TWOPI*LGL_Aaom.y;float alpha=roughness*roughness;float cosTheta=sqrt((1.0-LGL_Aaom.x)/(1.0+(alpha*alpha-1.0)*LGL_Aaom.x));float sinTheta=sqrt(1.0-cosTheta*cosTheta);vec3 halfVector=basis*sign(dot(LGL_BY,viewDir))*vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);vec3 lightDir=reflect(-viewDir,halfVector);return lightDir;}vec3 LGL_Aq(vec3 LGL_BY,vec3 viewDir,mat3 basis,vec2 LGL_Aaom){return basis*sign(dot(LGL_BY,viewDir))*LGL_An(LGL_Aaom);}float LGL_Ar(float f,float g){return(f*f)/(f*f+g*g);}vec3 LGL_As(in Ray r,int depth,in LightSampleRec lightSampleRec,in BsdfSampleRec bsdfSampleRec){vec3 Le;if(depth==0){Le=lightSampleRec.emission;}else{Le=LGL_Ar(bsdfSampleRec.pdf,lightSampleRec.pdf)*lightSampleRec.emission;}return Le;}\n#if defined(NUM_LIGHTS)\nvoid LGL_At(in Light light,in vec3 surfacePos,inout LightSampleRec lightSampleRec,vec2 LGL_Aaom){float r1=LGL_Aaom.x;float r2=LGL_Aaom.y;vec3 lightSurfacePos=light.position+LGL_Ao(r1,r2)*light.radius;lightSampleRec.direction=lightSurfacePos-surfacePos;lightSampleRec.dist=length(lightSampleRec.direction);float distSq=lightSampleRec.dist*lightSampleRec.dist;lightSampleRec.direction/=lightSampleRec.dist;lightSampleRec.normal=normalize(lightSurfacePos-light.position);lightSampleRec.emission=light.emission*float(NUM_LIGHTS);lightSampleRec.pdf=distSq/(light.area*abs(dot(lightSampleRec.normal,lightSampleRec.direction)));}void LGL_Av(in Light light,in vec3 surfacePos,inout LightSampleRec lightSampleRec,vec2 LGL_Aaom){float r1=LGL_Aaom.x;float r2=LGL_Aaom.y;vec3 lightSurfacePos=light.position+light.p1*r1+light.p2*r2;lightSampleRec.direction=lightSurfacePos-surfacePos;lightSampleRec.dist=length(lightSampleRec.direction);float distSq=lightSampleRec.dist*lightSampleRec.dist;lightSampleRec.direction/=lightSampleRec.dist;lightSampleRec.normal=normalize(cross(light.p1,light.p2));lightSampleRec.emission=light.emission*float(NUM_LIGHTS);lightSampleRec.pdf=distSq/(light.area*abs(dot(lightSampleRec.normal,lightSampleRec.direction)));}void LGL_Aw(in Light light,in vec3 surfacePos,inout LightSampleRec lightSampleRec){lightSampleRec.direction=normalize(light.position-light.p1);lightSampleRec.normal=normalize(surfacePos-light.position);if(dot(lightSampleRec.direction,lightSampleRec.normal)>0.0){lightSampleRec.normal=-lightSampleRec.normal;}lightSampleRec.emission=light.emission*float(NUM_LIGHTS);lightSampleRec.dist=INF;lightSampleRec.pdf=1.0;}void samplePointLight(in Light light,in vec3 surfacePos,inout LightSampleRec lightSampleRec){lightSampleRec.direction=light.position-surfacePos;lightSampleRec.dist=length(lightSampleRec.direction);float distSq=lightSampleRec.dist*lightSampleRec.dist;lightSampleRec.direction=normalize(lightSampleRec.direction);lightSampleRec.normal=normalize(surfacePos-light.position);lightSampleRec.emission=light.emission*float(NUM_LIGHTS)/distSq;lightSampleRec.pdf=1.0;}void LGL_Ax(in Light light,in vec3 surfacePos,inout LightSampleRec lightSampleRec,vec2 LGL_Aaom){int type=int(light.type);if(type==0||type==1){LGL_Av(light,surfacePos,lightSampleRec,LGL_Aaom);}else if(type==2){LGL_At(light,surfacePos,lightSampleRec,LGL_Aaom);}else if(type==3){LGL_Aw(light,surfacePos,lightSampleRec);}else if(type==4){samplePointLight(light,surfacePos,lightSampleRec);}}\n#endif\nvec3 LocalToWorld(vec3 X,vec3 Y,vec3 Z,vec3 V){return vec3(X.x*V.x+Y.x*V.y+Z.x*V.z,X.y*V.x+Y.y*V.y+Z.y*V.z,X.z*V.x+Y.z*V.y+Z.z*V.z);}vec3 WorldToLocal(vec3 X,vec3 Y,vec3 Z,vec3 V){return vec3(dot(V,X),dot(V,Y),dot(V,Z));}vec3 LGL_A(float r1,float r2){vec3 dir;float r=sqrt(r1);float phi=TWOPI*r2;dir.x=r*cos(phi);dir.y=r*sin(phi);dir.z=sqrt(max(0.0,1.0-dir.x*dir.x-dir.y*dir.y));return dir;}float LGL_B(float eta){float sqrtR0=(eta-1.)/(eta+1.);return sqrtR0*sqrtR0;}vec3 LGL_C(vec3 baseColor){float LGL_Ag=LGL_Af(baseColor);return(LGL_Ag>0.0)? baseColor/LGL_Ag : vec3(1.);}void LGL_D(SurfaceInteraction si,out vec3 Cspec0,out vec3 Csheen){vec3 tint=LGL_C(si.color);if(si.LGL_BS>0.1){Cspec0=si.specularColor;}else{Cspec0=mix(LGL_B(si.ior)*mix(vec3(1.0),tint,min(si.LGL_BK,0.99)),si.color,si.metalness);}Csheen=mix(vec3(1.0),tint,si.LGL_BL);}float LGL_E(float u){float m=clamp(1.0-u,0.0,1.0);float m2=m*m;return m2*m2*m;}float LGL_F(float F0,float cosTheta){return mix(F0,1.0,LGL_E(cosTheta));}vec3 LGL_F(vec3 F0,float cosTheta){return mix(F0,vec3(1.),LGL_E(cosTheta));}float LGL_G(float cosThetaI,float eta){float sinThetaTSq=eta*eta*(1.0f-cosThetaI*cosThetaI);if(sinThetaTSq>1.0)return 1.0;float cosThetaT=sqrt(max(1.0-sinThetaTSq,0.0));float rs=(eta*cosThetaT-cosThetaI)/(eta*cosThetaT+cosThetaI);float rp=(eta*cosThetaI-cosThetaT)/(eta*cosThetaI+cosThetaT);return 0.5*(rs*rs+rp*rp);}vec3 LGL_H(vec3 F0,float metalness,float eta,float cosThetaI){vec3 FrSchlick=LGL_F(F0,cosThetaI);float FrDielectric=LGL_G(cosThetaI,eta);return mix(vec3(FrDielectric),FrSchlick,metalness);}float LGL_H(float metalness,float eta,float cosThetaI){float FrSchlick=LGL_E(cosThetaI);float FrDielectric=LGL_G(cosThetaI,eta);return mix(FrDielectric,FrSchlick,metalness);}float LGL_I(float NDotV,float alphaG){float a=alphaG*alphaG;float b=NDotV*NDotV;return 1.0/(NDotV+sqrt(a+b-a*b));}float LGL_J(float NDotH,float alpha){float alpha2=alpha*alpha;float t=1.0+(alpha2-1.0)*NDotH*NDotH;return(alpha2-1.0)/(PI*log(alpha2)*t);}float LGL_K(float NDotH,float a){float a2=a*a;float t=1.0+(a2-1.0)*NDotH*NDotH;return a2/(PI*t*t);}vec3 ImportanceSampleLGL_J(float rgh,float r1,float r2){float a=max(0.001,rgh);float a2=a*a;float phi=r1*TWOPI;float cosTheta=sqrt((1.0-pow(a2,1.0-r1))/(1.0-a2));float sinTheta=clamp(sqrt(1.0-(cosTheta*cosTheta)),0.0,1.0);float sinPhi=sin(phi);float cosPhi=cos(phi);return vec3(sinTheta*cosPhi,sinTheta*sinPhi,cosTheta);}vec3 ImportanceSampleLGL_K(float rgh,float r1,float r2){float a=max(0.001,rgh);float phi=r1*TWOPI;float cosTheta=sqrt((1.0-r2)/(1.0+(a*a-1.0)*r2));float sinTheta=clamp(sqrt(1.0-(cosTheta*cosTheta)),0.0,1.0);float sinPhi=sin(phi);float cosPhi=cos(phi);return vec3(sinTheta*cosPhi,sinTheta*sinPhi,cosTheta);}vec3 LGL_N(SurfaceInteraction si,vec3 Csheen,vec3 V,vec3 L,vec3 H,out float pdf){pdf=0.0;if(L.z<=0.0)return vec3(0.0);pdf=L.z*INVPI;float LDotH=dot(L,H);float FL=LGL_E(L.z);float FV=LGL_E(V.z);float Fh=LGL_E(LDotH);float Fd90=0.5+2.0*LDotH*LDotH*si.roughness;float Fd=mix(1.0,Fd90,FL)*mix(1.0,Fd90,FV);float Fss90=LDotH*LDotH*si.roughness;float Fss=mix(1.0,Fss90,FL)*mix(1.0,Fss90,FV);float DisneyFakeSS=1.25*(Fss*(1.0/(L.z+V.z)-0.5)+0.5);vec3 Fsheen=Fh*si.sheen*Csheen;return(INVPI*mix(Fd,DisneyFakeSS,si.LGL_BN)*si.color+Fsheen)*(1.0-si.metalness)*(1.0-si.LGL_BO);}vec3 LGL_O(SurfaceInteraction si,vec3 Cspec0,vec3 V,vec3 L,vec3 H,out float pdf){pdf=0.0;if(L.z<=0.0)return vec3(0.0);float LDotH=dot(L,H);float D=LGL_K(H.z,si.roughness);pdf=D*H.z/(4.0*LDotH);vec3 F=LGL_H(Cspec0,si.metalness,si.eta,LDotH);float G=LGL_I(abs(L.z),si.roughness)*LGL_I(abs(V.z),si.roughness);return F*D*G;}vec3 LGL_P(SurfaceInteraction si,vec3 Cspec0,vec3 V,vec3 L,vec3 H,out float pdf){pdf=0.0;if(L.z>=0.0)return vec3(0.0);float F=LGL_G(abs(dot(V,H)),si.eta);float D=LGL_K(H.z,si.roughness);float denomSqrt=dot(L,H)+dot(V,H)*si.eta;pdf=D*H.z*abs(dot(L,H))/(denomSqrt*denomSqrt);float G=LGL_I(abs(L.z),si.roughness)*LGL_I(abs(V.z),si.roughness);vec3 specColor=pow(si.color,vec3(0.5));return specColor*(1.0-si.metalness)*si.LGL_BO*(1.0-F)*D*G*abs(dot(V,H))*abs(dot(L,H))*4.0*si.eta*si.eta/(denomSqrt*denomSqrt);}vec3 LGL_Q(SurfaceInteraction si,vec3 V,vec3 L,vec3 H,out float pdf){pdf=0.0;if(L.z<=0.0)return vec3(0.0);float LDotH=dot(L,H);float F=LGL_F(.04,LDotH);float D=LGL_J(H.z,mix(0.1,0.001,1.-si.LGL_BM));pdf=D*H.z/(4.0*LDotH);float G=LGL_I(L.z,0.25)*LGL_I(V.z,0.25);return vec3(0.25*si.clearcoat*F*D*G);}void LGL_R(SurfaceInteraction si,vec3 Cspec0,float fresnelWeight,out float LGL_S,out float LGL_T,out float LGL_U,out float LGL_V){LGL_S=max(LGL_Af(si.color),si.sheen)*(1.0-si.metalness)*(1.0-si.LGL_BO);LGL_T=LGL_Af(Cspec0);LGL_U=(1.0-fresnelWeight)*(1.0-si.metalness)*si.LGL_BO*LGL_Af(si.color);LGL_V=si.clearcoat*(1.0-si.metalness);float weightSum=LGL_S+LGL_T+LGL_U+LGL_V;LGL_S/=weightSum;LGL_T/=weightSum;LGL_U/=weightSum;LGL_V/=weightSum;}vec3 LGL_W(SurfaceInteraction si,vec3 V,vec3 N,out vec3 L,out float pdf,MaterialSamples LGL_AaomSamples){pdf=0.0;vec3 f=vec3(0.0);vec2 bounceDirSample=LGL_AaomSamples.s3;vec2 diffuseOrSpecular=LGL_AaomSamples.s4;float r1=bounceDirSample.x;float r2=bounceDirSample.y;vec3 Cspec0,Csheen;LGL_D(si,Cspec0,Csheen);vec3 T,B;LGL_Al(N,T,B);V=WorldToLocal(T,B,N,V);float LGL_S,LGL_T,LGL_U,LGL_V;float fresnelWeight=LGL_H(si.metalness,si.eta,V.z);LGL_R(si,Cspec0,fresnelWeight,LGL_S,LGL_T,LGL_U,LGL_V);float cdf[4];cdf[0]=LGL_S;cdf[1]=cdf[0]+LGL_T;cdf[2]=cdf[1]+LGL_U;cdf[3]=cdf[2]+LGL_V;if(r1<cdf[0]){r1/=cdf[0];L=LGL_A(r1,r2);vec3 H=normalize(L+V);f=LGL_N(si,Csheen,V,L,H,pdf);pdf*=LGL_S;}else if(r1<cdf[1]){r1=(r1-cdf[0])/(cdf[1]-cdf[0]);vec3 H=ImportanceSampleLGL_K(si.roughness,r1,r2);if(dot(V,H)<0.0)H=-H;L=normalize(reflect(-V,H));f=LGL_O(si,Cspec0,V,L,H,pdf);pdf*=LGL_T;}else if(r1<cdf[2]){r1=(r1-cdf[1])/(cdf[2]-cdf[1]);vec3 H=ImportanceSampleLGL_K(si.roughness,r1,r2);if(dot(V,H)<0.0)H=-H;vec3 R=reflect(-V,H);L=normalize(refract(-V,H,si.eta));f=LGL_P(si,Cspec0,V,L,H,pdf);pdf*=LGL_U;}else{r1=(r1-cdf[2])/(1.0-cdf[2]);vec3 H=ImportanceSampleLGL_J(mix(0.1,0.001,1.-si.LGL_BM),r1,r2);if(dot(V,H)<0.0)H=-H;L=normalize(reflect(-V,H));f=LGL_Q(si,V,L,H,pdf);pdf*=LGL_V;}L=LocalToWorld(T,B,N,L);return f*abs(dot(N,L));}vec3 LGL_X(inout SurfaceInteraction si,vec3 V,vec3 L,out float bsdfPdf){bsdfPdf=0.0;vec3 f=vec3(0.0);vec3 N=si.LGL_BX;vec3 T,B;LGL_Al(N,T,B);V=WorldToLocal(T,B,N,V);L=WorldToLocal(T,B,N,L);vec3 H;if(L.z>0.0){H=normalize(L+V);}else{H=normalize(L+V*si.eta);}if(dot(V,H)<0.0){H=-H;}vec3 Cspec0,Csheen;LGL_D(si,Cspec0,Csheen);float LGL_S,LGL_T,LGL_U,LGL_V;float fresnelWeight=LGL_H(si.metalness,si.eta,abs(dot(L,H)));LGL_R(si,Cspec0,fresnelWeight,LGL_S,LGL_T,LGL_U,LGL_V);float pdf;if(LGL_S>0.0&&L.z>0.0){f+=LGL_N(si,Csheen,V,L,H,pdf);bsdfPdf+=pdf*LGL_S;}if(LGL_T>0.0&&L.z>0.0&&V.z>0.0){f+=LGL_O(si,Cspec0,V,L,H,pdf);bsdfPdf+=pdf*LGL_T;}if(LGL_U>0.0&&L.z<0.0){f+=LGL_P(si,Cspec0,V,L,H,pdf);bsdfPdf+=pdf*LGL_U;}if(LGL_V>0.0&&L.z>0.0&&V.z>0.0){f+=LGL_Q(si,V,L,H,pdf);bsdfPdf+=pdf*LGL_V;}return f*abs(L.z);}vec3 LGL_e(inout SurfaceInteraction si,in Path path,in vec2 s1,in vec2 s2){si.eta=dot(si.normal,si.LGL_BX)>0.0 ?(1.0/si.ior): si.ior;vec3 viewDir=-path.ray.d;vec3 surfacePos=si.position+EPS*si.LGL_BX;vec3 Li=vec3(0.0);BsdfSampleRec bsdfSampleRec;vec2 lightDirSample=s1;vec2 envDirSample=s2;vec3 lightDir;vec2 uv;float lightPdf;bool brdfSample=false;\n#ifndef CONST_COLOR_ENV\nlightDir=invEnvRotMatrix*LGL_d(envDirSample,uv,lightPdf);LGL_Ah(path.ray,surfacePos,lightDir);if(!LGL_m(path.ray,INF-EPS)){vec3 irr=LGL_Az(envMap,uv).rgb*envMapIntensity;bsdfSampleRec.f=LGL_X(si,viewDir,lightDir,bsdfSampleRec.pdf);if(bsdfSampleRec.pdf>0.0){float LGL_Bd=LGL_Ar(lightPdf,bsdfSampleRec.pdf);if(LGL_Bd>0.0){Li+=LGL_Bd*bsdfSampleRec.f*irr/lightPdf;}}}\n#endif\n#if defined(NUM_LIGHTS)\nLightSampleRec lightSampleRec;Light light;int i=int(lightDirSample.x*float(NUM_LIGHTS));vec3 position=lights.position[i];vec3 emission=lights.emission[i];vec3 p1=lights.p1[i];vec3 p2=lights.p2[i];vec4 params=lights.params[i];float radius=params.x;float area=params.y;float type=params.z;float LGL_s=params.w;light=Light(position,emission,p1,p2,radius,area,type,LGL_s);LGL_Ax(light,surfacePos,lightSampleRec,lightDirSample);if(dot(lightSampleRec.direction,lightSampleRec.normal)<0.0){LGL_Ah(path.ray,surfacePos,lightSampleRec.direction);if(!LGL_m(path.ray,lightSampleRec.dist-EPS)){bsdfSampleRec.f=LGL_X(si,viewDir,lightSampleRec.direction,bsdfSampleRec.pdf);float LGL_Bd=1.0;if(light.area>0.0&&bsdfSampleRec.pdf>0.0){LGL_Bd=LGL_Ar(lightSampleRec.pdf,bsdfSampleRec.pdf);}if(LGL_Bd>0.0){Li+=LGL_Bd*bsdfSampleRec.f*lightSampleRec.emission/lightSampleRec.pdf;}}}\n#endif\nreturn Li;}layout(location=0)out vec4 out_light;void bounce(inout Path path,int depth,inout SurfaceInteraction si,inout BsdfSampleRec bsdfSampleRec,in LightSampleRec lightSampleRec){if(!si.LGL_BW){if(depth==0&&enviromentVisible==0.){path.alpha=0.0;path.LGL_Bc=true;return;}if(depth==0&&useBackgroundColor==1){path.li+=backgroundColor*path.beta;path.LGL_Bc=true;return;}\n#ifdef CONST_COLOR_ENV\npath.li+=backgroundColor*path.beta;path.LGL_Bc=true;return;\n#else\nfloat LGL_Bd=1.0;vec3 envSampleDir=envRotMatrix*path.ray.d;if(depth>0){float lightPdf=LGL_c(envSampleDir);LGL_Bd=LGL_Ar(bsdfSampleRec.pdf,lightPdf);}vec3 irr=LGL_Z(envSampleDir)*envMapIntensity;path.li+=LGL_Bd*path.beta*irr;path.LGL_Bc=true;return;\n#endif\n}if(si.LGL_BU){path.li+=LGL_As(path.ray,depth,lightSampleRec,bsdfSampleRec)*path.beta;path.LGL_Bc=true;return;}if(dot(si.normal,si.LGL_BX)>0.0){path.LGL_Be=vec3(0.0);}path.li+=path.beta*si.emissive;path.beta*=exp(-path.LGL_Be*si.t);MaterialSamples LGL_AaomSamples=getRandomMaterialSamples();if(si.LGL_BT==DISNEY){path.li+=LGL_e(si,path,LGL_AaomSamples.s1,LGL_AaomSamples.s2)*path.beta;}bsdfSampleRec.f=LGL_W(si,-path.ray.d,si.LGL_BX,bsdfSampleRec.L,bsdfSampleRec.pdf,LGL_AaomSamples);if(dot(si.LGL_BX,bsdfSampleRec.L)<0.0){path.LGL_Be=-log(si.extinction)/si.LGL_BQ;}if(bsdfSampleRec.pdf>0.0){path.beta*=bsdfSampleRec.f/bsdfSampleRec.pdf;}else{path.LGL_Bc=true;return;}if(depth>=2){float q=1.0-LGL_Af(path.beta);if(LGL_AaomSample()<q){path.LGL_Bc=true;return;}path.beta/=1.0-q;}LGL_Ah(path.ray,si.position+EPS*bsdfSampleRec.L,bsdfSampleRec.L);}vec4 LGL_BA(inout Ray ray){SurfaceInteraction si;Path path;BsdfSampleRec bsdfSampleRec;LightSampleRec lightSampleRec;path.ray=ray;path.li=vec3(0);path.alpha=1.0;path.LGL_Bc=false;path.LGL_Bd=1.0;path.LGL_Be=vec3(0.0);path.beta=vec3(1.0);for(int i=0;i<bounces;i++){if(path.LGL_Bc){return vec4(path.li,path.alpha);}LGL_n(path.ray,si,lightSampleRec,i);LGL_o(path.ray,si,lightSampleRec,i);bounce(path,i,si,bsdfSampleRec,lightSampleRec);}return vec4(path.li,path.alpha);}void main(){LGL_Ac(frameCount);vec2 vCoordAntiAlias=vCoord+jitter;vec3 direction=normalize(vec3(vCoordAntiAlias-0.5,-1.0)*vec3(camera.aspect,1.0,camera.fov));vec3 origin=camera.transform[3].xyz;direction=mat3(camera.transform)*direction;Ray cam;LGL_Ah(cam,origin,direction);vec4 LGL_Ak=LGL_BA(cam);if(!(LGL_Ak.x<INF&&LGL_Ak.x>-EPS)){LGL_Ak=vec4(0,0,0,1);}out_light=LGL_Ak;}"};function Dg(e,t){const n=[],r=e**t;for(let s=0;s<r;s++)n[s]=s;let i=n.length;const a=[];function o(){i=0}return{next:function(){i>=n.length&&(function(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}}(n),o());let r=n[i++];for(let n=0;n<t;n++)a[n]=r%e+Math.random(),r=Math.floor(r/e);return a},restart:o,strataCount:e}}function kg(e,t){const n=[];for(const i of t)n.push(Dg(e,i));const r=[];return{next:function(){let e=0;for(const t of n){const n=t.next();for(const t of n)r[e++]=t}return r},restart:function(){for(const e of n)e.restart()},strataCount:e}}const Og="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIHR7Y29uc3RydWN0b3IodD0wLGU9MCxuPTApe3RoaXMueD10LHRoaXMueT1lLHRoaXMuej1ufWxlbmd0aCgpe3JldHVybiBNYXRoLnNxcnQodGhpcy54KnRoaXMueCt0aGlzLnkqdGhpcy55K3RoaXMueip0aGlzLnopfWFkZFZlY3RvcnModCxlKXtyZXR1cm4gdGhpcy54PXQueCtlLngsdGhpcy55PXQueStlLnksdGhpcy56PXQueitlLnosdGhpc31zdWJWZWN0b3JzKHQsZSl7cmV0dXJuIHRoaXMueD10LngtZS54LHRoaXMueT10LnktZS55LHRoaXMuej10LnotZS56LHRoaXN9bXVsdGlwbHlTY2FsYXIodCl7cmV0dXJuIHRoaXMueCo9dCx0aGlzLnkqPXQsdGhpcy56Kj10LHRoaXN9ZGl2aWRlKHQpe3JldHVybiB0aGlzLngvPXQueCx0aGlzLnkvPXQueSx0aGlzLnovPXQueix0aGlzfWRpdmlkZVNjYWxhcih0KXtyZXR1cm4gdGhpcy5tdWx0aXBseVNjYWxhcigxL3QpfW1pbih0KXtyZXR1cm4gdGhpcy54PU1hdGgubWluKHRoaXMueCx0LngpLHRoaXMueT1NYXRoLm1pbih0aGlzLnksdC55KSx0aGlzLno9TWF0aC5taW4odGhpcy56LHQueiksdGhpc31tYXgodCl7cmV0dXJuIHRoaXMueD1NYXRoLm1heCh0aGlzLngsdC54KSx0aGlzLnk9TWF0aC5tYXgodGhpcy55LHQueSksdGhpcy56PU1hdGgubWF4KHRoaXMueix0LnopLHRoaXN9ZG90KHQpe3JldHVybiB0aGlzLngqdC54K3RoaXMueSp0LnkrdGhpcy56KnQuen1ub3JtYWxpemUoKXtyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIodGhpcy5sZW5ndGgoKXx8MSl9Y3Jvc3NWZWN0b3JzKHQsZSl7Y29uc3Qgbj10LngsaT10Lnkscj10Lnoscz1lLngsbz1lLnksaD1lLno7cmV0dXJuIHRoaXMueD1pKmgtcipvLHRoaXMueT1yKnMtbipoLHRoaXMuej1uKm8taSpzLHRoaXN9ZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LGUsbil7cmV0dXJuIHZvaWQgMCE9PW4mJmNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yMzogb2Zmc2V0IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSAuZnJvbUJ1ZmZlckF0dHJpYnV0ZSgpLiIpLHRoaXMueD10LmdldFgoZSksdGhpcy55PXQuZ2V0WShlKSx0aGlzLno9dC5nZXRaKGUpLHRoaXN9fWNsYXNzIGV7Y29uc3RydWN0b3IoZT1uZXcgdCgxLzAsMS8wLDEvMCksbj1uZXcgdCgtMS8wLC0xLzAsLTEvMCkpe3RoaXMubWluPWUsdGhpcy5tYXg9bn1pc0VtcHR5KCl7cmV0dXJuIHRoaXMubWF4Lng8dGhpcy5taW4ueHx8dGhpcy5tYXgueTx0aGlzLm1pbi55fHx0aGlzLm1heC56PHRoaXMubWluLnp9Z2V0Q2VudGVyKHQpe3JldHVybiB0aGlzLmlzRW1wdHkoKT90LnNldCgwLDAsMCk6dC5hZGRWZWN0b3JzKHRoaXMubWluLHRoaXMubWF4KS5tdWx0aXBseVNjYWxhciguNSl9Z2V0U2l6ZSh0KXtyZXR1cm4gdGhpcy5pc0VtcHR5KCk/dC5zZXQoMCwwLDApOnQuc3ViVmVjdG9ycyh0aGlzLm1heCx0aGlzLm1pbil9ZXhwYW5kQnlQb2ludCh0KXtyZXR1cm4gdGhpcy5taW4ubWluKHQpLHRoaXMubWF4Lm1heCh0KSx0aGlzfXVuaW9uKHQpe3JldHVybiB0aGlzLm1pbi5taW4odC5taW4pLHRoaXMubWF4Lm1heCh0Lm1heCksdGhpc319ZnVuY3Rpb24gbih0LGUsbil7Y29uc3QgaT10W25dO3Rbbl09dFtlXSx0W2VdPWl9bGV0IGk9MCxyPTAscz1udWxsLG89ITE7Y29uc3QgaD1uZXcgdDtmdW5jdGlvbiBhKHQsZSl7cmV0dXJue3ByaW1pdGl2ZXM6dCxib3VuZHM6ZX19ZnVuY3Rpb24gbCh0LGUsbil7bGV0IGk9bltlXS10Lm1pbltlXTtyZXR1cm4gdC5tYXhbZV0+dC5taW5bZV0mJihpLz10Lm1heFtlXS10Lm1pbltlXSksaX1mdW5jdGlvbiB1KHQpe3JldHVybiB0LmdldFNpemUoaCksMiooaC54KmgueitoLngqaC55K2gueipoLnkpfWZ1bmN0aW9uIGModCxtLHgpe2NvbnN0IGY9bmV3IGU7Zm9yKGxldCBlPW07ZTx4O2UrKylmLnVuaW9uKHRbZV0uYm91bmRzKTtpZihvKXtyKz0xLHMoci9pKX1jb25zdCB5PXgtbTtpZigxPT09eSlyZXR1cm4gYSh0LnNsaWNlKG0seCksZik7e2NvbnN0IGk9bmV3IGU7Zm9yKGxldCBlPW07ZTx4O2UrKylpLmV4cGFuZEJ5UG9pbnQodFtlXS5jZW50ZXIpO2NvbnN0IHI9KGkuZ2V0U2l6ZShoKSxoLng+aC56P2gueD5oLnk/IngiOiJ5IjpoLno+aC55PyJ6IjoieSIpO2xldCBzPU1hdGguZmxvb3IoKG0reCkvMik7aWYoeTw9NCkhZnVuY3Rpb24odCxlLGk9MCxyPXQubGVuZ3RoLHM9TWF0aC5mbG9vcigoaStyKS8yKSl7Zm9yKGxldCBvPWk7bzw9cztvKyspe2xldCBpPW8scz10W29dO2ZvcihsZXQgaD1vKzE7aDxyO2grKyllKHMsdFtoXSl8fChpPWgscz10W2hdLG4odCxvLGkpKX19KHQsKCh0LGUpPT50LmNlbnRlcltyXTxlLmNlbnRlcltyXSksbSx4LHMpO2Vsc2V7aWYoaS5tYXhbcl09PT1pLm1pbltyXSlyZXR1cm4gYSh0LnNsaWNlKG0seCksZik7e2NvbnN0IG89MTIsaD1bXTtmb3IobGV0IHQ9MDt0PG87dCsrKWgucHVzaCh7Ym91bmRzOm5ldyBlLGNvdW50OjB9KTtmb3IobGV0IGU9bTtlPHg7ZSsrKXtsZXQgbj1NYXRoLmZsb29yKG8qbChpLHIsdFtlXS5jZW50ZXIpKTtuPT09aC5sZW5ndGgmJihuPWgubGVuZ3RoLTEpLGhbbl0uY291bnQrKyxoW25dLmJvdW5kcy51bmlvbih0W2VdLmJvdW5kcyl9Y29uc3QgYT1bXTtmb3IobGV0IHQ9MDt0PGgubGVuZ3RoLTE7dCsrKXtjb25zdCBuPW5ldyBlLGk9bmV3IGU7bGV0IHI9MCxzPTA7Zm9yKGxldCBlPTA7ZTw9dDtlKyspbi51bmlvbihoW2VdLmJvdW5kcykscis9aFtlXS5jb3VudDtmb3IobGV0IGU9dCsxO2U8aC5sZW5ndGg7ZSsrKWkudW5pb24oaFtlXS5ib3VuZHMpLHMrPWhbZV0uY291bnQ7YS5wdXNoKC4xKyhyKnUobikrcyp1KGkpKS91KGYpKX1sZXQgYz1hWzBdLHk9MDtmb3IobGV0IHQ9MTt0PGEubGVuZ3RoO3QrKylhW3RdPGMmJihjPWFbdF0seT10KTtzPWZ1bmN0aW9uKHQsZSxpPTAscj10Lmxlbmd0aCl7Zm9yKDtpIT09cjspe2Zvcig7ZSh0W2ldKTspaWYoKytpPT09cilyZXR1cm4gaTtkb3tpZihpPT09LS1yKXJldHVybiBpfXdoaWxlKCFlKHRbcl0pKTtuKHQsaSxyKSxpKyt9cmV0dXJuIGl9KHQsKHQ9PntsZXQgZT1NYXRoLmZsb29yKGgubGVuZ3RoKmwoaSxyLHQuY2VudGVyKSk7cmV0dXJuIGU9PT1oLmxlbmd0aCYmKGU9aC5sZW5ndGgtMSksZTw9eX0pLG0seCl9fXJldHVybiB6PXIsZD1jKHQsbSxzKSxnPWModCxzLHgpLHtjaGlsZDA6ZCxjaGlsZDE6Zyxib3VuZHM6KG5ldyBlKS51bmlvbihkLmJvdW5kcykudW5pb24oZy5ib3VuZHMpLHNwbGl0QXhpczp6fX12YXIgeixkLGd9ZnVuY3Rpb24gbShuLHIpe2NvbnN0IGg9ZnVuY3Rpb24obil7Y29uc3QgaT1bXSxyPW4uZ2V0SW5kZXg/bi5nZXRJbmRleCgpLmFycmF5Om4uaW5kZXguYXJyYXkscz1uLmdldEF0dHJpYnV0ZT9uLmdldEF0dHJpYnV0ZSgicG9zaXRpb24iKTpuLmF0dHJpYnV0ZXMucG9zaXRpb24sbz1uLmdldEF0dHJpYnV0ZT9uLmdldEF0dHJpYnV0ZSgibWF0ZXJpYWxNZXNoSW5kZXgiKTpuLmF0dHJpYnV0ZXMubWF0ZXJpYWxNZXNoSW5kZXgsaD1uZXcgdCxhPW5ldyB0LGw9bmV3IHQsdT1uZXcgdCxjPW5ldyB0O2ZvcihsZXQgbT0wO208ci5sZW5ndGg7bSs9Myl7Y29uc3Qgbj1yW21dLHg9clttKzFdLGY9clttKzJdLHk9bmV3IGU7cy5nZXRYPyhoLmZyb21CdWZmZXJBdHRyaWJ1dGUocyxuKSxhLmZyb21CdWZmZXJBdHRyaWJ1dGUocyx4KSxsLmZyb21CdWZmZXJBdHRyaWJ1dGUocyxmKSk6KGgueD1zLmFycmF5W24qcy5pdGVtU2l6ZV0saC55PXMuYXJyYXlbbipzLml0ZW1TaXplKzFdLGguej1zLmFycmF5W24qcy5pdGVtU2l6ZSsyXSxhLng9cy5hcnJheVt4KnMuaXRlbVNpemVdLGEueT1zLmFycmF5W3gqcy5pdGVtU2l6ZSsxXSxhLno9cy5hcnJheVt4KnMuaXRlbVNpemUrMl0sbC54PXMuYXJyYXlbZipzLml0ZW1TaXplXSxsLnk9cy5hcnJheVtmKnMuaXRlbVNpemUrMV0sbC56PXMuYXJyYXlbZipzLml0ZW1TaXplKzJdKSx5LmV4cGFuZEJ5UG9pbnQoaCkseS5leHBhbmRCeVBvaW50KGEpLHkuZXhwYW5kQnlQb2ludChsKSx1LnN1YlZlY3RvcnMobCxoKSxjLnN1YlZlY3RvcnMoYSxoKTtjb25zdCB6PShuZXcgdCkuY3Jvc3NWZWN0b3JzKGMsdSkubm9ybWFsaXplKCksZD17Ym91bmRzOnksY2VudGVyOnkuZ2V0Q2VudGVyKG5ldyB0KSxpbmRpY2VzOltuLHgsZl0sZmFjZU5vcm1hbDp6LG1hdGVyaWFsSW5kZXg6by5nZXRYP28uZ2V0WChuKTpvLmFycmF5W24qby5pdGVtU2l6ZV19O2kucHVzaChkKX1yZXR1cm4gaX0obik7ciYmKGk9MipoLmxlbmd0aC0xLG89ITAscz1yKTtyZXR1cm4gYyhoLDAsaC5sZW5ndGgpfXNlbGYub25tZXNzYWdlPWZ1bmN0aW9uKHtkYXRhOnR9KXtjb25zdHtnZW9tZXRyeTplfT10O2xldCBuPXBlcmZvcm1hbmNlLm5vdygpO2NvbnN0IGk9dD0+e2NvbnN0IGU9cGVyZm9ybWFuY2Uubm93KCk7KGUtbj49MTB8fDE9PT10KSYmKG49ZSxzZWxmLnBvc3RNZXNzYWdlKHtlcnJvcjpudWxsLGZsYXR0ZW5lZEJ2aDpudWxsLHByb2dyZXNzOnR9KSl9O3RyeXtjb25zdCB0PWZ1bmN0aW9uKHQpe2NvbnN0IGU9W10sbj1bXSxpPXt4OjAseToxLHo6Mn07bGV0IHI9MTtjb25zdCBzPSh0LG89MSk9PntpZihyPU1hdGgubWF4KG8sciksdC5wcmltaXRpdmVzKWZvcihsZXQgaT0wO2k8dC5wcmltaXRpdmVzLmxlbmd0aDtpKyspe2NvbnN0IHI9dC5wcmltaXRpdmVzW2ldO2UucHVzaChyLmluZGljZXNbMF0sci5pbmRpY2VzWzFdLHIuaW5kaWNlc1syXSx0LnByaW1pdGl2ZXMubGVuZ3RoLHIuZmFjZU5vcm1hbC54LHIuZmFjZU5vcm1hbC55LHIuZmFjZU5vcm1hbC56LHIubWF0ZXJpYWxJbmRleCksbi5wdXNoKCExKX1lbHNle2NvbnN0IHI9dC5ib3VuZHM7ZS5wdXNoKHIubWluLngsci5taW4ueSxyLm1pbi56LGlbdC5zcGxpdEF4aXNdLHIubWF4Lngsci5tYXgueSxyLm1heC56LG51bGwpO2NvbnN0IGg9ZS5sZW5ndGgtMTtuLnB1c2goITApLHModC5jaGlsZDAsbysxKSxlW2hdPWUubGVuZ3RoLzQscyh0LmNoaWxkMSxvKzEpfX07cyh0KTtjb25zdCBvPW5ldyBBcnJheUJ1ZmZlcig0KmUubGVuZ3RoKSxoPW5ldyBGbG9hdDMyQXJyYXkobyk7Zm9yKGxldCBhPTA7YTxuLmxlbmd0aDthKyspe2xldCB0PTgqYTtuW2FdPyhoW3RdPWVbdF0saFt0KzFdPWVbdCsxXSxoW3QrMl09ZVt0KzJdLGhbdCszXT1lW3QrM10pOihoW3RdPWVbdF0saFt0KzFdPWVbdCsxXSxoW3QrMl09ZVt0KzJdLGhbdCszXT0tZVt0KzNdKSxoW3QrNF09ZVt0KzRdLGhbdCs1XT1lW3QrNV0saFt0KzZdPWVbdCs2XSxoW3QrN109ZVt0KzddfXJldHVybnttYXhEZXB0aDpyLGNvdW50OmUubGVuZ3RoLzQsYnVmZmVyOmh9fShtKGUsaSkpO3NlbGYucG9zdE1lc3NhZ2Uoe2Vycm9yOm51bGwscHJvZ3Jlc3M6bnVsbCxmbGF0dGVuZWRCdmg6dH0pfWNhdGNoKHIpe3NlbGYucG9zdE1lc3NhZ2Uoe2Vycm9yOnIscHJvZ3Jlc3M6bnVsbCxmbGF0dGVuZWRCdmg6bnVsbH0pfX19KCk7Cg==",jg="undefined"!=typeof window&&window.Blob&&new Blob([atob(Og)],{type:"text/javascript;charset=utf-8"});function Vg(){const e=jg&&(window.URL||window.webkitURL).createObjectURL(jg);try{return e?new Worker(e):new Worker("data:application/javascript;base64,"+Og,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}class Hg{constructor(){this.worker=new Vg,this.building=!1}build(e,t){if(this.building)throw new Error("BVHWorker is building");this.building=!0;const{worker:n}=this;return new Promise(((r,i)=>{n.onmessage=e=>{this.building=!1;const{flattenedBvh:a,error:o,progress:s}=e.data;o?i(new Error(o)):a?(n.onmessage=null,r(a)):null!=s&&t(s)},n.postMessage({geometry:e})}))}}function Xg(e){const t=Math.round(Math.log2(Math.sqrt(e))),n=2**t,r=Math.ceil(e/n);return{columnsLog:t,columns:n,rows:r,size:r*n}}function Wg(e,t,n){const r=Xg(t.length/n);return ug(e,{data:Yg(t,n*r.size),width:r.columns,height:r.rows})}function Yg(e,t){const n=new e.constructor(t);return n.set(e),n}async function $g(e,{bounces:t,decomposedScene:n,fullscreenQuad:r,materialBuffer:a,mergedMesh:s,optionalExtensions:l,envMapIntensity:c,useBackgroundColor:u,backgroundColor:d,enviromentVisible:f,useWorker:p,loadingCallback:h}){let m;const v=await async function({decomposedScene:e,fullscreenQuad:t,gl:n,materialBuffer:r,mergedMesh:i,optionalExtensions:a,useWorker:o,loadingCallback:s}){const{OES_texture_float_linear:l}=a,{camera:c,meshLightsNum:u,isTextureEnv:d}=e,{geometry:f,materials:p}=i,h=await function(e,t=!0,n){return t&&window.Worker?(new Hg).build(e,n):new Promise((t=>{const n=function(e){const t=[],n=[],r={x:0,y:1,z:2};let i=1;const a=(e,o=1)=>{if(i=Math.max(o,i),e.primitives)for(let r=0;r<e.primitives.length;r++){const i=e.primitives[r];t.push(i.indices[0],i.indices[1],i.indices[2],e.primitives.length,i.faceNormal.x,i.faceNormal.y,i.faceNormal.z,i.materialIndex),n.push(!1)}else{const i=e.bounds;t.push(i.min.x,i.min.y,i.min.z,r[e.splitAxis],i.max.x,i.max.y,i.max.z,null);const s=t.length-1;n.push(!0),a(e.child0,o+1),t[s]=t.length/4,a(e.child1,o+1)}};a(e);const o=new ArrayBuffer(4*t.length),s=new Float32Array(o);for(let l=0;l<n.length;l++){let e=8*l;n[l]?(s[e]=t[e],s[e+1]=t[e+1],s[e+2]=t[e+2],s[e+3]=t[e+3]):(s[e]=t[e],s[e+1]=t[e+1],s[e+2]=t[e+2],s[e+3]=-t[e+3]),s[e+4]=t[e+4],s[e+5]=t[e+5],s[e+6]=t[e+6],s[e+7]=t[e+7]}return{maxDepth:i,count:t.length/4,buffer:s}}(Ug(e));t(n)}))}(f,o,s.onProgress),m=f.index.count/3,v=cg(n,{defines:$v({OES_texture_float_linear:l,BVH_COLUMNS:Xg(h.count).columnsLog,INDEX_COLUMNS:Xg(m).columnsLog,VERTEX_COLUMNS:Xg(f.attributes.position.count).columnsLog,STACK_SIZE:h.maxDepth,NUM_LIGHTS:u,CONST_COLOR_ENV:!d},r.defines),fragment:Bg,vertex:t.vertexShader});return v.setTexture("diffuseMap",r.textures.diffuseMap),v.setTexture("normalMap",r.textures.normalMap),v.setTexture("pbrMap",r.textures.pbrMap),v.setTexture("pbrSGMap",r.textures.pbrSGMap),r.textures.emissiveMap&&v.setTexture("emissiveMap",r.textures.emissiveMap),v.setTexture("positionBuffer",Wg(n,f.getAttribute("position").array,3)),v.setTexture("normalBuffer",Wg(n,f.getAttribute("normal").array,3)),v.setTexture("uvBuffer",Wg(n,f.getAttribute("uv").array,2)),v.setTexture("bvhBuffer",Wg(n,h.buffer,4)),v}({bounces:t,decomposedScene:n,fullscreenQuad:r,gl:e,materialBuffer:a,mergedMesh:s,optionalExtensions:l,useWorker:p,loadingCallback:h}),g=[],x=new K;function y(e){g.length=0,e=Kv(e,2,8);for(let t=1;t<=e;t++)g.push(2,2,2,2),t>=2&&g.push(1);v.setUniform("bounces",e),m&&(m.strataCount=-1)}function b(t){const{OES_texture_float_linear:n}=l,{environment:r,isTextureEnv:a}=t;if(a){const t=function(e){let t;return e&&e.data&&e.data.isTexture?t=function(e){let t;return t={width:e.data.image.width,height:e.data.image.height,data:e.data.image.data,dataFormat:"float"},e.data.type===o?t.data?t.data=function(e,t=1){const n=e.length/4,r=new Float32Array(3*n),i=[];for(let a=0;a<255;a++)i[a]=t*Math.pow(2,a-128)/255;for(let a=0;a<n;a++){const t=e[4*a],n=e[4*a+1],o=e[4*a+2],s=i[e[4*a+3]];r[3*a]=t*s,r[3*a+1]=n*s,r[3*a+2]=o*s}return r}(t.data,e.intensity):(t.data=function(e){const t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,t.width,t.height).data}(e.data.image),t.dataFormat="byte"):e.data.type==B?console.error("Please use 'new RGBELoader().setDataType(THREE.FloatType)' to load hdr env map. Half-Float type will loss of precision and have an impression of the effect."):e.data.type!==i&&console.error(`No support environmentLight's data type: ${e.data.type.toString()}`),t}(e):console.warn(`No support environment type: ${e.data}`),t}(r),a=t.width,s=t.height;if(t){const r=ug(e,{data:t.data,storage:t.dataFormat,minFilter:n?e.LINEAR:e.NEAREST,magFilter:n?e.LINEAR:e.NEAREST,width:t.width,height:t.height});v.setTexture("envMap",r);const{marginalDataArray:i,conditionalDataArray:o,totalSumValue:l}=function(e){const{width:t,height:n,data:r}=e,i=new Float32Array(t*n),a=new Float32Array(t*n),o=new Float32Array(n),s=new Float32Array(n);let l=0,c=0;for(let f=0;f<n;f++){let e=0;for(let n=0;n<t;n++){const o=f*t+n,s=zg(r[4*o+0],r[4*o+1],r[4*o+2]);e+=s,l+=s,i[o]=s,a[o]=e}if(0!==e)for(let n=f*t,r=f*t+t;n<r;n++)i[n]/=e,a[n]/=e;c+=e,o[f]=e,s[f]=c}if(0!==c)for(let f=0,p=o.length;f<p;f++)o[f]/=c,s[f]/=c;const u=new Float32Array(n),d=new Float32Array(t*n);for(let f=0;f<n;f++){const e=Gg(s,(f+1)/n);u[f]=(e+.5)/n}for(let f=0;f<n;f++)for(let e=0;e<t;e++){const n=f*t+e,r=Gg(a,(e+1)/t,f*t,t);d[n]=(r+.5)/t}return{marginalDataArray:u,conditionalDataArray:d,totalSumValue:l}}(t);v.setUniform("totalSumValue",l),v.setTexture("envMarginalWeights",ug(e,{data:i,storage:"float",channels:1,width:s,height:1})),v.setTexture("envConditionalWeights",ug(e,{data:o,storage:"float",channels:1,width:a,height:s})),v.setUniform("useBackgroundColor",Number(u)),d&&d.isColor?v.setUniform("backgroundColor",[d.r,d.g,d.b]):v.setUniform("backgroundColor",[1,1,1])}}else{const e=r.data;e&&e.isColor?v.setUniform("backgroundColor",[e.r,e.g,e.b]):v.setUniform("backgroundColor",[0,0,0])}v.setUniform("envMapIntensity",c),L(f)}function _(e){const{meshLights:t}=e;t&&(v.setUniform("lights.position[0]",t.position),v.setUniform("lights.emission[0]",t.emission),v.setUniform("lights.p1[0]",t.p1),v.setUniform("lights.p2[0]",t.p2),v.setUniform("lights.params[0]",t.params))}function L(e){v.setUniform("enviromentVisible",Number(e))}function S(){v.setUniform("stratifiedSamples[0]",m.next())}return y(t),b(n),_(n),m=kg(1,g),{bindTextures:function(){v.bindTextures()},draw:function(){v.useProgram(!1),r.draw()},outputLocs:v.outputLocs,textures:v.textures,setSize:function(e,t){v.setUniform("pixelSize",1/e,1/t)},setCamera:function(e){v.setUniform("camera.transform",e.matrixWorld.elements),v.setUniform("camera.aspect",e.aspect),v.setUniform("camera.fov",.5/Math.tan(.5*Math.PI*e.fov/180)),e.isLensCamera&&(v.setUniform("camera.aperture",e.aperture),v.setUniform("camera.focus",e.focus))},setGBuffers:function({position:e}){v.setTexture("gPosition",e)},setNoise:function(t){v.setTexture("noiseTex",ug(e,{data:t,wrapS:e.REPEAT,wrapT:e.REPEAT,storage:"halfFloat"}))},setJitter:function(e,t){v.setUniform("jitter",e,t)},setFrameCount:function(e){v.setUniform("frameCount",e)},setStrataCount:function(e){e>1&&e!==m.strataCount?m=kg(e,g):m.restart(),v.setUniform("strataSize",1/e),S()},nextSeed:S,setEnvMapIntensity:function(e){v.setUniform("envMapIntensity",e)},setEnviromentVisible:L,updateBounces:y,updateEnvLight:b,updateMeshLight:_,updateMeshMaterial:function(e){v.setTexture("diffuseMap",e.textures.diffuseMap),v.setTexture("normalMap",e.textures.normalMap),v.setTexture("pbrMap",e.textures.pbrMap),v.setTexture("pbrSGMap",e.textures.pbrSGMap),e.textures.emissiveMap&&v.setTexture("emissiveMap",e.textures.emissiveMap)},dispose:function(){v.dispose()},toggleBackgroundColor:function(e){v.setUniform("useBackgroundColor",Number(e))},setBackgroundColor:function(e){e.isColor?v.setUniform("backgroundColor",[e.r,e.g,e.b]):console.log("illegal color value!")},setEnvRotMatrix:function(e){v.setUniform("envRotMatrix",e.elements),x.copy(e).invert(),v.setUniform("invEnvRotMatrix",x.elements)}}}var Zg={source:"in vec3 aPosition;in vec3 aNormal;in vec2 aUv;in ivec2 aMaterialMeshIndex;uniform mat4 projView;out vec3 vPosition;out vec3 vNormal;out vec2 vUv;flat out ivec2 vMaterialMeshIndex;void main(){vPosition=aPosition;vNormal=aNormal;vUv=aUv;vMaterialMeshIndex=aMaterialMeshIndex;gl_Position=projView*vec4(aPosition,1);}"},Qg={source:"\n#define PI 3.14159265359\n#define TWOPI 6.28318530718\n#define INVPI 0.31830988618\n#define INVPI2 0.10132118364\n#define EPS 0.0001\n#define ONE_MINUS_EPS 0.999999\n#define INF 1000000.0\n#define ROUGHNESS_MIN 0.001\nuniform Materials{vec4 colorAndMaterialType[NUM_MATERIALS];vec4 roughnessMetalnessNormalScale[NUM_MATERIALS];vec4 alphaSpecularTintSheenSheenTint[NUM_MATERIALS];vec4 clearcoaRoughnessSubfaceTransmission[NUM_MATERIALS];vec4 iorAtDistanceAnisotropicWorkflow[NUM_MATERIALS];vec4 extinction[NUM_MATERIALS];vec4 specularColorGlossiness[NUM_MATERIALS];\n#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS) || defined(NUM_PBR_MAPS)\nivec4 diffuseNormalRoughnessMetalnessMapIndex[NUM_MATERIALS];\n#endif\n#if defined(NUM_EMISSIVE_MAPS) || defined(NUM_PBR_SG_MAPS)\nivec4 emissiveSpecularGlossinessMapIndex[NUM_MATERIALS];\n#endif\n#if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS)\nvec4 diffuseNormalMapSize[NUM_DIFFUSE_NORMAL_MAPS];\n#endif\n#if defined(NUM_PBR_MAPS)\nvec2 pbrMapSize[NUM_PBR_MAPS];\n#else\n#if defined(NUM_PBR_SG_MAPS)\nvec2 pbrMapSize[NUM_PBR_SG_MAPS];\n#else\n#if defined(NUM_EMISSIVE_MAPS)\nvec2 pbrMapSize[NUM_EMISSIVE_MAPS];\n#endif\n#endif\n#endif\n}materials;\n#ifdef NUM_DIFFUSE_MAPS\nuniform mediump sampler2DArray diffuseMap;\n#endif\n#ifdef NUM_NORMAL_MAPS\nuniform mediump sampler2DArray normalMap;\n#endif\n#ifdef NUM_PBR_MAPS\nuniform mediump sampler2DArray pbrMap;\n#endif\n#ifdef NUM_PBR_SG_MAPS\nuniform mediump sampler2DArray pbrSGMap;\n#endif\n#ifdef NUM_EMISSIVE_MAPS\nuniform mediump sampler2DArray emissiveMap;\n#endif\nfloat LGL_w(int materialIndex){return materials.colorAndMaterialType[materialIndex].w;}float LGL_x(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].w;}vec3 LGL_y(int materialIndex,vec2 uv){vec3 emissive=vec3(0.0);\n#ifdef NUM_EMISSIVE_MAPS\nint emissiveMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].x;if(emissiveMapIndex>=0){emissive=texture(emissiveMap,vec3(uv*materials.pbrMapSize[emissiveMapIndex].xy,emissiveMapIndex)).rgb;}\n#endif\nreturn emissive;}vec3 LGL_z(int materialIndex,vec2 uv){vec3 specularColor=materials.specularColorGlossiness[materialIndex].rgb;\n#ifdef NUM_PBR_SG_MAPS\nint specularMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].y;if(specularMapIndex>=0){vec3 LGL_AV=texture(pbrSGMap,vec3(uv*materials.pbrMapSize[specularMapIndex].xy,specularMapIndex)).rgb;LGL_AV=pow(LGL_AV,vec3(2.2));specularColor*=LGL_AV;}\n#endif\nreturn specularColor;}float LGL_AA(int materialIndex,vec2 uv){float glossiness=materials.specularColorGlossiness[materialIndex].a;\n#ifdef NUM_PBR_SG_MAPS\nint glossinessMapIndex=materials.emissiveSpecularGlossinessMapIndex[materialIndex].z;if(glossinessMapIndex>=0){float LGL_AW=texture(pbrSGMap,vec3(uv*materials.pbrMapSize[glossinessMapIndex].xy,glossinessMapIndex)).a;glossiness*=LGL_AW;}\n#endif\nreturn glossiness;}float LGL_AB(int materialIndex,vec2 uv){float LGL_BS=LGL_x(materialIndex);float roughness=0.0;if(LGL_BS>0.1){roughness=1.0-LGL_AA(materialIndex,uv);}else{roughness=materials.roughnessMetalnessNormalScale[materialIndex].x;\n#ifdef NUM_PBR_MAPS\nint roughnessMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].z;if(roughnessMapIndex>=0){roughness*=texture(pbrMap,vec3(uv*materials.pbrMapSize[roughnessMapIndex].xy,roughnessMapIndex)).g;}\n#endif\n}return roughness*roughness;}float LGL_AC(const vec3 v){return max(v.x,max(v.y,v.z));}float LGL_AD(const vec3 specularColor){return LGL_AC(specularColor);}vec3 LGL_AE(const vec3 baseColor,float metallic){return baseColor*(1.0-metallic);}float LGL_AF(int materialIndex,vec2 uv){float LGL_BS=LGL_x(materialIndex);float metalness=0.0;if(LGL_BS>0.1){vec3 specularFactor=LGL_z(materialIndex,uv);metalness=LGL_AD(specularFactor);}else{metalness=materials.roughnessMetalnessNormalScale[materialIndex].y;\n#ifdef NUM_PBR_MAPS\nint metalnessMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].w;if(metalnessMapIndex>=0){metalness*=texture(pbrMap,vec3(uv*materials.pbrMapSize[metalnessMapIndex].xy,metalnessMapIndex)).b;}\n#endif\n}return metalness;}vec3 LGL_AG(int materialIndex,vec2 uv){vec3 color=materials.colorAndMaterialType[materialIndex].rgb;\n#ifdef NUM_DIFFUSE_MAPS\nint diffuseMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;if(diffuseMapIndex>=0){color*=texture(diffuseMap,vec3(uv*materials.diffuseNormalMapSize[diffuseMapIndex].xy,diffuseMapIndex)).rgb;}\n#endif\nfloat LGL_BS=LGL_x(materialIndex);if(LGL_BS>0.1){vec3 specularFactor=LGL_z(materialIndex,uv);color=LGL_AE(color,LGL_AD(specularFactor));}return color;}vec3 LGL_AI(int materialIndex,vec2 uv,vec3 normal,vec3 dp1,vec3 dp2,vec2 duv1,vec2 duv2,inout vec3 tangent,inout vec3 bitangent){vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 dpdu=dp2perp*duv1.x+dp1perp*duv2.x;vec3 dpdv=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(dpdu,dpdu),dot(dpdv,dpdv)));dpdu*=invmax;dpdv*=invmax;tangent=normalize(dpdu);bitangent=normalize(dpdv);\n#ifdef NUM_NORMAL_MAPS\nint normalMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].y;if(normalMapIndex>=0){vec3 n=2.0*texture(normalMap,vec3(uv*materials.diffuseNormalMapSize[normalMapIndex].zw,normalMapIndex)).rgb-1.0;n.xy*=materials.roughnessMetalnessNormalScale[materialIndex].zw;mat3 tbn=mat3(dpdu,dpdv,normal);return normalize(tbn*n);}else{return normal;}\n#endif\nreturn normal;}float LGL_AL(int materialIndex,vec2 uv){float alpha=materials.alphaSpecularTintSheenSheenTint[materialIndex].x;\n#ifdef NUM_DIFFUSE_MAPS\nint diffuseMapIndex=materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;if(diffuseMapIndex>=0){alpha*=texture(diffuseMap,vec3(uv*materials.diffuseNormalMapSize[diffuseMapIndex].xy,diffuseMapIndex)).a;}\n#endif\nreturn alpha;}float LGL_AJ(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].y;}float LGL_AK(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].z;}float LGL_AKTint(int materialIndex){return materials.alphaSpecularTintSheenSheenTint[materialIndex].w;}float LGL_AN(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].x;}float LGL_ANRoughness(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].y;}float LGL_AP(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].z;}float LGL_AQ(int materialIndex){return materials.clearcoaRoughnessSubfaceTransmission[materialIndex].w;}float LGL_AR(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].x;}float LGL_AS(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].y;}float LGL_AT(int materialIndex){return materials.iorAtDistanceAnisotropicWorkflow[materialIndex].z;}vec3 LGL_AU(int materialIndex){return materials.extinction[materialIndex].rgb;}layout(location=0)out vec4 out_position;layout(location=1)out vec4 out_normal;layout(location=2)out vec4 out_color;in vec3 vPosition;in vec3 vNormal;in vec2 vUv;flat in ivec2 vMaterialMeshIndex;vec3 LGL_BYs(vec3 pos){vec3 fdx=dFdx(pos);vec3 fdy=dFdy(pos);return cross(fdx,fdy);}void main(){int materialIndex=vMaterialMeshIndex.x;int meshIndex=vMaterialMeshIndex.y;vec2 uv=fract(vUv);vec3 color=LGL_AG(materialIndex,uv);float LGL_BT=LGL_w(materialIndex);vec3 normal=normalize(vNormal);vec3 LGL_BY=normalize(LGL_BYs(vPosition));normal*=sign(dot(normal,LGL_BY));\n#ifdef NUM_NORMAL_MAPS\nvec3 dp1=dFdx(vPosition);vec3 dp2=dFdy(vPosition);vec2 duv1=dFdx(vUv);vec2 duv2=dFdy(vUv);vec3 tangent,bitangent;normal=LGL_AI(materialIndex,uv,normal,dp1,dp2,duv1,duv2,tangent,bitangent);\n#endif\nout_position=vec4(vPosition,float(meshIndex)+EPS);out_normal=vec4(normal,LGL_BT);out_color=vec4(color,0.);}"};function Kg(e,t,n){if(void 0===t)return;const{itemSize:r,array:i}=n;if(e.enableVertexAttribArray(t),e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),i instanceof Float32Array)e.vertexAttribPointer(t,r,e.FLOAT,!1,0,0);else{if(!(i instanceof Int32Array))throw"Unsupported buffer type";e.vertexAttribIPointer(t,r,e.INT,0,0)}}var qg={source:"layout(location=0)out vec4 out_color;in vec2 vCoord;uniform sampler2D lightTex;uniform vec2 lightScale;uniform int toneMappingFun;vec3 linear(vec3 color){return color;}vec3 LGL_BH(vec3 color){return clamp(color/(vec3(1.0)+color),vec3(0.0),vec3(1.0));}vec3 LGL_BI(vec3 color){color=max(vec3(0.0),color-0.004);return pow((color*(6.2*color+0.5))/(color*(6.2*color+1.7)+0.06),vec3(2.2));}vec3 LGL_BJ(vec3 color){return clamp((color*(2.51*color+0.03))/(color*(2.43*color+0.59)+0.14),vec3(0.0),vec3(1.0));}void main(){vec4 upscaledLight=texture(lightTex,lightScale*vCoord);vec3 light=upscaledLight.rgb/upscaledLight.a;if(toneMappingFun==0){light=linear(light);}if(toneMappingFun==1){light=LGL_BJ(light);}if(toneMappingFun==2){light=LGL_BH(light);}if(toneMappingFun==3){light=LGL_BI(light);}light=pow(light,vec3(1.0/2.2));if(upscaledLight.a==0.){out_color=vec4(light,0.0);}else{out_color=vec4(light,1.0);}}"};const Jg={[ue]:0,[pe]:1,[he]:2,[me]:3};var ex={source:"layout(location=0)out vec4 out_color;uniform sampler2D inputBuffer;uniform vec2 resolution;in vec2 vCoord;\n#define FXAA_PC 1\n#define FXAA_GLSL_100 1\n#define FXAA_QUALITY_PRESET 12\n#define FXAA_GREEN_AS_LUMA 1\n#ifndef FXAA_PC_CONSOLE\n#define FXAA_PC_CONSOLE 0\n#endif\n#ifndef FXAA_GLSL_120\n#define FXAA_GLSL_120 0\n#endif\n#ifndef FXAA_GLSL_130\n#define FXAA_GLSL_130 0\n#endif\n#ifndef FXAA_HLSL_3\n#define FXAA_HLSL_3 0\n#endif\n#ifndef FXAA_HLSL_4\n#define FXAA_HLSL_4 0\n#endif\n#ifndef FXAA_HLSL_5\n#define FXAA_HLSL_5 0\n#endif\n#ifndef FXAA_GREEN_AS_LUMA\n#define FXAA_GREEN_AS_LUMA 0\n#endif\n#ifndef FXAA_EARLY_EXIT\n#define FXAA_EARLY_EXIT 1\n#endif\n#ifndef FXAA_DISCARD\n#define FXAA_DISCARD 0\n#endif\n#ifndef FXAA_FAST_PIXEL_OFFSET\n#ifdef GL_EXT_gpu_shader4\n#define FXAA_FAST_PIXEL_OFFSET 1\n#endif\n#ifdef GL_NV_gpu_shader5\n#define FXAA_FAST_PIXEL_OFFSET 1\n#endif\n#ifdef GL_ARB_gpu_shader5\n#define FXAA_FAST_PIXEL_OFFSET 1\n#endif\n#ifndef FXAA_FAST_PIXEL_OFFSET\n#define FXAA_FAST_PIXEL_OFFSET 0\n#endif\n#endif\n#ifndef FXAA_GATHER4_ALPHA\n#if (FXAA_HLSL_5 == 1)\n#define FXAA_GATHER4_ALPHA 1\n#endif\n#ifdef GL_ARB_gpu_shader5\n#define FXAA_GATHER4_ALPHA 1\n#endif\n#ifdef GL_NV_gpu_shader5\n#define FXAA_GATHER4_ALPHA 1\n#endif\n#ifndef FXAA_GATHER4_ALPHA\n#define FXAA_GATHER4_ALPHA 0\n#endif\n#endif\n/*============================================================================FXAA QUALITY-TUNING KNOBS------------------------------------------------------------------------------NOTE the other tuning knobs are now in the shader function inputs!============================================================================*/\n#ifndef FXAA_QUALITY_PRESET\n#define FXAA_QUALITY_PRESET 12\n#endif\n/*============================================================================FXAA QUALITY-PRESETS============================================================================*//*============================================================================FXAA QUALITY-MEDIUM DITHER PRESETS============================================================================*/\n#if (FXAA_QUALITY_PRESET == 10)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 3.0\n#define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 3.0\n#define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 4.0\n#define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 4.0\n#define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 4.0\n#define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n#endif\n/*============================================================================FXAA QUALITY-LOW DITHER PRESETS============================================================================*/\n#if (FXAA_QUALITY_PRESET == 20)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 2.0\n#define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 3.0\n#define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n#define FXAA_QUALITY_PS 9\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 4.0\n#define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n#define FXAA_QUALITY_PS 10\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 4.0\n#define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n#define FXAA_QUALITY_PS 11\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 4.0\n#define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n/*============================================================================FXAA QUALITY-EXTREME QUALITY============================================================================*/\n#if (FXAA_QUALITY_PRESET == 39)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.0\n#define FXAA_QUALITY_P2 1.0\n#define FXAA_QUALITY_P3 1.0\n#define FXAA_QUALITY_P4 1.0\n#define FXAA_QUALITY_P5 1.5\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n/*============================================================================API PORTING============================================================================*/\n#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n#define FxaaBool bool\n#define FxaaDiscard discard\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 ivec2\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTex sampler2D\n#else\n#define FxaaBool bool\n#define FxaaDiscard clip(-1)\n#define FxaaFloat float\n#define FxaaFloat2 float2\n#define FxaaFloat3 float3\n#define FxaaFloat4 float4\n#define FxaaHalf half\n#define FxaaHalf2 half2\n#define FxaaHalf3 half3\n#define FxaaHalf4 half4\n#define FxaaSat(x) saturate(x)\n#endif\n#if (FXAA_GLSL_100 == 1)\n#define FxaaTexTop(t, p) texture(t, p, 0.0)\n#define FxaaTexOff(t, p, o, r) texture(t, p + (o * r), 0.0)\n#endif\n#if (FXAA_GLSL_120 == 1)\n#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n#if (FXAA_FAST_PIXEL_OFFSET == 1)\n#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n#else\n#define FxaaTexOff(t, p, o, r) textureLod(t, p + (o * r), 0.0)\n#endif\n#if (FXAA_GATHER4_ALPHA == 1)\n#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n#endif\n#endif\n#if (FXAA_GLSL_130 == 1)\n#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n#if (FXAA_GATHER4_ALPHA == 1)\n#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n#endif\n#endif\n#if (FXAA_HLSL_3 == 1)\n#define FxaaInt2 float2\n#define FxaaTex sampler2D\n#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n#endif\n#if (FXAA_HLSL_4 == 1)\n#define FxaaInt2 int2\nstruct FxaaTex{SamplerState smpl;texture tex;};\n#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n#endif\n#if (FXAA_HLSL_5 == 1)\n#define FxaaInt2 int2\nstruct FxaaTex{SamplerState smpl;texture tex;};\n#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n#endif\n/*============================================================================GREEN AS LUMA OPTION SUPPORT FUNCTION============================================================================*/\n#if (FXAA_GREEN_AS_LUMA == 0)\nFxaaFloat FxaaLuma(FxaaFloat4 rgba){return rgba.w;}\n#else\nFxaaFloat FxaaLuma(FxaaFloat4 rgba){return rgba.y;}\n#endif\n/*============================================================================FXAA3 QUALITY-PC============================================================================*/\n#if (FXAA_PC == 1)\nFxaaFloat4 FxaaPixelShader(FxaaFloat2 pos,FxaaFloat4 fxaaConsolePosPos,FxaaTex tex,FxaaTex fxaaConsole360TexExpBiasNegOne,FxaaTex fxaaConsole360TexExpBiasNegTwo,FxaaFloat2 fxaaQualityRcpFrame,FxaaFloat4 fxaaConsoleRcpFrameOpt,FxaaFloat4 fxaaConsoleRcpFrameOpt2,FxaaFloat4 fxaaConsole360RcpFrameOpt2,FxaaFloat fxaaQualitySubpix,FxaaFloat fxaaQualityEdgeThreshold,FxaaFloat fxaaQualityEdgeThresholdMin,FxaaFloat fxaaConsoleEdgeSharpness,FxaaFloat fxaaConsoleEdgeThreshold,FxaaFloat fxaaConsoleEdgeThresholdMin,FxaaFloat4 fxaaConsole360ConstDir){FxaaFloat2 posM;posM.x=pos.x;posM.y=pos.y;\n#if (FXAA_GATHER4_ALPHA == 1)\n#if (FXAA_DISCARD == 0)\nFxaaFloat4 rgbyM=FxaaTexTop(tex,posM);\n#if (FXAA_GREEN_AS_LUMA == 0)\n#define lumaM rgbyM.w\n#else\n#define lumaM rgbyM.y\n#endif\n#endif\n#if (FXAA_GREEN_AS_LUMA == 0)\nFxaaFloat4 luma4A=FxaaTexAlpha4(tex,posM);FxaaFloat4 luma4B=FxaaTexOffAlpha4(tex,posM,FxaaInt2(-1,-1));\n#else\nFxaaFloat4 luma4A=FxaaTexGreen4(tex,posM);FxaaFloat4 luma4B=FxaaTexOffGreen4(tex,posM,FxaaInt2(-1,-1));\n#endif\n#if (FXAA_DISCARD == 1)\n#define lumaM luma4A.w\n#endif\n#define lumaE luma4A.z\n#define lumaS luma4A.x\n#define lumaSE luma4A.y\n#define lumaNW luma4B.w\n#define lumaN luma4B.z\n#define lumaW luma4B.x\n#else\nFxaaFloat4 rgbyM=FxaaTexTop(tex,posM);\n#if (FXAA_GREEN_AS_LUMA == 0)\n#define lumaM rgbyM.w\n#else\n#define lumaM rgbyM.y\n#endif\n#if (FXAA_GLSL_100 == 1)\nFxaaFloat lumaS=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(0.0,1.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaE=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(1.0,0.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaN=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(0.0,-1.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaW=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(-1.0,0.0),fxaaQualityRcpFrame.xy));\n#else\nFxaaFloat lumaS=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,0),fxaaQualityRcpFrame.xy));FxaaFloat lumaN=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,0),fxaaQualityRcpFrame.xy));\n#endif\n#endif\nFxaaFloat maxSM=max(lumaS,lumaM);FxaaFloat minSM=min(lumaS,lumaM);FxaaFloat maxESM=max(lumaE,maxSM);FxaaFloat minESM=min(lumaE,minSM);FxaaFloat maxWN=max(lumaN,lumaW);FxaaFloat minWN=min(lumaN,lumaW);FxaaFloat rangeMax=max(maxWN,maxESM);FxaaFloat rangeMin=min(minWN,minESM);FxaaFloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;FxaaFloat range=rangeMax-rangeMin;FxaaFloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);FxaaBool earlyExit=range<rangeMaxClamped;if(earlyExit)\n#if (FXAA_DISCARD == 1)\nFxaaDiscard;\n#else\nreturn rgbyM;\n#endif\n#if (FXAA_GATHER4_ALPHA == 0)\n#if (FXAA_GLSL_100 == 1)\nFxaaFloat lumaNW=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(-1.0,-1.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaSE=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(1.0,1.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaNE=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(1.0,-1.0),fxaaQualityRcpFrame.xy));FxaaFloat lumaSW=FxaaLuma(FxaaTexOff(tex,posM,FxaaFloat2(-1.0,1.0),fxaaQualityRcpFrame.xy));\n#else\nFxaaFloat lumaNW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaNE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,1),fxaaQualityRcpFrame.xy));\n#endif\n#else\nFxaaFloat lumaNE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,1),fxaaQualityRcpFrame.xy));\n#endif\nFxaaFloat lumaNS=lumaN+lumaS;FxaaFloat lumaWE=lumaW+lumaE;FxaaFloat subpixRcpRange=1.0/range;FxaaFloat subpixNSWE=lumaNS+lumaWE;FxaaFloat edgeHorz1=(-2.0*lumaM)+lumaNS;FxaaFloat edgeVert1=(-2.0*lumaM)+lumaWE;FxaaFloat lumaNESE=lumaNE+lumaSE;FxaaFloat lumaNWNE=lumaNW+lumaNE;FxaaFloat edgeHorz2=(-2.0*lumaE)+lumaNESE;FxaaFloat edgeVert2=(-2.0*lumaN)+lumaNWNE;FxaaFloat lumaNWSW=lumaNW+lumaSW;FxaaFloat lumaSWSE=lumaSW+lumaSE;FxaaFloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);FxaaFloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);FxaaFloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;FxaaFloat edgeVert3=(-2.0*lumaS)+lumaSWSE;FxaaFloat edgeHorz=abs(edgeHorz3)+edgeHorz4;FxaaFloat edgeVert=abs(edgeVert3)+edgeVert4;FxaaFloat subpixNWSWNESE=lumaNWSW+lumaNESE;FxaaFloat lengthSign=fxaaQualityRcpFrame.x;FxaaBool horzSpan=edgeHorz>=edgeVert;FxaaFloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;if(!horzSpan)lumaN=lumaW;if(!horzSpan)lumaS=lumaE;if(horzSpan)lengthSign=fxaaQualityRcpFrame.y;FxaaFloat subpixB=(subpixA*(1.0/12.0))-lumaM;FxaaFloat gradientN=lumaN-lumaM;FxaaFloat gradientS=lumaS-lumaM;FxaaFloat lumaNN=lumaN+lumaM;FxaaFloat lumaSS=lumaS+lumaM;FxaaBool pairN=abs(gradientN)>=abs(gradientS);FxaaFloat gradient=max(abs(gradientN),abs(gradientS));if(pairN)lengthSign=-lengthSign;FxaaFloat subpixC=FxaaSat(abs(subpixB)*subpixRcpRange);FxaaFloat2 posB;posB.x=posM.x;posB.y=posM.y;FxaaFloat2 offNP;offNP.x=(!horzSpan)? 0.0 : fxaaQualityRcpFrame.x;offNP.y=(horzSpan)? 0.0 : fxaaQualityRcpFrame.y;if(!horzSpan)posB.x+=lengthSign*0.5;if(horzSpan)posB.y+=lengthSign*0.5;FxaaFloat2 posN;posN.x=posB.x-offNP.x*FXAA_QUALITY_P0;posN.y=posB.y-offNP.y*FXAA_QUALITY_P0;FxaaFloat2 posP;posP.x=posB.x+offNP.x*FXAA_QUALITY_P0;posP.y=posB.y+offNP.y*FXAA_QUALITY_P0;FxaaFloat subpixD=((-2.0)*subpixC)+3.0;FxaaFloat lumaEndN=FxaaLuma(FxaaTexTop(tex,posN));FxaaFloat subpixE=subpixC*subpixC;FxaaFloat lumaEndP=FxaaLuma(FxaaTexTop(tex,posP));if(!pairN)lumaNN=lumaSS;FxaaFloat gradientScaled=gradient*1.0/4.0;FxaaFloat lumaMM=lumaM-lumaNN*0.5;FxaaFloat subpixF=subpixD*subpixE;FxaaBool lumaMLTZero=lumaMM<0.0;lumaEndN-=lumaNN*0.5;lumaEndP-=lumaNN*0.5;FxaaBool doneN=abs(lumaEndN)>=gradientScaled;FxaaBool doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P1;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P1;FxaaBool doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P1;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P1;if(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P2;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P2;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P2;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P2;\n#if (FXAA_QUALITY_PS > 3)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P3;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P3;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P3;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P3;\n#if (FXAA_QUALITY_PS > 4)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P4;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P4;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P4;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P4;\n#if (FXAA_QUALITY_PS > 5)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P5;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P5;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P5;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P5;\n#if (FXAA_QUALITY_PS > 6)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P6;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P6;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P6;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P6;\n#if (FXAA_QUALITY_PS > 7)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P7;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P7;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P7;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P7;\n#if (FXAA_QUALITY_PS > 8)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P8;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P8;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P8;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P8;\n#if (FXAA_QUALITY_PS > 9)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P9;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P9;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P9;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P9;\n#if (FXAA_QUALITY_PS > 10)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P10;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P10;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P10;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P10;\n#if (FXAA_QUALITY_PS > 11)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P11;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P11;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P11;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P11;\n#if (FXAA_QUALITY_PS > 12)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P12;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P12;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P12;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P12;}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}FxaaFloat dstN=posM.x-posN.x;FxaaFloat dstP=posP.x-posM.x;if(!horzSpan)dstN=posM.y-posN.y;if(!horzSpan)dstP=posP.y-posM.y;FxaaBool goodSpanN=(lumaEndN<0.0)!=lumaMLTZero;FxaaFloat spanLength=(dstP+dstN);FxaaBool goodSpanP=(lumaEndP<0.0)!=lumaMLTZero;FxaaFloat spanLengthRcp=1.0/spanLength;FxaaBool directionN=dstN<dstP;FxaaFloat dst=min(dstN,dstP);FxaaBool goodSpan=directionN ? goodSpanN : goodSpanP;FxaaFloat subpixG=subpixF*subpixF;FxaaFloat pixelOffset=(dst*(-spanLengthRcp))+0.5;FxaaFloat subpixH=subpixG*fxaaQualitySubpix;FxaaFloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;FxaaFloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);if(!horzSpan)posM.x+=pixelOffsetSubpix*lengthSign;if(horzSpan)posM.y+=pixelOffsetSubpix*lengthSign;\n#if (FXAA_DISCARD == 1)\nreturn FxaaTexTop(tex,posM);\n#else\nreturn FxaaFloat4(FxaaTexTop(tex,posM).xyz,lumaM);\n#endif\n}\n#endif\nvoid main(){out_color=FxaaPixelShader(vCoord,vec4(0.0),inputBuffer,inputBuffer,inputBuffer,resolution,vec4(0.0),vec4(0.0),vec4(0.0),0.75,0.166,0.0833,0.0,0.0,0.0,vec4(0.0));out_color.a=texture(inputBuffer,vCoord).a;}"},tx={source:"vec4 LGL_Az(sampler2D map,vec2 uv){\n#ifdef OES_texture_float_linear\nreturn texture(map,uv);\n#else\nvec2 size=vec2(textureSize(map,0));vec2 texelSize=1.0/size;uv=uv*size-0.5;vec2 f=fract(uv);uv=floor(uv)+0.5;vec4 s1=texture(map,(uv+vec2(0,0))*texelSize);vec4 s2=texture(map,(uv+vec2(1,0))*texelSize);vec4 s3=texture(map,(uv+vec2(0,1))*texelSize);vec4 s4=texture(map,(uv+vec2(1,1))*texelSize);return mix(mix(s1,s2,f.x),mix(s3,s4,f.x),f.y);\n#endif\n}layout(location=0)out vec4 out_light;layout(location=1)out vec4 out_momentLengthVariance;in vec2 vCoord;uniform mediump sampler2D lightTex;uniform mediump sampler2D positionTex;uniform mediump sampler2D colorTex;uniform mediump sampler2D previousLightTex;uniform mediump sampler2D previousPositionTex;uniform mediump sampler2D previousColorTex;uniform mediump sampler2D previousMomentLengthVarianceTex;uniform mat4 historyCamera;uniform float colorBlendFactor;uniform float momentBlendFactor;uniform float demodulateAlbedo;vec2 LGL_BE(vec3 position){vec4 historyCoord=historyCamera*vec4(position,1.0);return 0.5*historyCoord.xy/historyCoord.w+0.5;}float LGL_BF(sampler2D meshIdTex,vec2 vCoord){return floor(texture(meshIdTex,vCoord).w);}float LGL_BG(float histMeshId,float currentMeshId,ivec2 coord,ivec2 size){if(histMeshId!=currentMeshId){return 0.0;}if(any(greaterThanEqual(coord,size))){return 0.0;}return 1.0;}void main(){vec3 currentPosition=LGL_Az(positionTex,vCoord).xyz;float currentMeshId=LGL_BF(positionTex,vCoord);vec4 accumulatedLight=texture(lightTex,vCoord);vec3 currentLight=accumulatedLight.rgb/accumulatedLight.a;vec2 hCoord=LGL_BE(currentPosition);vec2 hSizef=vec2(textureSize(previousLightTex,0));vec2 hSizeInv=1.0/hSizef;ivec2 hSize=ivec2(hSizef);vec2 hTexelf=hCoord*hSizef-0.5;ivec2 hTexel=ivec2(hTexelf);vec2 f=fract(hTexelf);ivec2 texel[]=ivec2[](hTexel+ivec2(0,0),hTexel+ivec2(1,0),hTexel+ivec2(0,1),hTexel+ivec2(1,1));float weights[]=float[]((1.0-f.x)*(1.0-f.y),f.x*(1.0-f.y),(1.0-f.x)*f.y,f.x*f.y);vec4 historyLight=vec4(0.);;vec2 historyMoment=vec2(0.);float historyLength=0.;float sum=0.;float LGL_Ag=0.2126*currentLight.x+0.7152*currentLight.y+0.0722*currentLight.z;float N=texelFetch(previousMomentLengthVarianceTex,hTexel,0).b;if(N>0.0&&currentMeshId>0.0){for(int i=0;i<4;i++){vec2 gCoord=(vec2(texel[i])+0.5)*hSizeInv;float histMeshId=LGL_BF(previousPositionTex,gCoord);float isValid=LGL_BG(histMeshId,currentMeshId,texel[i],hSize);float weight=isValid*weights[i];historyLight+=weight*texelFetch(previousLightTex,texel[i],0);historyMoment+=weight*texelFetch(previousMomentLengthVarianceTex,texel[i],0).rg;sum+=weight;}if(sum>0.0){historyLight/=sum;historyMoment/=sum;}else{hTexel=ivec2(hTexelf+0.5);for(int x=-1;x<=1;x++){for(int y=-1;y<=1;y++){ivec2 texel=hTexel+ivec2(x,y);vec2 gCoord=(vec2(texel)+0.5)*hSizeInv;float histMeshId=LGL_BF(previousPositionTex,gCoord);float isValid=LGL_BG(histMeshId,currentMeshId,texel,hSize);float weight=isValid;historyLight+=weight*texelFetch(previousLightTex,texel,0);historyMoment+=weight*texelFetch(previousMomentLengthVarianceTex,texel,0).rg;sum+=weight;}}historyLight=sum>0.0 ? historyLight/sum : historyLight;historyMoment=sum>0.0 ? historyMoment/sum : historyMoment;}if(sum>0.0){historyLength=N+1.;float color_alpha_min=colorBlendFactor;float moment_alpha_min=momentBlendFactor;float color_alpha=max(1.0/historyLength,color_alpha_min);float moment_alpha=max(1.0/historyLength,moment_alpha_min);out_light=color_alpha*accumulatedLight+historyLight*(1.-color_alpha);float first_moment=moment_alpha*historyMoment.x+(1.0-moment_alpha)*LGL_Ag;float second_moment=moment_alpha*historyMoment.y+(1.0-moment_alpha)*LGL_Ag*LGL_Ag;float variance=second_moment-first_moment*first_moment;out_momentLengthVariance=vec4(first_moment,second_moment,historyLength,variance);return;}}out_light=accumulatedLight;out_momentLengthVariance=vec4(LGL_Ag,LGL_Ag*LGL_Ag,1.,100.);}"},nx={source:"layout(location=0)out vec4 out_color;in vec2 vCoord;uniform sampler2D lightTex;uniform sampler2D LGL_BEDataTex;uniform sampler2D gPosition;uniform sampler2D gNormal;uniform sampler2D gColor;uniform float colorFactor;uniform float normalFactor;uniform float positionFactor;uniform float stepwidth;uniform int level;uniform float useMomentVariance;uniform float demodulateAlbedo;float LGL_BB(float v){return acos(min(max(v,0.0),1.0));}float LGL_BC(vec2 uv){return max(texture(LGL_BEDataTex,uv).a,0.);}vec4 LGL_BD(){vec4 upscaledLight=texture(lightTex,vCoord);float sampleFrame=upscaledLight.a;float sf2=sampleFrame*sampleFrame;vec3 color=upscaledLight.rgb/upscaledLight.a;vec3 normal=texture(gNormal,vCoord).rgb;vec4 positionAndMeshIndex=texture(gPosition,vCoord);vec3 position=positionAndMeshIndex.rgb;float meshIndex=positionAndMeshIndex.w;bool isBG=meshIndex>0.0 ? false : true;if(isBG){return upscaledLight;}vec2 size=vec2(textureSize(lightTex,0));int kernelRadius=9;float dx=1./size.x;float dy=1./size.y;float kernel[9]=float[9](1.0/16.0,1.0/8.0,1.0/16.0,1.0/8.0,1.0/4.0,1.0/8.0,1.0/16.0,1.0/8.0,1.0/16.0);vec2 offset[9]=vec2[9](vec2(-dx,-dy),vec2(0,-dy),vec2(dx,-dy),vec2(-dx,0),vec2(0,0),vec2(dx,0),vec2(-dx,dy),vec2(0,dy),vec2(dx,dy));vec3 colorSum=vec3(0.);float weightSum=0.;float var;float varSum;float varSumWeight;if(useMomentVariance>0.){for(int i=0;i<kernelRadius;i++){vec2 uv=vCoord+offset[i];if(uv.x<0.0||uv.x>1.0||uv.y<0.0||uv.y>1.0){continue;}vec4 positionAndMeshIndex=texture(gPosition,uv);float meshIndex=positionAndMeshIndex.w;bool isBG=meshIndex>0.0 ? false : true;if(isBG){continue;}varSum+=kernel[i]*LGL_BC(uv);varSumWeight+=kernel[i];}if(varSumWeight>0.0){var=max(varSum/varSumWeight,0.0);}else{var=max(LGL_BC(vCoord),0.0);}}for(int i=0;i<kernelRadius;i++){vec2 uv=vCoord+offset[i]*float(stepwidth);if(uv.x<0.0||uv.x>1.0||uv.y<0.0||uv.y>1.0){continue;}vec4 positionAndMeshIndex=texture(gPosition,uv);float meshIndex=positionAndMeshIndex.w;bool isBG=meshIndex>0.0 ? false : true;if(isBG){continue;}vec4 upscaledLight=texture(lightTex,uv);vec3 kernelColor=upscaledLight.rgb/upscaledLight.a;float Dc=distance(color,kernelColor);float Wc;if(useMomentVariance>0.){Wc=min(exp(-Dc/((1.+sqrt(var))*colorFactor+1e-6)),1.0);}else{Wc=min(exp(-Dc/(colorFactor+1e-6)),1.0);}vec3 kernelNormal=texture(gNormal,uv).rgb;float Dn=distance(normal,kernelNormal);float dist2=max(Dn/(stepwidth*stepwidth+1e-6),0.0);float Wn=min(exp(-(dist2)/normalFactor+1e-6),1.0);vec3 kernelPosition=positionAndMeshIndex.rgb;float Dp=distance(position,kernelPosition);float Wp=min(exp(-Dp/(positionFactor+1e-6)),1.0);float weight=Wc*Wn*Wp*kernel[i];weightSum+=weight;colorSum+=kernelColor*weight;}colorSum=colorSum/weightSum;return vec4(colorSum*sampleFrame,sampleFrame);}void main(){vec4 light=LGL_BD();out_color=light;}"};async function rx({gl:e,optionalExtensions:t,scene:n,camera:r,toneMapping:i,bounces:a,envMapIntensity:o,useBackgroundColor:s,backgroundColor:c,enviromentVisible:u,movingDownsampling:d,enableDenoise:f,enableTemporalDenoise:p,enableSpatialDenoise:h,useWorker:v,loadingCallback:g}){const x=new y,b=function(e){let t,n,r,i,a=new l(1,1),o=function(e){const t=e.getParameter(e.MAX_RENDERBUFFER_SIZE);return t<=8192?8e4:16384===t?15e4:t>=32768?4e5:void 0}(e);function s(){const e=t/n;r=Math.round(Kv(Math.sqrt(o*e),1,t)),i=Math.round(Kv(r/e,1,n)),a.set(r/t,i/n)}return{adjustSize:function(e){e&&(o+=600*(20-e),o=Kv(o,8192,t*n),s())},setSize:function(e,r){t=e,n=r,s()},scale:a,get width(){return r},get height(){return i}}}(e),_=function(e){let t,n,r,i,a,o=-1,s=1,l=!1,c=0,u=0,d=function(e){const t=e.getParameter(e.MAX_RENDERBUFFER_SIZE);return t<=8192?2e5:16384===t?4e5:t>=32768?6e5:void 0}(e);function f(){const e=c/u;l?(t=Math.ceil(c/Math.sqrt(s)),n=Math.ceil(t/e),r=Math.ceil(c/t),i=Math.ceil(u/n),s=r*i):(t=Math.ceil(c/Math.round(c/Math.sqrt(d*e))),n=Math.ceil(t/e),r=Math.ceil(c/t),i=Math.ceil(u/n),s=r*i)}function p(){o=-1,a=NaN}return{nextTile:function(e){o++,a+=e,o%s==0&&(a&&(function(){const e=21-a/s;d+=5e3*Math.sign(e)*Math.sqrt(Math.abs(e)),d=Kv(d,8192,c*u)}(),f()),a=0,o=0);const l=o===s-1,p=o%r,h=Math.floor(o/r)%i;return{x:p*t,y:h*n,tileWidth:t,tileHeight:n,isFirstTile:0===o,isLastTile:l}},reset:p,setSize:function(e,t){c=e,u=t,p(),f()},setTileSlicesNumber:function(e){e?(l=!0,s=e):l=!1}}}(e),L=hg(n,r),S=function(e,t){let n=0,r=0;const i=[];for(const o of e){if(!o.visible)continue;const e=o.geometry.isBufferGeometry?mg(o.geometry,["position","normal","uv"]):(new R).fromGeometry(o.geometry);e.getIndex()||vg(e),e.applyMatrix4?e.applyMatrix4(o.matrixWorld):e.applyMatrix(o.matrixWorld),e.getAttribute("normal")?e.normalizeNormals():e.computeVertexNormals(),n+=e.getAttribute("position").count,r+=e.getIndex().count;const a=o.material;let s=t.get(a);i.push({geometry:e,materialIndex:s})}let a=function(e,t,n){const r=new P(new Float32Array(3*t),3,!1),i=new P(new Float32Array(3*t),3,!1),a=new P(new Float32Array(2*t),2,!1),o=new P(new Int32Array(2*t),2,!1),s=new P(new Uint32Array(n),1,!1),l=new R;"function"!=typeof l.setAttribute&&(l.setAttribute=l.addAttribute),l.setAttribute("position",r),l.setAttribute("normal",i),l.setAttribute("uv",a),l.setAttribute("materialMeshIndex",o),l.setIndex(s);let c=0,u=0,d=1;for(const{geometry:f,materialIndex:p}of e){const e=f.getAttribute("position").count;["position","normal","uv"].forEach((e=>{const t=f.getAttribute(e);t&&l.getAttribute(e).array.set(t.array,c*t.itemSize)}));const t=f.getIndex();for(let n=0;n<t.count;n++)s.setX(u+n,c+t.getX(n));for(let n=0;n<e;n++)o.setXY(c+n,p,d);c+=e,u+=t.count,d++}return l}(i,n,r);return{geometry:a}}(L.meshes,L.materialIndexMap),w=Lg(e,L.materials),M=function(e){const t=e.createVertexArray();return e.bindVertexArray(t),e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.bindVertexArray(null),{draw:function(){e.bindVertexArray(t),e.drawArrays(e.TRIANGLES,0,6)},vertexShader:lg(e,{vertex:ng})}}(e),A=function(e,{materialBuffer:t,mergedMesh:n}){const r=cg(e,{defines:t.defines,vertex:Zg,fragment:Qg});r.setTexture("diffuseMap",t.textures.diffuseMap),r.setTexture("normalMap",t.textures.normalMap);const i=n.geometry,a=i.getIndex().count,o=e.createVertexArray();var s,l,c;e.bindVertexArray(o),c=i,Kg(s=e,(l=r).attribLocs.aPosition,c.getAttribute("position")),Kg(s,l.attribLocs.aNormal,c.getAttribute("normal")),Kg(s,l.attribLocs.aUv,c.getAttribute("uv")),Kg(s,l.attribLocs.aMaterialMeshIndex,c.getAttribute("materialMeshIndex")),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,s.createBuffer()),s.bufferData(s.ELEMENT_ARRAY_BUFFER,c.getIndex().array,s.STATIC_DRAW),e.bindVertexArray(null);let u,d=0,f=0,p=new m;return{draw:function(){p.copy(u.projectionMatrix),p.elements[8]+=2*d,p.elements[9]+=2*f,p.multiply(u.matrixWorldInverse),r.setUniform("projView",p.elements),e.bindVertexArray(o),r.useProgram(),e.enable(e.DEPTH_TEST),e.drawElements(e.TRIANGLES,a,e.UNSIGNED_INT,0),e.disable(e.DEPTH_TEST)},outputLocs:r.outputLocs,setCamera:function(e){u=e},setJitter:function(e,t){d=e,f=t},dispose:function(){r.dispose()}}}(e,{materialBuffer:w,mergedMesh:S}),T=function(e,t){const{fullscreenQuad:n,toneMapping:r}=t;let i;const a={gl:e,vertex:n.vertexShader,fragment:qg},o=cg(e,a);o.setUniform("toneMappingFun",Jg[r]);const s=new l(1,1);return{draw:function(t,r){let{light:a,lightScale:l}=t;if(l=l||s,o.setTexture("lightTex",a),o.setUniform("lightScale",l.x,l.y),r)return i.bind(),e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),o.useProgram(),n.draw(),i.unbind(),i;o.useProgram(),n.draw()},setToneMapping:function(e){o.setUniform("toneMappingFun",Jg[e])},setSize:function(t,n){i=tg(e,{color:{0:ug(e,{width:t,height:n,storage:"byte",magFilter:e.LINEAR,minFilter:e.LINEAR})}})},dispose:function(){o.dispose()}}}(e,{fullscreenQuad:M,toneMapping:i}),E=function(e,t){const{fullscreenQuad:n}=t,r=cg(e,{gl:e,vertex:n.vertexShader,fragment:ex});return{draw:function(e){let{light:t}=e;r.setTexture("inputBuffer",t),r.useProgram(),n.draw()},setSize:function(e,t){r.setUniform("resolution",1/e,1/t)},dispose:function(){r.dispose()}}}(e,{fullscreenQuad:M}),C=function(e,t){const{fullscreenQuad:n,maxReprojectedSamples:r}=t,i=cg(e,{defines:{MAX_SAMPLES:r.toFixed(1)},vertex:n.vertexShader,fragment:tx}),a=new m;let o=.2,s=.2;return{draw:function(e){const{light:t,position:r,color:a,previousColor:l,previousLight:c,previousPosition:u,previousMomentLengthVariance:d}=e;i.setTexture("lightTex",t),i.setTexture("positionTex",r),i.setTexture("colorTex",a),i.setTexture("previousLightTex",c),i.setTexture("previousPositionTex",u),i.setTexture("previousColorTex",l),i.setTexture("previousMomentLengthVarianceTex",d),i.setUniform("colorBlendFactor",o),i.setUniform("momentBlendFactor",s),i.useProgram(),n.draw()},setJitter:function(e,t){i.setUniform("jitter",e,t)},setPreviousCamera:function(e){a.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),i.setUniform("historyCamera",a.elements)},setDenoiseColorBlendFactor:function(e){o=e},setDenoiseMomentBlendFactor:function(e){s=e},setDemodulateAlbedo:function(e){i.setUniform("demodulateAlbedo",e)},getDenoiseFactors:()=>({colorBlendFactor:o,momentBlendFactor:s}),dispose:function(){i.dispose()}}}(e,{fullscreenQuad:M,maxReprojectedSamples:20}),F=function(e,t){const{fullscreenQuad:n}=t;let r,i;function a(){let e=i;i=r,r=e}const o={gl:e,vertex:n.vertexShader,fragment:nx},s=cg(e,o);let l=.5,c=.02,u=.35;return{draw:function(t){let{light:o,reprojectData:d}=t;for(let f=0;f<3;f++)s.setUniform("level",f),s.setUniform("colorFactor",1/(1<<f)*l),s.setUniform("normalFactor",1/(1<<f)*c),s.setUniform("positionFactor",1/(1<<f)*u),s.setUniform("stepwidth",(1<<f+1)-1),0===f?s.setTexture("lightTex",o):s.setTexture("lightTex",r.color[0]),d?(s.setUniform("useMomentVariance",1),s.setTexture("reprojectDataTex",d)):(s.setUniform("useMomentVariance",0),s.setTexture("reprojectDataTex",null)),i.bind(),e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),s.useProgram(),n.draw(),i.unbind(),a();return r},setGBuffers:function({position:e,normal:t,color:n}){s.setTexture("gPosition",e),s.setTexture("gNormal",t),s.setTexture("gColor",n)},setColorFactor:function(e){l=e},setNormalFactor:function(e){c=e},setPositionFactor:function(e){u=e},setDemodulateAlbedo:function(e){s.setUniform("demodulateAlbedo",e)},getDenoiseFactors:()=>({colorFactor:l,normalFactor:c,positionFactor:u}),setSize:function(t,n){!function(t,n){const a=()=>tg(e,{color:{0:ug(e,{width:t,height:n,storage:"float",magFilter:e.NEAREST,minFilter:e.NEAREST})}});r=a(),i=a()}(t,n)},dispose:function(){s.dispose()}}}(e,{fullscreenQuad:M,toneMapping:i});let I,N,U=!1,z=0,G=!0,B=!1,D=()=>{};const k=await $g(e,{bounces:a,decomposedScene:L,fullscreenQuad:M,materialBuffer:w,mergedMesh:S,optionalExtensions:t,scene:n,envMapIntensity:o,useBackgroundColor:s,backgroundColor:c,enviromentVisible:u,useWorker:v,loadingCallback:g}),O=new Image;let j,V,H,X,W,Y;O.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAEAAAAADfkvJBAAAbsklEQVR4nA3UhQIIvBoA0E830810M91MN9PNdDPd/ulmupluppvpZrqZbqabe89DHCiDv5GzaossZGYBp2PFIFqKdmMXIKW85edCB/RT11SD3JMQidRlL7n2ufRH1jVkFUNVc3NaZ7DP0T7/112kM1Qc3RDG0K/4uN7CPC7OmtFRZK3Jy3fhSSySKIZXopTsnIhN69JjLHJYYnfpZu44hnV+UkhG/lPd/D+fIVwWtdhhupVPJmtsLFIhjHA7UUqY4fPIQ2qdKxviqH2sugJ2nC+1ZdV0vEF3RGNcMd4KdvIXaJnujdPrKj4ifkeX2f04avjEbqO0ogI/rD7zhmy6GKG/2w32IetIX5vE9DbrS+CNy4sbmgXoiaug48lV4bVKZgluwPujd+Ioa+KjuntypepEEvl/YYCYTq6w4aaReGMShwLkC4nvq7jFKJmLpoepHJTag/h2aMklShou+tyip5wm67P2/CnvH7K6zuq+KGvy2rkkrR4mc4dpUNTEFHDId9TXQiST3RxHO0lHNgNFIA/Ub1kC0pOlNBf77EtyZ0ejxvikzySL8C8hNWyyc1GvcBCusv/otvBO3YSj+KvvRlKgoNaF/GEB64prsx8qFRwVJcRmMk8l5E5swfHMPuhlr9DmtrLeqs7KOrCMQSpeGW/zH5F2dc0AXZhcp9IthLZyuxpHrkNnp0JfnsY+55XkAtgSOvsWzps8uoJ5GtpAXRWZ5TK9cEM1WVRWC81ZUstPZHHkC7GDjZfl7BJ+VcXkI8RfVIMW0Jq95oxE0R+MDQnMX97DPhYjEXzHM0LvUNyODhdDCvJdNmXlfFp0RsbBNclTj8hpXofsCgVYsAnwPRTNTiTLxZkQW43BmK6wHk7Y0iSdXIfyK8/aQULdx1/hJc0JkRE/UgNDc/dGZWanTCs2WQ0W6Xh7PZGuDMXEaLtIRMZcZAM4ieOwO661Qf4xVyhLOOA2mLe0JyvIDrBhUA42ioUiMmrHJ9te6jwtbQ6xWrKf/ED3qKJ0qvzO2of57KkcyMBvNZndbLTX/iWNaWTezm9E8cleKOSEXK1B3LDfeGk4yx/b7L5+uAvp6UVC/UYAhvPLvSwTWm+qqO5saYjh79LadBJaAR90ct9S/GGZ7Q1zhKyTOUJ9MzT85IldVjLLduUOqovEaASJbXeZ37oFv0w/sOGhvMzpVrL/2MeQx8+ldfQU/QBXIqn8NtHAHjCzaTJk+CDS0e6Wk8N7GEDgoR4rG5M/Zig/LD6hEr6VHmxzmijoKu/oZ+p84oEeiwegquE7pBZPYXEoyLeQ66wRicLXmOzWoib6mq6KUoWxuriq62OQh647TUmn0RuuIjtPfuEkcMQtwJ/IaJabRRe9fRX2Q8Z1L2UNlMclpfMFdKYr+XkVEeb6vChZuOBfhNl+l/hly9L0/mzYIxPhBq4oimlnB273mkgwnr+S7Vnp8Fff8/3VC7IJCtqZ9AxZRnujo3wjmQ9n7WtayxwgvUhUNtJ0UjlEU9vPFhePxDLfkl6z43hhdQSW+xbyKooJEEwqTOkL1VHWc1vReFaVxbcnTGM2Uq1XNXRPos0bdtI8VBKXcZdCV1dNpLcL3DE7Cqfmi2w5JGhGFqATTUhzy7sG2+a0II4ZtupikC488mt9abdTvpYXVALXBU6wNzYLXUTPQwTxH/nNttjKDA7pQT47mopOQmxzW/f3GVhXWoguEUl5EHcUoKm8LdpiMoZV9JONpzZa7wa7hG4XzxvquHj2s5lsIrFbtrbew3+SKbiK6Ry+whAyXrTBC0kgDfwZHNOMNRnwOjHVVICdOGVo6LuFsn6GTKN6u4IeZqtN7B6vzlegD7ioW8i/u430kbtO2pABrgTPwb+xchSZ7jK/V6KxPEWK+K+oBXFmeuikt+HzrIU66KQsI9bRaGqQfKqSkMNumbnN4/ljkFsPxqnDElSF32L17D8UhxbUI8xnuwk/0znwXXcGGmD4QpPo5n6kTod70Zb2oI8Y6pFJKiuLoab7bXBEj+CXFTOH4A4kV/1JNjNRLrexaEX5Ht0xQ1RRskzmhCd+rmnFi9hLeqHe7svy7Lq+/+Mq6am+A/X8e+iptvqcbIjzqCOfbW6SpKQ22gPt8HgTFUMPd9kWgKd2O45Pr0EuOlK8waXFfriga7sXrLlKZZbrgeaPnmsrurd+n2H8hugjc+i1OCpJj2vYPyQ27+lT6/f4JM0c6sJIHwm/8AJS4tXuuo6g9qOCjvOZIrI9ZpaaauQAjwb9eTG0RMYPr2y5AHv8YhZLHvZl+DdQqrI5Z1L4QawT/FOLoQCOLR+EyTIrjcqb6YtiA4mg0/L27reYYg7JpvSVOM7G+p2uIb1iJ0hE+/DvvLW+qqfL034nLU5GQh02j8aHi/aDLS2b4ncYk/OcE+V+hhNqmF2rs1j4a1qziXYgaaDWQRetSbOwC60J8VhFSIf62k2osy7FXqpdrDAdZbuQxf5ZOCGLy6Reago9xBydmN9HBdUqX9VtUYdIKZOGbGAFxEDXjLxDmeVXsd5WIOmlhN0kqe2r84o1upy+z9KLRjY/ui5qGkhNiqoL5iXN6hPbeyGa+ckKwRM6l51Ao+EG/yKruXNsrWvHkuDPKKctS4bYRnq7eIQX+at4s8lD2ovy+D/xlXUWuf2jsNiNQx9xDRwjLAgJUSd5AvfTD80U0Qk91fP8DTkBfaXx1Qhv7FMXifZRMw0MlxtxVFVNzoOTrnjoK9ObCZy5HOwjbWgTib1kFo3BJa9t7oojdJK5RpGcifO66LQ2xuIHBvxcnMcLdEoUWc0QjVhs0k3f4dnoXvREODRB5KWJ2UFTX60WcXERxFQ7uo9mDz1YVbzQddDBHQ3QxD0MPfBnsdX+p9+xg+Sybmtum4hKoJW+CG0NGSQxP/TC0AulZ1tozfATr9Ld/QfURp1kg2FqaOQ2QBZ9JNyCoeQfO0eS+SOCa0lLshW6hnulWqHi/qrMTj6Z03gzB/LMzuaXmZXJSUm7nSKACjQDVzafbiNTqUayYpjDNpqhqIzf4SfRU/KF6S+vo0MhAS/v36BoolU4JbKQO3S3nmAL88puH0GoN6tF3vg2rCzscLVcUbmKzHS/dFroBdGk8bP4Hx8DRotKtJdMa4YZKhvR2OgbnULv+lzYUfjhFusD6KaLR8aHFSSPjYmT2MP6tU1L76u4uqJYrqawEqqpW+Onm4G6KIw2CU0Z29/EIc9gKVwjH3wxNV5v8fmxVunIGB94PxYBV+I3RRM4IO8x7Ab6ZXi3aoEeoUXmtzqHVrGCsrUYpOvIFXSMgX4YQp1Qmp6xf/Ae8gR1U19NUzEdSOjApK9nPuoItqt5HE7TXPIm3sff2fm+SbioN9GcPLltyTLKeeGBjGr668sYsfuymdjM8uHjYqL5BLn4SFqRdjbnZJKgyFHIA51lEjEebtEMfqN7LlORlgreiM3B26G2g82iqssbZBQq6k+rGn5J+MMvsVRus95vMpFR9K9K4errLmJFSMO/iepoBu6CfptR4QzqxpOYH6ERP4xmqS4uKzz3V2RS0SnMNwnYKvdW5Bd16FdS0kWlDeQ2VIMEJtgeVJ7GZIdDYQldWQ6UVK2mM1l000/MRyn5GpGZDkRbQ1RUCs/HLcMDV4hV1/OkEZFpRX+f5zfSHGQR7W2obdeiMnK3qQarTK7wEiq5vTqWXayqhyF4By5l6+HDPKK4AZtVRnoHjVBv8Syd1VocyY2UP9g8c15PpXBNVIET8MnVd8/oNlaGcnZJBZoQ7uAe4SjJAWNdX3AkNrQTQ+ClmMxO23i4nXseStC+4agkPDYeChdcOzLRJ2f/2S+ukJqsW/tvKoN4bP5/sOpHxuN5qC3p5VbaizIefWBKkKWkCc+DO5paPAHAP7wQj+VFRVp/zhPy3Ufw+8I4VsE1QVPtS1ZLf6eJ5Qr3Se3GxfURld71EhvEHJXVbLdJzUL/2nk6nX1mGcxdXUpvIg2gt7rADrkoYq0ogKbYXyK1pOwljuEO0rykAh5k2pMp6hR7rVO7h3IY2Y6gOYpsBqhWfp/sQcbbZa6m7uge0dx8pUgjd9GY5CyUldNEXX3L5JRLaHP2G5UhDtfnn8Qk3sak8Y1dUR5BatyTnyTR2PWwnCVCZe09NdwLG8tpvl3nJCd8dfzPNFMp1Wb4YuuihKIPWkP2k5I0o4OVJB96wDby2Oy2TAwv9VAxh8dFJ9EvU1S390Pdekx8d0jrxgik35GaLDoeZR7ZhH4IqyzO+/WiNzkkGNrOm8MvN4dmom9kbtuCzgy14K097SrhJuoeDEMJ7CI5Tjwn+3AmfjkUQpXUTR+DzdDPKVRgh23w1c0MUoI1EYchky6st4hefmS4bhZhr5vJ9/QYfUpbywukv9iib4S8msMqOE6iqH86px6L3oubJike6fJBB1ODDTZb6V+fAvapLL6DTGQ+2hm2k1svL8litoeKxZaRIXq2/U3HsDb6ghQBJqP4OB29iP4Lv/FaVZlctV9QM5tC1UGRbCWRBSfQs/UOFAGtlhX8VJJMLTD7VQY6HRU23ehdXAYlJHN5FlkRvXQHdDzx2I8Lx1A3sxTd8MXdOjVKH4BCOp2pIx6zrHwar6qO6uYB3FaXXdYNycNXCUNlY9TFLwq5SFuemg60UdhieVa8hml4v/2sHOsDNV1JGM5zmx/U2qKhk/lq+7jXaCuuYxaTPba1OuMHhY16GiuJVonzKBUtjEDVtwPxJP+cXUaRfD/1w5zS0Ulr9DXcQPnIK39Xdgkn+WJahGzGkI1cda/xFhfNn6KP1R7c2Y4JZSBnWK26kkJhs51E/tGk8m5oInvSjOI5risjuorqlI8X0oZh+JmKQeuhn7KLjKmvmd6iCVnIKtMH5KOM6zGu5nP5hmixMLo8Ge0P6jWyD0ukR7F0lqIPEMc/gv0OIsqZvCSug8eZ964gnYXr+LsqPmojHrG0apiIzg6TtkyHc7BHIDzTXuL/yQ38Dhsnm5OPfCorYK/LFTKPOU4xr+m/6WzydVCmPWwM5+UuN9e1Ce/8TRbfdJVzbCrWQJTUO+R8V5Ouh6m6T2jpqllYDfew5Ylcb1teraRxUFb8xxp6zFWH+eqtbIhzomc+DRunqvv3doVoKfOEJGoRKilzmAt4B69k+0FyN0m2ED5ss6NkNLTbn1LDAmHU/QDBj5oU8j9cxLxi2dUd+z5E8RfNT9NUHvApzRU/Bv1R0MEPlER9Nzuhpb/lhmsLxUJfP8EkYWdUCbyW3QzlbTco4AfhKEDNUfeY7pLt8U/a063mUaGD+4wtofwtmo0L2WWqlSxHErH0aDltYsbwqHqNq2CnuJ3qdKjJh/hlYYrsKLKwwTy2eOnzyrIMB1A0rmhiNc3Iz9tkvJt44ZqhJQ70F+jhW8CIgNQuO49/Q8bcJ5NxWlaVj6Yx/VVIZWeY2uK+zuw3hSEhIu2hE5NLfiC9p//I7vq6i6+fioJwF2Uyf2lzHoGt521FPlUJrH+AioQzvJtcJnaGEwHewSXxGFExyX7y81hVsQGng6shr9lG74TM5KdX/LyLIevpKyin6sz/Qj/0MjTQh2g594Yct6NVPL5QNUC3QlX/RR3hOXE9th5Nhf2hBswWfdVZVJsvMQNoGnOVfvNx6Qudgo9Ra/hMVJV8wdF1XQwFSYqwzgxjkVQ9kS+cZjHEhzAK6qMKYlZIjg+ZGqIvykCWBy4T0dlkBykCq33WsIAOAoJaQjH/V5w1uekes5plQOPRfBuTFmGvWRueVX9VW2V7GcccoE90CTSW7cXzaU+9hdflUeUTkk001/PDCAnbTRXb2h4jPeCZ2O0Gh1JuOu2M97PnZjBd6QrJDuqBL60+kuH4BK+Fo8uzLjmaoO4Z4DvsCpZM9DJtlWKvUEnVmTVVj/SOUFmOxBHCZV7CJJETIKA8rIuZKavxzKaxvQSlxD/exg9g130ifoH20pBJPKAz2F+bwyVUq2Qrd98mshdVNhVTtjJXSFx4wzegSfhAKECfcY1u4Wamu3pPqogO+Fu4bifDU1MZRfepxAh8EeLYn0i4Ey6NWwYD4Yhp6hfK8uiGimFPubcsYXiI/nO58QmN5V4+zm1kpdl3AtoeFLF0MT0Wbqk5KJ37rmqFTWYR+4vLsGN4BM3uGoYUJgLv5irINGiw+upKhA3qOIxkiQjVGfR+uo7dRAv4B1WLbqApcD472903Hz2T6/0jmR6G0xWmEWz2g3U7uYZF1FNgKX7PK5p85lXoGMBAMzzA17Kb+EnZmFfk/eghNI4W9r1pGjGZ14YvbIHcHQbYy/Cbb0FTcW61x83ySGRGjc0SOC/qqKE+p28MfV0hfJhNV0P4VdGQdICcYrKPz/Lb306IfSKl+66z83LiKPokGeuq4pI5oqFMzY6FSQC50RXxgifnnckXEUfkZS9kFNJCn0b38Q4aWXRRt2Rl/pLMkll4fdwuPNaRXW11xT1lBdE2KfBblwAdDz/dNhIJtSZZzFtdWq+BqHZPKB8ukbZwCkf0Ne19X1hMFAvsLZIWFyPGnTe36TC9Ej8U5Tkk8J/0Ai9JpnCJ7iLz+VWzFqqEdyaXGqSWk8I4vYovWonifKW2Iok7p8boFaozGsinis86MpknWoeJoazD4OW5UEXvcxNoUvdDdDdP5Ag7V2xypbHy/eGcjY56yF2qGQwUz1xSaE2jit++h9mpYZpqYwuYyrAGT+QlXDsjVSrUXcwiiaCxfsYOm2lmszyrh4tY/LbrY9+GQqK8+SdSyYO2qsmqbvEi+old7nrCaL1Ed7Gx8B05gJ82C1FGFds3FM9tDvUJa9E4vNJVZTLzy89i2dg4sLQmFMGZ8TkH61lUf4Q94D1xRPTYMZst/IK9vjhskJdJeTdKfXNMdOfvVR5eDS3STUlGczIYHEvdhxZ2LR1ud/NYpqYIMqEs7P6yTbIpz8eru61QjH4mg1AybF17mgESqAN4PRnl8uvTsBpT9SlsJ4tgBKtjIZXua36TRmirSIo+iqX8FIol7pKx5CNEox1EdpGC3WWR5C4/Qf+wm3Rc9Z+fhdraPGi8KsWdT0Y7idMylzVwldSXGf1MeGZSiFGe+1tin67kr6ixag26TYYaSi771i5ueEjr+U4+neqPY6H37KaEFzBGFqfpuZIXUEsyIJST01xd2walDwvtGd0Xr7al/ALSXKbRNHSh1/xe9cHVDs+1hv7ul6xPX5ppZAjlZm446vuIsuiiW+rf8Yhmil+Bc0N3Ej3UxAXcTzWdZxEhaN3HRJaX5VMyyR3jLXxZDTnkbrsM3cA1eD52UGL2imx3xA7FB2wN+c9Opo3UG3rZDeIn9Wz2kCfTRVwEesH2oCn0MRHFzZWZcHm4y8GmVp/4BBzd7pXZbBd+3Kehjfw/N0duh2e4hTmuouCuvjrbo4uZaX5DqOyT+PxsJXTBMIOfstFd2/BF/8fnyximG1rFk/Bb6AWOywqHHSYhPhjy0zjuOWSndcUAMwVVtGtDZrFT1FCF+Bboxaz+wYujXVBNPSRt3TBel3xHhVk/9xASyFLqjEhr+/FFxMh7YiKktkftn5CDNDW7xTd7kcU1MJRWMm9Vb55YbVIl5D36BxqFk6osFmqjl8GTjLp7qCnHWMPa24NoufkdWuo7+j/zxUx0N+hbaBqQW6VGia52kcsnkb1p1/I5vgo26CIertrZgMfT8jqxrkeJfAMtwmAWX95Uo/g814vXll5BStHMzzG50EN8RE4g1WgWNNwtUpG10jl8S1zZvvfT7Urzi5eCKOEtweoMJWKejoFKoTY0TliqpCCU+WsqI7ywhpzipVFyeKKikfE+o63t11qguWAP/Wau6OEQE52l5dkq3BGeqwimFMnktyn4J4uoS3aNakAj8XbqStjpC/nXpL354q/zo3SxATjjuEtpr7H5uiodjVHoivbLhvoxnCDdMdZn/RMz0x/k0UIz3lv/EdN0K3pYdrO72VeeH24La2aqJ7wjWeFLhjlus/jC89FaKC05oN6biWqpgGjYshGQTpdTP8ggEQ9mkuTmgqglsFkrE4UBUNreIbnEMHcE9xRN8P2wlZTjr0xKv1HOEvn531ApJFLt1WdXRk/UKSyjmdxIkke903Ftc7EEC1PVDiaNfToRT/c2j0km6I6mKqcW44GqobuOOyp4goU26hWewpfxE/QZaoo2+L50vx5N8rmG/IefiDeJeuqDiAUFwjqeWX3VU11fdoFn04N9PVhNJoSdZoDMztbZ42YhfaMvueW4Irkmp+sS+hlJLmL5y6aI2KYvhGr6kG1kopid1vuiNlY4aXO5KhJmmTo8AWmF8/qUugcq5rLxb7gCiunu2jnQhZ2C2CGD6gw71CMzw13kQ0xEVogsZdVtHHjLD4j7LiIvxpxswLwYRguoCG6H7isSi/qwwQ0Rp8U4/IeuNq/oSDsDfto8dJx9ExJJyVqwX3S9Hi2TazjLCsNtu1984NXMdnbPLbaTdCv1Xpf02+UTqMZe8QWquBlDKoeEtp3e6+qTa7gV+SnG+VIhOeWop/0g56o0EFf+QC1wOdwRPyJH1U/AvgPJYffZMqEtzo4jhfoiKdOyrT7uqqA1NIvricqK3ei1gBW8DwE5zM8Jl3CCUC8MRpH0EbscEoihOptLBntDP+/CH5RWLkfvQhn1TCahR/w201XcYEvUGZbJbnajXRWyh/Xgt/TqkIBOcEXkPBsZHtiaaKlMbWbDSdGf7ab3aSl51fe3qf3nMM3e9vF5W5/BwQT/21ZQ611W2YGPtb8hHbuuiBP+nG6Op6HVqJUlEMUexs1YH5qbTBILRCY2nORVUeh0V1X/hwrwJuy5u2KWupx0Bj1NXtBsuKkezra58+Ez9NGN1R3x0VRindg7mRGZMA8XNOd4jXCIL+IfXYMAN3RSbVUT+oTFdmfMOl1R72SvPQtpwl95zZUxn+g9MtnVMOvDbXVcRnOd+Hr6iDcWH0g6/xRvD99FYtwJR/YlbD05AmFUneyl71x3W17k8xNRMrnJR1djaUGxlsThY6ARjgBPUSc7kkeH/GQIKilgG+8KRCv8mVLcW+Z300I7NBzNJ0XZZhSR1OPSLmHdMOJF8Wf5HzD9K5zFFXG/sFIewu1RPFSOrULH1JTwUR1UMdUvNQAv5jHwTb3KxuWt8StXkuz3mfklNIcc0z3DPyhn9opkrClsVI/xqRBbwytYQq7gQTYNXi4bmGPyjk+CYuiHfj8fp3vDMZ+QZSRvzW6Yq7OilGQHFMfx3GyZXBa2DMa7S2YeuWeHyMy6p3lo29LNtDR3rq5Ljf+RI2guPkcHy9rkF2mJEvvqNI+4jRUs50FfgWy+u5uDaynIAq15dF4tPIB9KIp8L7PDUv1NVoWWJht6iQrIdfgcLu05vsbHBkGc5mECeyC2spv8F4rG++C80ICkoNXwOlIwXEOJzSyX23UIU0h/mklVoY9lfNdVL/E36VD20u4QbVxm6GeKyfGkEvrFUqPR/H9s/XjiBWp1EAAAAABJRU5ErkJggg==",O.onload=()=>{k.setNoise(O),U=!0};const $=!!t.OES_texture_float_linear;function Z(){let e=W;W=Y,Y=e}function Q(){let e=j;j=V,V=e}function K(e=!0){const t=Number(e&&p&&h);C.setDemodulateAlbedo(t),F.setDemodulateAlbedo(t)}K(!1);let q=0,J=0;function ee(e,t){k.setCamera(e),A.setCamera(e),C.setPreviousCamera(t),t.copy(e)}function te(e,t,n=!0){k.setSize(e,t),k.setFrameCount(z);const r=n?(Math.random()-.5)/e:0,i=n?(Math.random()-.5)/t:0;f||k.setJitter(r,i),0===z?k.setStrataCount(1):4===z?k.setStrataCount(6):k.nextSeed()}function ne(t){t.bind(),e.clear(e.COLOR_BUFFER_BIT),t.unbind()}function re(t,n,r){t.bind(),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE),e.enable(e.BLEND),e.viewport(0,0,n,r),k.draw(),e.disable(e.BLEND),t.unbind()}function ie(t,n){e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),T.draw({light:t,lightScale:n}),X=t}function ae(e){let t=T.draw({light:e},!0);E.draw({light:t.color[0]})}function oe(){j.bind(),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.viewport(0,0,q,J),A.draw(),j.unbind(),F.setGBuffers({position:j.color[0],normal:j.color[1],color:j.color[2]})}function se(){p&&(W.bind(),e.viewport(0,0,q,J),C.draw({light:H.color[0],position:j.color[0],color:j.color[2],previousLight:X,previousPosition:V.color[0],previousColor:V.color[2],previousMomentLengthVariance:Y.color[1]}),W.unbind(),h||(ae(W.color[0]),X=W.color[0])),h&&(p?(ae(F.draw({light:W.color[0],reprojectData:Y.color[1]}).color[0]),X=W.color[0]):(ae(F.draw({light:H.color[0],reprojectData:null}).color[0]),X=H.color[0]))}function le(){var t,n,r;te(b.width,b.height,!1),k.bindTextures(),t=H,n=b.width,r=b.height,t.bind(),e.viewport(0,0,n,r),k.draw(),t.unbind(),ie(H.color[0],b.scale),ne(H)}return{draw:function(t){U&&(!qv(t,x)||B?(B=!1,ee(t,x),G?G=!1:le(),z=0,_.reset()):function(t=!1){const{x:n,y:r,tileWidth:i,tileHeight:a,isFirstTile:o,isLastTile:s}=_.nextTile(N);var l,c,u,d,m;o&&(0===z&&(ne(H),C.setPreviousCamera(x)),te(q,J,!0),f&&(p||h)&&oe(),k.bindTextures()),l=H,c=n,u=r,d=i,m=a,e.scissor(c,u,d,m),e.enable(e.SCISSOR_TEST),re(l,q,J),e.disable(e.SCISSOR_TEST),t&&!s&&ie(H.color[0]),s&&(f&&(p||h)?(X=H.color[0],se(),X=H.color[0]):ie(H.color[0]),Z(),Q(),z++,D())}())},fullDraw:function(e){if(U){if(Q(),Z(),!qv(e,x)||B){if(B=!1,d)return ee(e,x),z=0,void le();z=0,ne(H)}else z++;ee(e,x),te(q,J,!0),f&&(p||h)&&oe(),k.bindTextures(),re(H,q,J),f&&(p||h)?se():ie(H.color[0]),D()}},setSize:function(t,n){q=t,J=n,_.setSize(t,n),b.setSize(t,n),function(t,n){const r=$?"float":"halfFloat";H=tg(e,{color:{0:ug(e,{width:t,height:n,storage:r,magFilter:e.LINEAR,minFilter:e.LINEAR})}}),X=H.color[0];const i=()=>tg(e,{color:{0:ug(e,{width:t,height:n,storage:r,magFilter:e.LINEAR,minFilter:e.LINEAR}),1:ug(e,{width:t,height:n,storage:r,channels:4,magFilter:e.LINEAR,minFilter:e.LINEAR})}});W=i(),Y=i();const a=ug(e,{width:t,height:n,storage:"halfFloat"}),o=ug(e,{width:t,height:n,storage:"float"}),s=function(e,t,n){const r=e.createRenderbuffer(),i=e.RENDERBUFFER;return e.bindRenderbuffer(i,r),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT24,t,n),e.bindRenderbuffer(i,null),{target:i,texture:r}}(e,t,n),l=()=>tg(e,{color:{0:ug(e,{width:t,height:n,storage:"float"}),1:a,2:o},depth:s});j=l(),V=l()}(t,n),F.setSize(t,n),T.setSize(t,n),E.setSize(t,n),G=!0},time:function(e){N=e-I,I=e},reset:function(){B=!0,z=0,_.reset(),ne(H),ne(W),ne(Y)},getTotalSamplesRendered:()=>z,setfullSampleCallbackCallBack(e){D=e},setTileSlicesNumber:function(e){_.setTileSlicesNumber(e)},updateBounces:function(e){k.updateBounces(e)},updateEnvLight:function(){const e=hg(n,r);k.updateEnvLight(e)},updateMeshLight:function(){const e=hg(n,r);k.updateMeshLight(e)},setEnvMapIntensity:function(e){k.setEnvMapIntensity(e)},setEnviromentVisible:function(e){k.setEnviromentVisible(e)},setToneMapping:function(e){T.setToneMapping(e)},setMovingDownsampling:function(e){d=e},setDenoiseStatus:function(e){f=e},setTemporalDenoiseStatus:function(e){p=e,K()},setDenoiseColorBlendFactor:function(e){C.setDenoiseColorBlendFactor(e)},setDenoiseMomentBlendFactor:function(e){C.setDenoiseMomentBlendFactor(e)},setSpatialDenoiseStatus:function(e){h=e,K()},setDenoiseColorFactor:function(e){F.setColorFactor(e)},setDenoiseNormalFactor:function(e){F.setNormalFactor(e)},setDenoisePositionFactor:function(e){F.setPositionFactor(e)},getDenoiseFactors:function(){return Object.assign(F.getDenoiseFactors(),C.getDenoiseFactors())},setDemodulateAlbedo:K,updateMeshMaterial:function(){const t=hg(n,r),i=Lg(e,t.materials);k.updateMeshMaterial(i)},dispose:function(){k.dispose(),A.dispose(),T.dispose(),E.dispose(),C.dispose(),F.dispose(),j.dispose(),V.dispose(),H.dispose(),W.dispose(),Y.dispose(),w.dispose()},setEnvRotMatrix:function(e){k.setEnvRotMatrix(e)},toggleBackgroundColor:function(e){k.toggleBackgroundColor(e)},setBackgroundColor:function(e){k.setBackgroundColor(e)},checkIsCameraMove:function(e){return qv(e,x)}}}class ix{constructor(e={}){if(this.canvas=e.canvas||document.createElement("canvas"),this.gl=e.context||this.canvas.getContext("webgl2",{alpha:e.canvasAlpha||!1,depth:!1,stencil:!1,antialias:e.antialias||!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),!this.gl)throw new Error("webgl2 no supported!");Zv(this.gl,Jv),this.optionalExtensions=Zv(this.gl,eg),this._bounces=2,this._envMapIntensity=1,this._useBackgroundColor=!1,this._envRotMatrix=new K,this.envRotation=0,this.backgroundColor=new t(16777215),this._toneMapping=ue,this._movingDownsampling=!1,this._enableDenoise=!1,this._enableTemporalDenoise=!0,this._enableSpatialDenoise=!0,this._fullSampleCallback=null,this._enviromentVisible=!0,this.useTileRender=!1,this.renderWhenOffFocus=!0,this.useWorker=e.useWorker||!0,this.tileSlicesNum=0,this.loadingCallback=e.loadingCallback||{onProgress:()=>{},onComplete:()=>{}},this._isBuilding=!0,this.needsUpdate=!1,this.size=new l(this.canvas.width,this.canvas.height),this.pixelRatio=1,this.pipeline=null,this.currentTime=NaN,this.isValidTime=1,this.lastFocus=!1,this.domElement=this.canvas,this.targetSampleCount=0,this.forceUpdateOneFullSample=!1}static isSupported(){const e=document.createElement("canvas").getContext("webgl2",{failIfMajorPerformanceCaveat:!0});if(!e)return console.error("webgl2 no supported!"),!1;const t=Zv(e,Jv);for(let n in t)if(!t[n])return!1;return!0}async buildScene(e,t){const{gl:n,optionalExtensions:r,bounces:i,size:a,toneMapping:o,envMapIntensity:s,enviromentVisible:l,movingDownsampling:c,enableDenoise:u,enableTemporalDenoise:d,enableSpatialDenoise:f,useWorker:p,tileSlicesNum:h,loadingCallback:m,useBackgroundColor:v,backgroundColor:g}=this;this._isBuilding=!0,e.updateMatrixWorld(),this.pipeline=await rx({gl:n,optionalExtensions:r,scene:e,camera:t,toneMapping:o,bounces:i,envMapIntensity:s,useBackgroundColor:v,backgroundColor:g,enviromentVisible:l,movingDownsampling:c,enableDenoise:u,enableTemporalDenoise:d,enableSpatialDenoise:f,useWorker:p,loadingCallback:m}),this.setSize(a.width,a.height),this.setTileSlicesNumber(h),this.pipeline.setEnvRotMatrix(this._envRotMatrix),this.pipeline.setBackgroundColor(this.backgroundColor),this._isBuilding=!1,m&&m.onComplete&&"function"==typeof m.onComplete&&m.onComplete("Complete!")}set bounces(e){this._bounces=e,this.pipeline&&this.pipeline.updateBounces(e)}get bounces(){return this._bounces}set envMapIntensity(e){e=Number(e),this._envMapIntensity=e,this.pipeline&&this.pipeline.setEnvMapIntensity(e)}get envMapIntensity(){return this._envMapIntensity}set useBackgroundColor(e){this._useBackgroundColor=e,this.pipeline&&this.pipeline.toggleBackgroundColor(e)}get useBackgroundColor(){return this._useBackgroundColor}set toneMapping(e){this._toneMapping=e,this.pipeline&&this.pipeline.setToneMapping(e)}get toneMapping(){return this._toneMapping}set enviromentVisible(e){this._enviromentVisible=e,this.pipeline&&this.pipeline.setEnviromentVisible(e)}get enviromentVisible(){return this._enviromentVisible}set movingDownsampling(e){e=!!e,this._movingDownsampling=e,this.pipeline&&this.pipeline.setMovingDownsampling(e)}get movingDownsampling(){return this._movingDownsampling}set enableDenoise(e){e=!!e,this._enableDenoise=e,this.pipeline&&this.pipeline.setDenoiseStatus(e)}get enableDenoise(){return this._enableDenoise}set enableTemporalDenoise(e){e=!!e,this._enableTemporalDenoise=e,this.pipeline&&this.pipeline.setTemporalDenoiseStatus(e)}get enableTemporalDenoise(){return this._enableTemporalDenoise}set enableSpatialDenoise(e){e=!!e,this._enableSpatialDenoise=e,this.pipeline&&this.pipeline.setSpatialDenoiseStatus(e)}get enableSpatialDenoise(){return this._enableSpatialDenoise}set fullSampleCallback(e){e&&"function"==typeof e&&(this._fullSampleCallback=e,this.pipeline&&this.pipeline.setfullSampleCallbackCallBack(e))}get fullSampleCallback(){return this._fullSampleCallback}get sampleCount(){return this.pipeline?this.pipeline.getTotalSamplesRendered():0}setEnvRotation(e){this.envRotation=e;let t=e*Math.PI/180;this._envRotMatrix.setFromMatrix4((new m).makeRotationY(t)),this.pipeline&&this.pipeline.setEnvRotMatrix(this._envRotMatrix)}updateBackgroundColor(e){this.backgroundColor.set(e),this.pipeline&&this.pipeline.setBackgroundColor(this.backgroundColor)}getContext(){return this.gl}setTileSlicesNumber(e){e=Number(e),this.pipeline&&this.pipeline.setTileSlicesNumber(e)}updateMeshMaterial(){this.pipeline&&this.pipeline.updateMeshMaterial()}updateEnvLight(){this.pipeline&&this.pipeline.updateEnvLight()}updateMeshLight(){this.pipeline&&this.pipeline.updateMeshLight()}setDenoiseColorBlendFactor(e){this.pipeline&&this.pipeline.setDenoiseColorBlendFactor(e)}setDenoiseMomentBlendFactor(e){this.pipeline&&this.pipeline.setDenoiseMomentBlendFactor(e)}setDenoiseColorFactor(e){this.pipeline&&this.pipeline.setDenoiseColorFactor(e)}setDenoiseNormalFactor(e){this.pipeline&&this.pipeline.setDenoiseNormalFactor(e)}setDenoisePositionFactor(e){this.pipeline&&this.pipeline.setDenoisePositionFactor(e)}setDemodulateAlbedo(e){this.pipeline&&this.pipeline.setDemodulateAlbedo(e),this.needsUpdate=!0}getDenoiseFactors(){if(this.pipeline)return this.pipeline.getDenoiseFactors()}setSize(e,t,n=!0){const{size:r,canvas:i,pipeline:a,pixelRatio:o}=this;r.set(e,t),i.width=r.width*o,i.height=r.height*o,n&&(i.style.width=`${r.width}px`,i.style.height=`${r.height}px`),this.pipeline&&a.setSize(r.width*o,r.height*o)}getSize(e){const{size:t}=this;return e||(e=new l),e.copy(t)}setPixelRatio(e){const{size:t}=this;e&&(this.pixelRatio=e,this.setSize(t.width,t.height,!1))}getPixelRatio(){return this.pixelRatio}getTotalSamples(){if(this.pipeline)return this.pipeline.getTotalSamplesRendered()}restartTimer(){this.isValidTime=NaN}render(e,t){if(this._isBuilding)return;if(!this.pipeline)return void console.error("Pipeline not initialized, The scene needs to be built first!");if(this.needsUpdate&&(this.needsUpdate=!1,this.pipeline.reset()),0!=this.targetSampleCount&&this.pipeline.getTotalSamplesRendered()>=this.targetSampleCount&&this.pipeline.checkIsCameraMove(t)&&!this.forceUpdateOneFullSample)return;this.currentTime=performance.now(),this.pipeline.time(this.isValidTime*this.currentTime),this.isValidTime=1,this.currentTime=NaN;let n=this.pipeline.getTotalSamplesRendered();t.updateMatrixWorld(),this.useTileRender?this.pipeline.draw(t):this.pipeline.fullDraw(t),n!=this.pipeline.getTotalSamplesRendered()&&this.forceUpdateOneFullSample&&(this.forceUpdateOneFullSample=!1)}dispose(){this.pipeline&&this.pipeline.dispose(),this.pipeline=null}}class ax extends de{constructor(e,t,n=10,r=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=r,this.target=new h}copy(e){super.copy(e),this.width=e.width,this.height=e.height}}class ox extends de{constructor(e,t,n=1){super(e,t),this.type="SphereAreaLight",this.radius=n}}class sx extends de{constructor(e,t){super(e,t),this.type="PointLight"}}class lx extends de{constructor(e,t){super(e,t),this.type="DirectionalLight",this.target=new h}}export{np as C,kh as D,ip as E,Dh as F,pg as H,sx as K,zh as L,kv as P,mf as R,sp as S,op as T,ox as Z,$e as _,Bh as a,ix as b,hf as c,Oc as f,We as j,ax as k,lx as q,_u as u};
