import{aD as e,q as a,aE as t,r as s,G as i,ab as r}from"./vendor-89444a7f.js";import{b7 as n,b9 as o,ba as l,bb as c,aS as m,aF as d,bf as u,bh as p,aw as h,bP as _,bQ as g}from"./vendor_three-3a2bdf96.js";/* empty css                    */const x=e({sum:{damage:0,fireRate:0,range:0,accuracy:0,recoilControl:0,mobility:0,handling:0},update:{damage:0,fireRate:0,range:0,accuracy:0,recoilControl:0,mobility:0,handling:0},temp:{damage:0,fireRate:0,range:0,accuracy:0,recoilControl:0,mobility:0,handling:0},tempIndex:-1,currIndex:-1,showPlugin:!1,currentType:"",preview:!1,selected:[-1,-1,-1,-1,-1,-1]}),y=[{id:0,name:"消声器",type:"muzzle",position:[-7,3.4,0]},{id:1,name:"握把",type:"underbarrel",position:[-5.5,.7,0]},{id:2,name:"弹夹",type:"ammo",position:[-2.5,-.2,0]},{id:3,name:"镭射",type:"laser",position:[-2.5,3.8,0]},{id:4,name:"瞄准镜",type:"optic",position:[2,3.8,0]},{id:5,name:"枪托",type:"grip",position:[4.5,-.2,0]}],w=[{id:0,name:"damage",text:"伤害",value:75},{id:1,name:"fireRate",text:"射速",value:65},{id:2,name:"range",text:"射程",value:60},{id:3,name:"accuracy",text:"准确度",value:67},{id:4,name:"recoilControl",text:"后坐强度",value:73},{id:5,name:"mobility",text:"机动性",value:79},{id:6,name:"handling",text:"操控",value:70}],b={muzzle:[{id:0,name:"影击消声器",image:"/assets/labs/gun/muzzle_2.png",data:{recoilControl:9,handling:-4}},{id:1,name:"轻语者消声器",image:"/assets/labs/gun/muzzle_1.png",data:{recoilControl:7,mobility:3,handling:-3}}],underbarrel:[{id:0,name:"STT88握把",image:"/assets/labs/gun/underbarrel_1.png",data:{accuracy:-3,recoilControl:7}},{id:1,name:"锦标赛战术握把",image:"/assets/labs/gun/underbarrel_2.png",data:{accuracy:-2,recoilControl:4,handling:5}}],ammo:[{id:0,name:"30发弹匣",image:"/assets/labs/gun/ammo_1.png",data:{mobility:-2,handling:-2}},{id:1,name:"45发弹匣",image:"/assets/labs/gun/ammo_2.png",data:{mobility:-4,handling:-3}}],laser:[{id:0,name:"斜置7型镭射",image:"/assets/labs/gun/laser_1.png",data:{accuracy:4,recoilControl:-4,handling:4}},{id:1,name:"1毫瓦镭射",image:"/assets/labs/gun/laser_2.png",data:{recoilControl:3,recoilControl:3}}],optic:[{id:0,name:"斜式反射瞄准镜",image:"/assets/labs/gun/optic_1.png",data:{range:4,accuracy:3,handling:-2}},{id:1,name:"英特斯CAS-14瞄准镜",image:"/assets/labs/gun/optic_3.png",data:{range:6,accuracy:4}},{id:2,name:"索洛佐微型瞄准镜",image:"/assets/labs/gun/optic_2.png",data:{range:2,accuracy:5}}],grip:[{id:0,name:"重型支援枪托",image:"/assets/labs/gun/grip_1.png",data:{accuracy:9,mobility:-5}},{id:1,name:"TL3轻型精英枪托",image:"/assets/labs/gun/grip_2.png",data:{accuracy:-2,mobility:8}}]},v=e=>{let a={};for(let t in e)a[t]=e[t];return a},j=e=>{for(let a in e)e[a]=0;return e},f=a.memo((({unit:e,unitId:a})=>{const r=t(x),{type:n,name:o}=y[e.id],[l,c]=s.useState(null);s.useEffect((()=>{if(a>=0){c(b[n][a])}else c(null)}),[a]);const m=e=>{if(e.stopPropagation(),r.showPlugin){const e=y.findIndex((e=>e.type===x.currentType));x.sum=v(r.temp),x.selected[e]=r.tempIndex,x.currentType=n;const a=y.findIndex((e=>e.type===n)),t=r.selected[a];if(x.temp=v(x.sum),x.tempIndex=t,x.currIndex=t,t>=0){const{data:e}=b[n][t];w.forEach((a=>{x.update[a.name]=e[a.name]?e[a.name]:0,x.sum[a.name]=r.sum[a.name]-r.update[a.name]}))}}else x.showPlugin=!0,x.currentType=n};return i.jsxs("div",{className:"army_unit",children:[i.jsx("svg",{style:{display:"none"},version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("symbol",{id:"icon_slot",viewBox:"0 0 24 24",children:i.jsx("polygon",{points:"2,22 2,2 22,2 22,18 18,22"})})}),i.jsx("div",{className:"army_unit_shape",children:l?i.jsxs("div",{className:"army_equip",children:[i.jsxs("div",{className:"army_equip__icon",onClick:m,children:[i.jsx("svg",{className:"army_equip__svg",children:i.jsx("use",{xlinkHref:"#icon_slot"})}),i.jsx("img",{src:l.image,alt:"",className:"army_equip__img"})]}),i.jsxs("div",{className:"army_equip__content",children:[i.jsx("p",{className:"army_equip__title",children:l.name}),i.jsx("p",{className:"army_equip__type",children:o})]})]}):i.jsxs("div",{className:"amy_empty",children:[i.jsx("div",{className:"empty_shape",onClick:m,children:i.jsx("div",{className:"empty_shape__inner"})}),i.jsx("div",{className:"amy_empty__name",children:o})]})})]})})),S=e=>{const a=n("/assets/images/texture/water-rough1.jpeg");return s.useLayoutEffect((()=>{a.wrapS=o,a.wrapT=o,a.repeat.set(4,4),a.needsUpdate=!0}),[a]),i.jsxs("mesh",{"rotation-x":-.5*Math.PI,"position-y":-1.8,receiveShadow:!0,...e,children:[i.jsx("circleGeometry",{args:[17,64]}),i.jsx(l,{roughnessMap:a,resolution:2048,color:"#fff",roughness:1,metalness:.9,envMapIntensity:.03,blur:512,mixBlur:8,mixStrength:5,mixContrast:1.2,mirror:.3,debug:0})]})};function N({children:e,...a}){return i.jsx(m,{...a,scale:.55,transform:!0,occlude:!0,children:e})}function O(e){const{nodes:a,materials:n}=c("/models/gun_m4.glb"),o=t(x),l=s.useRef();return s.useEffect((()=>{switch(o.currentType){case"muzzle":r.to(l.current.rotation,{x:-.1,y:.2,duration:.7,ease:"power2.inOut"}),r.to(l.current.position,{x:5,y:-1.4,z:4,duration:.7,ease:"power2.inOut"});break;case"underbarrel":r.to(l.current.rotation,{x:-.1,y:.6,duration:.7,ease:"power2.inOut"}),r.to(l.current.position,{x:.8,y:-1.2,z:4.5,duration:.7,ease:"power2.inOut"});break;case"ammo":r.to(l.current.rotation,{x:-.1,y:.3,duration:.7,ease:"power2.inOut"}),r.to(l.current.position,{x:-.5,y:0,z:4.8,duration:.7,ease:"power2.inOut"});break;case"laser":r.to(l.current.rotation,{x:.1,y:2.4,duration:.7,ease:"power2.inOut"}),r.to(l.current.position,{x:-.3,y:-2.1,z:6.4,duration:.7,ease:"power2.inOut"});break;case"optic":r.to(l.current.rotation,{x:0,y:-.6,duration:.7,ease:"power2.inOut"}),r.to(l.current.position,{x:-1.5,y:-2.4,z:4.8,duration:.7,ease:"power2.inOut"});break;case"grip":r.to(l.current.rotation,{x:0,y:0,duration:.7,ease:"power2.inOut"}),r.to(l.current.position,{x:-3.5,y:-1.4,z:4,duration:.7,ease:"power2.inOut"});break;default:r.to(l.current.rotation,{x:0,y:0,duration:.7,ease:"power2.inOut"}),r.to(l.current.position,{x:0,y:0,z:0,duration:.7,ease:"power2.inOut"})}}),[o.currentType]),i.jsxs("group",{...e,dispose:null,ref:l,children:[i.jsxs("group",{position:[-8.5,-1.5,0],scale:.001,children:[i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0.geometry,material:n.grip_3,visible:0===o.selected[1]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_1.geometry,material:n.grip_2,visible:1===o.selected[1]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_2.geometry,material:n.khafe_kon1,visible:0===o.selected[0]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_3.geometry,material:n.khafe_kon_2,visible:1===o.selected[0]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_4.geometry,material:n.sight_1,visible:1===o.selected[4]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_5.geometry,material:n.sight_2,visible:2===o.selected[4]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_6.geometry,material:n.lambert_scope,visible:0===o.selected[4]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_7.geometry,material:n.lambert_3}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_8.geometry,material:n.btts_1,visible:1===o.selected[5]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_9.geometry,material:n.lambert_tail_4,visible:0===o.selected[5]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_10.geometry,material:n.lambert_tail_2,visible:0===o.selected[5]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_11.geometry,material:n.lambert_ammo_1,visible:0===o.selected[2]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_12.geometry,material:n.lambert_ammo_2,visible:1===o.selected[2]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_13.geometry,material:n.lambert_5}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_14.geometry,material:n.sight_3,visible:1===o.selected[3]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_15.geometry,material:n.lambert_4}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_16.geometry,material:n.lambert_7}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_17.geometry,material:n.lambert_6}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_18.geometry,material:n.lambert_8,visible:0===o.selected[3]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_19.geometry,material:n.lambert_aux,visible:0===o.selected[3]}),i.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.mesh_0_20.geometry,material:n.lambert_ammo_s,visible:o.selected[2]<0})]}),i.jsx("group",{position:[0,0,.5],children:y.map((e=>i.jsx(N,{position:e.position,style:{display:o.showPlugin||o.preview?"none":"block"},children:i.jsx(f,{unit:e,unitId:o.selected[e.id]})},e.id)))}),i.jsx(S,{})]})}function k({list:e=[]}){const a=t(x),s=y.findIndex((e=>e.type===a.currentType));x.currIndex=s;return i.jsx(i.Fragment,{children:e.map(((e,t)=>i.jsx("div",{className:"plugin_unit "+(t===a.selected[x.currIndex]?"current":""),onClick:()=>{(e=>{const{data:a,id:t}=e;w.forEach((e=>{x.update[e.name]=a[e.name]?a[e.name]:0})),x.selected[s]=t})(e)},children:i.jsxs("div",{className:"plugin_unit__pane",children:[i.jsx("div",{className:"plugin_unit__thumb",children:i.jsx("img",{className:"plugin_unit__img",src:e.image})}),i.jsx("div",{className:"plugin_unit__name",children:e.name})]})},t)))})}c.preload("/models/gun_m4.glb");const C=()=>{const e=t(x),a=s.useRef(),n=s.useRef(),o=s.useRef(),l=s.useRef(),c=s.useRef(),[m,d]=s.useState(!1),[u,p]=s.useState(null),h=a=>{if(a){for(let a in x.sum)x.sum[a]=e.sum[a]+e.update[a];j(x.update)}else x.sum=v(e.temp),j(x.update),x.selected[u]=e.tempIndex;x.currentType="",x.showPlugin=!1};return s.useEffect((()=>{if(e.showPlugin){r.to(n.current,{y:-200,duration:.5,ease:"power2.inOut",onStart:()=>{d(!0)}}),r.to(a.current,{y:0,duration:.5,ease:"power2.inOut",onStart:()=>{d(!0)}});const t=y.findIndex((a=>a.type===e.currentType)),s=e.selected[t];if(x.currIndex=s,x.temp=v(x.sum),x.tempIndex=s,s>=0){const{data:a}=b[e.currentType][s];w.forEach((e=>{x.update[e.name]=a[e.name]?a[e.name]:0,x.sum[e.name]=x.sum[e.name]-x.update[e.name]}))}r.to(l.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"})}else r.to(n.current,{y:0,duration:.5,ease:"power2.inOut",onStart:()=>{d(!0)}}),r.to(a.current,{y:"110%",duration:.5,ease:"power2.inOut",onComplete:()=>{d(!1)}}),r.to(l.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"})}),[e.showPlugin]),s.useEffect((()=>{console.log("str",x.preview),e.preview?(r.to(l.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}),r.to(n.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}),r.to(o.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}),r.to(c.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"})):(r.to(l.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"}),r.to(n.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"}),r.to(o.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"}),r.to(c.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}))}),[e.preview]),i.jsxs("section",{className:"hud_box",children:[i.jsxs("div",{className:"weapon_info",ref:o,children:[i.jsx("div",{className:"weapon_info__subtit",children:i.jsx("span",{className:"weapon_info__subtit_txt",children:"突击步枪"})}),i.jsx("h2",{className:"weapon_info__title",children:"M4A1 Carbine"}),i.jsx("p",{className:"weapon_info__level",children:"等级：5"})]}),i.jsx("div",{className:"plugin_box",style:{visibility:m?"visible":"hidden"},children:i.jsxs("div",{className:"plugin_wrap",ref:a,children:[i.jsxs("div",{className:"plugin_list",children:[i.jsx("div",{className:"plugin_unit "+(-1===x.selected[x.currIndex]?"current":""),onClick:()=>{j(x.update);const a=y.findIndex((a=>a.type===e.currentType));p(a),x.selected[a]=-1},children:i.jsx("div",{className:"plugin_unit__empty"})}),i.jsx(k,{list:b[e.currentType]})]}),i.jsxs("div",{className:"plugin_action",children:[i.jsx("div",{className:"weapon_btn weapon_btn--primary",onClick:e=>{e.stopPropagation(),h(!0)},children:"确定"}),i.jsx("div",{className:"weapon_btn",onClick:e=>{e.stopPropagation(),h(!1)},children:"取消"})]})]})}),i.jsx("div",{className:"status_box",ref:n,children:w.map(((a,t)=>i.jsxs("div",{className:"status_unit",children:[i.jsx("p",{className:"status_unit__name",children:a.text}),i.jsx("div",{className:"status_unit__data",children:i.jsx("div",{className:"status_unit__bar",children:i.jsxs("div",{className:"status_unit__bar_wrap",children:[i.jsx("div",{className:"status_unit__bar_curr",style:{width:a.value+x.sum[a.name]+"%"}}),i.jsx("div",{className:"status_unit__bar_update "+(e.update[a.name]>0?"good":"bad"),style:{width:Math.abs(e.update[a.name])+"%"}})]})})})]},t)))}),i.jsx("div",{className:"return_box",ref:c,children:i.jsx("div",{className:"weapon_btn",onClick:()=>{x.preview=!1},children:"返回"})}),i.jsx("div",{className:"action_box",ref:l,children:i.jsx("div",{className:"action_btn",onClick:()=>{x.preview=!0},children:"预览"})})]})};function z(e){return i.jsx(g,{castShadow:!0,penumbra:1,distance:24,decay:.9,angle:.5,attenuation:11,anglePower:3,intensity:8,...e})}const I=()=>{const e=t(x);return i.jsxs("section",{className:"lab_show",children:[i.jsxs(d,{camera:{position:[0,0,10],fov:60,near:.01,far:1e4},children:[i.jsx(s.Suspense,{fallback:null,children:i.jsx(O,{})}),i.jsx(u,{files:"/hdrs/empty_warehouse_01_1k.hdr"}),i.jsx(P,{}),e.preview&&i.jsx(T,{})]}),i.jsx(C,{})]})};function T(){return i.jsxs("group",{children:[i.jsx(z,{color:"#fc3131",position:[7,10,2]}),i.jsx(z,{color:"#2D00F7",position:[-7,10,2]}),i.jsx(p,{makeDefault:!0,autoRotate:!0})]})}function P(){const{gl:e,camera:a}=h(),n=t(x);return s.useEffect((()=>{n.preview||(r.to(a.rotation,{x:0,y:0,z:0,duration:.5,ease:"power2.inOut"}),r.to(a.position,{x:0,y:0,z:10,duration:.5,ease:"power2.inOut"}))}),[n.preview]),i.jsx("group",{position:[0,0,-8],children:i.jsx(_,{count:80,scale:15,size:6,speed:.4})})}export{I as default};
