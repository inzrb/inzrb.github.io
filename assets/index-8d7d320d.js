import{j as e}from"./r3-other-vendor-2c8fc3cb.js";import{R as a,a as t}from"./react-vendor-670efa73.js";import{F as s,H as r,J as i,X as n,C as o,K as l,O as c,b as m,ac as d,ad as u}from"./r3-extend-vendor-ed1023dc.js";import{p,u as h}from"./react-fa7cfd0b.js";import{g as _}from"./index-4136c6eb.js";import{a5 as g}from"./three-vendor-6d04682c.js";/* empty css                    */const x=p({sum:{damage:0,fireRate:0,range:0,accuracy:0,recoilControl:0,mobility:0,handling:0},update:{damage:0,fireRate:0,range:0,accuracy:0,recoilControl:0,mobility:0,handling:0},temp:{damage:0,fireRate:0,range:0,accuracy:0,recoilControl:0,mobility:0,handling:0},tempIndex:-1,currIndex:-1,showPlugin:!1,currentType:"",preview:!1,selected:[-1,-1,-1,-1,-1,-1]}),y=[{id:0,name:"消声器",type:"muzzle",position:[-7,3.4,0]},{id:1,name:"握把",type:"underbarrel",position:[-5.5,.7,0]},{id:2,name:"弹夹",type:"ammo",position:[-2.5,-.2,0]},{id:3,name:"镭射",type:"laser",position:[-2.5,3.8,0]},{id:4,name:"瞄准镜",type:"optic",position:[2,3.8,0]},{id:5,name:"枪托",type:"grip",position:[4.5,-.2,0]}],w=[{id:0,name:"damage",text:"伤害",value:75},{id:1,name:"fireRate",text:"射速",value:65},{id:2,name:"range",text:"射程",value:60},{id:3,name:"accuracy",text:"准确度",value:67},{id:4,name:"recoilControl",text:"后坐强度",value:73},{id:5,name:"mobility",text:"机动性",value:79},{id:6,name:"handling",text:"操控",value:70}],j={muzzle:[{id:0,name:"影击消声器",image:"/assets/labs/gun/muzzle_2.png",data:{recoilControl:9,handling:-4}},{id:1,name:"轻语者消声器",image:"/assets/labs/gun/muzzle_1.png",data:{recoilControl:7,mobility:3,handling:-3}}],underbarrel:[{id:0,name:"STT88握把",image:"/assets/labs/gun/underbarrel_1.png",data:{accuracy:-3,recoilControl:7}},{id:1,name:"锦标赛战术握把",image:"/assets/labs/gun/underbarrel_2.png",data:{accuracy:-2,recoilControl:4,handling:5}}],ammo:[{id:0,name:"30发弹匣",image:"/assets/labs/gun/ammo_1.png",data:{mobility:-2,handling:-2}},{id:1,name:"45发弹匣",image:"/assets/labs/gun/ammo_2.png",data:{mobility:-4,handling:-3}}],laser:[{id:0,name:"斜置7型镭射",image:"/assets/labs/gun/laser_1.png",data:{accuracy:4,recoilControl:-4,handling:4}},{id:1,name:"1毫瓦镭射",image:"/assets/labs/gun/laser_2.png",data:{recoilControl:3,recoilControl:3}}],optic:[{id:0,name:"斜式反射瞄准镜",image:"/assets/labs/gun/optic_1.png",data:{range:4,accuracy:3,handling:-2}},{id:1,name:"英特斯CAS-14瞄准镜",image:"/assets/labs/gun/optic_3.png",data:{range:6,accuracy:4}},{id:2,name:"索洛佐微型瞄准镜",image:"/assets/labs/gun/optic_2.png",data:{range:2,accuracy:5}}],grip:[{id:0,name:"重型支援枪托",image:"/assets/labs/gun/grip_1.png",data:{accuracy:9,mobility:-5}},{id:1,name:"TL3轻型精英枪托",image:"/assets/labs/gun/grip_2.png",data:{accuracy:-2,mobility:8}}]},v=e=>{let a={};for(let t in e)a[t]=e[t];return a},b=e=>{for(let a in e)e[a]=0;return e},f=a.memo((({unit:a,unitId:s})=>{const r=h(x),{type:i,name:n}=y[a.id],[o,l]=t.useState(null);t.useEffect((()=>{if(s>=0){l(j[i][s])}else l(null)}),[s]);const c=e=>{if(e.stopPropagation(),r.showPlugin){const e=y.findIndex((e=>e.type===x.currentType));x.sum=v(r.temp),x.selected[e]=r.tempIndex,x.currentType=i;const a=y.findIndex((e=>e.type===i)),t=r.selected[a];if(x.temp=v(x.sum),x.tempIndex=t,x.currIndex=t,t>=0){const{data:e}=j[i][t];w.forEach((a=>{x.update[a.name]=e[a.name]?e[a.name]:0,x.sum[a.name]=r.sum[a.name]-r.update[a.name]}))}}else x.showPlugin=!0,x.currentType=i};return e.jsxs("div",{className:"army_unit",children:[e.jsx("svg",{style:{display:"none"},version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("symbol",{id:"icon_slot",viewBox:"0 0 24 24",children:e.jsx("polygon",{points:"2,22 2,2 22,2 22,18 18,22"})})}),e.jsx("div",{className:"army_unit_shape",children:o?e.jsxs("div",{className:"army_equip",children:[e.jsxs("div",{className:"army_equip__icon",onClick:c,children:[e.jsx("svg",{className:"army_equip__svg",children:e.jsx("use",{xlinkHref:"#icon_slot"})}),e.jsx("img",{src:o.image,alt:"",className:"army_equip__img"})]}),e.jsxs("div",{className:"army_equip__content",children:[e.jsx("p",{className:"army_equip__title",children:o.name}),e.jsx("p",{className:"army_equip__type",children:n})]})]}):e.jsxs("div",{className:"amy_empty",children:[e.jsx("div",{className:"empty_shape",onClick:c,children:e.jsx("div",{className:"empty_shape__inner"})}),e.jsx("div",{className:"amy_empty__name",children:n})]})})]})})),S=a=>{const i=s("/assets/images/texture/water-rough1.jpeg");return t.useLayoutEffect((()=>{i.wrapS=g,i.wrapT=g,i.repeat.set(4,4),i.needsUpdate=!0}),[i]),e.jsxs("mesh",{"rotation-x":-.5*Math.PI,"position-y":-1.8,receiveShadow:!0,...a,children:[e.jsx("circleGeometry",{args:[17,64]}),e.jsx(r,{roughnessMap:i,resolution:2048,color:"#fff",roughness:1,metalness:.9,envMapIntensity:.03,blur:512,mixBlur:8,mixStrength:5,mixContrast:1.2,mirror:.3,debug:0})]})};function N({children:a,...t}){return e.jsx(n,{...t,scale:.55,transform:!0,occlude:!0,children:a})}function O(a){const{nodes:s,materials:r}=i("/models/gun_m4.glb"),n=h(x),o=t.useRef();return t.useEffect((()=>{switch(n.currentType){case"muzzle":_.to(o.current.rotation,{x:-.1,y:.2,duration:.7,ease:"power2.inOut"}),_.to(o.current.position,{x:5,y:-1.4,z:4,duration:.7,ease:"power2.inOut"});break;case"underbarrel":_.to(o.current.rotation,{x:-.1,y:.6,duration:.7,ease:"power2.inOut"}),_.to(o.current.position,{x:.8,y:-1.2,z:4.5,duration:.7,ease:"power2.inOut"});break;case"ammo":_.to(o.current.rotation,{x:-.1,y:.3,duration:.7,ease:"power2.inOut"}),_.to(o.current.position,{x:-.5,y:0,z:4.8,duration:.7,ease:"power2.inOut"});break;case"laser":_.to(o.current.rotation,{x:.1,y:2.4,duration:.7,ease:"power2.inOut"}),_.to(o.current.position,{x:-.3,y:-2.1,z:6.4,duration:.7,ease:"power2.inOut"});break;case"optic":_.to(o.current.rotation,{x:0,y:-.6,duration:.7,ease:"power2.inOut"}),_.to(o.current.position,{x:-1.5,y:-2.4,z:4.8,duration:.7,ease:"power2.inOut"});break;case"grip":_.to(o.current.rotation,{x:0,y:0,duration:.7,ease:"power2.inOut"}),_.to(o.current.position,{x:-3.5,y:-1.4,z:4,duration:.7,ease:"power2.inOut"});break;default:_.to(o.current.rotation,{x:0,y:0,duration:.7,ease:"power2.inOut"}),_.to(o.current.position,{x:0,y:0,z:0,duration:.7,ease:"power2.inOut"})}}),[n.currentType]),e.jsxs("group",{...a,dispose:null,ref:o,children:[e.jsxs("group",{position:[-8.5,-1.5,0],scale:.001,children:[e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0.geometry,material:r.grip_3,visible:0===n.selected[1]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_1.geometry,material:r.grip_2,visible:1===n.selected[1]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_2.geometry,material:r.khafe_kon1,visible:0===n.selected[0]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_3.geometry,material:r.khafe_kon_2,visible:1===n.selected[0]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_4.geometry,material:r.sight_1,visible:1===n.selected[4]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_5.geometry,material:r.sight_2,visible:2===n.selected[4]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_6.geometry,material:r.lambert_scope,visible:0===n.selected[4]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_7.geometry,material:r.lambert_3}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_8.geometry,material:r.btts_1,visible:1===n.selected[5]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_9.geometry,material:r.lambert_tail_4,visible:0===n.selected[5]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_10.geometry,material:r.lambert_tail_2,visible:0===n.selected[5]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_11.geometry,material:r.lambert_ammo_1,visible:0===n.selected[2]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_12.geometry,material:r.lambert_ammo_2,visible:1===n.selected[2]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_13.geometry,material:r.lambert_5}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_14.geometry,material:r.sight_3,visible:1===n.selected[3]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_15.geometry,material:r.lambert_4}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_16.geometry,material:r.lambert_7}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_17.geometry,material:r.lambert_6}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_18.geometry,material:r.lambert_8,visible:0===n.selected[3]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_19.geometry,material:r.lambert_aux,visible:0===n.selected[3]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.mesh_0_20.geometry,material:r.lambert_ammo_s,visible:n.selected[2]<0})]}),e.jsx("group",{position:[0,0,.5],children:y.map((a=>e.jsx(N,{position:a.position,style:{display:n.showPlugin||n.preview?"none":"block"},children:e.jsx(f,{unit:a,unitId:n.selected[a.id]})},a.id)))}),e.jsx(S,{})]})}function C({list:a=[]}){const t=h(x),s=y.findIndex((e=>e.type===t.currentType));x.currIndex=s;return e.jsx(e.Fragment,{children:a.map(((a,r)=>e.jsx("div",{className:"plugin_unit "+(r===t.selected[x.currIndex]?"current":""),onClick:()=>{(e=>{const{data:a,id:t}=e;w.forEach((e=>{x.update[e.name]=a[e.name]?a[e.name]:0})),x.selected[s]=t})(a)},children:e.jsxs("div",{className:"plugin_unit__pane",children:[e.jsx("div",{className:"plugin_unit__thumb",children:e.jsx("img",{className:"plugin_unit__img",src:a.image})}),e.jsx("div",{className:"plugin_unit__name",children:a.name})]})},r)))})}i.preload("/models/gun_m4.glb");const k=()=>{const a=h(x),s=t.useRef(),r=t.useRef(),i=t.useRef(),n=t.useRef(),o=t.useRef(),[l,c]=t.useState(!1),[m,d]=t.useState(null),u=e=>{if(e){for(let e in x.sum)x.sum[e]=a.sum[e]+a.update[e];b(x.update)}else x.sum=v(a.temp),b(x.update),x.selected[m]=a.tempIndex;x.currentType="",x.showPlugin=!1};return t.useEffect((()=>{if(a.showPlugin){_.to(r.current,{y:-200,duration:.5,ease:"power2.inOut",onStart:()=>{c(!0)}}),_.to(s.current,{y:0,duration:.5,ease:"power2.inOut",onStart:()=>{c(!0)}});const e=y.findIndex((e=>e.type===a.currentType)),t=a.selected[e];if(x.currIndex=t,x.temp=v(x.sum),x.tempIndex=t,t>=0){const{data:e}=j[a.currentType][t];w.forEach((a=>{x.update[a.name]=e[a.name]?e[a.name]:0,x.sum[a.name]=x.sum[a.name]-x.update[a.name]}))}_.to(n.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"})}else _.to(r.current,{y:0,duration:.5,ease:"power2.inOut",onStart:()=>{c(!0)}}),_.to(s.current,{y:"110%",duration:.5,ease:"power2.inOut",onComplete:()=>{c(!1)}}),_.to(n.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"})}),[a.showPlugin]),t.useEffect((()=>{console.log("str",x.preview),a.preview?(_.to(n.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}),_.to(r.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}),_.to(i.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}),_.to(o.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"})):(_.to(n.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"}),_.to(r.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"}),_.to(i.current,{autoAlpha:1,duration:.5,ease:"power2.inOut"}),_.to(o.current,{autoAlpha:0,duration:.5,ease:"power2.inOut"}))}),[a.preview]),e.jsxs("section",{className:"hud_box",children:[e.jsxs("div",{className:"weapon_info",ref:i,children:[e.jsx("div",{className:"weapon_info__subtit",children:e.jsx("span",{className:"weapon_info__subtit_txt",children:"突击步枪"})}),e.jsx("h2",{className:"weapon_info__title",children:"M4A1 Carbine"}),e.jsx("p",{className:"weapon_info__level",children:"等级：5"})]}),e.jsx("div",{className:"plugin_box",style:{visibility:l?"visible":"hidden"},children:e.jsxs("div",{className:"plugin_wrap",ref:s,children:[e.jsxs("div",{className:"plugin_list",children:[e.jsx("div",{className:"plugin_unit "+(-1===x.selected[x.currIndex]?"current":""),onClick:()=>{b(x.update);const e=y.findIndex((e=>e.type===a.currentType));d(e),x.selected[e]=-1},children:e.jsx("div",{className:"plugin_unit__empty"})}),e.jsx(C,{list:j[a.currentType]})]}),e.jsxs("div",{className:"plugin_action",children:[e.jsx("div",{className:"weapon_btn weapon_btn--primary",onClick:e=>{e.stopPropagation(),u(!0)},children:"确定"}),e.jsx("div",{className:"weapon_btn",onClick:e=>{e.stopPropagation(),u(!1)},children:"取消"})]})]})}),e.jsx("div",{className:"status_box",ref:r,children:w.map(((t,s)=>e.jsxs("div",{className:"status_unit",children:[e.jsx("p",{className:"status_unit__name",children:t.text}),e.jsx("div",{className:"status_unit__data",children:e.jsx("div",{className:"status_unit__bar",children:e.jsxs("div",{className:"status_unit__bar_wrap",children:[e.jsx("div",{className:"status_unit__bar_curr",style:{width:t.value+x.sum[t.name]+"%"}}),e.jsx("div",{className:"status_unit__bar_update "+(a.update[t.name]>0?"good":"bad"),style:{width:Math.abs(a.update[t.name])+"%"}})]})})})]},s)))}),e.jsx("div",{className:"return_box",ref:o,children:e.jsx("div",{className:"weapon_btn",onClick:()=>{x.preview=!1},children:"返回"})}),e.jsx("div",{className:"action_box",ref:n,children:e.jsx("div",{className:"action_btn",onClick:()=>{x.preview=!0},children:"预览"})})]})};function z(a){return e.jsx(u,{castShadow:!0,penumbra:1,distance:24,decay:.9,angle:.5,attenuation:11,anglePower:3,intensity:8,...a})}const I=()=>{const a=h(x);return e.jsxs("section",{className:"lab_show",children:[e.jsxs(o,{camera:{position:[0,0,10],fov:60,near:.01,far:1e4},children:[e.jsx(t.Suspense,{fallback:null,children:e.jsx(O,{})}),e.jsx(l,{files:"/hdrs/empty_warehouse_01_1k.hdr"}),e.jsx(A,{}),a.preview&&e.jsx(T,{})]}),e.jsx(k,{})]})};function T(){return e.jsxs("group",{children:[e.jsx(z,{color:"#fc3131",position:[7,10,2]}),e.jsx(z,{color:"#2D00F7",position:[-7,10,2]}),e.jsx(c,{makeDefault:!0,autoRotate:!0})]})}function A(){const{gl:a,camera:s}=m(),r=h(x);return t.useEffect((()=>{r.preview||(_.to(s.rotation,{x:0,y:0,z:0,duration:.5,ease:"power2.inOut"}),_.to(s.position,{x:0,y:0,z:10,duration:.5,ease:"power2.inOut"}))}),[r.preview]),e.jsx("group",{position:[0,0,-8],children:e.jsx(d,{count:80,scale:15,size:6,speed:.4})})}export{I as default};
