import{r as e,aL as r,aG as n,aH as t,aI as o,aJ as s,G as i,aC as a}from"./vendor-89444a7f.js";import{aw as l,bS as c,aN as p,az as u}from"./vendor_three-3a2bdf96.js";const d=e.forwardRef((({children:a,renderIndex:d=1,samples:m=64,...v},g)=>{const f=e.useRef(null),h=e.useRef(),{scene:b,controls:y,camera:w,gl:L,size:x,viewport:E}=l();e.useEffect((()=>{h.current=new r({canvas:{getContext:L.getContext,getExtension:L.getExtension},loadingCallback:{onProgress:()=>null,onComplete:()=>null}}),h.current.canvas=L.domElement,h.current.gl=L.getContext();let e=!1;return Array.isArray(a)?(a.forEach(((r,i)=>{if("rectAreaLight"===r.type||"directionalLight"===r.type||"pointLight"===r.type||"sphereAreaLight"===r.type){const e=r.props.color?r.props.color:"#fff",l=r.props.intensity?r.props.intensity:1,c=r.props.radius?r.props.radius:1,p=r.props.width?r.props.width:1,u=r.props.height?r.props.height:1;let d={rectAreaLight:new n(e,l,p,u),directionalLight:new t(e,l),pointLight:new o(e,l),sphereAreaLight:new s(e,l,c)}[r.type];const m=r.props.position?r.props.position:[0,0,0],v=r.props.target?r.props.target:[0,0,0];d.position.set(m[0],m[1],m[2]),"rectAreaLight"!==r.type&&"directionalLight"!==r.type||d.target.set(v[0],v[1],v[2]),f.current.add(d),a=Array.from(a).splice(i,1)}else if("Environment"===r.type.name){e=!0;const n=r.props.files,t=(new c).setDataType(p).load(n,(()=>{}));f.current.environment=t,h.current.enviromentVisible=!1,a=Array.from(a).splice(i,1)}})),e||(h.current.enviromentVisible=!!b.background,f.current.environment=b.environment),h.current.needsUpdate=!0,h.current.pipeline&&h.current.render(f.current,w)):(h.current.enviromentVisible=!!b.background,f.current.environment=b.environment),()=>{h.current.canvas=null,h.current.gl=null,h.current.pipeline=null}}),[]);const C=e.useCallback((()=>{h.current&&(h.current.needsUpdate=!0,h.current.pipeline&&h.current.render(f.current,w))}),[]);return e.useEffect((()=>{const{denoiseColorBlendFactor:e,denoiseMomentBlendFactor:r,denoiseColorFactor:n,denoisePositionFactor:t,...o}=v;Object.assign(h.current,o),void 0!==e&&h.current.setDenoiseColorBlendFactor(e),void 0!==r&&h.current.setDenoiseMomentBlendFactor(r),void 0!==n&&h.current.setDenoiseColorFactor(n),void 0!==t&&h.current.setDenoisePositionFactor(t),C()}),[v]),e.useEffect((()=>{if(y)return y.addEventListener("start",C),()=>y.removeEventListener("start",C)}),[y]),e.useEffect((()=>{h.current.setSize(x.width,x.height),h.current.setPixelRatio(E.dpr),C()}),[x,E]),e.useEffect((()=>{h.current.buildScene(f.current,w).then(C)}),[]),e.useImperativeHandle(g,(()=>h.current),[]),u((()=>{h.current&&h.current.pipeline&&h.current.getTotalSamples()<m&&h.current.render(f.current,w)}),d),i.jsx("scene",{ref:f,children:a})})),m={movingDownsampling:{value:!0,label:"移动过程中降低采样"},useTileRenderer:{value:!1,label:"使用Tile渲染器"},samples:{value:32,min:8,max:256,step:4,label:"采样"},bounces:{value:1,min:1,max:10,step:1,label:"反弹次数"},envMapIntensity:{value:1,min:0,max:3,label:"环境纹理亮度"},denoise:a({enableDenoise:{value:!0,label:"开启降噪"},enableTemporalDenoise:{value:!0,label:"开启实时降噪"},enableSpatialDenoise:{value:!0,label:"开启立体空间降噪"}})};export{d as R,m as c};
