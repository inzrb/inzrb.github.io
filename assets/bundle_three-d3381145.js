import{T as e,M as t,V as r,a as n,U as i,O as o,B as a,b as s,c as l,R as u,S as c,C as h,d,e as p,F as f,f as m,g as v,L as g,E as y,h as b,i as x,j as w,k as _,l as S,m as O,Q as T,A as E,D as C,P as A,n as M,o as D,p as P,H as k,q as L,s as U,r as I,t as z,u as R,v as N,w as B,x as F,y as j,z as G,G as V,I as H,J as W,K as q,N as $,W as X,X as Y,Y as Z,Z as K,_ as Q,$ as J,a0 as ee,a1 as te,a2 as re,a3 as ne,a4 as ie,a5 as oe,a6 as ae,a7 as se,a8 as le,a9 as ue,aa as ce,ab as he,ac as de,ad as pe,ae as fe,af as me,ag as ve,ah as ge,ai as ye,aj as be,ak as xe,al as we,am as _e,an as Se,ao as Oe,ap as Te,aq as Ee,ar as Ce,as as Ae}from"./vendor_three-609340b1.js";const Me={},De=function(e,t,r){if(!t||0===t.length)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map((e=>{if(e=function(e,t){return new URL(e,t).href}(e,r),e in Me)return;Me[e]=!0;const t=e.endsWith(".css"),i=t?'[rel="stylesheet"]':"";if(!!r)for(let r=n.length-1;r>=0;r--){const i=n[r];if(i.href===e&&(!t||"stylesheet"===i.rel))return}else if(document.querySelector(`link[href="${e}"]${i}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script",o.crossOrigin=""),o.href=e,document.head.appendChild(o),t?new Promise(((t,r)=>{o.addEventListener("load",t),o.addEventListener("error",(()=>r(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e()))};var Pe=Object.create,ke=Object.defineProperty,Le=Object.getOwnPropertyDescriptor,Ue=Object.getOwnPropertyNames,Ie=Object.getPrototypeOf,ze=Object.prototype.hasOwnProperty,Re=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Ne=(e,t,r)=>(r=null!=e?Pe(Ie(e)):{},((e,t,r,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of Ue(t))!ze.call(e,i)&&i!==r&&ke(e,i,{get:()=>t[i],enumerable:!(n=Le(t,i))||n.enumerable});return e})(!t&&e&&e.__esModule?r:ke(r,"default",{value:e,enumerable:!0}),e)),Be=Re(((e,t)=>{var r,n;r=e,n=function(){return e.importState=function(t){var r=new e;return r.importState(t),r},e;function e(){return function(e){var t=0,r=0,n=0,i=1;0==e.length&&(e=[+new Date]);var o=function(){var e=4022871197,t=function(t){t=t.toString();for(var r=0;r<t.length;r++){var n=.02519603282416938*(e+=t.charCodeAt(r));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}();t=o(" "),r=o(" "),n=o(" ");for(var a=0;a<e.length;a++)(t-=o(e[a]))<0&&(t+=1),(r-=o(e[a]))<0&&(r+=1),(n-=o(e[a]))<0&&(n+=1);o=null;var s=function(){var e=2091639*t+2.3283064365386963e-10*i;return t=r,r=n,n=e-(i=0|e)};return s.next=s,s.uint32=function(){return 4294967296*s()},s.fract53=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.version="Alea 0.9",s.args=e,s.exportState=function(){return[t,r,n,i]},s.importState=function(e){t=+e[0]||0,r=+e[1]||0,n=+e[2]||0,i=+e[3]||0},s}(Array.prototype.slice.call(arguments))}},"object"==typeof e?t.exports=n():"function"==typeof define&&define.amd?define(n):r.Alea=n()})),Fe=Re(((e,t)=>{var r,n;r=e,n=function(e){e.SVD=function(e,t,r,n,i){if(t=void 0===t||t,r=void 0===r||r,i=1e-64/(n=n||Math.pow(2,-52)),!e)throw new TypeError("Matrix a is not defined");var o,a,s,l,u,c,h,d,p,f,m,v,g=e[0].length,y=e.length;if(y<g)throw new TypeError("Invalid matrix: m < n");for(var b=[],x=[],w=[],_="f"===t?y:g,S=f=h=0;S<y;S++)x[S]=new Array(_).fill(0);for(S=0;S<g;S++)w[S]=new Array(g).fill(0);var O,T=new Array(g).fill(0);for(S=0;S<y;S++)for(o=0;o<g;o++)x[S][o]=e[S][o];for(S=0;S<g;S++){for(b[S]=h,p=0,s=S+1,o=S;o<y;o++)p+=Math.pow(x[o][S],2);if(p<i)h=0;else for(d=(c=x[S][S])*(h=c<0?Math.sqrt(p):-Math.sqrt(p))-p,x[S][S]=c-h,o=s;o<g;o++){for(p=0,a=S;a<y;a++)p+=x[a][S]*x[a][o];for(c=p/d,a=S;a<y;a++)x[a][o]=x[a][o]+c*x[a][S]}for(T[S]=h,p=0,o=s;o<g;o++)p+=Math.pow(x[S][o],2);if(p<i)h=0;else{for(d=(c=x[S][S+1])*(h=c<0?Math.sqrt(p):-Math.sqrt(p))-p,x[S][S+1]=c-h,o=s;o<g;o++)b[o]=x[S][o]/d;for(o=s;o<y;o++){for(p=0,a=s;a<g;a++)p+=x[o][a]*x[S][a];for(a=s;a<g;a++)x[o][a]=x[o][a]+p*b[a]}}f<(m=Math.abs(T[S])+Math.abs(b[S]))&&(f=m)}if(r)for(S=g-1;0<=S;S--){if(0!==h){for(d=x[S][S+1]*h,o=s;o<g;o++)w[o][S]=x[S][o]/d;for(o=s;o<g;o++){for(p=0,a=s;a<g;a++)p+=x[S][a]*w[a][o];for(a=s;a<g;a++)w[a][o]=w[a][o]+p*w[a][S]}}for(o=s;o<g;o++)w[S][o]=0,w[o][S]=0;w[S][S]=1,h=b[S],s=S}if(t){if("f"===t)for(S=g;S<y;S++){for(o=g;o<y;o++)x[S][o]=0;x[S][S]=1}for(S=g-1;0<=S;S--){for(s=S+1,h=T[S],o=s;o<_;o++)x[S][o]=0;if(0!==h){for(d=x[S][S]*h,o=s;o<_;o++){for(p=0,a=s;a<y;a++)p+=x[a][S]*x[a][o];for(c=p/d,a=S;a<y;a++)x[a][o]=x[a][o]+c*x[a][S]}for(o=S;o<y;o++)x[o][S]=x[o][S]/h}else for(o=S;o<y;o++)x[o][S]=0;x[S][S]=x[S][S]+1}}for(n*=f,a=g-1;0<=a;a--)for(var E=0;E<50;E++){for(O=!1,s=a;0<=s;s--){if(Math.abs(b[s])<=n){O=!0;break}if(Math.abs(T[s-1])<=n)break}if(!O)for(u=0,l=s-(p=1),S=s;S<a+1&&(c=p*b[S],b[S]=u*b[S],!(Math.abs(c)<=n));S++)if(h=T[S],T[S]=Math.sqrt(c*c+h*h),u=h/(d=T[S]),p=-c/d,t)for(o=0;o<y;o++)m=x[o][l],v=x[o][S],x[o][l]=m*u+v*p,x[o][S]=-m*p+v*u;if(v=T[a],s===a){if(v<0&&(T[a]=-v,r))for(o=0;o<g;o++)w[o][a]=-w[o][a];break}for(f=T[s],c=(((m=T[a-1])-v)*(m+v)+((h=b[a-1])-(d=b[a]))*(h+d))/(2*d*m),h=Math.sqrt(c*c+1),c=((f-v)*(f+v)+d*(m/(c<0?c-h:c+h)-d))/f,S=s+(p=u=1);S<a+1;S++){if(h=b[S],m=T[S],d=p*h,h*=u,v=Math.sqrt(c*c+d*d),c=f*(u=c/(b[S-1]=v))+h*(p=d/v),h=-f*p+h*u,d=m*p,m*=u,r)for(o=0;o<g;o++)f=w[o][S-1],v=w[o][S],w[o][S-1]=f*u+v*p,w[o][S]=-f*p+v*u;if(v=Math.sqrt(c*c+d*d),c=(u=c/(T[S-1]=v))*h+(p=d/v)*m,f=-p*h+u*m,t)for(o=0;o<y;o++)m=x[o][S-1],v=x[o][S],x[o][S-1]=m*u+v*p,x[o][S]=-m*p+v*u}b[s]=0,b[a]=c,T[a]=f}for(S=0;S<g;S++)T[S]<n&&(T[S]=0);return{u:x,q:T,v:w}},e.VERSION="1.1.1",Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof e&&typeof t<"u"?n(e):"function"==typeof define&&define.amd?define(["exports"],n):n((r=typeof globalThis<"u"?globalThis:r||self).SVDJS={})})),je=Re((e=>{!function(){var t=function(){this.init()};t.prototype={init:function(){var e=this||r;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator=typeof window<"u"&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||r;if(e=parseFloat(e),t.ctx||c(),typeof e<"u"&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,r.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var i=t._howls[n]._getSoundIds(),o=0;o<i.length;o++){var a=t._howls[n]._soundById(i[o]);a&&a._node&&(a._node.volume=a._volume*e)}return t}return t._volume},mute:function(e){var t=this||r;t.ctx||c(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,r.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var i=t._howls[n]._getSoundIds(),o=0;o<i.length;o++){var a=t._howls[n]._soundById(i[o]);a&&a._node&&(a._node.muted=!!e||a._muted)}return t},stop:function(){for(var e=this||r,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||r,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&typeof e.ctx.close<"u"&&(e.ctx.close(),e.ctx=null,c()),e},codecs:function(e){return(this||r)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||r;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if(typeof Audio<"u")try{typeof(new Audio).oncanplaythrough>"u"&&(e._canPlayEvent="canplay")}catch{e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch{}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||r,t=null;try{t=typeof Audio<"u"?new Audio:null}catch{return e}if(!t||"function"!=typeof t.canPlayType)return e;var n=t.canPlayType("audio/mpeg;").replace(/^no$/,""),i=e._navigator?e._navigator.userAgent:"",o=i.match(/OPR\/([0-6].)/g),a=o&&parseInt(o[0].split("/")[1],10)<33,s=-1!==i.indexOf("Safari")&&-1===i.indexOf("Chrome"),l=i.match(/Version\/(.*?) /),u=s&&l&&parseInt(l[1],10)<15;return e._codecs={mp3:!(a||!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(u||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(u||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||r;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,!e._mobileUnloaded&&44100!==e.ctx.sampleRate&&(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(r){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,e._releaseHtml5Audio(n)}catch{e.noAudio=!0;break}for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var o=e._howls[i]._getSoundIds(),a=0;a<o.length;a++){var s=e._howls[i]._soundById(o[a]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),typeof l.start>"u"?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var r=0;r<e._howls.length;r++)e._howls[r]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||r;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&typeof Promise<"u"&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){})),new Audio},_releaseHtml5Audio:function(e){var t=this||r;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&!(typeof e.ctx.suspend>"u")&&r.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var n=0;n<e._howls[t]._sounds.length;n++)if(!e._howls[t]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&!(typeof e.ctx.resume>"u")&&r.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var r=new t,n=function(e){e.src&&0!==e.src.length&&this.init(e)};n.prototype={init:function(e){var t=this;return r.ctx||c(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=r.usingWebAudio&&!t._html5,typeof r.ctx<"u"&&r.ctx&&r.autoUnlock&&r._unlockAudio(),r._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(r.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var o,s;if(e._format&&e._format[n])o=e._format[n];else{if("string"!=typeof(s=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(o=/^data:audio\/([^;,]+);/i.exec(s))||(o=/\.([^.]+)$/.exec(s.split("?",1)[0])),o&&(o=o[1].toLowerCase())}if(o&&r.codecs(o)){t=e._src[n];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new i(e),e._webAudio&&a(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var n=this,i=null;if("number"==typeof e)i=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(typeof e>"u"&&(e="__default",!n._playLock)){for(var o=0,a=0;a<n._sounds.length;a++)n._sounds[a]._paused&&!n._sounds[a]._ended&&(o++,i=n._sounds[a]._id);1===o?e=null:i=null}}var s=i?n._soundById(i):n._inactiveSound();if(!s)return null;if(i&&!e&&(e=s._sprite||"__default"),"loaded"!==n._state){s._sprite=e,s._ended=!1;var l=s._id;return n._queue.push({event:"play",action:function(){n.play(l)}}),l}if(i&&!s._paused)return t||n._loadQueue("play"),s._id;n._webAudio&&r._autoResume();var u=Math.max(0,s._seek>0?s._seek:n._sprite[e][0]/1e3),c=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-u),h=1e3*c/Math.abs(s._rate),d=n._sprite[e][0]/1e3,p=(n._sprite[e][0]+n._sprite[e][1])/1e3;s._sprite=e,s._ended=!1;var f=function(){s._paused=!1,s._seek=u,s._start=d,s._stop=p,s._loop=!(!s._loop&&!n._sprite[e][2])};if(!(u>=p)){var m=s._node;if(n._webAudio){var v=function(){n._playLock=!1,f(),n._refreshBuffer(s);var e=s._muted||n._muted?0:s._volume;m.gain.setValueAtTime(e,r.ctx.currentTime),s._playStart=r.ctx.currentTime,typeof m.bufferSource.start>"u"?s._loop?m.bufferSource.noteGrainOn(0,u,86400):m.bufferSource.noteGrainOn(0,u,c):s._loop?m.bufferSource.start(0,u,86400):m.bufferSource.start(0,u,c),h!==1/0&&(n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),h)),t||setTimeout((function(){n._emit("play",s._id),n._loadQueue()}),0)};"running"===r.state&&"interrupted"!==r.ctx.state?v():(n._playLock=!0,n.once("resume",v),n._clearTimer(s._id))}else{var g=function(){m.currentTime=u,m.muted=s._muted||n._muted||r._muted||m.muted,m.volume=s._volume*r.volume(),m.playbackRate=s._rate;try{var i=m.play();if(i&&typeof Promise<"u"&&(i instanceof Promise||"function"==typeof i.then)?(n._playLock=!0,f(),i.then((function(){n._playLock=!1,m._unlocked=!0,t?n._loadQueue():n._emit("play",s._id)})).catch((function(){n._playLock=!1,n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0}))):t||(n._playLock=!1,f(),n._emit("play",s._id)),m.playbackRate=s._rate,m.paused)return void n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||s._loop?n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),h):(n._endTimers[s._id]=function(){n._ended(s),m.removeEventListener("ended",n._endTimers[s._id],!1)},m.addEventListener("ended",n._endTimers[s._id],!1))}catch(o){n._emit("playerror",s._id,o)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===m.src&&(m.src=n._src,m.load());var y=window&&window.ejecta||!m.readyState&&r._navigator.isCocoonJS;if(m.readyState>=3||y)g();else{n._playLock=!0,n._state="loading";var b=function(){n._state="loaded",g(),m.removeEventListener(r._canPlayEvent,b,!1)};m.addEventListener(r._canPlayEvent,b,!1),n._clearTimer(s._id)}}return s._id}n._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var r=t._getSoundIds(e),n=0;n<r.length;n++){t._clearTimer(r[n]);var i=t._soundById(r[n]);if(i&&!i._paused&&(i._seek=t.seek(r[n]),i._rateSeek=0,i._paused=!0,t._stopFade(r[n]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;typeof i._node.bufferSource.stop>"u"?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else(!isNaN(i._node.duration)||i._node.duration===1/0)&&i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"stop",action:function(){r.stop(e)}}),r;for(var n=r._getSoundIds(e),i=0;i<n.length;i++){r._clearTimer(n[i]);var o=r._soundById(n[i]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,r._stopFade(n[i]),o._node&&(r._webAudio?o._node.bufferSource&&(typeof o._node.bufferSource.stop>"u"?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),r._cleanBuffer(o._node)):(!isNaN(o._node.duration)||o._node.duration===1/0)&&(o._node.currentTime=o._start||0,o._node.pause(),o._node.duration===1/0&&r._clearSound(o._node))),t||r._emit("stop",o._id))}return r},mute:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(typeof t>"u"){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var i=n._getSoundIds(t),o=0;o<i.length;o++){var a=n._soundById(i[o]);a&&(a._muted=e,a._interval&&n._stopFade(a._id),n._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,r.ctx.currentTime):a._node&&(a._node.muted=!!r._muted||e),n._emit("mute",a._id))}return n},volume:function(){var e,t,n,i=this,o=arguments;if(0===o.length)return i._volume;1===o.length||2===o.length&&typeof o[1]>"u"?i._getSoundIds().indexOf(o[0])>=0?t=parseInt(o[0],10):e=parseFloat(o[0]):o.length>=2&&(e=parseFloat(o[0]),t=parseInt(o[1],10));if(!(typeof e<"u"&&e>=0&&e<=1))return(n=t?i._soundById(t):i._sounds[0])?n._volume:0;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,o)}}),i;typeof t>"u"&&(i._volume=e),t=i._getSoundIds(t);for(var a=0;a<t.length;a++)(n=i._soundById(t[a]))&&(n._volume=e,o[2]||i._stopFade(t[a]),i._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,r.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*r.volume()),i._emit("volume",n._id));return i},fade:function(e,t,n,i){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"fade",action:function(){o.fade(e,t,n,i)}}),o;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),n=parseFloat(n),o.volume(e,i);for(var a=o._getSoundIds(i),s=0;s<a.length;s++){var l=o._soundById(a[s]);if(l){if(i||o._stopFade(a[s]),o._webAudio&&!l._muted){var u=r.ctx.currentTime,c=u+n/1e3;l._volume=e,l._node.gain.setValueAtTime(e,u),l._node.gain.linearRampToValueAtTime(t,c)}o._startFadeInterval(l,e,t,n,a[s],typeof i>"u")}}return o},_startFadeInterval:function(e,t,r,n,i,o){var a=this,s=t,l=r-t,u=Math.abs(l/.01),c=Math.max(4,u>0?n/u:n),h=Date.now();e._fadeTo=r,e._interval=setInterval((function(){var i=(Date.now()-h)/n;h=Date.now(),s+=l*i,s=Math.round(100*s)/100,s=l<0?Math.max(r,s):Math.min(r,s),a._webAudio?e._volume=s:a.volume(s,e._id,!0),o&&(a._volume=s),(r<t&&s<=r||r>t&&s>=r)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,a.volume(r,e._id),a._emit("fade",e._id))}),c)},_stopFade:function(e){var t=this,n=t._soundById(e);return n&&n._interval&&(t._webAudio&&n._node.gain.cancelScheduledValues(r.ctx.currentTime),clearInterval(n._interval),n._interval=null,t.volume(n._fadeTo,e),n._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(r=n._soundById(parseInt(i[0],10)))&&r._loop;e=i[0],n._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var o=n._getSoundIds(t),a=0;a<o.length;a++)(r=n._soundById(o[a]))&&(r._loop=e,n._webAudio&&r._node&&r._node.bufferSource&&(r._node.bufferSource.loop=e,e&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop,n.playing(o[a])&&(n.pause(o[a],!0),n.play(o[a],!0)))));return n},rate:function(){var e,t,n,i=this,o=arguments;if(0===o.length)t=i._sounds[0]._id;else if(1===o.length){i._getSoundIds().indexOf(o[0])>=0?t=parseInt(o[0],10):e=parseFloat(o[0])}else 2===o.length&&(e=parseFloat(o[0]),t=parseInt(o[1],10));if("number"!=typeof e)return(n=i._soundById(t))?n._rate:i._rate;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,o)}}),i;typeof t>"u"&&(i._rate=e),t=i._getSoundIds(t);for(var a=0;a<t.length;a++)if(n=i._soundById(t[a])){i.playing(t[a])&&(n._rateSeek=i.seek(t[a]),n._playStart=i._webAudio?r.ctx.currentTime:n._playStart),n._rate=e,i._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,r.ctx.currentTime):n._node&&(n._node.playbackRate=e);var s=i.seek(t[a]),l=1e3*((i._sprite[n._sprite][0]+i._sprite[n._sprite][1])/1e3-s)/Math.abs(n._rate);(i._endTimers[t[a]]||!n._paused)&&(i._clearTimer(t[a]),i._endTimers[t[a]]=setTimeout(i._ended.bind(i,n),l)),i._emit("rate",n._id)}return i},seek:function(){var e,t,n=this,i=arguments;if(0===i.length)n._sounds.length&&(t=n._sounds[0]._id);else if(1===i.length){n._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(i[0]))}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if(typeof t>"u")return 0;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,i)}}),n;var o=n._soundById(t);if(o){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var a=n.playing(t)?r.ctx.currentTime-o._playStart:0,s=o._rateSeek?o._rateSeek-o._seek:0;return o._seek+(s+a*Math.abs(o._rate))}return o._node.currentTime}var l=n.playing(t);l&&n.pause(t,!0),o._seek=e,o._ended=!1,n._clearTimer(t),!n._webAudio&&o._node&&!isNaN(o._node.duration)&&(o._node.currentTime=e);var u=function(){l&&n.play(t,!0),n._emit("seek",t)};if(l&&!n._webAudio){var c=function(){n._playLock?setTimeout(c,0):u()};setTimeout(c,0)}else u()}return n},playing:function(e){var t=this;if("number"==typeof e){var r=t._soundById(e);return!!r&&!r._paused}for(var n=0;n<t._sounds.length;n++)if(!t._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this,r=t._duration,n=t._soundById(e);return n&&(r=t._sprite[n._sprite][1]/1e3),r},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++)t[n]._paused||e.stop(t[n]._id),e._webAudio||(e._clearSound(t[n]._node),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(r._canPlayEvent,t[n]._loadFn,!1),t[n]._node.removeEventListener("ended",t[n]._endFn,!1),r._releaseHtml5Audio(t[n]._node)),delete t[n]._node,e._clearTimer(t[n]._id);var i=r._howls.indexOf(e);i>=0&&r._howls.splice(i,1);var a=!0;for(n=0;n<r._howls.length;n++)if(r._howls[n]._src===e._src||e._src.indexOf(r._howls[n]._src)>=0){a=!1;break}return o&&a&&delete o[e._src],r.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,r,n){var i=this["_on"+e];return"function"==typeof t&&i.push(n?{id:r,fn:t,once:n}:{id:r,fn:t}),this},off:function(e,t,r){var n=this,i=n["_on"+e],o=0;if("number"==typeof t&&(r=t,t=null),t||r)for(o=0;o<i.length;o++){var a=r===i[o].id;if(t===i[o].fn&&a||!t&&a){i.splice(o,1);break}}else if(e)n["_on"+e]=[];else{var s=Object.keys(n);for(o=0;o<s.length;o++)0===s[o].indexOf("_on")&&Array.isArray(n[s[o]])&&(n[s[o]]=[])}return n},once:function(e,t,r){return this.on(e,t,r,1),this},_emit:function(e,t,r){for(var n=this,i=n["_on"+e],o=i.length-1;o>=0;o--)(!i[o].id||i[o].id===t||"load"===e)&&(setTimeout(function(e){e.call(this,t,r)}.bind(n,i[o].fn),0),i[o].once&&n.off(e,i[o].fn,i[o].id));return n._loadQueue(e),n},_loadQueue:function(e){var t=this;if(t._queue.length>0){var r=t._queue[0];r.event===e&&(t._queue.shift(),t._loadQueue()),e||r.action()}return t},_ended:function(e){var t=this,n=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var i=!(!e._loop&&!t._sprite[n][2]);if(t._emit("end",e._id),!t._webAudio&&i&&t.stop(e._id,!0).play(e._id),t._webAudio&&i){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=r.ctx.currentTime;var o=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),o)}return t._webAudio&&!i&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),r._autoSuspend()),!t._webAudio&&!i&&t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var r=t._soundById(e);r&&r._node&&r._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,r=0;r<t._sounds.length;r++)if(e===t._sounds[r]._id)return t._sounds[r];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new i(e)},_drain:function(){var e=this,t=e._pool,r=0,n=0;if(!(e._sounds.length<t)){for(n=0;n<e._sounds.length;n++)e._sounds[n]._ended&&r++;for(n=e._sounds.length-1;n>=0;n--){if(r<=t)return;e._sounds[n]._ended&&(e._webAudio&&e._sounds[n]._node&&e._sounds[n]._node.disconnect(0),e._sounds.splice(n,1),r--)}}},_getSoundIds:function(e){if(typeof e>"u"){for(var t=[],r=0;r<this._sounds.length;r++)t.push(this._sounds[r]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=r.ctx.createBufferSource(),e._node.bufferSource.buffer=o[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,r.ctx.currentTime),this},_cleanBuffer:function(e){var t=r._navigator&&r._navigator.vendor.indexOf("Apple")>=0;if(r._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=r._scratchBuffer}catch{}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(r._navigator&&r._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(e){this._parent=e,this.init()};i.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++r._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,n=r._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=typeof r.ctx.createGain>"u"?r.ctx.createGainNode():r.ctx.createGain(),e._node.gain.setValueAtTime(n,r.ctx.currentTime),e._node.paused=!0,e._node.connect(r.masterGain)):r.noAudio||(e._node=r._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(r._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=n*r.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++r._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(r._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var o={},a=function(e){var t=e._src;if(o[t])return e._duration=o[t].duration,void u(e);if(/^data:[^;]+;base64,/.test(t)){for(var r=atob(t.split(",")[1]),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);l(n.buffer,e)}else{var a=new XMLHttpRequest;a.open(e._xhr.method,t,!0),a.withCredentials=e._xhr.withCredentials,a.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){a.setRequestHeader(t,e._xhr.headers[t])})),a.onload=function(){var t=(a.status+"")[0];"0"===t||"2"===t||"3"===t?l(a.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".")},a.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete o[t],e.load())},s(a)}},s=function(e){try{e.send()}catch{e.onerror()}},l=function(e,t){var n=function(){t._emit("loaderror",null,"Decoding audio data failed.")},i=function(e){e&&t._sounds.length>0?(o[t._src]=e,u(t,e)):n()};typeof Promise<"u"&&1===r.ctx.decodeAudioData.length?r.ctx.decodeAudioData(e).then(i).catch(n):r.ctx.decodeAudioData(e,i,n)},u=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},c=function(){if(r.usingWebAudio){try{typeof AudioContext<"u"?r.ctx=new AudioContext:typeof webkitAudioContext<"u"?r.ctx=new webkitAudioContext:r.usingWebAudio=!1}catch{r.usingWebAudio=!1}r.ctx||(r.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(r._navigator&&r._navigator.platform),t=r._navigator&&r._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=t?parseInt(t[1],10):null;if(e&&n&&n<9){var i=/safari/.test(r._navigator&&r._navigator.userAgent.toLowerCase());r._navigator&&!i&&(r.usingWebAudio=!1)}r.usingWebAudio&&(r.masterGain=typeof r.ctx.createGain>"u"?r.ctx.createGainNode():r.ctx.createGain(),r.masterGain.gain.setValueAtTime(r._muted?0:r._volume,r.ctx.currentTime),r.masterGain.connect(r.ctx.destination)),r._setup()}};"function"==typeof define&&define.amd&&define([],(function(){return{Howler:r,Howl:n}})),typeof e<"u"&&(e.Howler=r,e.Howl=n),typeof global<"u"?(global.HowlerGlobal=t,global.Howler=r,global.Howl=n,global.Sound=i):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=r,window.Howl=n,window.Sound=i)}(),function(){var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var r=t._howls.length-1;r>=0;r--)t._howls[r].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,r){var n=this;return n.ctx&&n.ctx.listener?(t="number"!=typeof t?n._pos[1]:t,r="number"!=typeof r?n._pos[2]:r,"number"!=typeof e?n._pos:(n._pos=[e,t,r],typeof n.ctx.listener.positionX<"u"?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]),n)):n},HowlerGlobal.prototype.orientation=function(e,t,r,n,i,o){var a=this;if(!a.ctx||!a.ctx.listener)return a;var s=a._orientation;return t="number"!=typeof t?s[1]:t,r="number"!=typeof r?s[2]:r,n="number"!=typeof n?s[3]:n,i="number"!=typeof i?s[4]:i,o="number"!=typeof o?s[5]:o,"number"!=typeof e?s:(a._orientation=[e,t,r,n,i,o],typeof a.ctx.listener.forwardX<"u"?(a.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(i,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(e,t,r,n,i,o),a)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var r=this;return r._orientation=t.orientation||[1,0,0],r._stereo=t.stereo||null,r._pos=t.pos||null,r._pannerAttr={coneInnerAngle:typeof t.coneInnerAngle<"u"?t.coneInnerAngle:360,coneOuterAngle:typeof t.coneOuterAngle<"u"?t.coneOuterAngle:360,coneOuterGain:typeof t.coneOuterGain<"u"?t.coneOuterGain:0,distanceModel:typeof t.distanceModel<"u"?t.distanceModel:"inverse",maxDistance:typeof t.maxDistance<"u"?t.maxDistance:1e4,panningModel:typeof t.panningModel<"u"?t.panningModel:"HRTF",refDistance:typeof t.refDistance<"u"?t.refDistance:1,rolloffFactor:typeof t.rolloffFactor<"u"?t.rolloffFactor:1},r._onstereo=t.onstereo?[{fn:t.onstereo}]:[],r._onpos=t.onpos?[{fn:t.onpos}]:[],r._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,r)}}),n;var i=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u"){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var o=n._getSoundIds(r),a=0;a<o.length;a++){var s=n._soundById(o[a]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",(!s._panner||!s._panner.pan)&&t(s,i),"spatial"===i?typeof s._panner.positionX<"u"?(s._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",s._id)}}return n},Howl.prototype.pos=function(e,r,n,i){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"pos",action:function(){o.pos(e,r,n,i)}}),o;if(r="number"!=typeof r?0:r,n="number"!=typeof n?-.5:n,typeof i>"u"){if("number"!=typeof e)return o._pos;o._pos=[e,r,n]}for(var a=o._getSoundIds(i),s=0;s<a.length;s++){var l=o._soundById(a[s]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,r,n],l._node&&((!l._panner||l._panner.pan)&&t(l,"spatial"),typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setPosition(e,r,n)),o._emit("pos",l._id)}}return o},Howl.prototype.orientation=function(e,r,n,i){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"orientation",action:function(){o.orientation(e,r,n,i)}}),o;if(r="number"!=typeof r?o._orientation[1]:r,n="number"!=typeof n?o._orientation[2]:n,typeof i>"u"){if("number"!=typeof e)return o._orientation;o._orientation=[e,r,n]}for(var a=o._getSoundIds(i),s=0;s<a.length;s++){var l=o._soundById(a[s]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,r,n],l._node&&(l._panner||(l._pos||(l._pos=o._pos||[0,0,-.5]),t(l,"spatial")),typeof l._panner.orientationX<"u"?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setOrientation(e,r,n)),o._emit("orientation",l._id)}}return o},Howl.prototype.pannerAttr=function(){var e,r,n,i=this,o=arguments;if(!i._webAudio)return i;if(0===o.length)return i._pannerAttr;if(1===o.length){if("object"!=typeof o[0])return(n=i._soundById(parseInt(o[0],10)))?n._pannerAttr:i._pannerAttr;e=o[0],typeof r>"u"&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:typeof e.pannerAttr.coneInnerAngle<"u"?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof e.pannerAttr.coneOuterAngle<"u"?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof e.pannerAttr.coneOuterGain<"u"?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof e.pannerAttr.distanceModel<"u"?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof e.pannerAttr.maxDistance<"u"?e.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof e.pannerAttr.refDistance<"u"?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof e.pannerAttr.rolloffFactor<"u"?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof e.pannerAttr.panningModel<"u"?e.pannerAttr.panningModel:i._panningModel})}else 2===o.length&&(e=o[0],r=parseInt(o[1],10));for(var a=i._getSoundIds(r),s=0;s<a.length;s++)if(n=i._soundById(a[s])){var l=n._pannerAttr;l={coneInnerAngle:typeof e.coneInnerAngle<"u"?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:typeof e.coneOuterAngle<"u"?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:typeof e.coneOuterGain<"u"?e.coneOuterGain:l.coneOuterGain,distanceModel:typeof e.distanceModel<"u"?e.distanceModel:l.distanceModel,maxDistance:typeof e.maxDistance<"u"?e.maxDistance:l.maxDistance,refDistance:typeof e.refDistance<"u"?e.refDistance:l.refDistance,rolloffFactor:typeof e.rolloffFactor<"u"?e.rolloffFactor:l.rolloffFactor,panningModel:typeof e.panningModel<"u"?e.panningModel:l.panningModel};var u=n._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(n._pos||(n._pos=i._pos||[0,0,-.5]),t(n,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this,r=t._parent;t._orientation=r._orientation,t._stereo=r._stereo,t._pos=r._pos,t._pannerAttr=r._pannerAttr,e.call(this),t._stereo?r.stereo(t._stereo):t._pos&&r.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,r=t._parent;return t._orientation=r._orientation,t._stereo=r._stereo,t._pos=r._pos,t._pannerAttr=r._pannerAttr,t._stereo?r.stereo(t._stereo):t._pos?r.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,r._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()})),Ge=Re(((e,t)=>{t.exports=function(e,t){for(var r=e.split("."),n=t.split("."),i=0;i<3;i++){var o=Number(r[i]),a=Number(n[i]);if(o>a)return 1;if(a>o)return-1;if(!isNaN(o)&&isNaN(a))return 1;if(isNaN(o)&&!isNaN(a))return-1}return 0}}));function Ve(e,t){return Object.setPrototypeOf(e,t),e}function He(e){return Array.isArray(e)?e:[e]}var We="object"==typeof global&&global&&global.Object===Object&&global,qe="object"==typeof self&&self&&self.Object===Object&&self,$e=We||qe||Function("return this")(),Xe=$e.Symbol,Ye=Object.prototype,Ze=Ye.hasOwnProperty,Ke=Ye.toString,Qe=Xe?Xe.toStringTag:void 0;var Je=function(e){var t=Ze.call(e,Qe),r=e[Qe];try{e[Qe]=void 0;var n=!0}catch{}var i=Ke.call(e);return n&&(t?e[Qe]=r:delete e[Qe]),i},et=Object.prototype.toString;var tt=function(e){return et.call(e)},rt=Xe?Xe.toStringTag:void 0;var nt=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":rt&&rt in Object(e)?Je(e):tt(e)};var it=function(e){return null!=e&&"object"==typeof e};var ot=function(e){return"symbol"==typeof e||it(e)&&"[object Symbol]"==nt(e)};var at=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i},st=Array.isArray,lt=Xe?Xe.prototype:void 0,ut=lt?lt.toString:void 0;var ct=function e(t){if("string"==typeof t)return t;if(st(t))return at(t,e)+"";if(ot(t))return ut?ut.call(t):"";var r=t+"";return"0"==r&&1/t==-Infinity?"-0":r};var ht=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var dt=function(e){return e};var pt,ft=function(e){if(!ht(e))return!1;var t=nt(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},mt=$e["__core-js_shared__"],vt=(pt=/[^.]+$/.exec(mt&&mt.keys&&mt.keys.IE_PROTO||""))?"Symbol(src)_1."+pt:"";var gt=function(e){return!!vt&&vt in e},yt=Function.prototype.toString;var bt=function(e){if(null!=e){try{return yt.call(e)}catch{}try{return e+""}catch{}}return""},xt=/^\[object .+?Constructor\]$/,wt=Function.prototype,_t=Object.prototype,St=wt.toString,Ot=_t.hasOwnProperty,Tt=RegExp("^"+St.call(Ot).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Et=function(e){return!(!ht(e)||gt(e))&&(ft(e)?Tt:xt).test(bt(e))};var Ct=function(e,t){return null==e?void 0:e[t]};var At=function(e,t){var r=Ct(e,t);return Et(r)?r:void 0},Mt=At($e,"WeakMap"),Dt=Object.create,Pt=function(){function e(){}return function(t){if(!ht(t))return{};if(Dt)return Dt(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),kt=Pt;var Lt=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)};var Ut=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t},It=Date.now;var zt=function(e){var t=0,r=0;return function(){var n=It(),i=16-(n-r);if(r=n,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}};var Rt=function(e){return function(){return e}},Nt=function(){try{var e=At(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Bt=Nt,Ft=Bt?function(e,t){return Bt(e,"toString",{configurable:!0,enumerable:!1,value:Rt(t),writable:!0})}:dt,jt=zt(Ft);var Gt=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e},Vt=/^(?:0|[1-9]\d*)$/;var Ht=function(e,t){var r=typeof e;return!!(t=t??9007199254740991)&&("number"==r||"symbol"!=r&&Vt.test(e))&&e>-1&&e%1==0&&e<t};var Wt=function(e,t,r){"__proto__"==t&&Bt?Bt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r};var qt=function(e,t){return e===t||e!=e&&t!=t},$t=Object.prototype.hasOwnProperty;var Xt=function(e,t,r){var n=e[t];(!$t.call(e,t)||!qt(n,r)||void 0===r&&!(t in e))&&Wt(e,t,r)};var Yt=function(e,t,r,n){var i=!r;r||(r={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=n?n(r[s],e[s],s,r,e):void 0;void 0===l&&(l=e[s]),i?Wt(r,s,l):Xt(r,s,l)}return r},Zt=Math.max;var Kt=function(e,t,r){return t=Zt(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=Zt(n.length-t,0),a=Array(o);++i<o;)a[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(a),Lt(e,this,s)}};var Qt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Jt=function(e){return null!=e&&Qt(e.length)&&!ft(e)},er=Object.prototype;var tr=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||er)};var rr=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var nr=function(e){return it(e)&&"[object Arguments]"==nt(e)},ir=Object.prototype,or=ir.hasOwnProperty,ar=ir.propertyIsEnumerable,sr=nr(function(){return arguments}())?nr:function(e){return it(e)&&or.call(e,"callee")&&!ar.call(e,"callee")},lr=sr;var ur=function(){return!1},cr="object"==typeof exports&&exports&&!exports.nodeType&&exports,hr=cr&&"object"==typeof module&&module&&!module.nodeType&&module,dr=hr&&hr.exports===cr?$e.Buffer:void 0,pr=(dr?dr.isBuffer:void 0)||ur,fr={};fr["[object Float32Array]"]=fr["[object Float64Array]"]=fr["[object Int8Array]"]=fr["[object Int16Array]"]=fr["[object Int32Array]"]=fr["[object Uint8Array]"]=fr["[object Uint8ClampedArray]"]=fr["[object Uint16Array]"]=fr["[object Uint32Array]"]=!0,fr["[object Arguments]"]=fr["[object Array]"]=fr["[object ArrayBuffer]"]=fr["[object Boolean]"]=fr["[object DataView]"]=fr["[object Date]"]=fr["[object Error]"]=fr["[object Function]"]=fr["[object Map]"]=fr["[object Number]"]=fr["[object Object]"]=fr["[object RegExp]"]=fr["[object Set]"]=fr["[object String]"]=fr["[object WeakMap]"]=!1;var mr=function(e){return it(e)&&Qt(e.length)&&!!fr[nt(e)]};var vr=function(e){return function(t){return e(t)}},gr="object"==typeof exports&&exports&&!exports.nodeType&&exports,yr=gr&&"object"==typeof module&&module&&!module.nodeType&&module,br=yr&&yr.exports===gr&&We.process,xr=function(){try{return yr&&yr.require&&yr.require("util").types||br&&br.binding&&br.binding("util")}catch{}}(),wr=xr&&xr.isTypedArray,_r=wr?vr(wr):mr,Sr=Object.prototype.hasOwnProperty;var Or=function(e,t){var r=st(e),n=!r&&lr(e),i=!r&&!n&&pr(e),o=!r&&!n&&!i&&_r(e),a=r||n||i||o,s=a?rr(e.length,String):[],l=s.length;for(var u in e)(t||Sr.call(e,u))&&(!a||!("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Ht(u,l)))&&s.push(u);return s};var Tr=function(e,t){return function(r){return e(t(r))}},Er=Tr(Object.keys,Object),Cr=Object.prototype.hasOwnProperty;var Ar=function(e){if(!tr(e))return Er(e);var t=[];for(var r in Object(e))Cr.call(e,r)&&"constructor"!=r&&t.push(r);return t};var Mr=function(e){return Jt(e)?Or(e):Ar(e)};var Dr=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},Pr=Object.prototype.hasOwnProperty;var kr=function(e){if(!ht(e))return Dr(e);var t=tr(e),r=[];for(var n in e)"constructor"==n&&(t||!Pr.call(e,n))||r.push(n);return r};var Lr=function(e){return Jt(e)?Or(e,!0):kr(e)},Ur=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ir=/^\w*$/;var zr=function(e,t){if(st(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!ot(e))||(Ir.test(e)||!Ur.test(e)||null!=t&&e in Object(t))},Rr=At(Object,"create");var Nr=function(){this.__data__=Rr?Rr(null):{},this.size=0};var Br=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Fr=Object.prototype.hasOwnProperty;var jr=function(e){var t=this.__data__;if(Rr){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Fr.call(t,e)?t[e]:void 0},Gr=Object.prototype.hasOwnProperty;var Vr=function(e){var t=this.__data__;return Rr?void 0!==t[e]:Gr.call(t,e)};var Hr=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Rr&&void 0===t?"__lodash_hash_undefined__":t,this};function Wr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Wr.prototype.clear=Nr,Wr.prototype.delete=Br,Wr.prototype.get=jr,Wr.prototype.has=Vr,Wr.prototype.set=Hr;var qr=Wr;var $r=function(){this.__data__=[],this.size=0};var Xr=function(e,t){for(var r=e.length;r--;)if(qt(e[r][0],t))return r;return-1},Yr=Array.prototype.splice;var Zr=function(e){var t=this.__data__,r=Xr(t,e);return!(r<0)&&(r==t.length-1?t.pop():Yr.call(t,r,1),--this.size,!0)};var Kr=function(e){var t=this.__data__,r=Xr(t,e);return r<0?void 0:t[r][1]};var Qr=function(e){return Xr(this.__data__,e)>-1};var Jr=function(e,t){var r=this.__data__,n=Xr(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function en(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}en.prototype.clear=$r,en.prototype.delete=Zr,en.prototype.get=Kr,en.prototype.has=Qr,en.prototype.set=Jr;var tn=en,rn=At($e,"Map");var nn=function(){this.size=0,this.__data__={hash:new qr,map:new(rn||tn),string:new qr}};var on=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var an=function(e,t){var r=e.__data__;return on(t)?r["string"==typeof t?"string":"hash"]:r.map};var sn=function(e){var t=an(this,e).delete(e);return this.size-=t?1:0,t};var ln=function(e){return an(this,e).get(e)};var un=function(e){return an(this,e).has(e)};var cn=function(e,t){var r=an(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function hn(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}hn.prototype.clear=nn,hn.prototype.delete=sn,hn.prototype.get=ln,hn.prototype.has=un,hn.prototype.set=cn;var dn=hn;function pn(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a)||o,a};return r.cache=new(pn.Cache||dn),r}pn.Cache=dn;var fn=pn;var mn=function(e){var t=fn(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t},vn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gn=/\\(\\)?/g,yn=mn((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(vn,(function(e,r,n,i){t.push(n?i.replace(gn,"$1"):r||e)})),t})),bn=yn;var xn=function(e){return null==e?"":ct(e)};var wn=function(e,t){return st(e)?e:zr(e,t)?[e]:bn(xn(e))};var _n=function(e){if("string"==typeof e||ot(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t};var Sn=function(e,t){for(var r=0,n=(t=wn(t,e)).length;null!=e&&r<n;)e=e[_n(t[r++])];return r&&r==n?e:void 0};var On=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e},Tn=Xe?Xe.isConcatSpreadable:void 0;var En=function(e){return st(e)||lr(e)||!!(Tn&&e&&e[Tn])};var Cn=function e(t,r,n,i,o){var a=-1,s=t.length;for(n||(n=En),o||(o=[]);++a<s;){var l=t[a];r>0&&n(l)?r>1?e(l,r-1,n,i,o):On(o,l):i||(o[o.length]=l)}return o};var An=function(e){return(null==e?0:e.length)?Cn(e,1):[]};var Mn=function(e){return jt(Kt(e,void 0,An),e+"")},Dn=Tr(Object.getPrototypeOf,Object),Pn=Function.prototype,kn=Object.prototype,Ln=Pn.toString,Un=kn.hasOwnProperty,In=Ln.call(Object);var zn=function(e){if(!it(e)||"[object Object]"!=nt(e))return!1;var t=Dn(e);if(null===t)return!0;var r=Un.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Ln.call(r)==In};var Rn=function(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(i);++n<i;)o[n]=e[n+t];return o};var Nn=function(){this.__data__=new tn,this.size=0};var Bn=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var Fn=function(e){return this.__data__.get(e)};var jn=function(e){return this.__data__.has(e)};var Gn=function(e,t){var r=this.__data__;if(r instanceof tn){var n=r.__data__;if(!rn||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new dn(n)}return r.set(e,t),this.size=r.size,this};function Vn(e){var t=this.__data__=new tn(e);this.size=t.size}Vn.prototype.clear=Nn,Vn.prototype.delete=Bn,Vn.prototype.get=Fn,Vn.prototype.has=jn,Vn.prototype.set=Gn;var Hn=Vn;var Wn=function(e,t){return e&&Yt(t,Mr(t),e)};var qn=function(e,t){return e&&Yt(t,Lr(t),e)},$n="object"==typeof exports&&exports&&!exports.nodeType&&exports,Xn=$n&&"object"==typeof module&&module&&!module.nodeType&&module,Yn=Xn&&Xn.exports===$n?$e.Buffer:void 0,Zn=Yn?Yn.allocUnsafe:void 0;var Kn=function(e,t){if(t)return e.slice();var r=e.length,n=Zn?Zn(r):new e.constructor(r);return e.copy(n),n};var Qn=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o};var Jn=function(){return[]},ei=Object.prototype.propertyIsEnumerable,ti=Object.getOwnPropertySymbols,ri=ti?function(e){return null==e?[]:(e=Object(e),Qn(ti(e),(function(t){return ei.call(e,t)})))}:Jn,ni=ri;var ii=function(e,t){return Yt(e,ni(e),t)},oi=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)On(t,ni(e)),e=Dn(e);return t}:Jn,ai=oi;var si=function(e,t){return Yt(e,ai(e),t)};var li=function(e,t,r){var n=t(e);return st(e)?n:On(n,r(e))};var ui=function(e){return li(e,Mr,ni)};var ci=function(e){return li(e,Lr,ai)},hi=At($e,"DataView"),di=At($e,"Promise"),pi=At($e,"Set"),fi="[object Map]",mi="[object Promise]",vi="[object Set]",gi="[object WeakMap]",yi="[object DataView]",bi=bt(hi),xi=bt(rn),wi=bt(di),_i=bt(pi),Si=bt(Mt),Oi=nt;(hi&&Oi(new hi(new ArrayBuffer(1)))!=yi||rn&&Oi(new rn)!=fi||di&&Oi(di.resolve())!=mi||pi&&Oi(new pi)!=vi||Mt&&Oi(new Mt)!=gi)&&(Oi=function(e){var t=nt(e),r="[object Object]"==t?e.constructor:void 0,n=r?bt(r):"";if(n)switch(n){case bi:return yi;case xi:return fi;case wi:return mi;case _i:return vi;case Si:return gi}return t});var Ti=Oi,Ei=Object.prototype.hasOwnProperty;var Ci=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Ei.call(e,"index")&&(r.index=e.index,r.input=e.input),r},Ai=$e.Uint8Array;var Mi=function(e){var t=new e.constructor(e.byteLength);return new Ai(t).set(new Ai(e)),t};var Di=function(e,t){var r=t?Mi(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},Pi=/\w*$/;var ki=function(e){var t=new e.constructor(e.source,Pi.exec(e));return t.lastIndex=e.lastIndex,t},Li=Xe?Xe.prototype:void 0,Ui=Li?Li.valueOf:void 0;var Ii=function(e){return Ui?Object(Ui.call(e)):{}};var zi=function(e,t){var r=t?Mi(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)};var Ri=function(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return Mi(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return Di(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return zi(e,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return ki(e);case"[object Symbol]":return Ii(e)}};var Ni=function(e){return"function"!=typeof e.constructor||tr(e)?{}:kt(Dn(e))};var Bi=function(e){return it(e)&&"[object Map]"==Ti(e)},Fi=xr&&xr.isMap,ji=Fi?vr(Fi):Bi;var Gi=function(e){return it(e)&&"[object Set]"==Ti(e)},Vi=xr&&xr.isSet,Hi=Vi?vr(Vi):Gi,Wi="[object Arguments]",qi="[object Function]",$i="[object Object]",Xi={};Xi[Wi]=Xi["[object Array]"]=Xi["[object ArrayBuffer]"]=Xi["[object DataView]"]=Xi["[object Boolean]"]=Xi["[object Date]"]=Xi["[object Float32Array]"]=Xi["[object Float64Array]"]=Xi["[object Int8Array]"]=Xi["[object Int16Array]"]=Xi["[object Int32Array]"]=Xi["[object Map]"]=Xi["[object Number]"]=Xi[$i]=Xi["[object RegExp]"]=Xi["[object Set]"]=Xi["[object String]"]=Xi["[object Symbol]"]=Xi["[object Uint8Array]"]=Xi["[object Uint8ClampedArray]"]=Xi["[object Uint16Array]"]=Xi["[object Uint32Array]"]=!0,Xi["[object Error]"]=Xi[qi]=Xi["[object WeakMap]"]=!1;var Yi=function e(t,r,n,i,o,a){var s,l=1&r,u=2&r,c=4&r;if(n&&(s=o?n(t,i,o,a):n(t)),void 0!==s)return s;if(!ht(t))return t;var h=st(t);if(h){if(s=Ci(t),!l)return Ut(t,s)}else{var d=Ti(t),p=d==qi||"[object GeneratorFunction]"==d;if(pr(t))return Kn(t,l);if(d==$i||d==Wi||p&&!o){if(s=u||p?{}:Ni(t),!l)return u?si(t,qn(s,t)):ii(t,Wn(s,t))}else{if(!Xi[d])return o?t:{};s=Ri(t,d,l)}}a||(a=new Hn);var f=a.get(t);if(f)return f;a.set(t,s),Hi(t)?t.forEach((function(i){s.add(e(i,r,n,i,t,a))})):ji(t)&&t.forEach((function(i,o){s.set(o,e(i,r,n,o,t,a))}));var m=h?void 0:(c?u?ci:ui:u?Lr:Mr)(t);return Gt(m||t,(function(i,o){m&&(i=t[o=i]),Xt(s,o,e(i,r,n,o,t,a))})),s};var Zi=function(e){return Yi(e,5)};var Ki=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Qi=function(e){return this.__data__.has(e)};function Ji(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new dn;++t<r;)this.add(e[t])}Ji.prototype.add=Ji.prototype.push=Ki,Ji.prototype.has=Qi;var eo=Ji;var to=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var ro=function(e,t){return e.has(t)};var no=function(e,t,r,n,i,o){var a=1&r,s=e.length,l=t.length;if(s!=l&&!(a&&l>s))return!1;var u=o.get(e),c=o.get(t);if(u&&c)return u==t&&c==e;var h=-1,d=!0,p=2&r?new eo:void 0;for(o.set(e,t),o.set(t,e);++h<s;){var f=e[h],m=t[h];if(n)var v=a?n(m,f,h,t,e,o):n(f,m,h,e,t,o);if(void 0!==v){if(v)continue;d=!1;break}if(p){if(!to(t,(function(e,t){if(!ro(p,t)&&(f===e||i(f,e,r,n,o)))return p.push(t)}))){d=!1;break}}else if(f!==m&&!i(f,m,r,n,o)){d=!1;break}}return o.delete(e),o.delete(t),d};var io=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var oo=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},ao=Xe?Xe.prototype:void 0,so=ao?ao.valueOf:void 0;var lo=function(e,t,r,n,i,o,a){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new Ai(e),new Ai(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return qt(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=io;case"[object Set]":var l=1&n;if(s||(s=oo),e.size!=t.size&&!l)return!1;var u=a.get(e);if(u)return u==t;n|=2,a.set(e,t);var c=no(s(e),s(t),n,i,o,a);return a.delete(e),c;case"[object Symbol]":if(so)return so.call(e)==so.call(t)}return!1},uo=Object.prototype.hasOwnProperty;var co=function(e,t,r,n,i,o){var a=1&r,s=ui(e),l=s.length;if(l!=ui(t).length&&!a)return!1;for(var u=l;u--;){var c=s[u];if(!(a?c in t:uo.call(t,c)))return!1}var h=o.get(e),d=o.get(t);if(h&&d)return h==t&&d==e;var p=!0;o.set(e,t),o.set(t,e);for(var f=a;++u<l;){var m=e[c=s[u]],v=t[c];if(n)var g=a?n(v,m,c,t,e,o):n(m,v,c,e,t,o);if(!(void 0===g?m===v||i(m,v,r,n,o):g)){p=!1;break}f||(f="constructor"==c)}if(p&&!f){var y=e.constructor,b=t.constructor;y!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(p=!1)}return o.delete(e),o.delete(t),p},ho="[object Arguments]",po="[object Array]",fo="[object Object]",mo=Object.prototype.hasOwnProperty;var vo=function(e,t,r,n,i,o){var a=st(e),s=st(t),l=a?po:Ti(e),u=s?po:Ti(t),c=(l=l==ho?fo:l)==fo,h=(u=u==ho?fo:u)==fo,d=l==u;if(d&&pr(e)){if(!pr(t))return!1;a=!0,c=!1}if(d&&!c)return o||(o=new Hn),a||_r(e)?no(e,t,r,n,i,o):lo(e,t,l,r,n,i,o);if(!(1&r)){var p=c&&mo.call(e,"__wrapped__"),f=h&&mo.call(t,"__wrapped__");if(p||f){var m=p?e.value():e,v=f?t.value():t;return o||(o=new Hn),i(m,v,r,n,o)}}return!!d&&(o||(o=new Hn),co(e,t,r,n,i,o))};var go=function e(t,r,n,i,o){return t===r||(null==t||null==r||!it(t)&&!it(r)?t!=t&&r!=r:vo(t,r,n,i,e,o))};var yo=function(e,t){return null!=e&&t in Object(e)};var bo=function(e,t,r){for(var n=-1,i=(t=wn(t,e)).length,o=!1;++n<i;){var a=_n(t[n]);if(!(o=null!=e&&r(e,a)))break;e=e[a]}return o||++n!=i?o:!!(i=null==e?0:e.length)&&Qt(i)&&Ht(a,i)&&(st(e)||lr(e))};var xo=function(e,t){return null!=e&&bo(e,t,yo)};var wo=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};var _o=function(e,t){return t.length<2?e:Sn(e,Rn(t,0,-1))};var So=function(e,t){return go(e,t)};var Oo=function(e,t){return t=wn(t,e),null==(e=_o(e,t))||delete e[_n(wo(t))]};var To=function(e){return zn(e)?void 0:e},Eo=Mn((function(e,t){var r={};if(null==e)return r;var n=!1;t=at(t,(function(t){return t=wn(t,e),n||(n=t.length>1),t})),Yt(e,ci(e),r),n&&(r=Yi(r,7,To));for(var i=t.length;i--;)Oo(r,t[i]);return r})),Co=Eo;var Ao=function(e,t,r,n){if(!ht(e))return e;for(var i=-1,o=(t=wn(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var l=_n(t[i]),u=r;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(i!=a){var c=s[l];void 0===(u=n?n(c,l,s):void 0)&&(u=ht(c)?c:Ht(t[i+1])?[]:{})}Xt(s,l,u),s=s[l]}return e};var Mo=function(e,t,r){for(var n=-1,i=t.length,o={};++n<i;){var a=t[n],s=Sn(e,a);r(s,a)&&Ao(o,wn(a,e),s)}return o};var Do=function(e,t){return Mo(e,t,(function(t,r){return xo(e,r)}))},Po=Mn((function(e,t){return null==e?{}:Do(e,t)})),ko=Po,Lo=class{modifyById(e,t){let r=this;if(void 0===r[e])throw new Error("not expected");{let n={...r,[e]:t};return Object.setPrototypeOf(n,Lo.prototype),n}}add(e,t){var r;return(null==(r=this.runOp({type:1,id:e,data:t}))?void 0:r.data)??this}runOp(e){let t=this;if(1===e.type){let r,n=t[e.id];r=void 0===n?{type:2,id:e.id}:{type:1,id:e.id,data:n};let{id:i,data:o}=e,a={...t,[i]:o};return Object.setPrototypeOf(a,Lo.prototype),{data:a,actual:e,reverse:r}}if(2===e.type){let{id:r}=e,n=t[r];if(void 0===n)return null;{let i={...t};return Object.setPrototypeOf(i,Lo.prototype),delete i[r],{data:i,actual:e,reverse:{type:1,id:r,data:n}}}}return null}};function Uo(e){if(void 0!==e.deepFreeze)return void e.deepFreeze(e);let t=Object.getOwnPropertyNames(e);for(let r of t){let t=e[r];t&&"object"==typeof t&&Uo(t)}return Object.freeze(e)}var Io=class extends Error{};function zo(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function Ro(e,t,r){if(void 0===e?void 0===t?(e=0,t=10):e=t-10:void 0===t&&(t=e+10),e>t){let r=e;e=t,t=r}let n=[],i=1/(r+1);for(let o=0;o<r;o++){let r=e+(t-e)*(o+.75+.5*Math.random())*i;n.push(r)}return n}function No(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function Bo(e,t){for(let r of e)!0!==t(r.id,r.data)&&Bo(r.children,t)}function Fo(e,t){if(!0!==t(e.id,e.data))for(let r of e.children)Fo(r,t)}var jo,Go=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Go.prototype)}deepFreeze(){let e=0;for(;e<this.length;)Uo(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let r of e.children)this.fillCaches0(r,e.id)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let r=this.parent(e);if(r===t)return!0;e=r}return!1}isDescendantOf(e,t){for(;e;){let r=this.parent(e);if(r===t)return!0;e=r}return!1}data(e){var t;return null==(t=this.get(e))?void 0:t.data}has(e){return void 0!==this.childrenOf(e)}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return null===e?this:null==(t=this.get(e))?void 0:t.children}traverseFrom(e,t){if(null===e)this.traverse(t);else{let r=this.get(e);r&&Fo(r,t)}}traverse(e){Bo(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return null===e?this:this.get(e).children}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let r=this.parent(e),n=this.childrenArray(r),i=n.findIndex((t=>t.id===e));if(i<0)throw new Error("not expected");let o=n[i];return n=[...n],n[i]={...o,data:t},this.modifyArrayBy(r,n)}}modifyArrayBy(e,t){let r=e,n=t;for(;null!==r;){let e=n,t=r;if(r=this.parent(r),void 0===r)throw new Error;n=this.childrenArray(r);let i=n.findIndex((e=>e.id===t));if(i<0)throw new Error;n=[...n],n[i]={...n[i],children:e}}Object.setPrototypeOf(n,Go.prototype);let i=n;return i.fillCaches(),i}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(void 0!==this.get(e))return!0;for(let r of t)if(this.checkDuplicatedIdRec(r))return!0;return!1}addOp(e){let{parent:t,fi:r,id:n,data:i,children:o}=e;if(null!==t&&void 0===this.get(t))return null;if(this.checkDuplicatedIdRec(e))return null;{let a=t,s=this.childrenArray(a),l={fi:r,id:n,data:i,children:o};return s=[...s,l],s.sort(((e,t)=>e.fi-t.fi)),e.localIndex=s.indexOf(l),{data:this.modifyArrayBy(a,s),actual:e,reverse:{type:8,id:n}}}}deleteOp(e){let{id:t}=e;if(null===this.get(t))return null;{let r=this.parent(t);if(void 0===r)return null;let n=this.childrenArray(r),i=n.findIndex((e=>e.id===t));e.localIndex=i,n=[...n];let o=n.splice(i,1)[0];return{data:this.modifyArrayBy(r,n),actual:e,reverse:{type:7,...o,parent:r}}}}moveOp(e){let{parent:t,fi:r,id:n}=e;if(null!==t&&void 0===this.get(t))return this.deleteOp({type:8,id:n});if(null!==t){let e=t;for(;null!==e;){if(void 0===e)throw new Error;if(e===n)throw new Io("cyclic tree");e=this.parent(e)}}let i=this.parent(n);if(void 0===i)return null;let o=i,a=this.childrenArray(i),s=a.findIndex((e=>e.id===n));a=[...a];let l=a.splice(s,1)[0],u=this.modifyArrayBy(i,a);i=t,a=u.childrenArray(i);let c=l.fi;return l={...l,fi:r},a=[...a,l],a.sort(((e,t)=>e.fi-t.fi)),e.localIndex=a.indexOf(l),u=u.modifyArrayBy(i,a),{data:u,actual:e,reverse:{type:9,parent:o,fi:c,id:n}}}previous(e,t){if(null===t){let t=this.childrenArray(e);return 0===t.length?null:t[t.length-1].id}let r=null;for(let n of this.childrenArray(e)){if(n.id===t)return r;r=n.id}return null}traverseSortNext(e){let t=this.parent(e);if(void 0!==t){let r=this.childrenArray(t),n=r.findIndex((t=>t.id===e))+1;if(n<r.length)return r[n].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(void 0!==t){let r=this.childrenArray(t),n=r.findIndex((t=>t.id===e))-1;return n>=0?this.traverseSortPrevious(r[n].id):t}}getAllSorted(e){let t=[];for(let r of e){let e=this.getWithSortKey(r.id);void 0!==e&&t.push({...r,...e})}t.sort(((e,t)=>function(e,t){let r=0;for(;r<e.length&&r<t.length;){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1;r+=1}return r!==t.length?-1:r!==e.length?1:0}(e.sortKey,t.sortKey)));for(let r of t)delete r.sortKey;return t}getWithSortKey(e){var t=e;let r=[],n=this.get(t),i=n;if(void 0!==n){for(;t;)r.splice(0,0,n.fi),null!==(t=this.parent(t))&&(n=this.get(t));return{...i,sortKey:r}}}insertBeforeHelper(e,t,r){return this.insertAfterHelper(e,this.previous(e,t),r)}insertAfterHelper(e,t,r){let n=this.childrenArray(e);if(null===t){if(0===n.length)return Ro(0,r,r);{let e=n[0].fi;return Ro(e-r,e,r)}}{let i=this.get(t);if(void 0===i||this.parent(t)!==e)throw new Error("illegal args");let o=n.find((e=>e.fi>i.fi));if(void 0===o){let e=n[n.length-1].fi;return Ro(e,e+r,r)}return Ro(i.fi,o.fi,r)}}};(jo||(jo={})).runOp=function(e,t){if(0!==t.type)return null;if(Array.isArray(e)){let r=t.props,n={},i=[...e],o=!1;if(r)for(let e of Object.keys(r)){let t=parseInt(e);if(isNaN(t))throw new Error("wrong index");n[e]=i[t],i[t]=r[e],o=!0}return o?{data:i,actual:t,reverse:{type:0,props:n}}:null}{let r=t.props,n={},i={...e},o=!1;if(r)for(let e of Object.keys(r)){n[e]=i[e];let t=r[e];void 0===t?delete i[e]:i[e]=t,o=!0}return o?{data:i,actual:t,reverse:{type:0,props:n}}:null}};var Vo=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Vo.prototype)}deepFreeze(){let e=0;for(;e<this.length;)Uo(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return null==(t=this.get(e))?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let r=this,n=r.findIndex((t=>t.id===e));if(n<0)throw new Error("not expected");let i=r[n];return r=[...r],r[n]={...i,data:t},this.modifyArrayBy(r)}}modifyArrayBy(e){Object.setPrototypeOf(e,Vo.prototype);let t=e;return typeof process<"u"||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:r,data:n}=e,i=this,o={fi:t,id:r,data:n};return i=[...i,o],i.sort(((e,t)=>e.fi-t.fi)),e.localIndex=i.indexOf(o),{data:this.modifyArrayBy(i),actual:e,reverse:{type:5,id:r}}}deleteOp(e){let{id:t}=e,r=this,n=r.findIndex((e=>e.id===t));if(-1===n)return null;e.localIndex=n,r=[...r];let i=r.splice(n,1)[0];return{data:this.modifyArrayBy(r),actual:e,reverse:{type:4,...i}}}moveOp(e){let{fi:t,id:r}=e,n=this;n=[...n];let i=n.findIndex((e=>e.id===r));if(-1===i)return null;let o=n[i].fi,a={...n[i],fi:t};return n[i]=a,n.sort(((e,t)=>e.fi-t.fi)),e.localIndex=n.indexOf(a),{data:this.modifyArrayBy(n),actual:e,reverse:{type:6,fi:o,id:r}}}previous(e){if(null===e)return 0===this.length?null:this[this.length-1].id;let t=null;for(let r of this){if(r.id===e)return t;t=r.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let r=this;if(null===e){if(0===r.length)return Ro(0,t,t);{let e=r[0].fi;return Ro(e-t,e,t)}}{let n=this.get(e);if(void 0===n)throw new Error("illegal args");let i=r.find((e=>e.fi>n.fi));if(void 0===i){let e=r[r.length-1].fi;return Ro(e,e+t,t)}return Ro(n.fi,i.fi,t)}}};function Ho(e){return e&&"object"==typeof e&&e instanceof Zo}var Wo,qo,$o,Xo,Yo,Zo=class{unusedFunOverridesTable(e){}runOp(e){let t=[],r=this,n=0,i={};for(;n<e.path.length;){if(t.push(r),r=void 0===r?void 0:r[e.path[n]],void 0!==r&&!Ho(r))return null;n+=1}r=r?zo(r):new Zo;for(let[o,a]of Object.entries(e.props)){let e=r[o];i[o]=e,void 0===a?delete r[o]:r[o]=a}for(;n>0;){if(0===Object.keys(r).length){let i=t[n-1];i&&(r=zo(i),delete r[e.path[n-1]])}else{let i=t[n-1];if(i){let t=zo(i);t[e.path[n-1]]=r,r=t}else{let t=new Zo;t[e.path[n-1]]=r,r=t}}n-=1}return{data:Object.setPrototypeOf(r,Zo.prototype),actual:e,reverse:{...e,props:i}}}};function Ko(e,t){if(void 0===t)return;let r=!1,n=e.map((e=>{let n=e.id,i=Qo(e.data,t[n]);if(r=r||void 0!==i,void 0===i&&(i=e.data),e.children){let o=Ko(e.children,t);return void 0!==o?r=!0:o=e.children,{...e,id:n,data:i,children:o}}return{...e,id:n,data:i}}));return r?n:void 0}function Qo(e,t){if(!Ho(t))return t;if(e instanceof Go){let r=Ko(e,t);return void 0!==r&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}if(e instanceof Vo)return function(e,t){if(void 0===t)return;let r=!1,n=e.map((e=>{let n=e.id,i=Qo(e.data,t[n]);return r=r||void 0!==i,void 0===i&&(i=e.data),{...e,id:n,data:i}}));return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}(e,t);if(Array.isArray(e)){let r=!1,n=e.map(((e,n)=>{let i=Qo(e,t[n]);return r=r||void 0!==i,void 0===i&&(i=e),i}));return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}if(e instanceof Zo)return Jo(e,t);if(e&&"object"==typeof e){let r={},n=!1;for(let[i,o]of Object.entries(e)){let e=Qo(o,t[i]);n=n||void 0!==e,void 0===e&&(e=o),r[i]=e}return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}}function Jo(e,t){if(void 0===e)return t;if(void 0===t)return e;if(!Ho(t))return t;if(!Ho(e))return Wo.apply(e,t);let r=new Set;for(let i of Object.keys(e))r.add(i);for(let i of Object.keys(t))r.add(i);let n=new Zo;for(let i of r){let r=Jo(void 0===e?void 0:e[i],void 0===t?void 0:t[i]);n[i]=r}return n}function ea(e,t){let r={cur:[],result:[],len:0};return[e=ia(e,t,r)??e,r.result]}function ta(e,t){return null===e?null:(e.cur[e.len]=t,e.len+=1,e)}function ra(e){e&&(e.len-=1)}function na(e,t,r){let n=!1,i=e.map((e=>{let i=e.id,o=t[i];if(void 0!==o&&"string"==typeof o&&(n=!0,i=o,null!==r))throw new Error("not supported");let a=ia(e.data,t,ta(r,i));ra(r),n=n||void 0!==a,void 0===a&&(a=e.data);let s=na(e.children,t,r);return void 0!==s?n=!0:s=e.children,{...e,id:i,data:a,children:s}}));if(n)return i}function ia(e,t,r){if(e instanceof Go){let n=na(e,t,r);return void 0!==n&&Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}if(e instanceof Vo)return function(e,t,r){let n=!1,i=e.map((e=>{let i=e.id,o=t[i];if(void 0!==o&&"string"==typeof o&&(n=!0,i=o,null!==r))throw new Error("not supported");let a=ia(e.data,t,ta(r,i));return ra(r),n=n||void 0!==a,void 0===a&&(a=e.data),{...e,id:i,data:a}}));if(n)return Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}(e,t,r);if(Array.isArray(e)){let n=!1,i=e.map(((e,i)=>{let o=ia(e,t,ta(r,i));return ra(r),n=n||void 0!==o,void 0===o&&(o=e),o}));return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}if(e&&"object"==typeof e&&!No(e)){let n={},i=!1;for(let[o,a]of Object.entries(e))if("name"!==o&&"text"!==o){let e=t[o];if("string"==typeof e){if(null!==r)throw new Error("not supported");i=!0,o=e}let s=ia(a,t,ta(r,o));ra(r),i=i||void 0!==s,void 0===s&&(s=a),n[o]=s}else n[o]=a;return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}if("string"==typeof e){let n=t[e];if(void 0!==n){if(36!==e.length)throw new Error("for now you should only call this method when the key is a uuid");!function(e){if(null===e)return null;e.result.push(e.cur.slice(0,e.len))}(r)}return n}}(qo=Wo||(Wo={})).apply=function(e,t){return Qo(e,t)??e},qo.merge=function(e,t){return Jo(e,t)},qo.filterOp=function(e,t){let r=0,n=t.path,i=e;for(;r<n.length&&void 0!==i;){if(i=ga.zoomOnce(i,n[r]),void 0===i)return t;if(!Ho(i))return;r+=1}if(void 0===i)return t;if(Ho(i)){if(0===t.type){let e={...t.props};for(let t of Object.keys(i))delete e[t];return{...t,props:e}}if(1===t.type||4===t.type||7===t.type){let e=Ko([t],i);return e||t}return t}},($o||($o={})).replaceProps=function(e,t){let r=ga.zoom(t,e.path);if("object"==typeof r){let t={};for(let n of Object.keys(e.props))t[n]=r[n];return{...e,props:t}}return{...e,props:{}}},(e=>{function t(e,t){var r,n;let i=t.path;for(var o=[];;){let a;if(e instanceof Zo&&0===t.type&&(a=e.runOp({...t,path:i.slice(o.length)}),null===a&&(a=void 0)),void 0===a&&o.length===i.length&&(a=e instanceof Go||e instanceof Vo||e instanceof Lo?e.runOp(t):jo.runOp(e,t)),void 0!==a){if(null!==a){let e=a.data;for(let t=o.length-1;t>=0;t--){let r=i[t],n=o[t];if(n instanceof Go){if("number"==typeof r)throw new Error("illegal arg");e=n.modifyById(r,e)}else if(n instanceof Vo){if("number"==typeof r)throw new Error("illegal arg");e=n.modifyById(r,e)}else if(n instanceof Lo){if("number"==typeof r)throw new Error("illegal arg");e=n.modifyById(r,e)}else if(n instanceof Zo){let t={...n,[r]:e};e=Object.setPrototypeOf(t,Zo.prototype)}else{if("object"!=typeof n)return null;if(Array.isArray(n)){if("string"==typeof r&&(r=parseInt(r),isNaN(r)))throw new Error("Invalid path");let t=e;e=[...n],e[r]=t}else e={...n,[r]:e}}}return{data:e,actual:{...a.actual,path:i},reverse:{...a.reverse,path:i}}}return null}let s,l=i[o.length];if(e instanceof Go){if("number"==typeof l)throw new Error("");s=null==(r=e.get(l))?void 0:r.data}else if(e instanceof Vo){if("number"==typeof l)throw new Error("");s=null==(n=e.get(l))?void 0:n.data}else null!==e&&(s=e[l]);if(void 0===s)return null;o.push(e),e=s}}function r(e,t){for(let r=0;r<e.length&&r<t.length;r++)if(e[r]!==t[r])return!0;return!1}function n(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}e.drop=function(e,t){return{...e,path:e.path.slice(t)}},e.applySimple=function(e,r){var n;return(null==(n=t(e,r))?void 0:n.data)??e},e.apply=t,e.pathDisjoint=r,e.pathEq=n,e.commutative=function(e,t){return r(e.path,t.path)},e.subsumed=function(e,t){return!(0!==e.type||0!==t.type||!n(e.path,t.path))&&Object.keys(e.props).every((e=>void 0!==t.props[e]))}})(Xo||(Xo={})),(e=>{function t(e,t){var r=e;let n=[],i=[];for(let a of t)try{if(3===a.type){let e=ga.zoom(r,[...a.path,a.id]),t=Xo.apply(r,{...a,type:2});if(null!==t){r=t.data;let[o,s]=ea(r,{[a.id]:e});r=o;for(let t of s){let r=t[t.length-1];t.splice(t.length-1,1),n.push({type:0,path:t,props:{[r]:e}}),i.push({type:0,path:t,props:{[r]:a.id}})}i.push(t.reverse),n.push(t.actual)}}else{let e=Xo.apply(r,a);null!==e&&(n.push(e.actual),r=e.data,i.push(e.reverse))}}catch(o){if(o instanceof Io)return null;throw o}return{data:r,actual:n,reverse:i.reverse()}}e.empty=function(){return[]},e.removePrefix=function(e,t){let r=[];for(let n of e){let[e,...i]=n.path;e===t&&r.push({...n,path:i})}return r},e.addPrefix=function(e,t){return e.map((e=>({...e,path:[t,...e.path]})))},e.concat=function(e,t){return[...e,...t]},e.compress=function(e,t){return[...e.filter((e=>!t.some((t=>Xo.subsumed(e,t))))),...t]},e.commutative=function(e,t){return e.every((e=>t.every((t=>Xo.commutative(e,t)))))},e.applyAll=function(e,r){for(let n of r){let r=t(e,n);null!==r&&(e=r.data)}return e},e.apply=t})(Yo||(Yo={}));var oa=Symbol(),aa=Symbol(),sa=Symbol(),la=class{reportOp(e,t,r=[]){let n=this;if(null===t)return;n._current=t.data;let i=r;for(;!(n instanceof ya);){let e=n._path,t=n._current;if(""!==e&&i.splice(0,0,e),n=n._parent,null===n)return;n.update(e,t)}n.push(i,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let r=t[sa];r&&r(),delete this._children[e]}}}},ua=class extends la{constructor(e,t,r){super(),this._parent=e,this._path=t,this._current=r}update(e,t){if(Array.isArray(this._current)){if("string"==typeof e&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,jo.runOp(this._current,e),e.path)}},ca=class extends la{constructor(e,t,r){super(),this._parent=e,this._path=t,this._current=r}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,Lo.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},ha={get(e,t){if(t===sa)return()=>{e._parent=null};if(t===oa)return e._current;if(t===aa)return e;let{_current:r,_children:n}=e;if("push"===t&&Array.isArray(r))throw new Error("not supported to expand array");let i=void 0===n?void 0:n[t];if(void 0!==i)return i;let o=r[t],a=ba(e,t,o);return a!==o?(void 0===n&&(n={},e._children=n),n[t]=a,a):o},has:(e,t)=>t in e._current,ownKeys:e=>Reflect.ownKeys(e._current),defineProperty(){throw Error("not supported")},getPrototypeOf:e=>Object.getPrototypeOf(e._current),setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let r=e._current,n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:!0,enumerable:n.enumerable,value:r[t]}}},da={...ha,set(e,t,r){let n={type:0,props:{[t]:_a(r)??r}};return e.deleteChildren(t),e.runOp(n),!0},deleteProperty(e,t){let r={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(r),!0}},pa={...ha,set(e,t,r){return void 0===r?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:r})),!0},deleteProperty:(e,t)=>(e.runOp({type:2,id:t}),!0)},fa=class extends la{constructor(e,t,r){super(),this._children={},this._parent=e,this._path=t,this._current=r,this[sa]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse(((t,r)=>{e(t,this.data(t))}))}data(e){var t;let{_current:r,_children:n}=this,i=void 0===n?void 0:n[e];if(void 0!==i)return i;let o=null==(t=r.get(e))?void 0:t.data,a=ba(this,e,o);return a!==o?(void 0===n&&(n={},this._children=n),n[e]=a,a):o}add(e,t,r,n,i){this.runOp({type:7,parent:e,fi:t,id:r,data:n,children:i})}move(e,t,r){this.runOp({type:9,parent:e,fi:t,id:r})}insertAfter(e,t,r){let n=this._current.insertAfterHelper(e,t,r.length);for(let i=0;i<r.length;i++){let t=r[i];this.add(e,n[i],t.id,t.data,t.children)}}insertBefore(e,t,r){let n=this._current.insertBeforeHelper(e,t,r.length);for(let i=0;i<r.length;i++){let t=r[i];this.add(e,n[i],t.id,t.data,t.children)}}moveAfter(e,t,r){let n=this._current.insertAfterHelper(e,t,r.length);for(let i=0;i<r.length;i++){let t=r[i];this.move(e,n[i],t)}}moveBefore(e,t,r){let n=this._current.insertBeforeHelper(e,t,r.length);for(let i=0;i<r.length;i++){let t=r[i];this.move(e,n[i],t)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},ma=class extends la{constructor(e,t,r){super(),this._children={},this._parent=e,this._path=t,this._current=r,this[sa]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let r=0;r<t;r++){let t=this._current[r].id,n=this._current[r].fi;e(this.data(this._current[r].id),t,n)}}find(e){let t=this.length;for(let r=0;r<t;r++){let t=this._current[r].id;if(e(this.data(t),t))return this.get(t)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var t;let{_current:r,_children:n}=this,i=void 0===n?void 0:n[e];if(void 0!==i)return i;let o=null==(t=r.get(e))?void 0:t.data,a=ba(this,e,o);return a!==o?(void 0===n&&(n={},this._children=n),n[e]=a,a):o}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,r){this.runOp({type:4,fi:e,id:t,data:r})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let r=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.add(r[n],e.id,e.data)}}insertBefore(e,t){let r=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.add(r[n],e.id,e.data)}}moveAfter(e,t){let r=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.move(r[n],e)}}moveBefore(e,t){let r=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.move(r[n],e)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function va(e,t,r){if(e.length>0){let n=e[e.length-1];if(0===n.type&&0===t.type&&ga.equal(n.path,r))return void Object.assign(n.props,t.props)}e.push({...t,path:r})}var ga,ya=class extends la{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(""!==e)throw new Error("");this._current=t}push(e,t,r,n){va(this.ts,t,e),va(this.actual,r,e),va(this.reverse,n,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function ba(e,t,r){return r instanceof Go?new fa(e,t,r):r instanceof Vo?new ma(e,t,r):r instanceof Lo?new Proxy(new ca(e,t,r),pa):null!==r&&"object"==typeof r?No(r)?r:new Proxy(new ua(e,t,r),da):r}function xa(e){let t=new ya(e);return[ba(t,"",e),t]}function wa(e,t){let[r,n]=xa(e);return t(r),n.result()}function _a(e){return e instanceof fa||e instanceof ma?e._current:null!==e&&"object"==typeof e?e[oa]:e}function Sa(e,t){let r=[];if(!(t.length<=e.length))return null;for(var n=0;n<t.length;){if("*"===t[n])r.push(e[n]);else if(e[n]!==t[n])return null;n+=1}return r}(e=>{function t(e,t){return(e instanceof Go||e instanceof fa)&&"string"==typeof t||(e instanceof Vo||e instanceof ma)&&"string"==typeof t?e.data(t):"number"==typeof t&&Array.isArray(e)||"string"==typeof t&&"object"==typeof e&&null!==e?e[t]:void 0}function r(e,r,n=0){for(;n<r.length&&void 0!==e;)e=t(e,r[n]),n+=1;return e}e.equal=function(e,t){if(t.length!==e.length)return!1;for(var r=0;r<e.length;){if(e[r]!==t[r])return!1;r+=1}return!0},e.removeOverridden=function(e,t,n){let i=r(n,e);if(void 0!==i&&"object"==typeof i&&null!==i){let e={...t};return Object.keys(i).forEach((t=>{delete e[t]})),e}return t},e.zoomOnce=t,e.zoom=r})(ga||(ga={}));var Oa,Ta=class{},Ea=class extends Ta{constructor(e){super(),this.id=e}},Ca=class extends Ta{constructor(e){super(),this.data=e}};try{Oa=new TextDecoder}catch{}var Aa,Ma,Da,Pa,ka,La,Ua,Ia=0,za={},Ra=0,Na=0,Ba=[],Fa={useRecords:!1,mapsAsObjects:!0},ja=class{},Ga=new ja;Ga.name="MessagePack 0xC1";var Va=!1,Ha=class{constructor(e){e&&(!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Aa)return ms((()=>(vs(),this?this.unpack(e,t):Ha.prototype.unpack.call(Fa,e,t))));Ma=t>-1?t:e.length,Ia=0,Na=0,Pa=null,ka=null,Aa=e;try{Ua=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(qo){throw Aa=null,e instanceof Uint8Array?qo:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof Ha){if(za=this,this.structures)return Da=this.structures,Wa();(!Da||Da.length>0)&&(Da=[])}else za=Fa,(!Da||Da.length>0)&&(Da=[]);return Wa()}unpackMultiple(e,t){let r,n=0;try{Va=!0;let i=e.length,o=this?this.unpack(e,i):ys.unpack(e,i);if(!t){for(r=[o];Ia<i;)n=Ia,r.push(Wa());return r}for(t(o);Ia<i;)if(n=Ia,!1===t(Wa()))return}catch(tl){throw tl.lastPosition=n,tl.values=r,tl}finally{Va=!1,vs()}}_mergeStructures(e,t){for(let r=0,n=(e=e||[]).length;r<n;r++){let t=e[r];t&&(t.isShared=!0,r>=32&&(t.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in t||[])if(r>=0){let n=e[r],i=t[r];i&&(n&&((e.restoreStructures||(e.restoreStructures=[]))[r]=n),e[r]=i)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function Wa(){try{if(!za.trusted&&!Va){let e=Da.sharedLength||0;e<Da.length&&(Da.length=e)}let e=$a();if(Ia==Ma)Da.restoreStructures&&qa(),Da=null,Aa=null,La&&(La=null);else{if(Ia>Ma){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}if(!Va)throw new Error("Data read, but end of buffer not reached")}return e}catch(pt){throw Da.restoreStructures&&qa(),vs(),(pt instanceof RangeError||pt.message.startsWith("Unexpected end of buffer"))&&(pt.incomplete=!0),pt}}function qa(){for(let e in Da.restoreStructures)Da[e]=Da.restoreStructures[e];Da.restoreStructures=null}function $a(){let e=Aa[Ia++];if(e<160){if(e<128){if(e<64)return e;{let t=Da[63&e]||za.getStructures&&Ka()[63&e];return t?(t.read||(t.read=Ya(t,63&e)),t.read()):e}}if(e<144){if(e-=128,za.mapsAsObjects){let t={};for(let r=0;r<e;r++)t[hs()]=$a();return t}{let t=new Map;for(let r=0;r<e;r++)t.set($a(),$a());return t}}{e-=144;let t=new Array(e);for(let r=0;r<e;r++)t[r]=$a();return t}}if(e<192){let t=e-160;if(Na>=Ia)return Pa.slice(Ia-Ra,(Ia+=t)-Ra);if(0==Na&&Ma<140){let e=t<16?ss(t):as(t);if(null!=e)return e}return Qa(t)}{let t;switch(e){case 192:return null;case 193:return ka?(t=$a(),t>0?ka[1].slice(ka.position1,ka.position1+=t):ka[0].slice(ka.position0,ka.position0-=t)):Ga;case 194:return!1;case 195:return!0;case 196:return ls(Aa[Ia++]);case 197:return t=Ua.getUint16(Ia),Ia+=2,ls(t);case 198:return t=Ua.getUint32(Ia),Ia+=4,ls(t);case 199:return us(Aa[Ia++]);case 200:return t=Ua.getUint16(Ia),Ia+=2,us(t);case 201:return t=Ua.getUint32(Ia),Ia+=4,us(t);case 202:if(t=Ua.getFloat32(Ia),za.useFloat32>2){let e=gs[(127&Aa[Ia])<<1|Aa[Ia+1]>>7];return Ia+=4,(e*t+(t>0?.5:-.5)>>0)/e}return Ia+=4,t;case 203:return t=Ua.getFloat64(Ia),Ia+=8,t;case 204:return Aa[Ia++];case 205:return t=Ua.getUint16(Ia),Ia+=2,t;case 206:return t=Ua.getUint32(Ia),Ia+=4,t;case 207:return za.int64AsNumber?(t=4294967296*Ua.getUint32(Ia),t+=Ua.getUint32(Ia+4)):t=Ua.getBigUint64(Ia),Ia+=8,t;case 208:return Ua.getInt8(Ia++);case 209:return t=Ua.getInt16(Ia),Ia+=2,t;case 210:return t=Ua.getInt32(Ia),Ia+=4,t;case 211:return za.int64AsNumber?(t=4294967296*Ua.getInt32(Ia),t+=Ua.getUint32(Ia+4)):t=Ua.getBigInt64(Ia),Ia+=8,t;case 212:if(t=Aa[Ia++],114==t)return ds(63&Aa[Ia++]);{let e=Ba[t];if(e)return e.read?(Ia++,e.read($a())):e.noBuffer?(Ia++,e()):e(Aa.subarray(Ia,++Ia));throw new Error("Unknown extension "+t)}case 213:return t=Aa[Ia],114==t?(Ia++,ds(63&Aa[Ia++],Aa[Ia++])):us(2);case 214:return us(4);case 215:return us(8);case 216:return us(16);case 217:return t=Aa[Ia++],Na>=Ia?Pa.slice(Ia-Ra,(Ia+=t)-Ra):Ja(t);case 218:return t=Ua.getUint16(Ia),Na>=(Ia+=2)?Pa.slice(Ia-Ra,(Ia+=t)-Ra):es(t);case 219:return t=Ua.getUint32(Ia),Na>=(Ia+=4)?Pa.slice(Ia-Ra,(Ia+=t)-Ra):ts(t);case 220:return t=Ua.getUint16(Ia),Ia+=2,ns(t);case 221:return t=Ua.getUint32(Ia),Ia+=4,ns(t);case 222:return t=Ua.getUint16(Ia),Ia+=2,is(t);case 223:return t=Ua.getUint32(Ia),Ia+=4,is(t);default:if(e>=224)return e-256;if(void 0===e){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}throw new Error("Unknown MessagePack token "+e)}}}var Xa=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Ya(e,t){function r(){if(r.count++>2){let r=e.read=new Function("r","return function(){return {"+e.map((e=>Xa.test(e)?e+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}}")($a);return 0===e.highByte&&(e.read=Za(t,e.read)),r()}let n={};for(let t=0,r=e.length;t<r;t++){n[e[t]]=$a()}return n}return r.count=0,0===e.highByte?Za(t,r):r}var Za=(e,t)=>function(){let r=Aa[Ia++];if(0===r)return t();let n=e<32?-(e+(r<<5)):e+(r<<5),i=Da[n]||Ka()[n];if(!i)throw new Error("Record id is not defined for "+n);return i.read||(i.read=Ya(i,e)),i.read()};function Ka(){let e=ms((()=>(Aa=null,za.getStructures())));return Da=za._mergeStructures(e,Da)}var Qa=rs,Ja=rs,es=rs,ts=rs;function rs(e){let t;if(e<16&&(t=ss(e)))return t;if(e>64&&Oa)return Oa.decode(Aa.subarray(Ia,Ia+=e));let r=Ia+e,n=[];for(t="";Ia<r;){let e=Aa[Ia++];if(0==(128&e))n.push(e);else if(192==(224&e)){let t=63&Aa[Ia++];n.push((31&e)<<6|t)}else if(224==(240&e)){let t=63&Aa[Ia++],r=63&Aa[Ia++];n.push((31&e)<<12|t<<6|r)}else if(240==(248&e)){let t=(7&e)<<18|(63&Aa[Ia++])<<12|(63&Aa[Ia++])<<6|63&Aa[Ia++];t>65535&&(t-=65536,n.push(t>>>10&1023|55296),t=56320|1023&t),n.push(t)}else n.push(e);n.length>=4096&&(t+=os.apply(String,n),n.length=0)}return n.length>0&&(t+=os.apply(String,n)),t}function ns(e){let t=new Array(e);for(let r=0;r<e;r++)t[r]=$a();return t}function is(e){if(za.mapsAsObjects){let t={};for(let r=0;r<e;r++)t[hs()]=$a();return t}{let t=new Map;for(let r=0;r<e;r++)t.set($a(),$a());return t}}var os=String.fromCharCode;function as(e){let t=Ia,r=new Array(e);for(let n=0;n<e;n++){let e=Aa[Ia++];if((128&e)>0)return void(Ia=t);r[n]=e}return os.apply(String,r)}function ss(e){if(e<4){if(e<2){if(0===e)return"";{let e=Aa[Ia++];return(128&e)>1?void(Ia-=1):os(e)}}{let t=Aa[Ia++],r=Aa[Ia++];if((128&t)>0||(128&r)>0)return void(Ia-=2);if(e<3)return os(t,r);let n=Aa[Ia++];return(128&n)>0?void(Ia-=3):os(t,r,n)}}{let t=Aa[Ia++],r=Aa[Ia++],n=Aa[Ia++],i=Aa[Ia++];if((128&t)>0||(128&r)>0||(128&n)>0||(128&i)>0)return void(Ia-=4);if(e<6){if(4===e)return os(t,r,n,i);{let e=Aa[Ia++];return(128&e)>0?void(Ia-=5):os(t,r,n,i,e)}}if(e<8){let o=Aa[Ia++],a=Aa[Ia++];if((128&o)>0||(128&a)>0)return void(Ia-=6);if(e<7)return os(t,r,n,i,o,a);let s=Aa[Ia++];return(128&s)>0?void(Ia-=7):os(t,r,n,i,o,a,s)}{let o=Aa[Ia++],a=Aa[Ia++],s=Aa[Ia++],l=Aa[Ia++];if((128&o)>0||(128&a)>0||(128&s)>0||(128&l)>0)return void(Ia-=8);if(e<10){if(8===e)return os(t,r,n,i,o,a,s,l);{let e=Aa[Ia++];return(128&e)>0?void(Ia-=9):os(t,r,n,i,o,a,s,l,e)}}if(e<12){let u=Aa[Ia++],c=Aa[Ia++];if((128&u)>0||(128&c)>0)return void(Ia-=10);if(e<11)return os(t,r,n,i,o,a,s,l,u,c);let h=Aa[Ia++];return(128&h)>0?void(Ia-=11):os(t,r,n,i,o,a,s,l,u,c,h)}{let u=Aa[Ia++],c=Aa[Ia++],h=Aa[Ia++],d=Aa[Ia++];if((128&u)>0||(128&c)>0||(128&h)>0||(128&d)>0)return void(Ia-=12);if(e<14){if(12===e)return os(t,r,n,i,o,a,s,l,u,c,h,d);{let e=Aa[Ia++];return(128&e)>0?void(Ia-=13):os(t,r,n,i,o,a,s,l,u,c,h,d,e)}}{let p=Aa[Ia++],f=Aa[Ia++];if((128&p)>0||(128&f)>0)return void(Ia-=14);if(e<15)return os(t,r,n,i,o,a,s,l,u,c,h,d,p,f);let m=Aa[Ia++];return(128&m)>0?void(Ia-=15):os(t,r,n,i,o,a,s,l,u,c,h,d,p,f,m)}}}}}function ls(e){return za.copyBuffers?Uint8Array.prototype.slice.call(Aa,Ia,Ia+=e):Aa.subarray(Ia,Ia+=e)}function us(e){let t=Aa[Ia++];if(Ba[t])return Ba[t](Aa.subarray(Ia,Ia+=e));throw new Error("Unknown extension type "+t)}var cs=new Array(4096);function hs(){let e=Aa[Ia++];if(!(e>=160&&e<192))return Ia--,$a();if(e-=160,Na>=Ia)return Pa.slice(Ia-Ra,(Ia+=e)-Ra);if(!(0==Na&&Ma<180))return Qa(e);let t,r=4095&(e<<5^(e>1?Ua.getUint16(Ia):e>0?Aa[Ia]:0)),n=cs[r],i=Ia,o=Ia+e-3,a=0;if(n&&n.bytes==e){for(;i<o;){if(t=Ua.getUint32(i),t!=n[a++]){i=1879048192;break}i+=4}for(o+=3;i<o;)if(t=Aa[i++],t!=n[a++]){i=1879048192;break}if(i===o)return Ia=i,n.string;o-=3,i=Ia}for(n=[],cs[r]=n,n.bytes=e;i<o;)t=Ua.getUint32(i),n.push(t),i+=4;for(o+=3;i<o;)t=Aa[i++],n.push(t);let s=e<16?ss(e):as(e);return n.string=null!=s?s:Qa(e)}var ds=(e,t)=>{var r=$a();let n=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,r.highByte=t);let i=Da[e];return i&&i.isShared&&((Da.restoreStructures||(Da.restoreStructures=[]))[e]=i),Da[e]=r,r.read=Ya(r,n),r.read()},ps="object"==typeof self?self:global;Ba[0]=()=>{},Ba[0].noBuffer=!0,Ba[101]=()=>{let e=$a();return(ps[e[0]]||Error)(e[1])},Ba[105]=e=>{let t=Ua.getUint32(Ia-4);La||(La=new Map);let r,n=Aa[Ia];r=n>=144&&n<160||220==n||221==n?[]:{};let i={target:r};La.set(t,i);let o=$a();return i.used?Object.assign(r,o):(i.target=o,o)},Ba[112]=e=>{let t=Ua.getUint32(Ia-4),r=La.get(t);return r.used=!0,r.target},Ba[115]=()=>new Set($a());var fs=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((e=>e+"Array"));function ms(e){let t=Ma,r=Ia,n=Ra,i=Na,o=Pa,a=La,s=ka,l=new Uint8Array(Aa.slice(0,Ma)),u=Da,c=Da.slice(0,Da.length),h=za,d=Va,p=e();return Ma=t,Ia=r,Ra=n,Na=i,Pa=o,La=a,ka=s,Aa=l,Va=d,(Da=u).splice(0,Da.length,...c),za=h,Ua=new DataView(Aa.buffer,Aa.byteOffset,Aa.byteLength),p}function vs(){Aa=null,La=null,Da=null}Ba[116]=e=>{let t=e[0],r=fs[t];if(!r)throw new Error("Could not find typed array for code "+t);return new ps[r](Uint8Array.prototype.slice.call(e,1).buffer)},Ba[120]=()=>{let e=$a();return new RegExp(e[0],e[1])},Ba[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],r=Ia;Ia+=t-4,(ka=[$a(),$a()]).position0=0,ka.position1=0;let n=Ia;Ia=r;try{return $a()}finally{Ia=n}},Ba[255]=e=>4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid");var gs=new Array(147);for(let l_=0;l_<256;l_++)gs[l_]=+("1e"+Math.floor(45.15-.30103*l_));var ys=new Ha({useRecords:!1});ys.unpack,ys.unpackMultiple,ys.unpack;var bs,xs=new Float32Array(1);new Uint8Array(xs.buffer,0,4);try{bs=new TextEncoder}catch{}var ws,_s,Ss,Os,Ts,Es=typeof Buffer<"u",Cs=Es?Buffer.allocUnsafeSlow:Uint8Array,As=Es?Buffer:Uint8Array,Ms=Es?4294967296:2144337920,Ds=0,Ps=null,ks=/[\u0080-\uFFFF]/,Ls=Symbol("record-id"),Us=class extends Ha{constructor(e){super(e),this.offset=0;let t,r,n,i,o,a=0,s=As.prototype.utf8Write?function(e,t,r){return Ss.utf8Write(e,t,r)}:!(!bs||!bs.encodeInto)&&function(e,t){return bs.encodeInto(e,Ss.subarray(t)).written},l=this;e||(e={});let u=e&&e.sequential,c=e.structures||e.saveStructures,h=e.maxSharedStructures;if(null==h&&(h=c?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;null==d&&(d=c?32:64),u&&!e.saveStructures&&(this.structures=[]);let p=h>32||d+h>64,f=h+64,m=h+d+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let v=[],g=0,y=0;this.pack=this.encode=function(e,s){if(Ss||(Ss=new Cs(8192),Os=new DataView(Ss.buffer,0,8192),Ds=0),(Ts=Ss.length-10)-Ds<2048?(Ss=new Cs(Ss.length),Os=new DataView(Ss.buffer,0,Ss.length),Ts=Ss.length-10,Ds=0):Ds=Ds+7&2147483640,t=Ds,o=l.structuredClone?new Map:null,l.bundleStrings?(Ps=["",""],Ss[Ds++]=214,Ss[Ds++]=98,Ps.position=Ds-t,Ds+=4):Ps=null,r=l.structures,r){r.uninitialized&&(r=l._mergeStructures(l.getStructures()));let e=r.sharedLength||0;if(e>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+r.sharedLength);if(!r.transitions){r.transitions=Object.create(null);for(let t=0;t<e;t++){let e=r[t];if(!e)continue;let n,i=r.transitions;for(let t=0,r=e.length;t<r;t++){let r=e[t];n=i[r],n||(n=i[r]=Object.create(null)),i=n}i[Ls]=t+64}a=e}u||(r.nextId=e+64)}n&&(n=!1),i=r||[];try{if(b(e),Ps){Os.setUint32(Ps.position+t,Ds-Ps.position-t);let e=Ps;Ps=null,b(e[0]),b(e[1])}if(l.offset=Ds,o&&o.idsToInsert){(Ds+=6*o.idsToInsert.length)>Ts&&w(Ds),l.offset=Ds;let e=function(e,t){let r,n=6*t.length,i=e.length-n;for(t.sort(((e,t)=>e.offset>t.offset?1:-1));r=t.pop();){let t=r.offset,o=r.id;e.copyWithin(t+n,t,i),n-=6;let a=t+n;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=255&o,i=t}return e}(Ss.subarray(t,Ds),o.idsToInsert);return o=null,e}return s&al?(Ss.start=t,Ss.end=Ds,Ss):Ss.subarray(t,Ds)}finally{if(r){if(y<10&&y++,g>1e4)r.transitions=null,y=0,g=0,v.length>0&&(v=[]);else if(v.length>0&&!u){for(let e=0,t=v.length;e<t;e++)v[e][Ls]=0;v=[]}if(n&&l.saveStructures){let n=r.sharedLength||h;r.length>n&&(r=r.slice(0,n));let i=Ss.subarray(t,Ds);return!1===l.saveStructures(r,a)?(l._mergeStructures(l.getStructures()),l.pack(e)):(a=n,i)}}s&sl&&(Ds=t)}};let b=e=>{Ds>Ts&&(Ss=w(Ds));var r,n=typeof e;if("string"===n){let t,n=e.length;if(Ps&&n>=8&&n<4096){let t=ks.test(e);return Ps[t?0:1]+=e,Ss[Ds++]=193,void b(t?-n:n)}t=n<32?1:n<256?2:n<65536?3:5;let i=3*n;if(Ds+i>Ts&&(Ss=w(Ds+i)),n<64||!s){let i,o,a,s=Ds+t;for(i=0;i<n;i++)o=e.charCodeAt(i),o<128?Ss[s++]=o:o<2048?(Ss[s++]=o>>6|192,Ss[s++]=63&o|128):55296==(64512&o)&&56320==(64512&(a=e.charCodeAt(i+1)))?(o=65536+((1023&o)<<10)+(1023&a),i++,Ss[s++]=o>>18|240,Ss[s++]=o>>12&63|128,Ss[s++]=o>>6&63|128,Ss[s++]=63&o|128):(Ss[s++]=o>>12|224,Ss[s++]=o>>6&63|128,Ss[s++]=63&o|128);r=s-Ds-t}else r=s(e,Ds+t,i);r<32?Ss[Ds++]=160|r:r<256?(t<2&&Ss.copyWithin(Ds+2,Ds+1,Ds+1+r),Ss[Ds++]=217,Ss[Ds++]=r):r<65536?(t<3&&Ss.copyWithin(Ds+3,Ds+2,Ds+2+r),Ss[Ds++]=218,Ss[Ds++]=r>>8,Ss[Ds++]=255&r):(t<5&&Ss.copyWithin(Ds+5,Ds+3,Ds+3+r),Ss[Ds++]=219,Os.setUint32(Ds,r),Ds+=4),Ds+=r}else if("number"===n)if(e>>>0===e)e<64?Ss[Ds++]=e:e<256?(Ss[Ds++]=204,Ss[Ds++]=e):e<65536?(Ss[Ds++]=205,Ss[Ds++]=e>>8,Ss[Ds++]=255&e):(Ss[Ds++]=206,Os.setUint32(Ds,e),Ds+=4);else if(e>>0===e)e>=-32?Ss[Ds++]=256+e:e>=-128?(Ss[Ds++]=208,Ss[Ds++]=e+256):e>=-32768?(Ss[Ds++]=209,Os.setInt16(Ds,e),Ds+=2):(Ss[Ds++]=210,Os.setInt32(Ds,e),Ds+=4);else{let t;if((t=this.useFloat32)>0&&e<4294967296&&e>=-2147483648){let r;if(Ss[Ds++]=202,Os.setFloat32(Ds,e),t<4||(r=e*gs[(127&Ss[Ds])<<1|Ss[Ds+1]>>7])>>0===r)return void(Ds+=4);Ds--}Ss[Ds++]=203,Os.setFloat64(Ds,e),Ds+=8}else if("object"===n)if(e){if(o){let r=o.get(e);if(r){if(!r.id){let e=o.idsToInsert||(o.idsToInsert=[]);r.id=e.push(r)}return Ss[Ds++]=214,Ss[Ds++]=112,Os.setUint32(Ds,r.id),void(Ds+=4)}o.set(e,{offset:Ds-t})}let n=e.constructor;if(n===Object)x(e,!0);else if(n===Array){(r=e.length)<16?Ss[Ds++]=144|r:r<65536?(Ss[Ds++]=220,Ss[Ds++]=r>>8,Ss[Ds++]=255&r):(Ss[Ds++]=221,Os.setUint32(Ds,r),Ds+=4);for(let t=0;t<r;t++)b(e[t])}else if(n===Map){(r=e.size)<16?Ss[Ds++]=128|r:r<65536?(Ss[Ds++]=222,Ss[Ds++]=r>>8,Ss[Ds++]=255&r):(Ss[Ds++]=223,Os.setUint32(Ds,r),Ds+=4);for(let[t,r]of e)b(t),b(r)}else{for(let t=0,r=ws.length;t<r;t++){if(e instanceof _s[t]){let r=ws[t];if(r.write)return r.type&&(Ss[Ds++]=212,Ss[Ds++]=r.type,Ss[Ds++]=0),void b(r.write.call(this,e));let n,i=Ss,o=Os,a=Ds;Ss=null;try{n=r.pack.call(this,e,(e=>(Ss=i,i=null,(Ds+=e)>Ts&&w(Ds),{target:Ss,targetView:Os,position:Ds-e})),b)}finally{i&&(Os=o,Ds=a,Ts=(Ss=i).length-10)}return void(n&&(n.length+Ds>Ts&&w(n.length+Ds),Ds=Rs(n,Ss,Ds,r.type)))}}x(e,!e.hasOwnProperty)}}else Ss[Ds++]=192;else if("boolean"===n)Ss[Ds++]=e?195:194;else if("bigint"===n){if(e<BigInt(1)<<BigInt(63)&&e>=-(BigInt(1)<<BigInt(63)))Ss[Ds++]=211,Os.setBigInt64(Ds,e);else if(e<BigInt(1)<<BigInt(64)&&e>0)Ss[Ds++]=207,Os.setBigUint64(Ds,e);else{if(!this.largeBigIntToFloat)throw new RangeError(e+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");Ss[Ds++]=203,Os.setFloat64(Ds,Number(e))}Ds+=8}else if("undefined"===n)this.encodeUndefinedAsNil?Ss[Ds++]=192:(Ss[Ds++]=212,Ss[Ds++]=0,Ss[Ds++]=0);else{if("function"!==n)throw new Error("Unknown type: "+n);b(this.writeFunction&&this.writeFunction())}},x=!1===this.useRecords?this.variableMapSize?e=>{let t,r=Object.keys(e),n=r.length;n<16?Ss[Ds++]=128|n:n<65536?(Ss[Ds++]=222,Ss[Ds++]=n>>8,Ss[Ds++]=255&n):(Ss[Ds++]=223,Os.setUint32(Ds,n),Ds+=4);for(let i=0;i<n;i++)b(t=r[i]),b(e[t])}:(e,r)=>{Ss[Ds++]=222;let n=Ds-t;Ds+=2;let i=0;for(let t in e)(r||e.hasOwnProperty(t))&&(b(t),b(e[t]),i++);Ss[n+++t]=i>>8,Ss[n+t]=255&i}:e=>{let t,r=Object.keys(e),o=i.transitions||(i.transitions=Object.create(null)),a=0;for(let n=0,i=r.length;n<i;n++){let e=r[n];t=o[e],t||(t=o[e]=Object.create(null),a++),o=t}let s=o[Ls];if(s)s>=96&&p?(Ss[Ds++]=96+(31&(s-=96)),Ss[Ds++]=s>>5):Ss[Ds++]=s;else{s=i.nextId,s||(s=64),s<f&&this.shouldShareStructure&&!this.shouldShareStructure(r)?(s=i.nextOwnId,s<m||(s=f),i.nextOwnId=s+1):(s>=m&&(s=f),i.nextId=s+1);let e=r.highByte=s>=96&&p?s-96>>5:-1;o[Ls]=s,i[s-64]=r,s<f?(r.isShared=!0,i.sharedLength=s-63,n=!0,e>=0?(Ss[Ds++]=96+(31&s),Ss[Ds++]=e):Ss[Ds++]=s):(e>=0?(Ss[Ds++]=213,Ss[Ds++]=114,Ss[Ds++]=96+(31&s),Ss[Ds++]=e):(Ss[Ds++]=212,Ss[Ds++]=114,Ss[Ds++]=s),a&&(g+=y*a),v.length>=d&&(v.shift()[Ls]=0),v.push(o),b(r))}for(let n=0,i=r.length;n<i;n++)b(e[r[n]])},w=e=>{let r;if(e>16777216){if(e-t>Ms)throw new Error("Packed buffer would be larger than maximum buffer size");r=Math.min(Ms,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else r=1+(Math.max(e-t<<2,Ss.length-1)>>12)<<12;let n=new Cs(r);return Os=new DataView(n.buffer,0,r),Ss.copy?Ss.copy(n,0,t,e):n.set(Ss.slice(t,e)),Ds-=t,t=0,Ts=n.length-10,Ss=n}}useBuffer(e){Ss=e,Os=new DataView(Ss.buffer,Ss.byteOffset,Ss.byteLength),Ds=0}};function Is(e,t,r,n){let i=e.byteLength;if(i+1<256){var{target:o,position:a}=r(4+i);o[a++]=199,o[a++]=i+1}else if(i+1<65536){var{target:o,position:a}=r(5+i);o[a++]=200,o[a++]=i+1>>8,o[a++]=i+1&255}else{var{target:o,position:a,targetView:s}=r(7+i);o[a++]=201,s.setUint32(a,i+1),a+=4}o[a++]=116,o[a++]=t,o.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function zs(e,t){let r=e.byteLength;var n,i;if(r<256){var{target:n,position:i}=t(r+2);n[i++]=196,n[i++]=r}else if(r<65536){var{target:n,position:i}=t(r+3);n[i++]=197,n[i++]=r>>8,n[i++]=255&r}else{var{target:n,position:i,targetView:o}=t(r+5);n[i++]=198,o.setUint32(i,r),i+=4}n.set(e,i)}function Rs(e,t,r,n){let i=e.length;switch(i){case 1:t[r++]=212;break;case 2:t[r++]=213;break;case 4:t[r++]=214;break;case 8:t[r++]=215;break;case 16:t[r++]=216;break;default:i<256?(t[r++]=199,t[r++]=i):i<65536?(t[r++]=200,t[r++]=i>>8,t[r++]=255&i):(t[r++]=201,t[r++]=i>>24,t[r++]=i>>16&255,t[r++]=i>>8&255,t[r++]=255&i)}return t[r++]=n,t.set(e,r),r+=i}function Ns(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");_s.unshift(e.Class),ws.unshift(e)}!function(e){e.unpack?Ba[e.type]=e.unpack:Ba[e.type]=e}(e)}_s=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,ja],ws=[{pack(e,t,r){let n=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&n>=0&&n<4294967296){let{target:e,targetView:r,position:i}=t(6);e[i++]=214,e[i++]=255,r.setUint32(i,n)}else if(n>0&&n<17179869184){let{target:r,targetView:i,position:o}=t(10);r[o++]=215,r[o++]=255,i.setUint32(o,4e6*e.getMilliseconds()+(n/1e3/4294967296>>0)),i.setUint32(o+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),r(this.onInvalidDate());let{target:e,targetView:n,position:i}=t(3);e[i++]=212,e[i++]=255,e[i++]=255}else{let{target:r,targetView:i,position:o}=t(15);r[o++]=199,r[o++]=12,r[o++]=255,i.setUint32(o,1e6*e.getMilliseconds()),i.setBigInt64(o+4,BigInt(Math.floor(n)))}}},{pack(e,t,r){let n=Array.from(e),{target:i,position:o}=t(this.structuredClone?3:0);this.structuredClone&&(i[o++]=212,i[o++]=115,i[o++]=0),r(n)}},{pack(e,t,r){let{target:n,position:i}=t(this.structuredClone?3:0);this.structuredClone&&(n[i++]=212,n[i++]=101,n[i++]=0),r([e.name,e.message])}},{pack(e,t,r){let{target:n,position:i}=t(this.structuredClone?3:0);this.structuredClone&&(n[i++]=212,n[i++]=120,n[i++]=0),r([e.source,e.flags])}},{pack(e,t){this.structuredClone?Is(e,16,t):zs(Es?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let r=e.constructor;r!==As&&this.structuredClone?Is(e,fs.indexOf(r.name),t):zs(e,t)}},{pack(e,t){let{target:r,position:n}=t(1);r[n]=193}}];var Bs=new Us({useRecords:!1});Bs.pack,Bs.pack;var Fs,js,Gs,Vs,Hs,Ws,qs,$s,Xs,Ys,Zs,Ks,Qs,Js,el,tl,rl,nl,il,ol,al=512,sl=1024,ll=new Us({structuredClone:!0});function ul(e){if(No(e))return e;if(Array.isArray(e))return e.map(ul);if("object"==typeof e&&null!==e){let t={};for(let r of Object.keys(e).sort())t[r]=ul(e[r]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}return e}Ns({Class:Lo.prototype.constructor,type:1,write:e=>({...e}),read:e=>(Object.setPrototypeOf(e,Lo.prototype),e)}),Ns({Class:Vo.prototype.constructor,type:2,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,Vo.prototype),e)}),Ns({Class:Go.prototype.constructor,type:3,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,Go.prototype),e)}),Ns({Class:Ea.prototype.constructor,type:4,write:e=>e.id,read:e=>new Ea(e)}),Ns({Class:Ca.prototype.constructor,type:5,write:e=>e.data,read:e=>new Ca(e)}),Ns({Class:Zo.prototype.constructor,type:6,write:e=>({...e}),read:e=>(Object.setPrototypeOf(e,Zo.prototype),e)}),(e=>{function t(e){return ll.pack(e)}e.serialize=t,e.deserialize=function(e){return ll.unpack(e)},e.checksum=function(e){return function(e){var t=0;if(0===e.length)return t;for(let r=0;r<e.length;r++)t=(t<<5)-t+e[r],t&=t;return t}(t(ul(e))).toString()}})(Fs||(Fs={})),(Gs=js||(js={})).isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Gs.lerp=function(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r]},(Hs=Vs||(Vs={})).isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Hs.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]},Hs.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},Hs.div=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2]]},Hs.mul=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]},Hs.dist=function(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},Hs.lerp=function(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r,e[2]+(t[2]-e[2])*r]},(e=>{e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.lerp=function(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r,e[2]+(t[2]-e[2])*r,e[3]+(t[3]-e[3])*r]}})(Ws||(Ws={})),($s=qs||(qs={})).identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$s.isEqual=function(e,t){for(let r=0;r<16;r++)if(e[r]!==t[r])return!1;return!0},$s.simplify=function(e){return e??$s.identity},$s.applyMatrix4=function(e,t){let r=t.slice(0);for(var n=0,i=t.length;n<i;n+=3){let i=e[3]*t[n]+e[7]*t[n+1]+e[11]*t[n+2]+e[15];r[n]=(e[0]*t[n]+e[4]*t[n+1]+e[8]*t[n+2]+e[12])/i,r[n+1]=(e[1]*t[n]+e[5]*t[n+1]+e[9]*t[n+2]+e[13])/i,r[n+2]=(e[2]*t[n]+e[6]*t[n+1]+e[10]*t[n+2]+e[14])/i}return r},(Ys=Xs||(Xs={})).isRGB=function(e){return"object"==typeof e&&"number"==typeof e.r&&"number"==typeof e.g&&"number"==typeof e.b},Ys.white={r:1,g:1,b:1},Ys.red={r:1,g:0,b:0},Ys.black={r:0,g:0,b:0},Ys.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:1}},Ys.clone=function(e){return{r:e.r,g:e.g,b:e.b}},Ys.fromHex=function(e){return{r:((e=Math.floor(e))>>16&255)/255,g:(e>>8&255)/255,b:(255&e)/255}},Ys.toHex=function(e){return 65536*Math.round(255*e.r)+256*Math.round(255*e.g)+Math.round(255*e.b)},Ys.equals=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b},Ys.lerp=function(e,t,r){return{r:e.r+(t.r-e.r)*r,g:e.g+(t.g-e.g)*r,b:e.b+(t.b-e.b)*r}},(e=>{e.white={...Xs.white,a:1},e.transparent={...Xs.white,a:0},e.from0to1=function(e){return{r:e[0],g:e[1],b:e[2],a:e[3]}},e.fromHexAndA=function(e,t){return{...Xs.fromHex(e),a:t}},e.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:e.a}},e.equals=function(e,t){return Xs.equals(e,t)&&e.a===t.a},e.lerp=function(e,t,r){return{r:e.r+(t.r-e.r)*r,g:e.g+(t.g-e.g)*r,b:e.b+(t.b-e.b)*r,a:e.a+(t.a-e.a)*r}}})(Zs||(Zs={})),(Ks||(Ks={})).identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},(Qs||(Qs={})).defaultData={mass:1,stiffness:80,damping:10,velocity:0},(Js||(Js={})).defaultData={control1:[.5,0],control2:[.5,1]},(tl=el||(el={})).linear=[0,0,1,1],tl.ease=[.25,.1,.25,1],tl.easeIn=[.42,0,1,1],tl.easeOut=[0,0,.58,1],tl.easeInOut=[.42,0,.58,1],(e=>{e.all=["PerspectiveCamera","OrthographicCamera"],e.is=function(t){return e.all.includes(t)}})(rl||(rl={})),(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1,autoZoom:!1,autoZoomFrustumSize:790},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset},e.getZoom=function(e){return"PerspectiveCamera"===e.type?e.perspective.zoom:e.orthographic.zoom}})(nl||(nl={})),(e=>{e.defaultData=function(e,t=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:2*Math.max(e[0],e[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[e[0]+e[0]*t,0,0]},grid:{count:[2,2,2],size:e.map((e=>e*(1+t))),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}},e.merge=function(e,t){let r={...e};if(yl.forEach((n=>{Object.assign(r,{[n]:t[n]??e[n]})})),r.radial={...e.radial},t.radial){let n=e.radial,i=t.radial;bl.forEach((e=>{Object.assign(r.radial,{[e]:i[e]??n[e]})}))}if(r.linear={...e.linear},t.linear){let n=e.linear,i=t.linear;xl.forEach((e=>{Object.assign(r.linear,{[e]:i[e]??n[e]})}))}if(r.grid={...e.grid},t.grid){let n=e.grid,i=t.grid;wl.forEach((e=>{Object.assign(r.grid,{[e]:i[e]??n[e]})}))}if(r.toObject={...e.toObject},t.toObject){let n=e.toObject,i=t.toObject;_l.forEach((e=>{Object.assign(r.toObject,{[e]:i[e]??n[e]})}))}if(r.randomnessObject={...e.randomnessObject},t.randomnessObject){let n=e.randomnessObject,i=t.randomnessObject;Sl.forEach((e=>{Object.assign(r.randomnessObject,{[e]:i[e]??n[e]})}))}return r}})(il||(il={})),(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];e.toOps=function(e,r){let n=[];void 0!==e.count&&n.push({type:0,path:r,props:{count:e.count}});for(let i of t){let t=e[i];t&&Object.keys(t).length>0&&n.push({type:0,path:[...r,i],props:t})}return n}})(ol||(ol={}));var cl,hl,dl,pl,fl,ml,vl,gl,yl=["count"],bl=["radius","start","end","position","scale","rotation"],xl=["position","scale","rotation"],wl=["count","size"],_l=["count","position","scale","rotation"],Sl=["strength","scale","rotation","position","movement","seed","freqScale"];(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],e.is=function(t){return e.all.includes(t)}})(cl||(cl={})),(hl||(hl={})).defaultData=function(e){return function(e){if("PointLight"===e)return{type:e,color:Zs.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,depth:1e5};if("SpotLight"===e)return{type:e,color:Zs.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===e)return{type:e,color:Zs.white,intensity:1,shadows:!0,size:2e3,depth:1e5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}(e)},(e=>{e.defaultData={castShadow:!0,receiveShadow:!0},e.equals=function(e,t){return e.castShadow===t.castShadow&&e.receiveShadow===t.receiveShadow}})(dl||(dl={})),(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0},e.equals=function(e,t){return e.flatShading===t.flatShading&&e.side===t.side&&e.wireframe===t.wireframe}})(pl||(pl={})),(fl||(fl={})).defaultData={...pl.defaultData,...dl.defaultData},(e=>{e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7})(ml||(ml={})),(vl||(vl={})).is=function(e){return"texture"===e||"video"===e||"color"===e||"depth"===e||"normal"===e||"gradient"===e||"noise"===e||"fresnel"===e||"rainbow"===e||"toon"===e||"outline"===e||"transmission"===e||"matcap"===e||"displace"===e||"pattern"===e||"light"===e},(gl||(gl={})).is=function(e){return"phong"===e||"toon"===e||"lambert"===e||"physical"===e};var Ol,Tl,El,Cl,Al=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],Ml=["wrapping","image","video"];(e=>{e.patch=function(e,t){let{texture:r,...n}=t;if(Object.assign(e,n),r){let t=e.texture;t&&Object.assign(t,r)}},e.defaultData=function(e,t){return"light"===e&&t?function(e){let t={mode:0,isMask:!1,visible:!0};switch(e){case"phong":return{...t,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...t,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...t,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...t,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}(t):function(e){let t={alpha:1,mode:0,isMask:!1,visible:!0};switch(e){case"texture":return{...t,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0]},crop:!1};case"video":return{...t,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:ml.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!1};case"color":return{...t,type:"color",color:Xs.fromHex(5526619)};case"depth":return{...t,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...t,type:"normal",cnormal:[1,1,1]};case"gradient":return{...t,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...t,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...Xs.fromHex(6710886),a:1},colorB:{...Xs.fromHex(6710886),a:1},colorC:{...Xs.fromHex(16777215),a:1},colorD:{...Xs.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...t,type:"fresnel",color:Zs.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...t,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...t,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Zs.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...t,type:"outline",outlineColor:Zs.fromHexAndA(0,1),contourColor:Zs.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...t,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{...t,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...t,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...Xs.fromHex(0),a:1},colorB:{...Xs.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}(e)}})(Ol||(Ol={})),(e=>{function t(e,t="layer1",r="layer2"){let n=new Vo;return n.push({fi:0,data:Ol.defaultData("light",e),id:t}),n.push({fi:1,data:Ol.defaultData("color"),id:r}),{layers:n}}e.isMergable=function(e){return!e.layers.some((e=>"texture"===e.data.type&&0!==e.data.projection||"depth"===e.data.type&&!e.data.isWorldSpace||"noise"===e.data.type||"displace"===e.data.type))},e.getHash=function(e){let t="";return e.layers.forEach((e=>{Object.entries(e.data).forEach((([e,r])=>{t+=`${e}${r}`,Array.isArray(r)?r.forEach((e=>t+=`${e}`)):"object"==typeof r?Object.values(r).forEach((e=>{t+="number"==typeof e?`${e.toFixed(4)}`:`${e}`})):t+=`${r}`}))})),t},e.defaultEmptyData=function(){return{layers:new Vo}},e.defaultData=function(e="layer1",r="layer2"){return t("phong",e,r)},e.withName=function(e,t){return{...e,name:t}},e.defaultTwoLayerData=t,e.defaultTwoLayerTextureData=function(e,t="phong",r="layer1",n="layer2"){let i=Ol.defaultData("texture");Object.assign(i.texture,{image:e});let o=new Vo;return o.push({fi:0,data:i,id:r}),o.push({fi:1,data:Ol.defaultData("light",t),id:n}),{layers:o}},e.defaultTwoLayerVideoTextureData=function(e,t="phong",r="layer1",n="layer2"){let i=Ol.defaultData("video");Object.assign(i.texture,{video:e});let o=new Vo;return o.push({fi:0,data:i,id:r}),o.push({fi:1,data:Ol.defaultData("light",t),id:n}),{layers:o}}})(Tl||(Tl={})),(El||(El={})).defaultData=function(){return{points:new Vo,roundness:0,shapeHoles:[],isClosed:!1}},(Cl||(Cl={})).defaultData=function(){return{points:new Vo,lastInsertionPlane:null,subdivisions:12,isClosed:!1}};var Dl,Pl={type:"Ellipse",width:100,height:100,spikes:64,angle:360,innerRadius:0};(Dl||(Dl={})).merge=function(e,t){let r={...e};return nu.forEach((n=>{Object.assign(r,{[n]:t[n]??e[n]})})),r};var kl,Ll,Ul,Il,zl,Rl,Nl,Bl,Fl,jl,Gl,Vl,Hl,Wl,ql,$l,Xl,Yl,Zl,Kl,Ql,Jl,eu,tu,ru={shape:Pl,depth:1,offset:0,bevel:0,bevelSides:1,angle:0,twist:0,startScale:1,endScale:1},nu=["depth","offset","angle","twist","startScale","endScale"];function iu(e){e.layers.forEach((e=>{if("depth"===e.type&&void 0!==e.colorA){let t=e.colorA,r=e.colorB,n=[[t.r,t.g,t.b,t.a],[r.r,r.g,r.b,r.a]],i=[0,1];for(let e=2;e<10;e++)n.push(n[1]),i.push(1);let o={...ko(_a(e),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,e.near),far:Math.max(0,e.far),colors:n,steps:i,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(e,o)}else if("depth"===e.type&&1===e.gradientType&&(e.near<0||e.far<0)){let t={..._a(e),near:Math.max(e.near,0),far:Math.max(e.far,0)};Object.assign(e,t)}}))}function ou(e,t){Object.values(e.shared.materials).forEach((e=>t(e)))}function au(e,t){e.scene.objects.traverse(((e,r)=>{"materials"in r?r.materials.forEach((e=>{"string"!=typeof e&&t(e)})):"material"in r&&"string"!=typeof r.material&&t(r.material)}))}function su(e){void 0===e.layers&&Object.assign(e,Tl.defaultTwoLayerData("lambert"))}function lu(e){!e.layers||e.layers.forEach((e=>{if("depth"===e.type&&10===e.colors.length){let t=[...e.colors];t.push(e.colors[9]);let r=[...e.steps];r.push(e.steps[9]);let n={..._a(e),colors:t,steps:r};Object.assign(e,n)}}))}function uu(e){e.scene.objects.traverse(((e,t)=>{"materials"in t?t.materials.forEach((e=>{"string"!=typeof e&&lu(e)})):"material"in t&&"string"!=typeof t.material&&lu(t.material)})),Object.values(e.shared.materials).forEach((e=>lu(e)))}function cu(e){e.layers&&e.layers.forEach((e=>{"depth"===e.type&&void 0!==e.num&&(e.colors=e.colors.slice(0,e.num),e.steps=e.steps.slice(0,e.num),delete e.num)}))}function hu(e){e.layers&&e.layers.forEach((e=>{(function(e){return"displace"!==e.type})(e)&&void 0===e.isMask&&(e.isMask=!1),("texture"===e.type||"video"===e.type)&&void 0===e.blending&&(e.blending=0),("noise"===e.type||"displace"===e.type&&"noise"===e.displacementType)&&(void 0===e.voronoiStyle&&(e.voronoiStyle=0),void 0===e.highCut&&(e.highCut=1),void 0===e.lowCut&&(e.lowCut=0),void 0===e.smoothness&&(e.smoothness=.3),void 0===e.seed&&(e.seed=0),void 0===e.quality&&(e.quality=1))}))}function du(e){var t;let r=null==(t=e.layers.find((e=>"light"===e.type)))?void 0:t.data;if("basic"===(null==r?void 0:r.category)){let e=Ol.defaultData("light","phong"),t=r;Object.assign(t,e),t.visible=!1}}function pu(e){ou(e,du),au(e,du)}function fu(e){e.layers.forEach((e=>{"light"===e.type&&"toon"!==e.category&&void 0===e.occlusion&&(e.occlusion=!0)}))}(e=>{e.is2DParametricMesh=function(e){return"PolygonGeometry"===e||"RectangleGeometry"===e||"StarGeometry"===e||"TriangleGeometry"===e||"EllipseGeometry"===e},e.isParametricMesh=function(e){return"PolygonGeometry"===e||"PolygonGeometry"===e||"RectangleGeometry"===e||"StarGeometry"===e||"TriangleGeometry"===e||"EllipseGeometry"===e||"PathGeometry"===e||"VectorGeometry"===e||"ConeGeometry"===e||"CubeGeometry"===e||"CylinderGeometry"===e||"DodecahedronGeometry"===e||"HelixGeometry"===e||"IcosahedronGeometry"===e||"LatheGeometry"===e||"PyramidGeometry"===e||"SphereGeometry"===e||"PlaneGeometry"===e||"BackdropGeometry"===e||"TorusGeometry"===e||"TorusKnotGeometry"===e||"BooleanGeometry"===e||"TextGeometry"===e}})(kl||(kl={})),(Ll||(Ll={})).merge=function(e,t){let r={...e};return Object.assign(r,t),"PathGeometry"===r.type&&"extrusion"in t&&t.extrusion&&(r.extrusion={...e.extrusion},Object.assign(r.extrusion,Dl.merge(r.extrusion,t.extrusion))),r},(Ul||(Ul={})).defaultData=function(e){if("RectangleGeometry"===e)return{width:320,height:320,type:e,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("PathGeometry"===e)return{type:e,width:1,height:1,depth:1,path:Cl.defaultData(),extrusion:ru};if("VectorGeometry"===e)return{width:1,height:1,type:e,subdivisions:12,shape:El.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===e)return{type:e,operation:2,width:0,height:0,depth:0,phongAngle:35};if("TextGeometry"===e)return{type:e,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:"",textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};if("SphereGeometry"===e)return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI};throw new Error("not implemented")},(e=>{e.isComponentRelated=function(e){return"Component"===e||"Instance"===e},e.isEmptyOrComponent=function(e){return"Empty"===e||"Instance"===e}})(Il||(Il={})),(e=>{e.identity={...Ks.identity,hiddenMatrix:qs.identity},e.fromObject=function(e){return{position:e.position,rotation:e.rotation,scale:e.scale,hiddenMatrix:e.hiddenMatrix}},e.merge=function(e,t){return{position:(null==t?void 0:t.position)||e.position,rotation:(null==t?void 0:t.rotation)||e.rotation,scale:(null==t?void 0:t.scale)||e.scale,hiddenMatrix:(null==t?void 0:t.hiddenMatrix)||e.hiddenMatrix}},e.diff=function(e,t){return function(e){for(let t of Object.keys(e))void 0===e[t]&&delete e[t];return e}({position:Vs.isEqual(e.position,t.position)?void 0:t.position,rotation:Vs.isEqual(e.rotation,t.rotation)?void 0:t.rotation,scale:Vs.isEqual(e.scale,t.scale)?null:t.scale,hiddenMatrix:qs.isEqual(e.hiddenMatrix,t.hiddenMatrix)?void 0:t.hiddenMatrix})}})(zl||(zl={})),(Rl||(Rl={})).defaultData={fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]},(Nl||(Nl={})).defaultData={states:new Vo,events:new Vo,visible:!0,raycastLock:!1,collision:"visibility",physics:null,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...zl.identity,cloner:null},(Bl||(Bl={})).defaultData={type:"Empty",...Nl.defaultData},(Fl||(Fl={})).defaultData={type:"Component",...Nl.defaultData},(jl||(jl={})).defaultData={type:"Mesh",...Nl.defaultData,...fl.defaultData},(Gl||(Gl={})).defaultData={...Nl.defaultData,...zl.identity,...nl.defaultData},(Vl||(Vl={})).defaultData=function(e){return{...Nl.defaultData,...hl.defaultData(e)}},(e=>{function t(e,t,r=0){for(;r<t.length;){let n=e?e[t[r]]:void 0;if(t.length===r+1)return n;if(!n)return;e=n.descendants,r+=1}}e.resolveWithDes=t,e.resolve=function(e,r,n=0){let i=t(e,r,n);if(i){let e=Object.keys(i);if(1===e.length&&"descendants"===e[0])return}return i}})(Hl||(Hl={})),(e=>{function t(e,t){return{...Nl.defaultData,...t,component:e,overrides:new Zo,physics:void 0,type:"Instance"}}e.rootOverrideProps=["physics"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"],e.ofComponent=t,e.fromComponentData=function(e){let r=zl.fromObject(e.data);return t(e.id,r)}})(Wl||(Wl={})),(e=>{e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:qs.identity,name:"Play Camera",visible:!0,raycastLock:!1,collision:"visibility",physics:null,states:new Vo,events:new Vo,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...nl.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...Nl.defaultData,...jl.defaultData,geometry:Ul.defaultData("RectangleGeometry"),material:Tl.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...Nl.defaultData,...jl.defaultData,geometry:Ul.defaultData("BooleanGeometry"),material:Tl.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...Nl.defaultData,...jl.defaultData,geometry:Ul.defaultData("TextGeometry"),material:Tl.defaultTwoLayerData("phong","layer1","layer2")}})(ql||(ql={})),(e=>{e.newEmpty=function(e,t){let r={name:t};return"Mesh"===e.type?(r.geometry={},"material"in e&&(r.material={layers:new Zo}),"materials"in e&&(r.materials=e.materials.map((e=>({layers:new Zo}))))):rl.is(e.type)&&(r.perspective={},r.orthographic={}),r},e.toOps=function(e,t){let r,n=[],i={orthographic:0,perspective:0,geometry:0};function o(e,t){for(let[r,i]of Object.entries(t.layers)){let{texture:t,...o}=i;if(void 0!==t&&Object.keys(t).length>0){let i={path:[...e,"layers",r,"texture"],props:t,type:0};n.push(i)}if(Object.keys(o).length>0){let t={path:[...e,"layers",r],props:o,type:0};n.push(t)}}}for(let[a,s]of Object.entries(t))if("name"!==a)if("cloner"===a)n.push(...ol.toOps(s,["cloner"]));else if("pathSnapping"===a)n.push({path:[a],props:{slide:s.slide,offset:s.offset},type:0});else if("material"===a)o(["material"],s);else if("materials"===a)for(let[e,t]of Object.entries(s))o(["materials",e],t);else if(0===i[a]){if("geometry"===a&&void 0!==s.extrusion){let e={path:[a,"extrusion"],props:s.extrusion,type:0};n.push(e),s={...s},delete s.extrusion}if(Object.keys(s).length>0){let e={path:[a],props:s,type:0};n.push(e)}}else void 0===r&&(r={path:[],props:{},type:0},n.push(r)),r.props[a]=s;return n},e.patch=function(e,t){var r,n,i,o,a,s;if(void 0===t)return e;let l={...e};if(Object.assign(l,zl.merge(l,t)),Object.assign(l,{pathSnapping:Object.assign({},l.pathSnapping,{slide:(null==(r=t.pathSnapping)?void 0:r.slide)??(null==(n=l.pathSnapping)?void 0:n.slide)??0,offset:(null==(i=t.pathSnapping)?void 0:i.offset)??(null==(o=l.pathSnapping)?void 0:o.offset)??0})}),rl.is(e.type)){l.orthographic={...l.orthographic},l.perspective={...l.perspective};let e=t;void 0!==(null==(a=e.orthographic)?void 0:a.zoom)&&(l.orthographic.zoom=e.orthographic.zoom),void 0!==(null==(s=e.perspective)?void 0:s.zoom)&&(l.perspective.zoom=e.perspective.zoom),void 0!==e.isUpVectorFlipped&&(l.isUpVectorFlipped=e.isUpVectorFlipped),void 0!==e.targetOffset&&(l.targetOffset=e.targetOffset)}else if("Mesh"===e.type)"geometry"in t&&Object.assign(l,{geometry:Ll.merge(l.geometry,t.geometry)}),(t.material||t.materials)&&(l=function(e,t){if(void 0===t)return e;let r={...e};return"material"in r&&"material"in t&&t.material&&(r.material=wa(r.material,(e=>{if("string"!=typeof e)for(let[r,n]of Object.entries(t.material.layers)){let t=e.layers.data(r);t&&Ol.patch(t,n)}})).data),r.materials&&t.materials&&(r.materials=wa(r.materials,(e=>{var n,i;for(let o=0;o<r.materials.length;o++){let r=t.materials[o];if("string"!=typeof r)for(let[t,a]of Object.entries(r.layers)){let r=null==(i=null==(n=e[o])?void 0:n.layers)?void 0:i.data(t);r&&Ol.patch(r,a)}}})).data),r}(l,t)),l.cloner&&"cloner"in t&&Object.assign(l,{cloner:il.merge(l.cloner,t.cloner)});else if("Empty"===e.type)l.cloner&&"cloner"in t&&Object.assign(l,{cloner:il.merge(l.cloner,t.cloner)});else if(cl.is(e.type)){let e=t;void 0!==e.intensity&&(l.intensity=e.intensity),void 0!==e.color&&("string"==typeof e.color?l.color=e.color:l.color=Xs.clone(e.color))}return l}})($l||($l={})),(Xl||(Xl={})).defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0,autoZoom:!1},(Yl||(Yl={})).defaultData={orbitControls:Xl.defaultData,playCamera:null,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,joystickSizeAndXYOffset:Array(12).fill(0).map(((e,t)=>{let r=0,n=0;return t<5?n=-30:t<10&&(n=30),0===t||10===t||5===t?r=30:(4===t||11===t||9===t)&&(r=-30),[120,[r,n],"show"]})),gameControlObject:null,hdTransmission:!1},(Zl||(Zl={})).defaultData={id:"basic",label:"Basic",style:"None",prompt:""},(Kl||(Kl={})).defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0},(e=>{e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...Zl.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:Kl.defaultData}),e.generateSeed=()=>Math.round(1e5*Math.random())})(Ql||(Ql={})),(Jl||(Jl={})).emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII="},(e=>{e.defaultColors=function(){let e={"89b10010-844c-11ec-a8a3-0242ac120002":{r:.5,g:.5,b:.5,a:1,name:"Default Color"}};return Ve(e,Lo.prototype)},e.defaultImages=function(e){let t={};return(null==e?void 0:e.withAITexture)&&(t["a1b10010-844c-a8a3-11ec-0242ac2011ec"]={...Jl.emptyImage,name:"AI generated image"}),Ve(t,Lo.prototype)},e.emptyData=function(){return{materials:new Lo,images:new Lo,videos:new Lo,colors:new Lo,audios:new Lo,fonts:new Lo,penumbraSize:[2,2,2]}}})(eu||(eu={})),(e=>{e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",speedTranslate:1e3,speedRotate:100,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new Vo,move:new Vo,jump:new Vo},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:Zs.fromHexAndA(3728051,1)}}})(tu||(tu={}));var mu=41;function vu(e){let t=e.schema??0;t!==mu&&(t<1&&(au(e,iu),ou(e,iu),e.schema=1),t<2&&(function(e){Object.assign(e.scene.publish,{orbitControls:{...Xl.defaultData,..._a(e.scene.publish.orbitControls)}})}(e),e.schema=2),t<3&&(function(e){function t(e){if(e.layers)for(let t of Object.values(e.layers))if(t)for(let[e,r]of Object.entries(t))if((Al.includes(e)||"boolean"==typeof r)&&delete t[e],"texture"===e)for(let[t,n]of Object.entries(r))(Ml.includes(t)||"boolean"==typeof n)&&delete r[t]}e.scene.objects.traverse(((e,r)=>{r.states.forEach((e=>{let r=e;r.material?t(r.material):r.materials&&r.materials.forEach((e=>{t(e)}))}))}))}(e),e.schema=3),t<4&&(function(e){e.scene.publish.withBackground=!0}(e),e.schema=4),t<5&&(function(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}(e),e.schema=5),t<6&&(function(e){e.scene.objects.traverse(((e,t)=>{let r=t.cloner;r&&(r.radial.scale=r.radial.scale.map((e=>e+1)),r.linear.scale=r.linear.scale.map((e=>e+1)))}))}(e),e.schema=6),t<7&&(function(e){e.scene.objects.traverse(((e,t)=>{let r=t.geometry;r&&("DodecahedronGeometry"===r.type||"IcosahedronGeometry"===r.type)&&(r.detail=Math.round(r.detail))}))}(e),e.schema=7),t<8&&(e.schema=8),t<9&&(uu(e),e.schema=9),t<10&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&("BooleanGeometry"===t.geometry.type||"SubdivGeometry"===t.geometry.type)&&(t.geometry.phongAngle=35)}))}(e),e.schema=10),t<11&&(function(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse(((e,t)=>{("DirectionalLight"===t.type||"SpotLight"===t.type)&&(t.shadowResolution=1024,t.shadowRadius=1,t.depth=1e5)})),e.shared.penumbraSize=new Array(5).fill(.5)}(e),e.schema=11),t<12&&(uu(e),e.schema=12),t<13&&(function(e){e.shared.audios=Ve({},Lo.prototype)}(e),e.schema=13),t<14&&(function(e){let t=e.shared.materials;Object.entries(t).forEach((([e,r])=>{if(!r.layers){let r={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[e]:r})}}))}(e),e.schema=14),t<15&&(function(e){Object.entries(_a(e.shared.images)).filter((e=>!1===e[1].asset)).map((e=>e[0])).forEach((t=>{delete e.shared.images[t]})),Object.entries(_a(e.shared.audios)).filter((e=>!1===e[1].asset)).map((e=>e[0])).forEach((t=>{delete e.shared.audios[t]}))}(e),e.schema=15),t<16&&(function(e){e.scene.publish.settings.web.preload=!1}(e),e.schema=16),t<17&&(au(e,cu),ou(e,cu),e.schema=17),t<18&&(au(e,su),ou(e,su),e.schema=18),t<19&&(function(e){Object.assign(e.scene.publish.settings,{video:{...Yl.defaultData.settings.video,..._a(e.scene.publish.settings.video)}})}(e),e.schema=19),t<20&&(function(e){e.shared.fonts=Ve({},Lo.prototype)}(e),function(e){let t=[];e.scene.objects.traverse(((r,n)=>{let i=n;if("TextFrame"===i.type){let n=Tl.defaultTwoLayerData("phong"),o="string"==typeof i.color?e.shared.colors[i.color]:i.color;n.layers[1].data.color={r:o.r,g:o.g,b:o.b},n.layers[1].data.alpha=i.alpha;let a=function(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")}(i.font);void 0===e.shared.fonts[a]&&(e.shared.fonts[a]={name:a});let s={name:i.name,...Nl.defaultData,...jl.defaultData,flatShading:!1,wireframe:!1,geometry:{...Ul.defaultData("TextGeometry"),width:i.width,height:i.height,font:a,depth:0,horizontalAlign:i.horizontalAlign,verticalAlign:i.verticalAlign,fontSize:1.40625*i.fontSize,lineHeight:i.lineHeight/1.40625,letterSpacing:i.letterSpacing-1,text:i.text,textTransform:i.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:n,states:_a(i.states),events:_a(i.events),visible:i.visible,raycastLock:i.raycastLock,position:i.position,rotation:i.rotation,scale:i.scale,hiddenMatrix:i.hiddenMatrix},l=_a(e.scene.objects).parent(r);e.scene.objects.insertAfter(l??null,r,[{id:r+"new",data:s,children:[]}]),t.push(r)}})),t.forEach((t=>{e.scene.objects.delete(t)}))}(e),e.schema=20),t<21&&(function(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse(((e,r)=>{r.events.forEach((e=>{if(t[Number(e.type)])if(Object.assign(e,{type:t[Number(e.type)]}),"Audio"===e.type&&"audioEvent"in e&&(Object.assign(e,{playAudio:e.audioEvent}),delete e.audioEvent),"GameControl"===e.type)Object.assign(e,{gameActions:{idle:new Vo,move:new Vo,jump:new Vo}});else{let t=new Vo;Object.assign(e,{actions:t}),("MouseDown"===e.type||"MouseUp"===e.type||"KeyDown"===e.type||"KeyUp"===e.type)&&"url"in e&&t.push({fi:0,id:b.generateUUID(),data:{type:"Link",url:e.url,delay:0}}),"targets"in e&&(e.targets.forEach(((e,r,n)=>{let i={easing:e.easing,duration:e.duration};6===e.easing?Object.assign(i,ko(e,"mass","stiffness","damping","velocity")):5===e.easing&&Object.assign(i,{control1:{...e.control1},control2:{...e.control2}});let o={repeat:e.repeat?-1:0,delay:e.delay,delayDirection:e.delayDirection,direction:e.cycle&&e.rewind?"pingpong-rewind":e.cycle?"pingpong":"normal"},a={state:e.state,...o,...i},s={allowSlerp:!0,type:"Transition",object:e.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new Vo({fi:0,id:b.generateUUID(),data:{state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4}},{fi:1,id:b.generateUUID(),data:a})};t.push({fi:n,id:r,data:s})})),delete e.targets)}}))}))}(e),function(e){e.scene.objects.traverse(((e,t)=>{function r(e,r){var n;let i=new Vo,o=[];if(t.events.forEach(((e,t,n)=>{if("Audio"===e.type&&e.trigger===r){let r;o.push(t),"play"===e.interaction?r={...ko(e,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in e?e.after:void 0,toggle:"after"in e?e.toggle:void 0,type:"Audio"}:("pause"===e.interaction||"stop"===e.interaction)&&(r={...ko(e,"interaction","delay","object","playAudio"),type:"Audio"}),r&&i.push({fi:n,id:t,data:r})}})),o.forEach((e=>t.events.delete(e))),i.length){let r=null==(n=t.events.find((t=>t.type===e)))?void 0:n.data;r?"actions"in r&&r.actions.insertBefore(null,i):t.events.insertBefore(null,[{id:b.generateUUID(),data:{type:e,actions:i}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")}))}(e),e.schema=21),t<22&&(pu(e),e.schema=22),t<23&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&"SubdivGeometry"===t.geometry.type&&(t.geometry.scaleBaked||(t.geometry.scaleBaked=[1,1,1]))}))}(e),e.schema=23),t<24&&(function(e){e.scene.objects.traverse(((e,t)=>{("Empty"===t.type||"Mesh"===t.type)&&t.cloner&&!t.cloner.randomnessObject&&!t.cloner.toObject&&!t.cloner.randomness&&(t.cloner={...t.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})}))}(e),e.schema=24),(t<25||void 0===e.shared.videos)&&(function(e){e.shared.videos=Ve({},Lo.prototype)}(e),t<25&&(e.schema=25)),t<26&&(function(e){e.scene.objects.traverse(((t,r)=>{let n=e.scene.objects.unproxy().parent(t);if(n){let t=_a(e.scene.objects.data(n));t&&"Mesh"===t.type&&"BooleanGeometry"===t.geometry.type&&"Mesh"===r.type&&(r.visible=!0!==_a(r).booleanExclude)}}))}(e),e.schema=26),t<27&&(function(e){e.scene.objects.traverse(((e,t)=>{if("Mesh"===t.type){let e=t;"NonParametricGeometry"===t.geometry.type?void 0!==e.material&&delete e.material:void 0!==e.materials&&delete e.materials}}))}(e),e.schema=27),t<28&&(pu(e),e.schema=28),t<29&&(function(e){function t(e){Object.setPrototypeOf(e,Zo.prototype),e.texture&&Object.setPrototypeOf(e.texture,Zo.prototype)}function r(e){Object.setPrototypeOf(e,Zo.prototype);for(let r in e)t(e[r])}e.scene.objects.traverse(((e,t)=>{t.states.forEach((e=>{let t=e;if(t.material){let e=_a(t.material).layers;r(e),t.material.layers=e}if(t.materials)for(let n=0;n<t.materials.length;n++){let e=t.materials[n],i=_a(e).layers;r(i),e.layers=i}}))}))}(e),e.schema=29),t<30&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&"NonParametricGeometry"===t.geometry.type&&!("material"in t)&&!("materials"in t)&&(t.material=Tl.defaultTwoLayerData("phong"))}))}(e),e.schema=30),t<31&&(function(e){void 0===e.scene.publish.orbitControls.autoZoom&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse(((e,t)=>{("OrthographicCamera"===t.type||"PerspectiveCamera"===t.type)&&(void 0===t.orthographic.autoZoom&&(t.orthographic.autoZoom=!1),void 0===t.orthographic.autoZoomFrustumSize&&(t.orthographic.autoZoomFrustumSize=790))}))}(e),e.schema=31),t<33&&(function(e){e.scene.objects.traverse(((e,t)=>{void 0===t.pathSnapping&&(t.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),void 0===t.pathSnapping.offset&&(t.pathSnapping.offset=0)}))}(e),e.schema=33),t<34&&(function(e){void 0===e.scene.publish.mouseEventTarget&&(e.scene.publish.mouseEventTarget="canvas"),void 0===e.scene.publish.settings.web.hint&&(e.scene.publish.settings.web.hint=!1)}(e),e.schema=34),t<35&&(function(e){let{video:t}=e.scene.publish.settings;"gif"===t.format&&t.fps>48&&(t.fps=15)}(e),e.schema=35),t<36&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&(e.resetYPosition=Math.abs(e.resetYPosition-t.position[1]))}))}))}(e),e.schema=36),t<37&&(function(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse(((e,r)=>{t&&null===r.physics?r.collision=!1:r.collision="visibility"}))}(e),e.schema=37),t<38&&(au(e,hu),ou(e,hu),e.schema=38),t<39&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&(e.navmesh=tu.defaultDataThirdPerson.navmesh)}))}))}(e),e.schema=39),t<40&&(function(e){e.scene.styles||(e.scene.styles=Ql.defaultData())}(e),e.schema=40),t<41&&(function(e){void 0===e.scene.environment.ambientLight.occlusion&&(e.scene.environment.ambientLight.occlusion=!1),void 0===e.scene.environment.ambientLight.aoFullRes&&(e.scene.environment.ambientLight.aoFullRes=!1),void 0===e.scene.environment.ambientLight.radius&&(e.scene.environment.ambientLight.radius=256),void 0===e.scene.environment.ambientLight.bias&&(e.scene.environment.ambientLight.bias=.5),void 0===e.scene.environment.ambientLight.aoColor&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),au(e,fu),ou(e,fu)}(e),e.schema=41))}var gu=Ne(Be()),yu=.5*(Math.sqrt(3)-1),bu=(3-Math.sqrt(3))/6,xu=1/6,wu=e=>0|Math.floor(e),_u=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),Su=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function Ou(e=Math.random){let t=Tu(e),r=new Float64Array(t).map((e=>_u[e%12*2])),n=new Float64Array(t).map((e=>_u[e%12*2+1]));return function(e,i){let o,a,s=0,l=0,u=0,c=(e+i)*yu,h=wu(e+c),d=wu(i+c),p=(h+d)*bu,f=e-(h-p),m=i-(d-p);f>m?(o=1,a=0):(o=0,a=1);let v=f-o+bu,g=m-a+bu,y=f-1+2*bu,b=m-1+2*bu,x=255&h,w=255&d,_=.5-f*f-m*m;if(_>=0){let e=x+t[w];_*=_,s=_*_*(r[e]*f+n[e]*m)}let S=.5-v*v-g*g;if(S>=0){let e=x+o+t[w+a];S*=S,l=S*S*(r[e]*v+n[e]*g)}let O=.5-y*y-b*b;if(O>=0){let e=x+1+t[w+1];O*=O,u=O*O*(r[e]*y+n[e]*b)}return 70*(s+l+u)}}function Tu(e){let t=new Uint8Array(512);for(let r=0;r<256;r++)t[r]=r;for(let r=0;r<255;r++){let n=r+~~(e()*(256-r)),i=t[r];t[r]=t[n],t[n]=i}for(let r=256;r<512;r++)t[r]=t[r-256];return t}var Eu,Cu=new e,Au=Ne(Fe()),Mu=new t,Du=new t,Pu=new t;(Eu||(Eu={})).is=function(e){return e&&e.__isSPEObject};var ku,Lu=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new t,this.copyPreviousMatrix=!0,this.hiddenMatrix=new t,this.matrixWorldRigid=new t,this.shearScale=new t,this.shearScaleInv=new t}get __isSPEObject(){return!0}isDescendantOf(e){e instanceof o&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);for(let t of this.children)t.updateMatrixWorld(e)}updateWorldMatrix(e,t){let r=this.parent;if(e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),t)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseObject(e,t=0){if(!0!==e(this,t))for(let r of this.children)Eu.is(r)&&r.traverseObject(e,t+1)}updateMatrixWorldSVD(){let e=this.matrixWorld.elements,t=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],{u:r,v:n,q:i}=(0,Au.SVD)(t),o=Mu.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),a=Du.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),s=Pu.copy(a).transpose();this.shearScale.makeScale(i[0],i[1],i[2]).multiply(s).premultiply(a),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(o,s).copyPosition(this.matrixWorld),i.every((e=>Math.abs(i[0]-e)<.01))?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(e,r){this.updateWorldMatrix(!0,!1);let n=(new t).copy(this.matrixWorld).invert();return null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),n.multiply(e.parent.matrixWorld)),"hiddenMatrix"in e&&e.hiddenMatrix instanceof t?e.hiddenMatrix.premultiply(n):e.applyMatrix4(n),e.updateWorldMatrix(!1,!1),this.add(e),void 0!==r&&(this.children.pop(),this.children.splice(r,0,e)),this}copy(e,t=!1){return super.copy(e,t),this.hasNonUniformScale=e.hasNonUniformScale,this}onAfterRender(e,t,r,n,i,o){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},Uu=class extends(Lu(o)){},Iu=class extends Uu{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let r=this.children[e];(null==r?void 0:r.object)!==t&&(r&&this.remove(r),r=new Iu(t),this.add(r),this.children.splice(e,0,this.children.pop()),r.matrixWorldNeedsUpdate=!0,r.matrixAutoUpdate=!1,r.matrix=t.matrix,r.hiddenMatrix=t.hiddenMatrix),r.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return void 0!==this.playModeVisible?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&!0===(null==(e=this.object.dataPatched.cloner)?void 0:e.hideBase)}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return(e=>"Mesh"===e.type)(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},zu=new r,Ru=new r,Nu=new t,Bu=[new r(-1,1,1),new r(-1,-1,1),new r(1,-1,1),new r(1,1,1),new r(-1,1,-1),new r(-1,-1,-1),new r(1,-1,-1),new r(1,1,-1)],Fu=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],ju=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],Gu=(e,t,n)=>{e.updateEntityBoxSize(zu,Ru),Nu.copy(t).multiply(e.matrixWorld),0===Ru.x&&0===Ru.y&&0===Ru.z?n.push(new r(zu.x,zu.y,zu.z).applyMatrix4(Nu)):Bu.forEach((e=>{n.push(e.clone().multiply(Ru).add(zu).applyMatrix4(Nu))}))},Vu=class extends a{constructor(){super(...arguments),this.matrix=new t,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map((e=>e.clone())),this.faces=e.faces.map((e=>e.clone())),this.edges=e.edges.map((e=>e.clone())),this.centerEdges=e.centerEdges.map((e=>e.clone())),this}setFromObjectSize(e,r=!1){e.updateWorldMatrix(!1,r),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let n=(new t).copy(e.matrixWorld).invert();return this.expandByObjectSize(e,n,r)}expandByObjectSize(e,t,n=!1){let i=[];return!0===n?e.traverseEntity((e=>{if(e.visible||e.cloner&&e.data.visible){if(!("geometry"in e))return void i.push(new r);Gu(e,t,i)}})):Gu(e,t,i),this.setFromPoints(i)}getCenter(e){return(e=super.getCenter(e)).applyMatrix4(this.matrix),e}getPositionToCenter(e){return(e=super.getCenter(e)).applyMatrix4(Nu.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(Ru).multiplyScalar(.5),this.getCenter(zu),Nu.copy(this.matrix).setPosition(zu),this.vertices=Bu.map((e=>e.clone().multiply(Ru).applyMatrix4(Nu)))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=Fu.map((([e,t])=>new _e(this.vertices[e],this.vertices[t]))),this.centerEdges=this.edges.map((e=>e.getCenter(new r)))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=ju.map((([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5)))}},Hu={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},Wu=class extends Te{constructor(){super()}getPoints(e=12){let t,r=[],n=this.getCurveLengths(),i=n[n.length-1]/n.length;for(let o=0,a=this.curves;o<a.length;o++){let s=a[o],l=0===o?n[o]:n[o]-n[o-1],u=Math.ceil(e*l/i),c=s.getPoints(u);for(let e=0;e<c.length;e++){let n=c[e];t&&t.equals(n)||(r.push(n),t=n)}}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r}},qu=.001;function $u(e,t,r){return t.clone().sub(e).cross(t.clone().sub(r)).length()<=qu}function Xu(e,t){let n=new r(...e.position),i=new r(...e.controlNext.position),o=new r(...t.controlPrevious.position),a=new r(...t.position);return $u(n,i,a)&&$u(n,o,a)}function Yu(e){let t=e.points.map((e=>new r(...e.data.position))),n=[e.points[0]],i=new r(...n[0].data.position);for(let r=0;r<e.points.length-1;r++)$u(i,t[r],t[r+1])||(n.push(e.points[r]),i=t[r]);n.push(e.points[e.points.length-1]);let o=e.isClosed,a=n.length-(o?0:1),s=n.length,l=[];for(let h=0;h<s;h++){let t=n[h].data,i=new r(...t.position),a=new r(...t.controlPrevious.position),u=new r(...t.controlNext.position),c={position:i,baseRoundness:t.roundness,controlPrevious:a,controlNext:u};if(0===t.roundness||!e.isClosed&&(0===h||h===s-1)){l[h]={...c,removedLength:0};continue}let d=o&&h==s-1?0:h+1,p=n[o&&0==h?s-1:h-1].data,f=n[d].data,m=new r(...p.position),v=new r(...f.position),g=m.clone().sub(i).normalize(),y=v.clone().sub(i).normalize();Object.assign(c,{prevDir:g,nextDir:y});let b=Xu(p,t),x=Xu(t,f);if(b&&x){let e=g.clone().add(y).normalize(),r=e.clone().cross(g).length()/g.dot(e);l[h]={...c,tan:r,removedLength:t.roundness/r}}else l[h]={...c,removedLength:0}}for(let r=0;r<a;r++){let e=o&&r===s-1?0:r+1,t=l[r],n=l[e];if(0!==t.removedLength||0!==n.removedLength){let e=t.position.distanceTo(n.position);t.removedLength=Math.min(t.removedLength,e/2),n.removedLength=Math.min(n.removedLength,e/2)}}let u=[];for(let r=0;r<a;r++){let e=r,t=o&&r===s-1?0:r+1,i=l[e],a=l[t],c=null;if(Xu(n[e].data,n[t].data)){let e=i.position.clone(),t=a.position.clone();(0!==i.removedLength||0!==a.removedLength)&&(i.nextDir&&e.add(i.nextDir.clone().setLength(i.removedLength)),a.prevDir&&t.add(a.prevDir.clone().setLength(a.removedLength))),e.distanceTo(t)>qu&&(c=new Se(e,e.clone().lerp(t,.3),t.clone().lerp(e,.3),t))}else i.position.distanceTo(a.position)>qu&&(c=new Se(i.position,i.controlNext,a.controlPrevious,a.position));u[2*r+1]=c}for(let r=0;r<s;r++){let e=l[r];if(0===e.removedLength){u[2*r]=null;continue}let t=e.position,n=e.prevDir.clone().multiplyScalar(e.removedLength).add(t),i=e.nextDir.clone().multiplyScalar(e.removedLength).add(t),o=e.tan*e.removedLength,a=e.prevDir.clone().add(e.nextDir).normalize(),s=n.clone().lerp(i,.5),c=n.distanceTo(i)/2,h=a.clone().multiplyScalar(Math.sqrt(Math.pow(o,2)-Math.pow(c,2))).add(s),d=a.clone().multiplyScalar(-o).add(h),p=t.distanceTo(d)/t.distanceTo(s),f=e.prevDir.clone().multiplyScalar(p*t.distanceTo(n)).add(t),m=f.clone().lerp(d,2),v=n.clone().lerp(f,4/3),g=i.clone().lerp(m,4/3);u[2*r]=new Se(n,v,g,i)}let c=new Wu;return u.forEach((e=>{e&&c.add(e)})),c}(ku||(ku={})).is=function(e){return e&&e.__isEntity};var Zu=e=>ku.is(e),Ku={type:"completeState",isfromEntity:!0},Qu=e=>class extends(Lu(e)){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new Vu,this._recursiveBBox=new Vu,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(e){let t=this.children[e];if(ku.is(t))return t}get isConcreteEntity(){return"string"==typeof this.identity}get isVirtualEntity(){return"string"!=typeof this.identity}get isInstanceRoot(){return this.isConcreteEntity&&"Instance"===this.data.type}nearestInstanceSelfOrParent(){let e=this;for(;"Instance"!==e.data.type;){let t=e.parent;if(!ku.is(t))return;e=t}return e}forInstancesRec(e){this.instances.forEach((t=>{t.disposed||e(t),t.forInstancesRec(e)}))}super_Entity(e,t){"string"==typeof e&&(this.uuid=e),this.identity=e,this.data=t,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(e,t,r=!1){if(0!==this.data.states.length||r){for(let e of this.data.states)$l.toOps(this.data,e.data).forEach((e=>{let r=$o.replaceProps(e,this.data);this.dataPatched=this.data,this.updateByPatchedOp(r,this.data,t)}));if(null!==e){let r=this.data.states.data(e);r&&(this.dataPatched=$l.patch(this.data,r),$l.toOps(this.data,r).forEach((e=>{this.updateByPatchedOp(e,this.dataPatched,t)})))}r&&this.updateTransformState(this.dataPatched),this.stateSelection=e,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(e,t){e.setScalar(0),t.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((e=>{Zu(e)&&e.resetBBoxNeedsUpdateSelf()})),this.traverseEntity((e=>{e.resetBBoxNeedsUpdateSelf()}))}find(e){let t;return this.traverseEntity((r=>{r.uuid===e&&(t=r)})),t}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children,r=t.indexOf(this)+1;if(ku.is(t[r]))return t[r];if(ku.is(e))return e.traverseSortNextHelper()}}sortNext(){let e=this.children;return this.children.length>0&&ku.is(this.children[0])?e[0]:this.traverseSortNextHelper()}goUp(e){let t=this;for(;e>0&&null!==t;)t=t.parent,e-=1;return t}hasAnccestorOrSelf(e){return this===e||this.hasAnccestor(e)}hasAnccestor(e){let t=this.parent;for(;t;){if(e===t)return!0;t=t.parent}return!1}countToAccestor(e){let t=0,r=this;for(;r!==e;){if(null===r)return-1;r=r.parent,t+=1}return t}forEachEntity(e){for(let t of this.children)Zu(t)&&e(t)}traverseEntityAncestors(e){this.traverseAncestors((t=>{ku.is(t)&&e(t)}))}traverseEntity(e,t=0){if(!0!==e(this,t))for(let r of this.children)Zu(r)&&r.traverseEntity(e,t+1)}traverseVisibleEntity(e){e(this);for(let t of this.children)Zu(t)&&t.visible&&t.traverseVisibleEntity(e)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}copy(e,t=!1){return super.copy(e,t),this.dataPatched=e.dataPatched,this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),this}hasEntityChild(){return this.children.some((e=>Zu(e)))}isAncestorOf(e){if(this.uuid===e)return!1;let t=!1;return this.traverseEntity((r=>{r.uuid===e&&(t=!0)})),t}toObjectTransformState(e=[]){this.updateWorldMatrix(!0,!1);let t={position:this.position.toArray(),rotation:[this.rotation.x,this.rotation.y,this.rotation.z],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return Co(t,e)}updateTransformState(e){let t=!1;return e.position&&(this.position.fromArray(e.position),t=!0),e.rotation&&(this.rotation.fromArray(e.rotation),t=!0),e.scale&&(t=!0,this.scale.fromArray(e.scale)),void 0!==e.hiddenMatrix&&(t=!0,this.hiddenMatrix.fromArray(e.hiddenMatrix??qs.identity)),t&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((e=>{e.invalidateClonerTransform(this)}))),e.position&&e.rotation&&e.scale&&void 0!==e.hiddenMatrix&&this.updateWorldMatrix(!1,!0),t}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let e of this.children)ku.is(e)&&e.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach((e=>{ku.is(e)&&e.disposeRecursively()}))}toState(e=[]){let t={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(e)};return Co(t,e)}updateByOp(e,t,r,n){let i=this.data;this.data=t;let o=e,a=Sa(e.path,["states","*"]);if(null!==a){if(0===e.type){let[t]=a;if((null==this?void 0:this.stateSelection)===t){let t={...e.props};if(Object.values(e.props).some((e=>void 0===e))){let r=this.data;if(void 0!==r){let n=ga.zoom(r,e.path.slice(2));if(n)for(let r in e.props)void 0===e.props[r]&&r in n&&(t[r]=n[r])}}o={...e,props:t,path:e.path.slice(2)}}}}else if(0===e.type){let t=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==t){if(void 0!==e.props.name&&t.name){let{name:e,...r}=t;t=r}if(void 0!==e.props.material&&"material"in t){let{material:e,...r}=t;t=r}let r=ga.removeOverridden(e.path,e.props,t);o={...e,props:r}}}if(this.updateByPatchedOpBase(o,$l.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),Sa(e.path,["overrides"])){let n=[],i=[...e.path];for(n.push(i[1]),i.splice(0,2);i.length>0&&"descendants"===i[0];)n.push(i[1]),i.splice(0,2);if(void 0===n[n.length-1]){if(0===e.type)for(let t of Object.keys(e.props)){n[n.length-1]=t;let i=r.scene.findInstance([this.uuid,...n]);i&&(i.overrideData=e.props[t],i.updateState(Wo.apply(i.component.data,i.overrideData),r))}}else{let o=r.scene.findInstance([this.uuid,...n]);if(o){let a=ga.zoom(o.component.data,i);if(0===(e={...e,path:i}).type){let t=e.props;if(a)for(let[r,n]of Object.entries(e.props))void 0===n&&(t===e.props&&(t={...e.props}),t[r]=a[r]);e={...e,props:t}}o.overrideData=Hl.resolve(t.overrides,n),o.updateByOp(e,Xo.applySimple(o.data,e),r,!1)}}}else if(this.instances.length>0){let n;if(0===e.path.length&&0===e.type){let t;for(let r of Wl.rootOverrideProps)r in e.props&&(void 0===t&&(t={}),t[r]=e.props[r]);t&&(n={...e,props:t})}else for(let t of Wl.rootOverrideProps)if(Sa(e.path,[t])){n=e;break}void 0!==n&&this.instances.forEach((e=>{if(e.isInstanceRoot){let t=Wo.filterOp(e.overrideData,n);t&&e.updateByOp(t,Xo.applySimple(e.data,t),r,!0)}})),this.instances.forEach((n=>{if(!n.isInstanceRoot){let o=Wo.filterOp(n.overrideData,e);if(o){let a;a=i===n.data&&e===o?t:Xo.applySimple(n.data,o),n.updateByOp(o,a,r,!0)}}}))}}updateByPatchedOpBase(e,t,r){if(this.dataPatched=t,0===e.path.length&&0===e.type)void 0!==e.props.type&&!rl.is(e.props.type)&&Hu.changeEntityProptotype(this,t,r);else if(1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&"type"in e.props){Hu.changeEntityProptotype(this,t,r);for(let e of this.children)ku.is(e)&&e.updateVisible()}this.updateByPatchedOp(e,t,r)}updateByPatchedOp(e,t,r){if(0===e.path.length&&0===e.type&&this.updateState(e.props,r),null!==Sa(e.path,["pathSnapping"])&&this.updatePathSnapping(t.pathSnapping),null!==Sa(e.path,["cloner"])){let n=Xo.drop(e,1);0===n.path.length&&0===n.type&&!0===n.props.disabled?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(t.cloner,r.scene):(this.setFromClonerState(t.cloner,r),this.expandCloner(r.scene)),this.updateVisible()}}updatePathSnapping(e){this._updatedPathSnapping=e,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(e){var n,i,o,a,s;let l=(null==(n=this._updatedPathSnapping)?void 0:n.pathId)??this.dataPatched.pathSnapping.pathId,u=(null==(i=this._updatedPathSnapping)?void 0:i.slide)??this.dataPatched.pathSnapping.slide??0,c=(null==(o=this._updatedPathSnapping)?void 0:o.offset)??this.dataPatched.pathSnapping.offset,h=(null==(a=this._updatedPathSnapping)?void 0:a.orientation)??this.dataPatched.pathSnapping.orientation;if(null===l)return;let d=e.find(l);if(!d||!1===this._needApplyPathSnapping)return;this._needApplyPathSnapping=!1;let p=d.data,f=Yu(p.geometry.path),m=(u+c)%1;u+c===1&&0===m&&(m=1);let v=f.getPointAt(m),g=this.parent?null==(s=this.parent)?void 0:s.matrixWorld:new t;d.updateMatrixWorld();let y=(new t).multiplyMatrices(g.clone().invert(),d.matrixWorld);v.applyMatrix4(y);let b={position:v.toArray(),rotation:p.rotation};if("tangential"===h){let e=(new t).extractRotation(d.matrixWorld),n=f.getTangentAt(m).applyMatrix4(e).add(v),i=(new t).lookAt(v,n,new r(0,1,0)),o=(new ee).setFromRotationMatrix(i);b={...b,rotation:[o.x,o.y,o.z]}}this.updateTransformState(b),this.traverseEntity((e=>{e._cameraType&&e.dispatchEvent(Ku)}))}updateVisible(){var e;this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||!0!==(null==(e=this.dataPatched.cloner)?void 0:e.hideBase))}updateState_Entity(e,t){void 0!==e.name&&(this.name=e.name),void 0!==e.raycastLock&&(this.raycastLock=e.raycastLock),void 0!==e.visible&&(this.updateVisible(),this.resetBBoxNeedsUpdate()),"cloner"in e&&void 0!==e.cloner&&(this.setFromClonerState(e.cloner,t),this.updateVisible()),this.updateTransformState(e)}get attachedSurfaceCloners(){return this.children.filter((e=>e instanceof Hu.Cloner&&"toObject"===e.parameters.type))}setFromClonerState(e,t){this.disposed||(null===e||e.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):void 0===this.cloner?(this.cloner=new Hu.Cloner(this,e),t.scene.addPendingExpandCloner(this)):this.cloner.updateState(e,t.scene))}expandCloner(e){!this.disposed&&this.cloner&&this.cloner.expandClones(e)}invalidateClonerTransform(e){this.cloner&&this.cloner.invalidateTransform(e)}};function Ju(e,t,r){r.x=e.x*t.x,r.y=e.y,r.z=e.x*t.y}function ec(e){return new n(e.y,-e.x)}var tc=class extends s{constructor(e,t,i,o,a,s,l,u,c,h,d,p,m=!1){super(),this.type="RoundedCylinderBufferGeometry",e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,o=Math.floor(o)||8,a=Math.floor(a)||1,s=void 0!==s&&s,l=void 0!==l?l:0,u=void 0!==u?u:2*Math.PI,s&&(c=0,h=0);let v=[],g=[],y=[],b=[],x=0,w=i/2,_=new r,S=new r;m&&0==e&&(e=c),m&&0==t&&(t=h);let O=new n(e,w),T=new n(t,-w),E=null,C=null,A=null,M=null,D=O.clone().sub(T),P=0,k=0,L=0;p>0&&(P=Math.min(e,t)*(1-p),k=e-P,L=t-P);let U=O.clone();U.x-=P;let I=Math.PI-D.angle(),z=D.angle(),R=Math.tan(z/2),N=Math.tan(I/2),B=R+N,F=p?B:N,j=p?B:R;if(c=Math.min(c,(e-k)/F,D.length()/B),h=Math.min(h,(t-L)/j,D.length()/B),c>0){let e=c/R;E=O.clone().sub(new n(e,c)),p&&(A=E.clone(),A.x-=P-B*c),O.sub(D.clone().setLength(e))}if(h>0){let e=h/N;C=T.clone().sub(new n(e,-h)),T.add(D.clone().setLength(e)),p&&(M=C.clone(),M.x-=P-B*h,U.sub(D.clone().setLength(e)))}D=O.clone().sub(T);let G=D.length()<.5,V=[];for(let r=0;r<=o;r++){let d=[],f=r/o,m=f*u+l,v=new n(Math.sin(m),Math.cos(m));if(M&&C?(H(d,f,v,I,h,M,-1,!0),H(d,f,v,z,h,C,-1,!1)):C?(W(d,v,C.x,0,-1),H(d,f,v,z,h,C,-1,!1)):s||W(d,v,t,L,-1),Ju(ec(D).normalize(),v,_),!G)for(let e=0;e<=a;e++){let t=e/a;Ju(D.clone().multiplyScalar(t).add(T),v,S),g.push(S.x,S.y,S.z),y.push(_.x,_.y,_.z),b.push(f,.5+S.y/i),d.push(x++)}if(A&&E?(H(d,f,v,I,c,E,1,!1),H(d,f,v,z,c,A,1,!0)):E?(H(d,f,v,I,c,E,1,!1),W(d,v,E.x,0,1)):s||W(d,v,e,k,1),p&&!G){Ju(ec(D).multiplyScalar(-1).normalize(),v,_);for(let e=0;e<=a;e++){let t=e/a;Ju(D.clone().multiplyScalar(-t).add(U),v,S),g.push(S.x,S.y,S.z),y.push(_.x,_.y,_.z),b.push(f,.5+S.y/i),d.push(x++)}}p&&!s&&d.push(d[0]),V.push(d)}for(let r=0;r<V.length-1;r++)for(let e=0;e<V[0].length-1;e++){if(s&&p&&e==a)continue;let t=V[r][e],n=V[r+1][e],i=V[r+1][e+1],o=V[r][e+1],l=g[3*i+0],u=g[3*i+2];v.push(t,n,o),(0!=l||0!=u)&&v.push(n,i,o)}function H(e,t,r,o,a,s,l,u){for(let c=0;c<d+1;c++){let h=c/d,p=l<0?h:1-h;u&&(p-=1),p*=o;let f=new n(Math.sin(p),Math.cos(p)*l);Ju(f.clone().multiplyScalar(a).add(s),r,S),g.push(S.x,S.y,S.z),Ju(f,r,_),y.push(_.x,_.y,_.z),b.push(t,.5+S.y/i),e.push(x++)}}function W(e,t,i,o,a){let s=new r,l=new n,u=[i,o];a<0&&u.reverse();for(let r of u)l.set(r,w*a),Ju(l,t,s),g.push(s.x,s.y,s.z),y.push(0,a,0),b.push(.5,.5),e.push(x++)}function q(i,o,a){let s=new n(Math.sin(a),Math.cos(a)),l=new n(-Math.cos(a),Math.sin(a)),u=new r,c=i<0?(e,t,r)=>v.push(e,t,r):(e,t,r)=>v.push(e,r,t);Ju(new n((e+t+k+L)/4,0),s,u),g.push(u.x,u.y,u.z),y.push(l.x,0,l.y),b.push(.5,.5);let h=x++;for(let e of o){let t=g.slice(3*e,3*e+3);g.push(...t),y.push(l.x,0,l.y);let r=b.slice(2*e,2*e+2);b.push(...r),x++}for(let e=h+1;e<x-1;e++)c(h,e,e+1);c(h,x-1,h+1)}u<2*Math.PI&&(q(-1,V[0],l),q(1,V[V.length-1],l+u)),this.setIndex(v),this.setAttribute("position",new f(g,3)),this.setAttribute("normal",new f(y,3)),this.setAttribute("uv",new f(b,2))}},rc=Math.PI/2,nc=class extends s{constructor(e=1,t=1,n=1,i=1,o=1,a=1,s=0,l=4){super(),this.type="BoxGeometry";let u=this;i=Math.floor(i),o=Math.floor(o),a=Math.floor(a),l=Math.floor(l),s=Math.min(s,e/2,t/2,n/2);let c=[],h=[],d=[],p=[],m=0,v=0;function g(e,t,n,i,o,a,l,f,g,y,b){let x=(a-2*s)/g,w=(l-2*s)/y,_=a/2-s,S=l/2-s,O=f/2,T=g+1,E=y+1,C=0,A=0,M=new r;for(let r=0;r<E;r++){let a=r*w-S;for(let s=0;s<T;s++){let l=s*x-_;M[e]=l*i,M[t]=a*o,M[n]=O,h.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=f>0?1:-1,d.push(M.x,M.y,M.z),p.push(s/g),p.push(1-r/y),C+=1}}for(let r=0;r<y;r++)for(let e=0;e<g;e++){let t=m+e+T*r,n=m+e+T*(r+1),i=m+(e+1)+T*(r+1),o=m+(e+1)+T*r;c.push(t,n,o),c.push(n,i,o),A+=6}u.addGroup(v,A,b),v+=A,m+=C}function y(e,t,n,i,o,a,f,g,y,b,x){let w=(f-2*s)/b,_=f/2-s,S=g/2-s,O=y/2,T=b+1,E=0,C=0,A=new r,M=new r;for(let r=0;r<l+1;r++){let u=r/l*rc,c=Math.sin(u)*s,f=(1-Math.cos(u))*s,m=Math.sin(u),v=Math.cos(u);A[t]=(S+c)*o,A[n]=(O-f)*a,M[e]=0,M[t]=m*Math.sign(A[t]),M[n]=v*Math.sign(A[n]);for(let t=0;t<T;t++){let r=t*w-_;A[e]=r*i,h.push(A.x,A.y,A.z),d.push(M.x,M.y,M.z),p.push(t/b),p.push(0),E+=1}}for(let r=0;r<l;r++)for(let e=0;e<b;e++){let t=m+e+T*r,n=m+e+T*(r+1),i=m+(e+1)+T*(r+1),o=m+(e+1)+T*r;c.push(t,n,o),c.push(n,i,o),C+=6}u.addGroup(v,C,x),v+=C,m+=E}function b(i,o,a){let u=new r,f=new r(e/2,t/2,n/2);f.subScalar(s);let v=[],g=i*o*a>0?(e,t,r)=>c.push(e,t,r):(e,t,r)=>c.push(e,r,t);for(let e=0;e<=l;e++){let t=[],r=rc*(1-e/l),n=Math.cos(r),c=Math.sin(r),g=0;for(let l=0;l<=e;l++){let r=Math.cos(g),l=Math.sin(g);u.x=n*r,u.y=c,u.z=n*l;let v=f.clone().addScaledVector(u,s);h.push(i*v.x,o*v.y,a*v.z),d.push(i*u.x,o*u.y,a*u.z),p.push(0,0),t.push(m++),g+=rc/e}v.push(t)}let y=v.length-1;for(let e=0;e<y;e++){let t=v[e],r=v[e+1],n=t.length-1;g(t[0],r[1],r[0]);for(let e=1;e<=n;e++)g(t[e-1],t[e],r[e]),g(t[e],r[e+1],r[e])}}g("z","y","x",-1,-1,n,t,e,a,o,0),g("z","y","x",1,-1,n,t,-e,a,o,1),g("x","z","y",1,1,e,n,t,i,a,2),g("x","z","y",1,-1,e,n,-t,i,a,3),g("x","y","z",1,-1,e,t,n,i,o,4),g("x","y","z",-1,-1,e,t,-n,i,o,5),s>0&&(y("z","y","x",-1,-1,1,n,t,e,a,0),y("z","y","x",1,-1,-1,n,t,e,a,1),y("z","y","x",-1,1,-1,n,t,e,a,1),y("z","y","x",1,1,1,n,t,e,a,0),y("x","y","z",-1,-1,-1,e,t,n,i,0),y("x","y","z",1,-1,1,e,t,n,i,1),y("x","y","z",-1,1,1,e,t,n,i,0),y("x","y","z",1,1,-1,e,t,n,i,1),y("y","x","z",-1,-1,1,t,e,n,o,0),y("y","x","z",1,-1,-1,t,e,n,o,1),y("y","x","z",1,1,1,t,e,n,o,1),y("y","x","z",-1,1,-1,t,e,n,o,0),b(1,1,1),b(-1,1,1),b(1,-1,1),b(-1,-1,1),b(1,1,-1),b(-1,1,-1),b(1,-1,-1),b(-1,-1,-1)),this.setIndex(c),this.setAttribute("position",new f(h,3)),this.setAttribute("normal",new f(d,3)),this.setAttribute("uv",new f(p,2))}},ic=class extends s{constructor(t=[],i=[],o="",a=1,s=.2,l=4){super(),this.type="PolyhedronGeometryRound";let u=[],c=[],h=[];return function(){var n;0==(s=Math.min(.99999,s))&&(l=0);let c={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[o],d=new r,p=d.clone(),f=new e,m=s*a,v=a-m,g=l+1,y=new r,b=(e,t)=>y.subVectors(e,t).normalize(),x=(e,t)=>Array(e).fill(void 0).map(t),w=x(t.length/3,((e,n)=>(new r).fromArray(t,3*n).setLength(a))),_=[],S=1e6;for(let e=0;e<w.length;e++){let t,r,o,a=w[e],s=[],l=1e10,u=-1;for(;-1!=(u=i.indexOf(e,u+1));){let e=u-u%3;t=i[e+(u+1)%3],r=i[e+(u+2)%3],o=a.distanceToSquared(w[t]),l=Math.min(l,o),s.push([t,r,o])}l+=1e-6;let c=[],h=0,d=s.length;for(let i=0;i<d;i++){[t,r,o]=s[h];let i=1==(null==(n=_[t])?void 0:n.includes(e));o<=l&&c.push(t+ +i*S),h=s.findIndex((e=>e[0]==r))}_.push(c)}let O=[];{let e,t,r=0,n=0,i=3==c;for(let o=0;o<=l;o++){e=o*(o+1)/2,t=(o+1)*(o+2)/2;for(let a=0;a<l-o;a++)[r,n]=[e+a+o+2,t+a+o+3],O.push(e,t,...i?[n,e]:[r,t],n,r),[e,t]=[r,n];O.push(e,t,e+l+2)}}let T=d.clone(),E=d.clone(),C=d.clone(),A=d.clone(),M=d.clone(),D=[],P=x(w.length,(()=>x(c,(()=>d.clone()))));for(let e=0;e<w.length;e++){d.copy(w[e]).normalize(),T.copy(d).multiplyScalar(v);let t=_[e];for(let r=0;r<t.length;r++){let n=t[r],i=t[(r+1)%c];f.setFromPointsAndIndices(w,e,n%S,i%S),f.b.sub(f.a).setLength(1e10).add(f.a),f.c.sub(f.a).setLength(1e10).add(f.a),f.closestPointToPoint(T,P[e][r])}let n=[],i=[],o=[],a=new r;0==l&&[...P[e]].reduce(((e,t)=>e.add(t)),a).multiplyScalar(1/c);for(let r=0;r<c;r++){let t=[],s=(r-1+c)%c,u=P[e][s],h=P[e][r];d.copy(u).sub(T),p.copy(h).sub(T);let f=T.angleTo(d),x=d.angleTo(p),w=Math.cos(f)*m;0==l?E.copy(a):E.copy(T).setLength(v+w),i.push(w);let _=[E,u,h];for(let e=0;e<2;e++){let r=_[e],i=_[e+1];A.subVectors(r,T),M.subVectors(i,T),C.crossVectors(A,M).normalize();for(let o=0;o<g;o++){let i=[f,x][e]*o/g;d.copy(A).applyAxisAngle(C,i).add(T),n.push(d.clone()),e&&(b(d,T),t.push([0==o?r:d.clone(),y.clone()]))}e&&(b(i,T),t.push([i,y.clone()]))}o.push(t)}D.push(o);let s=2*g,x=2;for(let e=0;e<c;e++){let t=s*e,r=s*((e+1)%c),o=[n[t]];for(let s=1;s<g;s++){A=n[t+s],M=n[r+s],o.push(A);for(let t=1,r=s-x+1;t<=r;t++)d.lerpVectors(A,M,t/(r+1)),d.sub(T).setLength(i[e]).add(T),o.push(d.clone());o.push(M)}for(let e=0;e<g;e++)o.push(n[e+g+t]);o.push(n[r+g]);let a=O.map((e=>o[e]));u.push(...a.map((e=>[e.x,e.y,e.z])).flat()),h.push(...a.map((e=>(b(e,T),[y.x,y.y,y.z]))).flat())}}let k=[];for(let e=0;e<_.length;e++)for(let t=0;t<c;t++){let r=_[e][t];if(r<S){let n=_[r].findIndex((t=>t%S==e)),i=D[e][t],o=D[r][n];for(let e=0;e<g;e++){let t=i[e],r=o[g-e],n=i[e+1];[t,r,n,n,r,o[g-(e+1)]].forEach((e=>{u.push(e[0].x,e[0].y,e[0].z),h.push(e[1].x,e[1].y,e[1].z)}))}k.push(i[0][0],o[g][0],i[g][0],o[0][0])}}for(;k.length;){let e,t,r,n;[e,t]=k.splice(0,2);let i=[e];for(;e!=t;)i.push(t),r=k.indexOf(t),n=r%2,t=k.splice(r-n,2)[1-n];y.subVectors(i[0],i[1]).cross(d.subVectors(i[0],i[2])).normalize();let o=y.dot(i[0])<0;o&&y.negate();for(let a=1;a<=i.length-2;a++)[i[a+ +o],i[a+1-+o],i[0]].forEach((e=>{u.push(e.x,e.y,e.z),h.push(y.x,y.y,y.z)}))}}(),function(){let e=new r;for(let r=0;r<u.length;r+=3){e.x=u[r+0],e.y=u[r+1],e.z=u[r+2];let t=p(e)/2/Math.PI+.5,n=f(e)/Math.PI+.5;c.push(t,1-n)}let t=new r,i=new r,o=new r,a=new r,s=new n,l=new n,h=new n,d=(e,t,r,n)=>{n<0&&1===e.x&&(c[t]=e.x-1),0===r.x&&0===r.z&&(c[t]=n/2/Math.PI+.5)};for(let r=0,n=0;r<u.length;r+=9,n+=6){t.set(u[r+0],u[r+1],u[r+2]),i.set(u[r+3],u[r+4],u[r+5]),o.set(u[r+6],u[r+7],u[r+8]),s.set(c[n+0],c[n+1]),l.set(c[n+2],c[n+3]),h.set(c[n+4],c[n+5]),a.copy(t).add(i).add(o).divideScalar(3);let e=p(a);d(s,n+0,t,e),d(l,n+2,i,e),d(h,n+4,o,e)}for(let r=0;r<c.length;r+=6){let e=c[r+0],t=c[r+2],n=c[r+4],i=Math.max(e,t,n),o=Math.min(e,t,n);i>.9&&o<.1&&(e<.2&&(c[r+0]+=1),t<.2&&(c[r+2]+=1),n<.2&&(c[r+4]+=1))}function p(e){return Math.atan2(e.z,-e.x)}function f(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}}(),this.setAttribute("position",new f(u,3)),this.setAttribute("normal",new f(h,3)),void this.setAttribute("uv",new f(c,2))}static fromJSON(e){return new ic(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},oc=class extends ic{constructor(e=1,t=.2,r=4){let n=(1+Math.sqrt(5))/2,i=1/n,o="DodecahedronGeometry";super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o,e,t,r),this.type=o}static fromJSON(e){return new oc(e.radius,e.corner,e.cornerSides)}},ac=1e-12,sc=class{constructor(e){this.position=new n,this.startPosition=new n,this.uuid=b.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new sc(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},lc=class extends sc{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new lc(this.parent).copy(this)}},uc=class extends sc{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new lc(this),new lc(this))}static create(e,t){let r=new uc(e,new n(...t.position));return r.controls[0].position.set(...t.controlPrevious.position),r.controls[1].position.set(...t.controlNext.position),r.roundness=t.roundness,r.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,r}getOppositeControl(e){let t=this.controls.indexOf(e);return 0===t?this.controls[1]:1===t?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let r=0,n=this.controls.length;r<n;r++){let n=this.controls[r];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new uc(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var e,t;return[null==(e=this.curveBefore)?void 0:e.getTangentAt(1),null==(t=this.curveAfter)?void 0:t.getTangentAt(0)]}computeNormals(e=new n,t=new n){let[r,i]=this.computeTangents();return r&&i&&(cc(r,e),cc(i,t)),[e,t]}computeTangent(e=new n){let[t,r]=this.computeTangents();return t&&r&&e.copy(t).add(r).normalize(),e}computeNormal(e=new n){let[t,r]=this.computeNormals();return e.copy(t).add(r).normalize(),e}};function cc(e,t=new n){let r=e.length();return t.set(-e.y/r,e.x/r)}var hc=new n,dc=new n,pc=new n,fc=new n,mc=new n,vc=new n,gc=new r,yc=new r;function bc(e){let t=new n;t.addVectors(e.v0,hc.subVectors(e.v1,e.v0).multiplyScalar(2/3));let r=new n;return r.addVectors(e.v2,dc.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new O(e.v0,t,r,e.v2)}function xc(e,t,r=Number.EPSILON){return Math.abs(e-t)<r}function wc(e,t,r=Number.EPSILON){return e.distanceTo(t)<r}function _c(e,t,r=Number.EPSILON){return e.distanceTo(t)<r}function Sc(e,t,r){let n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),i=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2)),o=Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2));return Math.acos((i*i+n*n-o*o)/(2*i*n))}function Oc(e,t,r){return Dc(e,t)&&Dc(t,r)&&Tc(e.position,t.position,r.position)}function Tc(e,t,r){return 0===hc.copy(t).sub(e).cross(dc.copy(r).sub(e))}function Ec(e,t,r,n,i){let o=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,s=(e.x+t.x)/2,l=Math.sqrt(Math.pow(r,2)-Math.pow(o/2,2))*(e.y-t.y)/o,u=Math.sqrt(Math.pow(r,2)-Math.pow(o/2,2))*(t.x-e.x)/o;return n.set(s+l,a+u),i.set(s-l,a-u),[n,i]}function Cc(e,t,r){return e.distanceTo(r)<t.distanceTo(r)?t:e}function Ac(e,t,r,n,i,o){let a,s=t.x-e.x,l=t.y-e.y,u=r.x-e.x,c=r.y-e.y,h=Math.sqrt((s+u)*(s+u)+(l+c)*(l+c));return Sc(t,e,r)>Math.PI&&(h*=-1),a=xc(c,l)?(l+c)*(n/h-.5)*8/3/(s-u):(s+u)*(n/h-.5)*8/3/(c-l),i.set(t.x-a*l,t.y+a*s),o.set(r.x+a*c,r.y-a*u),[i,o]}function Mc(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function Dc(e,t){return Tc(e.position,e.controls[1].position,t.position)&&Tc(e.position,t.controls[0].position,t.position)}function Pc(e,t=12,r=!1){let n=[];for(let i=0,o=e.length;i<o;i++){let o=e[i],a=0;if(r&&void 0!==o.roundedCurveCorner){let e=.5*kc(o.roundedCurveCorner,t);i>0&&(n[i-1]+=e),a+=e}void 0!==o.curveAfter&&(a+=kc(o.curveAfter,t)),n.push(a)}return e.length>0&&r&&void 0!==e[0].roundedCurveCorner&&(n[e.length-1]+=.5*kc(e[0].roundedCurveCorner,t)),n}function kc(e,t=12){return e&&e instanceof le?2*t:e&&(e instanceof S||e instanceof ue)?1:e&&e instanceof ce?t*e.points.length:t}var Lc,Uc,Ic=new n,zc=new n,Rc=new n,Nc=new n,Bc=new n,Fc=new n,jc=class extends q{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new K(new r(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=b.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,r){let n=new jc;return n.isClosed=e.isClosed,n.points=e.points.map((e=>uc.create(e.id,e.data))),"number"==typeof e.roundness&&(n.roundness=e.roundness),n.shapeHoles=e.shapeHoles.map((e=>jc.createFromState(e))),void 0!==t&&void 0!==r&&n.applySize(t,r),n.update(),n}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,r=this.points.length;t<r;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map((e=>this.getPointIndexById(e))).filter((e=>e>=0))}getPointIndexById(e){let t=this.points.length,r=this.points.findIndex((t=>t.uuid===e));if(r<0){let r=t;for(let t=0,n=this.shapeHoles.length;t<n;t++){let n=this.shapeHoles[t],i=n.points.length,o=n.getPointIndexById(e);if(!(o<0))return o+r;r+=i}}return r}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let r=0,n=this.shapeHoles.length;r<n;r++){let n=this.shapeHoles[r],i=e-t;if(i<=n.points.length-1)return n.points[i];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let r=0,n=this.shapeHoles.length;r<n;r++){let n=this.shapeHoles[r],i=n.points.indexOf(e);if(i>=0)return t+i;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map((e=>e.points)));return[...this.points,...e]}applySize(e,t){0===e&&(e=.001),0===t&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let r=Ic.set(e,t);for(let n=0,i=this.points.length;n<i;n++){let e=this.points[n];e.position.multiply(r),e.controls[0].position.multiply(r),e.controls[1].position.multiply(r)}for(let n=0,i=this.shapeHoles.length;n<i;n++)this.shapeHoles[n].applyScale(e,t);this._update()}createPoint(e,t=0,r=b.generateUUID()){let i;i=e instanceof n?e:new n(e,t);let o=new uc(r,i);return o.roundness=this.roundness,o}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,r=this.points.length;t<r;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,r=this.shapeHoles.length;t<r;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find((t=>t.uuid===e));t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,r=!1){this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t);let n=r?this.roundedCurveDivisions:this.curveDivisions;return function(e,t,r=12,n=!0){let i,o=yc.set(0,0,0),a=0;for(let s=0;s<t.length;s++){let n=t[s],l=hc,u=kc(n,r);for(let t=0;t<=u;t++)if(n instanceof O||n instanceof T||n instanceof S){if(n.getPoint(t/u,l),o.set(l.x,l.y,0),void 0!==i&&_c(i,o))continue;void 0===i&&(i=gc),i.copy(o),e.setXYZ(a,o.x,o.y,o.z),a++}}n&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++)}(e,r?this.roundedCurves:this.curves,t,this.autoClose),n.reduce(((e,t)=>e+t),0)+1}computeCurveDivisions(e=12){return this.curveDivisions=Pc(this.points,e,!1),this.roundedCurveDivisions=Pc(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,r=12){return 2*function(e,t,r,n=12,i=!0){let o=yc.set(0,0,0),a=0,s=[];for(let l=0;l<t.length;l++){if(!1===r[l])continue;let i,u=t[l],c=hc,h=kc(u,n);s.push(h);for(let t=0;t<=h;t++)if(u instanceof O||u instanceof T||u instanceof S){if(u.getPoint(t/h,c),o.set(c.x,c.y,0),null==i?void 0:i.equals(o))continue;void 0===i?i=gc:(e.setXYZ(a,i.x,i.y,i.z),a++,e.setXYZ(a,o.x,o.y,o.z),a++),i.copy(o)}}return i&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),s}(e,this.curves,t,r,this.autoClose).reduce(((e,t)=>e+t),0)}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t),function(e,t,r=12,n=!0){let i,o=0;for(let a=0;a<t.length;a++){let n=t[a],s=kc(n,r),l=hc;for(let t=0;t<=s;t++)if(n instanceof O||n instanceof T||n instanceof S){if(n.getPoint(t/s,l),void 0!==i&&wc(i,l,ac))continue;void 0===i&&(i=dc),i.copy(l),e.push(l.x,l.y),o++}}return xc(e[0],e[e.length-2],ac)&&xc(e[1],e[e.length-1],ac)&&(e.pop(),e.pop()),n&&o>1&&!(xc(e[o-1],e[1],ac)&&xc(e[o-2],e[0],ac))&&(e.push(e[0],e[1]),o++),e}(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let r=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);let n=t?this.roundedCurveDivisions:this.curveDivisions,i=0;t&&void 0!==this.points[0].roundedCurveCorner&&(i=.5*kc(this.points[0].roundedCurveCorner,this.subdivision));let o=e-i;o<0&&(o+=n.reduce(((e,t)=>e+t),0));for(let a=0,s=n.length;a<s;a++){let e=n[a];if(o<r+e)return[a,(o-r+1)/e];r+=e}return[0,1]}getCurveT(e,t,r){let n=this.points[e],i=this.points[e>=this.points.length-1?0:e+1],o=this.curveDivisions,a=o[e];if(Mc(n,i)){let e=n.position.distanceTo(i.position);return n.position.distanceTo(Ic.set(r.x,r.y))/e}let s=0;for(let l=0;l<e;l++)s+=o[l];return(t-s)/a}dispose(){}_applyCurveForPoint(e,t){Mc(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let r=this.curves[this.curves.length-1];e.curveBefore=r,t.curveAfter=r;let n=r.clone();e.roundedCurveBefore=n,t.roundedCurveAfter=n,e.roundedCurveCorner=void 0,this.roundedCurves.push(n)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,r=this.points.length;t<r;t++){let e=this.points[t];if(0===t)this.moveTo(e.position.x,e.position.y);else{let r=this.points[t-1];this._applyCurveForPoint(e,r)}}let e=this.getLastPoint();if((null==e?void 0:e.curveAfter)&&(e.curveAfter=void 0),this.isClosed){let e=this.points[0],t=this.points[this.points.length-1];this._applyCurveForPoint(e,t)}if(this.points.length>2){let e=0;for(let t=0,r=this.points.length;t<r;t++){let r=this.points[t],n=this.points[t-1]??this.points[this.points.length-1],i=this.points[t+1]??this.points[0],o=r.roundness,a=n&&i&&Oc(n,r,i);if(!r.controlsMoved()&&o>0&&!a){let n=r.curveBefore,i=r.curveAfter;if(void 0===n||void 0===i)continue;let a,s=r.roundedCurveBefore,l=r.roundedCurveAfter,u=n.getLength(),c=i.getLength(),h=Math.min(o,.499*u),d=Math.min(o,.499*c),p=Math.min(h,d),f=1-p/u,m=p/c,v=n.getPointAt(f,Ic),g=i.getPointAt(m,zc);if(this._subSplitCurve(n,s,f,v,void 0),this._subSplitCurve(i,l,m,void 0,g),this.useCubicForRoundedCorners){let e=Sc(v,r.position,g)/2,t=Math.tan(e)*v.distanceTo(r.position),[n,i]=Ec(v,g,t,Rc,Nc),o=Cc(n,i,r.position),[s,l]=Ac(o,v,g,t,Bc,Fc);a=new O(v.clone(),s.clone(),l.clone(),g.clone())}else a=new T(v.clone(),r.position.clone(),g.clone());r.roundedCurveCorner=a,this.roundedCurves.splice(t+e,0,a),e++}}}}_subSplitCurve(e,t,r,n,i){if(!(e instanceof S)){let o=e,a=t,s=o.getUtoTmapping(r,0),l=function(e,t,r,n,i=.5){let o=hc.subVectors(t,e).multiplyScalar(i).add(e),a=dc.subVectors(r,t).multiplyScalar(i).add(t),s=pc.subVectors(n,r).multiplyScalar(i).add(r),l=o,u=fc.subVectors(a,o).multiplyScalar(i).add(o),c=mc.subVectors(s,a).multiplyScalar(i).add(a),h=s,d=vc.subVectors(c,u).multiplyScalar(i).add(u);return[e.x,e.y,l.x,l.y,u.x,u.y,d.x,d.y,c.x,c.y,h.x,h.y,n.x,n.y]}(o.v0,o.v1,o.v2,o.v3,s);return void 0!==n&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),void 0!==i&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return void 0!==n&&t.v2.copy(n),void 0!==i&&t.v1.copy(i),t}clone(){let e=new jc(this._width,this._height);return e.points=this.points.map((e=>e.clone())),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map((e=>e.clone())),e}toJSON(){return{points:this.points.reduce(((e,t)=>e.concat(t.toJSON())),[]),shapeHoles:this.shapeHoles.map((e=>e.toJSON())),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var t;this.points=[],this.pointIDs=0;let r=e.points.length/7;for(let i=0;i<r;i++){let t=7*i,r=e.points[t+0],o=e.points[t+1],a=e.points[t+2],s=e.points[t+3],l=e.points[t+4],u=e.points[t+5],c=e.points[t+6],h=new uc(b.generateUUID(),new n(r,o));h.controls[0].position.set(a,s),h.controls[1].position.set(l,u),h.roundness=c,this.points.push(h)}return this.shapeHoles=(null==(t=e.shapeHoles)?void 0:t.length)?e.shapeHoles.map((e=>{let t=new jc;return t.fromJSON(e),t})):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e){let t=(e,t)=>{t instanceof O&&t.v3.equals(e.position)&&e.controls[0].position.copy(t.v2)};return this.points=(e=>{let r,n,i=[];for(r=0,n=e.length;r<n;r++)e[r]instanceof T&&(e[r]=bc(e[r]));for(r=0,n=e.length;r<n;r++){let n,o=e[r],a=r>0?e[r-1]:null;o instanceof O?(n=this.createPoint(o.v0),n.controls[1].position.copy(o.v1)):o instanceof S&&(n=this.createPoint(o.v1)),void 0!==n&&(null!==a&&t(n,a),i.push(n))}let o=e[e.length-1],a=!1;return o instanceof O?o.v3.equals(i[0].position)&&(i[0].controls[0].position.copy(o.v2),a=!0):o instanceof S&&o.v2.equals(i[0].position)&&(a=!0),this.isClosed=a,i})(e.curves),e instanceof q&&(this.shapeHoles=e.holes.map((e=>{let t=new jc;return t.fromShape(e),t}))),this.update(),this}updatePoint(e,t){let r=this.getPointByUuid(e);r&&(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.roundness&&(r.roundness=t.roundness),void 0!==t.areControlsDirectionsMirrored&&(r.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var r;let n=null==(r=this.getPointByUuid(e))?void 0:r.controls[0];n&&(t.position&&n.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var r;let n=null==(r=this.getPointByUuid(e))?void 0:r.controls[1];n&&(t.position&&n.position.fromArray(t.position),this.needsUpdate=!0)}},Gc=2*Math.PI;function Vc({x:e,y:t},r,n,i,o){return{x:e*r+i,y:t*n+o}}function Hc(e,t){let r=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:1.3333333333333333*Math.tan(t/4),n=Math.cos(e),i=Math.sin(e),o=Math.cos(e+t),a=Math.sin(e+t);return[{x:n-i*r,y:i+n*r},{x:o+a*r,y:a-o*r},{x:o,y:a}]}function Wc(e,t,r,n){let i=e*n-t*r<0?-1:1,o=Math.min(1,Math.max(-1,e*r+t*n));return i*Math.acos(o)}function qc({px:e,py:t,cx:r,cy:n,rx:i,ry:o,largeArcFlag:a,sweepFlag:s}){let l=[];if(0===i||0===o)return[];let u=(e-r)/2,c=(t-n)/2;if(0===u&&0===c)return[];i=Math.abs(i),o=Math.abs(o);let h=Math.pow(u,2)/Math.pow(i,2)+Math.pow(c,2)/Math.pow(o,2);h>1&&(i*=Math.sqrt(h),o*=Math.sqrt(h));let d=function(e,t,r,n,i,o,a,s,l,u){let c=Math.pow(i,2),h=Math.pow(o,2),d=Math.pow(a,2),p=Math.pow(s,2),f=c*h-c*p-h*d;f<0&&(f=0),f/=c*p+h*d,f=Math.sqrt(f)*(l===u?-1:1);let m=f*i/o*s,v=f*-o/i*a,g=m+(e+r)/2,y=v+(t+n)/2,b=(a-m)/i,x=(s-v)/o,w=(-a-m)/i,_=(-s-v)/o,S=Wc(1,0,b,x),O=Wc(b,x,w,_);return!u&&O>0&&(O-=Gc),u&&O<0&&(O+=Gc),{centerx:g,centery:y,ang1:S,ang2:O}}(e,t,r,n,i,o,u,c,a,s),{ang1:p,ang2:f}=d,{centerx:m,centery:v}=d,g=Math.abs(f)/(Gc/4);Math.abs(1-g)<1e-7&&(g=1);let y=Math.max(Math.ceil(g),1);f/=y;for(let b=0;b<y;b++)l.push(Hc(p,f)),p+=f;return l.map((e=>{let{x:t,y:r}=Vc(e[0],i,o,m,v),{x:n,y:a}=Vc(e[1],i,o,m,v),{x:s,y:l}=Vc(e[2],i,o,m,v);return{x1:t,y1:r,x2:n,y2:a,x:s,y:l}}))}function $c(e,t){if(!e)throw t||"Assertion Failed!"}!function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"}(Lc||(Lc={})),function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"}(Uc||(Uc={}));var Xc=function(){function e(){}return e.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},e.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},e.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},e.edgeEval=function(t,r,n){$c(e.vertLeq(t,r)&&e.vertLeq(r,n));var i=r.s-t.s,o=n.s-r.s;return i+o>0?i<o?r.t-t.t+(t.t-n.t)*(i/(i+o)):r.t-n.t+(n.t-t.t)*(o/(i+o)):0},e.edgeSign=function(t,r,n){$c(e.vertLeq(t,r)&&e.vertLeq(r,n));var i=r.s-t.s,o=n.s-r.s;return i+o>0?(r.t-n.t)*i+(r.t-t.t)*o:0},e.transEval=function(t,r,n){$c(e.transLeq(t,r)&&e.transLeq(r,n));var i=r.t-t.t,o=n.t-r.t;return i+o>0?i<o?r.s-t.s+(t.s-n.s)*(i/(i+o)):r.s-n.s+(n.s-t.s)*(o/(i+o)):0},e.transSign=function(t,r,n){$c(e.transLeq(t,r)&&e.transLeq(r,n));var i=r.t-t.t,o=n.t-r.t;return i+o>0?(r.s-n.s)*i+(r.s-t.s)*o:0},e.vertCCW=function(e,t,r){return e.s*(t.t-r.t)+t.s*(r.t-e.t)+r.s*(e.t-t.t)>=0},e.interpolate=function(e,t,r,n){return(e=e<0?0:e)<=(r=r<0?0:r)?0===r?(t+n)/2:t+e/(e+r)*(n-t):n+r/(e+r)*(t-n)},e.intersect=function(t,r,n,i,o){var a,s,l;e.vertLeq(t,r)||(l=t,t=r,r=l),e.vertLeq(n,i)||(l=n,n=i,i=l),e.vertLeq(t,n)||(l=t,t=n,n=l,l=r,r=i,i=l),e.vertLeq(n,r)?e.vertLeq(r,i)?((a=e.edgeEval(t,n,r))+(s=e.edgeEval(n,r,i))<0&&(a=-a,s=-s),o.s=e.interpolate(a,n.s,s,r.s)):((a=e.edgeSign(t,n,r))+(s=-e.edgeSign(t,i,r))<0&&(a=-a,s=-s),o.s=e.interpolate(a,n.s,s,i.s)):o.s=(n.s+r.s)/2,e.transLeq(t,r)||(l=t,t=r,r=l),e.transLeq(n,i)||(l=n,n=i,i=l),e.transLeq(t,n)||(l=t,t=n,n=l,l=r,r=i,i=l),e.transLeq(n,r)?e.transLeq(r,i)?((a=e.transEval(t,n,r))+(s=e.transEval(n,r,i))<0&&(a=-a,s=-s),o.t=e.interpolate(a,n.t,s,r.t)):((a=e.transSign(t,n,r))+(s=-e.transSign(t,i,r))<0&&(a=-a,s=-s),o.t=e.interpolate(a,n.t,s,i.t)):o.t=(n.t+r.t)/2},e}(),Yc=function(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},Zc=function(){function e(e){this.side=e,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(e){this.Sym.Lface=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(e){this.Sym.Org=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(e){this.Sym.Lnext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(e){this.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(e){this.Lnext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(e){this.Sym.Onext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(e){this.Sym.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(e){this.Sym.Lnext.Sym=e},enumerable:!0,configurable:!0}),e}(),Kc=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},Qc=function(){function e(){var e=new Kc,t=new Yc,r=new Zc(0),n=new Zc(1);e.next=e.prev=e,e.anEdge=null,t.next=t.prev=t,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=e,this.fHead=t,this.eHead=r,this.eHeadSym=n}return e.prototype.makeEdge_=function(e){var t=new Zc(0),r=new Zc(1);e.Sym.side<e.side&&(e=e.Sym);var n=e.Sym.next;return r.next=n,n.Sym.next=t,t.next=e,e.Sym.next=r,t.Sym=r,t.Onext=t,t.Lnext=r,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,r.Sym=t,r.Onext=r,r.Lnext=t,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,t},e.prototype.splice_=function(e,t){var r=e.Onext,n=t.Onext;r.Sym.Lnext=t,n.Sym.Lnext=e,e.Onext=n,t.Onext=r},e.prototype.makeVertex_=function(e,t,r){var n=e;$c(n,"Vertex can't be null!");var i=r.prev;n.prev=i,i.next=n,n.next=r,r.prev=n,n.anEdge=t;var o=t;do{o.Org=n,o=o.Onext}while(o!==t)},e.prototype.makeFace_=function(e,t,r){var n=e;$c(n,"Face can't be null");var i=r.prev;n.prev=i,i.next=n,n.next=r,r.prev=n,n.anEdge=t,n.trail=null,n.marked=!1,n.inside=r.inside;var o=t;do{o.Lface=n,o=o.Lnext}while(o!==t)},e.prototype.killEdge_=function(e){e.Sym.side<e.side&&(e=e.Sym);var t=e.next,r=e.Sym.next;t.Sym.next=r,r.Sym.next=t},e.prototype.killVertex_=function(e,t){var r=e.anEdge,n=r;do{n.Org=t,n=n.Onext}while(n!==r);var i=e.prev,o=e.next;o.prev=i,i.next=o},e.prototype.killFace_=function(e,t){var r=e.anEdge,n=r;do{n.Lface=t,n=n.Lnext}while(n!==r);var i=e.prev,o=e.next;o.prev=i,i.next=o},e.prototype.makeEdge=function(){var e=new Kc,t=new Kc,r=new Yc,n=this.makeEdge_(this.eHead);return this.makeVertex_(e,n,this.vHead),this.makeVertex_(t,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},e.prototype.splice=function(e,t){var r=!1,n=!1;if(e!==t){if(t.Org!==e.Org&&(n=!0,this.killVertex_(t.Org,e.Org)),t.Lface!==e.Lface&&(r=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(t,e),!n){var i=new Kc;this.makeVertex_(i,t,e.Org),e.Org.anEdge=e}if(!r){var o=new Yc;this.makeFace_(o,t,e.Lface),e.Lface.anEdge=e}}},e.prototype.delete=function(e){var t=e.Sym,r=!1;if(e.Lface!==e.Rface&&(r=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!r){var n=new Yc;this.makeFace_(n,e,e.Lface)}t.Onext===t?(this.killVertex_(t.Org,null),this.killFace_(t.Lface,null)):(e.Lface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),this.killEdge_(e)},e.prototype.addEdgeVertex=function(e){var t=this.makeEdge_(e),r=t.Sym;this.splice_(t,e.Lnext),t.Org=e.Dst;var n=new Kc;return this.makeVertex_(n,r,t.Org),t.Lface=r.Lface=e.Lface,t},e.prototype.splitEdge=function(e){var t=this.addEdgeVertex(e).Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,t),e.Dst=t.Org,t.Dst.anEdge=t.Sym,t.Rface=e.Rface,t.winding=e.winding,t.Sym.winding=e.Sym.winding,t.idx=e.idx,t.Sym.idx=e.Sym.idx,t},e.prototype.connect=function(e,t){var r=!1,n=this.makeEdge_(e),i=n.Sym;if(t.Lface!==e.Lface&&(r=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(n,e.Lnext),this.splice_(i,t),n.Org=e.Dst,i.Org=t.Org,n.Lface=i.Lface=e.Lface,e.Lface.anEdge=i,!r){var o=new Yc;this.makeFace_(o,n,e.Lface)}return n},e.prototype.zapFace=function(e){var t,r,n,i,o,a=e.anEdge;r=a.Lnext;do{r=(t=r).Lnext,t.Lface=null,null===t.Rface&&(t.Onext===t?this.killVertex_(t.Org,null):(t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),(n=t.Sym).Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),this.killEdge_(t))}while(t!=a);i=e.prev,(o=e.next).prev=i,i.next=o},e.prototype.countFaceVerts_=function(e){var t=e.anEdge,r=0;do{r++,t=t.Lnext}while(t!==e.anEdge);return r},e.prototype.mergeConvexFaces=function(e){var t,r,n,i,o;for(t=this.fHead.next;t!==this.fHead;t=t.next)if(t.inside)for(o=(r=t.anEdge).Org;n=r.Lnext,(i=r.Sym)&&i.Lface&&i.Lface.inside&&(this.countFaceVerts_(t)+this.countFaceVerts_(i.Lface)-2<=e&&Xc.vertCCW(r.Lprev.Org,r.Org,i.Lnext.Lnext.Org)&&Xc.vertCCW(i.Lprev.Org,i.Org,r.Lnext.Lnext.Org)&&(n=i.Lnext,this.delete(i),r=null,i=null)),!r||r.Lnext.Org!==o;)r=n;return!0},e.prototype.check=function(){var e,t,r,n,i,o,a=this.fHead,s=this.vHead,l=this.eHead;for(t=a,t=a;(e=t.next)!==a;t=e){$c(e.prev===t),i=e.anEdge;do{$c(i.Sym!==i),$c(i.Sym.Sym===i),$c(i.Lnext.Onext.Sym===i),$c(i.Onext.Sym.Lnext===i),$c(i.Lface===e),i=i.Lnext}while(i!==e.anEdge)}for($c(e.prev===t&&null===e.anEdge),n=s,n=s;(r=n.next)!==s;n=r){$c(r.prev===n),i=r.anEdge;do{$c(i.Sym!==i),$c(i.Sym.Sym===i),$c(i.Lnext.Onext.Sym===i),$c(i.Onext.Sym.Lnext===i),$c(i.Org===r),i=i.Onext}while(i!==r.anEdge)}for($c(r.prev===n&&null===r.anEdge),o=l,o=l;(i=o.next)!==l;o=i)$c(i.Sym.next===o.Sym),$c(i.Sym!==i),$c(i.Sym.Sym===i),$c(null!==i.Org),$c(null!==i.Dst),$c(i.Lnext.Onext.Sym===i),$c(i.Onext.Sym.Lnext===i);$c(i.Sym.next===o.Sym&&i.Sym===this.eHeadSym&&i.Sym.Sym===i&&null===i.Org&&null===i.Dst&&null===i.Lface&&null===i.Rface)},e}(),Jc=function(){this.handle=null},eh=function(){this.key=null,this.node=0},th=function(){function e(e,t){this.leq=t,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=e,this.nodes=[],this.handles=[];for(var r=0;r<e+1;r++)this.nodes[r]=new Jc,this.handles[r]=new eh;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(e){var t,r,n,i=this.nodes,o=this.handles;for(t=i[e].handle;;){if((n=e<<1)<this.size&&this.leq(o[i[n+1].handle].key,o[i[n].handle].key)&&++n,$c(n<=this.max),r=i[n].handle,n>this.size||this.leq(o[t].key,o[r].key)){i[e].handle=t,o[t].node=e;break}i[e].handle=r,o[r].node=e,e=n}},e.prototype.floatUp_=function(e){var t,r,n,i=this.nodes,o=this.handles;for(t=i[e].handle;;){if(r=i[n=e>>1].handle,0===n||this.leq(o[r].key,o[t].key)){i[e].handle=t,o[t].node=e;break}i[e].handle=r,o[r].node=e,e=n}},e.prototype.init=function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(e){var t,r;if(2*(t=++this.size)>this.max){var n,i;for(this.max*=2,i=this.nodes.length,this.nodes.length=this.max+1,n=i;n<this.nodes.length;n++)this.nodes[n]=new Jc;for(i=this.handles.length,this.handles.length=this.max+1,n=i;n<this.handles.length;n++)this.handles[n]=new eh}return 0===this.freeList?r=t:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[t].handle=r,this.handles[r].node=t,this.handles[r].key=e,this.initialized&&this.floatUp_(t),r},e.prototype.extractMin=function(){var e=this.nodes,t=this.handles,r=e[1].handle,n=t[r].key;return this.size>0&&(e[1].handle=e[this.size].handle,t[e[1].handle].node=1,t[r].key=null,t[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(e){var t,r=this.nodes,n=this.handles;$c(e>=1&&e<=this.max&&null!==n[e].key),r[t=n[e].node].handle=r[this.size].handle,n[r[t].handle].node=t,--this.size,t<=this.size&&(t<=1||this.leq(n[r[t>>1].handle].key,n[r[t].handle].key)?this.floatDown_(t):this.floatUp_(t)),n[e].key=null,n[e].node=this.freeList,this.freeList=e},e}(),rh=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},nh=function(){this.key=null,this.next=null,this.prev=null},ih=function(){function e(e,t){this.frame=e,this.leq=t,this.head=new nh,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(e){return this.insertBefore(this.head,e)},e.prototype.search=function(e){var t=this.head;do{t=t.next}while(null!==t.key&&!this.leq(this.frame,e,t.key));return t},e.prototype.insertBefore=function(e,t){do{e=e.prev}while(null!==e.key&&!this.leq(this.frame,e.key,t));var r=new nh;return r.key=t,r.next=e.next,e.next.prev=r,r.prev=e,e.next=r,r},e.prototype.delete=function(e){e.next.prev=e.prev,e.prev.next=e.next},e}(),oh=function(){function e(){}return e.regionBelow=function(e){return e.nodeUp.prev.key},e.regionAbove=function(e){return e.nodeUp.next.key},e.debugEvent=function(e){},e.addWinding=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.edgeLeq=function(e,t,r){var n=e.event,i=t.eUp,o=r.eUp;return i.Dst===n?o.Dst===n?Xc.vertLeq(i.Org,o.Org)?Xc.edgeSign(o.Dst,i.Org,o.Org)<=0:Xc.edgeSign(i.Dst,o.Org,i.Org)>=0:Xc.edgeSign(o.Dst,n,o.Org)<=0:o.Dst===n?Xc.edgeSign(i.Dst,n,i.Org)>=0:Xc.edgeEval(i.Dst,n,i.Org)>=Xc.edgeEval(o.Dst,n,o.Org)},e.deleteRegion=function(e,t){t.fixUpperEdge&&$c(0===t.eUp.winding),t.eUp.activeRegion=null,e.dict.delete(t.nodeUp)},e.fixUpperEdge=function(e,t,r){$c(t.fixUpperEdge),e.mesh.delete(t.eUp),t.fixUpperEdge=!1,t.eUp=r,r.activeRegion=t},e.topLeftRegion=function(t,r){var n,i=r.eUp.Org;do{r=e.regionAbove(r)}while(r.eUp.Org===i);if(r.fixUpperEdge){if(null===(n=t.mesh.connect(e.regionBelow(r).eUp.Sym,r.eUp.Lnext)))return null;e.fixUpperEdge(t,r,n),r=e.regionAbove(r)}return r},e.topRightRegion=function(t){var r=t.eUp.Dst;do{t=e.regionAbove(t)}while(t.eUp.Dst===r);return t},e.addRegionBelow=function(e,t,r){var n=new rh;return n.eUp=r,n.nodeUp=e.dict.insertBefore(t.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},e.isWindingInside=function(e,t){switch(e.windingRule){case Lc.ODD:return 0!=(1&t);case Lc.NONZERO:return 0!==t;case Lc.POSITIVE:return t>0;case Lc.NEGATIVE:return t<0;case Lc.ABS_GEQ_TWO:return t>=2||t<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,r){r.windingNumber=e.regionAbove(r).windingNumber+r.eUp.winding,r.inside=e.isWindingInside(t,r.windingNumber)},e.finishRegion=function(t,r){var n=r.eUp,i=n.Lface;i.inside=r.inside,i.anEdge=n,e.deleteRegion(t,r)},e.finishLeftRegions=function(t,r,n){for(var i,o=null,a=r,s=r.eUp;a!==n;){if(a.fixUpperEdge=!1,(i=(o=e.regionBelow(a)).eUp).Org!=s.Org){if(!o.fixUpperEdge){e.finishRegion(t,a);break}i=t.mesh.connect(s.Lprev,i.Sym),e.fixUpperEdge(t,o,i)}s.Onext!==i&&(t.mesh.splice(i.Oprev,i),t.mesh.splice(s,i)),e.finishRegion(t,a),s=o.eUp,a=o}return s},e.addRightEdges=function(t,r,n,i,o,a){var s,l,u,c,h=!0;u=n;do{$c(Xc.vertLeq(u.Org,u.Dst)),e.addRegionBelow(t,r,u.Sym),u=u.Onext}while(u!==i);for(null===o&&(o=e.regionBelow(r).eUp.Rprev),l=r,c=o;(u=(s=e.regionBelow(l)).eUp.Sym).Org===c.Org;)u.Onext!==c&&(t.mesh.splice(u.Oprev,u),t.mesh.splice(c.Oprev,u)),s.windingNumber=l.windingNumber-u.winding,s.inside=e.isWindingInside(t,s.windingNumber),l.dirty=!0,!h&&e.checkForRightSplice(t,l)&&(e.addWinding(u,c),e.deleteRegion(t,l),t.mesh.delete(c)),h=!1,l=s,c=u;l.dirty=!0,$c(l.windingNumber-u.winding===s.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(e,t,r){e.mesh.splice(t,r)},e.vertexWeights=function(e,t,r){var n=Xc.vertL1dist(t,e),i=Xc.vertL1dist(r,e),o=.5*i/(n+i),a=.5*n/(n+i);e.coords[0]+=o*t.coords[0]+a*r.coords[0],e.coords[1]+=o*t.coords[1]+a*r.coords[1],e.coords[2]+=o*t.coords[2]+a*r.coords[2]},e.getIntersectData=function(t,r,n,i,o,a){r.coords[0]=r.coords[1]=r.coords[2]=0,r.idx=-1,e.vertexWeights(r,n,i),e.vertexWeights(r,o,a)},e.checkForRightSplice=function(t,r){var n=e.regionBelow(r),i=r.eUp,o=n.eUp;if(Xc.vertLeq(i.Org,o.Org)){if(Xc.edgeSign(o.Dst,i.Org,o.Org)>0)return!1;Xc.vertEq(i.Org,o.Org)?i.Org!==o.Org&&(t.pq.delete(i.Org.pqHandle),e.spliceMergeVertices(t,o.Oprev,i)):(t.mesh.splitEdge(o.Sym),t.mesh.splice(i,o.Oprev),r.dirty=n.dirty=!0)}else{if(Xc.edgeSign(i.Dst,o.Org,i.Org)<0)return!1;e.regionAbove(r).dirty=r.dirty=!0,t.mesh.splitEdge(i.Sym),t.mesh.splice(o.Oprev,i)}return!0},e.checkForLeftSplice=function(t,r){var n,i=e.regionBelow(r),o=r.eUp,a=i.eUp;if($c(!Xc.vertEq(o.Dst,a.Dst)),Xc.vertLeq(o.Dst,a.Dst)){if(Xc.edgeSign(o.Dst,a.Dst,o.Org)<0)return!1;e.regionAbove(r).dirty=r.dirty=!0,n=t.mesh.splitEdge(o),t.mesh.splice(a.Sym,n),n.Lface.inside=r.inside}else{if(Xc.edgeSign(a.Dst,o.Dst,a.Org)>0)return!1;r.dirty=i.dirty=!0,n=t.mesh.splitEdge(a),t.mesh.splice(o.Lnext,a.Sym),n.Rface.inside=r.inside}return!0},e.checkForIntersect=function(t,r){var n,i,o=e.regionBelow(r),a=r.eUp,s=o.eUp,l=a.Org,u=s.Org,c=a.Dst,h=s.Dst,d=new Kc;if($c(!Xc.vertEq(h,c)),$c(Xc.edgeSign(c,t.event,l)<=0),$c(Xc.edgeSign(h,t.event,u)>=0),$c(l!==t.event&&u!==t.event),$c(!r.fixUpperEdge&&!o.fixUpperEdge),l===u||Math.min(l.t,c.t)>Math.max(u.t,h.t))return!1;if(Xc.vertLeq(l,u)){if(Xc.edgeSign(h,l,u)>0)return!1}else if(Xc.edgeSign(c,u,l)<0)return!1;return e.debugEvent(t),Xc.intersect(c,l,h,u,d),$c(Math.min(l.t,c.t)<=d.t),$c(d.t<=Math.max(u.t,h.t)),$c(Math.min(h.s,c.s)<=d.s),$c(d.s<=Math.max(u.s,l.s)),Xc.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),n=Xc.vertLeq(l,u)?l:u,Xc.vertLeq(n,d)&&(d.s=n.s,d.t=n.t),Xc.vertEq(d,l)||Xc.vertEq(d,u)?(e.checkForRightSplice(t,r),!1):!Xc.vertEq(c,t.event)&&Xc.edgeSign(c,t.event,d)>=0||!Xc.vertEq(h,t.event)&&Xc.edgeSign(h,t.event,d)<=0?h===t.event?(t.mesh.splitEdge(a.Sym),t.mesh.splice(s.Sym,a),r=e.topLeftRegion(t,r),a=e.regionBelow(r).eUp,e.finishLeftRegions(t,e.regionBelow(r),o),e.addRightEdges(t,r,a.Oprev,a,a,!0),!0):c===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(a.Lnext,s.Oprev),o=r,r=e.topRightRegion(r),i=e.regionBelow(r).eUp.Rprev,o.eUp=s.Oprev,s=e.finishLeftRegions(t,o,null),e.addRightEdges(t,r,s.Onext,a.Rprev,i,!0),!0):(Xc.edgeSign(c,t.event,d)>=0&&(e.regionAbove(r).dirty=r.dirty=!0,t.mesh.splitEdge(a.Sym),a.Org.s=t.event.s,a.Org.t=t.event.t),Xc.edgeSign(h,t.event,d)<=0&&(r.dirty=o.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(a.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,a),a.Org.s=d.s,a.Org.t=d.t,a.Org.pqHandle=t.pq.insert(a.Org),e.getIntersectData(t,a.Org,l,c,u,h),e.regionAbove(r).dirty=r.dirty=o.dirty=!0,!1)},e.walkDirtyRegions=function(t,r){for(var n,i,o=e.regionBelow(r);;){for(;o.dirty;)r=o,o=e.regionBelow(o);if(!r.dirty&&(o=r,null===(r=e.regionAbove(r))||!r.dirty))return;if(r.dirty=!1,n=r.eUp,i=o.eUp,n.Dst!==i.Dst&&e.checkForLeftSplice(t,r)&&(o.fixUpperEdge?(e.deleteRegion(t,o),t.mesh.delete(i),i=(o=e.regionBelow(r)).eUp):r.fixUpperEdge&&(e.deleteRegion(t,r),t.mesh.delete(n),n=(r=e.regionAbove(o)).eUp)),n.Org!==i.Org)if(n.Dst===i.Dst||r.fixUpperEdge||o.fixUpperEdge||n.Dst!==t.event&&i.Dst!==t.event)e.checkForRightSplice(t,r);else if(e.checkForIntersect(t,r))return;n.Org===i.Org&&n.Dst===i.Dst&&(e.addWinding(i,n),e.deleteRegion(t,r),t.mesh.delete(n),r=e.regionAbove(o))}},e.connectRightVertex=function(t,r,n){var i,o=n.Onext,a=e.regionBelow(r),s=r.eUp,l=a.eUp,u=!1;s.Dst!==l.Dst&&e.checkForIntersect(t,r),Xc.vertEq(s.Org,t.event)&&(t.mesh.splice(o.Oprev,s),r=e.topLeftRegion(t,r),o=e.regionBelow(r).eUp,e.finishLeftRegions(t,e.regionBelow(r),a),u=!0),Xc.vertEq(l.Org,t.event)&&(t.mesh.splice(n,l.Oprev),n=e.finishLeftRegions(t,a,null),u=!0),u?e.addRightEdges(t,r,n.Onext,o,o,!0):(i=Xc.vertLeq(l.Org,s.Org)?l.Oprev:s,i=t.mesh.connect(n.Lprev,i),e.addRightEdges(t,r,i,i.Onext,i.Onext,!1),i.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,r))},e.connectLeftDegenerate=function(t,r,n){var i,o,a,s,l;return i=r.eUp,Xc.vertEq(i.Org,n)?($c(!1),void e.spliceMergeVertices(t,i,n.anEdge)):Xc.vertEq(i.Dst,n)?($c(!1),r=e.topRightRegion(r),o=s=(a=(l=e.regionBelow(r)).eUp.Sym).Onext,l.fixUpperEdge&&($c(o!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=o.Oprev),t.mesh.splice(n.anEdge,a),Xc.edgeGoesLeft(o)||(o=null),void e.addRightEdges(t,r,a.Onext,s,o,!0)):(t.mesh.splitEdge(i.Sym),r.fixUpperEdge&&(t.mesh.delete(i.Onext),r.fixUpperEdge=!1),t.mesh.splice(n.anEdge,i),void e.sweepEvent(t,n))},e.connectLeftVertex=function(t,r){var n,i,o,a,s,l,u=new rh;if(u.eUp=r.anEdge.Sym,n=t.dict.search(u).key,i=e.regionBelow(n)){if(a=n.eUp,s=i.eUp,0===Xc.edgeSign(a.Dst,r,a.Org))return void e.connectLeftDegenerate(t,n,r);if(o=Xc.vertLeq(s.Dst,a.Dst)?n:i,n.inside||o.fixUpperEdge){if(o===n)l=t.mesh.connect(r.anEdge.Sym,a.Lnext);else l=t.mesh.connect(s.Dnext,r.anEdge).Sym;o.fixUpperEdge?e.fixUpperEdge(t,o,l):e.computeWinding(t,e.addRegionBelow(t,n,l)),e.sweepEvent(t,r)}else e.addRightEdges(t,n,r.anEdge,r.anEdge,null,!0)}},e.sweepEvent=function(t,r){t.event=r,e.debugEvent(t);for(var n=r.anEdge;null===n.activeRegion;)if((n=n.Onext)===r.anEdge)return void e.connectLeftVertex(t,r);var i=e.topLeftRegion(t,n.activeRegion);$c(null!==i);var o=e.regionBelow(i),a=o.eUp,s=e.finishLeftRegions(t,o,null);s.Onext===a?e.connectRightVertex(t,i,s):e.addRightEdges(t,i,s.Onext,a,a,!0)},e.addSentinel=function(e,t,r,n){var i=new rh,o=e.mesh.makeEdge();o.Org.s=r,o.Org.t=n,o.Dst.s=t,o.Dst.t=n,e.event=o.Dst,i.eUp=o,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=e.dict.insert(i)},e.initEdgeDict=function(t){t.dict=new ih(t,e.edgeLeq);var r=t.bmax[0]-t.bmin[0],n=t.bmax[1]-t.bmin[1],i=t.bmin[0]-r,o=t.bmax[0]+r,a=t.bmin[1]-n,s=t.bmax[1]+n;e.addSentinel(t,i,o,a),e.addSentinel(t,i,o,s)},e.doneEdgeDict=function(t){for(var r,n=0;null!==(r=t.dict.min().key);)r.sentinel||($c(r.fixUpperEdge),$c(1==++n)),$c(0===r.windingNumber),e.deleteRegion(t,r)},e.removeDegenerateEdges=function(t){var r,n,i,o=t.mesh.eHead;for(r=o.next;r!==o;r=n)n=r.next,i=r.Lnext,Xc.vertEq(r.Org,r.Dst)&&r.Lnext.Lnext!==r&&(e.spliceMergeVertices(t,i,r),t.mesh.delete(r),i=(r=i).Lnext),i.Lnext===r&&(i!==r&&((i===n||i===n.Sym)&&(n=n.next),t.mesh.delete(i)),(r===n||r===n.Sym)&&(n=n.next),t.mesh.delete(r))},e.initPriorityQ=function(e){var t,r,n,i=0;for(r=(n=e.mesh.vHead).next;r!==n;r=r.next)i++;for(i+=8,t=e.pq=new th(i,Xc.vertLeq),r=(n=e.mesh.vHead).next;r!==n;r=r.next)r.pqHandle=t.insert(r);return r===n&&(t.init(),!0)},e.donePriorityQ=function(e){e.pq=null},e.removeDegenerateFaces=function(t,r){var n,i,o;for(n=r.fHead.next;n!==r.fHead;n=i)i=n.next,$c((o=n.anEdge).Lnext!==o),o.Lnext.Lnext===o&&(e.addWinding(o.Onext,o),t.mesh.delete(o));return!0},e.computeInterior=function(t,r){var n,i;if(void 0===r&&(r=!0),e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);null!==(n=t.pq.extractMin());){for(;null!==(i=t.pq.min())&&Xc.vertEq(i,n);)i=t.pq.extractMin(),e.spliceMergeVertices(t,n.anEdge,i.anEdge);e.sweepEvent(t,n)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),!!e.removeDegenerateFaces(t,t.mesh)&&(r&&t.mesh.check(),!0)},e}(),ah=function(){function e(){this.mesh=new Qc,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Lc.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.prototype.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(!t)throw"Zero-size vector!";t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},e.prototype.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},e.prototype.computeNormal_=function(e){var t,r,n,i,o,a,s=[0,0,0],l=[0,0,0],u=[0,0,0],c=[0,0,0],h=[0,0,0],d=[null,null,null],p=[null,null,null],f=this.mesh.vHead;t=f.next;for(var m=0;m<3;++m)i=t.coords[m],l[m]=i,p[m]=t,s[m]=i,d[m]=t;for(t=f.next;t!==f;t=t.next)for(var v=0;v<3;++v)(i=t.coords[v])<l[v]&&(l[v]=i,p[v]=t),i>s[v]&&(s[v]=i,d[v]=t);var g=0;if(s[1]-l[1]>s[0]-l[0]&&(g=1),s[2]-l[2]>s[g]-l[g]&&(g=2),l[g]>=s[g])return e[0]=0,e[1]=0,void(e[2]=1);for(a=0,r=p[g],n=d[g],u[0]=r.coords[0]-n.coords[0],u[1]=r.coords[1]-n.coords[1],u[2]=r.coords[2]-n.coords[2],t=f.next;t!==f;t=t.next)c[0]=t.coords[0]-n.coords[0],c[1]=t.coords[1]-n.coords[1],c[2]=t.coords[2]-n.coords[2],h[0]=u[1]*c[2]-u[2]*c[1],h[1]=u[2]*c[0]-u[0]*c[2],h[2]=u[0]*c[1]-u[1]*c[0],(o=h[0]*h[0]+h[1]*h[1]+h[2]*h[2])>a&&(a=o,e[0]=h[0],e[1]=h[1],e[2]=h[2]);a<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(u)]=1)},e.prototype.checkOrientation_=function(){for(var e,t,r=this.mesh.fHead,n=this.mesh.vHead,i=0,o=r.next;o!==r;o=o.next)if(!((t=o.anEdge).winding<=0))do{i+=(t.Org.s-t.Dst.s)*(t.Org.t+t.Dst.t),t=t.Lnext}while(t!==o.anEdge);if(i<0){for(e=n.next;e!==n;e=e.next)e.t=-e.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var e,t,r=this.mesh.vHead,n=[0,0,0],i=!1;n[0]=this.normal[0],n[1]=this.normal[1],n[2]=this.normal[2],!n[0]&&!n[1]&&!n[2]&&(this.computeNormal_(n),i=!0),e=this.sUnit,t=this.tUnit;var o=this.longAxis_(n);e[o]=0,e[(o+1)%3]=1,e[(o+2)%3]=0,t[o]=0,t[(o+1)%3]=0,t[(o+2)%3]=n[o]>0?1:-1;for(var a=r.next;a!==r;a=a.next)a.s=this.dot_(a.coords,e),a.t=this.dot_(a.coords,t);i&&this.checkOrientation_();for(var s=!0,l=r.next;l!==r;l=l.next)s?(this.bmin[0]=this.bmax[0]=l.s,this.bmin[1]=this.bmax[1]=l.t,s=!1):(l.s<this.bmin[0]&&(this.bmin[0]=l.s),l.s>this.bmax[0]&&(this.bmax[0]=l.s),l.t<this.bmin[1]&&(this.bmin[1]=l.t),l.t>this.bmax[1]&&(this.bmax[1]=l.t))},e.prototype.addWinding_=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.prototype.tessellateMonoRegion_=function(e,t){var r,n;if((r=t.anEdge).Lnext===r||r.Lnext.Lnext===r)throw"Mono region invalid";for(;Xc.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;Xc.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(;r.Lnext!==n;)if(Xc.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(Xc.edgeGoesLeft(n.Lnext)||Xc.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)n=e.connect(n.Lnext,n).Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(Xc.edgeGoesRight(r.Lprev)||Xc.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)r=e.connect(r,r.Lprev).Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)n=e.connect(n.Lnext,n).Sym;return!0},e.prototype.tessellateInterior_=function(e){for(var t,r=e.fHead.next;r!==e.fHead;r=t)if(t=r.next,r.inside&&!this.tessellateMonoRegion_(e,r))return!1;return!0},e.prototype.discardExterior_=function(e){for(var t,r=e.fHead.next;r!==e.fHead;r=t)t=r.next,r.inside||e.zapFace(r)},e.prototype.setWindingNumber_=function(e,t,r){for(var n,i=e.eHead.next;i!==e.eHead;i=n)n=i.next,i.Rface.inside!==i.Lface.inside?i.winding=i.Lface.inside?t:-t:r?e.delete(i):i.winding=0},e.prototype.getNeighbourFace_=function(e){return e.Rface&&e.Rface.inside?e.Rface.n:-1},e.prototype.outputPolymesh_=function(e,t,r,n){var i,o,a=0,s=0;r>3&&e.mergeConvexFaces(r);for(var l=e.vHead.next;l!==e.vHead;l=l.next)l.n=-1;for(var u=e.fHead.next;u!==e.fHead;u=u.next)if(u.n=-1,u.inside){i=u.anEdge,o=0;do{-1===(l=i.Org).n&&(l.n=s,s++),o++,i=i.Lnext}while(i!==u.anEdge);if(o>r)throw"Face vertex greater that support polygon";u.n=a,++a}this.elementCount=a,t===Uc.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=s,this.vertices=[],this.vertices.length=s*n,this.vertexIndices=[],this.vertexIndices.length=s;for(l=e.vHead.next;l!==e.vHead;l=l.next)if(-1!==l.n){var c=l.n*n;this.vertices[c+0]=l.coords[0],this.vertices[c+1]=l.coords[1],n>2&&(this.vertices[c+2]=l.coords[2]),this.vertexIndices[l.n]=l.idx}var h=0;for(u=e.fHead.next;u!==e.fHead;u=u.next)if(u.inside){i=u.anEdge,o=0;do{l=i.Org;this.elements[h++]=l.n,o++,i=i.Lnext}while(i!==u.anEdge);for(var d=o;d<r;++d)this.elements[h++]=-1;if(t===Uc.CONNECTED_POLYGONS){i=u.anEdge;do{this.elements[h++]=this.getNeighbourFace_(i),i=i.Lnext}while(i!==u.anEdge);for(var p=o;p<r;++p)this.elements[h++]=-1}}},e.prototype.outputContours_=function(e,t){var r,n,i=0,o=0;this.vertexCount=0,this.elementCount=0;for(var a=e.fHead.next;a!==e.fHead;a=a.next)if(a.inside){n=r=a.anEdge;do{this.vertexCount++,r=r.Lnext}while(r!==n);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*t,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var s=0,l=0,u=0;i=0;for(a=e.fHead.next;a!==e.fHead;a=a.next)if(a.inside){o=0,n=r=a.anEdge;do{this.vertices[s++]=r.Org.coords[0],this.vertices[s++]=r.Org.coords[1],t>2&&(this.vertices[s++]=r.Org.coords[2]),this.vertexIndices[l++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,o++,r=r.Lnext}while(r!==n);this.elements[u++]=i,this.elements[u++]=o,i+=o}},e.prototype.addContour=function(e,t){null===this.mesh&&(this.mesh=new Qc),e<2&&(e=2),e>3&&(e=3);for(var r=null,n=0;n<t.length;n+=e)null===r?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=t[n+0],r.Org.coords[1]=t[n+1],r.Org.coords[2]=e>2?t[n+2]:0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(e,t,r,n,i,o){if(void 0===e&&(e=Lc.ODD),void 0===t&&(t=Uc.POLYGONS),void 0===o&&(o=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,i&&(this.normal[0]=i[0],this.normal[1]=i[1],this.normal[2]=i[2]),this.windingRule=e,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),oh.computeInterior(this,o);var a=this.mesh;return t===Uc.BOUNDARY_CONTOURS?this.setWindingNumber_(a,1,!0):this.tessellateInterior_(a),o&&a.check(),t===Uc.BOUNDARY_CONTOURS?this.outputContours_(a,n):this.outputPolymesh_(a,t,r,n),!0},e}();function sh(e){var t=e.windingRule,r=void 0===t?Lc.ODD:t,n=e.elementType,i=void 0===n?Uc.POLYGONS:n,o=e.polySize,a=void 0===o?3:o,s=e.vertexSize,l=void 0===s?2:s,u=e.normal,c=void 0===u?[0,0,1]:u,h=e.contours,d=void 0===h?[]:h,p=e.strict,f=void 0===p||p,m=e.debug,v=void 0!==m&&m;if(!d&&f)throw new Error("Contours can't be empty");if(d){var g=new ah;e.edgeCreateCallback&&(g.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(g.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)g.addContour(l||2,d[y]);return g.tesselate(r,i,a,l,c,f),{vertices:g.vertices,vertexIndices:g.vertexIndices,vertexCount:g.vertexCount,elements:g.elements,elementCount:g.elementCount,mesh:v?g.mesh:void 0}}}Lc.ODD,Lc.NONZERO,Lc.POSITIVE,Lc.NEGATIVE,Lc.ABS_GEQ_TWO,Uc.POLYGONS,Uc.CONNECTED_POLYGONS,Uc.BOUNDARY_CONTOURS;var lh=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug;let r=e*lh.eSize;this.buffer=new ArrayBuffer(r);let n=Float32Array.BYTES_PER_ELEMENT,i=0;this.positions=new Float32Array(this.buffer,i*n,3*e),i+=3*e,this.normals=new Float32Array(this.buffer,i*n,3*e),i+=3*e,this.uvs=new Float32Array(this.buffer,i*n,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug;let r=e*lh.eSize,n=new ArrayBuffer(r),i=Float32Array.BYTES_PER_ELEMENT,o=0,a=new Float32Array(n,o*i,3*e);o+=3*e;let s=new Float32Array(n,o*i,3*e);o+=3*e;let l=new Float32Array(n,o*i,2*e);a.set(this.positions.slice(0,3*this.size)),s.set(this.normals.slice(0,3*this.size)),l.set(this.uvs.slice(0,2*this.size)),this.buffer=n,this.positions=a,this.normals=s,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let e=this.capacity;for(;t>e;)e*=2;this.realloc(e)}let r=this.size;return this.size=t,r}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug,this.realloc(this.size,!0)}},uh=lh;uh.eSize=8*Float32Array.BYTES_PER_ELEMENT;var ch={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},hh={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},dh={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},ph=(e,t)=>([r,n])=>(n<r&&(n+=t),(e>=r?e:e+t)<=n),fh=class extends s{constructor(e,t,r=0,n=12,i=3,o=Lc.ODD){super(),this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._bevel=r,this._curveSegments=n,this._bevelSegmentsInput=i,r<=0?(this._bevelSize=0,this._bevelSegments=0):(this._bevelSize=Math.min(r,t/2-1e-12),this._bevelSegments=Math.floor(i));let a,s,l=this._shape.extractShapePointsToFlatArray([],n),u=this._shape.shapeHoles.map((e=>{let t=e.extractShapePointsToFlatArray([],n),r=[];for(let n=t.length-1;n>=1;n-=2){let e=t[n-1],i=t[n-0];r.push(e,i)}return r}));try{a=sh({windingRule:o,elementType:Uc.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[l]})}catch{a=ch}try{s=sh({windingRule:Lc.ODD,elementType:Uc.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...u]})}catch{s=hh}if(!a)throw new Error("error generating geometry");let c=a.elementCount;if(s){a.elementCount+=s.elementCount;for(let e=0;e<s.elements.length;e++){let t=s.elements[e],r=e%2==0?a.vertexCount:0;a.elements.push(t+r)}for(let e=0;e<s.vertexIndices.length;e++){let t=s.vertexIndices[e],r=a.vertexCount;a.vertexIndices.push(t+r)}for(let e=0;e<s.vertices.length;e++){let t=s.vertices[e];a.vertices.push(t)}}let h=1/0,d=-1/0,f=1/0,m=-1/0;for(let p=0,_=a.vertexCount;p<_;p++){let e=2*p,t=a.vertices[e+0],r=a.vertices[e+1];t<h&&(h=t),t>d&&(d=t),r<f&&(f=r),r>m&&(m=r)}this._minX=h,this._minY=f,this._width=d-h,this._height=m-f,this._buffer=new uh(this._computeBufferEstimatedSize(a));let v=[],g=[];for(let p=a.elementCount-1;p>=0;p--){let e=p>=c,t=2*p,r=a.elements[t+0],i=a.elements[t+1],o=r+i,s={start:r,count:i,normals:[],continuous:[],concave:[]},l=r,h=o-1,d=r+1,f=this._shape.roundedCurves.length;do{let t=l-r,n=a.vertices[2*h+0],u=a.vertices[2*h+1],c=a.vertices[2*l+0],p=a.vertices[2*l+1],m=a.vertices[2*d+0],v=a.vertices[2*d+1],g=c-n,y=p-u,b=Math.sqrt(g*g+y*y);g/=b,y/=b;let x=c-m,w=p-v,_=Math.sqrt(x*x+w*w);x/=_,w/=_,s.normals[2*t+0]=-w,s.normals[2*t+1]=x,s.concave[t]=g*w-y*x>0;let S=a.vertexIndices[l];if(Array.isArray(S))s.continuous[t]=!1;else{let[e,r]=this._shape.getCurveIndexFromVertexId(S-1,!0);if(r>0&&r<1)s.continuous[t]=!0;else{let n=1===r?e+1:e-1;n=(n+f)%f;let i=1===r?0:1,o=this._shape.roundedCurves[e].getTangent(r),a=this._shape.roundedCurves[n].getTangent(i);s.continuous[t]=o.dot(a)>.95}}e&&(s.normals[2*t+0]*=-1,s.normals[2*t+1]*=-1),[h,l,d]=[l,d,d+1],d>=o&&(d-=i)}while(d!==r+1);let m=[];m.push({bevelI:0,angle:0,size:0,boundary:{vertices:a.vertices.slice(2*r,2*o),vertexCount:i,vertexIndices:new Array(i).fill(!0).map(((e,t)=>[t,t])),elements:[0,i],elementCount:1,mesh:null},reverseMap:[],insetPoints:a.vertices.slice(2*r,2*o)});for(let u=1;u<=this._bevelSegments;u++){let t=u/this._bevelSegments*Math.PI/2,r=(1-Math.cos(t))*this._bevelSize,o=[],l=[],c=0;for(let u=0;u<i;u++){let t=2*u,h=(u-1+i)%i*2,d=a.vertices[2*s.start+t+0],p=a.vertices[2*s.start+t+1],f=-s.normals[h+0]*r,m=-s.normals[h+1]*r,v=-s.normals[t+0]*r,g=-s.normals[t+1]*r;if(s.concave[u]||!s.concave[u]&&e){let t=Math.atan2(m,f),i=Math.atan2(g,v);i>t&&(i-=2*Math.PI);let a=i-t;if(s.continuous[u]||e){let n=t+a/2,i=Math.cos(n)*r,s=Math.sin(n)*r;o[2*c+0]=d+i*(e?-1:1),o[2*c+1]=p+s*(e?-1:1),l[c]=u,c++}else{let e=Math.max(1,Math.floor(n/4*Math.abs(a)/Math.PI));for(let n=0;n<=e;n++){let i=t+a*(n/e),s=Math.cos(i)*r,h=Math.sin(i)*r;o[2*c+0]=d+s,o[2*c+1]=p+h,l[c]=u,c++}}}else o[2*c+0]=d+f,o[2*c+1]=p+m,l[c]=u,c++,o[2*c+0]=d,o[2*c+1]=p,l[c]=u,c++,o[2*c+0]=d+v,o[2*c+1]=p+g,l[c]=u,c++}let h=sh({windingRule:Lc.POSITIVE,elementType:Uc.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o],edgeCreateCallback:e=>{let t=e.Org.idx,r=l[t],n=l[(t+1)%l.length];e.idx=[r,n],e.Sym.idx=[n,r]},vertexIdCallback:e=>{let t=e.Lprev.idx;return[t?t[1]:0,e.idx?e.idx[0]:0]}});if(!h)throw new Error(`error generating bevel geometry for ${u}'th loop`);if(!h.vertexCount)break;for(let e=0;e<h.vertexIndices.length;e++){let[t,r]=h.vertexIndices[e];if(t===r)continue;let n=r;r<t&&(n+=i);for(let o=t;o<n;o++){let n=o%i,a=(o+1)%i;if(!s.continuous[n]||!s.continuous[a]){h.vertexIndices[e]=[t,n],h.vertexIndices.splice(e+1,0,[a,r]),h.vertices.splice(2*(e+1),0,h.vertices[2*e],h.vertices[2*e+1]);break}}}m.push({bevelI:u,angle:t,size:r,boundary:h,reverseMap:l,insetPoints:o})}let y=(e,t,r)=>{let n=0,i=e.boundary.vertexIndices.length;for(;n<i&&r(e.boundary.vertexIndices[t]);)t=(t+1)%i,n++;return n},b=v.length;for(let n=1;n<m.length;n++){let e=m[n-1],t=m[n],r=e.boundary.vertexIndices.length,o=t.boundary.vertexIndices.length;if(!r||!o)break;let a=s.concave.length,l=0,u=ph(l,i);for(;!e.boundary.vertexIndices.filter(u).length||!t.boundary.vertexIndices.filter(u).length;)l++,u=ph(l,i);let c=e.boundary.vertexIndices.findIndex(u),h=t.boundary.vertexIndices.findIndex(u);do{c=(c+1)%r}while(u(e.boundary.vertexIndices[c]));do{h=(h+1)%o}while(u(t.boundary.vertexIndices[h]));l=(l+1)%i;let d,p,f=l,g=this._buildBevelVert(s,e,(c-1+r)%r),b=this._buildBevelVert(s,t,(h-1+o)%o),x=!1;do{u=ph(l,i);let n=y(e,c,u),f=y(t,h,u),m=x;if(x=!1,n&&!f){for(let t=0;t<n;t++)d=this._buildBevelVert(s,e,(c+t)%r,t/(n-1)),v.push(g.topN,d.topP,b.topN),v.push(d.bottomP,g.bottomN,b.bottomN),g=d;x=!0}else if(!n&&f)for(let e=0;e<f;e++)p=this._buildBevelVert(s,t,(h+e)%o,e/(f-1)),v.push(b.topN,g.topP,p.topP),v.push(g.bottomP,b.bottomN,p.bottomP),b=p;else if(n&&f)if(d=this._buildBevelVert(s,e,c,0),p=this._buildBevelVert(s,t,h,0),m?(v.push(g.topN,p.topP,b.topN),v.push(g.topN,d.topP,p.topP),v.push(p.bottomP,g.bottomN,b.bottomN),v.push(p.bottomP,d.bottomP,g.bottomN)):(v.push(b.topN,g.topN,d.topP),v.push(b.topN,d.topP,p.topP),v.push(d.bottomP,g.bottomN,b.bottomN),v.push(d.bottomP,b.bottomN,p.bottomP)),g=d,b=p,n===f)for(let i=1;i<n;i++)d=this._buildBevelVert(s,e,(c+i)%r,i/(n-1)),p=this._buildBevelVert(s,t,(h+i)%o,i/(f-1)),v.push(g.topN,d.topP,b.topN),v.push(b.topN,d.topP,p.topP),v.push(d.bottomP,g.bottomN,b.bottomN),v.push(d.bottomP,b.bottomN,p.bottomP),g=d,b=p;else if(n>f){let i=n/f,a=0;for(let l=1;l<n;l++)d=this._buildBevelVert(s,e,(c+l)%r,l/(n-1)),v.push(g.topN,d.topP,b.topN),v.push(d.bottomP,g.bottomN,b.bottomN),g=d,l>(a+1)*i&&(a++,p=this._buildBevelVert(s,t,(h+a)%o,a/(f-1)),v.push(b.topN,d.topP,p.topP),v.push(d.bottomP,b.bottomN,p.bottomP),b=p)}else{let i=f/n,a=0;for(let l=1;l<f;l++)p=this._buildBevelVert(s,t,(h+l)%o,l/(f-1)),v.push(b.topN,d.topP,p.topP),v.push(d.bottomP,b.bottomN,p.bottomP),b=p,l>(a+1)*i&&(a++,d=this._buildBevelVert(s,e,(c+a)%r,a/(n-1)),v.push(g.topN,d.topP,b.topN),v.push(d.bottomP,g.bottomN,b.bottomN),g=d)}c=(c+n)%r,h=(h+f)%o,l=(l+1)%a}while(l!==f)}if(this._buildWall(m,s,v),e){let e=[];for(let t=v.length-1;t>=b+2;t-=3){let r=v[t-2],n=v[t-1],i=v[t-0];e.push(i,n,r)}v.splice(b,v.length-b,...e)}if(e){let e=[];for(let t=m[m.length-1].boundary.vertices.length-1;t>=1;t-=2){let r=m[m.length-1].boundary.vertices[t-1],n=m[m.length-1].boundary.vertices[t-0];e.push(r,n)}g.push(e)}if(!e){let e,t=m[m.length-1];try{e=sh({windingRule:m.length>1?Lc.POSITIVE:Lc.ODD,elementType:Uc.POLYGONS,vertexSize:2,strict:!0,contours:[t.insetPoints,...g]})}catch{e=dh}if(!e)throw new Error("Error generating geometry for surface");0===u.length&&Object.assign(this,{capStartIndex:v.length});for(let r=0;r<3*e.elementCount;r+=3){let t=this._buildSurfaceVert(e,e.elements[r+0]),n=this._buildSurfaceVert(e,e.elements[r+1]),i=this._buildSurfaceVert(e,e.elements[r+2]);v.push(t.top,n.top,i.top),v.push(i.bottom,n.bottom,t.bottom)}}this.vertexCache={}}this._buffer.shrink();let y=new p(Uint32Array.from(v),1),b=new p(this._buffer.positions,3),x=new p(this._buffer.normals,3),w=new p(this._buffer.uvs,2);b.needsUpdate=!0,x.needsUpdate=!0,w.needsUpdate=!0,y.needsUpdate=!0,this.setAttribute("position",b),this.setAttribute("normal",x),this.setAttribute("uv",w),this.setIndex(y)}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,r){let n=e[0];for(let i=0,o=n.boundary.vertexCount;i<o;i++){let e=this._buildBevelVert(t,n,i),a=this._buildBevelVert(t,n,(i+1)%o);r.push(a.topP,e.topN,e.bottomN),r.push(a.topP,e.bottomN,a.bottomP)}}_buildSurfaceVert(e,t){let r=t.toString();if(r in this.vertexCache)return this.vertexCache[r];let n=e.vertices[2*t+0],i=e.vertices[2*t+1],o=(n-this._minX)/this._width,a=(i-this._minY)/this._height,s=this._buffer.get(2),l=3*s,u=2*s,c={top:s+0,bottom:s+1};return this._buffer.positions[l+0]=n,this._buffer.positions[l+1]=i,this._buffer.positions[l+2]=this._depth,this._buffer.normals[l+0]=0,this._buffer.normals[l+1]=0,this._buffer.normals[l+2]=1,this._buffer.uvs[u+0]=o,this._buffer.uvs[u+1]=a,this._buffer.positions[l+3]=n,this._buffer.positions[l+4]=i,this._buffer.positions[l+5]=0,this._buffer.normals[l+3]=0,this._buffer.normals[l+4]=0,this._buffer.normals[l+5]=-1,this._buffer.uvs[u+2]=o,this._buffer.uvs[u+3]=a,this.vertexCache[r]=c,c}_buildBevelVert(e,t,r,n=1){let i=`${t.bevelI}:${r}`;if(i in this.vertexCache)return this.vertexCache[i];let o,a,s,l,[u,c]=t.boundary.vertexIndices[r];u!==c?(a=u,o=c,l=!1,s=e.continuous[a]&&e.continuous[o]):(o=u,a=(o-1+e.count)%e.count,l=e.concave[o]&&t.bevelI>0,s=e.continuous[o]||l);let h=Math.cos(t.angle),d=Math.sin(t.angle),p=2*r,f=2*o,m=2*a,v=t.boundary.vertices[p+0],g=t.boundary.vertices[p+1],y=(1-d)*this._bevelSize,b=(v-this._minX)/this._width,x=(g-this._minY)/this._height,w=e.normals[f+0],_=e.normals[f+1],S=e.normals[m+0],O=e.normals[m+1];if(l){w+=(S-w)*(1-n),_+=(O-_)*(1-n);let e=Math.sqrt(w*w+_*_);w/=e,_/=e}let T=this._buffer.get(s?2:4),E=3*T,C=2*T,A={i:r,fi:o,topP:T+0,topN:T+0,bottomP:T+1,bottomN:T+1};return this._buffer.positions[E+0]=v,this._buffer.positions[E+1]=g,this._buffer.positions[E+2]=this._depth-y,this._buffer.normals[E+0]=w*h,this._buffer.normals[E+1]=_*h,this._buffer.normals[E+2]=d,this._buffer.uvs[C+0]=b,this._buffer.uvs[C+1]=x,this._buffer.positions[E+3]=v,this._buffer.positions[E+4]=g,this._buffer.positions[E+5]=y,this._buffer.normals[E+3]=w*h,this._buffer.normals[E+4]=_*h,this._buffer.normals[E+5]=-d,this._buffer.uvs[C+2]=x,this._buffer.uvs[C+3]=b,s||(T+=2,E+=6,C+=4,A.topP=T+0,A.bottomP=T+1,this._buffer.positions[E+0]=v,this._buffer.positions[E+1]=g,this._buffer.positions[E+2]=this._depth-y,this._buffer.normals[E+0]=S*h,this._buffer.normals[E+1]=O*h,this._buffer.normals[E+2]=d,this._buffer.uvs[C+0]=b,this._buffer.uvs[C+1]=x,this._buffer.positions[E+3]=v,this._buffer.positions[E+4]=g,this._buffer.positions[E+5]=y,this._buffer.normals[E+3]=S*h,this._buffer.normals[E+4]=O*h,this._buffer.normals[E+5]=-d,this._buffer.uvs[C+2]=x,this._buffer.uvs[C+3]=b),this.vertexCache[i]=A,A}clone(){let e=new fh(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=Zi(this.userData),e}},mh=class extends s{constructor(e,t=12,r={}){super(),this.type="ShapeGeometry",this.windingRule=Lc.ODD,this.elementType=Uc.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:Lc.ODD,elementType:Uc.POLYGONS,polySize:3,vertexSize:2,strict:!0},r);let n,i,o,a=this._shape.extractShapePointsToFlatArray([],this._curveSegments),s=this._shape.shapeHoles.map((e=>e.extractShapePointsToFlatArray([],this._curveSegments))),l=!0,u=!0;for(let d=0,p=a.length/2;d<p;d++){let e=2*d,t=a[e+0],r=a[e+1];if(void 0!==i&&t!==i&&(l=!1),void 0!==o&&r!==o&&(u=!1),i=t,o=r,!l&&!u)break}if(!l&&!u)try{n=sh({contours:[a,...s],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{n=ch}let c=(null==n?void 0:n.vertexCount)??1,h=(null==n?void 0:n.elementCount)??1;if(this._positionAttribute=new p(new Float32Array(3*c),3),this._normalAttribute=new p(new Float32Array(3*c),3),this._uvAttribute=new p(new Float32Array(2*c),2),this._indexAttribute=new p(new Uint32Array(3*h),1),n){let e=1/0,t=-1/0,r=1/0,i=-1/0;for(let s=0,l=c;s<l;s++){let o=2*s,a=n.vertices[o+0],l=n.vertices[o+1];a<e&&(e=a),a>t&&(t=a),l<r&&(r=l),l>i&&(i=l)}let o=t-e,a=i-r;for(let s=0,l=c;s<l;s++){let t=2*s,i=n.vertices[t+0],l=n.vertices[t+1],u=(i-e)/o,c=(l-r)/a;this._positionAttribute.setXYZ(s,i,l,0),this._normalAttribute.setXYZ(s,0,0,1),this._uvAttribute.setXY(s,u,c)}for(let s=0,l=h;s<l;s++){let e=3*s,t=n.elements[e+0],r=n.elements[e+1],i=n.elements[e+2];this._indexAttribute.setX(e+0,t),this._indexAttribute.setX(e+1,r),this._indexAttribute.setX(e+2,i)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,3*((null==n?void 0:n.elementCount)??1))}clone(){let e=new mh(this._shape,this._curveSegments);return e.userData=Zi(this.userData),e}},vh=class extends fh{constructor(e,t,r=0,n=12,i=3,o=Lc.ODD){super(e,t,r,n,i,o),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,r){let n=e[0];for(let i=0,o=n.boundary.vertexCount;i<o;i++){let e=this._buildBevelVert(t,n,i),a=this._buildBevelVert(t,n,(i+1)%o);r.push(a.topP,e.topN,e.bottomN),r.push(a.topP,e.bottomN,a.bottomP)}}clone(){let e=new vh(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=Zi(this.userData),e}},gh=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n;let i=Object.assign({},(null==t?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:Lc.ODD},e.parameters),o=Math.abs(i.width),a=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),l=e.shape??(null==t?void 0:t.shape),u=(null==l?void 0:l.roundness)??i.roundness;void 0!==l&&(l instanceof jc?(l.width!==o||l.height!==a)&&l.applySize(o,a):l=new jc(o,a).fromJSON(l),void 0!==(null==(r=e.parameters)?void 0:r.roundness)&&(null==(n=e.parameters)?void 0:n.roundness)>0&&l.update());let c=l??new jc(o,a);return{parameters:Object.assign(i,{width:o,height:a,depth:s,roundness:u}),shape:c}}static build(e){let t,{depth:r,extrudeBevelSize:n,extrudeBevelSegments:i,subdivisions:o,roundness:a,windingRule:s}=e.parameters;return e.shape.roundness=a,t=r<=0?new mh(e.shape,o,{windingRule:s}):new vh(e.shape,r,n,o,i,s),Object.assign(t,{userData:{...e,type:"VectorGeometry"}})}},yh=2*Math.PI,bh=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof jc?e.shape:new jc,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:t,height:r,spikes:n,angle:i,innerRadius:o,depth:a,extrudeBevelSize:s,extrudeBevelSegments:l}=e.parameters,u=e.shape,c=function(e,t,r,n,i,o){if(n>=yh)return i>30||i%4==0?(function(e,t,r,n=0,i=0,o=0){let a=.5522847498,s=t*a,l=r*a;e.addPoint(_h(i-t,o,i-t,o-l,i-t,o+l)),e.addPoint(_h(i,o+r,i-s,o+r,i+s,o+r)),e.addPoint(_h(i+t,o,i+t,o+l,i+t,o-l)),e.addPoint(_h(i,o-r,i+s,o-r,i-s,o-r)),n>0&&Oh(e,t,r,n)}(e,t,r,o),Math.round(i/4)):xh(e,n,i,t,r,o);n=Math.max(n,.001);let a={x:0,y:r},s=n+.5*Math.PI,l={x:Math.cos(s)*t,y:Math.sin(s)*r},u=qc({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:r,largeArcFlag:n>Math.PI,sweepFlag:!0});return i>30||i%u.length==0?function(e,t,r,n,i,o,a,s){let l=Math.round(i/n.length);e.addPoint(wh(t,r));for(let u=0,c=n.length;u<c;u++){let t=n[u],r=e.points[u],i=wh(t.x,t.y);r.controls[1].position.set(t.x1,t.y1),i.controls[0].position.set(t.x2,t.y2),e.addPoint(i)}return s>0?Sh(e,o,a,s):e.addPoint(wh(0,0)),l}(e,a.x,a.y,u,i,t,r,o):xh(e,n,i,t,r,o)}(u,.5*t,.5*r,i*Math.PI/180,n,o);u.isClosed=!0,u.update();let h=gh.create({shape:u,parameters:{subdivisions:c,depth:a,extrudeBevelSize:s,extrudeBevelSegments:l}});return Object.assign(h,{userData:{...e,type:"EllipseGeometry"}})}};function xh(e,t,r,n,i,o){let a=-t/r;for(let s=0;s<=r;s++){let t=a*s,r=Math.sin(t)*n,o=Math.cos(t)*i;e.addPoint(wh(r,o))}return t<yh?o>0?Sh(e,n,i,o):e.addPoint(wh(0,0)):(e.removePoint(e.points[e.points.length-1]),o>0&&Oh(e,n,i,o)),1}function wh(e,t){return new uc(b.generateUUID(),new n(e,t))}function _h(e,t,r,n,i,o){let a=wh(e,t);return a.controls[0].position.set(r,n),a.controls[1].position.set(i,o),a}function Sh(e,t,r,n){Th(e,t,r,n).forEach((t=>e.addPoint(t)))}function Oh(e,t,r,n){let i=Th(e,t,r,n),o=new jc;i.forEach((e=>o.addPoint(e))),o.isClosed=!0,e.shapeHoles.push(o)}function Th(e,t,r,i){let o=i*t/100,a=o*(Math.abs(r)/Math.abs(t)),s=new n(o/t,a/r),l=e.points.map((e=>{let t=e.clone();return t.uuid=b.generateUUID(),t})).reverse();return l.forEach((e=>{e.position.multiply(s);let t=e.controls[0].position.clone().multiply(s),r=e.controls[1].position.clone().multiply(s);e.controls[0].position.copy(r),e.controls[1].position.copy(t)})),l}var Eh=new i([0,0,0],1),Ch=class extends s{constructor(e=!0,t=1,n=1,i=1,o=1,a=1,s=1,l=1,u=1,c=1,h=1,d=1){if(super(),0===a)return;let p=e&&1===a;p&&(d=0),h>100&&(h=100),0===h&&(d=0);let m,v,g,y,b,x,w,_,S=()=>new r,O=new r,T=S(),E=S(),C=S(),A=S(),M=S(),D=S(),P=S(),k=S(),L=S(),U=S(),I=S(),z=n-2*l+.001,R=z/a,N=Math.ceil(s*a),B=N+1,F=z/N,j=-z/2,G=c+1,V=2*Math.PI/c,H=Math.PI/2/d,W=Math.min((1-h/100)*l,l-.01),q=l-W,$=0,X=2*d+2,Y=G*X/2,Z=Y+G*B,K=G*(B+X),[Q,J,ee]=[3,3,2].map((e=>Array(K*e).fill(0))),te=[],re=o-l;function ne(t,r){let n=Math.PI/2;x=r*F,_=2*Math.PI*(x%R)/R+n,x+=j,w=Math.sin(_)*re,b=Math.cos(_)*re,e?t.set(b,w,x):t.set(b,x,w)}ne(O,-1e-10),ne(T,0),A.copy(O),ne(O,1);let ie=O.distanceTo(T),oe=p?0:q+W,ae=ie*N+2*oe,se=W,le=ae-oe;for(let r=0;r<=N;r++){ne(E,r),I.subVectors(E,A).normalize(),A.copy(E),L.copy(E).setComponent(+e+1,0).normalize(),U.crossVectors(I,L).normalize();let t=0===r,n=r===N,i=t?3*Math.PI/2:H,o=t?se:le,a=t?G:Z,s=t?0:K-G,u=I.clone().multiplyScalar(t?-q:q).add(E),h=I.clone().multiplyScalar(t?-1:1).normalize();for(let e=0;e<G;e++){let f=e*V;if(M.addVectors(O.copy(L).multiplyScalar(l*Math.cos(f)),T.copy(U).multiplyScalar(l*Math.sin(f))),D.copy(M).normalize(),t||n){p||($=s+e,[0,1,2].forEach((e=>{Q[3*$+e]=u.getComponent(e),J[3*$+e]=h.getComponent(e)})),ee[2*$]=+n,ee[2*$+1]=e/c),T.copy(D).multiplyScalar(W),C.addVectors(E,T);for(let r=0;r<d;r++){let n=r*H+i;P.addVectors(O.copy(I).multiplyScalar(q*Math.sin(n)),T.copy(D).multiplyScalar(q*Math.cos(n))),k.copy(P).normalize(),T.addVectors(C,P),P.normalize(),$=a+r*G+e,[0,1,2].forEach((e=>{Q[3*$+e]=T.getComponent(e),J[3*$+e]=k.getComponent(e)}));let s=+t+Math.sin(n);ee[2*$]=(o+q*s)/ae,ee[2*$+1]=e/c}}T.addVectors(E,M),$=Y+r*G+e,[0,1,2].forEach((e=>{Q[3*$+e]=T.getComponent(e),J[3*$+e]=D.getComponent(e)})),ee[2*$]=(oe+r*ie)/ae,ee[2*$+1]=e/c}}let ue=B+2*d+2,[ce,he]=[+p,ue-1];for(let r=ce;r<=he-1;r++){let e=p&&r===he-1;for(let t=0;t<G-1;t++)m=r*G+t,v=m+1,g=(e?t:m)+G,y=(e?t+1:v)+G,0===r?te.push(v,y,g):r===ue-2?te.push(m,v,g):te.push(m,v,g,v,y,g)}this.setIndex(te),this.setAttribute("position",new f(Q,3)),this.setAttribute("normal",new f(J,3)),this.setAttribute("uv",new f(ee,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e,t,r,n,i=this.userData.parameters,o=Math.ceil(i.tubularSegments),a=i.radialSegments+1,s=Array.from(this.getIndex().array),l=6*(o-1)*i.radialSegments,u=o,c=u===o;for(let h=0;h<i.radialSegments;h++)e=u*a+h,t=e+1,r=(c?h:e)+a,n=(c?h+1:t)+a,s[l++]=e,s[l++]=t,s[l++]=r,s[l++]=t,s[l++]=n,s[l++]=r;return s.length=l,Eh.array=s,Eh.count=s.length,Eh}},Ah=class extends ic{constructor(e=1,t=.2,r=4){let n=(1+Math.sqrt(5))/2,i="IcosahedronGeometry";super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],i,e,t,r),this.type=i}static fromJSON(e){return new Ah(e.radius,e.corner,e.cornerSides)}},Mh=new t,Dh=new o,Ph=new r,kh=class extends y{constructor(){super(),this.uuid=b.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=(new x).getNormalMatrix(e);for(let r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(e);for(let r=0,n=this.faces.length;r<n;r++){let e=this.faces[r];e.normal.applyMatrix3(t).normalize();for(let r=0,n=e.vertexNormals.length;r<n;r++)e.vertexNormals[r].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Mh.makeRotationX(e),this.applyMatrix4(Mh),this}rotateY(e){return Mh.makeRotationY(e),this.applyMatrix4(Mh),this}rotateZ(e){return Mh.makeRotationZ(e),this.applyMatrix4(Mh),this}translate(e,t,r){return Mh.makeTranslation(e,t,r),this.applyMatrix4(Mh),this}scale(e,t,r){return Mh.makeScale(e,t,r),this.applyMatrix4(Mh),this}lookAt(e){return Dh.lookAt(e),Dh.updateMatrix(),this.applyMatrix4(Dh.matrix),this}fromBufferGeometry(e){let t=this,i=null!==e.index?e.index:void 0,o=e.attributes;if(void 0===o.position)return this;let a=o.position,s=o.normal,l=o.color,u=o.uv,c=o.uv2;void 0!==c&&(this.faceVertexUvs[1]=[]);for(let n=0;n<a.count;n++)t.vertices.push((new r).fromBufferAttribute(a,n)),void 0!==l&&t.colors.push((new w).fromBufferAttribute(l,n));function h(e,i,o,a){let h=void 0===l?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[o].clone()],d=void 0===s?[]:[(new r).fromBufferAttribute(s,e),(new r).fromBufferAttribute(s,i),(new r).fromBufferAttribute(s,o)],p=new Uh(e,i,o,d,h,a);t.faces.push(p),void 0!==u&&t.faceVertexUvs[0].push([(new n).fromBufferAttribute(u,e),(new n).fromBufferAttribute(u,i),(new n).fromBufferAttribute(u,o)]),void 0!==c&&t.faceVertexUvs[1].push([(new n).fromBufferAttribute(c,e),(new n).fromBufferAttribute(c,i),(new n).fromBufferAttribute(c,o)])}let d=e.groups;if(d.length>0)for(let r=0;r<d.length;r++){let e=d[r],t=e.start;for(let r=t,n=t+e.count;r<n;r+=3)void 0!==i?h(i.getX(r),i.getX(r+1),i.getX(r+2),e.materialIndex):h(r,r+1,r+2,e.materialIndex)}else if(void 0!==i)for(let r=0;r<i.count;r+=3)h(i.getX(r),i.getX(r+1),i.getX(r+2));else for(let r=0;r<a.count;r+=3)h(r,r+1,r+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ph).negate(),this.translate(Ph.x,Ph.y,Ph.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,r=this.boundingSphere.radius,n=0===r?1:1/r,i=new t;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(i),this}computeFaceNormals(){let e=new r,t=new r;for(let r=0,n=this.faces.length;r<n;r++){let n=this.faces[r],i=this.vertices[n.a],o=this.vertices[n.b],a=this.vertices[n.c];e.subVectors(a,o),t.subVectors(i,o),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let n=0,i=this.vertices.length;n<i;n++)t[n]=new r;if(e){let e=new r,n=new r;for(let r=0,i=this.faces.length;r<i;r++){let i=this.faces[r],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,a),n.subVectors(o,a),e.cross(n),t[i.a].add(e),t[i.b].add(e),t[i.c].add(e)}}else{this.computeFaceNormals();for(let e=0,r=this.faces.length;e<r;e++){let r=this.faces[e];t[r.a].add(r.normal),t[r.b].add(r.normal),t[r.c].add(r.normal)}}for(let r=0,n=this.vertices.length;r<n;r++)t[r].normalize();for(let r=0,n=this.faces.length;r<n;r++){let e=this.faces[r],n=e.vertexNormals;3===n.length?(n[0].copy(t[e.a]),n[1].copy(t[e.b]),n[2].copy(t[e.c])):(n[0]=t[e.a].clone(),n[1]=t[e.b].clone(),n[2]=t[e.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e],r=t.vertexNormals;3===r.length?(r[0].copy(t.normal),r[1].copy(t.normal),r[2].copy(t.normal)):(r[0]=t.normal.clone(),r[1]=t.normal.clone(),r[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,r=this.faces.length;t<r;t++){let e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,r=e.vertexNormals.length;t<r;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}let e=new kh;e.faces=this.faces;for(let t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let e=this.morphNormals[t].faceNormals,n=this.morphNormals[t].vertexNormals;for(let t=0,i=this.faces.length;t<i;t++){let t=new r,i={a:new r,b:new r,c:new r};e.push(t),n.push(i)}}let n=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e],r=n.faceNormals[e],i=n.vertexNormals[e];r.copy(t.normal),i.a.copy(t.vertexNormals[0]),i.b.copy(t.vertexNormals[1]),i.c.copy(t.vertexNormals[2])}}for(let t=0,r=this.faces.length;t<r;t++){let e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new a),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new c),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,r=0){if(!e||!e.isGeometry)return;let n,i=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,u=this.colors,c=e.colors;void 0!==t&&(n=(new x).getNormalMatrix(t));for(let h=0,d=a.length;h<d;h++){let e=a[h].clone();void 0!==t&&e.applyMatrix4(t),o.push(e)}for(let h=0,d=c.length;h<d;h++)u.push(c[h].clone());for(let h=0,d=l.length;h<d;h++){let e,t,o=l[h],a=o.vertexNormals,u=o.vertexColors,c=new Uh(o.a+i,o.b+i,o.c+i);c.normal.copy(o.normal),void 0!==n&&c.normal.applyMatrix3(n).normalize();for(let r=0,i=a.length;r<i;r++)e=a[r].clone(),void 0!==n&&e.applyMatrix3(n).normalize(),c.vertexNormals.push(e);c.color.copy(o.color);for(let r=0,n=u.length;r<n;r++)t=u[r],c.vertexColors.push(t.clone());c.materialIndex=o.materialIndex+r,s.push(c)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let t=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(let e=0,r=t.length;e<r;e++){let r=t[e],n=[];for(let e=0,t=r.length;e<t;e++)n.push(r[e].clone());this.faceVertexUvs[h].push(n)}}}mergeMesh(e){e&&e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix))}mergeVertices(e=4){let t={},r=[],n=[],i=Math.pow(10,e);for(let s=0,l=this.vertices.length;s<l;s++){let e=this.vertices[s],o=Math.round(e.x*i)+"_"+Math.round(e.y*i)+"_"+Math.round(e.z*i);void 0===t[o]?(t[o]=s,r.push(this.vertices[s]),n[s]=r.length-1):n[s]=n[t[o]]}let o=[];for(let s=0,l=this.faces.length;s<l;s++){let e=this.faces[s];e.a=n[e.a],e.b=n[e.b],e.c=n[e.c];let t=[e.a,e.b,e.c];for(let r=0;r<3;r++)if(t[r]===t[(r+1)%3]){o.push(s);break}}for(let s=o.length-1;s>=0;s--){let e=o[s];this.faces.splice(e,1);for(let t=0,r=this.faceVertexUvs.length;t<r;t++)this.faceVertexUvs[t].splice(e,1)}let a=this.vertices.length-r.length;return this.vertices=r,a}setFromPoints(e){this.vertices=[];for(let t=0,n=e.length;t<n;t++){let n=e[t];this.vertices.push(new r(n.x,n.y,n.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let a=0;a<t;a++)e[a]._id=a;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));let r,n,i=this.faceVertexUvs[0],o=this.faceVertexUvs[1];i&&i.length===t&&(r=[]),o&&o.length===t&&(n=[]);for(let a=0;a<t;a++){let t=e[a]._id;r&&r.push(i[t]),n&&n.push(o[t])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){let t=this.parameters;for(let r in t)void 0!==t[r]&&(e[r]=t[r]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let e=this.vertices[p];t.push(e.x,e.y,e.z)}let r=[],n=[],i={},o=[],a={},s=[],l={};for(let p=0;p<this.faces.length;p++){let e=this.faces[p],t=!0,n=!1,i=void 0!==this.faceVertexUvs[0][p],o=e.normal.length()>0,a=e.vertexNormals.length>0,s=1!==e.color.r||1!==e.color.g||1!==e.color.b,l=e.vertexColors.length>0,f=0;if(f=u(f,0,0),f=u(f,1,t),f=u(f,2,n),f=u(f,3,i),f=u(f,4,o),f=u(f,5,a),f=u(f,6,s),f=u(f,7,l),r.push(f),r.push(e.a,e.b,e.c),r.push(e.materialIndex),i){let e=this.faceVertexUvs[0][p];r.push(d(e[0]),d(e[1]),d(e[2]))}if(o&&r.push(c(e.normal)),a){let t=e.vertexNormals;r.push(c(t[0]),c(t[1]),c(t[2]))}if(s&&r.push(h(e.color)),l){let t=e.vertexColors;r.push(h(t[0]),h(t[1]),h(t[2]))}}function u(e,t,r){return r?e|1<<t:e&~(1<<t)}function c(e){let t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==i[t]||(i[t]=n.length/3,n.push(e.x,e.y,e.z)),i[t]}function h(e){let t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==a[t]||(a[t]=o.length,o.push(e.getHex())),a[t]}function d(e){let t=e.x.toString()+e.y.toString();return void 0!==l[t]||(l[t]=s.length/2,s.push(e.x,e.y)),l[t]}return e.data={},e.data.vertices=t,e.data.normals=n,o.length>0&&(e.data.colors=o),s.length>0&&(e.data.uvs=[s]),e.data.faces=r,e}clone(){return(new kh).copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());let r=e.colors;for(let h=0,d=r.length;h<d;h++)this.colors.push(r[h].clone());let n=e.faces;for(let h=0,d=n.length;h<d;h++)this.faces.push(n[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let t=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(let e=0,r=t.length;e<r;e++){let r=t[e],n=[];for(let e=0,t=r.length;e<t;e++){let t=r[e];n.push(t.clone())}this.faceVertexUvs[h].push(n)}}let i=e.morphTargets;for(let h=0,d=i.length;h<d;h++){let e={};if(e.name=i[h].name,void 0!==i[h].vertices){e.vertices=[];for(let t=0,r=i[h].vertices.length;t<r;t++)e.vertices.push(i[h].vertices[t].clone())}if(void 0!==i[h].normals){e.normals=[];for(let t=0,r=i[h].normals.length;t<r;t++)e.normals.push(i[h].normals[t].clone())}this.morphTargets.push(e)}let o=e.morphNormals;for(let h=0,d=o.length;h<d;h++){let e={};if(void 0!==o[h].vertexNormals){e.vertexNormals=[];for(let t=0,r=o[h].vertexNormals.length;t<r;t++){let r=o[h].vertexNormals[t],n={};n.a=r.a.clone(),n.b=r.b.clone(),n.c=r.c.clone(),e.vertexNormals.push(n)}}if(void 0!==o[h].faceNormals){e.faceNormals=[];for(let t=0,r=o[h].faceNormals.length;t<r;t++)e.faceNormals.push(o[h].faceNormals[t].clone())}this.morphNormals.push(e)}let a=e.skinWeights;for(let h=0,d=a.length;h<d;h++)this.skinWeights.push(a[h].clone());let s=e.skinIndices;for(let h=0,d=s.length;h<d;h++)this.skinIndices.push(s[h].clone());let l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);let u=e.boundingBox;null!==u&&(this.boundingBox=u.clone());let c=e.boundingSphere;return null!==c&&(this.boundingSphere=c.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=(new Lh).fromGeometry(this),t=new s,r=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",Nh.call(new p(r,3),e.vertices)),e.normals.length>0){let r=new Float32Array(3*e.normals.length);t.setAttribute("normal",Nh.call(new p(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(3*e.colors.length);t.setAttribute("color",zh.call(new p(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(2*e.uvs.length);t.setAttribute("uv",Rh.call(new p(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",Rh.call(new p(r,2),e.uvs2))}t.groups=e.groups;for(let n in e.morphTargets){let r=[],i=e.morphTargets[n];for(let e=0,t=i.length;e<t;e++){let t=i[e],n=new f(3*t.data.length,3);n.name=t.name,r.push(Nh.call(n,t.data))}t.morphAttributes[n]=r}if(e.skinIndices.length>0){let r=new f(4*e.skinIndices.length,4);t.setAttribute("skinIndex",Bh.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new f(4*e.skinWeights.length,4);t.setAttribute("skinWeight",Bh.call(r,e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){}computeLineDistances(){}applyMatrix(e){return this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new s,r=e.geometry;if(e.isPoints||e.isLine){let e=new f(3*r.vertices.length,3),n=new f(3*r.colors.length,3);if(t.setAttribute("position",Nh.call(e,r.vertices)),t.setAttribute("color",zh.call(n,r.colors)),r.lineDistances&&r.lineDistances.length===r.vertices.length){let e=new f(r.lineDistances.length,1);t.setAttribute("lineDistance",Ih.call(e,r.lineDistances))}null!==r.boundingSphere&&(t.boundingSphere=r.boundingSphere.clone()),null!==r.boundingBox&&(t.boundingBox=r.boundingBox.clone())}else e.isMesh&&(t=r.toBufferGeometry());return t}};kh.prototype.isGeometry=!0;var Lh=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t,r,n,i=[],o=e.faces;for(r=0;r<o.length;r++){let e=o[r];e.materialIndex!==n&&(n=e.materialIndex,void 0!==t&&(t.count=3*r-t.start,i.push(t)),t={start:3*r,materialIndex:n})}void 0!==t&&(t.count=3*r-t.start,i.push(t)),this.groups=i}fromGeometry(e){let t,r=e.faces,i=e.vertices,o=e.faceVertexUvs,a=o[0]&&o[0].length>0,s=o[1]&&o[1].length>0,l=e.morphTargets,u=l.length;if(u>0){t=[];for(let e=0;e<u;e++)t[e]={name:l[e].name,data:[]};this.morphTargets.position=t}let c,h=e.morphNormals,d=h.length;if(d>0){c=[];for(let e=0;e<d;e++)c[e]={name:h[e].name,data:[]};this.morphTargets.normal=c}let p=e.skinIndices,f=e.skinWeights,m=p.length===i.length,v=f.length===i.length;i.length>0&&r.length;for(let g=0;g<r.length;g++){let e=r[g];this.vertices.push(i[e.a],i[e.b],i[e.c]);let y=e.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{let t=e.normal;this.normals.push(t,t,t)}let b=e.vertexColors;if(3===b.length)this.colors.push(b[0],b[1],b[2]);else{let t=e.color;this.colors.push(t,t,t)}if(!0===a){let e=o[0][g];void 0!==e?this.uvs.push(e[0],e[1],e[2]):this.uvs.push(new n,new n,new n)}if(!0===s){let e=o[1][g];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):this.uvs2.push(new n,new n,new n)}for(let r=0;r<u;r++){let n=l[r].vertices;t[r].data.push(n[e.a],n[e.b],n[e.c])}for(let t=0;t<d;t++){let e=h[t].vertexNormals[g];c[t].data.push(e.a,e.b,e.c)}m&&this.skinIndices.push(p[e.a],p[e.b],p[e.c]),v&&this.skinWeights.push(f[e.a],f[e.b],f[e.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}},Uh=class{constructor(e,t,n,i,o,a=0){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new r,this.vertexNormals=Array.isArray(i)?i:[],this.color=o&&o.isColor?o:new w,this.vertexColors=Array.isArray(o)?o:[],this.materialIndex=a}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function Ih(e){return this.array.set(e),this}function zh(e){let t=this.array,r=0;for(let n=0,i=e.length;n<i;n++){let i=e[n];void 0===i&&(i=new w),t[r++]=i.r,t[r++]=i.g,t[r++]=i.b}return this}function Rh(e){let t=this.array,r=0;for(let i=0,o=e.length;i<o;i++){let o=e[i];void 0===o&&(o=new n),t[r++]=o.x,t[r++]=o.y}return this}function Nh(e){let t=this.array,n=0;for(let i=0,o=e.length;i<o;i++){let o=e[i];void 0===o&&(o=new r),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this}function Bh(e){let t=this.array,r=0;for(let n=0,i=e.length;n<i;n++){let i=e[n];void 0===i&&(i=new _),t[r++]=i.x,t[r++]=i.y,t[r++]=i.z,t[r++]=i.w}return this}var Fh=["a","b","c"];function jh(e,t){switch(t){case"c":return e.c;case"b":return e.b;default:return e.a}}function Gh(e,t,r){let n=Math.min(e,t)+"_"+Math.max(e,t);return r.get(n)}function Vh(e,t,r,n,i,o){let a,s=Math.min(e,t),l=Math.max(e,t),u=s+"_"+l;if(n.has(u))a=n.get(u);else{a={a:r[s],b:r[l],newEdge:null,faces:[]},n.set(u,a)}a.faces.push(i),o[e].edges.push(a),o[t].edges.push(a)}function Hh(e,t,r,n,i){e.push(new Uh(t,r,n,void 0,void 0,i))}function Wh(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function qh(e,t,r,n){e.push([t.clone(),r.clone(),n.clone()])}var $h=new r,Xh=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof jc?e.shape:new jc,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:t,height:r,spikes:n,cornerRadius:i,depth:o,extrudeBevelSize:a,extrudeBevelSegments:s}=e.parameters,l=e.shape,u=.5*t,c=.5*r,h=2*Math.PI/n;for(let p=0;p<n;p++){let e=h*p,t=0+Math.sin(e)*u,r=0+Math.cos(e)*c;l.addPoint(l.createPoint(t,r))}l.isClosed=!0;for(let p=0,f=l.points.length;p<f;p++)l.points[p].roundness=i;l.roundness=i,l.update();let d=gh.create({shape:l,parameters:{roundness:i,depth:o,extrudeBevelSize:a,extrudeBevelSegments:s}});return Object.assign(d,{userData:{...e,type:"PolygonGeometry"}})}};function Yh(e,t,r){r.x=e.x*t.x,r.y=e.y,r.z=e.x*t.y}function Zh(e,t,r,n,i,o){let a=t.clone().sub(e),s=r.clone().sub(e),l=a.angleTo(s);if(a.normalize(),s.normalize(),n===i){let t=a.add(s).normalize();o.copy(e).addScaledVector(t,n/Math.sin(l/2))}else{let t=a.angleTo(s);o.copy(e),o.addScaledVector(a,i/Math.sin(t)),o.addScaledVector(s,n/Math.sin(t))}}function Kh(e,t,r){let n=e.clone().sub(t),i=r.clone().sub(t);return n.projectOnVector(i),n.add(t)}var Qh=class extends s{constructor(e=.5,t=1,i=4,o=1,a=!1,s=0,l=4){super(),i=Math.floor(Math.max(3,i)),o=Math.floor(o),l=Math.floor(l);let u,c=[],h=[],d=[],p=[],m=0,v=t/2,g=Math.PI/i,y=e*Math.cos(Math.PI/i),b=2*Math.PI/i,x=(i-2)*Math.PI/i,w=Math.PI-x,_=new r(0,-v,0),S=new r(0,v,0),O=new n(e,-v),T=new n(y,-v),E=new n(0,S.y).sub(T),C=new n(0,S.y).sub(O),A=new n(E.y,-E.x).normalize(),M=new n(C.y,-C.x).normalize(),D=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-E.angle())/2)-1e-8;s=Math.min(s,D);{let e=new r(A.x,A.y,0),t=new r(Math.cos(b)*e.x,e.y,Math.sin(b)*e.x);u=e.angleTo(t)}let P=s/Math.tan((Math.PI-E.angle())/2),k=s/Math.tan((Math.PI-u)/2),L=new r;if(!a){h.push(_.x,_.y,_.z),d.push(0,-1,0),p.push(0,0);let e=m++,t=[],r=O.clone(),o=P/Math.cos(Math.PI/i);r.x-=o;for(let a=0;a<i;a++){let e=a/i*Math.PI*2+g;Yh(r,new n(Math.sin(e),Math.cos(e)),L),h.push(L.x,L.y,L.z),d.push(0,-1,0),p.push(0,0),t.push(m++)}for(let n=0;n<t.length;n++)c.push(t[n],e,t[(n+1)%t.length])}{let e=new r,t=new r,o=new r,a=new r,f=new r,v=new r;for(let y=0;y<i;y++){let b=y/i*Math.PI*2+g,x=(y+.5)/i*Math.PI*2+g,w=(y+1)/i*Math.PI*2+g,T=new n(Math.sin(b),Math.cos(b)),C=new n(Math.sin(x),Math.cos(x)),D=new n(Math.sin(w),Math.cos(w));Yh(O,T,t),Yh(O,D,o),Yh(A,C,e),Zh(S,t,o,k,k,a),h.push(a.x,a.y,a.z),Zh(t,S,o,k,P,f),h.push(f.x,f.y,f.z),Zh(o,t,S,P,k,v),h.push(v.x,v.y,v.z),d.push(e.x,e.y,e.z),d.push(e.x,e.y,e.z),d.push(e.x,e.y,e.z),p.push(0,0),p.push(0,0),p.push(0,0);let L=m++,z=m++,R=m++;if(c.push(L,z,R),s>0){{let e=t.clone().add(o).multiplyScalar(.5),r=S.clone().sub(e).normalize(),n=_.clone().sub(e).normalize().add(r).normalize().multiplyScalar(-1);U(e,v.clone().sub(f),n,E.angle())}let n,g;{let e=new r;Yh(M,D,e);let t=v.clone().add(a).multiplyScalar(.5);t=Kh(t,o,S);let i=v.clone().sub(a);[n,g]=U(t,i,e,u,a.y)}{let e=n,t=e.clone().setY(0).normalize(),i=new r(0,-1,0),o=t.clone().cross(i);I(e,t,i,o)}{let t=E.angle(),n=Math.PI-t,o=S.clone();o.y-=s/Math.sin(t-Math.PI/2);let a=new r,u=[];for(let r=0;r<l;r++){let t=[],c=Math.PI/2-n*r/l,f=Math.cos(c),v=Math.sin(c),g=x;for(let n=0;n<=r;n++){let n=Math.cos(g),l=Math.sin(g);e.x=f*l,e.y=v,e.z=f*n,a.copy(o).addScaledVector(e,s),h.push(a.x,a.y,a.z),d.push(e.x,e.y,e.z),p.push(0,0),t.push(m++),g+=2*Math.PI/r/i}u.push(t)}g.reverse(),u.push(g);let f=u.length-1;for(let e=0;e<f;e++){let t=u[e],r=u[e+1],n=t.length-1;c.push(r[1],t[0],r[0]);for(let e=1;e<=n;e++)c.push(t[e],t[e-1],r[e]),c.push(r[e+1],t[e],r[e])}}}}}function U(e,t,n,i,o){let a=-i/2,u=(Math.PI-i)/2,f=t.clone().normalize().cross(n);e.addScaledVector(n,-s/Math.sin(u));let v=new r,g=new r,y=m,b=[];for(let r=0;r<=l;r++){let u=a+r/l*i;g.set(0,0,0),g.addScaledVector(f,Math.sin(u)),g.addScaledVector(n,Math.cos(u));for(let r=0;r<=1;r++){let n=r/1-.5;if(v.copy(e),v.addScaledVector(t,n),v.addScaledVector(g,s),null!=o){let e=Math.max(0,v.y-o);v.addScaledVector(t,-e/t.y)}h.push(v.x,v.y,v.z),d.push(g.x,g.y,g.z),p.push(0,0),0===r&&b.push(m),m++}}for(let r=0;r<l;r++)for(let e=0;e<1;e++){let t=y+e+2*r,n=t+2,i=n+1,o=t+1;c.push(t,n,o),c.push(n,i,o)}return[e.clone().addScaledVector(t,.5),b]}function I(e,t,n,i){let o=Math.PI/2,a=C.angle()-o,u=[],f=new r,v=new r;for(let r=0;r<=l;r++){let c=[],g=r/l;for(let l=0;l<=r;l++){let u=((r?l/r:0)-.5)*w,y=Math.cos(u),b=Math.sin(u),x=(o+Math.atan(Math.tan(a)*y))*g,_=Math.cos(x),S=Math.sin(x);f.set(0,0,0),f.addScaledVector(t,S*y),f.addScaledVector(n,_),f.addScaledVector(i,S*b),v.copy(e).addScaledVector(f,s),h.push(v.x,v.y,v.z),d.push(f.x,f.y,f.z),p.push(0,0),c.push(m++)}u.push(c)}let g=u.length-1;for(let r=0;r<g;r++){let e=u[r],t=u[r+1],n=e.length-1;c.push(e[0],t[1],t[0]);for(let r=1;r<=n;r++)c.push(e[r-1],e[r],t[r]),c.push(e[r],t[r+1],t[r])}}this.setIndex(c),this.setAttribute("position",new f(h,3)),this.setAttribute("normal",new f(d,3)),this.setAttribute("uv",new f(p,2))}},Jh=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),n=Object.assign((null==t?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof jc?e.shape:new jc,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)}),ui:n}}static build(e){let t=e.shape,{width:r,height:n,cornerRadius:i,cornerType:o,depth:a,extrudeBevelSize:s,extrudeBevelSegments:l}=e.parameters,u={x:.5*r,y:.5*n},c={x:-u.x,y:-u.y},h={x:u.x,y:u.y};function d(e,t,i){return t>r&&i>n?Math.min(e*r/t,e*n/i):t>r?e*r/t:i>n?e*n/i:e}let p=[];p[0]=0===i[0]?0:d(i[0],i[0]+i[3],i[0]+i[1]),p[1]=0===i[1]?0:d(i[1],i[1]+i[2],i[1]+i[0]),p[2]=0===i[2]?0:d(i[2],i[2]+i[1],i[2]+i[3]),p[3]=0===i[3]?0:d(i[3],i[3]+i[0],i[3]+i[2]);let f=c.x,m=h.x,v=h.y,g=c.y;t.addPoint(t.createPoint(f,v)),t.addPoint(t.createPoint(m,v)),t.addPoint(t.createPoint(m,g)),t.addPoint(t.createPoint(f,g)),t.isClosed=!0;let y=!0;for(let x=0,w=t.points.length;x<w;x++)t.points[x].roundness=p[x],x>0&&p[x]!==p[x-1]&&(y=!1);y&&(t.roundness=p[0]),t.useCubicForRoundedCorners=1!==o,t.update();let b=gh.create({shape:t,parameters:{depth:a,extrudeBevelSize:s,extrudeBevelSegments:l}});return Object.assign(b,{userData:{...e,type:"RectangleGeometry"}})}},ed=class extends s{constructor(e=1,t=1,n=1,i=90,o=10,a=24){super(),this.type="BackdropGeometry";let s=[],l=[],u=[],c=.001;0==o&&(a=1),a=Math.max(1,Math.floor(a)),o=Math.min(o,100),i=Math.min(180-c,i),i*=Math.PI/180;let h=[],d=Math.PI/2,p=(e=0,t=0,n=0)=>new r(e,t,n),m=p(),v=p(),[g,y,b]=[t/2,e/2,n/2],x=-y,w=+y,[_,S,O]=[p(x,-g,+b),p(x,-g,-b),p(x,+g,-b)],T=(e,t=!1)=>Math.sin(e-Math.PI/(+t+1)),E=(e,t=!1)=>Math.cos(e-Math.PI/(+t+1));O.y=Math.sin(i)*t-g;let C=Math.cos(i)*t-b,A=_.z-c;i<=d?(O.z=Math.min(C,A),O.z==A&&(O.y-=(C-A)/Math.tan(d-i))):S.z=Math.min(S.z-C-b,_.z-c),m.subVectors(_,S),v.subVectors(O,S);let M=Math.min(m.length(),v.length())*o/100,D=M*Math.tan(i/2),P=M/Math.cos(i/2),k=m.clone().normalize().add(v.normalize()).setLength(P).add(S);m.set(0,T(i,!0),E(i,!0)),h.push([O,m.clone()]);let L=(Math.PI-i)/a;for(let r=0;r<=a;r++){let e=d+i+r*L;m.set(0,Math.sin(e)*D,Math.cos(e)*D),m.add(k),v.set(0,T(e),E(e)),h.push([m.clone(),v.clone()])}h.push([_,p(0,1,0)]);let U=Math.sin(L/2)*D*2,I=h.length-1,z=h[0][0].distanceTo(h[1][0]),R=z+U*a+h[I-1][0].distanceTo(h[I][0]);h[0].push(1);for(let r=0;r<=a;r++)h[r+1].push(1-(z+r*U)/R);h[I].push(0);let N,B,F,[j,G,V]=h[0];for(let r=1;r<h.length;r++)[N,B,F]=h[r],s.push(x,j.y,j.z,x,N.y,N.z,w,j.y,j.z,w,j.y,j.z,x,N.y,N.z,w,N.y,N.z),l.push(0,G.y,G.z,0,B.y,B.z,0,G.y,G.z,0,G.y,G.z,0,B.y,B.z,0,B.y,B.z),u.push(0,V,0,F,1,V,1,V,0,F,1,F),[j,G,V]=[N,B,F];this.setAttribute("position",new f(s,3)),this.setAttribute("normal",new f(l,3)),this.setAttribute("uv",new f(u,2))}},td=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof jc?e.shape:new jc,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:t,height:r,innerRadiusPercent:n,spikes:i,cornerRadius:o,angle:a,depth:s,extrudeBevelSize:l,extrudeBevelSegments:u}=e.parameters,c=e.shape,h=.5*t,d=.5*r,p=a*Math.PI/360/i,f=Math.PI/2*3*-1,m=h*n/100,v=d*n/100;if(3===i&&50===n){p=2*Math.PI/i;for(let e=0;e<i;e++){let t=p*e,r=0+Math.sin(t)*h,n=0+Math.cos(t)*d;c.addPoint(c.createPoint(r,n))}}else for(let y=0;y<i;y++){let e=0+Math.cos(f)*h,t=0+Math.sin(f)*d;c.addPoint(c.createPoint(e,t)),f+=p,e=0+Math.cos(f)*m,t=0+Math.sin(f)*v,c.addPoint(c.createPoint(e,t)),f+=p}c.isClosed=!0;for(let y=0,b=c.points.length;y<b;y++)c.points[y].roundness=o;c.roundness=o,c.update();let g=gh.create({shape:c,parameters:{roundness:o,depth:s,extrudeBevelSize:l,extrudeBevelSegments:u}});return Object.assign(g,{userData:{...e,type:"StarGeometry"}})}};var rd=class extends s{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&1===this.inputs.parameters.extrusion.depth}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&1===e.depth&&function(e,t){let r=2*Math.PI;return(e%r+r)%r==(t%r+r)%r}(e.twist,0)&&e.startScale===e.endScale)}build(){let e=this._extractPathPoints();if(e.length<2)return;let n=this._computeBasisMatrices(e),{depth:i,offset:o}=this.inputs.parameters.extrusion,a=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(o*a),l=this.inputs.path.isClosed?Math.ceil((i+o)*a):Math.ceil(Math.min(1,i+o)*a),u=Math.min(Math.max(2,l-s+1),a+2),c=[],h=[];for(let t=0;t<u;t++){let r=this.inputs.path.isClosed?(t+s)%e.length:Math.min(t+s,e.length-1);c.push(e[r].clone()),h.push(n[r].clone())}let d=(e,n,i)=>{c[e]=c[e].clone().lerp(c[n],i),h[e]=function(e,n,i){let o=[new r,new r,new r],a=[new r,new r,new r];return e.extractBasis(o[0],o[1],o[2]),n.extractBasis(a[0],a[1],a[2]),o.forEach(((e,t)=>{let r=a[t],n=b.lerp(e.length(),r.length(),i);e.lerp(r,i).setLength(n)})),(new t).makeBasis(o[0],o[1],o[2])}(h[e],h[n],i)},f=0,m=o*a%1;(!this.inputs.path.isClosed||i<=1)&&(m||0===o)&&(f=m,d(0,1,f));let v=0,g=(o+i)*a%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&o+i<1)&&g&&(v=g,d(c.length-1,c.length-2,1-v)),0===i){let e=c.length-1;c[e].copy(c[0]),h[e].copy(h[0])}this._applyPathModifiers(h,f,v);let{regions:y,infos:x,vertices:w}=this._computeShapePoints(5),_=0,S=0;x.sort(((e,t)=>e.start-t.start)),x.forEach((e=>{e.verticesStart=_,e.verticesCount=e.continuous.reduce(((e,t,r)=>e+(0!==r&&t?1:2)),0),S+=e.verticesCount,_=S}));let O,T=S*u,E=0;if(this._isOpenEnded()){try{O=sh({windingRule:Lc.ODD,elementType:Uc.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:y})}catch{O=dh}E=O.vertexCount}let C=T+2*E,A={positions:new Float32Array(3*C),normals:new Float32Array(3*C),uvs:new Float32Array(2*C)},M=[];x.forEach((e=>{this._extrudeRegion(e,w,h,c,A,M,this._isGeometryClosed()&&!this._isOpenEnded())})),O&&(this._closeEnd(O,T,M,A,h[0],c[0],!1),this._closeEnd(O,T+E,M,A,h[h.length-1],c[c.length-1],!0)),this.setAttribute("position",new p(A.positions,3)),this.setAttribute("normal",new p(A.normals,3)),this.setAttribute("uv",new p(A.uvs,2)),this.setIndex(M)}_extractPathPoints(){let e=Yu(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach((e=>{t[t.length-1].distanceToSquared(e)>.001&&t.push(e)})),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let n=[],i=e.length,o=this.inputs.path.isClosed,a=new r,s=new r,l=new r,u=new r,c=new r(0,1,0);for(let r=0;r<i;r++){let h,d,p=e[r];h=0===r?o?e[e.length-2]:p.clone().multiplyScalar(2).sub(e[1]):e[r-1],d=r===i-1?o?e[1]:p.clone().multiplyScalar(2).sub(e[r-1]):e[r+1];let f=p.clone().sub(h).normalize(),m=d.clone().sub(p).normalize(),v=f.clone().add(m).normalize();l.copy(v),0===r&&(v.equals(c)||v.clone().negate().equals(c))&&c.set(0,0,1);let g=c.clone().cross(v).normalize(),y=v.clone().cross(g).normalize();c.copy(y),u.copy(g),0===r&&(a.copy(y),s.copy(v));let b=(new t).makeBasis(g,y,v);n.push(b)}let h=o?s:l,d=o?a:new r(0,1,0),p=h.clone().cross(u).normalize(),f=Math.acos(d.dot(p));if(isNaN(f))return n;let m=d.clone().cross(p);h.dot(m)>0&&(f*=-1);for(let r=1;r<n.length;r++){let e=(new t).makeRotationZ(f*r/n.length);n[r].multiply(e)}return n}_applyPathModifiers(e,r,n){let i=e.length,{angle:o,twist:a,startScale:s,endScale:l}=this.inputs.parameters.extrusion,u=new t,c=new t;return e.forEach(((e,t)=>{let h=0===t?0:t===i-1?1:(t-r)/(i-(0===n?0:1)-(r+(1-n)));u.makeRotationZ(b.lerp(o,o+a,h));let d=b.lerp(s,l,h);c.makeScale(d,d,d),e.multiply(u).multiply(c)})),e}_computeShapePoints(e=12,t=Lc.ODD){let r,n,i=this.inputs.shapeData,o=i.extractShapePointsToFlatArray([],e),a=i.shapeHoles.map((t=>{let r=t.extractShapePointsToFlatArray([],e),n=[];for(let e=r.length-1;e>=1;e-=2){let t=r[e-1],i=r[e-0];n.push(t,i)}return n}));try{r=sh({windingRule:t,elementType:Uc.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{r=ch}try{n=sh({windingRule:Lc.ODD,elementType:Uc.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...a]})}catch{n=hh}if(!r)throw new Error("error generating geometry");let s=r.elementCount;if(n){r.elementCount+=n.elementCount;for(let e=0;e<n.elements.length;e++){let t=n.elements[e],i=e%2==0?r.vertexCount:0;r.elements.push(t+i)}for(let e=0;e<n.vertexIndices.length;e++){let t=n.vertexIndices[e],i=r.vertexCount;r.vertexIndices.push(t+i)}for(let e=0;e<n.vertices.length;e++){let t=n.vertices[e];r.vertices.push(t)}}for(let u=0,c=r.vertexCount;u<c;u++){let e=2*u;r.vertices[e+0],r.vertices[e+1]}let l=[];for(let u=r.elementCount-1;u>=0;u--){let e=u>=s,t=2*u,n=r.elements[t+0],o=r.elements[t+1],a=n+o,c={start:n,count:o,normals:[],isHole:e,continuous:[],verticesStart:0,verticesCount:0};l.push(c);let h=n,d=a-1,p=n+1,f=i.roundedCurves.length;do{let t=h-n;r.vertices[2*d+0],r.vertices[2*d+1];let s=r.vertices[2*h+0],l=r.vertices[2*h+1],u=s-r.vertices[2*p+0],m=l-r.vertices[2*p+1],v=Math.sqrt(u*u+m*m);u/=v,m/=v,c.normals[2*t+0]=-m,c.normals[2*t+1]=u;let g=r.vertexIndices[h];if(Array.isArray(g))c.continuous[t]=!1;else{let[e,r]=i.getCurveIndexFromVertexId(g-1,!0);if(r>0&&r<1)c.continuous[t]=!0;else{let n=1===r?e+1:e-1;n=(n+f)%f;let o=1===r?0:1,a=i.roundedCurves[e].getTangent(r),s=i.roundedCurves[n].getTangent(o);c.continuous[t]=a.dot(s)>.95}}e&&(c.normals[2*t+0]*=-1,c.normals[2*t+1]*=-1),[d,h,p]=[h,p,p+1],p>=a&&(p-=o)}while(p!==n+1)}return{regions:[o,...a],infos:l,vertices:r.vertices}}_insertVertex(e,t,r,n,i){let o=2*t,a=3*t;e.positions[a+0]=r.x,e.positions[a+1]=r.y,e.positions[a+2]=r.z,e.normals[a+0]=n.x,e.normals[a+1]=n.y,e.normals[a+2]=n.z,e.uvs[o+0]=i.x,e.uvs[o+1]=i.y}_extrudeRegion(e,t,i,o,a,s,l){let u=new r,c=new r,h=new r,d=new r,p=new n;i.forEach(((r,n)=>{let s=o[n],l=e.verticesStart*i.length+e.verticesCount*n;for(let o=0;o<e.count;o++){let f=2*(e.start+o);if(u.set(t[f+0],t[f+1],0),h.copy(u).applyMatrix4(r).add(s),e.continuous[o])d.set(e.normals[2*o+0],e.normals[2*o+1],0);else{let r=0==o?2*(e.start+e.count-1):f-2;c.set(t[r+0],t[r+1],0),d.copy(u).sub(c),d.set(-d.y,d.x,0),e.isHole||d.negate()}if(d.applyMatrix4(r).normalize(),p.set(0===o?1:o/e.count,n/(i.length-1)),this._insertVertex(a,l,h,d,p),l++,!e.continuous[o]||0===o){if(0===o)d.set(e.normals[2*o+0],e.normals[2*o+1],0),p.set(0,n/(i.length-1));else{let r=o===e.count-1?2*e.start:f+2;c.set(t[r+0],t[r+1],0),d.copy(c).sub(u),d.set(-d.y,d.x,0),e.isHole||d.negate()}d.applyMatrix4(r).normalize(),this._insertVertex(a,l,h,d,p),l++}}}));let f=i.length-1;for(let r=0;r<f;r++){let t=e.verticesStart*i.length+e.verticesCount*r,n=e.verticesStart*i.length+e.verticesCount*(r+1),o=0;for(let r=0;r<e.count;r++){(!e.continuous[r]||0===r)&&o++;let i=r===e.count-1?0:o+1,a=t+o,l=t+i,u=n+i,c=n+o;e.isHole?s.push(a,u,l,a,c,u):s.push(a,l,u,a,u,c),o++}}}_closeEnd(e,t,i,o,a,s,l){let u=e.vertexCount,c=new r(0,0,l?-1:1).applyMatrix4(a),h=new r,d=new n;for(let r=0;r<u;r++){let n=2*r;h.set(e.vertices[n+0],e.vertices[n+1],0).applyMatrix4(a).add(s),this._insertVertex(o,t+r,h,c,d)}let p=e.elements;for(let r=0;r<e.elementCount;r++){let e=3*r,n=p[e+0]+t,o=p[e+(l?1:2)]+t,a=p[e+(l?2:1)]+t;i.push(n,o,a)}}};function nd(){let e=new s;return e.setAttribute("position",new p(new Float32Array([]),3)),e.setIndex(new p(new Uint16Array([]),1)),e}var id=nd().attributes,od=class extends s{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,id),this.userData={parameters:e,type:"TextGeometry"};let r=t.getFont(e.font);(null==r?void 0:r.isLoaded)?(this.font=r,this.update(e)):this.updateFont(e.font,t).then((()=>{this.update(e),null==t||t.requestRender()}))}async updateFont(e,t){let r=t.getFont(e);r&&(this.font=r,await r.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(null==t?void 0:t.isLoaded))return;let{width:r,height:n,depth:i,extrudeBevelSize:o,extrudeBevelSegments:a,text:s,textTransform:l}=e,u=function(e,t,r){r=r??e.text;let n=[""],i="";for(let o of r)i+=o," "===o||"\n"===o?(n[n.length-1]+=i,i="","\n"===o&&n.push("")):t.getTextWidth(n[n.length-1]+i,e)>e.width&&(n[n.length-1].length&&n.push(""),t.getTextWidth(n[n.length-1]+i,e)>e.width&&(1===i.length?(n[n.length-1]+=i,i=""):(n[n.length-1]+=i.slice(0,-1),i=i[i.length-1],n.push(""))));return n[n.length-1]+=i,n}(e,t,2===l?s.toUpperCase():3===l?s.toLowerCase():s),{shapes:c,charWidths:h,charCoords:d}=t.generateShapes(u,e),p=.5*r,f=.5*n,m=c.map((e=>(new jc).fromShape(e)));this.vectorShapes=m;let v=m.map((e=>gh.create({shape:e,parameters:{depth:i,extrudeBevelSegments:a,extrudeBevelSize:o,windingRule:i<=0?Lc.NONZERO:Lc.ODD,subdivisions:this.isLowResolution&&i>0?1:12}}))),g=v.length?Q(v):nd();g.translate(-p,f,0),this.dispose(),this.wrappedText=u,this.charCoords=d,this.charWidths=h,this.deleteAttribute("extrudeNormal"),Object.entries(g.attributes).forEach((([e,t])=>{this.setAttribute(e,t)})),this.setIndex(g.index),this.computeBoundingSphere()}clone(){let e=Ve(new s,od.prototype);return e.copy(this),e}copy(e){return Object.entries(e.attributes).forEach((([e,t])=>{this.setAttribute(e,t)})),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:e})}get text(){return this.userData.parameters.text??""}};var ad,sd=new Promise((e=>{ad=e})),ld=!1;async function ud(){if(ld)return;let[e,t]=await Promise.all([De((()=>Promise.resolve().then((()=>Og))),void 0,import.meta.url),fetch("https://unpkg.com/@splinetool/modelling-wasm@0.9.377/build/process.wasm").then((e=>e.arrayBuffer()))]),r=e.default,n=await r({wasmBinary:t});ad(n),ld=!0}function cd(e,t,r){let n,i={parameters:e,type:e.type};if("PathGeometry"===e.type)i.path=e.path;else if("VectorGeometry"===e.type){let t=jc.createFromState(e.shape,e.width,e.height);i.shape=t}else if("NonParametricGeometry"===e.type)e.data.groups&&e.data.groups.forEach((e=>e.materialIndex=Math.max(e.materialIndex??0,0))),i.geometry=(new L).parse(e);else{if("SubdivGeometry"===e.type)return new bd(e,r);if("TextGeometry"===e.type)return new od(e,t)}try{n=Nd(i)}catch(tl){}if(!n){let e=jc.createFromState(El.defaultData(),100,100);i.shape=e,n=Nd(i)}return n}var hd=new t;function dd(e,t,r,n){let i,o,a,s=e.position.array,l=e.normal.array,u=hd.makeScale(t,r,n).invert().elements;for(var c=0,h=s.length;c<h;c+=3)s[c]*=t,s[c+1]*=r,s[c+2]*=n,i=l[c],o=l[c+1],a=l[c+2],l[c]=u[0]*i+u[4]*o+u[8]*a,l[c+1]=u[1]*i+u[5]*o+u[9]*a,l[c+2]=u[2]*i+u[6]*o+u[10]*a;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var pd,fd=new a,md=new r;sd.then((e=>{pd=e}));var vd=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),gd=new Uint32Array([0,1,2,3]),yd=new Uint8Array([4]),bd=class extends s{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let r=this.data.scaleBaked,n=Vs.div(t,r);this.subdividedGeometry&&dd(this.subdividedGeometry.attributes,...n),this.originalGeometry&&dd(this.originalGeometry.attributes,...n),this.data=e;let i=this.userData.parameters;this.userData.parameters={width:i.width*n[0],height:i.height*n[1],depth:i.depth*n[2]},this.originalGeometry.boundingSphere.center.multiply(md.fromArray(n));let o=md.set(i.width,i.height,i.depth).length();this.originalGeometry.boundingSphere.radius=o/2}ensureSubdivPointer(){return 0===this.subdivPointer&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,r;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:r}=bd.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new v(100,100,100),r=0}this.subdivPointer=r,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let n=this.subdividedGeometry??this.originalGeometry;Object.assign(this,n),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(bd.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new c,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,r=e.boundingSphere.center;fd.setFromBufferAttribute(t),fd.getCenter(r),e.boundingSphere.radius=r.distanceTo(fd.max),isNaN(e.boundingSphere.radius),fd.getSize(md);let n={width:md.x,height:md.y,depth:md.z};return this.userData.parameters=n,n}static build(e,t,r,n){let i,o,a,s=(null==e?void 0:e.phongAngle)??35;!1===r&&(s=-1),t&&(pd.free_bvh(t),pd.free_subdivision_surface(t));try{i=bd.allocate(e,n)}catch(Ys){i=bd.allocate({positionWASM:vd,indexWASM:gd,verticesPerFaceWASM:yd},n)}if(pd.set_destination_refinement_level(i,0),o=bd.buildLevel(i,!0,s),e.subdivisions>0)try{pd.set_destination_refinement_level(i,e.subdivisions),a=bd.buildLevel(i,!1,s)}catch{try{pd.set_destination_refinement_level(i,e.subdivisions-1),a=bd.buildLevel(i,!1,s)}catch{a=null}}else a=null;return{subdivPointer:i,originalGeometry:o,subdividedGeometry:a}}static primitiveToQuads(e,t,r){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),"DodecahedronGeometry"===e.type&&(e.detail=0);let n,i,o,a,s,l,u=void 0!==e.shape?t.geometry:cd(e,r,!1);if(n="TorusGeometry"===e.type&&e.arc===2*Math.PI?u.getClosedTorusIndicesForBooleanOrSubdiv():u.getIndex(),({positions:i,triIndices:s}=wd(u.getAttribute("position"),n)),"CylinderGeometry"===e.type&&0===e.cornerRadius&&0===e.hollow&&!1===e.openEnded){let t=e.radialSegments*e.heightSegments*3*2;l=[t,t+3*e.radialSegments]}return({indices:o,verticesPerFace:a}=Ed(i,s,u,l)),{positions:i,indices:o,verticesPerFace:a}}static allocate(e,r){var n;let i,o,a,s=[],l=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,o=e.indexWASM,a=e.verticesPerFaceWASM):(i=vd,o=gd,a=yd);let u,c=i.length,h=o.length,d=a.length,p=i.length+s.length+l.length,f=o.length+a.length,m=p*Float32Array.BYTES_PER_ELEMENT+f*Uint32Array.BYTES_PER_ELEMENT,v=p*Float32Array.BYTES_PER_ELEMENT,g=pd._malloc(m),y=new Float32Array(pd.HEAPF32.buffer,g,p),b=new Uint32Array(pd.HEAPU32.buffer,g+v,f);y.set(i,0),y.set(s,i.length),y.set(l,i.length+s.length),b.set(o,0),b.set(a,o.length),(null==(n=null==e?void 0:e.scaleBaked)?void 0:n.some((e=>1!==e)))&&(u=(new t).makeScale(...e.scaleBaked)),r&&(u?u.premultiply(r):u=r);let x=u?pd.alloc_subdivision_surface2(g,c,g+v,h,g+v+o.length*Uint32Array.BYTES_PER_ELEMENT,d,u.elements):pd.alloc_subdivision_surface(g,c,g+v,h,g+v+o.length*Uint32Array.BYTES_PER_ELEMENT,d);return pd._free(g),x}static buildLevel(e,t,r,n,o){let a=o?pd.get_mesh_data2(e,t?pd.Level.CONTROL:pd.Level.REFINED,r,o.elements):pd.get_mesh_data(e,t?pd.Level.CONTROL:pd.Level.REFINED,r),l=pd.HEAPU32.subarray(a>>2,8+(a>>2)),u=l.subarray(4,8),c=0,h=pd.HEAPU32[l[c]>>2],d=pd.HEAPF32.subarray(h>>2,(h>>2)+u[c]);c++;let m=pd.HEAPU32[l[c]>>2],v=pd.HEAPF32.subarray(m>>2,(m>>2)+u[c]);c++;let g=pd.HEAPU32[l[c]>>2],y=pd.HEAPU32.subarray(g>>2,(g>>2)+u[c]);c++;let b=pd.HEAPU32[l[c]>>2],x=pd.HEAPU32.subarray(b>>2,(b>>2)+u[c]);if(c++,void 0===n){let e=new s;if(e.setIndex(new i(x,1)),e.setAttribute("position",new f(d,3)),e.setAttribute("normal",new f(v,3)),t){e.setAttribute("faceMap",new i(y,1));let t=new Float32Array(v.length/3*4).fill(0);e.setAttribute("color",new p(t,4))}return pd.free_mesh_data(a),e.userData.type="SubdivGeometry",e}n.getAttribute("position").copyArray(d),n.getAttribute("normal").copyArray(v),n.attributes.position.needsUpdate=!0,n.attributes.normal.needsUpdate=!0,pd.free_mesh_data(a)}static freeSubdivPointer(e){pd.free_bvh(e),pd.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,r){let n=pd.get_wireframe_data_for_base_level(e),o=pd.HEAPU32.subarray(n>>2,4+(n>>2)),a=o.subarray(2,4),l=0,u=pd.HEAPU32[o[l]>>2],c=pd.HEAPF32.subarray(u>>2,(u>>2)+a[l]);l++;let h=pd.HEAPU32[o[l]>>2],d=pd.HEAPU32.subarray(h>>2,(h>>2)+a[l]);if(void 0===t){let e=new s;e.setAttribute("position",new f(c,3));let t=new Float32Array(c.length);for(let n=0,i=c.length;n<i;)t[n++]=r.r,t[n++]=r.g,t[n++]=r.b;return e.setAttribute("color",new p(t,3)),e.setIndex(new i(d,1)),pd.free_wireframe_data_for_base_level(n),e}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,pd.free_wireframe_data_for_base_level(n)}static updateCollabMesh(e,t,r){let n=0===t;n||pd.set_destination_refinement_level(e,t);let i=r?pd.get_topological_data2(e,n?pd.Level.CONTROL:pd.Level.REFINED,r.elements):pd.get_topological_data(e,n?pd.Level.CONTROL:pd.Level.REFINED),o=pd.HEAPU32.subarray(i>>2,6+(i>>2)),a=o.subarray(3,6),s=0,l=pd.HEAPU32[o[s]>>2],u=new Float32Array(pd.HEAPF32.subarray(l>>2,(l>>2)+a[s]));s++;let c=pd.HEAPU32[o[s]>>2],h=new Uint32Array(pd.HEAPU32.subarray(c>>2,(c>>2)+a[s]));s++;let d=pd.HEAPU32[o[s]>>2],p=new Uint8Array(pd.HEAPU32.subarray(d>>2,(d>>2)+a[s]));return pd.free_topological_data(i),{positions:u,indices:h,verticesPerFace:p}}},xd=["getX","getY","getZ"];function wd(e,t){let r={},n=t?t.count:e.count,i=0,o=[],a=[];for(let l=0;l<n;l++){let n=t?t.getX(l):l,s="";for(let t=0;t<3;t++)s+=~~(1e4*e[xd[t]](n))+",";if(s in r)o.push(r[s]);else{for(let t=0;t<3;t++)a.push(e[xd[t]](n));r[s]=i,o.push(i),i++}}let s=[];for(let l=0;l<o.length;l+=3)o[l]===o[l+1]||o[l]===o[l+2]||o[l+1]===o[l+2]||s.push(o[l],o[l+1],o[l+2]);return{positions:a,triIndices:s}}var _d=new r,Sd=new r,Od=new r,Td=new r;function Ed(e,t,r,n){let i=[],o=[];if(void 0!==r.userData.shape&&0===r.userData.parameters.depth&&0===r.userData.shape.shapeHoles.length){let t=r.userData.shape.extractShapePointsToFlatArray([]),n=r.userData.parameters.spikes;if("EllipseGeometry"===r.userData.type&&n<=24&&n%4==0&&r.userData.parameters.angle>=360){let e=t.length/2/n;t=t.filter(((t,r)=>Math.floor(r/2)%e==0))}let a=0;for(let e=0;e<t.length;e+=2)a+=(t[e]-t[(0===e?t.length:e)-2])*(t[e+1]+t[(0===e?t.length:e)-1]);e.length=0;let s=0;if(a<0)for(let r=0;r<t.length;r+=2)e.push(t[r],t[r+1],0),i.push(s++);else for(let r=t.length-2;r>=0;r-=2)e.push(t[r],t[r+1],0),i.push(s++);return o.push(s),{indices:i,verticesPerFace:o}}for(let a=0,s=r.capStartIndex??t.length;a<s;)if(t[a+1]===t[a+3]&&t[a+2]===t[a+5]||t[a+0]===t[a+3]&&t[a+2]===t[a+4]){_d.set(e[3*t[a]],e[3*t[a]+1],e[3*t[a]+2]),Sd.set(e[3*t[a+1]],e[3*t[a+1]+1],e[3*t[a+1]+2]),Od.set(e[3*t[a+4]],e[3*t[a+4]+1],e[3*t[a+4]+2]),Td.set(e[3*t[a+5]],e[3*t[a+5]+1],e[3*t[a+5]+2]),Sd.sub(_d).normalize(),Od.sub(_d).normalize(),Td.sub(_d).normalize();let r=Sd.cross(Od).dot(Td);Math.abs(r)>.005||n&&n.some(((e,t)=>t%2!=1&&(a>=n[t]&&a<n[t+1])))?(i.push(t[a],t[a+1],t[a+2]),o.push(3),a+=3):(i.push(t[a],t[a+1],t[a+4],t[a+5]),o.push(4),a+=6)}else i.push(t[a],t[a+1],t[a+2]),o.push(3),a+=3;if(void 0!==r.capStartIndex){let t=[],n=[],a=0,s=new Float32Array([r.userData.parameters.depth])[0];for(let r=0,i=0;r<e.length;r+=3,i++)0===e[r+2]&&(t.push(i),a++),e[r+2]===s&&n.push(i);if(0===r.userData.parameters.extrudeBevelSize){let e=n[0];n[0]=n[1],n[1]=e}t.reverse(),i.push(...t,...n),o.push(a,a)}return{indices:i,verticesPerFace:o}}var Cd,Ad,Md={};function Dd(e){let t=e.length,r=t*Uint32Array.BYTES_PER_ELEMENT,n=t*Float32Array.BYTES_PER_ELEMENT,i=Number.isInteger(e[0])?r:n,o=Cd._malloc(i);return(Number.isInteger(e[0])?new Uint32Array(Cd.HEAPU32.buffer,o,t):new Float32Array(Cd.HEAPF32.buffer,o,t)).set(e,0),o}function Pd(e){switch(e){case 0:return Cd.OP.UNION;case 1:return Cd.OP.INTERSECTION;case 2:return Cd.OP.A_MINUS_B;case 3:return Cd.OP.B_MINUS_A;case 4:return Cd.OP.SYMMETRIC_DIFFERENCE;case 5:return Cd.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function kd(e,t){void 0===Ad&&(Ad=Cd.init_csg());let r=Dd(e),n=Cd.csg_calc_topological(Ad,r,e.length,Pd(t));Cd._free(r);let i=Cd.HEAPU32.subarray(n>>2,6+(n>>2)),o=i.subarray(3,6),a=0,s=Cd.HEAPU32[i[a]>>2],l=new Float32Array(Cd.HEAPF32.subarray(s>>2,(s>>2)+o[a]));a++;let u=Cd.HEAPU32[i[a]>>2],c=new Uint32Array(Cd.HEAPU32.subarray(u>>2,(u>>2)+o[a]));a++;let h=Cd.HEAPU32[i[a]>>2],d=new Uint8Array(Cd.HEAPU32.subarray(h>>2,(h>>2)+o[a]));return Cd.free_mesh_data(n),{positions:l,indices:c,verticesPerFace:d}}function Ld(e,t,r,n){void 0===Ad&&(Ad=Cd.init_csg());let i=Dd(e),o=Cd.csg_calc(Ad,i,e.length,n,Pd(t));Cd._free(i);let a=Cd.HEAPU32.subarray(o>>2,5+(o>>2)),s=a.subarray(2,5),l=0,u=Cd.HEAPU32[a[l]>>2],h=Cd.HEAPF32.subarray(u>>2,(u>>2)+s[l]);l++;let d=Cd.HEAPU32[a[l]>>2],p=Cd.HEAPF32.subarray(d>>2,(d>>2)+s[l]);l++;let m=s[l];r.setAttribute("position",new f(h,3)),r.setAttribute("normal",new f(p,3));let v=Cd.HEAPF32.subarray(5+(o>>2),5+(o>>2)+6);return null===r.boundingSphere&&(r.boundingSphere=new c),r.boundingSphere.center.set(v[0],v[1],v[2]),r.boundingSphere.radius=(v[3]**2+v[4]**2+v[5]**2)**.5,r.userData.parameters={width:2*v[3],height:2*v[4],depth:2*v[5]},Cd.free_mesh_data(o),m}function Ud(e,t,r){if(void 0===Cd)return-1;let n,i,o;if(t&&void 0!==e.userData.positions){let t=e.userData;o=t.verticesPerFace.length,n=t.positions,i=Array(t.verticesPerFace.reduce(((e,t)=>e+t),0)+o);for(let e=0,r=0,n=0;e<t.verticesPerFace.length;e++){i[n++]=t.verticesPerFace[e];for(let o=0;o<t.verticesPerFace[e];o++)i[n++]=t.indices[r++]}}else({positions:n,faceIndices:i,nFaces:o}=function(e,t,r){let n,i;i="TorusGeometry"===e.userData.parameters.type&&e.userData.parameters.arc===2*Math.PI?e.getClosedTorusIndicesForBooleanOrSubdiv():e.getIndex();let o,{positions:a,triIndices:s}=wd(e.getAttribute("position"),i);if(t&&r){let{indices:t,verticesPerFace:r}=Ed(a,s,e);o=r.length,n=[];for(let e=0,i=0;e<o;e++){n.push(r[e]);for(let o=0;o<r[e];o++)n.push(t[i++])}}else{let e=s.length;n=Array(e+e/3),o=0;for(let t=0,r=0;r<n.length;)n[r++]=3,o++,n[r++]=s[t++],n[r++]=s[t++],n[r++]=s[t++]}return{positions:a,faceIndices:n,nFaces:o}}(e,t,r));let a=n.length,s=i.length,l=n.length,u=i.length,c=l*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,h=l*Float32Array.BYTES_PER_ELEMENT,d=Cd._malloc(c),p=new Float32Array(Cd.HEAPF32.buffer,d,l),f=new Uint32Array(Cd.HEAPU32.buffer,d+h,u);return p.set(n,0),f.set(i,0),Cd.get_csg_mesh(d,a,d+h,s,o)}function Id(e,t){Cd.transform_csg_mesh(e,t.elements)}function zd(e){Cd.free_csg_mesh(e)}((e,t)=>{for(var r in t)ke(e,r,{get:t[r],enumerable:!0})})(Md,{calcBoolean:()=>Ld,calcBooleanTopological:()=>kd,freeMeshSet:()=>zd,getMeshSet:()=>Ud,transformMeshSet:()=>Id}),new Promise((e=>{})).then((e=>Cd=e));var Rd={ConeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let t,{width:r,depth:n,height:i,radialSegments:o,heightSegments:a,openEnded:s,thetaStart:l,thetaLength:u,cornerRadiusTop:c,cornerRadiusBottom:h,cornerSegments:d}=e.parameters;return t=c>0||h>0||u<360?new tc(0,r/2,i,o,a,s,l,u*Math.PI/180,c,h,d,0,!0):new ae(r/2,i,o,a,s),t.scale(1,1,n/r),Object.assign(t,{userData:{...e,type:"ConeGeometry"}})}},CubeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let t,{width:r,height:n,depth:i,widthSegments:o,heightSegments:a,depthSegments:s,cornerRadius:l,cornerSegments:u}=e.parameters;return t=0==l?new v(r,n,i,o,a,s):new nc(r,n,i,o,a,s,l,u),Object.assign(t,{userData:{...e,type:"CubeGeometry"}})}},CylinderGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters),n=r.width/2,i=r.radiusTop??n,o=r.radiusBottom??n;return i===o?(i=n,o=n):i>o?(i=n,o=o*n/i):(i=i*n/o,o=n),{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width),radiusTop:i,radiusBottom:o})}}static build(e){let t,{width:r,depth:n,height:i,radialSegments:o,heightSegments:a,openEnded:s,thetaStart:l,thetaLength:u,radiusTop:c,radiusBottom:h,cornerRadius:d,cornerSegments:p,hollow:f}=e.parameters;return t=d||f?new tc(c,h,i,o,a,s,l,u*Math.PI/180,d,d,p,f):new oe(c,h,i,o,a,s,l,u*Math.PI/180),t.scale(1,1,n/r),Object.assign(t,{userData:{...e,type:"CylinderGeometry"}})}},DodecahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t,height:r,depth:n,detail:i,corner:o,cornerSides:a}=e.parameters,s=0===i&&0!==o?new oc(.5*t,o,a):new se(.5*t,i);return s.scale(1,r/t,n/t),Object.assign(s,{userData:{...e,type:"DodecahedronGeometry"}})}},EllipseGeometry:bh,HelixGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),n=Math.abs(r.width),i=Math.abs(r.height??n),o=Math.abs(r.depth??n),a=Math.abs(Math.min(n,o))/2;return{parameters:Object.assign(r,{width:n,height:i,depth:o,radius:a,segments:Math.round(r.segments),pathSegments:Math.round(r.pathSegments),cornerSegments:Math.round(r.cornerSegments)})}}static build(e){let{width:t,height:r,depth:n,radius:i,revolutions:o,segments:a,pathRadius:s,pathType:l,pathSegments:u,cornerRadius:c,cornerSegments:h}=e.parameters,d=new Ch(!1,t,r,n,i,o,a,s,l,u,c,h);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},IcosahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t,height:r,depth:n,detail:i,corner:o,cornerSides:a}=e.parameters,s=0===i&&0!==o?new Ah(.5*t,o,a):new he(.5*t,i);return s.scale(1,r/t,n/t),Object.assign(s,{userData:{...e,type:"IcosahedronGeometry"}})}},LatheGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r;((null==(r=e.parameters)?void 0:r.points)??[]).forEach((e=>{Array.isArray(e)&&(e.x=e[0],e.y=e[1])}));let n=Object.assign({},(null==t?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width)})}}static build(e){let{points:t,segments:r,verticalSegments:n}=e.parameters,i=new q;i.moveTo(t[0].x,t[0].y),i.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let o=new de(i.extractPoints(n).shape,r);return o.rotateZ(Math.PI),Object.assign(o,{userData:{...e,type:"LatheGeometry"}})}},NonParametricGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r,n=e.geometry??(null==t?void 0:t.geometry)??(new s).copy(new v(100,100,100));void 0===t?(n.computeBoundingBox(),n.boundingBox.getSize($h),r={width:$h.x,height:$h.y,depth:$h.z,subdivisions:0}):r=t.parameters;let i={...r,...e.parameters};return{parameters:{width:Math.abs(i.width),height:Math.abs(i.height),depth:Math.abs(i.depth),subdivisions:Math.abs(i.subdivisions)},geometry:n}}static build(e){let{width:t,height:i,depth:o,subdivisions:a}=e.parameters,l=e.geometry??(new s).copy(new v(100,100,100)),u=l.userData.parameters;void 0===u?(l.computeBoundingBox(),l.boundingBox.getSize($h)):$h.set(u.width,u.height,u.depth),(t!==$h.x||i!==$h.y||o!==$h.z)&&l.scale(0===$h.x?1:t/$h.x,0===$h.y?1:i/$h.y,0===$h.z?1:o/$h.z);let c=l.originalGeometry;try{a>0?(void 0===c||(null==u?void 0:u.subdivisions)!==a)&&(void 0===c&&(c=l),l=new class{constructor(e=1){this.subdivisions=e}modify(e){(e=e instanceof s?(new kh).fromBufferGeometry(e):e.clone()).mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t,i,o,a,s,l=new r,u=e.vertices,c=e.faces,h=e.faceVertexUvs[0],d=void 0!==h&&h.length>0,p=[],f=new Map;!function(e,t,r,n){let i,o,a;for(i=0,o=e.length;i<o;i++)r[i]={edges:[]};for(i=0,o=t.length;i<o;i++)a=t[i],Vh(a.a,a.b,e,n,a,r),Vh(a.b,a.c,e,n,a,r),Vh(a.c,a.a,e,n,a,r)}(u,c,p,f);let m,v,g,y,b,x,w,_=[];for(let n of Array.from(f.keys())){for(v=f.get(n),g=new r,b=3/8,x=1/8,w=v.faces.length,2!=w&&(b=.5,x=0),g.addVectors(v.a,v.b).multiplyScalar(b),l.set(0,0,0),a=0;a<w;a++){for(y=v.faces[a],s=0;s<3&&(m=u[jh(y,Fh[s])],m===v.a||m===v.b);s++);m&&l.add(m)}l.multiplyScalar(x),g.add(l),v.newEdge=_.length,_.push(g)}let S,O,T,E,C,A,M,D=[];for(i=0,o=u.length;i<o;i++){for(A=u[i],C=p[i].edges,t=C.length,3==t?S=3/16:t>3&&(S=3/(8*t)),O=1-t*Number(S),T=S,t<=2&&2==t&&(O=3/4,T=1/8),M=A.clone().multiplyScalar(O),l.set(0,0,0),a=0;a<t;a++)E=C[a],m=E.a!==A?E.a:E.b,l.add(m);l.multiplyScalar(Number(T)),M.add(l),D.push(M)}let P,k,L,U,I,z,R,N=D.concat(_),B=D.length,F=[],j=[],G=new n,V=new n,H=new n;for(i=0,o=c.length;i<o;i++)y=c[i],P=Number(Gh(y.a,y.b,f).newEdge)+B,k=Number(Gh(y.b,y.c,f).newEdge)+B,L=Number(Gh(y.c,y.a,f).newEdge)+B,Hh(F,P,k,L,y.materialIndex),Hh(F,y.a,P,L,y.materialIndex),Hh(F,y.b,k,P,y.materialIndex),Hh(F,y.c,L,k,y.materialIndex),d&&(U=h[i],I=U[0],z=U[1],R=U[2],G.set(Wh(I.x,z.x),Wh(I.y,z.y)),V.set(Wh(z.x,R.x),Wh(z.y,R.y)),H.set(Wh(I.x,R.x),Wh(I.y,R.y)),qh(j,G,V,H),qh(j,I,G,H),qh(j,z,V,G),qh(j,R,H,V));e.vertices=N,e.faces=F,d&&(e.faceVertexUvs[0]=j)}}(a).modify(c).toBufferGeometry()):(void 0!==c&&(l=c),c=void 0,void 0===l.getAttribute("normal")&&l.computeVertexNormals())}catch{void 0!==c&&(l=c),c=void 0,void 0===l.getAttribute("normal")&&l.computeVertexNormals()}return void 0!==c&&Object.assign(l,{originalGeometry:c}),delete e.geometry,Object.assign(l,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,r){new L(r).load(e,(e=>{let r=this.normalizeInputs({geometry:e});e.boundingBox.getSize($h);let n=100/$h.x;Object.assign(r.parameters,{width:100,height:$h.y*n,depth:$h.z*n}),t(this.build(r))}))}},PolygonGeometry:Xh,PyramidGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t,height:r,depth:n,radialSegments:i,heightSegments:o,openEnded:a,cornerRadius:s,cornerSegments:l}=e.parameters,u=new Qh(.5*t,r,i,o,a,s,l);return u.scale(1,1,n/t),Object.assign(u,{userData:{...e,type:"PyramidGeometry"}})}},RectangleGeometry:Jh,SphereGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t=100,height:r=t,depth:n=t,widthSegments:i=64,heightSegments:o=64,phiStart:a,phiLength:s,thetaStart:l,thetaLength:u}=e.parameters,c=new pe(.5*t,i,o,a,s,l,u);return c.scale(1,r/t,n/t),Object.assign(c,{userData:{...e,type:"SphereGeometry"}})}},PlaneGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:0})}}static build(e){let{width:t=100,height:r=t,widthSegments:n=8,heightSegments:i=8}=e.parameters,o=new fe(t,r,n,i);return o.scale(1,1,1),Object.assign(o,{userData:{...e,type:"PlaneGeometry"}})}},BackdropGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t,height:r,depth:n,angle:i,cornerRadius:o,cornerSegments:a}=e.parameters,s=new ed(t,r,n,i,o,a);return Object.assign(s,{userData:{...e,type:"BackdropGeometry"}})}},StarGeometry:td,TextFrameGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:t,height:r}=e.parameters,n=new fe(t,r);return Object.assign(n,{userData:{...e,type:"TextFrameGeometry"}})}},TorusGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:2*Math.PI,cornerRadius:30,cornerSegments:8},e.parameters),n=Math.abs(r.width),i=Math.abs(r.height??r.width),o=Math.round(Math.abs(r.depth??.25*r.width));return{parameters:Object.assign(r,{width:n,height:i,depth:o})}}static build(e){let{width:t,height:r,depth:n,radialSegments:i,tubularSegments:o,arc:a,cornerRadius:s,cornerSegments:l}=e.parameters,u=function(e,t,r,n,i,o,a,s,l,u,c){return[t,r]=[r,t],a=t/2,i/=2*Math.PI,1==i&&(u=0),new Ch(!0,e,t,r,n,i,o,a,s,l,u,c)}(t,r,n,.5*t,a,o,0,0,i,s,l);return u.scale(1,r/t,1),Object.assign(u,{userData:{...e,type:"TorusGeometry"}})}},TorusKnotGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width),tube:r.tube??.125*r.width})}}static build(e){let{width:t,tube:r,tubularSegments:n,radialSegments:i,p:o,q:a}=e.parameters,s=.5*t;s!==r&&(s-=r);let l=new me(s,r,n,i,o,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},TriangleGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof jc?e.shape:new jc,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width*(r.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(r.depth??0)})}}static build(e){let{width:t=100,height:r,cornerRadius:n,depth:i,extrudeBevelSize:o,extrudeBevelSegments:a,isRect:s}=e.parameters,l=e.shape,u=.5*t,c=.5*r;s?(l.addPoint(l.createPoint(-u,c)),l.addPoint(l.createPoint(u,-c)),l.addPoint(l.createPoint(-u,-c))):(l.addPoint(l.createPoint(0,c)),l.addPoint(l.createPoint(u,-c)),l.addPoint(l.createPoint(-u,-c))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=n;l.roundness=n,l.update();let h=gh.create({shape:l,parameters:{roundness:n,depth:i,extrudeBevelSize:o,extrudeBevelSegments:a}});return Object.assign(h,{userData:{...e,type:"TriangleGeometry"}})}},PathGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(null==t?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),n=Math.abs(r.width),i=Math.abs(r.height??r.width),o=Math.abs(r.depth??0),a=(null==t?void 0:t.shapeData)??bh.create({parameters:Pl}).userData.shape;return{path:e.path??Cl.defaultData(),parameters:Object.assign(r,{width:n,height:i,depth:o,extrusion:{...ru,...r.extrusion}}),shapeData:a}}static build(e){if(e.path.points.length>=2){let t=new rd(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}return Object.assign(new s,{userData:{...e,type:"PathGeometry"}})}},VectorGeometry:gh},Nd=e=>Rd[e.type].create(e);function Bd(e){return null!==e&&"booleanOp"in e}var Fd=class extends(Qu(ve)){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new t}updateVisible(){super.updateVisible(),this.visible=!Bd(this.parent)&&this.visible,Bd(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){-1!==this.booleanMeshSetAddress&&(Md.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Bd(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof Fd&&(e.freeBooleanPointer(),Bd(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e){let t=super.updateTransformState(e);return t&&Bd(this.parent)&&this.invalidateDownstreamBooleanData(!0),t}},jd=new a;function Gd(e,t=0,r=e.count,n,i){let o=1/0,a=1/0,s=1/0,l=-1/0,u=-1/0,c=-1/0;for(let h=t;h<r;h++){let t=e.getX(h),r=e.getY(h),n=e.getZ(h);t<o&&(o=t),r<a&&(a=r),n<s&&(s=n),t>l&&(l=t),r>u&&(u=r),n>c&&(c=n)}jd.min.set(o,a,s),jd.max.set(l,u,c),jd.getCenter(n),jd.getSize(i).multiplyScalar(.5)}var Vd=new s,Hd=new l,Wd=class extends Fd{constructor(e,t){super(Vd,Hd),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let r=this.geometry.getAttribute("position");void 0!==r?Gd(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,e,t):super.updateEntityBoxSize(e,t)}},qd=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},$d=class{constructor(e){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=b.generateUUID(),this.type=e,this.name=""}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,r){return r=r??{},this.analyze(e,r),this.flow(e,t,r)}flow(e,t,r){r=r??{},e.addFlow(r.slot,r.cache,r.context);let n={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),n}build(e,t,r){t=t??this.getType(e,t);let n=e.getNodeData(r??this);return e.analyzing&&this.appendDepsNode(e,n,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,r)}updateFrame(e){}generateReadonly(e,t,r,n,i,o){return""}generate(e,t,r,n,i){return""}parse(e,t,r,n){}appendDepsNode(e,t,r){t.deps=(t.deps||0)+1;let n=e.getTypeLength(r);(n>(t.outputMax||0)||this.getType(e,r))&&(t.outputMax=n,t.output=r)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type}getHash(){let e,t,r="{";for(e in this)t=this[e],t instanceof $d&&(r+='"'+e+'":'+t.getHash()+",");if(this.hashProperties)for(let n=0;n<this.hashProperties.length;n++)e=this.hashProperties[n],t=this[e],r+='"'+e+'":"'+String(t)+'",';return r+='"id":"'+this.uuid+'"}',r}},Xd=new class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,r){r=void 0===r||r,this.keywords[e]={callback:t,cache:r}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return void 0!==this.nodes[e]}containsKeyword(e){return void 0!==this.keywords[e]}},Yd=class extends $d{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=void 0===t.shared||t.shared,this.unique=void 0!==t.unique&&t.unique}build(e,t,r,n){if(t=t??this.getType(e),this.getShared(e,t)){let i=this.getUnique(e,t);i&&void 0===this.uuid&&(this.uuid=b.generateUUID()),r=e.getUUID(r??this.getUUID(),!i);let o=e.getNodeData(r),a=o.output||this.getType(e);if(e.analyzing)return(o.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,o,t),this.generate(e,t,r)):super.build(e,t,r);if(i)return o.name=o.name||super.build(e,t,r),o.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||1===o.deps))return super.build(e,t,r);r=this.getUUID(!1);let s=this.getTemp(e,r);if(s)return e.format(s,a,t);{s=super.generate(e,t,r,o.output,n);let i=this.generate(e,a,r);return e.addNodeCode(s+" = "+i+";"),e.format(s,a,t)}}return super.build(e,t,r)}getShared(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let r=e.getVars()[t];return r?r.name:void 0}generate(e,t,r,n,i){return this.getShared(e,t),r=r??this.uuid,e.getTempVar(r,n??this.getType(e),i,this.getLabel()).name}},Zd=class extends Yd{constructor(e,t){(t=t??{}).shared=void 0!==t.shared&&t.shared,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,r,n,i,o){r=e.getUUID(r??this.getUUID()),n=n??this.getType(e);let a=e.getNodeData(r);return this.getReadonly()&&void 0!==this.generateReadonly?this.generateReadonly(e,t,r,n,i,o):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(n,this,i,o,this.getLabel())),e.format(a.vertex.name,n,t)):(a.fragment||(a.fragment=e.createFragmentUniform(n,this,i,o,this.getLabel())),e.format(a.fragment.name,n,t))}},Kd=class extends Zd{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof n?e:new n(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,r,n,i,o){return e.format("vec2("+this.value.x+", "+this.value.y+")",n,t)}},Qd=class extends Zd{constructor(e=0,t,n){super("v3"),this.nodeType="Vector3",this.value=e instanceof r?e:new r(e,t,n)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,r,n,i,o){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",n,t)}},Jd=class extends w{constructor(e,t,r,n){super(e,t,r),this.isColorA=!0,this.a=n}setRGBA(e,t,r,n){super.setRGB(e,t,r),this.a=n}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}setStyle(e,t="srgb"){let r;if("transparent"===e)return this.setRGBA(0,0,0,0),this;if(r=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let n,i=r[1],o=r[2];switch(i){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.a="rgba"===i?parseFloat(n[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.a="hsla"===i?parseFloat(n[4]):1,super.setStyle(e,t)}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},ep=class extends Zd{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof Jd?e:new Jd(e.r,e.g,e.b,e.a)}generateReadonly(e,t,r,n,i,o){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",n,t)}},tp=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,rp=/[a-z_0-9]+/gi,np=class extends Yd{constructor(e,t,r,n,i){super(i),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=void 0===i,this.isInterface=!1,this.parse(e,t,r,n)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,r,n,i){let o,a=0,s=this.src;if(this.includes)for(let u=0;u<this.includes.length;u++)e.include(this.includes[u],this);for(let u in this.extensions)e.extensions[u]=!0;let l=[];for(;o=rp.exec(this.src);)l.push(o);for(let u=0;u<l.length;u++){let t=l[u],r=t[0],n=!this.isMethod||!this.getInputByName(r),i=r;if(this.keywords[r]||this.useKeywords&&n&&Xd.containsKeyword(r)){let t=this.keywords[r];if(!t){let n=Xd.getKeywordData(r);n.cache&&(t=e.keywords[r]),t=t||Xd.getKeyword(r,e),n.cache&&(e.keywords[r]=t)}i=t.build(e)}r!==i&&"."!==s[t.index+a-1]&&(s=s.substring(0,t.index+a)+i+s.substring(t.index+r.length+a),a+=i.length-r.length),void 0===this.getIncludeByName(i)&&Xd.contains(i)&&e.include(Xd.get(i))}return"source"===t?s:this.isMethod?(this.isInterface||e.include(this,void 0,s),this.name):e.format("( "+s+" )",this.getType(e),t)}parse(e,t,r,n){if(this.src=e||"",this.includes=t??[],this.extensions=r??{},this.keywords=n??{},this.isMethod){let e=tp.exec(this.src);if(this.inputs=[],e&&4==e.length){this.type=e[1],this.name=e[2];let t=e[3].match(rp);if(t){let e=0;for(;e<t.length;){let r,n=t[e++];"in"===n||"out"===n||"inout"===n?r=t[e++]:(r=n,n="");let i=t[e++];this.inputs.push({name:i,type:r,qualifier:n})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},ip=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,op=class extends Yd{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||op.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,r,n,i){this.src=e||"";let o,a,s="",l=ip.exec(e);this.useDefine=i??"#"===this.src.charAt(0),l&&l.length>1?(a=l[1],o=l[2],s=l[3]):(o=this.src,a="f"),this.name=o,this.type=a,this.value=s}build(e,t){if("source"===t){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,r,n,i){return e.format(this.name,this.getType(e),t)}},ap=op;ap.PI="PI",ap.PI2="PI2",ap.RECIPROCAL_PI="RECIPROCAL_PI",ap.RECIPROCAL_PI2="RECIPROCAL_PI2",ap.LOG2="LOG2",ap.EPSILON="EPSILON";var sp=new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}","gim"),lp=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),up=class extends Yd{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,r,n,i){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=sp.exec(e);if(t){let e,r=t[2];for(;e=lp.exec(r);)this.inputs.push({type:e[1],name:e[2]});this.name=t[1]}else this.name="";this.type=this.name}},cp=class extends Yd{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let r=this.index>0?this.index+1:"",n=e.isShader("vertex")?"uv"+r:"vUv"+r;return e.format(n,this.getType(e),t)}};Xd.addKeyword("uv",(function(){return new cp})),Xd.addKeyword("uv2",(function(){return new cp(1)}));var hp=class extends Yd{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??hp.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case I:return["Linear"];case U:return["sRGB"];default:return[]}}generate(e,t){var r;let n=this.input.build(e,"v4"),i=this.getType(e),o=hp.Nodes[this.method],a=e.include(o);if(a===hp.LINEAR_TO_LINEAR)return e.format(n,i,t);if(2===(null==(r=o.inputs)?void 0:r.length)){let r=this.factor.build(e,"f");return e.format(a+"( "+n+", "+r+" )",i,t)}return e.format(a+"( "+n+" )",i,t)}fromEncoding(e){let t=hp.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=hp.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},dp=hp;dp.Nodes={LinearToLinear:new np(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),sRGBToLinear:new np(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new np(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n"))},dp.LINEAR_TO_LINEAR="LinearToLinear",dp.SRGB_TO_LINEAR="sRGBToLinear",dp.LINEAR_TO_SRGB="LinearTosRGB";var pp=class extends np{constructor(e="",t,r,n,i){super(e,i,n,r,t),this.nodeType="Expression"}},fp=class extends Zd{constructor(e=new m,t,r,n){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new cp,this.bias=r,this.project=void 0!==n&&n}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if("sampler2D"===t)return this.getTexture(e,t);let r,n,i=this.getTexture(e,t),o=this.uv.build(e,this.project?"v4":"v2"),a=this.bias?this.bias.build(e,"f"):void 0;void 0===a&&e.context.bias&&(a=e.context.bias.setTexture(this).build(e,"f")),r=this.project?"texture2DProj":a?"tex2DBias":"tex2D",n=a?r+"( "+i+", "+o+", "+a+" )":r+"( "+i+", "+o+" )";let s={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(s),this.colorSpace=this.colorSpace??new dp(new pp("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(e,l),e.removeContext(),e.format(n,l,t)}},mp=class extends Zd{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,r,n,i,o){return e.format(this.value+(this.value%1?"":".0"),n,t)}},vp=class extends Yd{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,r,n,i){n=this.getType(e);let o=this.value,a=o.build(e,t)+"( ",s=[];if(o.inputs){for(let t=0;t<o.inputs.length;t++){let r=o.inputs[t],n=this.inputs[t]||this.inputs[r.name];s.push(n.build(e,e.getTypeByFormat(r.type)))}a+=s.join(", ")+" )"}return e.format(a,n,t)}},gp=class extends Yd{constructor(e,t,r=gp.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=r}getType(e){let t=this.a.getType(e),r=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(r)>e.getTypeLength(t)?r:t}generate(e,t){let r=this.getType(e);this.type=r;let n=this.a.build(e,r),i=this.b.build(e,r);return e.format("( "+n+" "+this.op+" "+i+" )",r,t)}},yp=gp;yp.ADD="+",yp.SUB="-",yp.MUL="*",yp.DIV="/";var bp=class extends Yd{constructor(e,t=bp.ABS,r,n){super(),this.nodeType="Math",this.a=e,"string"!=typeof t?this.b=t:n=t,"string"!=typeof r?this.c=r:n=r,this.method=n,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case bp.MIX:case bp.CLAMP:case bp.REFRACT:case bp.SMOOTHSTEP:case bp.FACEFORWARD:return 3;case bp.MIN:case bp.MAX:case bp.MOD:case bp.STEP:case bp.REFLECT:case bp.DISTANCE:case bp.DOT:case bp.CROSS:case bp.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),r=this.b?e.getTypeLength(this.b.getType(e)):0,n=this.c?e.getTypeLength(this.c.getType(e)):0;return t>r&&t>n?this.a.getType(e):r>n?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case bp.LENGTH:case bp.DISTANCE:case bp.DOT:return"f";case bp.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let r,n,i,o=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,s=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),u=this.getType(e);switch(this.type=u,this.method){case bp.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case bp.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case bp.CROSS:r=this.a.build(e,"v3"),n=this.b.build(e,"v3");break;case bp.STEP:r=this.a.build(e,1===o?"f":l),n=this.b.build(e,l);break;case bp.MIN:case bp.MAX:case bp.MOD:r=this.a.build(e,l),n=this.b.build(e,1===a?"f":l);break;case bp.REFRACT:r=this.a.build(e,l),n=this.b.build(e,l),i=this.c.build(e,"f");break;case bp.MIX:r=this.a.build(e,l),n=this.b.build(e,l),i=this.c.build(e,1===s?"f":l);break;default:r=this.a.build(e,l),this.b&&(n=this.b.build(e,l)),this.c&&(i=this.c.build(e,l))}let c=[];c.push(r),n&&c.push(n),i&&c.push(i);let h=this.getNumInputs(e);if(c.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${c.length}.`);return e.format(this.method+"( "+c.join(", ")+" )",u,t)}},xp=bp;xp.RAD="radians",xp.DEG="degrees",xp.EXP="exp",xp.EXP2="exp2",xp.LOG="log",xp.LOG2="log2",xp.SQRT="sqrt",xp.INV_SQRT="inversesqrt",xp.FLOOR="floor",xp.CEIL="ceil",xp.NORMALIZE="normalize",xp.FRACT="fract",xp.SATURATE="saturate",xp.SIN="sin",xp.COS="cos",xp.TAN="tan",xp.ASIN="asin",xp.ACOS="acos",xp.ARCTAN="atan",xp.ABS="abs",xp.SIGN="sign",xp.LENGTH="length",xp.NEGATE="negate",xp.INVERT="invert",xp.MIN="min",xp.MAX="max",xp.MOD="mod",xp.STEP="step",xp.REFLECT="reflect",xp.DISTANCE="distance",xp.DOT="dot",xp.CROSS="cross",xp.POW="pow",xp.MIX="mix",xp.CLAMP="clamp",xp.REFRACT="refract",xp.SMOOTHSTEP="smoothstep",xp.FACEFORWARD="faceforward";var wp=class extends Yd{constructor(e,t,r){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=r}bilinearCubeUV(e,t,r,n){let i=new vp(wp.Nodes.bilinearCubeUV,[t,r,n]);this.colorSpaceTL=this.colorSpaceTL??new dp(new pp("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(i.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new dp(new pp("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(i.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new dp(new pp("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(i.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new dp(new pp("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(i.build(e)+".br");let o={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(o),this.colorSpaceTLExp=new pp(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new pp(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new pp(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new pp(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new pp("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=i,a}generate(e,t){if(e.isShader("fragment")){let r=this.uv,n=this.bias||e.context.roughness,i=new vp(wp.Nodes.roughnessToMip,[n]),o=new xp(i,wp.Nodes.m0,wp.Nodes.cubeUV_maxMipLevel,xp.CLAMP),a=new xp(o,xp.FLOOR),s=new xp(o,xp.FRACT),l=this.bilinearCubeUV(e,this.value,r,a),u=this.bilinearCubeUV(e,this.value,r,new yp(a,new mp(1).setReadonly(!0),yp.ADD)),c=new xp(l,u,s,xp.MIX);return e.format(c.build(e),"v4",t)}return e.format("vec4( 0.0 )",this.getType(e),t)}},_p=wp;_p.Nodes=function(){let e=new up("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),t=new ap("float cubeUV_maxMipLevel 8.0",!0),r=new ap("float cubeUV_minMipLevel 4.0",!0),n=new ap("float cubeUV_maxTileSize 256.0",!0),i=new ap("float cubeUV_minTileSize 16.0",!0),o=new np("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");o.useKeywords=!1;let a=new np("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");a.useKeywords=!1;let s=new np("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[e,o,a,t,r,n,i]);s.useKeywords=!1;let l=new ap("float r0 1.0",!0),u=new ap("float v0 0.339",!0),c=new ap("float m0 -2.0",!0),h=new ap("float r1 0.8",!0),d=new ap("float v1 0.276",!0),p=new ap("float m1 -1.0",!0),f=new ap("float r4 0.4",!0),m=new ap("float v4 0.046",!0),v=new ap("float m4 2.0",!0),g=new ap("float r5 0.305",!0),y=new ap("float v5 0.016",!0),b=new ap("float m5 3.0",!0),x=new ap("float r6 0.21",!0),w=new ap("float v6 0.0038",!0),_=new ap("float m6 4.0",!0);return{bilinearCubeUV:s,roughnessToMip:new np("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[l,u,c,h,d,p,f,m,v,g,y,b,x,w,_]),m0:c,cubeUV_maxMipLevel:t}}();var Sp=class extends Yd{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??Sp.VIEW}getShared(){return this.scope===Sp.WORLD}build(e,t,r,n){let i=e.context[this.scope+"Normal"];return i?i.build(e,t,r,n):super.build(e,t,r)}generate(e,t,r,n,i){let o;switch(this.scope){case Sp.VIEW:o=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case Sp.LOCAL:e.isShader("vertex")?o="objectNormal":(e.requires.normal=!0,o="vObjectNormal");break;case Sp.WORLD:e.isShader("vertex")?o="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,o="vWNormal")}return e.format(o,this.getType(e),t)}},Op=Sp;Op.LOCAL="local",Op.WORLD="world",Op.VIEW="view",Op.NORMAL="normal",Xd.addKeyword("viewNormal",(function(){return new Op(Op.VIEW)})),Xd.addKeyword("localNormal",(function(){return new Op(Op.NORMAL)})),Xd.addKeyword("worldNormal",(function(){return new Op(Op.WORLD)}));var Tp=class extends Yd{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??Tp.LOCAL}getType(){return this.scope===Tp.PROJECTION?"v4":this.type}getShader(){switch(this.scope){case Tp.LOCAL:case Tp.WORLD:return!1}return!0}generate(e,t,r,n,i){let o;switch(this.scope){case Tp.LOCAL:e.isShader("vertex")?o="transformed":(e.requires.position=!0,o="vPosition");break;case Tp.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,o="vWPosition";break;case Tp.VIEW:o=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Tp.PROJECTION:o=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(o,this.getType(),t)}},Ep=Tp;Ep.LOCAL="local",Ep.WORLD="world",Ep.VIEW="view",Ep.PROJECTION="projection",Xd.addKeyword("position",(function(){return new Ep})),Xd.addKeyword("worldPosition",(function(){return new Ep(Ep.WORLD)})),Xd.addKeyword("viewPosition",(function(){return new Ep(Ep.VIEW)}));var Cp=class extends Yd{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??Cp.CUBE}getUnique(e){return!e.context.viewNormal}getType(){return this.scope===Cp.SPHERE?"v2":this.type}generate(e,t){let r=this.getUnique(e);if(e.isShader("fragment")){let n;switch(this.scope){case Cp.VECTOR:{let t=new Op(Op.VIEW),i=e.context.roughness,o=t.build(e,"v3"),a=new Ep(Ep.VIEW).build(e,"v3"),s=i?i.build(e,"f"):void 0,l=`reflect( -normalize( ${a} ), ${o} )`;s&&(l=`normalize( mix( ${l}, ${o}, ${s} * ${s} ) )`);let u=`inverseTransformDirection( ${l}, viewMatrix )`;r?(e.addNodeCode(`vec3 reflectVec = ${u};`),n="reflectVec"):n=u;break}case Cp.CUBE:{let t=new Cp(Cp.VECTOR).build(e,"v3"),i="vec3( -"+t+".x, "+t+".yz )";r?(e.addNodeCode(`vec3 reflectCubeVec = ${i};`),n="reflectCubeVec"):n=i;break}case Cp.SPHERE:{let t="normalize( ( viewMatrix * vec4( "+new Cp(Cp.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";r?(e.addNodeCode(`vec2 reflectSphereVec = ${t};`),n="reflectSphereVec"):n=t;break}}return e.format(n,this.getType(),t)}return e.format("vec3( 0.0 )",this.type,t)}},Ap=Cp;Ap.CUBE="cube",Ap.SPHERE="sphere",Ap.VECTOR="vector";var Mp=class extends Yd{constructor(e=new fp,t,r){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new _p(this.value,t??new Ap(Ap.VECTOR),r),this.irradianceNode=new _p(this.value,new Op(Op.WORLD),new mp(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):e.format("vec4( 0.0 )",this.getType(e),t)}},Dp=class extends Zd{constructor(e=new J,t,r){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new Ap,this.bias=r}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var r;if("samplerCube"===t)return this.getTexture(e,t);let n,i=this.getTexture(e,t),o=null==(r=this.uv)?void 0:r.build(e,"v3"),a=this.bias?this.bias.build(e,"f"):void 0;void 0===a&&e.context.bias&&(a=e.context.bias.setTexture(this).build(e,"f")),n=a?"texCubeBias( "+i+", "+o+", "+a+" )":"texCube( "+i+", "+o+" )";let s={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(s),this.colorSpace=this.colorSpace??new dp(new pp("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(e,l),e.removeContext(),e.format(n,l,t)}},Pp=["x","y","z","w"],kp=["float","vec2","vec3","vec4"],Lp={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},Up={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},Ip=class extends Zd{constructor(e=0,t,r,n){super("c"),this.nodeType="Color",this.value=e instanceof Jd?e:new Jd(e||0,t,r,n)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,r,n,i,o){r=e.getUUID(r??this.getUUID()),n=n??this.getType(e);let a=e.getNodeData(r),s=this.getReadonly()&&void 0!==this.generateReadonly;if(this.alpha){let t=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${t};`)}return s?this.generateReadonly(e,t,r,n,i,o):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(n,this,i,o,this.getLabel())),e.format(a.vertex.name,n,t)):(a.fragment||(a.fragment=e.createFragmentUniform(n,this,i,o,this.getLabel())),e.format(a.fragment.name,n,t))}generateReadonly(e,t,r,n,i,o){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",n,t)}},zp=class extends Zd{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,r,n,i,o){return e.format(this.value.toString(),n,t)}},Rp=class extends Zd{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,r,n){return e.format(this.value?"true":"false",n,t)}},Np=class extends Zd{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:"number"==typeof t?new Array(e).fill(t):new Array(e).fill(0)}},Bp=class extends Zd{},Fp=class extends Bp{constructor(e){super("v3"),this.image=e,this._value=new r}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},jp=class extends Bp{constructor(e,t){super("t"),this.image=e,this.wrap=t}get value(){return this.image.getTexture(this.wrap)}},Gp=class extends Zd{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new x}generateReadonly(e,t,r,n,i,o){return e.format("mat3("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},Vp=class extends Zd{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new t}generateReadonly(e,t,r,n,i,o){return e.format("mat4("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function Hp(e,t,r){e.setUvTransform(r[0],r[1],t[0],t[1],0,0,0)}var Wp=class extends Gp{constructor(e,t){super(new x),this.repeat=e,this.offset=t,Hp(this.value,e,t)}updateMatrix(){Hp(this.value,this.repeat,this.offset)}},qp=class extends Zd{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof _?new Array(e).fill(t):new Array(e).fill(new _(0))}},$p=class extends Yd{constructor(e,t,r,n){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=r,this.mode=n}generate(e,t){if(e.isShader("fragment")){let r=[];return r.push(this.a.build(e,"c")),r.push(this.b.build(e,"c")),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),e.format("spe_blend("+r.join(",")+")",this.getType(e),t)}return e.format("vec3( 0.0 )",this.getType(e),t)}},Xp=class extends Yd{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let r=e.include(Xp.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.color.build(e,"v3")),n.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}return e.format("vec3( 0.0 )",this.getType(e),t)}},Yp=Xp;Yp.Nodes={customColor:new np("vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color;\n\t\t\t}")};var Zp=class extends Yd{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let r=e.include(Zp.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.cnormal.build(e,"v3")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}return e.format("vec3( 0.0 )",this.getType(e),t)}},Kp=Zp;Kp.Nodes={customNormal:new np("vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")};var Qp=class extends Yd{constructor(e,t,r,n,i,o,a,s,l,u,c,h){super("v3"),this.nodeType="CustomTexture",this.firstTime=!0,this.texture=e,this.textureSize=t,this.crop=r,this.projection=n,this.axis=i,this.side=o,this.size=a,this.blending=s,this.mat=l,this.alpha=u,this.mode=c,this.isMask=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let r,n=`g${this.uuid.toString().replace(/-/g,"")}`;switch(this.projection.value){case 3:r=e.include(Qp.Nodes.cylindrical);break;case 2:r=e.include(Qp.Nodes.spherical);break;case 1:let t=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],i=new np(`\n\t\tvec3 ${n}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\n\t\t\t\tvec2 uvs = ( mat * vec3( (${n}_vCustomUv * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t${2===this.side.value?"":`lalpha *= step(0.0, ${1===this.side.value?"-1.0 * ":""}dot(vObjectNormal, mat * ${t}));`}\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}`);r=e.include(i);break;case 4:r=e.include(Qp.Nodes.triplanar);break;default:r=e.include(Qp.Nodes.uv)}if(1===this.projection.value&&this.firstTime){e.addVertexParsCode(`varying vec2 ${n}_vCustomUv;`),e.addFragmentParsCode(`varying vec2 ${n}_vCustomUv;`);let t=["zy","xz","xy"][this.axis.value];e.addVertexFinalCode(`${n}_vCustomUv = (1. + (transformed.${t})) / 2.;`)}e.addFragmentVariable(this.calpha,"float");let i=[];return i.push("normal"),i.push(this.texture.generate(e,"t")),i.push(this.textureSize.build(e,"v2")),i.push(this.crop.build(e,"f")),i.push(this.mat.build(e,"mat3")),i.push(this.size.build(e,"v2")),i.push(this.blending.build(e,"f")),i.push(this.isMask.build(e,"b")),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),i.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+i.join(",")+")",this.getType(e),t)}},Jp=Qp;Jp.Nodes={cylindrical:new np("\nvec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\t\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),spherical:new np("\nvec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),uv:new np("vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"),triplanar:new np("vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\tvec3 p = position;\n\t\t\t\tvec2 uv0 = (1.0 + p.xy) / 2.0;     \n\t\t\t\tvec2 uv1 = (1.0 + p.zy) / 2.0;\t\t\n\t\t\t\tvec2 uv2 = (1.0 + p.xz) / 2.0;\t\t\n\t\n\t\t\t\tuv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\n\t\t\t\t// Derivatives for LOD\n\t\t\t\tvec2 df0 = fwidth(uv0);\n\t\t\t\tvec2 df1 = fwidth(uv1);\n\t\t\t\tvec2 df2 = fwidth(uv2);\n\t\t\t\tif (df0.x > 0.5) df0.x = 0.0;\n\t\t\t\tif (df1.x > 0.5) df1.x = 0.0;\n\t\t\t\tif (df2.x > 0.5) df2.x = 0.0;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                \tvec4 tmp = \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#else\n                \tvec4 tmp = \n\t\t\t\t\t\ttextureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttextureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttextureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\n\t\t\t\t// Apply cropping across all 3 planes\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;//n * 0.5 + 0.5;\n\t\t\t}\t\t\t\n\t\t\t")};var ef=class extends Yd{constructor(e,t,r,n,i,o,a,s,l,u,c,h){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=r,this.far=n,this.isVector=i,this.isWorldSpace=o,this.origin=a,this.direction=s,this.colors=l,this.steps=u,this.isMask=h,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new np(`vec3 ${r}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${r}_MAX_COLORS], float steps[${r}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ${r}_IS_VECTOR\n                   #ifdef ${r}_LINEAR\n                       #ifdef ${r}_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ${r}_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ${r}_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ${r}_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ${r}_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a * mask;\n               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t   \n               return color.rgb;\n\t\t\t}`,[ef.Nodes.vectorLinearWorldSpaceDepth,ef.Nodes.vectorLinearObjectSpaceDepth,ef.Nodes.vectorSphericalObjectSpaceDepth,ef.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${r}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${r}_SMOOTH`),this.isVector.value>.5&&e.define(`${r}_IS_VECTOR`),0===this.gradientType.value&&e.define(`${r}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${r}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let i=e.include(n),o=[];return o.push(this.near.build(e,"f")),o.push(this.far.build(e,"f")),o.push(this.origin.build(e,"v3")),o.push(this.direction.build(e,"v3")),o.push(this.colors.build(e,"v4[]")),o.push(this.steps.build(e,"f[]")),o.push(this.isMask.build(e,"b")),o.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),o.push(this.alpha.build(e,"f")),o.push(this.calpha),e.format(i+"("+o.join(",")+")",this.getType(e),t)}return e.format("vec3( 0.0 )",this.getType(e),t)}},tf=ef;tf.Nodes={vectorLinearWorldSpaceDepth:new np("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorLinearObjectSpaceDepth:new np("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalWorldSpaceDepth:new np("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalObjectSpaceDepth:new np("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }")};var rf=class extends Yd{constructor(e,t,r,n,i,o,a,s){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=r,this.intensity=n,this.factor=i,this.isMask=s,this.alpha=o,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let r=new np("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\t\tfloat lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn color;\n\t\t\t\t}"),n=e.include(r),i=[];return i.push(this.color.build(e,"c")),i.push(this.bias.build(e,"f")),i.push(this.scale.build(e,"f")),i.push(this.intensity.build(e,"f")),i.push(this.factor.build(e,"f")),i.push(this.isMask.build(e,"b")),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return e.format("vec3( 0.0 )",this.getType(e),t)}},nf=class extends Yd{constructor(e,t,r,n,i,o,a,s,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=r,this.steps=n,this.offset=i,this.morph=o,this.angle=a,this.isMask=l,this.alpha=s,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(nf.Nodes.gradient),n=[];return n.push(this.gradientType.build(e,"i")),n.push(this.smooth.build(e,"b")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.offset.build(e,"v2")),n.push(this.morph.build(e,"v2")),n.push(this.angle.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}return e.format("vec3( 0.0 )",this.getType(e),t)}},of=nf;of.Nodes={gradient:new np("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\n\t\t\t\treturn color.xyz;\n\t\t\t}")};var af=class extends Yd{constructor(e,t,r,n){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=n,this.alpha=t,this.mode=r,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let r=e.include(af.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let n=[];return n.push(this.texture.generate(e,"t")),n.push("normal"),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}return e.format("vec3( 0.0 )",this.getType(e),t)}},sf=af;sf.Nodes={matcap:new np("vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tvec3 viewDir = normalize( vViewPosition );\n\t\t\t\t\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\t\t\t\t\tvec3 y = cross( viewDir, x );\n\t\t\t\t\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\t\t\t\t\tvec4 matcapColor = texture2D( matcapTex, uv );\n\n\t\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\t\n\t\t\t\t\treturn matcapColor.rgb;\n            \t}")};var lf,uf=((lf=uf||{}).SIMPLEX="simplex3d",lf.SIMPLEX_FRACTAL="simplex3dFractal",lf.ASHIMA="simplexAshima",lf.FBM="fbm",lf.PERLIN="perlin",lf.VORONOI="voronoi",lf),cf=function(){let e=new np("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),t=new np("float simplex3d(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[e]);t.keywords.F3=new ap("float F3 0.3333333"),t.keywords.G3=new ap("float G3 0.1666667");let r=new np("float simplex3dFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplex3d(m * rot1)\n\t\t\t\t + 0.2666667 * simplex3d(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplex3d(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplex3d(8.0 * m);\n\t\t}",[t]),n=new np("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),i=new np("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),o=new np("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}",[n,i]),a=new np("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),s=new np("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[a]),l=new np("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}",[s]),u=new np("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}",[l]);u.keywords.NUM_OCTAVES=new ap("int NUM_OCTAVES 5");let c=new np("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),h=new np("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}",[n,i,c]),d=new np("float hashwithoutsine13(vec3 p3)\n\t\t{\n\t\t\tp3  = fract(p3 * .1031);\n\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t}"),p=new np("vec3 hashwithoutsine33(vec3 p3)\n\t\t{\n\t\t\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\n\t\t\tp3 += dot(p3, p3.yxz+33.33);\n\t\t\treturn fract((p3.xxy + p3.yxx)*p3.zyx);\n\t\t}"),f=new np("float metric(in vec3 p)\n\t\t{\n\t\t\t// L2 \n\t\t\treturn length(p);\n\n\t\t\t// Chebyshev \n\t\t\t// vec3 a = abs(p);\n\t\t\t// return max(a.x, max(a.y, a.z));\n\t\t}"),m=new np("float smin( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(b, a, h) - correction;\n\t\t}"),v=new np("float smax( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(a, b, h) + correction;\n\t\t}"),g=new np("float remap(float value, float input_min, float input_max, float output_min, float output_max) {\n\t\t\t// Compute width of each interval\n\t\t\tfloat input_width = input_max - input_min;\n\t\t\tfloat output_width = output_max - output_min;\n\t\t\n\t\t\t// Convert input range into a 0-1 range \n\t\t\tfloat scaled = (value - input_min) / input_width;\n\t\t\n\t\t\t// Convert the 0-1 range into a value in output range\n\t\t\treturn output_min + (scaled * output_width);\n\t\t}");return{simplex:t,simplexFractal:r,simplexAshima:o,fbm:u,perlin:h,voronoi:new np('float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) \n\t\t{\n\t\t\t// Integer and fractional parts of this point\'s coordinates\n\t\t\tivec3 p = ivec3(floor(x));\n\t\t\tvec3 f = fract(x);\n\n\t\t\t// Different variables that we will use to construct noise:\n\t\t\t//\n\t\t\t// f1: distance to the closest feature point\n\t\t\t// f2: distance to the second closest feature point\n\t\t\t// e: distance to the closest edge (cell boundary)\n\t\t\t//\n\t\t\t// We also compute "smooth" versions of all of the above quantites, essentially\n\t\t\t// replacing "hard" minimums with "smooth" minimums (described by IQ)\n\t\t\tfloat f1_smooth = 8.0;\n\t\t\tfloat f1 = 8.0;\n\t\t\tfloat f2_smooth = 8.0;\n\t\t\tfloat f2 = 8.0;\n\t\t\tfloat e_smooth = 8.0;\n\t\t\tfloat e = 8.0;\n\n\t\t\t// Variables stored from closest cell\n\t\t\tivec3 mb;\n\t\t\tvec3 mr; \n\n\t\t\tint steps = quality;\n\t\t\t\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d = length(r);\n\t\t\t\t\n\t\t\t\tf1_smooth = smin(d, f1_smooth, smoothness);\n\n\t\t\t\t// Store un-smoothed distances too \n\t\t\t\tif (d < f1) \n\t\t\t\t{\n\t\t\t\t\tf2 = f1;\n\t\t\t\t\tf1 = d;\n\n\t\t\t\t\tmb = ivec3(x, y, z);\n\t\t\t\t\tmr = r;\n\t\t\t\t} \n\t\t\t\telse if (d < f2) \n\t\t\t\t{\n\t\t\t\t\tf2 = d;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t\n\t\t\tfloat id = hashwithoutsine13(vec3(p + mb) + seed);\n\n\t\t\t// Second pass for edge distance  \n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\t// Start search at the cell that contains the closest point to "x" (found in 1st pass)\n\t\t\t\tivec3 b = mb + ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d1 = dot(0.5 * (mr + r), (r - mr)); \t\t\t\t// IQ normalizes "r - mr" but that breaks things for the smooth version?\n\t\t\t\tfloat d2 = dot(0.5 * (mr + r), normalize(r - mr));\n\n\t\t\t\te_smooth = smin(d1, e_smooth, smoothness);\n\n\t\t\t\te = min(e, d2);\n\n\t\t\t\t// Also compute a smooth version of F2 in this pass\n\t\t\t\t{\n\t\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\t\tif (b != mb) \n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\t\t\tfloat d = length(r);\n\n\t\t\t\t\t\tf2_smooth = smin(d, f2_smooth, smoothness);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Different visualization modes \n\t\t\tif (style == 0) \n\t\t\t{\n\t\t\t\treturn f1_smooth;\n\t\t\t}\n\t\t\tif (style == 1) \n\t\t\t{\n\t\t\t\treturn f2_smooth;\n\t\t\t}\n\t\t\tif (style == 2) \n\t\t\t{\n\t\t\t\treturn f2_smooth - f1_smooth;\n\t\t\t\t\n\t\t\t\t// "Pebbles" also cool\n\t\t\t\t//return step(0.2, f2_smooth - f1_smooth);\n\t\t\t}\n\t\t\tif (style == 3) \n\t\t\t{\n\t\t\t\t// This one is really good for rock / stone effects\n\t\t\t\tfloat a = f1; \n\t\t\t\tfloat b = f2;\n\t\t\t\tfloat k = 3.0;\n\t\t\t\tfloat h = max(k - abs(a - b), 0.0) / k;\n\t\t\t\tfloat final = min(a, b) - h * h * k * (1.0 / 4.0);\n\t\t\t\treturn final;\n\t\t\t}\n\t\t\tif (style == 4) \n\t\t\t{\n\t\t\t\t// Some random adjustments to make this style stand out more \n\t\t\t\treturn exp(5.0 * e_smooth);\n\t\t\t}\n\t\t\tif (style == 5) \n\t\t\t{\n\t\t\t\treturn pow(f1_smooth, 3.0);\n\t\t\t}\n\t\t\tif (style == 6) \n\t\t\t{\t\t\t\t\n\t\t\t\tconst float eps = 0.0125;\n\n\t\t\t\t// Thicker lines as the user increases the smoothness slider\n\t\t\t\tfloat thickness = smoothness * 0.25 + eps;\n\n\t\t\t\t// Blurrier lines as the user increases the smoothness slider\n\t\t\t\tfloat blur = pow(smoothness, 3.0) * 0.25 + eps;\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\tthickness - thickness * blur, \n\t\t\t\t\tthickness + thickness * blur, \n\t\t\t\t\te\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (style == 7) \n\t\t\t{\n\t\t\t\treturn hashwithoutsine13(vec3(p + mb) + seed);\n\t\t\t}\n\t\t}\n\t',[d,p,f,m,v,g])}}(),hf=class extends Yd{constructor(e,t,r,n,i,o,a,s,l,u,c,h,d,p,f,m,v,g,y){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=r,this.fA=n,this.fB=i,this.distortion=o,this.colorA=a,this.colorB=s,this.colorC=l,this.colorD=u,this.noiseType=h,this.voronoiStyle=p,this.highCut=f,this.lowCut=m,this.smoothness=v,this.seed=g,this.quality=y,this.isMask=d,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,r,n,i){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let o=Object.values(uf)[this.noiseType.value],a=new np(`vec3 ${o}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) \n\t\t\t{\n                // Prevent scale of zero \n\t\t\t\tscale = max(abs(scale), 0.001);\n\n\t\t\t\tvec3 st = position / size;\n\t\t\t\tst /= scale;\n\n\t\t\t\t${"voronoi"==o?`\n\t\tfloat v = ${o}(st + move, voronoiStyle, smoothness, seed, quality);\n\n\t\t// Apply clipping to colors\n\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t// Note that the voronoi mode only uses colors "A" and "C" from the UI \n\t\tvec4 color = mix(colorA, colorC, v); \n\t\t`:`\n\t\tvec3 q = vec3(${o}(st),\n\t\t\t\t\t   ${o}(st + vec3(1.0)),\n\t\t\t\t\t   ${o}(st + vec3(1.0)));\n\t\tvec3 r = vec3(${o}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t  ${o}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t  ${o}(st * q));\n\t\tfloat f = ${o}(st + r);\n\t\tvec4 color;\n\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\t\t`}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}`,[cf.simplex,cf.simplexFractal,cf.simplexAshima,cf.fbm,cf.perlin,cf.voronoi]),s=e.include(a),l=[];return l.push(this.scale.build(e,"f")),l.push(this.size.build(e,"v3")),l.push(this.move.build(e,"f")),l.push(this.fA.build(e,"v2")),l.push(this.fB.build(e,"v2")),l.push(this.distortion.build(e,"v2")),l.push(this.colorA.build(e,"v4")),l.push(this.colorB.build(e,"v4")),l.push(this.colorC.build(e,"v4")),l.push(this.colorD.build(e,"v4")),l.push(this.voronoiStyle.build(e,"i")),l.push(this.highCut.build(e,"f")),l.push(this.lowCut.build(e,"f")),l.push(this.smoothness.build(e,"f")),l.push(this.seed.build(e,"f")),l.push(this.quality.build(e,"i")),l.push(this.isMask.build(e,"b")),l.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),l.push(this.alpha.build(e,"f")),l.push(this.calpha),e.format(s+"("+l.join(",")+")",this.getType(e),t)}};hf.numOctaves=5;var df=class extends Yd{constructor(e,t,r,n,i,o,a,s,l,u,c,h,d,p,f,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=r,this.contourWidth=n,this.contourThreshold=i,this.outlineThreshold=o,this.contourFrequency=a,this.outlineSmoothing=s,this.contourDirection=l,this.positionalLines=u,this.compensation=c,this.resolution=h,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let r=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${r}_offset`),this.firstTime){let t=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),i=this.compensation.build(e,"b"),o=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(t,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(i,"uniform bool"),e.addVertexParsVariable(o,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`\n                vID = randomColor.r;\n                vec2 ${r}_offset = vec2(0.0);\n                if (${i}) {\n                    vec4 ${r}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the\n                    // normals face the camera directly. So we hackily fix this by offsetting the normal\n                    // by a tiny amount.\n                    vec3 ${r}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;\n                    ${r}_offset = normalize(${r}_clipNormal.xy) / ${n} * (${t} / 2.0) * ${r}_clipPosition.w * 2.0 * ${o};\n                    ${r}_clipPosition.xy += ${r}_offset;\n                    // TODO(MAX): To handle multiple outline layers, we only want to extrude\n                    // if this offset is the biggest of all the potential offsets\n                    gl_Position = ${r}_clipPosition;\n                }\n            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(df.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+n.join(",")+")",this.getType(e),t)}return""}},pf=df;pf.Nodes=function(){let e=new np("\nfloat sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)\n{\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    vec2 texelSize = (vec2(1.0) / resolution);\n    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;\n\n    vec2 uvSamples[9];\n    vec4 normalSamples[9];\n\n\tuvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);\n\tuvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);\n\tuvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);\n\tuvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);\n\tuvSamples[4] = uv;\n\tuvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);\n\tuvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);\n\tuvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);\n\tuvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);\n\n\n    normalSamples[0] = texture2D(t, uvSamples[0]);\n    normalSamples[1] = texture2D(t, uvSamples[1]);\n    normalSamples[2] = texture2D(t, uvSamples[2]);\n    normalSamples[3] = texture2D(t, uvSamples[3]);\n    normalSamples[4] = texture2D(t, uvSamples[4]);\n    normalSamples[5] = texture2D(t, uvSamples[5]);\n    normalSamples[6] = texture2D(t, uvSamples[6]);\n    normalSamples[7] = texture2D(t, uvSamples[7]);\n    normalSamples[8] = texture2D(t, uvSamples[8]);\n\n    float depthBias = 0.0001;\n    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!\n    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n\n    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);\n  \tvec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);\n\n    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));\n    return edgeNormal;\n}\n");return{outline:new np("vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {\n                vec3 result = outlineColor;\n                float resultAlpha = 0.0;\n\n                vec3 N = normalize(vWNormal);\n                vec2 nuv = (gl_FragCoord.xy / resolution);\n                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);\n                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);\n\n                //resultAlpha = 1.0;\n                //result = vec3(sobelSample);\n\n                float t = 1.0 - contourThreshold;\n                if(positionalLines) {\n                    vec3 NDir = position * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float f  = fract(NT * contourFrequency * 0.01);\n                    float df = fwidth(NT * contourFrequency);\n\n                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);\n                    if (g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0;\n                    }\n                 }\n                 else {\n                    vec3 NDir = N * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float df = fwidth(NT * contourThreshold);\n                    float f = sin(NT * 1.0 * contourFrequency);\n                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);\n\n                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0 - g;\n                    }\n                 }\n\n                 float lalpha = alpha * resultAlpha * mask;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\t \n                 return result;\n             }",[e])}}();var ff=class extends Yd{constructor(e,t,r,n,i,o,a,s,l,u,c,h,d,p,f,m,v,g){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=r,this.blending=n,this.offset=i,this.colorA=o,this.colorB=a,this.frequency=s,this.size=l,this.variation=u,this.smoothness=c,this.zigzag=h,this.rotation=d,this.vertical=p,this.horizontal=f,this.sides=m,this.isMask=g,this.alpha=v,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let r;switch(e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float"),this.style.value){case 0:default:r="circle";break;case 1:r="ring";break;case 2:r="polygon";break;case 3:r="xcross";break;case 4:r="diamond";break;case 5:r="checkerboard";break;case 6:r="line";break;case 7:r="wave"}let n=`g${this.uuid.toString().replace(/-/g,"")}`,i=new np("float hashwithoutsine12(vec2 p)\n\t\t\t\t{\n\t\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * .1031);\n\t\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t\t}"),o=new np("vec2 rotate_uv(in vec2 uv, float a, bool repeat) \n\t\t\t\t{\n\t\t\t\t\tconst float mid = 0.5;\n\t\t\t\t\tfloat radians = a * (PI / 180.0);\n\t\t\t\t\tvec2 rotated = vec2(\n\t\t\t\t\t\tcos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,\n\t\t\t\t\t\tcos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid\n\t\t\t\t\t);\n\t\t\t\t\treturn repeat ? fract(rotated): rotated;\n\t\t\t\t}"),a="";if(4===this.projection.value){a=`\n\t\t\t\tvec3 p = position;\n\t\t\t\tfloat factor = 0.0125;\n\t\t\t\tvec2 uv0 = fract(p.xy * factor);\n\t\t\t\tvec2 uv1 = fract(p.zy * factor);\n\t\t\t\tvec2 uv2 = fract(p.xz * factor);\n\t\t\t\t\n\t\t\t\tuv0 = rotate_uv(uv0 + offset, rotation, true);\n\t\t\t\tuv1 = rotate_uv(uv1 + offset, rotation, true);\n\t\t\t\tuv2 = rotate_uv(uv2 + offset, rotation, true);\n\t\n\t\t\t\tfloat d0 = ${2===this.style.value?`${r}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d1 = ${2===this.style.value?`${r}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d2 = ${2===this.style.value?`${r}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\t\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\t\t\t\td0 *= weights.z;\n\t\t\t\td1 *= weights.x;\n\t\t\t\td2 *= weights.y;\n\t\t\t\tfloat draw = d0 + d1 + d2;\n\t\n\t\t\t\tvec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;\n\t\t\t\t`}else{let e=2===this.style.value?`${r}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,t="";0===this.axis.value?t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.z);\n\t\t\t\t\tfloat phi = acos(p.x / radius);":1===this.axis.value?t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.x, p.z);\n\t\t\t\t\tfloat phi = acos(p.y / radius);":(this.axis.value,t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.x);\n\t\t\t\t\tfloat phi = acos(p.z / radius);");let n="";switch(this.projection.value){case 0:n="custom_uv = vUv.st;";break;case 1:break;case 2:n=`\n\t\t\t\t\t\t\tvec3 p = position;\n\t\t\t\t\t\t\t${t}\n\t\t\t\t\t\t\tcustom_uv = vec2(theta, phi);\n\t\t\t\t\t\t\tcustom_uv /= PI;\n\t\t\t\t\t\t\t`}a=`\n\t\t\t\tvec2 custom_uv;\n\t\t\t\t${n}\n\t\n\t\t\t\tcustom_uv += offset;\n\t\t\t\tcustom_uv = fract(custom_uv);\n\t\t\t\tcustom_uv = rotate_uv(custom_uv, rotation, true);\n\t\n\t\t\t\tfloat draw = ${e};\n\t\t\t\t`}let s=new np(`vec3 ${n}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\t\tconst float TWO_PI = PI * 2.0;\n\t\t\t\t\tfloat smoothness_remapped = pow(smoothness, 5.0);\t\n\n\t\t\t\t\t${a}\n\n\t\t\t\t\t// Construct final output color\n\t\t\t\t\tvec4 color = mix(colorA, colorB, draw);\n\t\t\t\t\tcolor.a = clamp(color.a, 0.0, 1.0);\n\n\t\t\t\t\t// Apply cuts\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(vertical.x, custom_uv.y) * \n\t\t\t\t\t\tstep(custom_uv.y, vertical.y);\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(horizontal.x, abs(custom_uv.x)) * \n\t\t\t\t\t\tstep(abs(custom_uv.x), horizontal.y);\n\n\t\t\t\t\t// Accumulate alpha \n\t\t\t\t\tfloat lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t\t}`,[o,i,ff.DrawFunctions.circle,ff.DrawFunctions.ring,ff.DrawFunctions.polygon,ff.DrawFunctions.cross,ff.DrawFunctions.diamond,ff.DrawFunctions.checkerboard,ff.DrawFunctions.line,ff.DrawFunctions.wave]),l=e.include(s),u=[];return u.push("normal"),u.push(this.blending.build(e,"f")),u.push(this.style.build(e,"i")),u.push(this.offset.build(e,"v2")),u.push(this.colorA.build(e,"v4")),u.push(this.colorB.build(e,"v4")),u.push(this.frequency.build(e,"v2")),u.push(this.size.build(e,"f")),u.push(this.variation.build(e,"f")),u.push(this.smoothness.build(e,"f")),u.push(this.zigzag.build(e,"f")),u.push(this.rotation.build(e,"f")),u.push(this.vertical.build(e,"v2")),u.push(this.horizontal.build(e,"v2")),u.push(this.sides.build(e,"i")),u.push(this.isMask.build(e,"b")),u.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),u.push(this.alpha.build(e,"f")),u.push(this.calpha),e.format(l+"("+u.join(",")+")",this.getType(e),t)}return e.format("vec3(0.0)",this.getType(e),t)}},mf=ff;mf.DrawFunctions=function(){let e=new np("float hashwithoutsine12(vec2 p) {\n\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * 0.1031);\n\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t}"),t=new np("vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {\n                // Create tiles in UV-space\n                uv *= frequency;\n\n                // Integer coords\n                vec2 i = floor(uv);\n\n                // Offset every other row based on zigzag param, then compute fractional coords\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = fract(uv);\n\n\t\t\t\t// Rotate the tile itself:\n\t\t\t\t// const float mid = 0.5;\n\t\t\t\t// f = vec2(\n\t\t\t\t// \tcos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,\n\t\t\t\t// \tcos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid\n\t\t\t\t// );\n\t\t\t\t// f = fract(f);\n\n                f = f * 2.0 - 1.0;\n\n\t\t\t\t// Recompute integer coords after shifting - then, random value per tile \n\t\t\t\ti = floor(uv);\n\t\t\t\tfloat rand = (hashwithoutsine12(i) * 5.0 + 1.0);\n\t\t\t\tfloat jitter = mix(1.0, rand, variation);\n\t\t\t\tf *= jitter;\n\n                return f;\n            }",[e]);return{tileAndCenter:t,circle:new np("float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(\n                    -smoothness, \n                     smoothness, \n                     length(f) - size\n                );\n            }",[t]),ring:new np("float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\n\t\t\t\tfloat d = length(f);\n                const float inner_width = 0.5;\n\n                float outer = smoothstep(-smoothness, smoothness, d - size);\n                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);\n\t\t\t\treturn outer + (1.0 - inner);   \n            }",[t]),polygon:new np("float sdf_ngon(in vec2 p, in float r, in int n) {\n                float an = (PI * 2.0) / float(n);\n                float he = r * tan(0.5 * an);\n                \n                // Rotate to first sector\n                p = -p.yx; \n                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);\n                vec2  cs = vec2(cos(bn), sin(bn));\n                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;\n            \n                // Side of polygon\n                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);\n            }\n            \n            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));\n            }",[t]),cross:new np("float sdf_cross(in vec2 p, in vec2 b, float r ) {\n                p = abs(p); \n\t\t\t\tp = (p.y > p.x) ? p.yx : p.xy;\n                vec2  q = p - b;\n                float k = max(q.y, q.x);\n                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);\n                return sign(k) * length(max(w, 0.0)) + r;\n            }\n            \n            // Avoid namespace conflicts \n            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));\n            }",[t]),diamond:new np("float ndot(vec2 a, vec2 b) { \n                return a.x*b.x - a.y*b.y; \n            }\n            \n            float sdf_diamond(in vec2 p, in vec2 b) {\n                p = abs(p);\n                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);\n                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));\n                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);\n            }\n\n            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\t            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));\n            }",[t]),checkerboard:new np("float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                uv *= frequency;\n                vec2 i = floor(uv);\n\n                float offset = mod(i.y, 2.0);\n\n                uv.x += offset + zigzag * offset;\n                float x = floor(uv.x);\n                \n                return mod(x, 2.0);\n            }"),line:new np("float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);\n\t\t\t\t\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat row = floor(uv * frequency).y;\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(row));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\ts - smoothness, \n\t\t\t\t\ts + smoothness, \n\t\t\t\t\tabs(f.y)\n\t\t\t\t);\n            }",[t]),wave:new np("// Uses bisection \n            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {\n                // Convert all data to a primitive cosine wave\n                p = c * (p - vec2(d, a));\n                \n                const float TWO_PI = PI * 2.0;\n\n                // Reduce to principal half cycle\n                p.x = mod(p.x, TWO_PI); \n                if (p.x > PI) {\n                    p.x = TWO_PI - p.x;\n                }\n            \n                // Find zero of derivative (minimize distance)\n                float xa = 0.0;\n                float xb = TWO_PI;\n\n                // 24 bit precision\n                for (int i = 0; i < 24; i++) {\n                    float x = 0.5 * (xa + xb);\n                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));\n                    if (y < 0.0) xa = x; \n                    else xb = x;\n                }\n                float x = 0.5 * (xa + xb);\n                \n                // Compute distance    \n                vec2 q = vec2(x, b * c * cos(x));\n                return length(p - q) / c;\n            }\n\n            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                float repeat = frequency.x;\n                uv *= repeat;\n                vec2 i = floor(uv);\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = vec2(uv.x, fract(uv.y));\n\n                // Generalized cosine: y(x) = a + b * cos(cx + d)\n                const float amplitude = 0.125;\n                float wave_frequency = frequency.y * 0.1;\n                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);\n\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(i.y));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);\n            }")}}();var vf=class extends Yd{constructor(e,t,r,n,i,o,a,s){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=r,this.noiseStrength=n,this.noiseScale=i,this.offset=o,this.isMask=s,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(vf.Nodes.rainbow),n=[];return n.push(this.filmThickness.build(e,"f")),n.push(this.movement.build(e,"f")),n.push(this.wavelengths.build(e,"v3")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.offset.build(e,"v3")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}return e.format("vec3( 0.0 )",this.getType(e),t)}},gf=vf;gf.Nodes=function(){let e=new np("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n                 vec3 st = position / noiseScale;\n\t\t\t\t vec3 q = vec3(simplex3d(st),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)));\n\n\t\t\t\t vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st * q));\n\n                 float noise = simplex3d(st + r);\n\n                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);\n             }",[cf.simplex]);return{rainbow:new np("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n\t\t\t\tfloat rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n\n\t\t\t\tfloat lalpha = alpha * rainbowContribution * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn res;\n             }",[e])}}();var yf=class extends Yd{constructor(e,t,r,n,i,o,a,s,l,u){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=r,this.source=n,this.isWorldSpace=i,this.noiseStrength=o,this.noiseScale=a,this.shadowColor=s,this.offset=l,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let r=e.include(yf.Nodes.toon),n=[];return n.push(this.positioning.build(e,"i")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.source.build(e,"v3")),n.push(this.isWorldSpace.build(e,"b")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.shadowColor.build(e,"v4")),n.push(this.offset.build(e,"v3")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}return e.format("vec3( 0.0 )",this.getType(e),t)}},bf=yf;bf.Nodes=function(){let e=new np("float rand(float n) {\n\t\t\t\treturn fract(sin(n) * 43758.5453123);\n\t\t\t}"),t=new np("float hash1(float p) { \n\t\t\t\tp = fract(p * 0.011); \n\t\t\t\tp *= p + 7.5; \n\t\t\t\tp *= p + p; \n\t\t\t\treturn fract(p); \n\t\t\t}"),r=new np("float valueNoise(vec3 x) {\n\t\t\t\tconst vec3 step = vec3(110, 241, 171);\n\t\t\t\n\t\t\t\tvec3 i = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\t\t\t \n\t\t\t\t// For performance, compute the base input to a 1D hash from the integer part of the argument and the \n\t\t\t\t// incremental change to the 1D based on the 3D -> 1D wrapping\n\t\t\t\tfloat n = dot(i, step);\n\t\t\t\n\t\t\t\tvec3 u = f * f * (3.0 - 2.0 * f);\n\t\t\t\treturn mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n\t\t\t\t\t\t   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n\t\t\t}",[t]),n=new np("vec3 hash3(vec3 x) {\n\t\t\t\tx = vec3(dot(x,vec3(127.1, 311.7, 74.7)),\n\t\t\t\t\t\t dot(x,vec3(269.5, 183.3, 246.1)),\n\t\t\t\t\t\t dot(x,vec3(113.5, 271.9, 124.6)));\n\t\t\t\n\t\t\t\treturn fract(sin(x)*43758.5453123);\n\t\t\t}"),i=new np('vec3 voronoiNoise(in vec3 x)\n\t\t\t{\n\t\t\t\tvec3 p = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\n\t\t\t\tfloat id = 0.0;\n\t\t\t\tvec2 res = vec2(100.0);\n\n\t\t\t\tfor(int k=-1; k<=1; k++)\n\t\t\t\tfor(int j=-1; j<=1; j++)\n\t\t\t\tfor(int i=-1; i<=1; i++)\n\t\t\t\t{\n\t\t\t\t\tvec3 b = vec3(float(i), float(j), float(k));\n\n\t\t\t\t\t// Comment out the "+ hash(p + b);" part below to get "square" cells\n\t\t\t\t\tvec3 r = vec3(b) - f + hash3(p + b);\n\t\t\t\t\tfloat d = dot(r, r);\n\n\t\t\t\t\tif (d < res.x)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = dot(p + b, vec3(1.0, 57.0, 113.0));\n\t\t\t\t\t\tres = vec2(d, res.x);\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse if (d < res.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tres.y = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn vec3(sqrt(res), abs(id));\n\t\t\t}\n\t\t\t',[n]);return{toon:new np('vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tfloat shadow = 1.0;\n\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\t// Can\'t do this mode if lighting is "none"\n\t\t\t\t\t#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))\n\n\t\t\t\t\t\t// Algorithm from Chapter 10 of Graphics Shaders\n\t\t\t\t\t\tconst vec3 weights = vec3(0.2125, 0.7154, 0.0721);\n\t\t\t\t\t\tvec3 lpos;\n\t\t\t\t\t\tvec3 l;\n\t\t\t\t\t\tfloat dproduct;\n\n\t\t\t\t\t\t#if (NUM_POINT_LIGHTS > 0)\n\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tPointLightShadow pointLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Light positions are in view-space for some reason?\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: we want to use "intensity" but it isn\'t available in the shader code\n\t\t\t\t\t\t\t\t//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);\n\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tpointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getPointShadow( \n\t\t\t\t\t\t\t\t\t\t\tpointShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowRadius,\n\t\t\t\t\t\t\t\t\t\t\tvPointShadowCoord[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraNear, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraFar);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_DIR_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tDirectionalLightShadow directionalLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Use the direction vector for directional lights instead\n\t\t\t\t\t\t\t\tl = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;\n\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tdirectionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow( \n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tdirectionalShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tSpotLightShadow spotLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tspotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow(\n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tspotShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvSpotLightCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tt = clamp(t, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\t#endif\n\n\t\t\t\t} else if (positioning == 1) {\n\t\t\t\t\t\n\t\t\t\t\tvec3 origin = mix(position, worldPosition, float(isWorldSpace));\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvec3 origin = worldPosition;\n\t\t\t\t\tvec3 source = cameraPosition - offset;\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (noiseStrength > 0.0) {\n\t\t\t\t\t// Distort with noise\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\t\n\t\t\t\t\t// Voronoi "smooth" noise\n\t\t\t\t\tfloat noise = 1.0 - voronoiNoise(st).x;\n\n\t\t\t\t\t// Voronoi cellular noise\n\t\t\t\t\t//float noise = 1.0 - rand(voronoiNoise(st).z);\n\n\t\t\t\t\t// Position warp noise\n\t\t\t\t\t// vec3 offset = vec3(\n\t\t\t\t\t// \tsimplex3d(st),\n\t\t\t\t\t// \tsimplex3d(st + vec3(111.1, 143.89, 217.19)),\n\t\t\t\t\t// \tsimplex3d(st + vec3(171.1, 247.89, 117.23))\n\t\t\t\t\t// );\n\t\t\t\t\t// st += offset;\n\t\t\t\t\t// float noise = valueNoise(st);\n\n\t\t\t\t\tt += noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tt = clamp(t, 0.0, 1.0);\n\n\t\t\t\t// Compute ramp color\n\t\t\t\tfloat p;\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tfor (int i = 1; i < COLORS_MAX; i++) {\n\t\t\t\t\tp = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);\n\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t}\n\n\t\t\t\t// Incorporate custom shadow color\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\tvec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);\n\t\t\t\t\tcolor.rgb = mix(blendedShadow, color.rgb, shadow);\n\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// Accumulate alpha as usual\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\n            }',[cf.simplex,e,r,i])}}();var xf={textureBicubic:new np("float w0( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n        }\n    \n        float w1( float a ) {\n            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n        }\n    \n        float w2( float a ){\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n        }\n    \n        float w3( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * a * a );\n        }\n    \n        // g0 and g1 are the two amplitude functions\n        float g0( float a ) {\n            return w0( a ) + w1( a );\n        }\n    \n        float g1( float a ) {\n            return w2( a ) + w3( a );\n        }\n    \n        // h0 and h1 are the two offset functions\n        float h0( float a ) {\n            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n        }\n    \n        float h1( float a ) {\n            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n        }\n    \n        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n            uv = uv * texelSize.zw + 0.5;\n    \n            vec2 iuv = floor( uv );\n            vec2 fuv = fract( uv );\n    \n            float g0x = g0( fuv.x );\n            float g1x = g1( fuv.x );\n            float h0x = h0( fuv.x );\n            float h1x = h1( fuv.x );\n            float h0y = h0( fuv.y );\n            float h1y = h1( fuv.y );\n    \n            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n    \n            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + \n                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n        }\n\n        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n            vec2 fLodSizeInv = 1.0 / fLodSize;\n            vec2 cLodSizeInv = 1.0 / cLodSize;\n            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n            return mix( fSample, cSample, fract( lod ) );\n        }")},wf=class extends Yd{constructor(e,t,r,n,i,o,a,s){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=r,this.transmissionSamplerSize=n,this.transmissionSamplerMap=i,this.transmissionDepthMap=o,this.aspectRatio=a,this.alpha=s,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,Ef.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let r=e.include(wf.Nodes.transmission),n=[];return n.push(this.thickness.build(e,"f")),n.push(this.ior.build(e,"f")),n.push(this.roughness.build(e,"f")),n.push(this.transmissionSamplerSize.build(e,"v2")),n.push(this.transmissionSamplerMap.getTexture(e,"t")),n.push(this.transmissionDepthMap.getTexture(e,"t")),n.push(this.aspectRatio.build(e,"v2")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}return e.format("vec3( 0.0 )",this.getType(e),t)}},_f=wf;_f.Nodes=function(){let e=new np("vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n\t\t\t\t// Special case for blur == 0.0\n\t\t\t\tif (lod == 0.0) {\n\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\t\treturn texture2DLodEXT( sp, U, 0.0).rgb;\n\t\t\t\t\t#else\n\t\t\t\t\treturn textureLod( sp, U, 0.0).rgb;\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec2 texelSize = vec2(1.0) / resolution;\n                vec2 halton = haltonSequence[frameIndex];\n                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n                float temporalAngle  = temporalOffset * PI2;\n\t\t\t\tvec3 res = vec3(0.0);\n                vec2 uv = vec2(0.0);\n                vec2 offset = vec2(0.0);\n                vec2 vogelSample = vec2(0.0);\n                for (int i = 0; i < NUM_SAMPLES; i++) {\n                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;\n                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20\n                    uv = U + offset;\n                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    res += textureLod(sp, uv, lod).rgb;\n                }\n                return res / float(NUM_SAMPLES);\n            }"),t=new np("vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        \n\t\t\t\t// Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t        // The thickness is specified in local space\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),r=new np("float applyIorToRoughness( float roughness, float ior ) {\n\t\t\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\t\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t\t\t}"),n=new np('vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\t\t\t// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see\n\t\t\t\t// also the code in convertTransmission.ts, which runs during export\n\t\t\t\t#ifdef IS_THREEJS_EXPORT\n\t\t\t\t\tfloat lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);\n\t\t\t\t\treturn textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;\n\t\t\t\t#else\n\t\t\t\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t\t\t\tfloat lod = applyIorToRoughness(roughness, ior);\n\t\t\t\t\treturn blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t\t\t\t#endif\n\t\t\t}',[xf.textureBicubic,r,e]),i=new np("vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\n\t\t\t\tvec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n\t\t\t\tvec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n\t\t\t\tunrefractedCoords += 1.0;\n\t\t\t\tunrefractedCoords /= 2.0;\n\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\treturn getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    \t\t}",[n,t]);return{transmission:new np("vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                \n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn transmission;\n            }",[i])}}();var Sf=(e=>(e.NOISE="noise",e.MAP="map",e))(Sf||{}),Of=class extends Yd{constructor(e,t,r,n,i,o,a,s,l,u,c){super("v3"),this.displacementTypeIndex=new zp(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,"map"===Object.values(Sf)[this.displacementTypeIndex.value]&&(this.mat=new Gp(this.movementOrTexture.value.matrix)),this.cropOrOffset=r,this.scale=u,this.noiseFunctionIndex=c,this.voronoiStyle=n,this.smoothness=i,this.seed=o,this.highCut=a,this.lowCut=s,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let r,n=[];switch(n.push("displaced_position"),n.push("displaced_normal"),Object.values(Sf)[this.displacementTypeIndex.value]){case"map":r=e.include(Of.Nodes.map),n.push(this.movementOrTexture.getTexture(e,"t")),n.push("uv"),n.push(this.cropOrOffset.build(e,"f")),this.mat&&n.push(this.mat.build(e,"mat3"));break;case"noise":{let t=Object.values(uf)[this.noiseFunctionIndex.value],i=new np("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),o=new np(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {\n\t\t\t\t\t\t\t${"voronoi"==t?`\n\t\t\t\t\tfloat v = ${t}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);\n\t\t\t\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\t\t\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\t\t\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t\t\t\treturn p + n * v * intensity;\n\t\t\t\t\t`:`\n\t\t\t\t\treturn p + n * ${t}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t`}\n\t\t\t\t\t\t}`,[cf.simplex,cf.simplexFractal,cf.simplexAshima,cf.fbm,cf.perlin,cf.voronoi]),a=new np("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}",[o,i]);r=e.include(a),n.push(this.scale.build(e,"f")),n.push(this.cropOrOffset.build(e,"v3")),n.push(this.movementOrTexture.build(e,"f")),n.push(this.voronoiStyle.build(e,"i")),n.push(this.smoothness.build(e,"f")),n.push(this.seed.build(e,"f")),n.push(this.highCut.build(e,"f")),n.push(this.lowCut.build(e,"f")),n.push(this.quality.build(e,"i"));break}}return n.push(this.intensity.build(e,"f")),n.push("displaced_normal"),e.format(r+"("+n.join(",")+")",this.getType(e),t)}return e.format("vec3( 0.0 )",this.getType(e),t)}},Tf=Of;Tf.Nodes=function(){let e=new np("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),t=new np("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");return{map:new np("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}",[e,t])}}();var Ef={normalRenderTarget:new fp,normalRenderTargetDepth:new fp,transmissionRenderTarget:new fp,transmissionSize:new Kd(2048,2048),transmissionRenderTargetDepth:new fp,aoRenderTarget:new fp,aoEnabled:new Rp,pixelRatioNode:new mp(1),resolution:new Kd,penumbraSize:new Np(5,.5),frameIndex:new zp(0),transmissionLod:new zp(2)};for(let l_ of Object.values(Ef))l_.isRenderGlobal=!0;var Cf,Af=class extends $d{constructor(){super("basic"),this.nodeType="Basic",this.color=new Ip(5526619),this.shadingAlpha=new mp(1),this.shadingBlend=new zp(0),this.previousModelViewMatrix=new Vp,this.previouseProjectionMatrix=new Vp}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ef.frameIndex}),e.mergeUniform({resolution:Ef.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(B.merge([F.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];r&&n.push(r.code,r.result?"displaced_position = "+r.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{void 0===this.color&&(this.color=new Ip(5526619)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let r=this.color.flow(e,"c",{slot:"color"}),n=this.alpha?this.alpha.flow(e,"f"):void 0,i=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=void 0!==n,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join("\n"));let o=["#include <normal_fragment_begin>",r.code];n&&o.push(n.code,"#ifdef ALPHATEST"," if ( "+n.result+" <= ALPHATEST ) discard;","#endif"),i?o.push(i.code,`vec3 outgoingLight = ${r.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${i.result}, 1.0, SPE_BLENDING_NORMAL);`):o.push(`vec3 finalColor = ${r.result};`);let a="1.0";this.mask&&(this.mask.analyze(e),a=`luminance(${this.mask.flow(e,"v3").result})`),n?o.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${n.result} * ${a} );`):o.push("gl_FragColor = vec4("+r.result+", 1.0 );"),o.push("#include <fog_fragment>","#include <dithering_fragment>"),t=o.join("\n")}return t}},Mf=class extends $d{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new Ip(5526619),this.emissive=new Ip(0),this.emissiveIntensity=new mp(1),this.previousModelViewMatrix=new Vp,this.previouseProjectionMatrix=new Vp,this.shadingAlpha=new mp(1),this.shadingBlend=new zp(0),this.occlusion=new Rp(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ef.frameIndex}),e.mergeUniform({resolution:Ef.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(B.merge([F.fog,F.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];r&&n.push(r.code,r.result?"displaced_position = "+r.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Ef.penumbraSize}),e.mergeUniform({frameIndex:Ef.frameIndex}),e.mergeUniform({aoMap:Ef.aoRenderTarget}),e.mergeUniform({aoEnabled:Ef.aoEnabled}),void 0===this.color&&(this.color=new Ip(5526619)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),n=this.emissive.flow(e,"c",{slot:"emissive"}),i=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),o=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),s=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==u,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let c=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t","#include <clipping_planes_fragment>"];c.push(r.code,"vec3 diffuseColor = "+r.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),u&&c.push(u.code,"#ifdef ALPHATEST","if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),c.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),n&&c.push(n.code,"reflectedLight.directDiffuse += "+n.result+" * "+i.result+";"),c.push("vec3 ao = aoEnabled && "+o.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let h="1.0";this.mask&&(this.mask.analyze(e),h=`luminance(${this.mask.flow(e,"v3").result})`),c.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${h} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${h}, ${s.result} );\n\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&c.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join("\n")}return t}},Df=class extends $d{constructor(){super("phong"),this.nodeType="Phong",this.color=new Ip(5526619),this.specular=new Ip(1118481),this.shininess=new mp(30),this.previousModelViewMatrix=new Vp,this.previouseProjectionMatrix=new Vp,this.shadingAlpha=new mp(1),this.shadingBlend=new zp(0),this.occlusion=new Rp(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ef.frameIndex}),e.mergeUniform({resolution:Ef.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(B.merge([F.fog,F.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];r&&n.push(r.code,r.result?"displaced_position = "+r.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Ef.penumbraSize}),e.mergeUniform({frameIndex:Ef.frameIndex}),e.mergeUniform({aoMap:Ef.aoRenderTarget}),e.mergeUniform({aoEnabled:Ef.aoEnabled}),void 0===this.color&&(this.color=new Ip(5526619)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let n=this.color.flow(e,"c",{slot:"color"}),i=this.specular.flow(e,"c"),o=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),s=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==u,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let c=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tBlinnPhongMaterial material;"];c.push(n.code,"\tvec3 diffuseColor = "+n.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",i.code,"\tvec3 specular = "+i.result+";",o.code,"\tfloat shininess = max( 0.0001, "+o.result+" );","\tfloat specularStrength = 1.0;"),u&&c.push(u.code,"#ifdef ALPHATEST","if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let h="1.0";this.mask&&(this.mask.analyze(e),h=`luminance(${this.mask.flow(e,"v3").result})`),c.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${h} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${h}, ${s.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&c.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join("\n")}return t}},Pf=class extends $d{constructor(){super("standard"),this.nodeType="Standard",this.color=new Ip(5526619),this.roughness=new mp(.3),this.metalness=new mp(0),this.reflectivity=new mp(.5),this.previousModelViewMatrix=new Vp,this.previouseProjectionMatrix=new Vp,this.shadingAlpha=new mp(1),this.shadingBlend=new zp(0),this.occlusion=new Rp(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ef.frameIndex}),e.mergeUniform({resolution:Ef.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(B.merge([F.fog,F.lights])),F.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];r&&n.push(r.code,r.result?"displaced_position = "+r.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Ef.penumbraSize}),e.mergeUniform({frameIndex:Ef.frameIndex}),e.mergeUniform({aoMap:Ef.aoRenderTarget}),e.mergeUniform({aoEnabled:Ef.aoEnabled});let r={gamma:!0};void 0===this.color&&(this.color=new Ip(5526619)),this.color.analyze(e,{slot:"color",context:r}),this.roughness.analyze(e),this.metalness.analyze(e);let n=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let i=this.color.flow(e,"c",{slot:"color",context:r}),o=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),u=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join("\n"));let d=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];d.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",o.code,"\tfloat roughnessFactor = "+o.result+";",a.code,"\tfloat metalnessFactor = "+a.result+";"),c&&d.push(c.code,"#ifdef ALPHATEST","\tif ( "+c.result+" <= ALPHATEST ) discard;","#endif"),d.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),d.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),h?d.push(h.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+h.result+" ) ), diffuseColor, metalnessFactor );"):d.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),d.push("#include <lights_fragment_begin>"),d.push("#include <lights_fragment_end>"),d.push("vec3 ao = aoEnabled && "+n.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let p="1.0";this.mask&&(this.mask.analyze(e),p=`luminance(${this.mask.flow(e,"v3").result})`),d.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${p} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${p}, ${l.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),u&&d.push(u.code,`outgoingLight = spe_blend(outgoingLight, ${u.result}, 1.0, SPE_BLENDING_NORMAL);`),c?d.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):d.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),d.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=d.join("\n")}return t}},kf=class extends $d{constructor(){super("toon"),this.nodeType="Toon",this.color=new Ip(5526619),this.specular=new Ip(1118481),this.shininess=new mp(30),this.previousModelViewMatrix=new Vp,this.previouseProjectionMatrix=new Vp,this.shadingAlpha=new mp(1),this.shadingBlend=new zp(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ef.frameIndex}),e.mergeUniform({resolution:Ef.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(B.merge([F.fog,F.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];r&&n.push(r.code,r.result?"displaced_position = "+r.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Ef.penumbraSize}),e.mergeUniform({frameIndex:Ef.frameIndex}),e.mergeUniform({aoMap:Ef.aoRenderTarget}),e.mergeUniform({aoEnabled:Ef.aoEnabled}),void 0===this.color&&(this.color=new Ip(5526619)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),i=this.shininess.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==l,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>","\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join("\n"));let u=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tToonMaterial material;"];u.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",n.code,"\tvec3 specular = "+n.result+";",i.code,"\tfloat shininess = max( 0.0001, "+i.result+" );","\tfloat specularStrength = 1.0;"),l&&u.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let c="1.0";this.mask&&(this.mask.analyze(e),c=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${c} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${c}, ${a.result} );\n\t\t\t\t}\n\t\t\t\t`),s&&u.push(s.code,`outgoingLight = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`),l?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join("\n")}return t}},Lf=class{constructor(e=1e4){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout((()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")}),this.timeout+1e3))}has(e){var t;return null==(t=this.cache.get(e))?void 0:t.data}load(e){let t=Date.now(),r=this.cache.get(e);return void 0===r?(r={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,r)):(r.time=t,r.prev.next=r.next,r.next.prev=r.prev),r.prev=this.tail.prev,r.next=this.tail,this.tail.prev.next=r,this.tail.prev=r,this.scheduleCleanup(),r.data}},Uf=class extends Lf{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}};var If=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,0===this.refCount&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount,0}},zf=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data),0}load(e){let t=this.cache.get(e);return void 0===t&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},Rf=class extends If{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isVideo="video"===e.type,this.updateSrc(e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;let e=[1e3,1001,1002];for(let t of e){let e=this[t];e&&(e.image=this.img,e.needsUpdate=!0)}this.shared.requestRender()};if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,"string"!=typeof e){var r=new FileReader;let t;r.readAsDataURL(new Blob([e],{type:"video/mp4"})),await new Promise((e=>{r.onloadend=r=>{var n;t=null==(n=r.target)?void 0:n.result,e(null)}})),this.img.src=t}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=function(e){return"string"==typeof e?e:(Cf||(Cf=new Uf),Cf.load(e))}(e),this.img.onload=t}getTexture(e){let t=this[e];if(t)return t;{let t;return t=this.isVideo?new j(this.img,void 0,e,e):new m(this.img,void 0,e,e),this.loaded&&(t.needsUpdate=!0),this[e]=t,t}}disposeTextures(){var e,t,r;null==(e=this[1e3])||e.dispose(),this[1e3]=void 0,null==(t=this[1001])||t.dispose(),this[1001]=void 0,null==(r=this[1002])||r.dispose(),this[1002]=void 0}dispose(){super.dispose(),this.disposeTextures()}},Nf=class extends Rf{};function Bf(e,t){return t.color(e)}function Ff(e,t){switch(e.type){case"fresnel":return function(e,t){let{bias:r,scale:n,intensity:i,factor:o,color:a,isMask:s}=e;return{...Gf(e),color:Bf(a,t),bias:r,scale:n,intensity:i,factor:o}}(e,t);case"gradient":return function(e){let{gradientType:t,smooth:r,colors:i,steps:o,angle:a,offset:s,morph:l}=e;return{...Gf(e),gradientType:t,smooth:r,colors:i.map((e=>new _(e[0],e[1],e[2],e[3]))),num:i.length,steps:o,offset:new n(...s),morph:new n(...l),angle:a}}(e);case"depth":return function(e){let{gradientType:t,near:n,far:i,isVector:o,isWorldSpace:a,origin:s,direction:l,colors:u,steps:c,smooth:h}=e;return{...Gf(e),gradientType:t,near:n,far:i,isVector:o,isWorldSpace:a,origin:new r(...s),direction:l?new r(...l):new r(1,0,0),colors:u.map((e=>void 0!==e?new _(e[0],e[1],e[2],e[3]):new _(0,0,0,0))),steps:c.slice(0,u.length),smooth:h}}(e);case"normal":return function(e){let{cnormal:t}=e;return{...Gf(e),cnormal:new r(t[0],t[1],t[2])}}(e);case"noise":return function(e,t){return{...Gf(e),scale:e.scale,move:e.move,fA:new n(...e.fA),fB:new n(...e.fB),size:new r(...e.size),distortion:new n(...e.distortion),colorA:Bf(e.colorA,t),colorB:Bf(e.colorB,t),colorC:Bf(e.colorC,t),colorD:Bf(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}(e,t);case"rainbow":return function(e){return{...Gf(e),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new r(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new r(...e.offset)}}(e);case"toon":return function(e,t){return{...Gf(e),positioning:e.positioning,colors:e.colors.map((e=>new _(e[0],e[1],e[2],e[3]))),num:e.colors.length,steps:e.steps,source:new r(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:Bf(e.shadowColor,t),offset:new r(...e.offset)}}(e,t);case"outline":return function(e,t){return{...Gf(e),outlineColor:Bf(e.outlineColor,t),contourColor:Bf(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new r(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}(e,t);case"transmission":return function(e,t){return{...Gf(e),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}(e);case"color":return function(e,t){return{...Gf(e),color:Bf(e.color,t)}}(e,t);case"pattern":return function(e,t){return{...Gf(e),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new n(...e.offset),colorA:Bf(e.colorA,t),colorB:Bf(e.colorB,t),frequency:new n(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new n(...e.vertical),horizontal:new n(...e.horizontal),sides:e.sides}}(e,t)}}function jf(e){return{type:e.type}}function Gf(e){let{alpha:t,mode:r,isMask:n}=e;return{...jf(e),alpha:t,mode:r,isMask:n}}var Vf=class extends Jd{},Hf={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},Wf={depth:["colors"]};function qf(e,t,r){var n,i;if("isMask"===t)return!0;let o=Hf[e.type],a=Wf[e.type];if(void 0!==a){let o=e.color;if(a.includes(t)){let e=null==(i=null==(n=o[t])?void 0:n.value)?void 0:i.length;if(void 0!==e&&e!==r.length)return!0}}return void 0!==o&&o.includes(t)}function $f(e,t,r){let n=r.uniforms[`f${r.id}_texture`];if(!n)return!1;let i=e;if("image"in i){let e=i.image,r=t.image(e),o=n;o.image instanceof Nf||o.image.deref(),o.image=r}if("video"in i){let e=i.video,r=t.video(e),o=n;o.image instanceof Nf||o.image.deref(),o.image=r}if("wrapping"in i){n.wrap=i.wrapping}if("repeat"in i||"offset"in i){let e="mat",t=r.uniforms[`f${r.id}_${e}`];"repeat"in i&&(t.repeat=i.repeat),"offset"in i&&(t.offset=i.offset),t.updateMatrix()}return!1}var Xf=class{constructor(e,t,r,n){this.id=e,this.uuid=t,this.data=r,this.uniforms={};for(let i in n)this.uniforms[`f${this.id}_${i}`]=n[i];for(let i in r)Jf(i,this,r)}get type(){return this.data.type}static create(e,t,i,o){if("light"===i.type)return Kf.createLigherLayer(e,t,i,o);if("texture"===i.type||"video"===i.type){let r="texture"===i.type?o.image(i.texture.image):o.video(i.texture.video),a=new jp(r,i.texture.wrapping),s=new Fp(r),l=new Wp(i.texture.repeat,i.texture.offset),u=new mp(i.crop?1:0),c=new zp(i.projection??0),h=new zp(["x","y","z"].indexOf(i.axis)??0),d=new zp(i.side??0),p=new Kd(i.size?new n(i.size[0],i.size[1]):new n(100,100)),f=new mp(i.blending??0),m=new mp(i.alpha??1),v=new zp(i.mode??0),g=new Rp(i.isMask??!1),y=new Jp(a,s,u,c,h,d,p,f,l,m,v,g),b=new pp(y.calpha,"f");return new Yf(e,t,i,{texture:a,textureSize:s,crop:u,projection:c,axis:h,side:d,size:p,blending:f,mat:l,alpha:m,mode:v,isMask:g},y,v,b,g)}if("matcap"===i.type){let r=o.image(i.texture.image),n=new jp(r,i.texture.wrapping),a=new mp(i.alpha??1),s=new zp(i.mode??0),l=new Rp(i.isMask??!1),u=new sf(n,a,s,l),c=new pp(u.calpha,"f");return new Yf(e,t,i,{texture:n,alpha:a,mode:s,isMask:l},u,s,c,l)}if("displace"===i.type){if("noise"===i.displacementType){let n=new Qd(new r(...i.offset)),o=new mp(i.scale??10),a=new mp(i.intensity??8),s=new mp(i.movement??1),l=new zp(i.noiseType??0),u=new zp(i.voronoiStyle??0),c=new mp(i.smoothness??.5),h=new mp(i.seed??0),d=new mp(i.highCut??1),p=new mp(i.lowCut??0),f=new zp(i.quality??1),m=new Tf(a,s,n,u,c,h,d,p,f,o,l);return new Zf(e,t,i,{offset:n,scale:o,intensity:a,movement:s,noiseType:l,voronoiStyle:u,smoothness:c,seed:h,highCut:d,lowCut:p,quality:f},m)}throw new Error}return function(e,t,i,o){let a=Ff(i,o);return function(e,t,i,o){switch(e.type){case"color":{let r=new Ip(o.color??5526619),n=Qf(o),a=new Yp(r,n.alpha),s=new pp(a.calpha,"f");return new Yf(t,i,e,{color:r,...n},a,n.mode,s,n.isMask)}case"fresnel":{let r=new Ip(o.color??16777215),n=new mp(o.bias??.1),a=new mp(o.scale??1),s=new mp(o.intensity??2),l=new mp(o.factor??1),u=Qf(o),c=new rf(r,n,a,s,l,u.alpha,u.mode,u.isMask),h=new pp(c.calpha,"f");return new Yf(t,i,e,{color:r,bias:n,scale:a,intensity:s,factor:l,...u},c,u.mode,h,u.isMask)}case"rainbow":{let n=new mp(o.filmThickness??30),a=new mp(o.movement??0),s=new Qd(o.wavelengths??new r(0,0,0)),l=new mp(o.noiseStrength??0),u=new mp(o.noiseScale??1),c=new Qd(o.offset??new r(0,0,0)),h=Qf(o),d=new gf(n,a,s,l,u,c,h.alpha,h.isMask),p=new pp(d.calpha,"f");return new Yf(t,i,e,{filmThickness:n,movement:a,wavelengths:s,noiseStrength:l,noiseScale:u,offset:c,...h},d,h.mode,p,h.isMask)}case"transmission":{let r=new mp(o.thickness??10),n=new mp(o.ior??1.5),a=new mp(o.roughness??.5),s=Ef.transmissionSize,l=Ef.transmissionRenderTarget,u=Ef.transmissionRenderTargetDepth,c=window.innerWidth,h=window.innerHeight,d=c>=h?new Kd(h/c,1):new Kd(1,c/h),p=Qf(o),f=new _f(r,n,a,s,l,u,d,p.alpha),m=new pp(f.calpha,"f");return new Yf(t,i,e,{thickness:r,ior:n,roughness:a,aspectRatio:d,...p},f,p.mode,m,p.isMask)}case"toon":{let n,a,s=new zp(o.positioning??0);o.colors?n=new qp(o.colors.length,o.colors):(n=new qp(10,new _(0,0,0,1)),n.value[1]=new _(1,1,1,1)),o.steps?a=new Np(o.steps.length,o.steps):(a=new Np(10,1),a.value[0]=0);let l=new Qd(o.source??new r(0,0,0)),u=new Rp(o.isWorldSpace??!0),c=new mp(o.noiseStrength??0),h=new mp(o.noiseScale??1),d=new ep(o.shadowColor),p=new Qd(o.offset??new r(0,0,0)),f=Qf(o),m=new bf(s,n,a,l,u,c,h,d,p,f.alpha),v=new pp(m.calpha,"f");return new Yf(t,i,e,{positioning:s,colors:n,steps:a,source:l,isWorldSpace:u,noiseStrength:c,noiseScale:h,shadowColor:d,offset:p,...f},m,f.mode,v,f.isMask)}case"outline":{let n=new Ip(o.outlineColor??16777215),a=new Ip(o.contourColor??16777215),s=new mp(o.outlineWidth??.1),l=new mp(o.contourWidth??.1),u=new mp(o.outlineThreshold??.1),c=new mp(o.contourThreshold??.1),h=new mp(o.outlineSmoothing??.1),d=new mp(o.contourFrequency??.1),p=new Qd(o.contourDirection??new r(0,1,0)),f=new Rp(o.positionalLines??!1),m=new Rp(o.compensation??!0),v=Ef.normalRenderTarget,g=Ef.normalRenderTargetDepth,y=Ef.pixelRatioNode,b=Ef.resolution,x=Qf(o),w=new pf(n,a,s,l,u,c,h,d,p,f,m,b,v,g,y,x.alpha),_=new pp(w.calpha,"f");return new Yf(t,i,e,{outlineColor:n,contourColor:a,outlineWidth:s,contourWidth:l,outlineThreshold:u,contourThreshold:c,outlineSmoothing:h,contourFrequency:d,contourDirection:p,positionalLines:f,compensation:m,...x},w,x.mode,_,x.isMask)}case"depth":{let n,a,s=new zp(o.gradientType??0),l=new Rp(o.smooth??!1),u=new mp(o.near??50),c=new mp(o.far??200),h=new mp(o.isVector??1),d=new mp(o.isWorldSpace??0),p=new Qd(o.origin??new r),f=new Qd(o.direction??new r);o.colors?n=new qp(o.colors.length,o.colors):(n=new qp(2,new _(0,0,0,1)),n.value[1]=new _(1,1,1,1)),o.steps?a=new Np(o.steps.length,o.steps):(a=new Np(2,1),a.value[0]=0);let m=Qf(o),v=new tf(s,l,u,c,h,d,p,f,n,a,m.alpha,m.isMask),g=new pp(v.calpha,"f");return new Yf(t,i,e,{gradientType:s,smooth:l,near:u,far:c,isVector:h,isWorldSpace:d,origin:p,direction:f,colors:n,steps:a,...m},v,m.mode,g,m.isMask)}case"noise":{let a=new mp(o.scale??1),s=new Qd(o.size??new r(100,100,100)),l=new mp(o.move??1),u=new Kd(o.fA??new n(1.7,9.2)),c=new Kd(o.fB??new n(8.3,2.8)),h=new Kd(o.distortion??new n(1,1)),d=new ep(o.colorA),p=new ep(o.colorB),f=new ep(o.colorC),m=new ep(o.colorD),v=new zp(o.noiseType??0),g=new zp(o.voronoiStyle??0),y=new mp(o.highCut??1),b=new mp(o.lowCut??0),x=new mp(o.smoothness??.5),w=new mp(o.seed??.5),_=new zp(o.quality??1),S=Qf(o),O=new hf(a,s,l,u,c,h,d,p,f,m,S.alpha,v,S.isMask,g,y,b,x,w,_),T=new pp(O.calpha,"f");return new Yf(t,i,e,{scale:a,size:s,move:l,fA:u,fB:c,distortion:h,colorA:d,colorB:p,colorC:f,colorD:m,noiseType:v,...S,voronoiStyle:g,highCut:y,lowCut:b,smoothness:x,seed:w,quality:_},O,S.mode,T,S.isMask)}case"normal":{let n=new Qd(o.cnormal??new r(1,1,1)),a=Qf(o),s=new Kp(n,a.alpha),l=new pp(s.calpha,"f");return new Yf(t,i,e,{cnormal:n,...a},s,a.mode,l,a.isMask)}case"gradient":{let r,a,s=new zp(o.gradientType??0),l=new Rp(o.smooth??!1);o.colors?r=new qp(o.colors.length,o.colors):(r=new qp(10,new _(0,0,0,1)),r.value[1]=new _(1,1,1,1)),o.steps?a=new Np(o.steps.length,o.steps):(a=new Np(10,1),a.value[0]=0);let u=new Kd(o.offset??new n(0,0)),c=new Kd(o.morph??new n(0,0)),h=new mp(o.angle??0),d=Qf(o),p=new of(s,l,r,a,u,c,h,d.alpha,d.isMask),f=new pp(p.calpha,"f");return new Yf(t,i,e,{gradientType:s,smooth:l,colors:r,steps:a,offset:u,morph:c,angle:h,...d},p,d.mode,f,d.isMask)}case"pattern":{let r=new zp(o.style??0),a=new zp(o.projection??0),s=new zp(["x","y","z"].indexOf(o.axis)??0),l=new mp(o.blending??0),u=new Kd(o.offset??new n(0,0)),c=new ep(o.colorA),h=new ep(o.colorB),d=new Kd(o.frequency??new n(10,10)),p=new mp(o.size??.5),f=new mp(o.variation??0),m=new mp(o.smoothness??.5),v=new mp(o.zigzag??0),g=new mp(o.rotation??0),y=new Kd(o.vertical??new n(0,1)),b=new Kd(o.horizontal??new n(0,1)),x=new zp(o.sides??6),w=Qf(o),_=new mf(r,a,s,l,u,c,h,d,p,f,m,v,g,y,b,x,w.alpha,w.isMask),S=new pp(_.calpha,"f");return new Yf(t,i,e,{style:r,projection:a,axis:s,blending:l,offset:u,colorA:c,colorB:h,frequency:d,size:p,variation:f,smoothness:m,zigzag:v,rotation:g,vertical:y,horizontal:b,sides:x,...w},_,w.mode,S,w.isMask)}default:{let r=new Ip(1,0,0,1),n=Qf(o),a=new Yp(r,n.alpha),s=new pp(a.calpha,"f");return new Yf(t,i,e,{color:r,...n},a,n.mode,s,n.isMask)}}}(i,e,t,a)}(e,t,i,o)}updateByOp(e,t,r){var n;let i=e;if(void 0===i.path[0]){if(0===i.type)return"type"in i.props||"category"in i.props||"visible"in i.props?(null==(n=r.scene)||n.markNeedsUpdateRendererDirty(),!0):function(e,t,r,n){let i=!1;for(let[o,a]of Object.entries(e)){if(!o||void 0===a)continue;if(Jf(o,r,n)){"visible"===o&&"light"===r.type&&(i=!0);continue}r.visible=n.visible;let e=r.uniforms[`f${r.id}_${o}`];if(e&&!(e instanceof Bp))switch(i=i||qf(r,o,a),e.constructor){case Ip:if("string"==typeof a){let r=t.getColor(a);r&&(e.value=r);break}{let t=a;e.value instanceof Vf?e.value=new Jd(t.r,t.g,t.b,t.a):e.setRGBA(t);break}case ep:if("string"==typeof a){let r=t.getColor(a);r&&(e.value=r);break}{let t=a;e.value instanceof Vf?e.value=new Jd(t.r,t.g,t.b,t.a):e.value.setRGBA(t.r,t.g,t.b,t.a);break}case Kd:{let t=a;e.value.setX(t[0]),e.value.setY(t[1]);break}case Qd:{let t=a;e.value.setX(t[0]),e.value.setY(t[1]),e.value.setZ(t[2]);break}case fp:$f(a,t,r);break;case qp:e.value=a.map((e=>new _(...e)));break;default:e.value=a}}return i}(i.props,r.shared,this,t)}else if("texture"===i.path[0])return!("texture"in t)&&!("video"in t)||$f(i.props,r.shared,this);return!1}dispose(){if(function(e){let t=e instanceof Xf?e.type:e;return"texture"===t||"video"===t||"displace_map"===t||"matcap"===t}(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof Nf||t.image.deref()}}hasValueByKey(e){return void 0!==this.uniforms[e]}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let r=`f${this.id}_${e}`;this.hasValueByKey(r)&&void 0!==t&&(this.uniforms[r].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1]}getNames(){let e=[];for(let t in this.uniforms){let r=this.getName(t);r&&e.push(r)}return e}},Yf=class extends Xf{constructor(e,t,r,n,i,o,a,s){super(e,t,r,n),this.params=n,this.color=i,this.mode=o,this.alpha=a,this.isMask=s}},Zf=class extends Xf{constructor(e,t,r,n,i){super(e,t,r,n),this.position=i}},Kf=class extends Xf{constructor(e,t,r,n,i){super(e,t,r,i),this.node=n}static createLigherLayer(e,t,r,n){let i,o,a=new mp(r.alpha),s=new zp(r.mode);if(r.visible)if("lambert"===r.category){i=new Mf;let e=new Ip(n.color(r.emissive)??0),t=new Rp(r.occlusion??!0);o={emissive:e,occlusion:t},i.emissive=e,i.occlusion=t}else if("toon"===r.category){i=new kf;let e=new mp(r.shininess??30),t=new Ip(n.color(r.specular)??1118481);o={shininess:e,specular:t},i.shininess=e,i.specular=t}else if("physical"===r.category){i=new Pf;let e=new mp(r.roughness??.3),t=new mp(r.metalness??0),n=new mp(r.reflectivity??.5),a=new Rp(r.occlusion??!0);o={roughness:e,metalness:t,reflectivity:n,occlusion:a},i.roughness=e,i.metalness=t,i.reflectivity=n,i.occlusion=a}else{i=new Df;let e=new mp(r.shininess??30),t=new Ip(void 0!==r.specular?n.color(r.specular)??1118481:1118481),a=new Rp(r.occlusion??!0);o={shininess:e,specular:t,occlusion:a},i.shininess=e,i.specular=t,i.occlusion=a}else i=new Af,o={};return i.alpha=new mp(1),i.shadingAlpha=a,i.shadingBlend=s,o.alpha=i.shadingAlpha,o.mode=i.shadingBlend,new Kf(e,t,r,i,o)}get category(){return this.node.category}};function Qf(e){return{alpha:new mp(e.alpha??1),mode:new zp(e.mode??0),isMask:new Rp(e.isMask??!1)}}function Jf(e,t,r){if("displace"===r.type&&("intensity"===e||"visible"===e)){let e=t.uniforms[`f${t.id}_intensity`];return e?(e.value=r.intensity*(r.visible?1:0),e):void 0}if("displace"!==r.type&&("alpha"===e||"visible"===e)){let n=t.uniforms[`f${t.id}_alpha`];if(!n)return;if(n.value=r.alpha*(r.visible?1:0),"outline"===r.type&&"visible"===e){let e=t.uniforms[`f${t.id}_compensation`];e&&(e.value=r.compensation&&r.visible)}return n}}function em(e,t){let r=0;for(let n of e.layers){if("displace"!==n.data.type&&n.data.isMask)return!0;if("displace"!==n.data.type&&"alpha"in n.data&&"light"!==n.data.type&&"fresnel"!==n.data.type&&"texture"!==n.data.type&&"matcap"!==n.data.type&&"rainbow"!==n.data.type&&"outline"!==n.data.type&&"pattern"!==n.data.type){let e=n.data.visible?n.data.alpha:0;if(1===e&&"depth"===n.data.type||"gradient"===n.data.type){for(let t of n.data.colors)if(t[3]<1){e=t[3];break}}else if(1===e&&"noise"===n.data.type){let r=t.color(n.data.colorA).a,i=t.color(n.data.colorB).a,o=t.color(n.data.colorC).a,a=t.color(n.data.colorD).a,s=Math.min(r,Math.min(i,Math.min(o,a)));s<1&&(e=s)}r+=(1-r)*e}}return r<1}var tm=class extends G{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.cacheKey="",this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return this.cacheKey}},rm=class extends tm{constructor(e,t,r,n){super(),this.flatShading=e,this.side=t,this.wireframe=r,this.root=n}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,r){return this.root.getFlavor(e,t,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,r){this.root.updateByOp(e,t,r)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},nm=class extends tm{constructor(e,t){super(),this.data=e,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.reset0(e,t)}get nodeMaterial(){return this}getFlavor(e,t,r){let n=r?6:(e?3:0)+t;if(0===n)return this;void 0===this.flavors&&(this.flavors=[]),n-=1;let i=this.flavors[n];return void 0===i&&(i=new rm(e,t,r,this),this.flavors[n]=i,i.flatShading=e,i.side=t,i.updateAfterBuild()),i}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return(null==(e=this.lightLayer.getNode("occlusion"))?void 0:e.value)??!1}reset(e,t){this.data!==e&&this.reset0(e,t)}reset0(e,t){this.data=e;let r=e.layers??Tl.defaultTwoLayerData("phong").layers;this.layers=r.map((e=>Xf.create(this.layerIdGen++,e.id,e.data,t.shared))),this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(),this.transparent=em(e,t.shared)}getLayersOfType(e){return this.layers.filter((t=>t.type===e))}getLayerByUuid(e){return this.layers.find((t=>t.uuid===e))}onUpdate(){this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find((e=>e instanceof Kf)),void 0===this.lightLayer&&(this.lightLayer=new Kf(0,"",{...Ol.defaultData("light","phong"),visible:!1},new Af,{})),this.dispose();for(let e of this.flavors)e&&e.dispose();this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions()}updateByOp(e,t,r){var n,i,o,a;if(void 0!==t?this.data=t:t=this.data,this.transparent=em(t,r.shared),"layers"===e.path[0]){this.data=t;let s=r.shared,l=e.path[1];if(void 0===l){if(this.layers.reverse(),4===e.type){let t=Xf.create(this.layerIdGen++,e.id,e.data,r.shared);this.layers.splice(e.localIndex,0,t),null==(n=r.scene)||n.markNeedsUpdateRendererDirty()}else if(5===e.type)this.layers.splice(e.localIndex,1)[0].dispose(),null==(i=r.scene)||i.markNeedsUpdateRendererDirty();else if(6===e.type){let t=this.layers.findIndex((t=>t.uuid===e.id)),n=this.layers[t];this.layers.splice(t,1),this.layers.splice(e.localIndex,0,n),null==(o=r.scene)||o.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate()}else{0===e.type&&void 0!==e.props.occlusion&&(null==(a=r.scene)||a.markNeedsUpdateRendererDirty());let n=this.layers.find((e=>e.uuid===l));if(n){let i=t.layers.data(l);if(n.updateByOp({...e,path:e.path.slice(2)},i,r)){let e=Xf.create(this.layerIdGen++,l,i,s);this.layers.splice(this.layers.findIndex((e=>e.uuid===l)),1,e),this.onUpdate()}}}}else this.reset(t,r)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof Yf?t.color.mask=void 0:t instanceof Kf&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof Yf&&t.isMask.value&&t.data.visible&&e>0){let r=e-1,n=this.layers[r];n instanceof Kf?n.node.mask=new yp(t.color,t.alpha,yp.MUL):n instanceof Yf&&(n.isMask.value||(n.color.mask=new yp(t.color,t.alpha,yp.MUL)))}}}blendColors(){let e=this.layers.findIndex((e=>e instanceof Yf)),t=this.layers.findIndex((e=>e instanceof Kf));if(-1!==e&&e<t){let r=this.layers[e].color;for(let n=e+1;n<t;++n){let e=this.layers[n];if(e instanceof Yf){if(e.isMask.value)continue;r=new $p(r,e.color,e.alpha,e.mode)}}this.fragment.color=r}else this.fragment.color=void 0}blendAfterColors(){let e=new pp("outgoingLight","f"),t=this.layers.findIndex((e=>e instanceof Kf));if(this.layers.length>t+1){for(let r=t+1;r<this.layers.length;++r){let t=this.layers[r];if(t instanceof Yf){if(t.isMask.value)continue;e=new $p(e,t.color,t.alpha,t.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter((e=>e instanceof Zf));if(e.length>0){let t=e[0].position;for(let r=1;r<e.length;++r)e[r]&&(t=new yp(t,e[r].position,yp.ADD),t=new yp(t,new mp(.5).setReadonly(!0),yp.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}clampUniformsForPreview(e,t){let r=(e,t,r)=>Math.min(Math.max(e,t),r);for(let n of this.layers)if("displace"===n.type){let i=r(n.uniforms[`f${n.id}_intensity`].value,e,t);n.uniforms[`f${n.id}_intensity`].value=i}}computeCacheKey(){let e="[";for(let{data:t}of this.data.layers)if("light"===t.type)e+=`"${t.visible?t.category.toUpperCase():"Basic"}"`;else{let r=(Hf[t.type]??[]).map((e=>t[e])),n=(Wf[t.type]??[]).map((e=>{var r;return(null==(r=t[e])?void 0:r.length)??0})),i=[...r,...n];i.length?e+=`["${t.type}", "${i.join('","')}"],`:e+=`"${t.type}",`}return e=e.slice(0,-1)+"]",e}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(e,t){return e.deps.length-t.deps.length}return function(t,r){let n=this.getIncludes(t,r);if(!n)return"";let i="";n=n.sort(e);for(let e=0;e<n.length;e++)n[e].src&&(i+=n[e].src+"\n");return i}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join("\n"),fragment:["float accumAlpha = 0.0;","void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}",""].join("\n")},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode("\nuniform int frameIndex;\nuniform vec2 resolution;\nuniform mat4 previousModelViewMatrix;\nuniform mat4 previousProjectionMatrix;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n"),this.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n\nuniform int frameIndex;\nuniform vec2 resolution;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos) {\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\n"),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let r=0;r<this.requires.uv.length;r++)if(this.requires.uv[r]){let e=r>0?r+1:"";this.addVaryCode("varying vec2 vUv"+e+";"),r>0&&this.addVertexParsCode("attribute vec2 uv"+e+";"),this.addVertexFinalCode("vUv"+e+" = uv"+e+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode("\n// TODO: This could be generated CPU side and passed to the shader every frame\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\n// TODO: Pass correct view size\nvec2 offset = haltonSequence[frameIndex];\noffset.x /= resolution.x;\noffset.y /= resolution.y;\n\nvec4 currentPosition = gl_Position;\nvec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);\n\n// We want to calculate the velocity with unjittered positions\n// so that things that are not moving get a velocity = 0\nvCurrentPosition = currentPosition;\nvPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);\n#ifdef OUTLINE_COMPENSATION\nvPreviousPosition.xy += OUTLINE_COMPENSATION;\n#endif\ngl_Position = currentPositionJittered;\n\n"),this.addFragmentFinalCode("\nvec2 oldPos = vPreviousPosition.xy;\n    oldPos /= vPreviousPosition.w;\n    oldPos.xy = (oldPos.xy+1.)/2.0;\n\nvec2 newPos = vCurrentPosition.xy;\n    newPos /= vCurrentPosition.w;\n    newPos.xy = (newPos.xy+1.)/2.0;\n\nvec2 velocity = (newPos - oldPos);\n\n// NOTE: We use the blue channel to avoid temporal reprojection\n// with incorrect velocity if the fragment is transparent.\ngVelocity = vec4(velocity, gl_FragColor.a < 1.0 ? 0.0 : 1.0, 1.);\n")),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,r){return this.addSlot(e).addCache(t).addContext(r)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){void 0===this.fragmentVariables[e]&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){void 0===this.fragmentParsVariables[e]&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){void 0===this.vertexParsVariables[e]&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+"\n"}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+"\n"}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+"\n"}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+"\n"}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return-1!==this.caches.indexOf(e)}isSlot(e){return-1!==this.slots.indexOf(e)}define(e,t){this.defines[e]=void 0===t?1:t}require(e){this.requires[e]=!0}isDefined(e){return void 0!==this.defines[e]}getVar(e,t,r,n="varying",i="V",o=""){let a=this.getVars(n),s=a[e];if(!s){let n=a.length;s={name:r||"node"+i+n+(o?"_"+o:""),type:t},a.push(s),a[e]=s}return s}getTempVar(e,t,r,n){return this.getVar(e,t,r,this.shader,"T",n)}getAttribute(e,t){if(!this.attributes[e]){let r=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(r.name+" = "+e+";"),this.attributes[e]={varying:r,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")}getVarListCode(e,t){t=t??"";let r="";for(let n=0,i=e.length;n<i;++n){let i=e[n],o=i.type,a=i.name,s=i.size,l=this.getFormatByType(o);if(void 0===l)throw new Error("Node pars "+l+" not found.");l.includes("[]")?r+=t+" "+l.substring(0,l.length-2)+" "+a+`[${s}];\n`:r+=t+" "+l+" "+a+";\n"}return r}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof $d?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,r,n,i,o){if(t.includes("[]")){let a=this.inputs.arrayUniforms,s=a.list.length,l=new qd({type:t,size:r.size,name:n||"nodeUA"+s+(o?"_"+o:""),node:r,needsUpdate:i});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}{let a=this.inputs.uniforms,s=a.list.length,l=new qd({type:t,name:n||"nodeU"+s+(o?"_"+o:""),node:r,needsUpdate:i});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,r,n,i){return this.createUniform("vertex",e,t,r,n,i)}createFragmentUniform(e,t,r,n,i){return this.createUniform("fragment",e,t,r,n,i)}include(e,t,r){var n;let i;if(e="string"==typeof e?Xd.get(e):e,!1===this.context.include)return e.name;e instanceof np?i=this.includes.functions:e instanceof ap?i=this.includes.consts:e instanceof up&&(i=this.includes.structs);let o=i[this.shader]=i[this.shader]||[];if(e){let i=o[e.name];if(i||(i=o[e.name]={node:e,deps:[]},o.push(i),i.src=e.build(this,"source")),e instanceof np&&t&&o[t.name]&&-1===o[t.name].deps.indexOf(e)&&(o[t.name].deps.push(e),null==(n=e.includes)?void 0:n.length)){let r=0;do{this.include(e.includes[r++],t)}while(r<e.includes.length)}return r&&(i.src=r),e.name}throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return kp[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return 1===e?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let r=e[t];if(null==r?void 0:r.isNode)return r}}resolve(...e){for(let t=0;t<arguments.length;t++){let r=e[t];if(void 0!==r){if(r.isNode)return r;if(r.isTexture)switch(r.mapping){case N:case R:return new Dp(r);case z:return new Mp(new fp(r));default:return new fp(r)}else{if(r.isVector2)return new Kd(r);if(r.isVector3)return new Qd(r);if(r.isVector4)return new ep(r)}}}}format(e,t,r){switch(this.colorToVector(r+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return Lp[e]||e}getFormatByType(e){return Up[e]||e}getUUID(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return Pp[e]}getIndexByElement(e){return Pp.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=I,t===I&&this.context.gamma&&(t=U),t}};e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach((e=>e.dispose())),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof Yf){let t=e.params.texture;if(t instanceof jp&&!t.image.loaded)return!1}return!0}getHash(){let e="{";return e+='"fragment":'+this.fragment.getHash(),e+="}",e}};Object.defineProperties(tm.prototype,{properties:{get:function(){return this.fragment.properties}}});var im=class extends nm{},om=Ne(je()),am=new Map;function sm(e){if("string"==typeof e)return e;let t=am.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},am.set(e,t)),t.url}var lm,um=class{constructor({src:e,volume:t,delay:r,loop:n}){let i;this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)},i="string"==typeof e?{src:e}:{src:sm(e),format:"wav"},this.sound=new om.Howl(i),this.sound.on("end",this.onEnd),this.src=e,void 0!==t&&(this.volume=t),void 0!==r&&(this.delay=r),void 0!==n&&(this.loop=n)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout((()=>{this.sound.play(),this.clearDelay()}),this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout((()=>{this.sound.fade(this._volume,0,t),this.clearFade()}),e)):this.sound.fade(this._volume,0,t)}on(e,t,r){this.sound.on(e,t,r)}off(e,t,r){this.sound.off(e,t,r)}play(){"playing"===this._status||this.sound.playing()||("paused"===this._status?(0===this.sound.seek()?this.replay():this.sound.play(),this._status="playing"):"stopped"===this._status&&(this.replay(),this._status="playing"))}pause(){"playing"===this._status&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},cm=new Promise((e=>{lm=e})),hm=!1;async function dm(){if(hm)return;let e=await De((()=>Promise.resolve().then((()=>s_))),void 0,import.meta.url);lm(e),hm=!0}var pm=new class{async load(e,t,r=(()=>{})){let{load:n}=await cm;n(e,((e,n)=>{e||!n?r(e??"Something went wrong"):t(n)}))}async parse(e){let{parse:t,Bidi:r}=await cm;try{let n=t(e),i=new r,o=e=>n.charToGlyphIndex(e.char);return i.registerModifier("glyphIndex",null,o),i.applyFeatures(n,n.defaultRenderOptions.features),{font:n,bidi:i}}catch($s){}}};async function fm(e){let t,r,n=!1;if(e.url?(t=await async function(e){return await(await fetch(e)).arrayBuffer()}(e.url),r=e.url,n=e.url.startsWith("/")):e.data&&(t=e.data.buffer),t){let e=await pm.parse(t);if(e)return{font:e.font,url:r,intercepted:n,arr:t,bidi:e.bidi}}}function mm(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var vm=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t){let r=this.objects.get(e);return void 0===r?(r=this.createObject(e,t),this.objects.set(e,r)):r.isShared=!0,r}mutateIfUnique(e,t){let r=this.objects.get(e);if(r&&!0!==r.isShared)return this.objects.delete(e),this.objects.set(t,r),r}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){t===this.objects.get(e)&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach((e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)})),this.unreachable.clear()}dispose(){this.objects.forEach((e=>{this.disposeObject(e)})),this.objects.clear()}},gm=class extends vm{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t){let r=cd(e,t,this.flatShading);return r.computeBoundingSphere(),r}},ym={find(e){},markNeedsUpdateRendererDirty:function(){},markGeometryCacheDirty:function(){},addPendingExpandCloner:function(e){},addPendingUpdateCloner(e){},addPendingCommand(e){}},bm=class extends zf{constructor(e){super(),this.shared=e}create(e){return new Rf(e,this.shared)}},xm=class{constructor(e,t={}){if(this.geometryCache=new gm(!0),this.geometryCache2=new gm(!1),this.imageHolderCache=new bm(this),this.thisContext={scene:ym,shared:this},this.deletedMaterial=new im(Tl.defaultTwoLayerData("phong"),this.thisContext),this.deletedImage=new Nf(Jl.emptyImage,this),this.deletedVideo=new Nf(ml.defaultVideo,this),this.materials={},this.images={},this.videos={},this.colors={},this.audios={},this.fonts={},this.penumbraSize=[],this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[r,n]of Object.entries(t.images))this.addImage(r,n);if(t.videos)for(let[r,n]of Object.entries(t.videos))this.addVideo(r,n);if(t.audios)for(let[r,n]of Object.entries(t.audios))this.addAudio(r,n.data);this.reset(e)}setRequestRender(e){this._requestRender=e}reset(e){for(let[t,r]of Object.entries(e.images))this.addImage(t,r);for(let[t,r]of Object.entries(e.videos))this.addVideo(t,r);for(let[t,r]of Object.entries(e.colors))this.addColor(t,r);for(let[t,r]of Object.entries(e.materials))this.addMaterial(t,new im(r,this.thisContext));for(let[t,r]of Object.entries(e.audios))this.addAudio(t,r.data);for(let[t,r]of Object.entries(e.fonts))this.addFont(t,r);this.penumbraSize=e.penumbraSize}addMaterial(e,t){t.uuid=e,this.materials[e]?(this.materials[e].reset(t.data,this.thisContext),t.dispose()):this.materials[e]=t}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return"string"==typeof e?this.getMaterialOrDeletedPlaceholder(e):new nm(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new Nf(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return"string"==typeof e?this.getImage(e):this.imageHolderCache.load(e)}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new Nf(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return"string"==typeof e?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):(this.colors[e]=new Vf(t.r,t.g,t.b,"a"in t?t.a:1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let r=this.colors[e];return this.colors[e].r=t.r??r.r,this.colors[e].g=t.g??r.g,this.colors[e].b=t.b??r.b,this.colors[e].a=t.a??r.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if("string"!=typeof e)return new Jd(e.r,e.g,e.b,"a"in e?e.a:1);{let r=this.getColor(e);t=r||new Jd(0,0,0,0)}return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof um)return t;{let r=new um({src:t});return this.audios[e]=r,r}}deleteAudio(e){let t=this.audios[e];t&&(t instanceof um&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=fm(e).then((e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)}))}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=fm(e).then((e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)}))}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,r){if(!this._bidi)return[];let n=this._bidi;n.getTextGlyphs(t);let i=n.tokenizer.tokens,o=[],a=0,s=r.length===i.length;for(let l=0;l<r.length;l++){let n=r[l].index,u=String.fromCharCode(r[l].unicode),c=i[a];if(mm(n,c)||s)o.push({char:u,index:n,replacements:[c.state.glyphIndex],replacementChars:[c.char]}),a++;else{let r=c.char,i="",s=[c.state.glyphIndex],l=[],h=!1;for(;!h;)a++,i=t.charAt(a),r+=i,s.push(e.charToGlyphIndex(i)),l=e.stringToGlyphs(r),1===l.length&&l[0].index===n&&(h=!0),a>t.length&&(h=!0);o.push({char:u,index:n,replacements:s,replacementChars:Array.from(r)}),a++}}return o}generateShapes(e,t){if(!this._isLoaded)return;let r,n=this.font,i=t.fontSize/this.unitsPerEm,o=t.fontSize*t.lineHeight,a=e.map((e=>this.getTextWidth(e,t))),s=t.width,l=this.getCharWidth("\n",t),u=1===t.horizontalAlign?l:0,c=this.computeSpaceWidthForLine(e,0,t),h=this.getLineInitialOffsetX(a[0],s,t.horizontalAlign,e[0],l),d=this.getLineInitialOffsetY(o,e.length,t.height,i,t.verticalAlign),p=[],f=e.map((e=>[])),m=e.map((e=>[]));for(let y=0;y<e.length;y++){let v=e[y],b={features:{liga:!0}},x=[];try{x=n.stringToGlyphs(v,b)}catch(g){}h=this.getLineInitialOffsetX(a[y],s,t.horizontalAlign,v,l);let w=[];try{w=this.reverseLigaturesTable(n,v,x)}catch(g){}c=this.computeSpaceWidthForLine(e,y,t);for(let e=0;e<x.length;e++){let o=x[e],a=0===o.index?"\n":o.unicode?String.fromCharCode(o.unicode):void 0,s=w[e],l=0,v=0;0===e&&2===t.horizontalAlign&&void 0!==o.leftSideBearing&&(v=-o.leftSideBearing*i),r&&(l=n.getKerningValue(o,r)*i),h+=v+l;let g=0;if("\n"===a)g=u;else if(" "===a)g=c;else{let e=this.createPath(o,i,h,d,t);e&&(g=e.offsetX-(l+v),p.push(e.path))}if(1===s.replacements.length)m[y].push([h,d]),f[y].push(g);else{let e=s.replacements.map((e=>(n.glyphs.get(e).advanceWidth??0)*i)),t=e.reduce(((e,t)=>e+t),0),r=e.map((e=>e/t)),o=h;for(let n=0;n<r.length;n++){let e=g*r[n];m[y].push([o,d]),f[y].push(e),o+=e}}h+=g,r=o}d-=o}let v=[];for(let y=0,b=p.length;y<b;y++)v.push(...p[y].toShapes());return{shapes:v,charWidths:f,lineWidths:a,charCoords:m}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return(null==(e=this.font)?void 0:e.ascender)??0}get descender(){var e;return(null==(e=this.font)?void 0:e.descender)??0}get familyName(){var e;return(null==(e=this.font)?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return(null==(e=this.font)?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return(null==(e=this.font)?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,r,n,i){return(3===r||2===r)&&n.indexOf("\n")>=0&&(e-=i),3===r?.5*t-.5*e:2===r?t-e:0}getLineInitialOffsetY(e,t,r,n,i){let o=t*e,a=e-Math.abs(this.ascender-this.descender)*n,s=-this.ascender*n-a/2;return 3===i?-(r-o-s):2===i?-(.5*r-.5*o-s):s}createPath(e,t,r,i,o){var a;let s=e.getPath(r,-i,o.fontSize,{kerning:!1,letterSpacing:o.letterSpacing});if(!s)return;let l=new class{constructor(){this.type="ShapePath",this.color=new w,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new V,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var r;return null==(r=this.currentPath)||r.lineTo(e,t),this}quadraticCurveTo(e,t,r,n){var i;return null==(i=this.currentPath)||i.quadraticCurveTo(e,t,r,n),this}bezierCurveTo(e,t,r,n,i,o){var a;return null==(a=this.currentPath)||a.bezierCurveTo(e,t,r,n,i,o),this}splineThru(e){var t;return null==(t=this.currentPath)||t.splineThru(e),this}toShapes(){let e=0,t=1,r=2,i=3,o=4,a=5,s=6,l={loc:e,t:0};function u(t,n,i,o){let a=t.x,s=n.x,u=i.x,h=o.x,d=t.y,p=n.y,f=i.y,m=o.y,v=(h-u)*(d-f)-(m-f)*(a-u),g=(m-f)*(s-a)-(h-u)*(p-d),y=v/g,b=((s-a)*(d-f)-(p-d)*(a-u))/g;if(0===g&&0!==v||y<=0||y>=1||b<0||b>1)return null;if(0===v&&0===g){for(let u=0;u<2;u++){if(c(0===u?i:o,t,n),l.loc===e){let e=0===u?i:o;return{x:e.x,y:e.y,t:l.t}}if(l.loc===r)return{x:+(a+l.t*(s-a)).toPrecision(10),y:+(d+l.t*(p-d)).toPrecision(10),t:l.t}}return null}for(let r=0;r<2;r++)if(c(0===r?i:o,t,n),l.loc===e){let e=0===r?i:o;return{x:e.x,y:e.y,t:l.t}}return{x:+(a+y*(s-a)).toPrecision(10),y:+(d+y*(p-d)).toPrecision(10),t:y}}function c(n,u,c){let h,d=c.x-u.x,p=c.y-u.y,f=n.x-u.x,m=n.y-u.y,v=d*m-f*p;return n.x===u.x&&n.y===u.y?(l.loc=e,void(l.t=0)):n.x===c.x&&n.y===c.y?(l.loc=t,void(l.t=1)):void(v<-Number.EPSILON?l.loc=i:v>Number.EPSILON?l.loc=o:d*f<0||p*m<0?l.loc=a:Math.sqrt(d*d+p*p)<Math.sqrt(f*f+m*m)?l.loc=s:(h=0!==d?f/d:m/p,l.loc=r,l.t=h))}function h(e,t,r){let i=new n;t.getCenter(i);let o=[];return r.forEach((t=>{t.boundingBox.containsPoint(i)&&function(e,t){let r=[],i=[];for(let o=1;o<e.length;o++){let a=e[o-1],s=e[o];for(let e=1;e<t.length;e++){let o=u(a,s,t[e-1],t[e]);null!==o&&void 0===r.find((e=>e.t<=o.t+Number.EPSILON&&e.t>=o.t-Number.EPSILON))&&(r.push(o),i.push(new n(o.x,o.y)))}}return i}(e,t.points).forEach((e=>{o.push({identifier:t.identifier,isCW:t.isCW,point:e})}))})),o.sort(((e,t)=>e.point.x-t.point.x)),o}let d=0,p=999999999,f=-999999999,m=[];this.subPaths.forEach((e=>{let t=e.getPoints(),r=-999999999,i=999999999,o=-999999999,a=999999999;for(let n=0;n<t.length;n++){let e=t[n];e.y>r&&(r=e.y),e.y<i&&(i=e.y),e.x>o&&(o=e.x),e.x<a&&(a=e.x)}f<=o&&(f=o+1),p>=a&&(p=a-1),t.length&&m.push({curves:e.curves,points:t,isCW:H.isClockWise(t),identifier:d++,boundingBox:new W(new n(a,i),new n(o,r))})}));let v=m.map((e=>{var t;return function(e,t,r,i,o){(null==o||""===o)&&(o="nonzero");let a=new n;e.boundingBox.getCenter(a);let s=h([new n(r,a.y),new n(i,a.y)],e.boundingBox,t);s.sort(((e,t)=>e.point.x-t.point.x));let l=[],u=[];s.forEach((t=>{t.identifier===e.identifier?l.push(t):u.push(t)}));let c=l[0].point.x,d=[],p=0;for(;p<u.length&&u[p].point.x<c;)d.length>0&&d[d.length-1]===u[p].identifier?d.pop():d.push(u[p].identifier),p++;if(d.push(e.identifier),"evenodd"===o){let t=d.length%2==0,r=d[d.length-2];return{identifier:e.identifier,isHole:t,for:r}}if("nonzero"===o){let r=!0,n=null,i=null;for(let e=0;e<d.length;e++){let o=d[e];t[o]&&(r?(i=t[o].isCW,r=!1,n=o):i!==t[o].isCW&&(i=t[o].isCW,r=!0))}return{identifier:e.identifier,isHole:r,for:n}}}(e,m,p,f,null==(t=this.userData)?void 0:t.style.fillRule)})),g=[];return m.forEach((e=>{let t=v[e.identifier];if(t&&!t.isHole){let t=new q;t.curves=e.curves,v.filter((t=>(null==t?void 0:t.isHole)&&t.for===e.identifier)).forEach((e=>{if(e){let r=m[e.identifier],n=new V;n.curves=r.curves,t.holes.push(n)}})),g.push(t)}})),g}},u=(e.advanceWidth??1)*t;if(e)for(let n of s.commands){let e=null==(a=l.currentPath)?void 0:a.currentPoint;if(!e||"Z"===n.type||e.x!==n.x||-e.y!==n.y)switch(n.type){case"M":l.moveTo(n.x,-n.y);break;case"L":l.lineTo(n.x,-n.y);break;case"Q":l.quadraticCurveTo(n.x1,-n.y1,n.x,-n.y);break;case"C":l.bezierCurveTo(n.x1,-n.y1,n.x2,-n.y2,n.x,-n.y)}}return l.subPaths.forEach((e=>{let t=function(e){if(e.length){let t=e[0];if(t instanceof S)return t.v1;if(t instanceof O||t instanceof T)return t.v0}}(e.curves);void 0!==t&&e.currentPoint.distanceTo(t)>0&&e.lineTo(t.x,t.y)})),{offsetX:u+o.fontSize*o.letterSpacing,path:l}}getCharWidth(e,t){var r;return(null==(r=this.font)?void 0:r.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var r;return(null==(r=this.font)?void 0:r.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,r){let n=this.getCharWidth(" ",r),i=e[t];if(i){let o=this.countSpaces(i.trimEnd());if(4===r.horizontalAlign&&t<e.length-1&&o)return(r.width-(this.getTextWidth(i,r)-o*n))/o}return n}countSpaces(e){return(e.match(/ /g)||[]).length}}(t),this.fonts[e].loadingPromise.then((()=>this.requestRender()))}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach((e=>this.deleteMaterial(e))),this._requestRender=void 0,Object.values(this.audios).forEach((e=>{e instanceof um&&e.dispose()})),this.audios={},this.geometryCache.dispose(),this.geometryCache2.dispose()}},wm=new xm(eu.emptyData()),_m=class extends Wd{updateByPatchedOp(e,t,r){if(super.updateByPatchedOp(e,t,r),null!==function(e,t){let r=[];if(t.length!==e.length)return null;for(var n=0;n<e.length;){if("*"===t[n])r.push(e[n]);else if(e[n]!==t[n])return null;n+=1}return r}(e.path,["materials"])&&0===e.type&&Array.isArray(this.material))for(let[n,i]of Object.entries(e.props)){let e=r.shared.material(i);this.material[Number(n)]=e}else if(Sa(e.path,["material"])&&this.material instanceof tm)"material"in t&&"string"!=typeof t.material&&this.material.updateByOp(Xo.drop(e,1),t.material,r);else if(Sa(e.path,["materials","*"])&&Array.isArray(this.material)){let n=e.path[1];if("materials"in t&&n<this.material.length){let i=t.materials[n];"string"!=typeof i&&this.material[n].updateByOp(Xo.drop(e,2),i,r)}}}get needsAO(){return void 0!==this.material&&(Array.isArray(this.material)?this.material[0]:this.material).hasAO}updateState(e,t){var r,n,i,o,a;super.updateState(e,t),void 0!==e.castShadow&&(this.castShadow=e.castShadow),void 0!==e.receiveShadow&&(this.receiveShadow=e.receiveShadow);let s=this.dataPatched;if("NonParametricGeometry"!==(null==(r=e.geometry)?void 0:r.type)&&"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(s.flatShading,s.side,s.wireframe),null==(n=t.scene)||n.markNeedsUpdateRendererDirty()),"NonParametricGeometry"===(null==(i=e.geometry)?void 0:i.type)&&("materials"in e&&void 0!==e.materials?(this.disposeMaterial(),this.material=e.materials.map((e=>t.shared.material(e).getFlavor(s.flatShading,s.side,s.wireframe))),null==(o=t.scene)||o.markNeedsUpdateRendererDirty()):"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(s.flatShading,s.side,s.wireframe)],null==(a=t.scene)||a.markNeedsUpdateRendererDirty())),void 0!==e.flatShading||void 0!==e.wireframe||void 0!==e.side)if(Array.isArray(this.material))for(let l=0;l<this.material.length;l++)this.material[l]=this.material[l].getFlavor(s.flatShading,s.side,s.wireframe);else this.material=this.material.getFlavor(s.flatShading,s.side,s.wireframe)}disposeMaterial(){this.material&&He(this.material).forEach((e=>{e instanceof tm&&(e instanceof im||e.nodeMaterialDispose())}))}dispose(){this.disposeMaterial(),super.dispose()}},Sm=class extends _m{constructor(e,t,r){super(e,t),this.data=t,this.localGeometry=void 0}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof s&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(void 0!==this.localGeometry)return this.localGeometry;if(this.geometryCreateDeleyed instanceof xm){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return kl.is2DParametricMesh(e.type)&&0===e.depth}get is2DType(){return kl.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return"NonParametricGeometry"===this.geometry.userData.type}updateByPatchedOp(e,t,r){super.updateByPatchedOp(e,t,r),Sa(e.path,["geometry"])&&this.updateByPatchedOpGeometry(Xo.drop(e,1),t.geometry,r)}removeInteractionGeometry(){var e;null==(e=this.localGeometry)||e.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var r;this.invalidateDownstreamBooleanData();let n=this.data.geometry.type;if("NonParametricGeometry"===n||"SubdivGeometry"===n){let r,n,i,o=e;if(void 0===this.localGeometry){let e={...this.data.geometry,...o};this.localGeometry=cd(e,t,this.data.flatShading)}o.scaleBaked?[r,n,i]=o.scaleBaked:({width:r,height:n,depth:i}=o);let a=this.localGeometry.userData;void 0!==a.sxPrev&&dd(this.localGeometry.attributes,r/a.sxPrev,n/a.syPrev,i/a.szPrev),a.sxPrev=r,a.syPrev=n,a.szPrev=i}else{let n={...this.data.geometry,...e};null==(r=this.localGeometry)||r.dispose(),this.localGeometry=cd(n,t,this.data.flatShading)}}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand((()=>t.updateShape()))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,r){var n;let i=!1;0===e.type&&0===e.path.length&&So(["scaleBaked"],Object.keys(e.props))&&this.geometryCreateDeleyed instanceof bd&&this.chooseGeoemtryCache(r.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(i=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(r),this.refreshAttachedPaths(r)),i||(null==(n=r.scene)||n.markGeometryCacheDirty(),this.createGeometryDelayed(r)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){void 0!==e.geometry&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&0===this.geometry.groups.length&&this.geometry.addGroup(0,Math.max((null==(e=this.geometry.getIndex())?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let r=this.geometry.userData.parameters;this.is2DType?e.set(0,0,.5*r.depth):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(r.width,r.height,r.depth??0).multiplyScalar(.5)):e.setScalar(0),t.set(r.width,r.height,r.depth??0).multiplyScalar(.5)}};function Om(e){if(Array.isArray(e.material)){for(let t of e.material)if(0===t.getLayersOfType("outline").length)return}else if(!(e.material instanceof tm)||0===e.material.getLayersOfType("outline").length)return;e instanceof Sm&&e.is2DAndNoDepth?function(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,n=new Float32Array(t.length),i=new r;for(let r=0;r<t.length;r+=3)i.set(t[r],t[r+1],t[r+2]).normalize(),n[r]=i.x,n[r+1]=i.y,n[r+2]=i.z;e.geometry.setAttribute("extrudeNormal",new f(n,3))}(e):function(e){var t,n;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let i=new Map,o=e.geometry.attributes,a=o.position.array,s=o.normal.array,l=new Float32Array(a.length);for(let u=0;u<a.length;u+=3){let e=`${a[u]}_${a[u+1]}_${a[u+2]}`,n=new r(s[u],s[u+1],s[u+2]);i.has(e)?null==(t=i.get(e))||t.normals.push(n):i.set(e,{normals:[n],result:new r})}i.forEach(((e,t)=>{for(let r of e.normals)e.result.add(r);e.result.divideScalar(e.normals.length)}));for(let r=0;r<a.length;r+=3){let e=`${a[r]}_${a[r+1]}_${a[r+2]}`,t=null==(n=i.get(e))?void 0:n.result;t&&(l[r]=t.x,l[r+1]=t.y,l[r+2]=t.z)}e.geometry.setAttribute("extrudeNormal",new f(l,3))}(e)}function Tm(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,r=new Float32Array(t.length),n=parseInt(e.uuid.replace(/\D/g,"")),i=[b.seededRandom(n),b.seededRandom(n+1e4),b.seededRandom(n+2e4)];for(let o=0;o<t.length;o++)r[o]=i[o%3];e.geometry.setAttribute("randomColor",new p(r,3))}sd.then((e=>{}));var Em=new a,Cm=new r;function Am(e){let t=!1;return e.scene.objects.traverse(((e,r)=>{"Mesh"===r.type&&"SubdivGeometry"===r.geometry.type&&(t=!0)})),t}var Mm=class extends Sm{constructor(e,r,n){super(e,r,n),this.data=r,this.hiddenMatrixOld=new t,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return void 0!==this.localGeometry?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return void 0!==this.localGeometry?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let r=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(r.width,r.height,r.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var t,r,n;if(!0===this.skipReactionUpdate)return;let i=null==(t=this.localGeometry)?void 0:t.uuid,{originalGeometry:o,subdividedGeometry:a,subdivPointer:s}=bd.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=s,void 0!==o&&(null==(r=this.originalGeometry)||r.dispose(),this.originalGeometry=o),void 0!==a&&(null==(n=this.subdividedGeometry)||n.dispose(),this.subdividedGeometry=a??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,Om(this),Tm(this),this.calcBoundingBox(),i&&(this.localGeometry.uuid=i)}updateState(e,t){if(super.updateState(e,t),void 0!==e.flatShading){let r=this.material;this.material=r.getFlavor(!1,r.side,r.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){bd.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&bd.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=bd.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=bd.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let r=this.localGeometry;this.localGeometry=this.originalGeometryNew,Wd.prototype.raycast.call(this,e,t),this.localGeometry=r}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new c,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,r=e.boundingSphere.center;Em.setFromBufferAttribute(t),Em.getCenter(r),e.boundingSphere.radius=r.distanceTo(Em.max),isNaN(e.boundingSphere.radius),Em.getSize(Cm),this.hasNonUniformScale&&Cm.divide(this.scale);let n={width:Cm.x,height:Cm.y,depth:Cm.z};return this.geometry.userData.parameters=n,n}updateBoundingSphere(e){let t=this.originalGeometry;Em.min.set(e[0],e[2],e[4]),Em.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(Em.min.applyMatrix4(this.shearScaleInv),Em.max.applyMatrix4(this.shearScaleInv)),null===t.boundingSphere&&(t.boundingSphere=new c);let r=t.boundingSphere.center;Em.getCenter(r),t.boundingSphere.radius=r.distanceTo(Em.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(bd.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,null==(e=this.originalGeometry)||e.dispose(),null==(t=this.subdividedGeometry)||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,r){super.updateByPatchedOpGeometry(e,t,r),this.localGeometry&&this.createGeometryByControls(t)}},Dm={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},Pm={polygon_center:0,edge:1,vertex:2},km=(e,t)=>(r,n)=>t&&0!==r&&0!==e?e*n/100:0,Lm=(e,t)=>{let r=Math.abs(t),n=-1*r;return(e- -1)*(r-n)/2+n};var Um=new r,Im=new r,zm=new r,Rm=new r;function Nm(e,t){let r=zm.fromArray(e),n=Rm.fromArray(t);Im.copy(n).sub(r);let i=Im.length();return Im.normalize().multiplyScalar(.5*i),Um.copy(r).add(Im).toArray()}var Bm=new e,Fm=new r,jm=new r,Gm=new r;var Vm=e=>.5*(1-Math.cos(e*Math.PI)),Hm=class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,r=0){if(null==this.perlin){this.perlin=new Array(4096);for(let e=0;e<4096;e++)this.perlin[e]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),r<0&&(r=-r);let n,i,o,a,s,l=Math.floor(e),u=Math.floor(t),c=Math.floor(r),h=e-l,d=t-u,p=r-c,f=0,m=.5;for(let v=0;v<4;v++){let e=l+(u<<4)+(c<<8);n=Vm(h),i=Vm(d),o=this.perlin[4095&e],o+=n*(this.perlin[e+1&4095]-o),a=this.perlin[e+16&4095],a+=n*(this.perlin[e+16+1&4095]-a),o+=i*(a-o),e+=256,a=this.perlin[4095&e],a+=n*(this.perlin[e+1&4095]-a),s=this.perlin[e+16&4095],s+=n*(this.perlin[e+16+1&4095]-s),a+=i*(s-a),o+=Vm(p)*(a-o),f+=o*m,m*=.5,l<<=1,h*=2,u<<=1,d*=2,c<<=1,p*=2,h>=1&&(l++,h--),d>=1&&(u++,d--),p>=1&&(c++,p--)}return f}noiseSeed(e){let t=(()=>{let e,t;return{setSeed(r){t=e=(r??4294967296*Math.random())>>>0},getSeed:()=>e,rand:()=>(t=(1664525*t+1013904223)%4294967296,t/4294967296)}})();t.setSeed(e),this.perlin=new Array(4096);for(let r=0;r<4096;r++)this.perlin[r]=t.rand()}},Wm=new r,qm=new t,$m=new u;function Xm(e){let t=!1;return e.scene.objects.traverse(((e,r)=>{"Mesh"===r.type&&"TextGeometry"===r.geometry.type&&(t=!0)})),t}var Ym,Zm,Km,Qm,Jm=class extends Sm{constructor(e,t,r){super(e,t,r),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var e;let t=this.dataPatched;return(null==(e=this.font)?void 0:e.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,t.geometry.height,this.fontScale,t.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return((null==(e=this.font)?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return((null==(e=this.font)?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:r}=this;if(!isNaN(e.ray.origin.x)&&0!==this.scale.x&&0!==this.scale.y&&0!==this.scale.z&&(qm.copy(r).invert(),$m.copy(e.ray).applyMatrix4(qm),$m.intersectBox(this.singleBBox,Wm))){let n=Wm.applyMatrix4(r),i=e.ray.origin.distanceTo(n);t.push({distance:i,point:n.clone(),object:this})}}},ev=1e-4,tv=new r,rv=new r;sd.then((e=>{Zm=[(Ym=e).get_face_center,Ym.get_edge_midpoint,Ym.get_vertex_position],Km=[Ym.get_face_normal,Ym.get_edge_normal,Ym.get_vertex_normal],Qm=[Ym.face_count,Ym.edge_count,Ym.vertex_count]}));var nv=new t,iv=new t,ov=new r,av=new r,sv=new r,lv=new r,uv=new r,cv=new r,hv=new Hm,dv=class extends(Lu(o)){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(null===this.parent)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof Iu&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse((t=>{t instanceof Iu&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)}))}onObjUpdateMatrix(){"toObject"!==this.parameters.type&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(t=void 0!==e?e:"grid"===this.parameters.type?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,"toObject"===this.parameters.type&&!this.parameters.toObject.object&&(t=0),"toObject"===this.parameters.type&&this.objectForSample){for(let t=0,r=this.children.length;t<r;++t)this.remove(this.children[0]);let e=this.children;if(e.length===t)return;if(e.length<t)for(let r=0,n=t-e.length;r<n;++r){let e=new Iu(this.object);e.expand(),this.add(e)}else for(let r=0,n=e.length-t;r<n;++r)this.remove(e[r])}else{if(this.children.length===t)return;if(this.children.length<t)for(let e=0,r=t-this.children.length;e<r;++e){let e=new Iu(this.object);e.expand(),this.add(e)}else for(let e=0,r=this.children.length-t;e<r;++e)this.remove(this.children[0])}}_updateRadial(e){let t,n=e.radial,i=n.start*b.DEG2RAD,o=i-n.end*b.DEG2RAD,a=new ee(n.rotation[0],n.rotation[1],n.rotation[2]);switch(n.axis){case"z":t=new r(0,0,1);break;case"y":t=new r(0,1,0);break;default:t=new r(1,0,0)}let s=e.randomnessObject??il.defaultData([1,1,1]).randomnessObject,l="perlin"===s.noiseType;hv.noiseSeed(s.seed);let u=Ou((0,gu.default)(s.seed)),c=km(s.strength,this.parameters.randomness);for(let[r,h]of this.children.entries()){let d=r*(s.freqScale/10)+s.movement,p=l?hv.noise(d):u(d,d);h.scale.x=n.scale[0]+c(r,Lm(p,s.scale[0]))||ev,h.scale.y=n.scale[1]+c(r,Lm(p,s.scale[1]))||ev,h.scale.z=n.scale[2]+c(r,Lm(p,s.scale[2]))||ev,h.position.setScalar(0);let f=o/e.count*r-i;switch(n.axis){case"x":h.rotation.set(0,f,0);break;case"y":h.rotation.set(0,0,f);break;case"z":h.rotation.set(f,0,0)}h.translateOnAxis(t,n.radius),h.position.x+=n.position[0]+c(r,Lm(p,s.position[0])),h.position.y+=n.position[1]+c(r,Lm(p,s.position[1])),h.position.z+=n.position[2]+c(r,Lm(p,s.position[2]));let m=c(r,Lm(p,s.rotation[0])),v=c(r,Lm(p,s.rotation[1])),g=c(r,Lm(p,s.rotation[2]));!0===n.alignment?(h.rotation.x+=a.x+m,h.rotation.y+=a.y+v,h.rotation.z+=a.z+g):h.rotation.set(a.x+m,a.y+v,a.z+g)}}_updateLinear(e){if("linear"!==e.type)throw new Error;let t=e.linear,r=new ee(t.rotation[0],t.rotation[1],t.rotation[2]),n=e.randomnessObject??il.defaultData([1,1,1]).randomnessObject,i="perlin"===n.noiseType;hv.noiseSeed(n.seed);let o=Ou((0,gu.default)(n.seed)),a=km(n.strength,this.parameters.randomness);for(let[s,l]of this.children.entries()){let e=s*(n.freqScale/10)+n.movement,u=i?hv.noise(e):o(e,e),c=a(s,Lm(u,n.rotation[0])),h=a(s,Lm(u,n.rotation[1])),d=a(s,Lm(u,n.rotation[2]));l.scale.x=1+(t.scale[0]-1)*s+a(s,Lm(u,n.scale[0]))||ev,l.scale.y=1+(t.scale[1]-1)*s+a(s,Lm(u,n.scale[1]))||ev,l.scale.z=1+(t.scale[2]-1)*s+a(s,Lm(u,n.scale[2]))||ev,l.rotation.x=r.x*s+c,l.rotation.y=r.y*s+h,l.rotation.z=r.z*s+d,l.position.x=t.position[0]*s+a(s,Lm(u,n.position[0])),l.position.y=t.position[1]*s+a(s,Lm(u,n.position[1])),l.position.z=t.position[2]*s+a(s,Lm(u,n.position[2]))}}_updateGrid(e){let t=0,n=e.grid,i=e.randomnessObject??il.defaultData([1,1,1]).randomnessObject,o=km(i.strength,this.parameters.randomness),a="perlin"===i.noiseType;hv.noiseSeed(i.seed);let s=function(e=Math.random){let t=Tu(e),r=new Float64Array(t).map((e=>Su[e%12*3])),n=new Float64Array(t).map((e=>Su[e%12*3+1])),i=new Float64Array(t).map((e=>Su[e%12*3+2]));return function(e,o,a){let s,l,u,c,h,d,p,f,m,v,g=.3333333333333333*(e+o+a),y=wu(e+g),b=wu(o+g),x=wu(a+g),w=(y+b+x)*xu,_=e-(y-w),S=o-(b-w),O=a-(x-w);_>=S?S>=O?(h=1,d=0,p=0,f=1,m=1,v=0):_>=O?(h=1,d=0,p=0,f=1,m=0,v=1):(h=0,d=0,p=1,f=1,m=0,v=1):S<O?(h=0,d=0,p=1,f=0,m=1,v=1):_<O?(h=0,d=1,p=0,f=0,m=1,v=1):(h=0,d=1,p=0,f=1,m=1,v=0);let T=_-h+xu,E=S-d+xu,C=O-p+xu,A=_-f+2*xu,M=S-m+2*xu,D=O-v+2*xu,P=_-1+.5,k=S-1+.5,L=O-1+.5,U=255&y,I=255&b,z=255&x,R=.6-_*_-S*S-O*O;if(R<0)s=0;else{let e=U+t[I+t[z]];R*=R,s=R*R*(r[e]*_+n[e]*S+i[e]*O)}let N=.6-T*T-E*E-C*C;if(N<0)l=0;else{let e=U+h+t[I+d+t[z+p]];N*=N,l=N*N*(r[e]*T+n[e]*E+i[e]*C)}let B=.6-A*A-M*M-D*D;if(B<0)u=0;else{let e=U+f+t[I+m+t[z+v]];B*=B,u=B*B*(r[e]*A+n[e]*M+i[e]*D)}let F=.6-P*P-k*k-L*L;if(F<0)c=0;else{let e=U+1+t[I+1+t[z+1]];F*=F,c=F*F*(r[e]*P+n[e]*k+i[e]*L)}return 32*(s+l+u+c)}}((0,gu.default)(i.seed));if(!0===n.useCenter){let e={x:n.count[0]%2==0?2:1,y:n.count[1]%2==0?2:1,z:n.count[2]%2==0?2:1},l=new r(n.size[0]*(n.count[0]-e.x)*.5,n.size[1]*(n.count[1]-e.y)*.5,n.size[2]*(n.count[2]-e.z)*.5);for(let r=0;r<n.count[0];r++)for(let e=0;e<n.count[1];e++)for(let u=0;u<n.count[2];u++){let c=[(r+1)*(i.freqScale/10)+i.movement,(e+1)*(i.freqScale/10)+i.movement,(u+1)*(i.freqScale/10)+i.movement],h=a?hv.noise(...c):s(...c),d=this.children[t++];d.scale.x=1+o(t,Lm(h,i.scale[0]))||ev,d.scale.y=1+o(t,Lm(h,i.scale[1]))||ev,d.scale.z=1+o(t,Lm(h,i.scale[2]))||ev;let p=o(t,Lm(h,i.rotation[0])),f=o(t,Lm(h,i.rotation[1])),m=o(t,Lm(h,i.rotation[2]));d.rotation.set(p,f,m),d.position.x=n.size[0]*r-l.x+o(t,Lm(h,i.position[0])),d.position.y=n.size[1]*e-l.y+o(t,Lm(h,i.position[1])),d.position.z=n.size[2]*u-l.z+o(t,Lm(h,i.position[2]))}}else for(let r=0;r<n.count[0];r++)for(let e=0;e<n.count[1];e++)for(let l=0;l<n.count[2];l++){let u=[(r+1)*(i.freqScale/10)+i.movement,(e+1)*(i.freqScale/10)+i.movement,(l+1)*(i.freqScale/10)+i.movement],c=a?hv.noise(...u):s(...u),h=this.children[t++];h.scale.x=1+o(t,Lm(c,i.scale[0]))||ev,h.scale.y=1+o(t,Lm(c,i.scale[1]))||ev,h.scale.z=1+o(t,Lm(c,i.scale[2]))||ev;let d=o(t,Lm(c,i.rotation[0])),p=o(t,Lm(c,i.rotation[1])),f=o(t,Lm(c,i.rotation[2]));h.rotation.set(d,p,f),h.position.x=n.size[0]*r+o(t,Lm(c,i.position[0])),h.position.y=-n.size[1]*e+o(t,Lm(c,i.position[1])),h.position.z=-n.size[2]*l+o(t,Lm(c,i.position[2]))}}_updateToObject(e){var n;if("toObject"!==e.type)throw new Error;let{toObject:i}=e,o=new ee(i.rotation[0],i.rotation[1],i.rotation[2]),a=e.randomnessObject??il.defaultData([1,1,1]).randomnessObject,s="perlin"===a.noiseType;hv.noiseSeed(a.seed);let l=Ou((0,gu.default)(a.seed)),u=km(a.strength,this.parameters.randomness);if(!i.object){for(let[,e]of this.children.entries())e.position.set(0,0,0),e.scale.setScalar(1),e.rotation.set(0,0,0);return void(this.objectForSample=void 0)}if(!this.objectForSample)return;if(this.objectForSample instanceof Jm){if(!(null==(n=this.objectForSample.font)?void 0:n.isLoaded)||void 0===this.objectForSample.geometry.attributes.position)return void(this._pendingMediaLoad=!0);this._pendingMediaLoad=!1}if(void 0===this.objectForSample.geometry&&this.objectForSample.isAncestorOf(this.object.uuid))return;let c=this.getSubdivData(),h=[],d=e=>{let t=e.length;return[e.map((e=>e[0])).reduce(((e,t)=>e+t),0)/t,e.map((e=>e[1])).reduce(((e,t)=>e+t),0)/t,e.map((e=>e[2])).reduce(((e,t)=>e+t),0)/t]},p=e=>Math.round(1e6*e)/1e6;c.forEach((e=>{let t=c.filter((t=>p(e.pos[0])===p(t.pos[0])&&p(e.pos[1])===p(t.pos[1])&&p(e.pos[2])===p(t.pos[2])));t.length>1?h.push({pos:e.pos,norm:d(t.map((e=>e.norm)))}):h.push(e)}));let f=function(e){let t=[],r={};for(var n=0,i=e.length;n<i;n++){var o=JSON.stringify(e[n].pos.map((e=>Math.round(1e4*e)/1e4)));r[o]||(t.push(e[n]),r[o]=!0)}return t}(h);if(c.length>0){let e=Math.round(f.length*i.count/100);this._updateCount(e)}this.objectForSample.updateMatrixWorld();let m=new class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let r=1;Cu.a.fromBufferAttribute(e,n),Cu.b.fromBufferAttribute(e,n+1),Cu.c.fromBufferAttribute(e,n+2),r*=Cu.getArea(),t[n/3]=r}this.distribution=new Float32Array(e.count/3);let r=0;for(let n=0;n<t.length;n++)r+=t[n],this.distribution[n]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let r=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*r);return this.sampleFace(n,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,r=0,n=t.length-1,i=-1;for(;r<=n;){let o=Math.ceil((r+n)/2);if(0===o||t[o-1]<=e&&t[o]>e){i=o;break}e<t[o]?n=o-1:r=o+1}return i}sampleFace(e,t,r){let n=this.randomFunction(),i=this.randomFunction();return n+i>1&&(n=1-n,i=1-i),Cu.a.fromBufferAttribute(this.positionAttribute,3*e),Cu.b.fromBufferAttribute(this.positionAttribute,3*e+1),Cu.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(Cu.a,n).addScaledVector(Cu.b,i).addScaledVector(Cu.c,1-(n+i)),Cu.getNormal(r),this}}(this.objectForSample).build(),v=Dm[i.axis],g=this.children;m.setRandomGenerator((0,gu.default)(this.object.uuid+i.seed));for(let[y,b]of g.entries()){let e=y*(a.freqScale/10)+a.movement,n=s?hv.noise(e):l(e,e),c=u(y,Lm(n,a.rotation[0])),h=u(y,Lm(n,a.rotation[1])),d=u(y,Lm(n,a.rotation[2]));"random"===i.spreadType?m.sample(sv,lv):(f.length&&(sv.fromArray(f[y].pos),lv.fromArray(f[y].norm)),this.objectForSample instanceof Mm&&sv.applyMatrix4(nv.copy(this.objectForSample.matrixWorld).invert())),sv.applyMatrix4(this.object.hiddenMatrix.clone().invert()),b.position.copy(sv),ov.fromArray(v);let p="normal"===i.align?lv:this.object.getWorldDirection(cv),g=av.fromArray(i.position);av.x+=av.x+u(y,Lm(n,a.position[0])),av.y+=av.y+u(y,Lm(n,a.position[1])),av.z+=av.z+u(y,Lm(n,a.position[2]));let x=Math.acos(p.dot(ov)),w=uv.crossVectors(ov,p).normalize(),_=iv.makeRotationAxis(w,x),S=p.clone().cross(this.object.up).normalize(),O=S.clone().cross(p).normalize(),T=(new t).makeBasis(S,p,O),E=new r(ov.y,ov.z,ov.x).normalize(),C=E.clone().cross(ov).normalize(),A=(new t).makeBasis(E,ov,C).invert(),M=(new t).multiplyMatrices(T,A);b.rotation.setFromRotationMatrix(M),g.applyMatrix4(_),b.position.add(g),b.rotation.x=b.rotation.x+o.x+c,b.rotation.y=b.rotation.y+o.y+h,b.rotation.z=b.rotation.z+o.z+d,b.scale.setScalar(1),b.scale.x=b.scale.x+i.scale[0]+u(y,Lm(n,a.scale[0]))||ev,b.scale.y=b.scale.y+i.scale[1]+u(y,Lm(n,a.scale[1]))||ev,b.scale.z=b.scale.z+i.scale[2]+u(y,Lm(n,a.scale[2]))||ev,b.scale.multiply(this.object.scale),b.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if("random"===e)return[];if(this.objectForSample instanceof Mm){let t=this.objectForSample,r=Pm[e],n=Qm[r],i=Zm[r],o=Km[r],a=[],s=n(t.subdivPointerNew);for(let e=0;e<=s-1;e++){let r=i(t.subdivPointerNew,e),n=o(t.subdivPointerNew,e);tv.fromArray(r).applyMatrix4(t.matrixWorld),rv.fromArray(n),a.push({pos:tv.toArray(),norm:rv.toArray()})}return a}return(this.objectForSample.geometry.index?function(e){let t=[];for(let r=0;r<=e.index.count;r++)if(Fm.fromArray(e.index.array,3*r),Bm.setFromAttributeAndIndices(e.attributes.position,Fm.x,Fm.y,Fm.z),Bm.getNormal(jm),Bm.getMidpoint(Gm),!(isNaN(Gm.x)||isNaN(Gm.y)||isNaN(Gm.z))){let{a:e,b:r,c:n}=Bm,i=e.toArray(),o=r.toArray(),a=n.toArray(),s=e.distanceTo(r),l=r.distanceTo(n),u=n.distanceTo(e),c=Nm(i,o),h=Nm(o,a),d=Nm(a,i),p=[s,l,u],f=Math.max(...p),m=p.filter((e=>Math.round(e)===Math.round(f))).length>1,v=[],g=Bm.getMidpoint(Gm).toArray();f===s&&!m&&(v=[h,d,d],g=c),f===l&&!m&&(v=[c,d,d],g=h),f===u&&!m&&(v=[c,h,h],g=d),m&&(v=[c,h,d]),t.push({vertices:[i,o,a],faceCenters:v,midpoint:g,norm:Bm.getNormal(jm).toArray()})}return t}(this.objectForSample.geometry):function(e){let t=[],{position:r}=e.attributes;for(let n=0;n<r.count;n++){Bm.setFromAttributeAndIndices(r,3*n,3*n+1,3*n+2),Bm.getNormal(jm),Bm.getMidpoint(Gm);let e=Bm.a.toArray(),i=Bm.b.toArray(),o=Bm.c.toArray();t.push({vertices:[e,i,o],faceCenters:[Nm(e,i),Nm(i,o),Nm(o,e)],midpoint:Gm.toArray(),norm:jm.toArray()})}return t}(this.objectForSample.geometry)).map(((t,r)=>"polygon_center"===e?{pos:t.midpoint,norm:t.norm}:"vertex"===e?[{pos:t.vertices[0],norm:t.norm},{pos:t.vertices[1],norm:t.norm},{pos:t.vertices[2],norm:t.norm}]:"edge"===e?[{pos:t.faceCenters[0],norm:t.norm},{pos:t.faceCenters[1],norm:t.norm},{pos:t.faceCenters[2],norm:t.norm}]:[])).flat()}updateState(e,r){var n;if(this.parameters=Zi(e),"toObject"!==this.parameters.type)(null===this.parent||this.parent!==this.object)&&(this.removeFromParent(),null==(n=this.object.parent)||n.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(null===this.parent||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let e=r.find(this.parameters.toObject.object);this.objectForSample=e instanceof Wd?e:void 0,this.matrix=new t,this.hiddenMatrix=new t,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,e&&e.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},pv=e=>{var t;return(t=class extends e{}).geometryHelper=new v(30,30,30),t},fv=new u,mv=new c,vv=new t,gv=(e,t,n,i,o=!1)=>{let a=t,s=e.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),mv.copy(a.boundingSphere),mv.applyMatrix4(s),!1===n.ray.intersectsSphere(mv)||(vv.copy(s).invert(),fv.copy(n.ray).applyMatrix4(vv),null!==a.boundingBox&&!1===fv.intersectsBox(a.boundingBox)))return;let l,u,c,h,d,p,f=a.index,m=a.attributes.position,v=a.drawRange;if(!1===o){for(d=Math.max(0,v.start),p=Math.min(f.count,v.start+v.count);d<p;d+=3)if(u=f.getX(d),c=f.getX(d+1),h=f.getX(d+2),l=g(e,n,fv,m,u,c,h),l)return l.faceIndex=Math.floor(d/3),void i.push(l)}else{let t=a.attributes.position,o=new r,s=new r,l=new r,u=new r,c=2,h=1/((e.scale.x+e.scale.y+e.scale.z)/3),d=h*h;for(let r=Math.max(0,v.start),a=Math.min(t.count,v.start+v.count)-1;r<a;r+=c){if(o.fromBufferAttribute(t,r),s.fromBufferAttribute(t,r+1),fv.distanceSqToSegment(o,s,u,l)>d)continue;u.applyMatrix4(e.matrixWorld);let a=n.ray.origin.distanceTo(u);a<n.near||a>n.far||i.push({distance:a,point:l.clone().applyMatrix4(e.matrixWorld),object:e})}}function g(e,t,n,i,o,a,s){let l=new r,u=new r,c=new r,h=new r,d=new r;if(l.fromBufferAttribute(i,o),u.fromBufferAttribute(i,a),c.fromBufferAttribute(i,s),null===n.intersectTriangle(l,u,c,!1,h))return null;d.copy(h),d.applyMatrix4(e.matrixWorld);let p=t.ray.origin.distanceTo(d);return p<t.near||p>t.far?null:{faceIndex:1,distance:p,point:d.clone(),object:e}}},yv=new r,bv=new h,xv=class extends ${constructor(e){let t=new s,r=new X({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],i=[],o={},a=new w(15711266),l=new w(15711266),u=new w(2857471);function c(e,t,r){h(e,r),h(t,r)}function h(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(n.length/3-1)}c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",l),c("p","n2",l),c("p","n3",l),c("p","n4",l),c("u1","u2",u),c("u2","u3",u),c("u3","u1",u),t.setAttribute("position",new f(n,3)),t.setAttribute("color",new f(i,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){let e=this.geometry,t=this.pointMap;bv.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let r=.8;wv("n1",t,e,bv,-1,-1,r),wv("n2",t,e,bv,1,-1,r),wv("n3",t,e,bv,-1,1,r),wv("n4",t,e,bv,1,1,r);let n=r;wv("f1",t,e,bv,-1,-1,n),wv("f2",t,e,bv,1,-1,n),wv("f3",t,e,bv,-1,1,n),wv("f4",t,e,bv,1,1,n);wv("u1",t,e,bv,.35,1.1,.8),wv("u2",t,e,bv,-.35,1.1,.8),wv("u3",t,e,bv,0,1.55,.8),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function wv(e,t,r,n,i,o,a){yv.set(i,o,a).unproject(n);let s=t[e];if(void 0!==s){let e=r.getAttribute("position");for(let t=0,r=s.length;t<r;t++)e.setXYZ(s[t],yv.x,yv.y,yv.z)}}var _v,Sv=class extends(pv(xv)){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){gv(this.object,this.geometry,e,t,!0)}};(_v||(_v={})).is=e=>"objectHelper"in e;var Ov,Tv=(e,t)=>class extends(Qu(e)){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(e,t){this.objectHelper.raycast(e,t)}showGizmos(){for(let e in this.gizmos){let t=this.gizmos[e];t instanceof te&&(t.visible=!0)}}updateEntityBoxSize(e,t){this.objectHelper.visible&&this.geometryHelper instanceof v?(e.setScalar(0),t.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(e,t)}hideGizmos(){for(let e in this.gizmos){let t=this.gizmos[e];t instanceof te&&(t.visible=!1)}}},Ev=new r,Cv=new r,Av=new re,Mv=new r,Dv=new r,Pv=new r,kv=class extends(Tv(h,Sv)){constructor(e="",r={...Gl.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=nl.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,r),this.previousProjectionMatrix=new t,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let n=this.width,i=this.height;if(r.orthographic.autoZoom){let e=r.orthographic.autoZoomFrustumSize??790,t=n/i,o=n>i?t:1,a=n>i?1:t;this.orthoCamera=new Y(.5*-e*o,.5*e*o,.5*e*(1/a),.5*-e*(1/a),-5e4,1e4)}else this.orthoCamera=new Y(-.5*n,.5*n,.5*i,-.5*i,-5e4,1e4);this.perspCamera=new Z(45,n/i,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return"PerspectiveCamera"===this.cameraType}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){"PerspectiveCamera"===e?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&("PerspectiveCamera"===e?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){"PerspectiveCamera"===e?this.toPerspective():"OrthographicCamera"===e&&this.toOrthographic()}get near(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near}set near(e){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,n){"number"==typeof e&&(e=new r(e,t,n)),super.lookAt(e),this.getWorldPosition(Ev),this.targetOffset=Ev.distanceTo(e)}getTarget(e=new r){return this.getWorldDirection(Cv),this.getWorldPosition(Ev),Cv.multiplyScalar(this.targetOffset),e.copy(Ev).add(Cv),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(Ev),Ev.distanceTo(e)}updateUp(){this.getWorldQuaternion(Av),Mv.set(0,0,1).applyQuaternion(Av),Dv.copy(o.DEFAULT_UP),this.isUpVectorFlipped&&Dv.negate(),Dv.applyQuaternion(Av),Pv.copy(o.DEFAULT_UP).projectOnPlane(Mv),this.angleOffsetFromUp=Pv.angleTo(Dv),this.angleOffsetFromUp*=Pv.cross(Dv).dot(Mv)>=0?1:-1}updateTransformState(e){let t=super.updateTransformState(e);return void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),t}getViewFrontToObject(e){let t=e.getWorldPosition(new r),n=e.getWorldDirection(new r).multiplyScalar(this.targetOffset);return{position:t.clone().add(n),target:t}}getViewToObject(e){let t=e.getWorldPosition(new r),n=this.getWorldDirection(new r).multiplyScalar(this.targetOffset);return{position:t.clone().sub(n),target:t}}setViewplaneSize(e,t){if(this.aspect=e/t,"OrthographicCamera"===this.data.type&&this.data.orthographic.autoZoom){let r=this.data.orthographic.autoZoomFrustumSize??790,n=e>t?this.aspect:1,i=e>t?1:this.aspect;this.left=.5*-r*n,this.right=.5*r*n,this.top=.5*r*(1/i),this.bottom=.5*-r*(1/i)}else this.left=.5*-e,this.right=.5*e,this.top=.5*t,this.bottom=.5*-t;this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,r,n,i,o){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(e,t,r,n,i,o):this.orthoCamera.setViewOffset(e,t,r,n,i,o)}clearViewOffset(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=null===e.view?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom,autoZoom:!0,autoZoomFrustumSize:790},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return Co(t,e)}updateCameraSubtype(e,t){let r="perspective"===e?"PerspectiveCamera":"OrthographicCamera";void 0!==t.zoom&&this.setZoom(r,t.zoom),void 0!==t.near&&this.setNear(r,t.near),void 0!==t.fov&&"PerspectiveCamera"===r&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),void 0!==e.far&&(this.far=e.far),void 0!==e.orthographic&&this.updateCameraSubtype("orthographic",e.orthographic),void 0!==e.perspective&&this.updateCameraSubtype("perspective",e.perspective),void 0!==e.type&&(this.cameraType=e.type),void 0!==e.up&&this.up.fromArray(e.up),void 0!==e.targetOffset&&(this.targetOffset=e.targetOffset),void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,r){super.updateByPatchedOp(e,t,r),1===e.path.length&&0===e.type&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},Lv=new t,Uv=new t,Iv=class extends _m{constructor(e,t,r){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new s,this.onAfterRender=(e,t,r,n,i,o)=>{super.onAfterRender(e,t,r,n,i,o),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,r){super.updateByPatchedOp(e,t,r),1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&void 0!==e.props.operation&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var r;if(-1!==this.booleanMeshSetAddress&&!e)return;for(let i=0;i<this.children.length;i++){let r=this.children[i];r instanceof Iv&&r.recomputeBoolean(!0===e,t)}this.meshSetAddresses=[];for(let i=0;i<this.children.length;i++){let n=this.children[i];if(n instanceof Wd&&!0===n.dataPatched.visible&&(null==(r=n.geometry.attributes.position)?void 0:r.count)>0&&n.geometry.drawRange.count>0){if(Lv.multiplyMatrices(n.hiddenMatrix,n.matrix),-1===n.booleanMeshSetAddress){if((n.geometry.index??n.geometry.getAttribute("position")).count/3<15e5&&(n.booleanMeshSetAddress=Md.getMeshSet(n.geometry,!0===e,t)),-1===n.booleanMeshSetAddress)return;Md.transformMeshSet(n.booleanMeshSetAddress,Lv),n.booleanMatrixInvOld.copy(Lv).invert(),n.booleanWasTransformed=!1}else n instanceof Iv&&!0===n.needsTransformForDownstream?(Md.transformMeshSet(n.booleanMeshSetAddress,Lv),n.needsTransformForDownstream=!1):!0===n.booleanWasTransformed&&(Md.transformMeshSet(n.booleanMeshSetAddress,Uv.multiplyMatrices(Lv,n.booleanMatrixInvOld)),n.booleanMatrixInvOld.copy(Lv).invert(),n.booleanWasTransformed=!1);this.meshSetAddresses.push(n.booleanMeshSetAddress)}}if(0===this.meshSetAddresses.length)return this.geometry.setAttribute("position",new f([],0)),void this.geometry.setDrawRange(0,0);if(!0===e)return Md.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let n=this.geometry;n.dispose(),this.geometry=new s,this.geometry.userData=n.userData,this.geometry.boundingSphere=n.boundingSphere;try{this.booleanMeshSetAddress=Md.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(tl){this.booleanMeshSetAddress=0}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,Om(this),Tm(this)}dispose(){super.dispose(),this.geometry.dispose()}};(Ov||(Ov={})).is=function(e){return ku.is(e)&&e instanceof g};var zv=(e,t)=>class extends(Tv(e,t)){updateState_Light(e,t){this.updateState_Entity(e,t),void 0!==e.color&&(this.color=t.shared.color(e.color)),void 0!==e.intensity&&(this.intensity=e.intensity),void 0!==e.depth&&(this.shadow.camera.far=e.depth,this.shadow.needsUpdate=!0),void 0!==e.shadows&&(this.castShadow=e.shadows)}},Rv=e=>e instanceof Wd,Nv=e=>null!==e&&e instanceof Iv,Bv=e=>_v.is(e),Fv=class extends(pv(E)){constructor(e,t=15){super(t),this.object=e,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}raycast(e,t){gv(this.object,Fv.geometryHelper,e,t)}update(){}},jv=class extends(Tv(ne,Fv)){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},Gv=class extends(pv(C)){constructor(e,t=15,r=10066329){super(e,t,r),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){gv(this.object,Gv.geometryHelper,e,t)}},Vv=class extends(pv(A)){constructor(e,t=15,r=6710886){super(e,t,r),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){gv(this.object,Vv.geometryHelper,e,t)}},Hv=class extends(pv(M)){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){gv(this.object,Hv.geometryHelper,e,t)}update(){if(void 0!==this.object){let e=Hv._vector,t=this.object.distance?this.object.distance:1e3,r=t*Math.tan(this.object.angle);this.cone.scale.set(r,r,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let n=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(let i=0,o=this.cone.material.length;i<o;i++)this.cone.material[i].color.set(n);else this.cone.material.color.set(n)}}},Wv=Hv;Wv._vector=new r;var qv=class extends(zv(ge,Gv)){constructor(e,t,r){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.top=1250,n.bottom=-1250,n.right=1250,n.left=-1250,n.near=-1e4,n.far=2500;let i=new ie(this.shadow.camera);i.visible=!1,this.gizmos.shadowmap=i}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof ie&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let r=void 0!==e.depth&&e.depth!==this.shadow.camera.far||void 0!==e.size&&e.size/2!==this.shadow.camera.right;void 0!==e.size&&function(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}(this,e.size),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),r&&this.update()}},$v=class extends(zv(ye,Vv)){constructor(e,t,n){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.fov=90,i.aspect=1,i.near=100,i.far=2500;let o=new r(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),s=new r(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z),l=new a(o,s),u=new te(l,new w(16755200));u.visible=!1,this.gizmos.shadowmap=u,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof te){let e=this.shadow.camera,n=new r(-e.far+this.position.x,-e.far+this.position.y,-e.far+this.position.z),i=new r(e.far+this.position.x,e.far+this.position.y,e.far+this.position.z);t.box.set(n,i),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},Xv=new r,Yv=new r,Zv=new re,Kv=class extends(zv(be,Wv)){constructor(e,t,r){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=2*b.RAD2DEG*this.angle,n.aspect=1,n.near=100,n.far=2500;let i=new ie(this.shadow.camera);i.visible=!1,this.gizmos.shadowmap=i,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof ie&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),Yv.setFromMatrixPosition(this.matrixWorld),Zv.setFromRotationMatrix(this.matrixWorld),Xv.copy(this.up).applyQuaternion(Zv).negate().multiplyScalar(this.distance),this.target.position.copy(Yv).add(Xv),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.angle&&(this.angle=e.angle),void 0!==e.penumbra&&(this.penumbra=e.penumbra),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},Qv=class extends Sm{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let r=this.geometry.getAttribute("position");void 0!==r?Gd(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,e,t):super.updateEntityBoxSize(e,t)}},Jv=class extends Sm{constructor(e,t,r){super(e,t,r),this._shapeId=null,this._context=r}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){var e;let t,r=this.data.geometry.extrusion.shape;if("Custom"===r.type){let n=r.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let r=this._context.scene.find(n);(null==r?void 0:r.data)&&(r.attachedPaths.add(this),t=null==(e=r.geometry.userData)?void 0:e.shape),t||this._context.scene.addPendingCommand((()=>this.updateShape()))}}else{let e;switch(r.type){case"Rectangle":e=Jh;break;case"Ellipse":e=bh;break;case"Polygon":e=Xh;break;case"Star":e=td;break;default:throw new Error(`Unknown shape type: ${r.type}`)}t=e.create({parameters:r}).userData.shape}let n=this.geometry;t&&n.inputs&&(n.inputs.shapeData=t,n.build(),this.attachedSurfaceCloners.forEach((e=>e.update())))}detachShape(){var e;null!==this._shapeId&&(null==(e=this._context.scene.find(this._shapeId))||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e){return super.updateTransformState(e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let r=this.geometry.getAttribute("position");void 0!==r?Gd(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,e,t):super.updateEntityBoxSize(e,t)}},eg=class extends(Tv(ne,Fv)){constructor(e,t,r){super(),"Instance"===t.type&&"string"==typeof e&&(t=this.transformAssignData(t,r)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return"Component"===this.data.type&&"string"==typeof this.identity}get isInstanceRoot(){return"Instance"===this.data.type&&"string"==typeof this.identity}transformAssignData(e,t){let r=t.scene.data.objects.get(e.component);if(r){let t,n;for(let i of Wl.rootOverrideProps)void 0===e[i]?(void 0===t&&(t={...e}),t[i]=r.data[i]):(void 0===n&&(n={}),n[i]=e[i]);return this.overrideData=n,t??e}return e}updateByOp(e,t,r,n){let i;if(this.isInstanceRoot&&!n&&(t=this.transformAssignData(t,r),0===e.type&&0===e.path.length&&this.component))for(let o of Wl.rootOverrideProps)o in e.props&&void 0===e.props[o]&&(void 0===i&&(i={...e,props:{...e.props}}),i.props[o]=this.component.data[o]);super.updateByOp(i??e,t,r,n)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(void 0===this.component){this.component=e.scene.find(t.component)??null;let r=!1;if(this.component!==this.oldComponent){if(this.oldComponent){let t=0;for(let r of this.children){if(!ku.is(r))break;e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),tg(r),t+=1}this.children.splice(0,t)}r=!0}this.component&&ng(e,[this.uuid],t.overrides,this,this.component,this.component,0,r),this.oldComponent=this.component}}};function tg(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let r of e.children)ku.is(r)&&tg(r)}}function rg(e,t,r,n){return e.component===t&&So(e.identity,n)?e.overrideData===r?2:1:0}function ng(e,t,r,n,i,o,a,s){if(a>50)return!1;if(n.component!==i){if(n.component){let e=n.component.instances.indexOf(n);e>=0&&n.component.instances.splice(e,1)}i.instances.push(n),n.component=i}i instanceof eg&&i.isInstanceRoot&&i.expandInstanceChildren(e);let l=0;for(let u of i.children)if(ku.is(u)){let i,c=[...t,..."string"==typeof u.identity?[u.identity]:u.identity],h=Hl.resolve(r,c,1),d=null;if(!s){let t=n.children[l];if(d=ku.is(t)?t:null,null!==d){let e=rg(d,u,h,c);i=e>=1?d.stateSelection:void 0,2!==e&&(d=null)}if(null===d&&(d=e.scene.findInstance(c)??null,null!==d)){let t=rg(d,u,h,c);if(i=t>=1?d.stateSelection:void 0,2!==t)d=null;else{let t=d.parent.children.indexOf(d);d.parent.children.splice(t,1),n.children.splice(l,0,d),d.parent===n||(d.parent=n,d.matrixWorldNeedsUpdate=!0,d.resetBBoxNeedsUpdate(),d.updateVisible(),e.pendingDeletes.delete(d))}}}if(null===d){let t=h?Wo.apply(u.data,h):u.data;rl.is(t.type)&&(t={...t,type:"Empty"}),d=Hu.createEntity(c,t,e),d.overrideData=h,n.add(d),n.children.splice(n.children.length-1,1),n.children.splice(l,0,d),d.updateState(d.data,e),i&&d.changeSelectedState(i,e),e.scene.registerInstanceAndSetUuid(d)}l+=1,ng(e,t,r,d,u,o,a+1,s)}if(!s){let t=l;for(;;){let t=n.children[l];if(!ku.is(t))break;e.pendingDeletes.add(t),l+=1}n.children.splice(t,l-t)}return!0}function ig(e,t,r){return"Mesh"===t.type?function(e,t,r){let n;return"TextGeometry"===t.geometry.type?new Jm(e,t,r):(n="SubdivGeometry"===t.geometry.type?new Mm(e,t,r):"PathGeometry"===t.geometry.type?new Jv(e,t,r):"VectorGeometry"===t.geometry.type?new Qv(e,t,r):"BooleanGeometry"===t.geometry.type?new Iv(e,t,r):new Sm(e,t,r),n)}(e,t,r):"Empty"===t.type?new jv(e,t):"PointLight"===t.type?new $v(e,t,r):"SpotLight"===t.type?new Kv(e,t,r):"DirectionalLight"===t.type?new qv(e,t,r):"Component"===t.type||"Instance"===t.type?new eg(e,t,r):rl.is(t.type)?new kv(e,t):new jv(e,t)}function og(e,t){let r=!1,n=t.getLayersOfType("transmission"),i=t.getLayersOfType("outline");return i.length>0&&(e.layers.set(8),n.length>0&&e.layers.enable(3),r=!0,Tm(e),Om(e)),0===n.length&&0===i.length&&e.layers.set(0),e instanceof _m&&e.needsAO&&e.layers.enable(5),r}function ag(e,t){if(!t.layers)return!1;let r=!1,n=t.getLayersOfType("transmission").filter((e=>e.data.visible)),i=t.getLayersOfType("outline").filter((e=>e.data.visible));return n.length>0&&(e.layers.set(3),i.length>0&&e.layers.enable(8),r=!0),0===n.length&&0===i.length&&e.layers.set(0),e.needsAO&&e.layers.enable(5),r}Hu.createEntity=ig,Hu.changeEntityProptotype=function(e,t,r){let n=ig(e.identity,t,r),i=e.children,o=e.attachedPaths,a=e.parent,s=e.component,l=e.instances,u=e.overrideData,c=e.uuid,h=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(n));for(let d of Object.keys(n))e[d]=n[d];e.children=[...e.children,...i],e.attachedPaths=o,e.parent=a,e.component=s,e.instances=l,e.uuid=c,e.overrideData=u,e.updateState(e.data,r),h&&e.changeSelectedState(h,r),e.resetBBoxNeedsUpdate()},Hu.Cloner=dv;var sg=new d,lg=new t,ug=new u;function cg(e,t,r,n=!1){let i=e.cloner;if(i)for(let o of i.children){let i=lg.copy(o.matrixWorld).invert(),a=ug.copy(t.ray).applyMatrix4(i),s=e.matrixWorld;a.applyMatrix4(s);let l=sg;l.set(a.origin,a.direction),l.near=t.near,l.far=t.far;let u=l.intersectObject(e,!1);u.length>0&&r.push({...u[0],object:n?o:e})}}(new l).wireframe=!0;var hg,dg=new r,pg=class extends D{constructor(e,t){super(),this.data=e,this.backupFog=new P(16777215,.1,2e3),this.fogUseBGColor=!1,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.occlusion=!1,this.aoFullRes=!1,this.radius=128,this.bias=.5,this.aoColor={r:0,g:0,b:0},this.geometryCacheChanged=!1,this.bgColor=new Jd(1,1,1,1),this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new class{constructor(){this._constraints=new Map}setConstraint(e,t){null===t?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach(((r,n)=>{let i=[n,r],o=r;for(;this._constraints.has(o);)o=this._constraints.get(o),t.has(o)||i.push(o);for(let a=i.length-2;a>=0;a--)if(!t.has(i[a])){let r=e.find(i[a]);r&&r.applyPathSnapping(e),t.add(i[a])}}))}findDependency(e,t){let r=e;for(;this._constraints.has(r);)if(r=this._constraints.get(r),r===t)return!0;return!1}},this.needsRecomputeInstances=!1,this.ambientLight=new k(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.personalCamera=this.createPersonalCamera(),this.activeCamera=this.personalCamera,this.postprocessing=e.postprocessing,this.init(e,t),this.matrixAutoUpdate=!1}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=function(e){let t=!1;return e.traverseEntity((e=>{if(e instanceof _m)if(Array.isArray(e.material))for(let r=0;r<e.material.length;r++)ag(e,e.material[r])&&(t=!0);else ag(e,e.material)&&(t=!0)})),t}(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=function(e){let t=!1;return e.traverseEntity((e=>{if(e instanceof _m)if(Array.isArray(e.material))for(let r=0;r<e.material.length;r++)og(e,e.material[r])&&(t=!0);else og(e,e.material)&&(t=!0)})),t}(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),r=this.entityIdentityToEntity[t];r&&(e.uuid=r.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}getWithSortKey(e){let t=this.find(e);if(void 0===t)return;let r=[],n=t;for(;n!==this;){let e=n;n=n.parent;let t=n.children.indexOf(e);r.splice(0,0,t)}return{entity:t,sortKey:r}}getAllSorted(e){let t=[];for(let r of e){let e=this.getWithSortKey(r.id);void 0!==e&&t.push(e)}return t.sort(((e,t)=>function(e,t){let r=0;for(;r<e.length&&r<t.length;){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1;r+=1}return r!==t.length?-1:r!==e.length?1:0}(e.sortKey,t.sortKey))),t.map((e=>e.entity))}nonExistOrDescendantOf(e,t){let r=this.find(e);if(void 0===r)return!0;for(;r;){if(r.uuid===t)return!0;r=r.parent}return!1}find(e){if(""===e||void 0===e)return;let t=this.entityByUuid[e];return void 0===t?this.getObjectByProperty("uuid",e):t}debugEnsureEntity(e){let t=this.find(e);t&&Array.isArray(t.identity)&&this.findInstance(t.identity)}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors((e=>{this.toExpandCloner.add(e)}))}doPendingExpandCloner(){this.toExpandCloner.forEach((e=>{e.expandCloner(this)})),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach((e=>{var t;null==(t=e.cloner)||t.update()})),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach((e=>e())),this.pendingCommands.length=0}updateTreeByOp(e,t){var r;if(0===e.path.length&&7===e.type){let r=null===e.parent?this:this.find(e.parent);if(void 0===r)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,r,e.localIndex,t);n.updateVisible(),n.resetBBoxNeedsUpdate(),Rv(n)&&Nv(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n)}else if(0===e.path.length&&8===e.type){let t=this.find(e.id);if(void 0===t)throw new Error("unexpected");this.markToExpandCloner(t),t.resetBBoxNeedsUpdate(),this.unregisterObject(t);let r=t.parent;this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(t),t.parent.remove(t),Nv(t.parent)&&(t.parent.invalidateUpstreamBooleanData(),t.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Rv(t)&&(t.freeBooleanPointer(),r instanceof Iv&&r.invalidateDownstreamBooleanData().recomputeBoolean()),t instanceof Jv&&t.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(t),this.pathConstraints.removeDependencies(t.uuid)}else if(0===e.path.length&&9===e.type){let t=this.find(e.id);if(void 0===t)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(t);let n=t.parent;this.markNeedsRecomputeInstancesForAncessors(n),null==(r=t.cloner)||r.resetOnMove(),this.markToExpandCloner(t);let i=null===e.parent?this:this.find(e.parent);if(void 0===i)throw new Error("unexpected");i.add(t),this.markNeedsRecomputeInstancesForAncessors(i),this.markToExpandCloner(t),t.invalidateClonerTransform(t),t.updateVisible(),t.resetBBoxNeedsUpdate();let o=e.localIndex;i.children.splice(o,0,i.children.pop()),Rv(t)&&(t.invalidateUpstreamBooleanData(),Nv(t.parent)?t.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof Iv&&n.invalidateDownstreamBooleanData().recomputeBoolean())}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}updateEntityByOp(e,t,r,n){if(0===t.type){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),t.path.includes("overrides")&&"states"in t.props){let{rest:e}=t.props;t={...t,props:e},this.markNeedsRecomputeInstances()}"pathSnapping"===t.path[0]&&void 0!==t.props.pathId&&this.pathConstraints.setConstraint(e,t.props.pathId)}let i=this.find(e);if(i)try{(function(e,t,r,n){e.updateByOp(t,r,n,!1)})(i,t,r,{scene:this,shared:n}),i instanceof Sm&&i.updateGeometryGroupsIfNeeded()}catch(Hs){}}get enableFog(){return null!==this.fog}set enableFog(e){this.fog=!0===e?this.backupFog:null}init(e,t){if(this.createChildrenObjects(e.objects,this,t),this.personalCamera.removeFromParent(),this.add(this.personalCamera),this.ambientLight.removeFromParent(),this.add(this.ambientLight),this.setBackgroundColor(Bf(e.backgroundColor,t)),this.updateFog(e.fog,t),this.updateAmbientLight(e.environment.ambientLight,t),this.activeCamera=this.personalCamera,null!==e.publish.playCamera){let t=this.find(e.publish.playCamera);t instanceof kv&&this.switchActiveCamera(t)}this.expandInstances(t,!0),this.traverseEntity((e=>{Nv(e)&&e.recomputeBoolean(),e instanceof kv&&e.updateUp()})),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity((e=>{("Component"===e.data.type||"Instance"===e.data.type)&&this.markNeedsRecomputeInstances()}))}markNeedsRecomputeInstancesForAncessors(e){ku.is(e)&&("Component"===e.data.type&&this.markNeedsRecomputeInstances(),e.traverseAncestors((e=>{ku.is(e)&&"Component"===e.data.type&&this.markNeedsRecomputeInstances()})))}relativeizeInner(e,t,r,n,i,o,a){e&&e!==n.uuid&&n.find(e)&&i.forInstancesRec((n=>{n.isInstanceRoot||(n.data=wa(n.data,(i=>{let s=i.events.data(a.id),l=n.goUp(o);if(l){let n=[...He(l.identity),e].join("-"),i=this.entityIdentityToEntity[n];if(i){let e=i.uuid;ga.zoom(s,t)[r]=e}}})).data)}))}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity((e=>{if(e instanceof eg&&"string"==typeof e.identity&&"Component"===e.data.type)return e.traverseEntity(((t,r)=>{t.data.events.forEach((n=>{"GameControl"===n.data.type?t.forInstancesRec((e=>{e.isInstanceRoot||(e.data=wa(e.data,(e=>{e.events.delete(n.id)})).data)})):"Conditional"===n.data.type?("Distance"===n.data.condition.type?(this.relativeizeInner(n.data.condition.fromObject,["condition"],"fromObject",e,t,r,n),this.relativeizeInner(n.data.condition.toObject,["condition"],"toObject",e,t,r,n)):"State"===n.data.condition.type?this.relativeizeInner(n.data.condition.object,["condition"],"object",e,t,r,n):"Comparison"===n.data.condition.type&&("Property"===n.data.condition.lOperand.type&&this.relativeizeInner(n.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,r,n),"Property"===n.data.condition.rOperand.type&&this.relativeizeInner(n.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,r,n)),n.data.inActions.forEach((i=>{"Transition"===i.data.type&&this.relativeizeInner(i.data.object,["inActions",i.id],"object",e,t,r,n)})),n.data.outActions.forEach((i=>{"Transition"===i.data.type&&this.relativeizeInner(i.data.object,["outActions",i.id],"object",e,t,r,n)}))):"actions"in n.data&&n.data.actions.forEach((i=>{"Transition"===i.data.type&&this.relativeizeInner(i.data.object,["actions",i.id],"object",e,t,r,n)}))}))})),!0}))}expandInstances(e,t){let r=new Set;this.traverseEntity((n=>{if(n instanceof eg&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:e,pendingDeletes:r}),t||n.resetBBoxNeedsUpdate(),!0}));for(let n of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),tg(n)}recomputeInstances(e){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity((e=>{e instanceof eg&&e.isInstanceRoot&&(e.component=void 0)})),this.expandInstances(e,!1))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity((e=>{let t="string"==typeof e.identity?e.identity:e.identity.join("-");this.entityIdentityToEntity[t]===e&&(delete this.entityByUuid[e.uuid],delete this.entityIdentityToEntity[t]),e.dispose()}))}clearScene(){for(let e of this.children)ku.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}createPersonalCamera(){let e=new kv(pg.PERSONAL_CAMERA_ID,{...Gl.defaultData,name:"Personal Camera"});return e.objectHelper.visible=!1,this.registerObjectCreatedInLegacy(e),e}raycast(e){let t=[],r=n=>{for(let i of n.children){let n=i.cloner;ku.is(i)&&!i.raycastLock&&(i.visible||(null==n?void 0:n.object.data.visible))&&((Rv(i)||Bv(i)&&this.enableHelpers&&i.objectHelper.visible)&&(e.intersectObject(i,!1,t),cg(i,e,t)),r(i))}};return r(this),t}raycastWithClones(e){let t=[],r=n=>{for(let i of n.children){let n=i.cloner;ku.is(i)&&(i.visible||(null==n?void 0:n.object.data.visible))&&((Rv(i)||Bv(i)&&this.enableHelpers&&i.objectHelper.visible)&&(e.intersectObject(i,!1,t),cg(i,e,t,!0)),r(i))}};return r(this),t}forEachEntity(e){for(let t of this.children)ku.is(t)&&e(t)}traverseEntity(e){for(let t of this.children)ku.is(t)&&t.traverseEntity(e)}traverseObject(e){for(let t of this.children)Eu.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)ku.is(t)&&t.visible&&t.traverseVisibleEntity(e)}updateFog(e,t){this.enableFog=e.enabled,this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=Bf(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}dispose(){this.clearScene()}updateAmbientLight(e,t){void 0!==e.color&&(this.ambientLight.color=Bf(e.color,t)),void 0!==e.intensity&&(this.ambientLight.intensity=e.intensity),void 0!==e.groundColor&&(this.ambientLight.groundColor=Bf(e.groundColor,t)),void 0!==e.enabled&&(this.ambientLight.visible=e.enabled),void 0!==e.occlusion&&(this.occlusion=e.occlusion),void 0!==e.aoFullRes&&(this.aoFullRes=e.aoFullRes),void 0!==e.radius&&(this.radius=e.radius),void 0!==e.bias&&(this.bias=e.bias),void 0!==e.aoColor&&(this.aoColor=Bf(e.aoColor,t))}switchActiveCamera(e){this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1}setBackgroundColor(e){this.bgColor=e,!0===this.fogUseBGColor&&(this.backupFog.color=e)}createChildrenObjects(e,t,r){let n=0;for(let i of e)this.createObject(i.id,i.data,i.children,t,n,r),n+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,r,n,i,o){var a;let s={scene:this,shared:o},l=ig(e,t,s);return l&&(this.entityByUuid[e]=l,n.add(l),n.children.splice(i,0,n.children.pop()),r.length>0&&(l.isInstanceRoot||this.createChildrenObjects(r,l,o)),l.updateState(t,s),l instanceof Sm&&l.updateGeometryGroupsIfNeeded(),l.updateVisible(),l.cloner&&this.toExpandCloner.add(l),(null==(a=t.pathSnapping)?void 0:a.pathId)&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),l}getCenter(e){let t=[];for(let n=0,i=e.length;n<i;++n){let{id:r,recursive:i}=e[n],o=this.find(r),a=i?o.recursiveBBox:o.singleBBox;t.push(...a.vertices)}let r=new a;return r.setFromPoints(t),r.getCenter(dg),dg}copyMatrixWorld(e,t){if(null===e)return void t.identity();let r=this.find(e);r?t.copy(r.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(null===e)return void t.identity();let n=null==(r=this.find(e))?void 0:r.parent;n?t.copy(n.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity((t=>{if(t instanceof Wd)if(Array.isArray(t.material))for(let r=0;r<t.material.length;r++)t.material[r]instanceof tm&&e(t.material[r]);else t.material instanceof tm&&e(t.material)}))}updateCanvasSize(e,t){let r,n;this.activeCamera.setViewplaneSize(e,t),e>=t?(r=t/e,n=1):(r=1,n=e/t),this.traverseMaterial((e=>{e.getLayersOfType("transmission").forEach((e=>{e.uniforms[`f${e.id}_aspectRatio`].value.x=r,e.uniforms[`f${e.id}_aspectRatio`].value.y=n}))}))}},fg=pg;async function mg(e){if(hg){let t,r={attributeIDs:hg.defaultAttributeIDs,attributeTypes:hg.defaultAttributeTypes,useUniqueIDs:!1};try{t=await hg.decodeGeometry(new Int8Array(e).buffer,r)}catch(qo){}if(t)return{index:t.index?{array:t.index.array}:void 0,attributes:Object.entries(t.attributes).map((([e,t])=>({name:e,itemSize:t.itemSize,array:t.array})))}}return null}async function vg(e,t){let[r,n]=xa(Fs.deserialize(new Uint8Array(e)));vu(r);let i=[];r.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&"NonParametricGeometry"===t.geometry.type&&void 0!==t.geometry.data.draco&&i.push(t)})),i.length&&await(hg||(hg=new Ee).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),hg.decoderPending);for(let o of i){let e=await mg(_a(o.geometry.data.draco));if(e){e.index&&(o.geometry.data.index={array:e.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let t={};e.attributes.forEach((({name:e,array:r,itemSize:n})=>{t[e]={array:r,itemSize:n,type:"Float32Array",normalized:!1}})),o.geometry.data.attributes=t,o.geometry.data.draco=void 0}}return t&&t(r),n.result().data}function gg(e){Object.values(e.shared.materials).forEach((e=>{yg(e)})),e.scene.objects.traverse(((e,t)=>{"material"in t?yg(t.material):"materials"in t&&t.materials.forEach((e=>{yg(e)}))}))}function yg(e){if("string"==typeof e)return;let t=[];e.layers.forEach(((e,r)=>{"outline"===e.type&&t.push(r)})),t.reverse().forEach((t=>{e.layers.delete(t)})),t.length}fg.PERSONAL_CAMERA_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera",fg.PERSONAL_CAMERA_EXPORT_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCameraExport";var bg=Ne(Ge(),1);var xg=class extends xe{load(e,t,r,n=console.error){let i=new we(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),e.endsWith(".spline")||e.endsWith(".splinecode"),i.load(e,(async e=>{try{if("string"==typeof e)throw new Error("The .spline file is not binary!");let r=await this.parse(e);t(r)}catch(Hs){n(Hs)}}),r,n)}async parse(e){let t=await vg(e,gg);t.version&&(0,bg.default)(t.version,"0.9.377"),await Promise.all([Am(t)&&ud(),Xm(t)&&dm()].filter(Boolean));let r=new xm(t.shared);Object.values(r.getMaterials()).forEach((e=>Object.assign(e,{isAsset:!0})));let n=new fg(t.scene,r);n.remove(n.personalCamera),t.scene.environment.ambientLight.enabled||n.remove(n.ambientLight);let i=t.scene.publish.playCamera;if(i){let e=n.find(i);e&&(e=>e instanceof kv)(e)&&Object.assign(e,{makeDefault:!0})}return n=function(e){let t=[];return e.traverse((e=>{e instanceof dv&&t.push(e)})),t.forEach((t=>{let r=t.object,n=[...t.children.map((e=>{let t;if(e.updateMatrix(),void 0!==e.geometry)try{t=e.geometry.clone().applyMatrix4(e.matrix)}catch(r){}return void 0!==t&&e.matrix.determinant()<0&&function(e){let t;if(e.index)for(let r=0;r<e.index.array.length;r+=3)t=e.index.array[r],e.index.array[r]=e.index.array[r+2],e.index.array[r+2]=t}(t),t})).filter((e=>void 0!==e))];if(!t.parameters.hideBase&&r instanceof Wd&&n.unshift(r.geometry),n.length){let e=Q(n);r instanceof Wd&&(r.geometry=e)}t.removeFromParent(),r.setFromClonerState(null,{scene:e,shared:wm})})),e}(n),n=function(e){let t=new Set;return e.traverse((e=>{if(e instanceof _m)if(st(e.material))e.material.forEach((e=>{let r=e;t.has(r)||t.add(r)}));else{let r=e.material;t.has(r)||t.add(r)}})),t.forEach((e=>{if(e instanceof Array)return;let t=e.onBeforeCompile.bind(e);if(function(e){return e.getLayersOfType("transmission").length>0}(e)){Object.assign(e,{isMeshStandardMaterial:!0,isMeshPhysicalMaterial:!0,transmission:1,attenuationColor:new w,specularColor:new w});let r=0;e.onBeforeCompile=(n,i)=>{t&&t(n,i),n.uniforms=Object.assign({},Oe.physical.uniforms,n.uniforms),e.getLayersOfType("transmission").forEach((t=>{if(n.uniforms.transmissionSamplerMap.value){let r=t.color;r&&(r.transmissionSamplerMap.value=n.uniforms.transmissionSamplerMap.value,r.transmissionSamplerSize.value=n.uniforms.transmissionSamplerSize.value,e.defines.IS_THREEJS_EXPORT=!0)}else r++,r<2&&(e.needsUpdate=!0)}))}}else(function(e){let t=0;for(let r of e.layers){if("displace"!==r.data.type&&r.data.isMask)return!0;if("light"!==r.type&&"fresnel"!==r.type){let e=r.uniforms["f"+r.id+"_alpha"];e&&(t+=(1-t)*e.value)}}return t<1})(e)||(e.onBeforeCompile=(r,n)=>{t&&t(r,n),e.transparent=!1})})),e}(n),n=function(e){return e.traverse((e=>{if("Camera"===e.type){let t=e;t.type=t.cameraType}})),e}(n),n=function(e){let t=[],r=(e,n=0)=>{let i=n>0?e+n:e;return t.includes(i)?r(e,n+1):i};return e.traverse((e=>{if(t.includes(e.name)){let t=e.name,n=r(e.name);if(e.name=n,e.isMesh){let r=e;r.material instanceof Array?r.material.forEach((e=>{e.name=e.name.replace(t,n)})):r.material.isAsset||(r.material.name=r.material.name.replace(t,n))}}t.push(e.name)})),e}(n),n=function(e){return e.traverse((e=>{e.matrixAutoUpdate=!0})),e}(n),n=function(e){return e.traverseMaterial((e=>{e.needsJitter=!1})),e}(n),n}};function wg(e){const t=Ce(xg,e);return Ae(t)}var _g,Sg=(_g="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,r;(e=void 0!==(e=e||{})?e:{}).ready=new Promise((function(e,n){t=e,r=n}));var n,i={};for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);var o,a,s,l="./this.program",u=!0,c="";"undefined"!=typeof document&&document.currentScript&&(c=document.currentScript.src),_g&&(c=_g),c=0!==c.indexOf("blob:")?c.substr(0,c.replace(/[?#].*/,"").lastIndexOf("/")+1):"",o=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},a=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)};var h,d,p=e.print||void 0,f=e.printErr||void 0;for(n in i)i.hasOwnProperty(n)&&(e[n]=i[n]);i=null,e.arguments&&e.arguments,e.thisProgram&&(l=e.thisProgram),e.quit&&e.quit,e.wasmBinary&&(h=e.wasmBinary),e.noExitRuntime,"object"!=typeof WebAssembly&&Y("no native wasm support detected");var m=!1;function v(e,t){e||Y("Assertion failed: "+t)}var g="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function y(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&g)return g.decode(e.subarray(t,i));for(var o="";t<i;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var l=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|l:(7&a)<<18|s<<12|l<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var u=a-65536;o+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}function b(e,t){return e?y(T,e,t):""}function x(e,t,r,n){if(!(n>0))return 0;for(var i=r,o=r+n-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),s<=127){if(r>=o)break;t[r++]=s}else if(s<=2047){if(r+1>=o)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=o)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=o)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function w(e,t,r){return x(e,T,t,r)}function _(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}var S,O,T,E,C,A,M,D,P,k,L="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function U(e,t){for(var r=e,n=r>>1,i=n+t/2;!(n>=i)&&C[n];)++n;if((r=n<<1)-e>32&&L)return L.decode(T.subarray(e,r));for(var o="",a=0;!(a>=t/2);++a){var s=E[e+2*a>>1];if(0==s)break;o+=String.fromCharCode(s)}return o}function I(e,t,r){if(void 0===r&&(r=2147483647),r<2)return 0;for(var n=t,i=(r-=2)<2*e.length?r/2:e.length,o=0;o<i;++o){var a=e.charCodeAt(o);E[t>>1]=a,t+=2}return E[t>>1]=0,t-n}function z(e){return 2*e.length}function R(e,t){for(var r=0,n="";!(r>=t/4);){var i=A[e+4*r>>2];if(0==i)break;if(++r,i>=65536){var o=i-65536;n+=String.fromCharCode(55296|o>>10,56320|1023&o)}else n+=String.fromCharCode(i)}return n}function N(e,t,r){if(void 0===r&&(r=2147483647),r<4)return 0;for(var n=t,i=n+r-4,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o)),A[t>>2]=a,(t+=4)+4>i)break}return A[t>>2]=0,t-n}function B(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function F(e,t){O.set(e,t)}function j(t){S=t,e.HEAP8=O=new Int8Array(t),e.HEAP16=E=new Int16Array(t),e.HEAP32=A=new Int32Array(t),e.HEAPU8=T=new Uint8Array(t),e.HEAPU16=C=new Uint16Array(t),e.HEAPU32=M=new Uint32Array(t),e.HEAPF32=D=new Float32Array(t),e.HEAPF64=P=new Float64Array(t)}e.INITIAL_MEMORY;var G=[],V=[],H=[],W=0,q=null;function $(t){W++,e.monitorRunDependencies&&e.monitorRunDependencies(W)}function X(t){if(W--,e.monitorRunDependencies&&e.monitorRunDependencies(W),0==W&&q){var r=q;q=null,r()}}function Y(t){e.onAbort&&e.onAbort(t),f(t="Aborted("+t+")"),m=!0,t+=". Build with -s ASSERTIONS=1 for more info.";var n=new WebAssembly.RuntimeError(t);throw r(n),n}e.preloadedImages={},e.preloadedAudios={};var Z,K,Q,J,ee="data:application/octet-stream;base64,";function te(e){return e.startsWith(ee)}function re(e){try{if(e==Z&&h)return new Uint8Array(h);if(!s)throw"both async and sync fetching of the wasm failed"}catch(t){Y(t)}}function ne(t){for(;t.length>0;){var r=t.shift();if("function"!=typeof r){var n=r.func;"number"==typeof n?void 0===r.arg?oe(n)():oe(n)(r.arg):n(void 0===r.arg?null:r.arg)}else r(e)}}te(Z="process.wasm")||(K=Z,Z=e.locateFile?e.locateFile(K,c):c+K);var ie=[];function oe(e){var t=ie[e];return t||(e>=ie.length&&(ie.length=e+1),ie[e]=t=k.get(e)),t}function ae(e){this.excPtr=e,this.ptr=e-16,this.set_type=function(e){A[this.ptr+4>>2]=e},this.get_type=function(){return A[this.ptr+4>>2]},this.set_destructor=function(e){A[this.ptr+8>>2]=e},this.get_destructor=function(){return A[this.ptr+8>>2]},this.set_refcount=function(e){A[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,O[this.ptr+12>>0]=e},this.get_caught=function(){return 0!=O[this.ptr+12>>0]},this.set_rethrown=function(e){e=e?1:0,O[this.ptr+13>>0]=e},this.get_rethrown=function(){return 0!=O[this.ptr+13>>0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=A[this.ptr>>2];A[this.ptr>>2]=e+1},this.release_ref=function(){var e=A[this.ptr>>2];return A[this.ptr>>2]=e-1,1===e}}var se={};function le(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function ue(e){return this.fromWireType(M[e>>2])}var ce={},he={},de={},pe=48,fe=57;function me(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=pe&&t<=fe?"_"+e:e}function ve(e,t){return e=me(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function ge(e,t){var r=ve(t,(function(e){this.name=t,this.message=e;var r=new Error(e).stack;void 0!==r&&(this.stack=this.toString()+"\n"+r.replace(/^Error(:[^\n]*)?\n/,""))}));return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},r}var ye=void 0;function be(e){throw new ye(e)}function xe(e,t,r){function n(t){var n=r(t);n.length!==e.length&&be("Mismatched type converter count");for(var i=0;i<e.length;++i)Ce(e[i],n[i])}e.forEach((function(e){de[e]=t}));var i=new Array(t.length),o=[],a=0;t.forEach((function(e,t){he.hasOwnProperty(e)?i[t]=he[e]:(o.push(e),ce.hasOwnProperty(e)||(ce[e]=[]),ce[e].push((function(){i[t]=he[e],++a===o.length&&n(i)})))})),0===o.length&&n(i)}var we={};function _e(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var Se=void 0;function Oe(e){for(var t="",r=e;T[r];)t+=Se[T[r++]];return t}var Te=void 0;function Ee(e){throw new Te(e)}function Ce(e,t,r){if(r=r||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||Ee('type "'+n+'" must have a positive integer typeid pointer'),he.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;Ee("Cannot register type '"+n+"' twice")}if(he[e]=t,delete de[e],ce.hasOwnProperty(e)){var i=ce[e];delete ce[e],i.forEach((function(e){e()}))}}function Ae(e){if(!(this instanceof Ge))return!1;if(!(e instanceof Ge))return!1;for(var t=this.$$.ptrType.registeredClass,r=this.$$.ptr,n=e.$$.ptrType.registeredClass,i=e.$$.ptr;t.baseClass;)r=t.upcast(r),t=t.baseClass;for(;n.baseClass;)i=n.upcast(i),n=n.baseClass;return t===n&&r===i}function Me(e){return{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}}function De(e){Ee(e.$$.ptrType.registeredClass.name+" instance already deleted")}var Pe=!1;function ke(e){}function Le(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function Ue(e){return"undefined"==typeof FinalizationRegistry?(Ue=function(e){return e},e):(Pe=new FinalizationRegistry((function(e){Le(e.$$)})),ke=function(e){Pe.unregister(e)},(Ue=function(e){var t={$$:e.$$};return Pe.register(e,t,e),e})(e))}function Ie(){if(this.$$.ptr||De(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e=Ue(Object.create(Object.getPrototypeOf(this),{$$:{value:Me(this.$$)}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e}function ze(){this.$$.ptr||De(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ee("Object already scheduled for deletion"),ke(this),Le(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Re(){return!this.$$.ptr}var Ne=void 0,Be=[];function Fe(){for(;Be.length;){var e=Be.pop();e.$$.deleteScheduled=!1,e.delete()}}function je(){return this.$$.ptr||De(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ee("Object already scheduled for deletion"),Be.push(this),1===Be.length&&Ne&&Ne(Fe),this.$$.deleteScheduled=!0,this}function Ge(){}var Ve={};function He(e,t,r){if(void 0===e[t].overloadTable){var n=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||Ee("Function '"+r+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}}function We(t,r,n){e.hasOwnProperty(t)?((void 0===n||void 0!==e[t].overloadTable&&void 0!==e[t].overloadTable[n])&&Ee("Cannot register public name '"+t+"' twice"),He(e,t,t),e.hasOwnProperty(n)&&Ee("Cannot register multiple overloads of a function with the same number of arguments ("+n+")!"),e[t].overloadTable[n]=r):(e[t]=r,void 0!==n&&(e[t].numArguments=n))}function qe(e,t,r,n,i,o,a,s){this.name=e,this.constructor=t,this.instancePrototype=r,this.rawDestructor=n,this.baseClass=i,this.getActualType=o,this.upcast=a,this.downcast=s,this.pureVirtualFunctions=[]}function $e(e,t,r){for(;t!==r;)t.upcast||Ee("Expected null or instance of "+r.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function Xe(e,t){if(null===t)return this.isReference&&Ee("null is not a valid "+this.name),0;t.$$||Ee('Cannot pass "'+Et(t)+'" as a '+this.name),t.$$.ptr||Ee("Cannot pass deleted object as a pointer of type "+this.name);var r=t.$$.ptrType.registeredClass;return $e(t.$$.ptr,r,this.registeredClass)}function Ye(e,t){var r;if(null===t)return this.isReference&&Ee("null is not a valid "+this.name),this.isSmartPointer?(r=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,r),r):0;t.$$||Ee('Cannot pass "'+Et(t)+'" as a '+this.name),t.$$.ptr||Ee("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&Ee("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var n=t.$$.ptrType.registeredClass;if(r=$e(t.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&Ee("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?r=t.$$.smartPtr:Ee("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:r=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)r=t.$$.smartPtr;else{var i=t.clone();r=this.rawShare(r,St.toHandle((function(){i.delete()}))),null!==e&&e.push(this.rawDestructor,r)}break;default:Ee("Unsupporting sharing policy")}return r}function Ze(e,t){if(null===t)return this.isReference&&Ee("null is not a valid "+this.name),0;t.$$||Ee('Cannot pass "'+Et(t)+'" as a '+this.name),t.$$.ptr||Ee("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&Ee("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var r=t.$$.ptrType.registeredClass;return $e(t.$$.ptr,r,this.registeredClass)}function Ke(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function Qe(e){this.rawDestructor&&this.rawDestructor(e)}function Je(e){null!==e&&e.delete()}function et(e,t,r){if(t===r)return e;if(void 0===r.baseClass)return null;var n=et(e,t,r.baseClass);return null===n?null:r.downcast(n)}function tt(){return Object.keys(it).length}function rt(){var e=[];for(var t in it)it.hasOwnProperty(t)&&e.push(it[t]);return e}function nt(e){Ne=e,Be.length&&Ne&&Ne(Fe)}var it={};function ot(e,t){return t=function(e,t){for(void 0===t&&Ee("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),it[t]}function at(e,t){return t.ptrType&&t.ptr||be("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&be("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Ue(Object.create(e,{$$:{value:t}}))}function st(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var r=ot(this.registeredClass,t);if(void 0!==r){if(0===r.$$.count.value)return r.$$.ptr=t,r.$$.smartPtr=e,r.clone();var n=r.clone();return this.destructor(e),n}function i(){return this.isSmartPointer?at(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):at(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var o,a=this.registeredClass.getActualType(t),s=Ve[a];if(!s)return i.call(this);o=this.isConst?s.constPointerType:s.pointerType;var l=et(t,this.registeredClass,o.registeredClass);return null===l?i.call(this):this.isSmartPointer?at(o.registeredClass.instancePrototype,{ptrType:o,ptr:l,smartPtrType:this,smartPtr:e}):at(o.registeredClass.instancePrototype,{ptrType:o,ptr:l})}function lt(e,t,r,n,i,o,a,s,l,u,c){this.name=e,this.registeredClass=t,this.isReference=r,this.isConst=n,this.isSmartPointer=i,this.pointeeType=o,this.sharingPolicy=a,this.rawGetPointee=s,this.rawConstructor=l,this.rawShare=u,this.rawDestructor=c,i||void 0!==t.baseClass?this.toWireType=Ye:n?(this.toWireType=Xe,this.destructorFunction=null):(this.toWireType=Ze,this.destructorFunction=null)}function ut(t,r,n){e.hasOwnProperty(t)||be("Replacing nonexistant public symbol"),void 0!==e[t].overloadTable&&void 0!==n?e[t].overloadTable[n]=r:(e[t]=r,e[t].argCount=n)}function ct(t,r,n){return t.includes("j")?function(t,r,n){var i=e["dynCall_"+t];return n&&n.length?i.apply(null,[r].concat(n)):i.call(null,r)}(t,r,n):oe(r).apply(null,n)}function ht(e,t){var r,n,i,o=(e=Oe(e)).includes("j")?(r=e,n=t,i=[],function(){i.length=arguments.length;for(var e=0;e<arguments.length;e++)i[e]=arguments[e];return ct(r,n,i)}):oe(t);return"function"!=typeof o&&Ee("unknown function pointer with signature "+e+": "+t),o}var dt=void 0;function pt(e){var t=Zt(e),r=Oe(t);return Yt(t),r}function ft(e,t){var r=[],n={};throw t.forEach((function e(t){n[t]||he[t]||(de[t]?de[t].forEach(e):(r.push(t),n[t]=!0))})),new dt(e+": "+r.map(pt).join([", "]))}function mt(e,t){for(var r=[],n=0;n<e;n++)r.push(A[(t>>2)+n]);return r}function vt(e,t,r,n,i){var o=t.length;o<2&&Ee("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var a=null!==t[1]&&null!==r,s=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){s=!0;break}var u="void"!==t[0].name,c="",h="";for(l=0;l<o-2;++l)c+=(0!==l?", ":"")+"arg"+l,h+=(0!==l?", ":"")+"arg"+l+"Wired";var d="return function "+me(e)+"("+c+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n";s&&(d+="var destructors = [];\n");var p=s?"destructors":"null",f=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],m=[Ee,n,i,le,t[0],t[1]];for(a&&(d+="var thisWired = classParam.toWireType("+p+", this);\n"),l=0;l<o-2;++l)d+="var arg"+l+"Wired = argType"+l+".toWireType("+p+", arg"+l+"); // "+t[l+2].name+"\n",f.push("argType"+l),m.push(t[l+2]);if(a&&(h="thisWired"+(h.length>0?", ":"")+h),d+=(u?"var rv = ":"")+"invoker(fn"+(h.length>0?", ":"")+h+");\n",s)d+="runDestructors(destructors);\n";else for(l=a?1:2;l<t.length;++l){var v=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==t[l].destructorFunction&&(d+=v+"_dtor("+v+"); // "+t[l].name+"\n",f.push(v+"_dtor"),m.push(t[l].destructorFunction))}return u&&(d+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),d+="}\n",f.push(d),function(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var r=ve(e.name||"unknownFunctionName",(function(){}));r.prototype=e.prototype;var n=new r,i=e.apply(n,t);return i instanceof Object?i:n}(Function,f).apply(null,m)}function gt(e,t,r){return e instanceof Object||Ee(r+' with invalid "this": '+e),e instanceof t.registeredClass.constructor||Ee(r+' incompatible with "this" of type '+e.constructor.name),e.$$.ptr||Ee("cannot call emscripten binding method "+r+" on deleted object"),$e(e.$$.ptr,e.$$.ptrType.registeredClass,t.registeredClass)}var yt=[],bt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function xt(e){e>4&&0==--bt[e].refcount&&(bt[e]=void 0,yt.push(e))}function wt(){for(var e=0,t=5;t<bt.length;++t)void 0!==bt[t]&&++e;return e}function _t(){for(var e=5;e<bt.length;++e)if(void 0!==bt[e])return bt[e];return null}var St={toValue:function(e){return e||Ee("Cannot use deleted val. handle = "+e),bt[e].value},toHandle:function(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=yt.length?yt.pop():bt.length;return bt[t]={refcount:1,value:e},t}}};function Ot(e,t,r){switch(t){case 0:return function(e){var t=r?O:T;return this.fromWireType(t[e])};case 1:return function(e){var t=r?E:C;return this.fromWireType(t[e>>1])};case 2:return function(e){var t=r?A:M;return this.fromWireType(t[e>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function Tt(e,t){var r=he[e];return void 0===r&&Ee(t+" has unknown type "+pt(e)),r}function Et(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function Ct(e,t){switch(t){case 2:return function(e){return this.fromWireType(D[e>>2])};case 3:return function(e){return this.fromWireType(P[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function At(e,t,r){switch(t){case 0:return r?function(e){return O[e]}:function(e){return T[e]};case 1:return r?function(e){return E[e>>1]}:function(e){return C[e>>1]};case 2:return r?function(e){return A[e>>2]}:function(e){return M[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function Mt(e){try{return d.grow(e-S.byteLength+65535>>>16),j(d.buffer),1}catch(Gs){}}var Dt={};function Pt(){if(!Pt.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var t in Dt)void 0===Dt[t]?delete e[t]:e[t]=Dt[t];var r=[];for(var t in e)r.push(t+"="+e[t]);Pt.strings=r}return Pt.strings}var kt={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=kt.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=kt.splitPath(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=kt.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},extname:function(e){return kt.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return kt.normalize(e.join("/"))},join2:function(e,t){return kt.normalize(e+"/"+t)}},Lt={resolve:function(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:zt.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,t="/"===n.charAt(0)}return(t?"/":"")+(e=kt.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."},relative:function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=Lt.resolve(e).substr(1),t=Lt.resolve(t).substr(1);for(var n=r(e.split("/")),i=r(t.split("/")),o=Math.min(n.length,i.length),a=o,s=0;s<o;s++)if(n[s]!==i[s]){a=s;break}var l=[];for(s=a;s<n.length;s++)l.push("..");return(l=l.concat(i.slice(a))).join("/")}},Ut={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){Ut.ttys[e]={input:[],output:[],ops:t},zt.registerDevice(e,Ut.stream_ops)},stream_ops:{open:function(e){var t=Ut.ttys[e.node.rdev];if(!t)throw new zt.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,r,n,i){if(!e.tty||!e.tty.ops.get_char)throw new zt.ErrnoError(60);for(var o=0,a=0;a<n;a++){var s;try{s=e.tty.ops.get_char(e.tty)}catch(Gs){throw new zt.ErrnoError(29)}if(void 0===s&&0===o)throw new zt.ErrnoError(6);if(null==s)break;o++,t[r+a]=s}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,r,n,i){if(!e.tty||!e.tty.ops.put_char)throw new zt.ErrnoError(60);try{for(var o=0;o<n;o++)e.tty.ops.put_char(e.tty,t[r+o])}catch(Gs){throw new zt.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n"),!t)return null;e.input=qt(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(p(y(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(p(y(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(f(y(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(f(y(e.output,0)),e.output=[])}}},It={ops_table:null,mount:function(e){return It.createNode(null,"/",16895,0)},createNode:function(e,t,r,n){if(zt.isBlkdev(r)||zt.isFIFO(r))throw new zt.ErrnoError(63);It.ops_table||(It.ops_table={dir:{node:{getattr:It.node_ops.getattr,setattr:It.node_ops.setattr,lookup:It.node_ops.lookup,mknod:It.node_ops.mknod,rename:It.node_ops.rename,unlink:It.node_ops.unlink,rmdir:It.node_ops.rmdir,readdir:It.node_ops.readdir,symlink:It.node_ops.symlink},stream:{llseek:It.stream_ops.llseek}},file:{node:{getattr:It.node_ops.getattr,setattr:It.node_ops.setattr},stream:{llseek:It.stream_ops.llseek,read:It.stream_ops.read,write:It.stream_ops.write,allocate:It.stream_ops.allocate,mmap:It.stream_ops.mmap,msync:It.stream_ops.msync}},link:{node:{getattr:It.node_ops.getattr,setattr:It.node_ops.setattr,readlink:It.node_ops.readlink},stream:{}},chrdev:{node:{getattr:It.node_ops.getattr,setattr:It.node_ops.setattr},stream:zt.chrdev_stream_ops}});var i=zt.createNode(e,t,r,n);return zt.isDir(i.mode)?(i.node_ops=It.ops_table.dir.node,i.stream_ops=It.ops_table.dir.stream,i.contents={}):zt.isFile(i.mode)?(i.node_ops=It.ops_table.file.node,i.stream_ops=It.ops_table.file.stream,i.usedBytes=0,i.contents=null):zt.isLink(i.mode)?(i.node_ops=It.ops_table.link.node,i.stream_ops=It.ops_table.link.stream):zt.isChrdev(i.mode)&&(i.node_ops=It.ops_table.chrdev.node,i.stream_ops=It.ops_table.chrdev.stream),i.timestamp=Date.now(),e&&(e.contents[t]=i,e.timestamp=i.timestamp),i},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){var r=e.contents?e.contents.length:0;if(!(r>=t)){t=Math.max(t,r*(r<1048576?2:1.125)>>>0),0!=r&&(t=Math.max(t,256));var n=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(n.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var r=e.contents;e.contents=new Uint8Array(t),r&&e.contents.set(r.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=zt.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,zt.isDir(e.mode)?t.size=4096:zt.isFile(e.mode)?t.size=e.usedBytes:zt.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&It.resizeFileStorage(e,t.size)},lookup:function(e,t){throw zt.genericErrors[44]},mknod:function(e,t,r,n){return It.createNode(e,t,r,n)},rename:function(e,t,r){if(zt.isDir(e.mode)){var n;try{n=zt.lookupNode(t,r)}catch(Gs){}if(n)for(var i in n.contents)throw new zt.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=r,t.contents[r]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink:function(e,t){delete e.contents[t],e.timestamp=Date.now()},rmdir:function(e,t){var r=zt.lookupNode(e,t);for(var n in r.contents)throw new zt.ErrnoError(55);delete e.contents[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."];for(var r in e.contents)e.contents.hasOwnProperty(r)&&t.push(r);return t},symlink:function(e,t,r){var n=It.createNode(e,t,41471,0);return n.link=r,n},readlink:function(e){if(!zt.isLink(e.mode))throw new zt.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,r,n,i){var o=e.node.contents;if(i>=e.node.usedBytes)return 0;var a=Math.min(e.node.usedBytes-i,n);if(a>8&&o.subarray)t.set(o.subarray(i,i+a),r);else for(var s=0;s<a;s++)t[r+s]=o[i+s];return a},write:function(e,t,r,n,i,o){if(t.buffer===O.buffer&&(o=!1),!n)return 0;var a=e.node;if(a.timestamp=Date.now(),t.subarray&&(!a.contents||a.contents.subarray)){if(o)return a.contents=t.subarray(r,r+n),a.usedBytes=n,n;if(0===a.usedBytes&&0===i)return a.contents=t.slice(r,r+n),a.usedBytes=n,n;if(i+n<=a.usedBytes)return a.contents.set(t.subarray(r,r+n),i),n}if(It.expandFileStorage(a,i+n),a.contents.subarray&&t.subarray)a.contents.set(t.subarray(r,r+n),i);else for(var s=0;s<n;s++)a.contents[i+s]=t[r+s];return a.usedBytes=Math.max(a.usedBytes,i+n),n},llseek:function(e,t,r){var n=t;if(1===r?n+=e.position:2===r&&zt.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new zt.ErrnoError(28);return n},allocate:function(e,t,r){It.expandFileStorage(e.node,t+r),e.node.usedBytes=Math.max(e.node.usedBytes,t+r)},mmap:function(e,t,r,n,i,o){if(0!==t)throw new zt.ErrnoError(28);if(!zt.isFile(e.node.mode))throw new zt.ErrnoError(43);var a,s,l=e.node.contents;if(2&o||l.buffer!==S){if((n>0||n+r<l.length)&&(l=l.subarray?l.subarray(n,n+r):Array.prototype.slice.call(l,n,n+r)),s=!0,!(a=void Y()))throw new zt.ErrnoError(48);O.set(l,a)}else s=!1,a=l.byteOffset;return{ptr:a,allocated:s}},msync:function(e,t,r,n,i){if(!zt.isFile(e.node.mode))throw new zt.ErrnoError(43);return 2&i||It.stream_ops.write(e,t,0,n,r,!1),0}}},zt={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(e,t){if(t=t||{},!(e=Lt.resolve(zt.cwd(),e)))return{path:"",node:null};var r={follow_mount:!0,recurse_count:0};for(var n in r)void 0===t[n]&&(t[n]=r[n]);if(t.recurse_count>8)throw new zt.ErrnoError(32);for(var i=kt.normalizeArray(e.split("/").filter((function(e){return!!e})),!1),o=zt.root,a="/",s=0;s<i.length;s++){var l=s===i.length-1;if(l&&t.parent)break;if(o=zt.lookupNode(o,i[s]),a=kt.join2(a,i[s]),zt.isMountpoint(o)&&(!l||l&&t.follow_mount)&&(o=o.mounted.root),!l||t.follow)for(var u=0;zt.isLink(o.mode);){var c=zt.readlink(a);if(a=Lt.resolve(kt.dirname(a),c),o=zt.lookupPath(a,{recurse_count:t.recurse_count}).node,u++>40)throw new zt.ErrnoError(32)}}return{path:a,node:o}},getPath:function(e){for(var t;;){if(zt.isRoot(e)){var r=e.mount.mountpoint;return t?"/"!==r[r.length-1]?r+"/"+t:r+t:r}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%zt.nameTable.length},hashAddNode:function(e){var t=zt.hashName(e.parent.id,e.name);e.name_next=zt.nameTable[t],zt.nameTable[t]=e},hashRemoveNode:function(e){var t=zt.hashName(e.parent.id,e.name);if(zt.nameTable[t]===e)zt.nameTable[t]=e.name_next;else for(var r=zt.nameTable[t];r;){if(r.name_next===e){r.name_next=e.name_next;break}r=r.name_next}},lookupNode:function(e,t){var r=zt.mayLookup(e);if(r)throw new zt.ErrnoError(r,e);for(var n=zt.hashName(e.id,t),i=zt.nameTable[n];i;i=i.name_next){var o=i.name;if(i.parent.id===e.id&&o===t)return i}return zt.lookup(e,t)},createNode:function(e,t,r,n){var i=new zt.FSNode(e,t,r,n);return zt.hashAddNode(i),i},destroyNode:function(e){zt.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return 32768==(61440&e)},isDir:function(e){return 16384==(61440&e)},isLink:function(e){return 40960==(61440&e)},isChrdev:function(e){return 8192==(61440&e)},isBlkdev:function(e){return 24576==(61440&e)},isFIFO:function(e){return 4096==(61440&e)},isSocket:function(e){return 49152==(49152&e)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(e){var t=zt.flagModes[e];if(void 0===t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return zt.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2},mayLookup:function(e){var t=zt.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(e,t){try{return zt.lookupNode(e,t),20}catch(Gs){}return zt.nodePermissions(e,"wx")},mayDelete:function(e,t,r){var n;try{n=zt.lookupNode(e,t)}catch(Gs){return Gs.errno}var i=zt.nodePermissions(e,"wx");if(i)return i;if(r){if(!zt.isDir(n.mode))return 54;if(zt.isRoot(n)||zt.getPath(n)===zt.cwd())return 10}else if(zt.isDir(n.mode))return 31;return 0},mayOpen:function(e,t){return e?zt.isLink(e.mode)?32:zt.isDir(e.mode)&&("r"!==zt.flagsToPermissionString(t)||512&t)?31:zt.nodePermissions(e,zt.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||zt.MAX_OPEN_FDS;for(var r=e;r<=t;r++)if(!zt.streams[r])return r;throw new zt.ErrnoError(33)},getStream:function(e){return zt.streams[e]},createStream:function(e,t,r){zt.FSStream||(zt.FSStream=function(){},zt.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var n=new zt.FSStream;for(var i in e)n[i]=e[i];e=n;var o=zt.nextfd(t,r);return e.fd=o,zt.streams[o]=e,e},closeStream:function(e){zt.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=zt.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new zt.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){zt.devices[e]={stream_ops:t}},getDevice:function(e){return zt.devices[e]},getMounts:function(e){for(var t=[],r=[e];r.length;){var n=r.pop();t.push(n),r.push.apply(r,n.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),zt.syncFSRequests++,zt.syncFSRequests>1&&f("warning: "+zt.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=zt.getMounts(zt.root.mount),n=0;function i(e){return zt.syncFSRequests--,t(e)}function o(e){if(e)return o.errored?void 0:(o.errored=!0,i(e));++n>=r.length&&i(null)}r.forEach((function(t){if(!t.type.syncfs)return o(null);t.type.syncfs(t,e,o)}))},mount:function(e,t,r){var n,i="/"===r,o=!r;if(i&&zt.root)throw new zt.ErrnoError(10);if(!i&&!o){var a=zt.lookupPath(r,{follow_mount:!1});if(r=a.path,n=a.node,zt.isMountpoint(n))throw new zt.ErrnoError(10);if(!zt.isDir(n.mode))throw new zt.ErrnoError(54)}var s={type:e,opts:t,mountpoint:r,mounts:[]},l=e.mount(s);return l.mount=s,s.root=l,i?zt.root=l:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),l},unmount:function(e){var t=zt.lookupPath(e,{follow_mount:!1});if(!zt.isMountpoint(t.node))throw new zt.ErrnoError(28);var r=t.node,n=r.mounted,i=zt.getMounts(n);Object.keys(zt.nameTable).forEach((function(e){for(var t=zt.nameTable[e];t;){var r=t.name_next;i.includes(t.mount)&&zt.destroyNode(t),t=r}})),r.mounted=null;var o=r.mount.mounts.indexOf(n);r.mount.mounts.splice(o,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,r){var n=zt.lookupPath(e,{parent:!0}).node,i=kt.basename(e);if(!i||"."===i||".."===i)throw new zt.ErrnoError(28);var o=zt.mayCreate(n,i);if(o)throw new zt.ErrnoError(o);if(!n.node_ops.mknod)throw new zt.ErrnoError(63);return n.node_ops.mknod(n,i,t,r)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,zt.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,zt.mknod(e,t,0)},mkdirTree:function(e,t){for(var r=e.split("/"),n="",i=0;i<r.length;++i)if(r[i]){n+="/"+r[i];try{zt.mkdir(n,t)}catch(Gs){if(20!=Gs.errno)throw Gs}}},mkdev:function(e,t,r){return void 0===r&&(r=t,t=438),t|=8192,zt.mknod(e,t,r)},symlink:function(e,t){if(!Lt.resolve(e))throw new zt.ErrnoError(44);var r=zt.lookupPath(t,{parent:!0}).node;if(!r)throw new zt.ErrnoError(44);var n=kt.basename(t),i=zt.mayCreate(r,n);if(i)throw new zt.ErrnoError(i);if(!r.node_ops.symlink)throw new zt.ErrnoError(63);return r.node_ops.symlink(r,n,e)},rename:function(e,t){var r,n,i=kt.dirname(e),o=kt.dirname(t),a=kt.basename(e),s=kt.basename(t);if(r=zt.lookupPath(e,{parent:!0}).node,n=zt.lookupPath(t,{parent:!0}).node,!r||!n)throw new zt.ErrnoError(44);if(r.mount!==n.mount)throw new zt.ErrnoError(75);var l,u=zt.lookupNode(r,a),c=Lt.relative(e,o);if("."!==c.charAt(0))throw new zt.ErrnoError(28);if("."!==(c=Lt.relative(t,i)).charAt(0))throw new zt.ErrnoError(55);try{l=zt.lookupNode(n,s)}catch(Gs){}if(u!==l){var h=zt.isDir(u.mode),d=zt.mayDelete(r,a,h);if(d)throw new zt.ErrnoError(d);if(d=l?zt.mayDelete(n,s,h):zt.mayCreate(n,s))throw new zt.ErrnoError(d);if(!r.node_ops.rename)throw new zt.ErrnoError(63);if(zt.isMountpoint(u)||l&&zt.isMountpoint(l))throw new zt.ErrnoError(10);if(n!==r&&(d=zt.nodePermissions(r,"w")))throw new zt.ErrnoError(d);zt.hashRemoveNode(u);try{r.node_ops.rename(u,n,s)}catch(Gs){throw Gs}finally{zt.hashAddNode(u)}}},rmdir:function(e){var t=zt.lookupPath(e,{parent:!0}).node,r=kt.basename(e),n=zt.lookupNode(t,r),i=zt.mayDelete(t,r,!0);if(i)throw new zt.ErrnoError(i);if(!t.node_ops.rmdir)throw new zt.ErrnoError(63);if(zt.isMountpoint(n))throw new zt.ErrnoError(10);t.node_ops.rmdir(t,r),zt.destroyNode(n)},readdir:function(e){var t=zt.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new zt.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=zt.lookupPath(e,{parent:!0}).node,r=kt.basename(e),n=zt.lookupNode(t,r),i=zt.mayDelete(t,r,!1);if(i)throw new zt.ErrnoError(i);if(!t.node_ops.unlink)throw new zt.ErrnoError(63);if(zt.isMountpoint(n))throw new zt.ErrnoError(10);t.node_ops.unlink(t,r),zt.destroyNode(n)},readlink:function(e){var t=zt.lookupPath(e).node;if(!t)throw new zt.ErrnoError(44);if(!t.node_ops.readlink)throw new zt.ErrnoError(28);return Lt.resolve(zt.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var r=zt.lookupPath(e,{follow:!t}).node;if(!r)throw new zt.ErrnoError(44);if(!r.node_ops.getattr)throw new zt.ErrnoError(63);return r.node_ops.getattr(r)},lstat:function(e){return zt.stat(e,!0)},chmod:function(e,t,r){var n;if(!(n="string"==typeof e?zt.lookupPath(e,{follow:!r}).node:e).node_ops.setattr)throw new zt.ErrnoError(63);n.node_ops.setattr(n,{mode:4095&t|-4096&n.mode,timestamp:Date.now()})},lchmod:function(e,t){zt.chmod(e,t,!0)},fchmod:function(e,t){var r=zt.getStream(e);if(!r)throw new zt.ErrnoError(8);zt.chmod(r.node,t)},chown:function(e,t,r,n){var i;if(!(i="string"==typeof e?zt.lookupPath(e,{follow:!n}).node:e).node_ops.setattr)throw new zt.ErrnoError(63);i.node_ops.setattr(i,{timestamp:Date.now()})},lchown:function(e,t,r){zt.chown(e,t,r,!0)},fchown:function(e,t,r){var n=zt.getStream(e);if(!n)throw new zt.ErrnoError(8);zt.chown(n.node,t,r)},truncate:function(e,t){if(t<0)throw new zt.ErrnoError(28);var r;if(!(r="string"==typeof e?zt.lookupPath(e,{follow:!0}).node:e).node_ops.setattr)throw new zt.ErrnoError(63);if(zt.isDir(r.mode))throw new zt.ErrnoError(31);if(!zt.isFile(r.mode))throw new zt.ErrnoError(28);var n=zt.nodePermissions(r,"w");if(n)throw new zt.ErrnoError(n);r.node_ops.setattr(r,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var r=zt.getStream(e);if(!r)throw new zt.ErrnoError(8);if(0==(2097155&r.flags))throw new zt.ErrnoError(28);zt.truncate(r.node,t)},utime:function(e,t,r){var n=zt.lookupPath(e,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(t,r)})},open:function(t,r,n,i,o){if(""===t)throw new zt.ErrnoError(44);var a;if(n=void 0===n?438:n,n=64&(r="string"==typeof r?zt.modeStringToFlags(r):r)?4095&n|32768:0,"object"==typeof t)a=t;else{t=kt.normalize(t);try{a=zt.lookupPath(t,{follow:!(131072&r)}).node}catch(Gs){}}var s=!1;if(64&r)if(a){if(128&r)throw new zt.ErrnoError(20)}else a=zt.mknod(t,n,0),s=!0;if(!a)throw new zt.ErrnoError(44);if(zt.isChrdev(a.mode)&&(r&=-513),65536&r&&!zt.isDir(a.mode))throw new zt.ErrnoError(54);if(!s){var l=zt.mayOpen(a,r);if(l)throw new zt.ErrnoError(l)}512&r&&zt.truncate(a,0),r&=-131713;var u=zt.createStream({node:a,path:zt.getPath(a),id:a.id,flags:r,mode:a.mode,seekable:!0,position:0,stream_ops:a.stream_ops,node_ops:a.node_ops,ungotten:[],error:!1},i,o);return u.stream_ops.open&&u.stream_ops.open(u),!e.logReadFiles||1&r||(zt.readFiles||(zt.readFiles={}),t in zt.readFiles||(zt.readFiles[t]=1)),u},close:function(e){if(zt.isClosed(e))throw new zt.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(Gs){throw Gs}finally{zt.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,r){if(zt.isClosed(e))throw new zt.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new zt.ErrnoError(70);if(0!=r&&1!=r&&2!=r)throw new zt.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,r),e.ungotten=[],e.position},read:function(e,t,r,n,i){if(n<0||i<0)throw new zt.ErrnoError(28);if(zt.isClosed(e))throw new zt.ErrnoError(8);if(1==(2097155&e.flags))throw new zt.ErrnoError(8);if(zt.isDir(e.node.mode))throw new zt.ErrnoError(31);if(!e.stream_ops.read)throw new zt.ErrnoError(28);var o=void 0!==i;if(o){if(!e.seekable)throw new zt.ErrnoError(70)}else i=e.position;var a=e.stream_ops.read(e,t,r,n,i);return o||(e.position+=a),a},write:function(e,t,r,n,i,o){if(n<0||i<0)throw new zt.ErrnoError(28);if(zt.isClosed(e))throw new zt.ErrnoError(8);if(0==(2097155&e.flags))throw new zt.ErrnoError(8);if(zt.isDir(e.node.mode))throw new zt.ErrnoError(31);if(!e.stream_ops.write)throw new zt.ErrnoError(28);e.seekable&&1024&e.flags&&zt.llseek(e,0,2);var a=void 0!==i;if(a){if(!e.seekable)throw new zt.ErrnoError(70)}else i=e.position;var s=e.stream_ops.write(e,t,r,n,i,o);return a||(e.position+=s),s},allocate:function(e,t,r){if(zt.isClosed(e))throw new zt.ErrnoError(8);if(t<0||r<=0)throw new zt.ErrnoError(28);if(0==(2097155&e.flags))throw new zt.ErrnoError(8);if(!zt.isFile(e.node.mode)&&!zt.isDir(e.node.mode))throw new zt.ErrnoError(43);if(!e.stream_ops.allocate)throw new zt.ErrnoError(138);e.stream_ops.allocate(e,t,r)},mmap:function(e,t,r,n,i,o){if(0!=(2&i)&&0==(2&o)&&2!=(2097155&e.flags))throw new zt.ErrnoError(2);if(1==(2097155&e.flags))throw new zt.ErrnoError(2);if(!e.stream_ops.mmap)throw new zt.ErrnoError(43);return e.stream_ops.mmap(e,t,r,n,i,o)},msync:function(e,t,r,n,i){return e&&e.stream_ops.msync?e.stream_ops.msync(e,t,r,n,i):0},munmap:function(e){return 0},ioctl:function(e,t,r){if(!e.stream_ops.ioctl)throw new zt.ErrnoError(59);return e.stream_ops.ioctl(e,t,r)},readFile:function(e,t){if((t=t||{}).flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var r,n=zt.open(e,t.flags),i=zt.stat(e).size,o=new Uint8Array(i);return zt.read(n,o,0,i,0),"utf8"===t.encoding?r=y(o,0):"binary"===t.encoding&&(r=o),zt.close(n),r},writeFile:function(e,t,r){(r=r||{}).flags=r.flags||577;var n=zt.open(e,r.flags,r.mode);if("string"==typeof t){var i=new Uint8Array(_(t)+1),o=x(t,i,0,i.length);zt.write(n,i,0,o,void 0,r.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");zt.write(n,t,0,t.byteLength,void 0,r.canOwn)}zt.close(n)},cwd:function(){return zt.currentPath},chdir:function(e){var t=zt.lookupPath(e,{follow:!0});if(null===t.node)throw new zt.ErrnoError(44);if(!zt.isDir(t.node.mode))throw new zt.ErrnoError(54);var r=zt.nodePermissions(t.node,"x");if(r)throw new zt.ErrnoError(r);zt.currentPath=t.path},createDefaultDirectories:function(){zt.mkdir("/tmp"),zt.mkdir("/home"),zt.mkdir("/home/web_user")},createDefaultDevices:function(){zt.mkdir("/dev"),zt.registerDevice(zt.makedev(1,3),{read:function(){return 0},write:function(e,t,r,n,i){return n}}),zt.mkdev("/dev/null",zt.makedev(1,3)),Ut.register(zt.makedev(5,0),Ut.default_tty_ops),Ut.register(zt.makedev(6,0),Ut.default_tty1_ops),zt.mkdev("/dev/tty",zt.makedev(5,0)),zt.mkdev("/dev/tty1",zt.makedev(6,0));var e=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}return function(){Y("randomDevice")}}();zt.createDevice("/dev","random",e),zt.createDevice("/dev","urandom",e),zt.mkdir("/dev/shm"),zt.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){zt.mkdir("/proc");var e=zt.mkdir("/proc/self");zt.mkdir("/proc/self/fd"),zt.mount({mount:function(){var t=zt.createNode(e,"fd",16895,73);return t.node_ops={lookup:function(e,t){var r=+t,n=zt.getStream(r);if(!n)throw new zt.ErrnoError(8);var i={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return n.path}}};return i.parent=i,i}},t}},{},"/proc/self/fd")},createStandardStreams:function(){e.stdin?zt.createDevice("/dev","stdin",e.stdin):zt.symlink("/dev/tty","/dev/stdin"),e.stdout?zt.createDevice("/dev","stdout",null,e.stdout):zt.symlink("/dev/tty","/dev/stdout"),e.stderr?zt.createDevice("/dev","stderr",null,e.stderr):zt.symlink("/dev/tty1","/dev/stderr"),zt.open("/dev/stdin",0),zt.open("/dev/stdout",1),zt.open("/dev/stderr",1)},ensureErrnoError:function(){zt.ErrnoError||(zt.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},zt.ErrnoError.prototype=new Error,zt.ErrnoError.prototype.constructor=zt.ErrnoError,[44].forEach((function(e){zt.genericErrors[e]=new zt.ErrnoError(e),zt.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:function(){zt.ensureErrnoError(),zt.nameTable=new Array(4096),zt.mount(It,{},"/"),zt.createDefaultDirectories(),zt.createDefaultDevices(),zt.createSpecialDirectories(),zt.filesystems={MEMFS:It}},init:function(t,r,n){zt.init.initialized=!0,zt.ensureErrnoError(),e.stdin=t||e.stdin,e.stdout=r||e.stdout,e.stderr=n||e.stderr,zt.createStandardStreams()},quit:function(){zt.init.initialized=!1;var t=e._fflush;t&&t(0);for(var r=0;r<zt.streams.length;r++){var n=zt.streams[r];n&&zt.close(n)}},getMode:function(e,t){var r=0;return e&&(r|=365),t&&(r|=146),r},findObject:function(e,t){var r=zt.analyzePath(e,t);return r.exists?r.object:null},analyzePath:function(e,t){try{e=(n=zt.lookupPath(e,{follow:!t})).path}catch(Gs){}var r={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var n=zt.lookupPath(e,{parent:!0});r.parentExists=!0,r.parentPath=n.path,r.parentObject=n.node,r.name=kt.basename(e),n=zt.lookupPath(e,{follow:!t}),r.exists=!0,r.path=n.path,r.object=n.node,r.name=n.node.name,r.isRoot="/"===n.path}catch(Gs){r.error=Gs.errno}return r},createPath:function(e,t,r,n){e="string"==typeof e?e:zt.getPath(e);for(var i=t.split("/").reverse();i.length;){var o=i.pop();if(o){var a=kt.join2(e,o);try{zt.mkdir(a)}catch(Gs){}e=a}}return a},createFile:function(e,t,r,n,i){var o=kt.join2("string"==typeof e?e:zt.getPath(e),t),a=zt.getMode(n,i);return zt.create(o,a)},createDataFile:function(e,t,r,n,i,o){var a=t?kt.join2("string"==typeof e?e:zt.getPath(e),t):e,s=zt.getMode(n,i),l=zt.create(a,s);if(r){if("string"==typeof r){for(var u=new Array(r.length),c=0,h=r.length;c<h;++c)u[c]=r.charCodeAt(c);r=u}zt.chmod(l,146|s);var d=zt.open(l,577);zt.write(d,r,0,r.length,0,o),zt.close(d),zt.chmod(l,s)}return l},createDevice:function(e,t,r,n){var i=kt.join2("string"==typeof e?e:zt.getPath(e),t),o=zt.getMode(!!r,!!n);zt.createDevice.major||(zt.createDevice.major=64);var a=zt.makedev(zt.createDevice.major++,0);return zt.registerDevice(a,{open:function(e){e.seekable=!1},close:function(e){n&&n.buffer&&n.buffer.length&&n(10)},read:function(e,t,n,i,o){for(var a=0,s=0;s<i;s++){var l;try{l=r()}catch(Gs){throw new zt.ErrnoError(29)}if(void 0===l&&0===a)throw new zt.ErrnoError(6);if(null==l)break;a++,t[n+s]=l}return a&&(e.node.timestamp=Date.now()),a},write:function(e,t,r,i,o){for(var a=0;a<i;a++)try{n(t[r+a])}catch(Gs){throw new zt.ErrnoError(29)}return i&&(e.node.timestamp=Date.now()),a}}),zt.mkdev(i,o,a)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!o)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=qt(o(e.url),!0),e.usedBytes=e.contents.length}catch(Gs){throw new zt.ErrnoError(29)}},createLazyFile:function(e,t,r,n,i){function o(){this.lengthKnown=!1,this.chunks=[]}if(o.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,r=e/this.chunkSize|0;return this.getter(r)[t]}},o.prototype.setDataGetter=function(e){this.getter=e},o.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",r,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+r+". Status: "+e.status);var t,n=Number(e.getResponseHeader("Content-length")),i=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,o=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,a=1048576;i||(a=n);var s=this;s.setDataGetter((function(e){var t=e*a,i=(e+1)*a-1;if(i=Math.min(i,n-1),void 0===s.chunks[e]&&(s.chunks[e]=function(e,t){if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>n-1)throw new Error("only "+n+" bytes available! programmer error!");var i=new XMLHttpRequest;if(i.open("GET",r,!1),n!==a&&i.setRequestHeader("Range","bytes="+e+"-"+t),"undefined"!=typeof Uint8Array&&(i.responseType="arraybuffer"),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.send(null),!(i.status>=200&&i.status<300||304===i.status))throw new Error("Couldn't load "+r+". Status: "+i.status);return void 0!==i.response?new Uint8Array(i.response||[]):qt(i.responseText||"",!0)}(t,i)),void 0===s.chunks[e])throw new Error("doXHR failed!");return s.chunks[e]})),!o&&n||(a=n=1,n=this.getter(0).length,a=n,p("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=a,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var a={isDevice:!1,url:r},s=zt.createFile(e,t,a,n,i);a.contents?s.contents=a.contents:a.url&&(s.contents=null,s.url=a.url),Object.defineProperties(s,{usedBytes:{get:function(){return this.contents.length}}});var l={};return Object.keys(s.stream_ops).forEach((function(e){var t=s.stream_ops[e];l[e]=function(){return zt.forceLoadFile(s),t.apply(null,arguments)}})),l.read=function(e,t,r,n,i){zt.forceLoadFile(s);var o=e.node.contents;if(i>=o.length)return 0;var a=Math.min(o.length-i,n);if(o.slice)for(var l=0;l<a;l++)t[r+l]=o[i+l];else for(l=0;l<a;l++)t[r+l]=o.get(i+l);return a},s.stream_ops=l,s},createPreloadedFile:function(t,r,n,i,o,s,l,u,c,h){Browser.init();var d=r?Lt.resolve(kt.join2(t,r)):t;function p(n){function a(e){h&&h(),u||zt.createDataFile(t,r,e,i,o,c),s&&s(),X()}var p=!1;e.preloadPlugins.forEach((function(e){p||e.canHandle(d)&&(e.handle(n,d,a,(function(){l&&l(),X()})),p=!0)})),p||a(n)}$(),"string"==typeof n?function(e,t,r,n){var i=n?"":"al "+e;a(e,(function(r){v(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),i&&X()}),(function(t){if(!r)throw'Loading data file "'+e+'" failed.';r()})),i&&$()}(n,(function(e){p(e)}),l):p(n)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,r){t=t||function(){},r=r||function(){};var n=zt.indexedDB();try{var i=n.open(zt.DB_NAME(),zt.DB_VERSION)}catch(Gs){return r(Gs)}i.onupgradeneeded=function(){p("creating db"),i.result.createObjectStore(zt.DB_STORE_NAME)},i.onsuccess=function(){var n=i.result.transaction([zt.DB_STORE_NAME],"readwrite"),o=n.objectStore(zt.DB_STORE_NAME),a=0,s=0,l=e.length;function u(){0==s?t():r()}e.forEach((function(e){var t=o.put(zt.analyzePath(e).object.contents,e);t.onsuccess=function(){++a+s==l&&u()},t.onerror=function(){s++,a+s==l&&u()}})),n.onerror=r},i.onerror=r},loadFilesFromDB:function(e,t,r){t=t||function(){},r=r||function(){};var n=zt.indexedDB();try{var i=n.open(zt.DB_NAME(),zt.DB_VERSION)}catch(Gs){return r(Gs)}i.onupgradeneeded=r,i.onsuccess=function(){var n=i.result;try{var o=n.transaction([zt.DB_STORE_NAME],"readonly")}catch(Gs){return void r(Gs)}var a=o.objectStore(zt.DB_STORE_NAME),s=0,l=0,u=e.length;function c(){0==l?t():r()}e.forEach((function(e){var t=a.get(e);t.onsuccess=function(){zt.analyzePath(e).exists&&zt.unlink(e),zt.createDataFile(kt.dirname(e),kt.basename(e),t.result,!0,!0,!0),++s+l==u&&c()},t.onerror=function(){l++,s+l==u&&c()}})),o.onerror=r},i.onerror=r}},Rt={mappings:{},DEFAULT_POLLMASK:5,calculateAt:function(e,t,r){if("/"===t[0])return t;var n;if(-100===e)n=zt.cwd();else{var i=zt.getStream(e);if(!i)throw new zt.ErrnoError(8);n=i.path}if(0==t.length){if(!r)throw new zt.ErrnoError(44);return n}return kt.join2(n,t)},doStat:function(e,t,r){try{var n=e(t)}catch(Gs){if(Gs&&Gs.node&&kt.normalize(t)!==kt.normalize(zt.getPath(Gs.node)))return-54;throw Gs}return A[r>>2]=n.dev,A[r+4>>2]=0,A[r+8>>2]=n.ino,A[r+12>>2]=n.mode,A[r+16>>2]=n.nlink,A[r+20>>2]=n.uid,A[r+24>>2]=n.gid,A[r+28>>2]=n.rdev,A[r+32>>2]=0,J=[n.size>>>0,(Q=n.size,+Math.abs(Q)>=1?Q>0?(0|Math.min(+Math.floor(Q/4294967296),4294967295))>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],A[r+40>>2]=J[0],A[r+44>>2]=J[1],A[r+48>>2]=4096,A[r+52>>2]=n.blocks,A[r+56>>2]=n.atime.getTime()/1e3|0,A[r+60>>2]=0,A[r+64>>2]=n.mtime.getTime()/1e3|0,A[r+68>>2]=0,A[r+72>>2]=n.ctime.getTime()/1e3|0,A[r+76>>2]=0,J=[n.ino>>>0,(Q=n.ino,+Math.abs(Q)>=1?Q>0?(0|Math.min(+Math.floor(Q/4294967296),4294967295))>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],A[r+80>>2]=J[0],A[r+84>>2]=J[1],0},doMsync:function(e,t,r,n,i){var o=T.slice(e,e+r);zt.msync(t,o,i,r,n)},doMkdir:function(e,t){return"/"===(e=kt.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),zt.mkdir(e,t,0),0},doMknod:function(e,t,r){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return zt.mknod(e,t,r),0},doReadlink:function(e,t,r){if(r<=0)return-28;var n=zt.readlink(e),i=Math.min(r,_(n)),o=O[t+i];return w(n,t,r+1),O[t+i]=o,i},doAccess:function(e,t){if(-8&t)return-28;var r;if(!(r=zt.lookupPath(e,{follow:!0}).node))return-44;var n="";return 4&t&&(n+="r"),2&t&&(n+="w"),1&t&&(n+="x"),n&&zt.nodePermissions(r,n)?-2:0},doDup:function(e,t,r){var n=zt.getStream(r);return n&&zt.close(n),zt.open(e,t,0,r,r).fd},doReadv:function(e,t,r,n){for(var i=0,o=0;o<r;o++){var a=A[t+8*o>>2],s=A[t+(8*o+4)>>2],l=zt.read(e,O,a,s,n);if(l<0)return-1;if(i+=l,l<s)break}return i},doWritev:function(e,t,r,n){for(var i=0,o=0;o<r;o++){var a=A[t+8*o>>2],s=A[t+(8*o+4)>>2],l=zt.write(e,O,a,s,n);if(l<0)return-1;i+=l}return i},varargs:void 0,get:function(){return Rt.varargs+=4,A[Rt.varargs-4>>2]},getStr:function(e){return b(e)},getStreamFromFD:function(e){var t=zt.getStream(e);if(!t)throw new zt.ErrnoError(8);return t},get64:function(e,t){return e}};function Nt(e){return e%4==0&&(e%100!=0||e%400==0)}function Bt(e,t){for(var r=0,n=0;n<=t;r+=e[n++]);return r}var Ft=[31,29,31,30,31,30,31,31,30,31,30,31],jt=[31,28,31,30,31,30,31,31,30,31,30,31];function Gt(e,t){for(var r=new Date(e.getTime());t>0;){var n=Nt(r.getFullYear()),i=r.getMonth(),o=(n?Ft:jt)[i];if(!(t>o-r.getDate()))return r.setDate(r.getDate()+t),r;t-=o-r.getDate()+1,r.setDate(1),i<11?r.setMonth(i+1):(r.setMonth(0),r.setFullYear(r.getFullYear()+1))}return r}ye=e.InternalError=ge(Error,"InternalError"),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);Se=e}(),Te=e.BindingError=ge(Error,"BindingError"),Ge.prototype.isAliasOf=Ae,Ge.prototype.clone=Ie,Ge.prototype.delete=ze,Ge.prototype.isDeleted=Re,Ge.prototype.deleteLater=je,lt.prototype.getPointee=Ke,lt.prototype.destructor=Qe,lt.prototype.argPackAdvance=8,lt.prototype.readValueFromPointer=ue,lt.prototype.deleteObject=Je,lt.prototype.fromWireType=st,e.getInheritedInstanceCount=tt,e.getLiveInheritedInstances=rt,e.flushPendingDeletes=Fe,e.setDelayFunction=nt,dt=e.UnboundTypeError=ge(Error,"UnboundTypeError"),e.count_emval_handles=wt,e.get_first_emval=_t;var Vt=function(e,t,r,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=zt.nextInode++,this.name=t,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n},Ht=365,Wt=146;function qt(e,t,r){var n=r>0?r:_(e)+1,i=new Array(n),o=x(e,i,0,i.length);return t&&(i.length=o),i}Object.defineProperties(Vt.prototype,{read:{get:function(){return(this.mode&Ht)===Ht},set:function(e){e?this.mode|=Ht:this.mode&=-366}},write:{get:function(){return(this.mode&Wt)===Wt},set:function(e){e?this.mode|=Wt:this.mode&=-147}},isFolder:{get:function(){return zt.isDir(this.mode)}},isDevice:{get:function(){return zt.isChrdev(this.mode)}}}),zt.FSNode=Vt,zt.staticInit();var $t={d:function(e){return Xt(e+16)+16},e:function(e,t,r){throw new ae(e).init(t,r),e},n:function(e){var t=se[e];delete se[e];var r=t.elements,n=r.length,i=r.map((function(e){return e.getterReturnType})).concat(r.map((function(e){return e.setterArgumentType}))),o=t.rawConstructor,a=t.rawDestructor;xe([e],i,(function(e){return r.forEach((function(t,r){var i=e[r],o=t.getter,a=t.getterContext,s=e[r+n],l=t.setter,u=t.setterContext;t.read=function(e){return i.fromWireType(o(a,e))},t.write=function(e,t){var r=[];l(u,e,s.toWireType(r,t)),le(r)}})),[{name:t.name,fromWireType:function(e){for(var t=new Array(n),i=0;i<n;++i)t[i]=r[i].read(e);return a(e),t},toWireType:function(e,i){if(n!==i.length)throw new TypeError("Incorrect number of tuple elements for "+t.name+": expected="+n+", actual="+i.length);for(var s=o(),l=0;l<n;++l)r[l].write(s,i[l]);return null!==e&&e.push(a,s),s},argPackAdvance:8,readValueFromPointer:ue,destructorFunction:a}]}))},p:function(e){var t=we[e];delete we[e];var r=t.rawConstructor,n=t.rawDestructor,i=t.fields;xe([e],i.map((function(e){return e.getterReturnType})).concat(i.map((function(e){return e.setterArgumentType}))),(function(e){var o={};return i.forEach((function(t,r){var n=t.fieldName,a=e[r],s=t.getter,l=t.getterContext,u=e[r+i.length],c=t.setter,h=t.setterContext;o[n]={read:function(e){return a.fromWireType(s(l,e))},write:function(e,t){var r=[];c(h,e,u.toWireType(r,t)),le(r)}}})),[{name:t.name,fromWireType:function(e){var t={};for(var r in o)t[r]=o[r].read(e);return n(e),t},toWireType:function(e,t){for(var i in o)if(!(i in t))throw new TypeError('Missing field:  "'+i+'"');var a=r();for(i in o)o[i].write(a,t[i]);return null!==e&&e.push(n,a),a},argPackAdvance:8,readValueFromPointer:ue,destructorFunction:n}]}))},y:function(e,t,r,n,i){},I:function(e,t,r,n,i){var o=_e(r);Ce(e,{name:t=Oe(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:i},argPackAdvance:8,readValueFromPointer:function(e){var n;if(1===r)n=O;else if(2===r)n=E;else{if(4!==r)throw new TypeError("Unknown boolean type size: "+t);n=A}return this.fromWireType(n[e>>o])},destructorFunction:null})},h:function(e,t,r,n,i,o,a,s,l,u,c,h,d){c=Oe(c),o=ht(i,o),s&&(s=ht(a,s)),u&&(u=ht(l,u)),d=ht(h,d);var p=me(c);We(p,(function(){ft("Cannot construct "+c+" due to unbound types",[n])})),xe([e,t,r],n?[n]:[],(function(t){var r,i;t=t[0],i=n?(r=t.registeredClass).instancePrototype:Ge.prototype;var a=ve(p,(function(){if(Object.getPrototypeOf(this)!==l)throw new Te("Use 'new' to construct "+c);if(void 0===h.constructor_body)throw new Te(c+" has no accessible constructor");var e=h.constructor_body[arguments.length];if(void 0===e)throw new Te("Tried to invoke ctor of "+c+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(h.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),l=Object.create(i,{constructor:{value:a}});a.prototype=l;var h=new qe(c,a,l,d,r,o,s,u),f=new lt(c,h,!0,!1,!1),m=new lt(c+"*",h,!1,!1,!1),v=new lt(c+" const*",h,!1,!0,!1);return Ve[e]={pointerType:m,constPointerType:v},ut(p,a),[f,m,v]}))},g:function(e,t,r,n,i,o){v(t>0);var a=mt(t,r);i=ht(n,i),xe([],[e],(function(e){var r="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new Te("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){ft("Cannot construct "+e.name+" due to unbound types",a)},xe([],a,(function(n){return n.splice(1,0,null),e.registeredClass.constructor_body[t-1]=vt(r,n,null,i,o),[]})),[]}))},c:function(e,t,r,n,i,o,a,s){var l=mt(r,n);t=Oe(t),o=ht(i,o),xe([],[e],(function(e){var n=(e=e[0]).name+"."+t;function i(){ft("Cannot call "+n+" due to unbound types",l)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),s&&e.registeredClass.pureVirtualFunctions.push(t);var u=e.registeredClass.instancePrototype,c=u[t];return void 0===c||void 0===c.overloadTable&&c.className!==e.name&&c.argCount===r-2?(i.argCount=r-2,i.className=e.name,u[t]=i):(He(u,t,n),u[t].overloadTable[r-2]=i),xe([],l,(function(i){var s=vt(n,i,e,o,a);return void 0===u[t].overloadTable?(s.argCount=r-2,u[t]=s):u[t].overloadTable[r-2]=s,[]})),[]}))},r:function(e,t,r,n,i,o,a,s,l,u){t=Oe(t),i=ht(n,i),xe([],[e],(function(e){var n=(e=e[0]).name+"."+t,c={get:function(){ft("Cannot access "+n+" due to unbound types",[r,a])},enumerable:!0,configurable:!0};return c.set=l?function(){ft("Cannot access "+n+" due to unbound types",[r,a])}:function(e){Ee(n+" is a read-only property")},Object.defineProperty(e.registeredClass.instancePrototype,t,c),xe([],l?[r,a]:[r],(function(r){var a=r[0],c={get:function(){var t=gt(this,e,n+" getter");return a.fromWireType(i(o,t))},enumerable:!0};if(l){l=ht(s,l);var h=r[1];c.set=function(t){var r=gt(this,e,n+" setter"),i=[];l(u,r,h.toWireType(i,t)),le(i)}}return Object.defineProperty(e.registeredClass.instancePrototype,t,c),[]})),[]}))},H:function(e,t){Ce(e,{name:t=Oe(t),fromWireType:function(e){var t=St.toValue(e);return xt(e),t},toWireType:function(e,t){return St.toHandle(t)},argPackAdvance:8,readValueFromPointer:ue,destructorFunction:null})},q:function(e,t,r,n){var i=_e(r);function o(){}t=Oe(t),o.values={},Ce(e,{name:t,constructor:o,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:Ot(t,i,n),destructorFunction:null}),We(t,o)},i:function(e,t,r){var n=Tt(e,"enum");t=Oe(t);var i=n.constructor,o=Object.create(n.constructor.prototype,{value:{value:r},constructor:{value:ve(n.name+"_"+t,(function(){}))}});i.values[r]=o,i[t]=o},v:function(e,t,r){var n=_e(r);Ce(e,{name:t=Oe(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+Et(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:Ct(t,n),destructorFunction:null})},a:function(e,t,r,n,i,o){var a=mt(t,r);e=Oe(e),i=ht(n,i),We(e,(function(){ft("Cannot call "+e+" due to unbound types",a)}),t-1),xe([],a,(function(r){var n=[r[0],null].concat(r.slice(1));return ut(e,vt(e,n,null,i,o),t-1),[]}))},k:function(e,t,r,n,i){t=Oe(t),-1===i&&(i=4294967295);var o=_e(r),a=function(e){return e};if(0===n){var s=32-8*r;a=function(e){return e<<s>>>s}}var l=t.includes("unsigned");Ce(e,{name:t,fromWireType:a,toWireType:function(e,r){if("number"!=typeof r&&"boolean"!=typeof r)throw new TypeError('Cannot convert "'+Et(r)+'" to '+this.name);if(r<n||r>i)throw new TypeError('Passing a number "'+Et(r)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+n+", "+i+"]!");return l?r>>>0:0|r},argPackAdvance:8,readValueFromPointer:At(t,o,0!==n),destructorFunction:null})},j:function(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function i(e){var t=M,r=t[e>>=2],i=t[e+1];return new n(S,i,r)}Ce(e,{name:r=Oe(r),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})},w:function(e,t){var r="std::string"===(t=Oe(t));Ce(e,{name:t,fromWireType:function(e){var t,n=M[e>>2];if(r)for(var i=e+4,o=0;o<=n;++o){var a=e+4+o;if(o==n||0==T[a]){var s=b(i,a-i);void 0===t?t=s:(t+=String.fromCharCode(0),t+=s),i=a+1}}else{var l=new Array(n);for(o=0;o<n;++o)l[o]=String.fromCharCode(T[e+4+o]);t=l.join("")}return Yt(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n="string"==typeof t;n||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||Ee("Cannot pass non-string to std::string");var i=(r&&n?function(){return _(t)}:function(){return t.length})(),o=Xt(4+i+1);if(M[o>>2]=i,r&&n)w(t,o+4,i+1);else if(n)for(var a=0;a<i;++a){var s=t.charCodeAt(a);s>255&&(Yt(o),Ee("String has UTF-16 code units that do not fit in 8 bits")),T[o+4+a]=s}else for(a=0;a<i;++a)T[o+4+a]=t[a];return null!==e&&e.push(Yt,o),o},argPackAdvance:8,readValueFromPointer:ue,destructorFunction:function(e){Yt(e)}})},t:function(e,t,r){var n,i,o,a,s;r=Oe(r),2===t?(n=U,i=I,a=z,o=function(){return C},s=1):4===t&&(n=R,i=N,a=B,o=function(){return M},s=2),Ce(e,{name:r,fromWireType:function(e){for(var r,i=M[e>>2],a=o(),l=e+4,u=0;u<=i;++u){var c=e+4+u*t;if(u==i||0==a[c>>s]){var h=n(l,c-l);void 0===r?r=h:(r+=String.fromCharCode(0),r+=h),l=c+t}}return Yt(e),r},toWireType:function(e,n){"string"!=typeof n&&Ee("Cannot pass non-string to C++ string type "+r);var o=a(n),l=Xt(4+o+t);return M[l>>2]=o>>s,i(n,l+4,o+t),null!==e&&e.push(Yt,l),l},argPackAdvance:8,readValueFromPointer:ue,destructorFunction:function(e){Yt(e)}})},o:function(e,t,r,n,i,o){se[e]={name:Oe(t),rawConstructor:ht(r,n),rawDestructor:ht(i,o),elements:[]}},b:function(e,t,r,n,i,o,a,s,l){se[e].elements.push({getterReturnType:t,getter:ht(r,n),getterContext:i,setterArgumentType:o,setter:ht(a,s),setterContext:l})},m:function(e,t,r,n,i,o){we[e]={name:Oe(t),rawConstructor:ht(r,n),rawDestructor:ht(i,o),fields:[]}},f:function(e,t,r,n,i,o,a,s,l,u){we[e].fields.push({fieldName:Oe(t),getterReturnType:r,getter:ht(n,i),getterContext:o,setterArgumentType:a,setter:ht(s,l),setterContext:u})},J:function(e,t){Ce(e,{isVoid:!0,name:t=Oe(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},K:xt,L:function(e){e>4&&(bt[e].refcount+=1)},l:function(e,t){var r=(e=Tt(e,"_emval_take_value")).readValueFromPointer(t);return St.toHandle(r)},u:function(){Y("")},A:function(e,t,r){T.copyWithin(e,t,t+r)},s:function(e){var t,r,n=T.length,i=2147483648;if((e>>>=0)>i)return!1;for(var o=1;o<=4;o*=2){var a=n*(1+.2/o);if(a=Math.min(a,e+100663296),Mt(Math.min(i,((t=Math.max(e,a))%(r=65536)>0&&(t+=r-t%r),t))))return!0}return!1},C:function(e,t){var r=0;return Pt().forEach((function(n,i){var o=t+r;A[e+4*i>>2]=o,function(e,t,r){for(var n=0;n<e.length;++n)O[t++>>0]=e.charCodeAt(n);r||(O[t>>0]=0)}(n,o),r+=n.length+1})),0},D:function(e,t){var r=Pt();A[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),A[t>>2]=n,0},G:function(e){try{var t=Rt.getStreamFromFD(e);return zt.close(t),0}catch(Gs){return void 0!==zt&&Gs instanceof zt.ErrnoError||Y(Gs),Gs.errno}},E:function(e,t,r,n){try{var i=Rt.getStreamFromFD(e),o=Rt.doReadv(i,t,r);return A[n>>2]=o,0}catch(Gs){return void 0!==zt&&Gs instanceof zt.ErrnoError||Y(Gs),Gs.errno}},x:function(e,t,r,n,i){try{var o=Rt.getStreamFromFD(e),a=4294967296*r+(t>>>0),s=9007199254740992;return a<=-s||a>=s?-61:(zt.llseek(o,a,n),J=[o.position>>>0,(Q=o.position,+Math.abs(Q)>=1?Q>0?(0|Math.min(+Math.floor(Q/4294967296),4294967295))>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],A[i>>2]=J[0],A[i+4>>2]=J[1],o.getdents&&0===a&&0===n&&(o.getdents=null),0)}catch(Gs){return void 0!==zt&&Gs instanceof zt.ErrnoError||Y(Gs),Gs.errno}},F:function(e,t,r,n){try{var i=Rt.getStreamFromFD(e),o=Rt.doWritev(i,t,r);return A[n>>2]=o,0}catch(Gs){return void 0!==zt&&Gs instanceof zt.ErrnoError||Y(Gs),Gs.errno}},z:function(e){},B:function(e,t,r,n){return function(e,t,r,n){var i=A[n+40>>2],o={tm_sec:A[n>>2],tm_min:A[n+4>>2],tm_hour:A[n+8>>2],tm_mday:A[n+12>>2],tm_mon:A[n+16>>2],tm_year:A[n+20>>2],tm_wday:A[n+24>>2],tm_yday:A[n+28>>2],tm_isdst:A[n+32>>2],tm_gmtoff:A[n+36>>2],tm_zone:i?b(i):""},a=b(r),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var l in s)a=a.replace(new RegExp(l,"g"),s[l]);var u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=["January","February","March","April","May","June","July","August","September","October","November","December"];function h(e,t,r){for(var n="number"==typeof e?e.toString():e||"";n.length<t;)n=r[0]+n;return n}function d(e,t){return h(e,t,"0")}function p(e,t){function r(e){return e<0?-1:e>0?1:0}var n;return 0===(n=r(e.getFullYear()-t.getFullYear()))&&0===(n=r(e.getMonth()-t.getMonth()))&&(n=r(e.getDate()-t.getDate())),n}function f(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function m(e){var t=Gt(new Date(e.tm_year+1900,0,1),e.tm_yday),r=new Date(t.getFullYear(),0,4),n=new Date(t.getFullYear()+1,0,4),i=f(r),o=f(n);return p(i,t)<=0?p(o,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var v={"%a":function(e){return u[e.tm_wday].substring(0,3)},"%A":function(e){return u[e.tm_wday]},"%b":function(e){return c[e.tm_mon].substring(0,3)},"%B":function(e){return c[e.tm_mon]},"%C":function(e){return d((e.tm_year+1900)/100|0,2)},"%d":function(e){return d(e.tm_mday,2)},"%e":function(e){return h(e.tm_mday,2," ")},"%g":function(e){return m(e).toString().substring(2)},"%G":function(e){return m(e)},"%H":function(e){return d(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),d(t,2)},"%j":function(e){return d(e.tm_mday+Bt(Nt(e.tm_year+1900)?Ft:jt,e.tm_mon-1),3)},"%m":function(e){return d(e.tm_mon+1,2)},"%M":function(e){return d(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return d(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),r=0===t.getDay()?t:Gt(t,7-t.getDay()),n=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(p(r,n)<0){var i=Bt(Nt(n.getFullYear())?Ft:jt,n.getMonth()-1)-31,o=31-r.getDate()+i+n.getDate();return d(Math.ceil(o/7),2)}return 0===p(r,t)?"01":"00"},"%V":function(e){var t,r=new Date(e.tm_year+1900,0,4),n=new Date(e.tm_year+1901,0,4),i=f(r),o=f(n),a=Gt(new Date(e.tm_year+1900,0,1),e.tm_yday);return p(a,i)<0?"53":p(o,a)<=0?"01":(t=i.getFullYear()<e.tm_year+1900?e.tm_yday+32-i.getDate():e.tm_yday+1-i.getDate(),d(Math.ceil(t/7),2))},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),r=1===t.getDay()?t:Gt(t,0===t.getDay()?1:7-t.getDay()+1),n=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(p(r,n)<0){var i=Bt(Nt(n.getFullYear())?Ft:jt,n.getMonth()-1)-31,o=31-r.getDate()+i+n.getDate();return d(Math.ceil(o/7),2)}return 0===p(r,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,r=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(r?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var l in v)a.includes(l)&&(a=a.replace(new RegExp(l,"g"),v[l](o)));var g=qt(a,!1);return g.length>t?0:(F(g,e),g.length-1)}(e,t,r,n)}};!function(){var t={a:$t};function n(t,r){var n,i=t.exports;e.asm=i,j((d=e.asm.M).buffer),k=e.asm.O,n=e.asm.N,V.unshift(n),X()}function i(e){n(e.instance)}function o(e){return(!h&&u&&"function"==typeof fetch?fetch(Z,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+Z+"'";return e.arrayBuffer()})).catch((function(){return re(Z)})):Promise.resolve().then((function(){return re(Z)}))).then((function(e){return WebAssembly.instantiate(e,t)})).then((function(e){return e})).then(e,(function(e){f("failed to asynchronously prepare wasm: "+e),Y(e)}))}if($(),e.instantiateWasm)try{return e.instantiateWasm(t,n)}catch(Gs){return f("Module.instantiateWasm callback failed with error: "+Gs),!1}(h||"function"!=typeof WebAssembly.instantiateStreaming||te(Z)||"function"!=typeof fetch?o(i):fetch(Z,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,t).then(i,(function(e){return f("wasm streaming compile failed: "+e),f("falling back to ArrayBuffer instantiation"),o(i)}))}))).catch(r)}(),e.___wasm_call_ctors=function(){return(e.___wasm_call_ctors=e.asm.N).apply(null,arguments)};var Xt=e._malloc=function(){return(Xt=e._malloc=e.asm.P).apply(null,arguments)},Yt=e._free=function(){return(Yt=e._free=e.asm.Q).apply(null,arguments)},Zt=e.___getTypeName=function(){return(Zt=e.___getTypeName=e.asm.R).apply(null,arguments)};e.___embind_register_native_and_builtin_types=function(){return(e.___embind_register_native_and_builtin_types=e.asm.S).apply(null,arguments)};var Kt,Qt=e.stackSave=function(){return(Qt=e.stackSave=e.asm.T).apply(null,arguments)},Jt=e.stackRestore=function(){return(Jt=e.stackRestore=e.asm.U).apply(null,arguments)},er=e.stackAlloc=function(){return(er=e.stackAlloc=e.asm.V).apply(null,arguments)};function tr(r){function n(){Kt||(Kt=!0,e.calledRun=!0,m||(e.noFSInit||zt.init.initialized||zt.init(),zt.ignorePermissions=!1,ne(V),t(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),function(){if(e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)t=e.postRun.shift(),H.unshift(t);var t;ne(H)}()))}W>0||(function(){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)t=e.preRun.shift(),G.unshift(t);var t;ne(G)}(),W>0||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),n()}),1)):n()))}if(e.dynCall_jiji=function(){return(e.dynCall_jiji=e.asm.W).apply(null,arguments)},e.dynCall_iiiiij=function(){return(e.dynCall_iiiiij=e.asm.X).apply(null,arguments)},e.dynCall_iiiiijj=function(){return(e.dynCall_iiiiijj=e.asm.Y).apply(null,arguments)},e.dynCall_iiiiiijj=function(){return(e.dynCall_iiiiiijj=e.asm.Z).apply(null,arguments)},e.dynCall_viijii=function(){return(e.dynCall_viijii=e.asm._).apply(null,arguments)},e.ccall=function(t,r,n,i,o){var a={string:function(e){var t=0;if(null!=e&&0!==e){var r=1+(e.length<<2);w(e,t=er(r),r)}return t},array:function(e){var t=er(e.length);return F(e,t),t}},s=function(t){var r=e["_"+t];return v(r,"Cannot call unknown function "+t+", make sure it is exported"),r}(t),l=[],u=0;if(i)for(var c=0;c<i.length;c++){var h=a[n[c]];h?(0===u&&(u=Qt()),l[c]=h(i[c])):l[c]=i[c]}var d,p=s.apply(null,l);return d=p,0!==u&&Jt(u),p=function(e){return"string"===r?b(e):"boolean"===r?Boolean(e):e}(d)},q=function e(){Kt||tr(),Kt||(q=e)},e.run=tr,e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return tr(),e.ready});const Og=Object.freeze(Object.defineProperty({__proto__:null,default:Sg},Symbol.toStringTag,{value:"Module"}));var Tg=((e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports))((()=>{}));String.prototype.codePointAt||function(){var e=function(){try{var e={},t=Object.defineProperty,r=t(e,e,e)&&t}catch{}return r}(),t=function(e){if(null==this)throw TypeError();var t=String(this),r=t.length,n=e?Number(e):0;if(n!=n&&(n=0),!(n<0||n>=r)){var i,o=t.charCodeAt(n);return o>=55296&&o<=56319&&r>n+1&&((i=t.charCodeAt(n+1))>=56320&&i<=57343)?1024*(o-55296)+i-56320+65536:o}};e?e(String.prototype,"codePointAt",{value:t,configurable:!0,writable:!0}):String.prototype.codePointAt=t}();var Eg=0,Cg=-3;function Ag(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function Mg(e,t){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=t,this.destLen=0,this.ltree=new Ag,this.dtree=new Ag}var Dg=new Ag,Pg=new Ag,kg=new Uint8Array(30),Lg=new Uint16Array(30),Ug=new Uint8Array(30),Ig=new Uint16Array(30),zg=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Rg=new Ag,Ng=new Uint8Array(320);function Bg(e,t,r,n){var i,o;for(i=0;i<r;++i)e[i]=0;for(i=0;i<30-r;++i)e[i+r]=i/r|0;for(o=n,i=0;i<30;++i)t[i]=o,o+=1<<e[i]}var Fg=new Uint16Array(16);function jg(e,t,r,n){var i,o;for(i=0;i<16;++i)e.table[i]=0;for(i=0;i<n;++i)e.table[t[r+i]]++;for(e.table[0]=0,o=0,i=0;i<16;++i)Fg[i]=o,o+=e.table[i];for(i=0;i<n;++i)t[r+i]&&(e.trans[Fg[t[r+i]]++]=i)}function Gg(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function Vg(e,t,r){if(!t)return r;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var n=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,n+r}function Hg(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=0,n=0,i=0,o=e.tag;do{n=2*n+(1&o),o>>>=1,++i,r+=t.table[i],n-=t.table[i]}while(n>=0);return e.tag=o,e.bitcount-=i,t.trans[r+n]}function Wg(e,t,r){var n,i,o,a,s,l;for(n=Vg(e,5,257),i=Vg(e,5,1),o=Vg(e,4,4),a=0;a<19;++a)Ng[a]=0;for(a=0;a<o;++a){var u=Vg(e,3,0);Ng[zg[a]]=u}for(jg(Rg,Ng,0,19),s=0;s<n+i;){var c=Hg(e,Rg);switch(c){case 16:var h=Ng[s-1];for(l=Vg(e,2,3);l;--l)Ng[s++]=h;break;case 17:for(l=Vg(e,3,3);l;--l)Ng[s++]=0;break;case 18:for(l=Vg(e,7,11);l;--l)Ng[s++]=0;break;default:Ng[s++]=c}}jg(t,Ng,0,n),jg(r,Ng,n,i)}function qg(e,t,r){for(;;){var n,i,o,a,s=Hg(e,t);if(256===s)return Eg;if(s<256)e.dest[e.destLen++]=s;else for(n=Vg(e,kg[s-=257],Lg[s]),i=Hg(e,r),a=o=e.destLen-Vg(e,Ug[i],Ig[i]);a<o+n;++a)e.dest[e.destLen++]=e.dest[a]}}function $g(e){for(var t,r;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if((t=256*(t=e.source[e.sourceIndex+1])+e.source[e.sourceIndex])!==(65535&~(256*e.source[e.sourceIndex+3]+e.source[e.sourceIndex+2])))return Cg;for(e.sourceIndex+=4,r=t;r;--r)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,Eg}!function(e,t){var r;for(r=0;r<7;++r)e.table[r]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,r=0;r<24;++r)e.trans[r]=256+r;for(r=0;r<144;++r)e.trans[24+r]=r;for(r=0;r<8;++r)e.trans[168+r]=280+r;for(r=0;r<112;++r)e.trans[176+r]=144+r;for(r=0;r<5;++r)t.table[r]=0;for(t.table[5]=32,r=0;r<32;++r)t.trans[r]=r}(Dg,Pg),Bg(kg,Lg,4,3),Bg(Ug,Ig,2,1),kg[28]=0,Lg[28]=258;var Xg=function(e,t){var r,n,i=new Mg(e,t);do{switch(r=Gg(i),Vg(i,2,0)){case 0:n=$g(i);break;case 1:n=qg(i,Dg,Pg);break;case 2:Wg(i,i.ltree,i.dtree),n=qg(i,i.ltree,i.dtree);break;default:n=Cg}if(n!==Eg)throw new Error("Data error")}while(!r);return i.destLen<i.dest.length?"function"==typeof i.dest.slice?i.dest.slice(0,i.destLen):i.dest.subarray(0,i.destLen):i.dest};function Yg(e,t,r,n,i){return Math.pow(1-i,3)*e+3*Math.pow(1-i,2)*i*t+3*(1-i)*Math.pow(i,2)*r+Math.pow(i,3)*n}function Zg(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}function Kg(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}function Qg(e){throw new Error(e)}function Jg(e,t){e||Qg(t)}Zg.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},Zg.prototype.addPoint=function(e,t){"number"==typeof e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),"number"==typeof t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},Zg.prototype.addX=function(e){this.addPoint(e,null)},Zg.prototype.addY=function(e){this.addPoint(null,e)},Zg.prototype.addBezier=function(e,t,r,n,i,o,a,s){var l=[e,t],u=[r,n],c=[i,o],h=[a,s];this.addPoint(e,t),this.addPoint(a,s);for(var d=0;d<=1;d++){var p=6*l[d]-12*u[d]+6*c[d],f=-3*l[d]+9*u[d]-9*c[d]+3*h[d],m=3*u[d]-3*l[d];if(0!==f){var v=Math.pow(p,2)-4*m*f;if(!(v<0)){var g=(-p+Math.sqrt(v))/(2*f);0<g&&g<1&&(0===d&&this.addX(Yg(l[d],u[d],c[d],h[d],g)),1===d&&this.addY(Yg(l[d],u[d],c[d],h[d],g)));var y=(-p-Math.sqrt(v))/(2*f);0<y&&y<1&&(0===d&&this.addX(Yg(l[d],u[d],c[d],h[d],y)),1===d&&this.addY(Yg(l[d],u[d],c[d],h[d],y)))}}else{if(0===p)continue;var b=-m/p;0<b&&b<1&&(0===d&&this.addX(Yg(l[d],u[d],c[d],h[d],b)),1===d&&this.addY(Yg(l[d],u[d],c[d],h[d],b)))}}},Zg.prototype.addQuad=function(e,t,r,n,i,o){var a=e+.6666666666666666*(r-e),s=t+2/3*(n-t),l=a+1/3*(i-e),u=s+1/3*(o-t);this.addBezier(e,t,a,s,l,u,i,o)},Kg.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},Kg.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},Kg.prototype.curveTo=Kg.prototype.bezierCurveTo=function(e,t,r,n,i,o){this.commands.push({type:"C",x1:e,y1:t,x2:r,y2:n,x:i,y:o})},Kg.prototype.quadTo=Kg.prototype.quadraticCurveTo=function(e,t,r,n){this.commands.push({type:"Q",x1:e,y1:t,x:r,y:n})},Kg.prototype.close=Kg.prototype.closePath=function(){this.commands.push({type:"Z"})},Kg.prototype.extend=function(e){if(e.commands)e=e.commands;else if(e instanceof Zg){var t=e;return this.moveTo(t.x1,t.y1),this.lineTo(t.x2,t.y1),this.lineTo(t.x2,t.y2),this.lineTo(t.x1,t.y2),void this.close()}Array.prototype.push.apply(this.commands,e)},Kg.prototype.getBoundingBox=function(){for(var e=new Zg,t=0,r=0,n=0,i=0,o=0;o<this.commands.length;o++){var a=this.commands[o];switch(a.type){case"M":e.addPoint(a.x,a.y),t=n=a.x,r=i=a.y;break;case"L":e.addPoint(a.x,a.y),n=a.x,i=a.y;break;case"Q":e.addQuad(n,i,a.x1,a.y1,a.x,a.y),n=a.x,i=a.y;break;case"C":e.addBezier(n,i,a.x1,a.y1,a.x2,a.y2,a.x,a.y),n=a.x,i=a.y;break;case"Z":n=t,i=r;break;default:throw new Error("Unexpected path command "+a.type)}}return e.isEmpty()&&e.addPoint(0,0),e},Kg.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var r=this.commands[t];"M"===r.type?e.moveTo(r.x,r.y):"L"===r.type?e.lineTo(r.x,r.y):"C"===r.type?e.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):"Q"===r.type?e.quadraticCurveTo(r.x1,r.y1,r.x,r.y):"Z"===r.type&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},Kg.prototype.toPathData=function(e){function t(t){return Math.round(t)===t?""+Math.round(t):t.toFixed(e)}function r(){for(var e=arguments,r="",n=0;n<arguments.length;n+=1){var i=e[n];i>=0&&n>0&&(r+=" "),r+=t(i)}return r}e=void 0!==e?e:2;for(var n="",i=0;i<this.commands.length;i+=1){var o=this.commands[i];"M"===o.type?n+="M"+r(o.x,o.y):"L"===o.type?n+="L"+r(o.x,o.y):"C"===o.type?n+="C"+r(o.x1,o.y1,o.x2,o.y2,o.x,o.y):"Q"===o.type?n+="Q"+r(o.x1,o.y1,o.x,o.y):"Z"===o.type&&(n+="Z")}return n},Kg.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&&"black"!==this.fill&&(null===this.fill?t+=' fill="none"':t+=' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>"},Kg.prototype.toDOMElement=function(e){var t=this.toPathData(e),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",t),r};var ey={fail:Qg,argument:Jg,assert:Jg},ty=2147483648,ry={},ny={},iy={};function oy(e){return function(){return e}}ny.BYTE=function(e){return ey.argument(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]},iy.BYTE=oy(1),ny.CHAR=function(e){return[e.charCodeAt(0)]},iy.CHAR=oy(1),ny.CHARARRAY=function(e){typeof e>"u"&&(e="");for(var t=[],r=0;r<e.length;r+=1)t[r]=e.charCodeAt(r);return t},iy.CHARARRAY=function(e){return typeof e>"u"?0:e.length},ny.USHORT=function(e){return[e>>8&255,255&e]},iy.USHORT=oy(2),ny.SHORT=function(e){return e>=32768&&(e=-(65536-e)),[e>>8&255,255&e]},iy.SHORT=oy(2),ny.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},iy.UINT24=oy(3),ny.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},iy.ULONG=oy(4),ny.LONG=function(e){return e>=ty&&(e=-(2*ty-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},iy.LONG=oy(4),ny.FIXED=ny.ULONG,iy.FIXED=iy.ULONG,ny.FWORD=ny.SHORT,iy.FWORD=iy.SHORT,ny.UFWORD=ny.USHORT,iy.UFWORD=iy.USHORT,ny.LONGDATETIME=function(e){return[0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e]},iy.LONGDATETIME=oy(8),ny.TAG=function(e){return ey.argument(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},iy.TAG=oy(4),ny.Card8=ny.BYTE,iy.Card8=iy.BYTE,ny.Card16=ny.USHORT,iy.Card16=iy.USHORT,ny.OffSize=ny.BYTE,iy.OffSize=iy.BYTE,ny.SID=ny.USHORT,iy.SID=iy.USHORT,ny.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?[247+((e-=108)>>8),255&e]:e>=-1131&&e<=-108?[251+((e=-e-108)>>8),255&e]:e>=-32768&&e<=32767?ny.NUMBER16(e):ny.NUMBER32(e)},iy.NUMBER=function(e){return ny.NUMBER(e).length},ny.NUMBER16=function(e){return[28,e>>8&255,255&e]},iy.NUMBER16=oy(3),ny.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},iy.NUMBER32=oy(5),ny.REAL=function(e){var t=e.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));t=(Math.round(e*n)/n).toString()}for(var i="",o=0,a=t.length;o<a;o+=1){var s=t[o];i+="e"===s?"-"===t[++o]?"c":"b":"."===s?"a":"-"===s?"e":s}for(var l=[30],u=0,c=(i+=1&i.length?"f":"ff").length;u<c;u+=2)l.push(parseInt(i.substr(u,2),16));return l},iy.REAL=function(e){return ny.REAL(e).length},ny.NAME=ny.CHARARRAY,iy.NAME=iy.CHARARRAY,ny.STRING=ny.CHARARRAY,iy.STRING=iy.CHARARRAY,ry.UTF8=function(e,t,r){for(var n=[],i=r,o=0;o<i;o++,t+=1)n[o]=e.getUint8(t);return String.fromCharCode.apply(null,n)},ry.UTF16=function(e,t,r){for(var n=[],i=r/2,o=0;o<i;o++,t+=2)n[o]=e.getUint16(t);return String.fromCharCode.apply(null,n)},ny.UTF16=function(e){for(var t=[],r=0;r<e.length;r+=1){var n=e.charCodeAt(r);t[t.length]=n>>8&255,t[t.length]=255&n}return t},iy.UTF16=function(e){return 2*e.length};var ay={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};ry.MACSTRING=function(e,t,r,n){var i=ay[n];if(void 0!==i){for(var o="",a=0;a<r;a++){var s=e.getUint8(t+a);o+=s<=127?String.fromCharCode(s):i[127&s]}return o}};var sy,ly="function"==typeof WeakMap&&new WeakMap;function uy(e){return e>=-128&&e<=127}function cy(e,t,r){for(var n=0,i=e.length;t<i&&n<64&&0===e[t];)++t,++n;return r.push(128|n-1),t}function hy(e,t,r){for(var n=0,i=e.length,o=t;o<i&&n<64;){var a=e[o];if(!uy(a)||0===a&&o+1<i&&0===e[o+1])break;++o,++n}r.push(n-1);for(var s=t;s<o;++s)r.push(e[s]+256&255);return o}function dy(e,t,r){for(var n=0,i=e.length,o=t;o<i&&n<64;){var a=e[o];if(0===a||uy(a)&&o+1<i&&uy(e[o+1]))break;++o,++n}r.push(64|n-1);for(var s=t;s<o;++s){var l=e[s];r.push(l+65536>>8&255,l+256&255)}return o}ny.MACSTRING=function(e,t){var r=function(e){if(!sy)for(var t in sy={},ay)sy[t]=new String(t);var r=sy[e];if(void 0!==r){if(ly){var n=ly.get(r);if(void 0!==n)return n}var i=ay[e];if(void 0!==i){for(var o={},a=0;a<i.length;a++)o[i.charCodeAt(a)]=a+128;return ly&&ly.set(r,o),o}}}(t);if(void 0!==r){for(var n=[],i=0;i<e.length;i++){var o=e.charCodeAt(i);if(o>=128&&void 0===(o=r[o]))return;n[i]=o}return n}},iy.MACSTRING=function(e,t){var r=ny.MACSTRING(e,t);return void 0!==r?r.length:0},ny.VARDELTAS=function(e){for(var t=0,r=[];t<e.length;){var n=e[t];t=0===n?cy(e,t,r):n>=-128&&n<=127?hy(e,t,r):dy(e,t,r)}return r},ny.INDEX=function(e){for(var t=1,r=[t],n=[],i=0;i<e.length;i+=1){var o=ny.OBJECT(e[i]);Array.prototype.push.apply(n,o),t+=o.length,r.push(t)}if(0===n.length)return[0,0];for(var a=[],s=1+Math.floor(Math.log(t)/Math.log(2))/8|0,l=[void 0,ny.BYTE,ny.USHORT,ny.UINT24,ny.ULONG][s],u=0;u<r.length;u+=1){var c=l(r[u]);Array.prototype.push.apply(a,c)}return Array.prototype.concat(ny.Card16(e.length),ny.OffSize(s),a,n)},iy.INDEX=function(e){return ny.INDEX(e).length},ny.DICT=function(e){for(var t=[],r=Object.keys(e),n=r.length,i=0;i<n;i+=1){var o=parseInt(r[i],0),a=e[o];t=(t=t.concat(ny.OPERAND(a.value,a.type))).concat(ny.OPERATOR(o))}return t},iy.DICT=function(e){return ny.DICT(e).length},ny.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},ny.OPERAND=function(e,t){var r=[];if(Array.isArray(t))for(var n=0;n<t.length;n+=1)ey.argument(e.length===t.length,"Not enough arguments given for type"+t),r=r.concat(ny.OPERAND(e[n],t[n]));else if("SID"===t)r=r.concat(ny.NUMBER(e));else if("offset"===t)r=r.concat(ny.NUMBER32(e));else if("number"===t)r=r.concat(ny.NUMBER(e));else{if("real"!==t)throw new Error("Unknown operand type "+t);r=r.concat(ny.REAL(e))}return r},ny.OP=ny.BYTE,iy.OP=iy.BYTE;var py="function"==typeof WeakMap&&new WeakMap;function fy(e,t,r){if(t.length&&("coverageFormat"!==t[0].name||1===t[0].value))for(var n=0;n<t.length;n+=1){var i=t[n];this[i.name]=i.value}if(this.tableName=e,this.fields=t,r)for(var o=Object.keys(r),a=0;a<o.length;a+=1){var s=o[a],l=r[s];void 0!==this[s]&&(this[s]=l)}}function my(e,t,r){void 0===r&&(r=t.length);var n=new Array(t.length+1);n[0]={name:e+"Count",type:"USHORT",value:r};for(var i=0;i<t.length;i++)n[i+1]={name:e+i,type:"USHORT",value:t[i]};return n}function vy(e,t,r){var n=t.length,i=new Array(n+1);i[0]={name:e+"Count",type:"USHORT",value:n};for(var o=0;o<n;o++)i[o+1]={name:e+o,type:"TABLE",value:r(t[o],o)};return i}function gy(e,t,r){var n=t.length,i=[];i[0]={name:e+"Count",type:"USHORT",value:n};for(var o=0;o<n;o++)i=i.concat(r(t[o],o));return i}function yy(e){1===e.format?fy.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(my("glyph",e.glyphs))):2===e.format?fy.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(gy("rangeRecord",e.ranges,(function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]})))):ey.assert(!1,"Coverage format must be 1 or 2.")}function by(e){fy.call(this,"scriptListTable",gy("scriptRecord",e,(function(e,t){var r=e.script,n=r.defaultLangSys;return ey.assert(!!n,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new fy("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new fy("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:n.reqFeatureIndex}].concat(my("featureIndex",n.featureIndexes)))}].concat(gy("langSys",r.langSysRecords,(function(e,t){var r=e.langSys;return[{name:"langSysTag"+t,type:"TAG",value:e.tag},{name:"langSys"+t,type:"TABLE",value:new fy("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:r.reqFeatureIndex}].concat(my("featureIndex",r.featureIndexes)))}]}))))}]})))}function xy(e){fy.call(this,"featureListTable",gy("featureRecord",e,(function(e,t){var r=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new fy("featureTable",[{name:"featureParams",type:"USHORT",value:r.featureParams}].concat(my("lookupListIndex",r.lookupListIndexes)))}]})))}function wy(e,t){fy.call(this,"lookupListTable",vy("lookup",e,(function(e){var r=t[e.lookupType];return ey.assert(!!r,"Unable to write GSUB lookup type "+e.lookupType+" tables."),new fy("lookupTable",[{name:"lookupType",type:"USHORT",value:e.lookupType},{name:"lookupFlag",type:"USHORT",value:e.lookupFlag}].concat(vy("subtable",e.subtables,r)))})))}ny.CHARSTRING=function(e){if(py){var t=py.get(e);if(void 0!==t)return t}for(var r=[],n=e.length,i=0;i<n;i+=1){var o=e[i];r=r.concat(ny[o.type](o.value))}return py&&py.set(e,r),r},iy.CHARSTRING=function(e){return ny.CHARSTRING(e).length},ny.OBJECT=function(e){var t=ny[e.type];return ey.argument(void 0!==t,"No encoding function for type "+e.type),t(e.value)},iy.OBJECT=function(e){var t=iy[e.type];return ey.argument(void 0!==t,"No sizeOf function for type "+e.type),t(e.value)},ny.TABLE=function(e){for(var t=[],r=e.fields.length,n=[],i=[],o=0;o<r;o+=1){var a=e.fields[o],s=ny[a.type];ey.argument(void 0!==s,"No encoding function for field type "+a.type+" ("+a.name+")");var l=e[a.name];void 0===l&&(l=a.value);var u=s(l);"TABLE"===a.type?(i.push(t.length),t=t.concat([0,0]),n.push(u)):t=t.concat(u)}for(var c=0;c<n.length;c+=1){var h=i[c],d=t.length;ey.argument(d<65536,"Table "+e.tableName+" too big."),t[h]=d>>8,t[h+1]=255&d,t=t.concat(n[c])}return t},iy.TABLE=function(e){for(var t=0,r=e.fields.length,n=0;n<r;n+=1){var i=e.fields[n],o=iy[i.type];ey.argument(void 0!==o,"No sizeOf function for field type "+i.type+" ("+i.name+")");var a=e[i.name];void 0===a&&(a=i.value),t+=o(a),"TABLE"===i.type&&(t+=2)}return t},ny.RECORD=ny.TABLE,iy.RECORD=iy.TABLE,ny.LITERAL=function(e){return e},iy.LITERAL=function(e){return e.length},fy.prototype.encode=function(){return ny.TABLE(this)},fy.prototype.sizeOf=function(){return iy.TABLE(this)},yy.prototype=Object.create(fy.prototype),yy.prototype.constructor=yy,by.prototype=Object.create(fy.prototype),by.prototype.constructor=by,xy.prototype=Object.create(fy.prototype),xy.prototype.constructor=xy,wy.prototype=Object.create(fy.prototype),wy.prototype.constructor=wy;var _y={Table:fy,Record:fy,Coverage:yy,ScriptList:by,FeatureList:xy,LookupList:wy,ushortList:my,tableList:vy,recordList:gy};function Sy(e,t){return e.getUint8(t)}function Oy(e,t){return e.getUint16(t,!1)}function Ty(e,t){return e.getUint32(t,!1)}function Ey(e,t){return e.getInt16(t,!1)+e.getUint16(t+2,!1)/65535}var Cy={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Ay(e,t){this.data=e,this.offset=t,this.relativeOffset=0}Ay.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},Ay.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},Ay.prototype.parseCard8=Ay.prototype.parseByte,Ay.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},Ay.prototype.parseCard16=Ay.prototype.parseUShort,Ay.prototype.parseSID=Ay.prototype.parseUShort,Ay.prototype.parseOffset16=Ay.prototype.parseUShort,Ay.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},Ay.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},Ay.prototype.parseULong=function(){var e=Ty(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},Ay.prototype.parseOffset32=Ay.prototype.parseULong,Ay.prototype.parseFixed=function(){var e=Ey(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},Ay.prototype.parseString=function(e){var t=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=e;for(var i=0;i<e;i++)n+=String.fromCharCode(t.getUint8(r+i));return n},Ay.prototype.parseTag=function(){return this.parseString(4)},Ay.prototype.parseLongDateTime=function(){var e=Ty(this.data,this.offset+this.relativeOffset+4);return e-=2082844800,this.relativeOffset+=8,e},Ay.prototype.parseVersion=function(e){var t=Oy(this.data,this.offset+this.relativeOffset),r=Oy(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,void 0===e&&(e=4096),t+r/e/10},Ay.prototype.skip=function(e,t){void 0===t&&(t=1),this.relativeOffset+=Cy[e]*t},Ay.prototype.parseULongList=function(e){void 0===e&&(e=this.parseULong());for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=r.getUint32(n),n+=4;return this.relativeOffset+=4*e,t},Ay.prototype.parseOffset16List=Ay.prototype.parseUShortList=function(e){void 0===e&&(e=this.parseUShort());for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=r.getUint16(n),n+=2;return this.relativeOffset+=2*e,t},Ay.prototype.parseShortList=function(e){for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=r.getInt16(n),n+=2;return this.relativeOffset+=2*e,t},Ay.prototype.parseByteList=function(e){for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=r.getUint8(n++);return this.relativeOffset+=e,t},Ay.prototype.parseList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),n=0;n<e;n++)r[n]=t.call(this);return r},Ay.prototype.parseList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),n=0;n<e;n++)r[n]=t.call(this);return r},Ay.prototype.parseRecordList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),n=Object.keys(t),i=0;i<e;i++){for(var o={},a=0;a<n.length;a++){var s=n[a],l=t[s];o[s]=l.call(this)}r[i]=o}return r},Ay.prototype.parseRecordList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),n=Object.keys(t),i=0;i<e;i++){for(var o={},a=0;a<n.length;a++){var s=n[a],l=t[s];o[s]=l.call(this)}r[i]=o}return r},Ay.prototype.parseStruct=function(e){if("function"==typeof e)return e.call(this);for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var i=t[n],o=e[i];r[i]=o.call(this)}return r},Ay.prototype.parseValueRecord=function(e){if(void 0===e&&(e=this.parseUShort()),0!==e){var t={};return 1&e&&(t.xPlacement=this.parseShort()),2&e&&(t.yPlacement=this.parseShort()),4&e&&(t.xAdvance=this.parseShort()),8&e&&(t.yAdvance=this.parseShort()),16&e&&(t.xPlaDevice=void 0,this.parseShort()),32&e&&(t.yPlaDevice=void 0,this.parseShort()),64&e&&(t.xAdvDevice=void 0,this.parseShort()),128&e&&(t.yAdvDevice=void 0,this.parseShort()),t}},Ay.prototype.parseValueRecordList=function(){for(var e=this.parseUShort(),t=this.parseUShort(),r=new Array(t),n=0;n<t;n++)r[n]=this.parseValueRecord(e);return r},Ay.prototype.parsePointer=function(e){var t=this.parseOffset16();if(t>0)return new Ay(this.data,this.offset+t).parseStruct(e)},Ay.prototype.parsePointer32=function(e){var t=this.parseOffset32();if(t>0)return new Ay(this.data,this.offset+t).parseStruct(e)},Ay.prototype.parseListOfLists=function(e){for(var t=this.parseOffset16List(),r=t.length,n=this.relativeOffset,i=new Array(r),o=0;o<r;o++){var a=t[o];if(0!==a)if(this.relativeOffset=a,e){for(var s=this.parseOffset16List(),l=new Array(s.length),u=0;u<s.length;u++)this.relativeOffset=a+s[u],l[u]=e.call(this);i[o]=l}else i[o]=this.parseUShortList();else i[o]=void 0}return this.relativeOffset=n,i},Ay.prototype.parseCoverage=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort(),r=this.parseUShort();if(1===t)return{format:1,glyphs:this.parseUShortList(r)};if(2===t){for(var n=new Array(r),i=0;i<r;i++)n[i]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+e.toString(16)+": Coverage format must be 1 or 2.")},Ay.prototype.parseClassDef=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===t)return{format:2,ranges:this.parseRecordList({start:Ay.uShort,end:Ay.uShort,classId:Ay.uShort})};throw new Error("0x"+e.toString(16)+": ClassDef format must be 1 or 2.")},Ay.list=function(e,t){return function(){return this.parseList(e,t)}},Ay.list32=function(e,t){return function(){return this.parseList32(e,t)}},Ay.recordList=function(e,t){return function(){return this.parseRecordList(e,t)}},Ay.recordList32=function(e,t){return function(){return this.parseRecordList32(e,t)}},Ay.pointer=function(e){return function(){return this.parsePointer(e)}},Ay.pointer32=function(e){return function(){return this.parsePointer32(e)}},Ay.tag=Ay.prototype.parseTag,Ay.byte=Ay.prototype.parseByte,Ay.uShort=Ay.offset16=Ay.prototype.parseUShort,Ay.uShortList=Ay.prototype.parseUShortList,Ay.uLong=Ay.offset32=Ay.prototype.parseULong,Ay.uLongList=Ay.prototype.parseULongList,Ay.struct=Ay.prototype.parseStruct,Ay.coverage=Ay.prototype.parseCoverage,Ay.classDef=Ay.prototype.parseClassDef;var My={reserved:Ay.uShort,reqFeatureIndex:Ay.uShort,featureIndexes:Ay.uShortList};Ay.prototype.parseScriptList=function(){return this.parsePointer(Ay.recordList({tag:Ay.tag,script:Ay.pointer({defaultLangSys:Ay.pointer(My),langSysRecords:Ay.recordList({tag:Ay.tag,langSys:Ay.pointer(My)})})}))||[]},Ay.prototype.parseFeatureList=function(){return this.parsePointer(Ay.recordList({tag:Ay.tag,feature:Ay.pointer({featureParams:Ay.offset16,lookupListIndexes:Ay.uShortList})}))||[]},Ay.prototype.parseLookupList=function(e){return this.parsePointer(Ay.list(Ay.pointer((function(){var t=this.parseUShort();ey.argument(1<=t&&t<=9,"GPOS/GSUB lookup type "+t+" unknown.");var r=this.parseUShort(),n=16&r;return{lookupType:t,lookupFlag:r,subtables:this.parseList(Ay.pointer(e[t])),markFilteringSet:n?this.parseUShort():void 0}}))))||[]},Ay.prototype.parseFeatureVariationsList=function(){return this.parsePointer32((function(){var e=this.parseUShort(),t=this.parseUShort();return ey.argument(1===e&&t<1,"GPOS/GSUB feature variations table unknown."),this.parseRecordList32({conditionSetOffset:Ay.offset32,featureTableSubstitutionOffset:Ay.offset32})}))||[]};var Dy={getByte:Sy,getCard8:Sy,getUShort:Oy,getCard16:Oy,getShort:function(e,t){return e.getInt16(t,!1)},getULong:Ty,getFixed:Ey,getTag:function(e,t){for(var r="",n=t;n<t+4;n+=1)r+=String.fromCharCode(e.getInt8(n));return r},getOffset:function(e,t,r){for(var n=0,i=0;i<r;i+=1)n<<=8,n+=e.getUint8(t+i);return n},getBytes:function(e,t,r){for(var n=[],i=t;i<r;i+=1)n.push(e.getUint8(i));return n},bytesToString:function(e){for(var t="",r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return t},Parser:Ay};function Py(e,t,r){e.segments.push({end:t,start:t,delta:-(t-r),offset:0,glyphIndex:r})}var ky={parse:function(e,t){var r={};r.version=Dy.getUShort(e,t),ey.argument(0===r.version,"cmap table version should be 0."),r.numTables=Dy.getUShort(e,t+2);for(var n=-1,i=r.numTables-1;i>=0;i-=1){var o=Dy.getUShort(e,t+4+8*i),a=Dy.getUShort(e,t+4+8*i+2);if(3===o&&(0===a||1===a||10===a)||0===o&&(0===a||1===a||2===a||3===a||4===a)){n=Dy.getULong(e,t+4+8*i+4);break}}if(-1===n)throw new Error("No valid cmap sub-tables found.");var s=new Dy.Parser(e,t+n);if(r.format=s.parseUShort(),12===r.format)!function(e,t){var r;t.parseUShort(),e.length=t.parseULong(),e.language=t.parseULong(),e.groupCount=r=t.parseULong(),e.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var i=t.parseULong(),o=t.parseULong(),a=t.parseULong(),s=i;s<=o;s+=1)e.glyphIndexMap[s]=a,a++}(r,s);else{if(4!==r.format)throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");!function(e,t,r,n,i){var o;e.length=t.parseUShort(),e.language=t.parseUShort(),e.segCount=o=t.parseUShort()>>1,t.skip("uShort",3),e.glyphIndexMap={};for(var a=new Dy.Parser(r,n+i+14),s=new Dy.Parser(r,n+i+16+2*o),l=new Dy.Parser(r,n+i+16+4*o),u=new Dy.Parser(r,n+i+16+6*o),c=n+i+16+8*o,h=0;h<o-1;h+=1)for(var d=void 0,p=a.parseUShort(),f=s.parseUShort(),m=l.parseShort(),v=u.parseUShort(),g=f;g<=p;g+=1)0!==v?(c=u.offset+u.relativeOffset-2,c+=v,c+=2*(g-f),0!==(d=Dy.getUShort(r,c))&&(d=d+m&65535)):d=g+m&65535,e.glyphIndexMap[g]=d}(r,s,e,t,n)}return r},make:function(e){var t,r=!0;for(t=e.length-1;t>0;t-=1){if(e.get(t).unicode>65535){r=!1;break}}var n=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:r?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:r?12:20}];r||(n=n.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),n=n.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new _y.Table("cmap",n);for(i.segments=[],t=0;t<e.length;t+=1){for(var o=e.get(t),a=0;a<o.unicodes.length;a+=1)Py(i,o.unicodes[a],t);i.segments=i.segments.sort((function(e,t){return e.start-t.start}))}!function(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}(i);var s=i.segments.length,l=0,u=[],c=[],h=[],d=[],p=[],f=[];for(t=0;t<s;t+=1){var m=i.segments[t];m.end<=65535&&m.start<=65535?(u=u.concat({name:"end_"+t,type:"USHORT",value:m.end}),c=c.concat({name:"start_"+t,type:"USHORT",value:m.start}),h=h.concat({name:"idDelta_"+t,type:"SHORT",value:m.delta}),d=d.concat({name:"idRangeOffset_"+t,type:"USHORT",value:m.offset}),void 0!==m.glyphId&&(p=p.concat({name:"glyph_"+t,type:"USHORT",value:m.glyphId}))):l+=1,!r&&void 0!==m.glyphIndex&&(f=(f=(f=f.concat({name:"cmap12Start_"+t,type:"ULONG",value:m.start})).concat({name:"cmap12End_"+t,type:"ULONG",value:m.end})).concat({name:"cmap12Glyph_"+t,type:"ULONG",value:m.glyphIndex}))}if(i.segCountX2=2*(s-l),i.searchRange=2*Math.pow(2,Math.floor(Math.log(s-l)/Math.log(2))),i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(u),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(c),i.fields=i.fields.concat(h),i.fields=i.fields.concat(d),i.fields=i.fields.concat(p),i.cmap4Length=14+2*u.length+2+2*c.length+2*h.length+2*d.length+2*p.length,!r){var v=16+4*f.length;i.cmap12Offset=20+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:v},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:f.length/3}]),i.fields=i.fields.concat(f)}return i}},Ly=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Uy=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Iy=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],zy=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function Ry(e){this.font=e}function Ny(e){this.cmap=e}function By(e,t){this.encoding=e,this.charset=t}function Fy(e){switch(e.version){case 1:this.names=zy.slice();break;case 2:this.names=new Array(e.numberOfGlyphs);for(var t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<zy.length?this.names[t]=zy[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-zy.length];break;case 2.5:this.names=new Array(e.numberOfGlyphs);for(var r=0;r<e.numberOfGlyphs;r++)this.names[r]=zy[r+e.glyphNameIndex[r]];break;default:this.names=[]}}function jy(e,t){t.lowMemory?function(e){e._IndexToUnicodeMap={};for(var t=e.tables.cmap.glyphIndexMap,r=Object.keys(t),n=0;n<r.length;n+=1){var i=r[n],o=t[i];void 0===e._IndexToUnicodeMap[o]?e._IndexToUnicodeMap[o]={unicodes:[parseInt(i)]}:e._IndexToUnicodeMap[o].unicodes.push(parseInt(i))}}(e):function(e){for(var t,r=e.tables.cmap.glyphIndexMap,n=Object.keys(r),i=0;i<n.length;i+=1){var o=n[i],a=r[o];(t=e.glyphs.get(a)).addUnicode(parseInt(o))}for(var s=0;s<e.glyphs.length;s+=1)t=e.glyphs.get(s),e.cffEncoding?e.isCIDFont?t.name="gid"+s:t.name=e.cffEncoding.charset[s]:e.glyphNames.names&&(t.name=e.glyphNames.glyphIndexToName(s))}(e)}Ry.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.font.glyphs;if(r)for(var n=0;n<r.length;n+=1)for(var i=r.get(n),o=0;o<i.unicodes.length;o+=1)if(i.unicodes[o]===t)return n;return null},Ny.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.codePointAt(0)]||0},By.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.encoding[t];return this.charset.indexOf(r)},Fy.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},Fy.prototype.glyphIndexToName=function(e){return this.names[e]};var Gy={line:function(e,t,r,n,i){e.beginPath(),e.moveTo(t,r),e.lineTo(n,i),e.stroke()}};function Vy(e){this.bindConstructorValues(e)}function Hy(e,t,r){Object.defineProperty(e,t,{get:function(){return e.path,e[r]},set:function(t){e[r]=t},enumerable:!0,configurable:!0})}function Wy(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var r=0;r<t.length;r++){var n=t[r];n.path.unitsPerEm=e.unitsPerEm,this.glyphs[r]=n}this.length=t&&t.length||0}Vy.prototype.bindConstructorValues=function(e){this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||void 0!==e.unicode?[e.unicode]:[],"xMin"in e&&(this.xMin=e.xMin),"yMin"in e&&(this.yMin=e.yMin),"xMax"in e&&(this.xMax=e.xMax),"yMax"in e&&(this.yMax=e.yMax),"advanceWidth"in e&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",function(e,t){var r=t||new Kg;return{configurable:!0,get:function(){return"function"==typeof r&&(r=r()),r},set:function(e){r=e}}}(0,e.path))},Vy.prototype.addUnicode=function(e){0===this.unicodes.length&&(this.unicode=e),this.unicodes.push(e)},Vy.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},Vy.prototype.getPath=function(e,t,r,n,i){var o,a;e=void 0!==e?e:0,t=void 0!==t?t:0,r=void 0!==r?r:72,n||(n={});var s=n.xScale,l=n.yScale;if(n.hinting&&i&&i.hinting&&(a=this.path&&i.hinting.exec(this,r)),a)o=i.hinting.getCommands(a),e=Math.round(e),t=Math.round(t),s=l=1;else{o=this.path.commands;var u=1/(this.path.unitsPerEm||1e3)*r;void 0===s&&(s=u),void 0===l&&(l=u)}for(var c=new Kg,h=0;h<o.length;h+=1){var d=o[h];"M"===d.type?c.moveTo(e+d.x*s,t+-d.y*l):"L"===d.type?c.lineTo(e+d.x*s,t+-d.y*l):"Q"===d.type?c.quadraticCurveTo(e+d.x1*s,t+-d.y1*l,e+d.x*s,t+-d.y*l):"C"===d.type?c.curveTo(e+d.x1*s,t+-d.y1*l,e+d.x2*s,t+-d.y2*l,e+d.x*s,t+-d.y*l):"Z"===d.type&&c.closePath()}return c},Vy.prototype.getContours=function(){if(void 0===this.points)return[];for(var e=[],t=[],r=0;r<this.points.length;r+=1){var n=this.points[r];t.push(n),n.lastPointOfContour&&(e.push(t),t=[])}return ey.argument(0===t.length,"There are still points left in the current contour."),e},Vy.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],r=[],n=0;n<e.length;n+=1){var i=e[n];"Z"!==i.type&&(t.push(i.x),r.push(i.y)),("Q"===i.type||"C"===i.type)&&(t.push(i.x1),r.push(i.y1)),"C"===i.type&&(t.push(i.x2),r.push(i.y2))}var o={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(o.xMin)||(o.xMin=0),isFinite(o.xMax)||(o.xMax=this.advanceWidth),isFinite(o.yMin)||(o.yMin=0),isFinite(o.yMax)||(o.yMax=0),o.rightSideBearing=this.advanceWidth-o.leftSideBearing-(o.xMax-o.xMin),o},Vy.prototype.draw=function(e,t,r,n,i){this.getPath(t,r,n,i).draw(e)},Vy.prototype.drawPoints=function(e,t,r,n){function i(t,r,n,i){e.beginPath();for(var o=0;o<t.length;o+=1)e.moveTo(r+t[o].x*i,n+t[o].y*i),e.arc(r+t[o].x*i,n+t[o].y*i,2,0,2*Math.PI,!1);e.closePath(),e.fill()}t=void 0!==t?t:0,r=void 0!==r?r:0,n=void 0!==n?n:24;for(var o=1/this.path.unitsPerEm*n,a=[],s=[],l=this.path,u=0;u<l.commands.length;u+=1){var c=l.commands[u];void 0!==c.x&&a.push({x:c.x,y:-c.y}),void 0!==c.x1&&s.push({x:c.x1,y:-c.y1}),void 0!==c.x2&&s.push({x:c.x2,y:-c.y2})}e.fillStyle="blue",i(a,t,r,o),e.fillStyle="red",i(s,t,r,o)},Vy.prototype.drawMetrics=function(e,t,r,n){var i;t=void 0!==t?t:0,r=void 0!==r?r:0,n=void 0!==n?n:24,i=1/this.path.unitsPerEm*n,e.lineWidth=1,e.strokeStyle="black",Gy.line(e,t,-1e4,t,1e4),Gy.line(e,-1e4,r,1e4,r);var o=this.xMin||0,a=this.yMin||0,s=this.xMax||0,l=this.yMax||0,u=this.advanceWidth||0;e.strokeStyle="blue",Gy.line(e,t+o*i,-1e4,t+o*i,1e4),Gy.line(e,t+s*i,-1e4,t+s*i,1e4),Gy.line(e,-1e4,r+-a*i,1e4,r+-a*i),Gy.line(e,-1e4,r+-l*i,1e4,r+-l*i),e.strokeStyle="green",Gy.line(e,t+u*i,-1e4,t+u*i,1e4)},Wy.prototype.get=function(e){if(void 0===this.glyphs[e]){this.font._push(e),"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());var t=this.glyphs[e],r=this.font._IndexToUnicodeMap[e];if(r)for(var n=0;n<r.unicodes.length;n++)t.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?t.name="gid"+e:t.name=this.font.cffEncoding.charset[e]:this.font.glyphNames.names&&(t.name=this.font.glyphNames.glyphIndexToName(e)),this.glyphs[e].advanceWidth=this.font._hmtxTableData[e].advanceWidth,this.glyphs[e].leftSideBearing=this.font._hmtxTableData[e].leftSideBearing}else"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());return this.glyphs[e]},Wy.prototype.push=function(e,t){this.glyphs[e]=t,this.length++};var qy={GlyphSet:Wy,glyphLoader:function(e,t){return new Vy({index:t,font:e})},ttfGlyphLoader:function(e,t,r,n,i,o){return function(){var a=new Vy({index:t,font:e});return a.path=function(){r(a,n,i);var t=o(e.glyphs,a);return t.unitsPerEm=e.unitsPerEm,t},Hy(a,"xMin","_xMin"),Hy(a,"xMax","_xMax"),Hy(a,"yMin","_yMin"),Hy(a,"yMax","_yMax"),a}},cffGlyphLoader:function(e,t,r,n){return function(){var i=new Vy({index:t,font:e});return i.path=function(){var t=r(e,i,n);return t.unitsPerEm=e.unitsPerEm,t},i}}};function $y(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r+=1)if(!$y(e[r],t[r]))return!1;return!0}return!1}function Xy(e){return e.length<1240?107:e.length<33900?1131:32768}function Yy(e,t,r){var n,i,o=[],a=[],s=Dy.getCard16(e,t);if(0!==s){var l=Dy.getByte(e,t+2);n=t+(s+1)*l+2;for(var u=t+3,c=0;c<s+1;c+=1)o.push(Dy.getOffset(e,u,l)),u+=l;i=n+o[s]}else i=t+2;for(var h=0;h<o.length-1;h+=1){var d=Dy.getBytes(e,n+o[h],n+o[h+1]);r&&(d=r(d)),a.push(d)}return{objects:a,startOffset:t,endOffset:i}}function Zy(e,t){if(28===t)return e.parseByte()<<8|e.parseByte();if(29===t)return e.parseByte()<<24|e.parseByte()<<16|e.parseByte()<<8|e.parseByte();if(30===t)return function(e){for(var t="",r=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var n=e.parseByte(),i=n>>4,o=15&n;if(15===i||(t+=r[i],15===o))break;t+=r[o]}return parseFloat(t)}(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return 256*(t-247)+e.parseByte()+108;if(t>=251&&t<=254)return 256*-(t-251)-e.parseByte()-108;throw new Error("Invalid b0 "+t)}function Ky(e,t,r){t=void 0!==t?t:0;var n=new Dy.Parser(e,t),i=[],o=[];for(r=void 0!==r?r:e.length;n.relativeOffset<r;){var a=n.parseByte();a<=21?(12===a&&(a=1200+n.parseByte()),i.push([a,o]),o=[]):o.push(Zy(n,a))}return function(e){for(var t={},r=0;r<e.length;r+=1){var n=e[r][0],i=e[r][1],o=void 0;if(o=1===i.length?i[0]:i,t.hasOwnProperty(n)&&!isNaN(t[n]))throw new Error("Object "+t+" already has key "+n);t[n]=o}return t}(i)}function Qy(e,t){return t=t<=390?Ly[t]:e[t-391]}function Jy(e,t,r){for(var n,i={},o=0;o<t.length;o+=1){var a=t[o];if(Array.isArray(a.type)){var s=[];s.length=a.type.length;for(var l=0;l<a.type.length;l++)void 0===(n=void 0!==e[a.op]?e[a.op][l]:void 0)&&(n=void 0!==a.value&&void 0!==a.value[l]?a.value[l]:null),"SID"===a.type[l]&&(n=Qy(r,n)),s[l]=n;i[a.name]=s}else void 0===(n=e[a.op])&&(n=void 0!==a.value?a.value:null),"SID"===a.type&&(n=Qy(r,n)),i[a.name]=n}return i}var eb=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],tb=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function rb(e,t){return Jy(Ky(e,0,e.byteLength),eb,t)}function nb(e,t,r,n){return Jy(Ky(e,t,r),tb,n)}function ib(e,t,r,n){for(var i=[],o=0;o<r.length;o+=1){var a=rb(new DataView(new Uint8Array(r[o]).buffer),n);a._subrs=[],a._subrsBias=0,a._defaultWidthX=0,a._nominalWidthX=0;var s=a.private[0],l=a.private[1];if(0!==s&&0!==l){var u=nb(e,l+t,s,n);if(a._defaultWidthX=u.defaultWidthX,a._nominalWidthX=u.nominalWidthX,0!==u.subrs){var c=Yy(e,l+u.subrs+t);a._subrs=c.objects,a._subrsBias=Xy(a._subrs)}a._privateDict=u}i.push(a)}return i}function ob(e,t,r){var n,i,o,a,s,l,u,c,h=new Kg,d=[],p=0,f=!1,m=!1,v=0,g=0;if(e.isCIDFont){var y=e.tables.cff.topDict._fdSelect[t.index],b=e.tables.cff.topDict._fdArray[y];s=b._subrs,l=b._subrsBias,u=b._defaultWidthX,c=b._nominalWidthX}else s=e.tables.cff.topDict._subrs,l=e.tables.cff.topDict._subrsBias,u=e.tables.cff.topDict._defaultWidthX,c=e.tables.cff.topDict._nominalWidthX;var x=u;function w(e,t){m&&h.closePath(),h.moveTo(e,t),m=!0}function _(){d.length%2!=0&&!f&&(x=d.shift()+c),p+=d.length>>1,d.length=0,f=!0}return function t(r){for(var u,y,b,S,O,T,E,C,A,M,D,P,k=0;k<r.length;){var L=r[k];switch(k+=1,L){case 1:case 3:case 18:case 23:_();break;case 4:d.length>1&&!f&&(x=d.shift()+c,f=!0),g+=d.pop(),w(v,g);break;case 5:for(;d.length>0;)v+=d.shift(),g+=d.shift(),h.lineTo(v,g);break;case 6:for(;d.length>0&&(v+=d.shift(),h.lineTo(v,g),0!==d.length);)g+=d.shift(),h.lineTo(v,g);break;case 7:for(;d.length>0&&(g+=d.shift(),h.lineTo(v,g),0!==d.length);)v+=d.shift(),h.lineTo(v,g);break;case 8:for(;d.length>0;)n=v+d.shift(),i=g+d.shift(),o=n+d.shift(),a=i+d.shift(),v=o+d.shift(),g=a+d.shift(),h.curveTo(n,i,o,a,v,g);break;case 10:O=d.pop()+l,(T=s[O])&&t(T);break;case 11:return;case 12:switch(L=r[k],k+=1,L){case 35:n=v+d.shift(),i=g+d.shift(),o=n+d.shift(),a=i+d.shift(),E=o+d.shift(),C=a+d.shift(),A=E+d.shift(),M=C+d.shift(),D=A+d.shift(),P=M+d.shift(),v=D+d.shift(),g=P+d.shift(),d.shift(),h.curveTo(n,i,o,a,E,C),h.curveTo(A,M,D,P,v,g);break;case 34:n=v+d.shift(),i=g,o=n+d.shift(),a=i+d.shift(),E=o+d.shift(),C=a,A=E+d.shift(),M=a,D=A+d.shift(),P=g,v=D+d.shift(),h.curveTo(n,i,o,a,E,C),h.curveTo(A,M,D,P,v,g);break;case 36:n=v+d.shift(),i=g+d.shift(),o=n+d.shift(),a=i+d.shift(),E=o+d.shift(),C=a,A=E+d.shift(),M=a,D=A+d.shift(),P=M+d.shift(),v=D+d.shift(),h.curveTo(n,i,o,a,E,C),h.curveTo(A,M,D,P,v,g);break;case 37:n=v+d.shift(),i=g+d.shift(),o=n+d.shift(),a=i+d.shift(),E=o+d.shift(),C=a+d.shift(),A=E+d.shift(),M=C+d.shift(),D=A+d.shift(),P=M+d.shift(),Math.abs(D-v)>Math.abs(P-g)?v=D+d.shift():g=P+d.shift(),h.curveTo(n,i,o,a,E,C),h.curveTo(A,M,D,P,v,g);break;default:d.length=0}break;case 14:d.length>0&&!f&&(x=d.shift()+c,f=!0),m&&(h.closePath(),m=!1);break;case 19:case 20:_(),k+=p+7>>3;break;case 21:d.length>2&&!f&&(x=d.shift()+c,f=!0),g+=d.pop(),w(v+=d.pop(),g);break;case 22:d.length>1&&!f&&(x=d.shift()+c,f=!0),w(v+=d.pop(),g);break;case 24:for(;d.length>2;)n=v+d.shift(),i=g+d.shift(),o=n+d.shift(),a=i+d.shift(),v=o+d.shift(),g=a+d.shift(),h.curveTo(n,i,o,a,v,g);v+=d.shift(),g+=d.shift(),h.lineTo(v,g);break;case 25:for(;d.length>6;)v+=d.shift(),g+=d.shift(),h.lineTo(v,g);n=v+d.shift(),i=g+d.shift(),o=n+d.shift(),a=i+d.shift(),v=o+d.shift(),g=a+d.shift(),h.curveTo(n,i,o,a,v,g);break;case 26:for(d.length%2&&(v+=d.shift());d.length>0;)n=v,i=g+d.shift(),o=n+d.shift(),a=i+d.shift(),v=o,g=a+d.shift(),h.curveTo(n,i,o,a,v,g);break;case 27:for(d.length%2&&(g+=d.shift());d.length>0;)n=v+d.shift(),i=g,o=n+d.shift(),a=i+d.shift(),v=o+d.shift(),g=a,h.curveTo(n,i,o,a,v,g);break;case 28:u=r[k],y=r[k+1],d.push((u<<24|y<<16)>>16),k+=2;break;case 29:O=d.pop()+e.gsubrsBias,(T=e.gsubrs[O])&&t(T);break;case 30:for(;d.length>0&&(n=v,i=g+d.shift(),o=n+d.shift(),a=i+d.shift(),v=o+d.shift(),g=a+(1===d.length?d.shift():0),h.curveTo(n,i,o,a,v,g),0!==d.length);)n=v+d.shift(),i=g,o=n+d.shift(),a=i+d.shift(),g=a+d.shift(),v=o+(1===d.length?d.shift():0),h.curveTo(n,i,o,a,v,g);break;case 31:for(;d.length>0&&(n=v+d.shift(),i=g,o=n+d.shift(),a=i+d.shift(),g=a+d.shift(),v=o+(1===d.length?d.shift():0),h.curveTo(n,i,o,a,v,g),0!==d.length);)n=v,i=g+d.shift(),o=n+d.shift(),a=i+d.shift(),v=o+d.shift(),g=a+(1===d.length?d.shift():0),h.curveTo(n,i,o,a,v,g);break;default:L<32||(L<247?d.push(L-139):L<251?(u=r[k],k+=1,d.push(256*(L-247)+u+108)):L<255?(u=r[k],k+=1,d.push(256*-(L-251)-u-108)):(u=r[k],y=r[k+1],b=r[k+2],S=r[k+3],k+=4,d.push((u<<24|y<<16|b<<8|S)/65536)))}}}(r),t.advanceWidth=x,h}function ab(e,t){var r,n=Ly.indexOf(e);return n>=0&&(r=n),(n=t.indexOf(e))>=0?r=n+Ly.length:(r=Ly.length+t.length,t.push(e)),r}function sb(e,t,r){for(var n={},i=0;i<e.length;i+=1){var o=e[i],a=t[o.name];void 0!==a&&!$y(a,o.value)&&("SID"===o.type&&(a=ab(a,r)),n[o.op]={name:o.name,type:o.type,value:a})}return n}function lb(e,t){var r=new _y.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=sb(eb,e,t),r}function ub(e){var t=new _y.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function cb(e){var t=[],r=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var n=0,i=0,o=0;o<r.commands.length;o+=1){var a=void 0,s=void 0,l=r.commands[o];if("Q"===l.type){var u=.3333333333333333,c=2/3;l={type:"C",x:l.x,y:l.y,x1:Math.round(u*n+c*l.x1),y1:Math.round(u*i+c*l.y1),x2:Math.round(u*l.x+c*l.x1),y2:Math.round(u*l.y+c*l.y1)}}if("M"===l.type)a=Math.round(l.x-n),s=Math.round(l.y-i),t.push({name:"dx",type:"NUMBER",value:a}),t.push({name:"dy",type:"NUMBER",value:s}),t.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(l.x),i=Math.round(l.y);else if("L"===l.type)a=Math.round(l.x-n),s=Math.round(l.y-i),t.push({name:"dx",type:"NUMBER",value:a}),t.push({name:"dy",type:"NUMBER",value:s}),t.push({name:"rlineto",type:"OP",value:5}),n=Math.round(l.x),i=Math.round(l.y);else if("C"===l.type){var h=Math.round(l.x1-n),d=Math.round(l.y1-i),p=Math.round(l.x2-l.x1),f=Math.round(l.y2-l.y1);a=Math.round(l.x-l.x2),s=Math.round(l.y-l.y2),t.push({name:"dx1",type:"NUMBER",value:h}),t.push({name:"dy1",type:"NUMBER",value:d}),t.push({name:"dx2",type:"NUMBER",value:p}),t.push({name:"dy2",type:"NUMBER",value:f}),t.push({name:"dx",type:"NUMBER",value:a}),t.push({name:"dy",type:"NUMBER",value:s}),t.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(l.x),i=Math.round(l.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}var hb={parse:function(e,t,r,n){r.tables.cff={};var i=function(e,t){var r={};return r.formatMajor=Dy.getCard8(e,t),r.formatMinor=Dy.getCard8(e,t+1),r.size=Dy.getCard8(e,t+2),r.offsetSize=Dy.getCard8(e,t+3),r.startOffset=t,r.endOffset=t+4,r}(e,t),o=Yy(e,i.endOffset,Dy.bytesToString),a=Yy(e,o.endOffset),s=Yy(e,a.endOffset,Dy.bytesToString),l=Yy(e,s.endOffset);r.gsubrs=l.objects,r.gsubrsBias=Xy(r.gsubrs);var u=ib(e,t,a.objects,s.objects);if(1!==u.length)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+u.length);var c=u[0];if(r.tables.cff.topDict=c,c._privateDict&&(r.defaultWidthX=c._privateDict.defaultWidthX,r.nominalWidthX=c._privateDict.nominalWidthX),void 0!==c.ros[0]&&void 0!==c.ros[1]&&(r.isCIDFont=!0),r.isCIDFont){var h=c.fdArray,d=c.fdSelect;if(0===h||0===d)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");var p=Yy(e,h+=t),f=ib(e,t,p.objects,s.objects);c._fdArray=f,d+=t,c._fdSelect=function(e,t,r,n){var i,o=[],a=new Dy.Parser(e,t),s=a.parseCard8();if(0===s)for(var l=0;l<r;l++){if((i=a.parseCard8())>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");o.push(i)}else{if(3!==s)throw new Error("CFF Table CID Font FDSelect table has unsupported format "+s);var u=a.parseCard16(),c=a.parseCard16();if(0!==c)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+c);for(var h,d=0;d<u;d++){if(i=a.parseCard8(),h=a.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(h>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+h);for(;c<h;c++)o.push(i);c=h}if(h!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+h)}return o}(e,d,r.numGlyphs,f.length)}var m,v=t+c.private[1],g=nb(e,v,c.private[0],s.objects);if(r.defaultWidthX=g.defaultWidthX,r.nominalWidthX=g.nominalWidthX,0!==g.subrs){var y=v+g.subrs,b=Yy(e,y);r.subrs=b.objects,r.subrsBias=Xy(r.subrs)}else r.subrs=[],r.subrsBias=0;n.lowMemory?(m=function(e,t){var r,n,i=[],o=Dy.getCard16(e,t);if(0!==o){var a=Dy.getByte(e,t+2);r=t+(o+1)*a+2;for(var s=t+3,l=0;l<o+1;l+=1)i.push(Dy.getOffset(e,s,a)),s+=a;n=r+i[o]}else n=t+2;return{offsets:i,startOffset:t,endOffset:n}}(e,t+c.charStrings),r.nGlyphs=m.offsets.length):(m=Yy(e,t+c.charStrings),r.nGlyphs=m.objects.length);var x=function(e,t,r,n){var i,o,a=new Dy.Parser(e,t);r-=1;var s=[".notdef"],l=a.parseCard8();if(0===l)for(var u=0;u<r;u+=1)i=a.parseSID(),s.push(Qy(n,i));else if(1===l)for(;s.length<=r;){i=a.parseSID(),o=a.parseCard8();for(var c=0;c<=o;c+=1)s.push(Qy(n,i)),i+=1}else{if(2!==l)throw new Error("Unknown charset format "+l);for(;s.length<=r;){i=a.parseSID(),o=a.parseCard16();for(var h=0;h<=o;h+=1)s.push(Qy(n,i)),i+=1}}return s}(e,t+c.charset,r.nGlyphs,s.objects);if(0===c.encoding?r.cffEncoding=new By(Uy,x):1===c.encoding?r.cffEncoding=new By(Iy,x):r.cffEncoding=function(e,t,r){var n,i={},o=new Dy.Parser(e,t),a=o.parseCard8();if(0===a)for(var s=o.parseCard8(),l=0;l<s;l+=1)i[n=o.parseCard8()]=l;else{if(1!==a)throw new Error("Unknown encoding format "+a);var u=o.parseCard8();n=1;for(var c=0;c<u;c+=1)for(var h=o.parseCard8(),d=o.parseCard8(),p=h;p<=h+d;p+=1)i[p]=n,n+=1}return new By(i,r)}(e,t+c.encoding,x),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new qy.GlyphSet(r),n.lowMemory)r._push=function(n){var i=function(e,t,r,n,i){var o=Dy.getCard16(r,n),a=0;0!==o&&(a=n+(o+1)*Dy.getByte(r,n+2)+2);var s=Dy.getBytes(r,a+t[e],a+t[e+1]);return i&&(s=i(s)),s}(n,m.offsets,e,t+c.charStrings);r.glyphs.push(n,qy.cffGlyphLoader(r,n,ob,i))};else for(var w=0;w<r.nGlyphs;w+=1){var _=m.objects[w];r.glyphs.push(w,qy.cffGlyphLoader(r,w,ob,_))}},make:function(e,t){for(var r,n=new _y.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),i=1/t.unitsPerEm,o={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[i,0,0,i,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},a=[],s=1;s<e.length;s+=1)r=e.get(s),a.push(r.name);var l=[];n.header=new _y.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}]),n.nameIndex=function(e){var t=new _y.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var r=0;r<e.length;r+=1)t.names.push({name:"name_"+r,type:"NAME",value:e[r]});return t}([t.postScriptName]);var u=lb(o,l);n.topDictIndex=ub(u),n.globalSubrIndex=new _y.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}]),n.charsets=function(e,t){for(var r=new _y.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<e.length;n+=1){var i=ab(e[n],t);r.fields.push({name:"glyph_"+n,type:"SID",value:i})}return r}(a,l),n.charStringsIndex=function(e){for(var t=new _y.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<e.length;r+=1){var n=e.get(r),i=cb(n);t.charStrings.push({name:n.name,type:"CHARSTRING",value:i})}return t}(e),n.privateDict=function(e,t){var r=new _y.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=sb(tb,e,t),r}({},l),n.stringIndex=function(e){var t=new _y.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var r=0;r<e.length;r+=1)t.strings.push({name:"string_"+r,type:"STRING",value:e[r]});return t}(l);var c=n.header.sizeOf()+n.nameIndex.sizeOf()+n.topDictIndex.sizeOf()+n.stringIndex.sizeOf()+n.globalSubrIndex.sizeOf();return o.charset=c,o.encoding=0,o.charStrings=o.charset+n.charsets.sizeOf(),o.private[1]=o.charStrings+n.charStringsIndex.sizeOf(),u=lb(o,l),n.topDictIndex=ub(u),n}};var db={parse:function(e,t){var r={},n=new Dy.Parser(e,t);return r.version=n.parseVersion(),r.fontRevision=Math.round(1e3*n.parseFixed())/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),ey.argument(1594834165===r.magicNumber,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r},make:function(e){var t=Math.round((new Date).getTime()/1e3)+2082844800,r=t;return e.createdTimestamp&&(r=e.createdTimestamp+2082844800),new _y.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:t},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}};var pb={parse:function(e,t){var r={},n=new Dy.Parser(e,t);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r},make:function(e){return new _y.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}};var fb={parse:function(e,t,r,n,i,o,a){a.lowMemory?function(e,t,r,n,i){e._hmtxTableData={};for(var o,a,s=new Dy.Parser(t,r),l=0;l<i;l+=1)l<n&&(o=s.parseUShort(),a=s.parseShort()),e._hmtxTableData[l]={advanceWidth:o,leftSideBearing:a}}(e,t,r,n,i):function(e,t,r,n,i){for(var o,a,s=new Dy.Parser(e,t),l=0;l<n;l+=1){l<r&&(o=s.parseUShort(),a=s.parseShort());var u=i.get(l);u.advanceWidth=o,u.leftSideBearing=a}}(t,r,n,i,o)},make:function(e){for(var t=new _y.Table("hmtx",[]),r=0;r<e.length;r+=1){var n=e.get(r),i=n.advanceWidth||0,o=n.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:i}),t.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:o})}return t}};var mb={make:function(e){for(var t=new _y.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),r="",n=12+4*e.length,i=0;i<e.length;++i){var o=r.indexOf(e[i]);o<0&&(o=r.length,r+=e[i]),t.fields.push({name:"offset "+i,type:"USHORT",value:n+o}),t.fields.push({name:"length "+i,type:"USHORT",value:e[i].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),t},parse:function(e,t){var r=new Dy.Parser(e,t),n=r.parseULong();ey.argument(1===n,"Unsupported ltag table version."),r.skip("uLong",1);for(var i=r.parseULong(),o=[],a=0;a<i;a++){for(var s="",l=t+r.parseUShort(),u=r.parseUShort(),c=l;c<l+u;++c)s+=String.fromCharCode(e.getInt8(c));o.push(s)}return o}};var vb={parse:function(e,t){var r={},n=new Dy.Parser(e,t);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),1===r.version&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r},make:function(e){return new _y.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}},gb=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],yb={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},bb={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},xb={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function wb(e,t,r){switch(e){case 0:if(65535===t)return"und";if(r)return r[t];break;case 1:return yb[t];case 3:return xb[t]}}var _b="utf-16",Sb={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Ob={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Tb(e,t,r){switch(e){case 0:return _b;case 1:return Ob[r]||Sb[t];case 3:if(1===t||10===t)return _b}}function Eb(e){var t={};for(var r in e)t[e[r]]=parseInt(r);return t}function Cb(e,t,r,n,i,o){return new _y.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:i},{name:"offset",type:"USHORT",value:o}])}function Ab(e,t){var r=function(e,t){var r=e.length,n=t.length-r+1;e:for(var i=0;i<n;i++)for(;i<n;i++){for(var o=0;o<r;o++)if(t[i+o]!==e[o])continue e;return i}return-1}(e,t);if(r<0){r=t.length;for(var n=0,i=e.length;n<i;++n)t.push(e[n])}return r}var Mb={parse:function(e,t,r){for(var n={},i=new Dy.Parser(e,t),o=i.parseUShort(),a=i.parseUShort(),s=i.offset+i.parseUShort(),l=0;l<a;l++){var u=i.parseUShort(),c=i.parseUShort(),h=i.parseUShort(),d=i.parseUShort(),p=gb[d]||d,f=i.parseUShort(),m=i.parseUShort(),v=wb(u,h,r),g=Tb(u,c,h);if(void 0!==g&&void 0!==v){var y=void 0;if(y=g===_b?ry.UTF16(e,s+m,f):ry.MACSTRING(e,s+m,f,g)){var b=n[p];void 0===b&&(b=n[p]={}),b[v]=y}}}return 1===o&&i.parseUShort(),n},make:function(e,t){var r,n=[],i={},o=Eb(gb);for(var a in e){var s=o[a];if(void 0===s&&(s=a),r=parseInt(s),isNaN(r))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');i[r]=e[a],n.push(r)}for(var l=Eb(yb),u=Eb(xb),c=[],h=[],d=0;d<n.length;d++){var p=i[r=n[d]];for(var f in p){var m=p[f],v=1,g=l[f],y=bb[g],b=Tb(v,y,g),x=ny.MACSTRING(m,b);void 0===x&&(v=0,(g=t.indexOf(f))<0&&(g=t.length,t.push(f)),y=4,x=ny.UTF16(m));var w=Ab(x,h);c.push(Cb(v,y,g,r,x.length,w));var _=u[f];if(void 0!==_){var S=ny.UTF16(m),O=Ab(S,h);c.push(Cb(3,1,_,r,S.length,O))}}}c.sort((function(e,t){return e.platformID-t.platformID||e.encodingID-t.encodingID||e.languageID-t.languageID||e.nameID-t.nameID}));for(var T=new _y.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+12*c.length}]),E=0;E<c.length;E++)T.fields.push({name:"record_"+E,type:"RECORD",value:c[E]});return T.fields.push({name:"strings",type:"LITERAL",value:h}),T}},Db=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];var Pb={parse:function(e,t){var r={},n=new Dy.Parser(e,t);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var i=0;i<10;i++)r.panose[i]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r},make:function(e){return new _y.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)},unicodeRanges:Db,getUnicodeRange:function(e){for(var t=0;t<Db.length;t+=1){var r=Db[t];if(e>=r.begin&&e<r.end)return t}return-1}};var kb={parse:function(e,t){var r={},n=new Dy.Parser(e,t);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=zy.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var i=0;i<r.numberOfGlyphs;i++)r.glyphNameIndex[i]=n.parseUShort();r.names=[];for(var o=0;o<r.numberOfGlyphs;o++)if(r.glyphNameIndex[o]>=zy.length){var a=n.parseChar();r.names.push(n.parseString(a))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var s=0;s<r.numberOfGlyphs;s++)r.offset[s]=n.parseChar()}return r},make:function(){return new _y.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}},Lb=new Array(9);Lb[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(Ay.coverage),deltaGlyphId:this.parseUShort()}:2===t?{substFormat:2,coverage:this.parsePointer(Ay.coverage),substitute:this.parseOffset16List()}:void ey.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},Lb[2]=function(){var e=this.parseUShort();return ey.argument(1===e,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ay.coverage),sequences:this.parseListOfLists()}},Lb[3]=function(){var e=this.parseUShort();return ey.argument(1===e,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ay.coverage),alternateSets:this.parseListOfLists()}},Lb[4]=function(){var e=this.parseUShort();return ey.argument(1===e,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ay.coverage),ligatureSets:this.parseListOfLists((function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}}))}};var Ub={sequenceIndex:Ay.uShort,lookupListIndex:Ay.uShort};Lb[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{substFormat:t,coverage:this.parsePointer(Ay.coverage),ruleSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{input:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,Ub)}}))};if(2===t)return{substFormat:t,coverage:this.parsePointer(Ay.coverage),classDef:this.parsePointer(Ay.classDef),classSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{classes:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,Ub)}}))};if(3===t){var r=this.parseUShort(),n=this.parseUShort();return{substFormat:t,coverages:this.parseList(r,Ay.pointer(Ay.coverage)),lookupRecords:this.parseRecordList(n,Ub)}}ey.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},Lb[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(Ay.coverage),chainRuleSets:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Ub)}}))}:2===t?{substFormat:2,coverage:this.parsePointer(Ay.coverage),backtrackClassDef:this.parsePointer(Ay.classDef),inputClassDef:this.parsePointer(Ay.classDef),lookaheadClassDef:this.parsePointer(Ay.classDef),chainClassSet:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Ub)}}))}:3===t?{substFormat:3,backtrackCoverage:this.parseList(Ay.pointer(Ay.coverage)),inputCoverage:this.parseList(Ay.pointer(Ay.coverage)),lookaheadCoverage:this.parseList(Ay.pointer(Ay.coverage)),lookupRecords:this.parseRecordList(Ub)}:void ey.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},Lb[7]=function(){var e=this.parseUShort();ey.argument(1===e,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),r=new Ay(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:Lb[t].call(r)}},Lb[8]=function(){var e=this.parseUShort();return ey.argument(1===e,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ay.coverage),backtrackCoverage:this.parseList(Ay.pointer(Ay.coverage)),lookaheadCoverage:this.parseList(Ay.pointer(Ay.coverage)),substitutes:this.parseUShortList()}};var Ib=new Array(9);Ib[1]=function(e){return 1===e.substFormat?new _y.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new _y.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new _y.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new _y.Coverage(e.coverage)}].concat(_y.ushortList("substitute",e.substitute)))},Ib[2]=function(e){return ey.assert(1===e.substFormat,"Lookup type 2 substFormat must be 1."),new _y.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new _y.Coverage(e.coverage)}].concat(_y.tableList("seqSet",e.sequences,(function(e){return new _y.Table("sequenceSetTable",_y.ushortList("sequence",e))}))))},Ib[3]=function(e){return ey.assert(1===e.substFormat,"Lookup type 3 substFormat must be 1."),new _y.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new _y.Coverage(e.coverage)}].concat(_y.tableList("altSet",e.alternateSets,(function(e){return new _y.Table("alternateSetTable",_y.ushortList("alternate",e))}))))},Ib[4]=function(e){return ey.assert(1===e.substFormat,"Lookup type 4 substFormat must be 1."),new _y.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new _y.Coverage(e.coverage)}].concat(_y.tableList("ligSet",e.ligatureSets,(function(e){return new _y.Table("ligatureSetTable",_y.tableList("ligature",e,(function(e){return new _y.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:e.ligGlyph}].concat(_y.ushortList("component",e.components,e.components.length+1)))})))}))))},Ib[6]=function(e){if(1===e.substFormat){var t=new _y.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new _y.Coverage(e.coverage)}].concat(_y.tableList("chainRuleSet",e.chainRuleSets,(function(e){return new _y.Table("chainRuleSetTable",_y.tableList("chainRule",e,(function(e){var t=_y.ushortList("backtrackGlyph",e.backtrack,e.backtrack.length).concat(_y.ushortList("inputGlyph",e.input,e.input.length+1)).concat(_y.ushortList("lookaheadGlyph",e.lookahead,e.lookahead.length)).concat(_y.ushortList("substitution",[],e.lookupRecords.length));return e.lookupRecords.forEach((function(e,r){t=t.concat({name:"sequenceIndex"+r,type:"USHORT",value:e.sequenceIndex}).concat({name:"lookupListIndex"+r,type:"USHORT",value:e.lookupListIndex})})),new _y.Table("chainRuleTable",t)})))}))));return t}if(2===e.substFormat)ey.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(3===e.substFormat){var r=[{name:"substFormat",type:"USHORT",value:e.substFormat}];return r.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach((function(e,t){r.push({name:"backtrackCoverage"+t,type:"TABLE",value:new _y.Coverage(e)})})),r.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach((function(e,t){r.push({name:"inputCoverage"+t,type:"TABLE",value:new _y.Coverage(e)})})),r.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach((function(e,t){r.push({name:"lookaheadCoverage"+t,type:"TABLE",value:new _y.Coverage(e)})})),r.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach((function(e,t){r=r.concat({name:"sequenceIndex"+t,type:"USHORT",value:e.sequenceIndex}).concat({name:"lookupListIndex"+t,type:"USHORT",value:e.lookupListIndex})})),new _y.Table("chainContextTable",r)}ey.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};var zb={parse:function(e,t){var r=new Ay(e,t=t||0),n=r.parseVersion(1);return ey.argument(1===n||1.1===n,"Unsupported GSUB table version."),1===n?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Lb)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Lb),variations:r.parseFeatureVariationsList()}},make:function(e){return new _y.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new _y.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new _y.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new _y.LookupList(e.lookups,Ib)}])}};var Rb={parse:function(e,t){var r=new Dy.Parser(e,t),n=r.parseULong();ey.argument(1===n,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var i=r.parseULong(),o={},a=0;a<i;a++){var s=r.parseTag(),l=r.parseULong(),u=r.parseULong(),c=ry.UTF8(e,t+l,u);o[s]=c}return o},make:function(e){var t=Object.keys(e).length,r="",n=16+12*t,i=new _y.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:t}]);for(var o in e){var a=r.length;r+=e[o],i.fields.push({name:"tag "+o,type:"TAG",value:o}),i.fields.push({name:"offset "+o,type:"ULONG",value:n+a}),i.fields.push({name:"length "+o,type:"ULONG",value:e[o].length})}return i.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),i}};function Nb(e){return Math.log(e)/Math.log(2)|0}function Bb(e){for(;e.length%4!=0;)e.push(0);for(var t=0,r=0;r<e.length;r+=4)t+=(e[r]<<24)+(e[r+1]<<16)+(e[r+2]<<8)+e[r+3];return t%=Math.pow(2,32)}function Fb(e,t,r,n){return new _y.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==t?t:0},{name:"offset",type:"ULONG",value:void 0!==r?r:0},{name:"length",type:"ULONG",value:void 0!==n?n:0}])}function jb(e){var t=new _y.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var r=Math.pow(2,Nb(t.numTables));t.searchRange=16*r,t.entrySelector=Nb(r),t.rangeShift=16*t.numTables-t.searchRange;for(var n=[],i=[],o=t.sizeOf()+Fb().sizeOf()*t.numTables;o%4!=0;)o+=1,i.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<e.length;a+=1){var s=e[a];ey.argument(4===s.tableName.length,"Table name"+s.tableName+" is invalid.");var l=s.sizeOf(),u=Fb(s.tableName,Bb(s.encode()),o,l);for(n.push({name:u.tag+" Table Record",type:"RECORD",value:u}),i.push({name:s.tableName+" table",type:"RECORD",value:s}),o+=l,ey.argument(!isNaN(o),"Something went wrong calculating the offset.");o%4!=0;)o+=1,i.push({name:"padding",type:"BYTE",value:0})}return n.sort((function(e,t){return e.value.tag>t.value.tag?1:-1})),t.fields=t.fields.concat(n),t.fields=t.fields.concat(i),t}function Gb(e,t,r){for(var n=0;n<t.length;n+=1){var i=e.charToGlyphIndex(t[n]);if(i>0)return e.glyphs.get(i).getMetrics()}return r}function Vb(e){for(var t=0,r=0;r<e.length;r+=1)t+=e[r];return t/e.length}var Hb={make:jb,fontToTable:function(e){for(var t,r=[],n=[],i=[],o=[],a=[],s=[],l=[],u=0,c=0,h=0,d=0,p=0,f=0;f<e.glyphs.length;f+=1){var m=e.glyphs.get(f),v=0|m.unicode;if(isNaN(m.advanceWidth))throw new Error("Glyph "+m.name+" ("+f+"): advanceWidth is not a number.");(t>v||void 0===t)&&v>0&&(t=v),u<v&&(u=v);var g=Pb.getUnicodeRange(v);if(g<32)c|=1<<g;else if(g<64)h|=1<<g-32;else if(g<96)d|=1<<g-64;else{if(!(g<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");p|=1<<g-96}if(".notdef"!==m.name){var y=m.getMetrics();r.push(y.xMin),n.push(y.yMin),i.push(y.xMax),o.push(y.yMax),s.push(y.leftSideBearing),l.push(y.rightSideBearing),a.push(m.advanceWidth)}}var b={xMin:Math.min.apply(null,r),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,i),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,a),advanceWidthAvg:Vb(a),minLeftSideBearing:Math.min.apply(null,s),maxLeftSideBearing:Math.max.apply(null,s),minRightSideBearing:Math.min.apply(null,l)};b.ascender=e.ascender,b.descender=e.descender;var x=db.make({flags:3,unitsPerEm:e.unitsPerEm,xMin:b.xMin,yMin:b.yMin,xMax:b.xMax,yMax:b.yMax,lowestRecPPEM:3,createdTimestamp:e.createdTimestamp}),w=pb.make({ascender:b.ascender,descender:b.descender,advanceWidthMax:b.advanceWidthMax,minLeftSideBearing:b.minLeftSideBearing,minRightSideBearing:b.minRightSideBearing,xMaxExtent:b.maxLeftSideBearing+(b.xMax-b.xMin),numberOfHMetrics:e.glyphs.length}),_=vb.make(e.glyphs.length),S=Pb.make(Object.assign({xAvgCharWidth:Math.round(b.advanceWidthAvg),usFirstCharIndex:t,usLastCharIndex:u,ulUnicodeRange1:c,ulUnicodeRange2:h,ulUnicodeRange3:d,ulUnicodeRange4:p,sTypoAscender:b.ascender,sTypoDescender:b.descender,sTypoLineGap:0,usWinAscent:b.yMax,usWinDescent:Math.abs(b.yMin),ulCodePageRange1:1,sxHeight:Gb(e,"xyvw",{yMax:Math.round(b.ascender/2)}).yMax,sCapHeight:Gb(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",b).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0},e.tables.os2)),O=fb.make(e.glyphs),T=ky.make(e.glyphs),E=e.getEnglishName("fontFamily"),C=e.getEnglishName("fontSubfamily"),A=E+" "+C,M=e.getEnglishName("postScriptName");M||(M=E.replace(/\s/g,"")+"-"+C);var D={};for(var P in e.names)D[P]=e.names[P];D.uniqueID||(D.uniqueID={en:e.getEnglishName("manufacturer")+":"+A}),D.postScriptName||(D.postScriptName={en:M}),D.preferredFamily||(D.preferredFamily=e.names.fontFamily),D.preferredSubfamily||(D.preferredSubfamily=e.names.fontSubfamily);var k=[],L=Mb.make(D,k),U=k.length>0?mb.make(k):void 0,I=kb.make(),z=hb.make(e.glyphs,{version:e.getEnglishName("version"),fullName:A,familyName:E,weightName:C,postScriptName:M,unitsPerEm:e.unitsPerEm,fontBBox:[0,b.yMin,b.ascender,b.advanceWidthMax]}),R=e.metas&&Object.keys(e.metas).length>0?Rb.make(e.metas):void 0,N=[x,w,_,S,L,T,I,z,O];U&&N.push(U),e.tables.gsub&&N.push(zb.make(e.tables.gsub)),R&&N.push(R);for(var B=jb(N),F=Bb(B.encode()),j=B.fields,G=!1,V=0;V<j.length;V+=1)if("head table"===j[V].name){j[V].value.checkSumAdjustment=2981146554-F,G=!0;break}if(!G)throw new Error("Could not find head table with checkSum to adjust.");return B},computeCheckSum:Bb};function Wb(e,t){for(var r=0,n=e.length-1;r<=n;){var i=r+n>>>1,o=e[i].tag;if(o===t)return i;o<t?r=i+1:n=i-1}return-r-1}function qb(e,t){for(var r=0,n=e.length-1;r<=n;){var i=r+n>>>1,o=e[i];if(o===t)return i;o<t?r=i+1:n=i-1}return-r-1}function $b(e,t){for(var r,n=0,i=e.length-1;n<=i;){var o=n+i>>>1,a=(r=e[o]).start;if(a===t)return r;a<t?n=o+1:i=o-1}if(n>0)return t>(r=e[n-1]).end?0:r}function Xb(e,t){this.font=e,this.tableName=t}function Yb(e){Xb.call(this,e,"gpos")}function Zb(e){Xb.call(this,e,"gsub")}function Kb(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Qb(e,t,r){for(var n=e.subtables,i=0;i<n.length;i++){var o=n[i];if(o.substFormat===t)return o}if(r)return n.push(r),r}function Jb(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;++n)r[n]=e[n];return t}function ex(e,t){if(!e)throw t}function tx(e,t,r,n,i){var o;return(t&n)>0?(o=e.parseByte(),0==(t&i)&&(o=-o),o=r+o):o=(t&i)>0?r:r+e.parseShort(),o}function rx(e,t,r){var n,i,o=new Dy.Parser(t,r);if(e.numberOfContours=o.parseShort(),e._xMin=o.parseShort(),e._yMin=o.parseShort(),e._xMax=o.parseShort(),e._yMax=o.parseShort(),e.numberOfContours>0){for(var a=e.endPointIndices=[],s=0;s<e.numberOfContours;s+=1)a.push(o.parseUShort());e.instructionLength=o.parseUShort(),e.instructions=[];for(var l=0;l<e.instructionLength;l+=1)e.instructions.push(o.parseByte());var u=a[a.length-1]+1;n=[];for(var c=0;c<u;c+=1)if(i=o.parseByte(),n.push(i),(8&i)>0)for(var h=o.parseByte(),d=0;d<h;d+=1)n.push(i),c+=1;if(ey.argument(n.length===u,"Bad flags."),a.length>0){var p,f=[];if(u>0){for(var m=0;m<u;m+=1)i=n[m],(p={}).onCurve=!!(1&i),p.lastPointOfContour=a.indexOf(m)>=0,f.push(p);for(var v=0,g=0;g<u;g+=1)i=n[g],(p=f[g]).x=tx(o,i,v,2,16),v=p.x;for(var y=0,b=0;b<u;b+=1)i=n[b],(p=f[b]).y=tx(o,i,y,4,32),y=p.y}e.points=f}else e.points=[]}else if(0===e.numberOfContours)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var x=!0;x;){n=o.parseUShort();var w={glyphIndex:o.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&n)>0?(2&n)>0?(w.dx=o.parseShort(),w.dy=o.parseShort()):w.matchedPoints=[o.parseUShort(),o.parseUShort()]:(2&n)>0?(w.dx=o.parseChar(),w.dy=o.parseChar()):w.matchedPoints=[o.parseByte(),o.parseByte()],(8&n)>0?w.xScale=w.yScale=o.parseF2Dot14():(64&n)>0?(w.xScale=o.parseF2Dot14(),w.yScale=o.parseF2Dot14()):(128&n)>0&&(w.xScale=o.parseF2Dot14(),w.scale01=o.parseF2Dot14(),w.scale10=o.parseF2Dot14(),w.yScale=o.parseF2Dot14()),e.components.push(w),x=!!(32&n)}if(256&n){e.instructionLength=o.parseUShort(),e.instructions=[];for(var _=0;_<e.instructionLength;_+=1)e.instructions.push(o.parseByte())}}}function nx(e,t){for(var r=[],n=0;n<e.length;n+=1){var i=e[n],o={x:t.xScale*i.x+t.scale01*i.y+t.dx,y:t.scale10*i.x+t.yScale*i.y+t.dy,onCurve:i.onCurve,lastPointOfContour:i.lastPointOfContour};r.push(o)}return r}function ix(e){var t=new Kg;if(!e)return t;for(var r=function(e){for(var t=[],r=[],n=0;n<e.length;n+=1){var i=e[n];r.push(i),i.lastPointOfContour&&(t.push(r),r=[])}return ey.argument(0===r.length,"There are still points left in the current contour."),t}(e),n=0;n<r.length;++n){var i=r[n],o=null,a=i[i.length-1],s=i[0];if(a.onCurve)t.moveTo(a.x,a.y);else if(s.onCurve)t.moveTo(s.x,s.y);else{var l={x:.5*(a.x+s.x),y:.5*(a.y+s.y)};t.moveTo(l.x,l.y)}for(var u=0;u<i.length;++u)if(o=a,a=s,s=i[(u+1)%i.length],a.onCurve)t.lineTo(a.x,a.y);else{var c=s;o.onCurve||(a.x,o.x,a.y,o.y),s.onCurve||(c={x:.5*(a.x+s.x),y:.5*(a.y+s.y)}),t.quadraticCurveTo(a.x,a.y,c.x,c.y)}t.closePath()}return t}function ox(e,t){if(t.isComposite)for(var r=0;r<t.components.length;r+=1){var n=t.components[r],i=e.get(n.glyphIndex);if(i.getPath(),i.points){var o=void 0;if(void 0===n.matchedPoints)o=nx(i.points,n);else{if(n.matchedPoints[0]>t.points.length-1||n.matchedPoints[1]>i.points.length-1)throw Error("Matched points out of range in "+t.name);var a=t.points[n.matchedPoints[0]],s=i.points[n.matchedPoints[1]],l={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};s=nx([s],l)[0],l.dx=a.x-s.x,l.dy=a.y-s.y,o=nx(i.points,l)}t.points=t.points.concat(o)}}return ix(t.points)}Xb.prototype={searchTag:Wb,binSearch:qb,getTable:function(e){var t=this.font.tables[this.tableName];return!t&&e&&(t=this.font.tables[this.tableName]=this.createDefaultTable()),t},getScriptNames:function(){var e=this.getTable();return e?e.scripts.map((function(e){return e.tag})):[]},getDefaultScriptName:function(){var e=this.getTable();if(e){for(var t=!1,r=0;r<e.scripts.length;r++){var n=e.scripts[r].tag;if("DFLT"===n)return n;"latn"===n&&(t=!0)}if(t)return"latn"}},getScriptTable:function(e,t){var r=this.getTable(t);if(r){e=e||"DFLT";var n=r.scripts,i=Wb(r.scripts,e);if(i>=0)return n[i].script;if(t){var o={tag:e,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-i,0,o),o.script}}},getLangSysTable:function(e,t,r){var n=this.getScriptTable(e,r);if(n){if(!t||"dflt"===t||"DFLT"===t)return n.defaultLangSys;var i=Wb(n.langSysRecords,t);if(i>=0)return n.langSysRecords[i].langSys;if(r){var o={tag:t,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-i,0,o),o.langSys}}},getFeatureTable:function(e,t,r,n){var i=this.getLangSysTable(e,t,n);if(i){for(var o,a=i.featureIndexes,s=this.font.tables[this.tableName].features,l=0;l<a.length;l++)if((o=s[a[l]]).tag===r)return o.feature;if(n){var u=s.length;return ey.assert(0===u||r>=s[u-1].tag,"Features must be added in alphabetical order."),o={tag:r,feature:{params:0,lookupListIndexes:[]}},s.push(o),a.push(u),o.feature}}},getLookupTables:function(e,t,r,n,i){var o=this.getFeatureTable(e,t,r,i),a=[];if(o){for(var s,l=o.lookupListIndexes,u=this.font.tables[this.tableName].lookups,c=0;c<l.length;c++)(s=u[l[c]]).lookupType===n&&a.push(s);if(0===a.length&&i){s={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var h=u.length;return u.push(s),l.push(h),[s]}}return a},getGlyphClass:function(e,t){switch(e.format){case 1:return e.startGlyph<=t&&t<e.startGlyph+e.classes.length?e.classes[t-e.startGlyph]:0;case 2:var r=$b(e.ranges,t);return r?r.classId:0}},getCoverageIndex:function(e,t){switch(e.format){case 1:var r=qb(e.glyphs,t);return r>=0?r:-1;case 2:var n=$b(e.ranges,t);return n?n.index+t-n.start:-1}},expandCoverage:function(e){if(1===e.format)return e.glyphs;for(var t=[],r=e.ranges,n=0;n<r.length;n++)for(var i=r[n],o=i.start,a=i.end,s=o;s<=a;s++)t.push(s);return t}},Yb.prototype=Xb.prototype,Yb.prototype.init=function(){var e=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(e)},Yb.prototype.getKerningValue=function(e,t,r){for(var n=0;n<e.length;n++)for(var i=e[n].subtables,o=0;o<i.length;o++){var a=i[o],s=this.getCoverageIndex(a.coverage,t);if(!(s<0))switch(a.posFormat){case 1:for(var l=a.pairSets[s],u=0;u<l.length;u++){var c=l[u];if(c.secondGlyph===r)return c.value1&&c.value1.xAdvance||0}break;case 2:var h=this.getGlyphClass(a.classDef1,t),d=this.getGlyphClass(a.classDef2,r),p=a.classRecords[h][d];return p.value1&&p.value1.xAdvance||0}}return 0},Yb.prototype.getKerningTables=function(e,t){if(this.font.tables.gpos)return this.getLookupTables(e,t,"kern",2)},Zb.prototype=Xb.prototype,Zb.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Zb.prototype.getSingle=function(e,t,r){for(var n=[],i=this.getLookupTables(t,r,e,1),o=0;o<i.length;o++)for(var a=i[o].subtables,s=0;s<a.length;s++){var l=a[s],u=this.expandCoverage(l.coverage),c=void 0;if(1===l.substFormat){var h=l.deltaGlyphId;for(c=0;c<u.length;c++){var d=u[c];n.push({sub:d,by:d+h})}}else{var p=l.substitute;for(c=0;c<u.length;c++)n.push({sub:u[c],by:p[c]})}}return n},Zb.prototype.getMultiple=function(e,t,r){for(var n=[],i=this.getLookupTables(t,r,e,2),o=0;o<i.length;o++)for(var a=i[o].subtables,s=0;s<a.length;s++){var l=a[s],u=this.expandCoverage(l.coverage),c=void 0;for(c=0;c<u.length;c++){var h=u[c],d=l.sequences[c];n.push({sub:h,by:d})}}return n},Zb.prototype.getAlternates=function(e,t,r){for(var n=[],i=this.getLookupTables(t,r,e,3),o=0;o<i.length;o++)for(var a=i[o].subtables,s=0;s<a.length;s++)for(var l=a[s],u=this.expandCoverage(l.coverage),c=l.alternateSets,h=0;h<u.length;h++)n.push({sub:u[h],by:c[h]});return n},Zb.prototype.getLigatures=function(e,t,r){for(var n=[],i=this.getLookupTables(t,r,e,4),o=0;o<i.length;o++)for(var a=i[o].subtables,s=0;s<a.length;s++)for(var l=a[s],u=this.expandCoverage(l.coverage),c=l.ligatureSets,h=0;h<u.length;h++)for(var d=u[h],p=c[h],f=0;f<p.length;f++){var m=p[f];n.push({sub:[d].concat(m.components),by:m.ligGlyph})}return n},Zb.prototype.addSingle=function(e,t,r,n){var i=Qb(this.getLookupTables(r,n,e,1,!0)[0],2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});ey.assert(1===i.coverage.format,"Single: unable to modify coverage table format "+i.coverage.format);var o=t.sub,a=this.binSearch(i.coverage.glyphs,o);a<0&&(a=-1-a,i.coverage.glyphs.splice(a,0,o),i.substitute.splice(a,0,0)),i.substitute[a]=t.by},Zb.prototype.addMultiple=function(e,t,r,n){ey.assert(t.by instanceof Array&&t.by.length>1,'Multiple: "by" must be an array of two or more ids');var i=Qb(this.getLookupTables(r,n,e,2,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});ey.assert(1===i.coverage.format,"Multiple: unable to modify coverage table format "+i.coverage.format);var o=t.sub,a=this.binSearch(i.coverage.glyphs,o);a<0&&(a=-1-a,i.coverage.glyphs.splice(a,0,o),i.sequences.splice(a,0,0)),i.sequences[a]=t.by},Zb.prototype.addAlternate=function(e,t,r,n){var i=Qb(this.getLookupTables(r,n,e,3,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});ey.assert(1===i.coverage.format,"Alternate: unable to modify coverage table format "+i.coverage.format);var o=t.sub,a=this.binSearch(i.coverage.glyphs,o);a<0&&(a=-1-a,i.coverage.glyphs.splice(a,0,o),i.alternateSets.splice(a,0,0)),i.alternateSets[a]=t.by},Zb.prototype.addLigature=function(e,t,r,n){var i=this.getLookupTables(r,n,e,4,!0)[0],o=i.subtables[0];o||(o={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},i.subtables[0]=o),ey.assert(1===o.coverage.format,"Ligature: unable to modify coverage table format "+o.coverage.format);var a=t.sub[0],s=t.sub.slice(1),l={ligGlyph:t.by,components:s},u=this.binSearch(o.coverage.glyphs,a);if(u>=0){for(var c=o.ligatureSets[u],h=0;h<c.length;h++)if(Kb(c[h].components,s))return;c.push(l)}else u=-1-u,o.coverage.glyphs.splice(u,0,a),o.ligatureSets.splice(u,0,[l])},Zb.prototype.getFeature=function(e,t,r){if(/ss\d\d/.test(e))return this.getSingle(e,t,r);switch(e){case"aalt":case"salt":return this.getSingle(e,t,r).concat(this.getAlternates(e,t,r));case"dlig":case"liga":case"rlig":return this.getLigatures(e,t,r);case"ccmp":return this.getMultiple(e,t,r).concat(this.getLigatures(e,t,r));case"stch":return this.getMultiple(e,t,r)}},Zb.prototype.add=function(e,t,r,n){if(/ss\d\d/.test(e))return this.addSingle(e,t,r,n);switch(e){case"aalt":case"salt":return"number"==typeof t.by?this.addSingle(e,t,r,n):this.addAlternate(e,t,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(e,t,r,n);case"ccmp":return t.by instanceof Array?this.addMultiple(e,t,r,n):this.addLigature(e,t,r,n)}};var ax,sx,lx,ux,cx={getPath:ix,parse:function(e,t,r,n,i){return i.lowMemory?function(e,t,r,n){var i=new qy.GlyphSet(n);return n._push=function(o){var a=r[o];a!==r[o+1]?i.push(o,qy.ttfGlyphLoader(n,o,rx,e,t+a,ox)):i.push(o,qy.glyphLoader(n,o))},i}(e,t,r,n):function(e,t,r,n){for(var i=new qy.GlyphSet(n),o=0;o<r.length-1;o+=1){var a=r[o];a!==r[o+1]?i.push(o,qy.ttfGlyphLoader(n,o,rx,e,t+a,ox)):i.push(o,qy.glyphLoader(n,o))}return i}(e,t,r,n)}};function hx(e){this.font=e,this.getCommands=function(e){return cx.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function dx(e){return e}function px(e){return Math.sign(e)*Math.round(Math.abs(e))}function fx(e){return Math.sign(e)*Math.round(Math.abs(2*e))/2}function mx(e){return Math.sign(e)*(Math.round(Math.abs(e)+.5)-.5)}function vx(e){return Math.sign(e)*Math.ceil(Math.abs(e))}function gx(e){return Math.sign(e)*Math.floor(Math.abs(e))}var yx=function(e){var t=this.srPeriod,r=this.srPhase,n=1;return e<0&&(e=-e,n=-1),e+=this.srThreshold-r,e=Math.trunc(e/t)*t,(e+=r)<0?r*n:e*n},bx={x:1,y:0,axis:"x",distance:function(e,t,r,n){return(r?e.xo:e.x)-(n?t.xo:t.x)},interpolate:function(e,t,r,n){var i,o,a,s,l,u,c;if(!n||n===this)return i=e.xo-t.xo,o=e.xo-r.xo,l=t.x-t.xo,u=r.x-r.xo,0===(c=(a=Math.abs(i))+(s=Math.abs(o)))?void(e.x=e.xo+(l+u)/2):void(e.x=e.xo+(l*s+u*a)/c);i=n.distance(e,t,!0,!0),o=n.distance(e,r,!0,!0),l=n.distance(t,t,!1,!0),u=n.distance(r,r,!1,!0),0!==(c=(a=Math.abs(i))+(s=Math.abs(o)))?bx.setRelative(e,e,(l*s+u*a)/c,n,!0):bx.setRelative(e,e,(l+u)/2,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(e,t,r,n,i){if(n&&n!==this){var o=i?t.xo:t.x,a=i?t.yo:t.y,s=o+r*n.x,l=a+r*n.y;e.x=s+(e.y-l)/n.normalSlope}else e.x=(i?t.xo:t.x)+r},slope:0,touch:function(e){e.xTouched=!0},touched:function(e){return e.xTouched},untouch:function(e){e.xTouched=!1}},xx={x:0,y:1,axis:"y",distance:function(e,t,r,n){return(r?e.yo:e.y)-(n?t.yo:t.y)},interpolate:function(e,t,r,n){var i,o,a,s,l,u,c;if(!n||n===this)return i=e.yo-t.yo,o=e.yo-r.yo,l=t.y-t.yo,u=r.y-r.yo,0===(c=(a=Math.abs(i))+(s=Math.abs(o)))?void(e.y=e.yo+(l+u)/2):void(e.y=e.yo+(l*s+u*a)/c);i=n.distance(e,t,!0,!0),o=n.distance(e,r,!0,!0),l=n.distance(t,t,!1,!0),u=n.distance(r,r,!1,!0),0!==(c=(a=Math.abs(i))+(s=Math.abs(o)))?xx.setRelative(e,e,(l*s+u*a)/c,n,!0):xx.setRelative(e,e,(l+u)/2,n,!0)},normalSlope:0,setRelative:function(e,t,r,n,i){if(n&&n!==this){var o=i?t.xo:t.x,a=i?t.yo:t.y,s=o+r*n.x,l=a+r*n.y;e.y=l+n.normalSlope*(e.x-s)}else e.y=(i?t.yo:t.y)+r},slope:Number.POSITIVE_INFINITY,touch:function(e){e.yTouched=!0},touched:function(e){return e.yTouched},untouch:function(e){e.yTouched=!1}};function wx(e,t){this.x=e,this.y=t,this.axis=void 0,this.slope=t/e,this.normalSlope=-e/t,Object.freeze(this)}function _x(e,t){var r=Math.sqrt(e*e+t*t);return t/=r,1===(e/=r)&&0===t?bx:0===e&&1===t?xx:new wx(e,t)}function Sx(e,t,r,n){this.x=this.xo=Math.round(64*e)/64,this.y=this.yo=Math.round(64*t)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Object.freeze(bx),Object.freeze(xx),wx.prototype.distance=function(e,t,r,n){return this.x*bx.distance(e,t,r,n)+this.y*xx.distance(e,t,r,n)},wx.prototype.interpolate=function(e,t,r,n){var i,o,a,s,l,u,c;a=n.distance(e,t,!0,!0),s=n.distance(e,r,!0,!0),i=n.distance(t,t,!1,!0),o=n.distance(r,r,!1,!0),0!==(c=(l=Math.abs(a))+(u=Math.abs(s)))?this.setRelative(e,e,(i*u+o*l)/c,n,!0):this.setRelative(e,e,(i+o)/2,n,!0)},wx.prototype.setRelative=function(e,t,r,n,i){n=n||this;var o=i?t.xo:t.x,a=i?t.yo:t.y,s=o+r*n.x,l=a+r*n.y,u=n.normalSlope,c=this.slope,h=e.x,d=e.y;e.x=(c*h-u*s+l-d)/(c-u),e.y=c*(e.x-h)+d},wx.prototype.touch=function(e){e.xTouched=!0,e.yTouched=!0},Sx.prototype.nextTouched=function(e){for(var t=this.nextPointOnContour;!e.touched(t)&&t!==this;)t=t.nextPointOnContour;return t},Sx.prototype.prevTouched=function(e){for(var t=this.prevPointOnContour;!e.touched(t)&&t!==this;)t=t.prevPointOnContour;return t};var Ox=Object.freeze(new Sx(0,0)),Tx={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Ex(e,t){switch(this.env=e,this.stack=[],this.prog=t,e){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=bx,this.round=px}}function Cx(e){for(var t=e.tZone=new Array(e.gZone.length),r=0;r<t.length;r++)t[r]=new Sx(0,0)}function Ax(e,t){var r,n=e.prog,i=e.ip,o=1;do{if(88===(r=n[++i]))o++;else if(89===r)o--;else if(64===r)i+=n[i+1]+1;else if(65===r)i+=2*n[i+1]+1;else if(r>=176&&r<=183)i+=r-176+1;else if(r>=184&&r<=191)i+=2*(r-184+1);else if(t&&1===o&&27===r)break}while(o>0);e.ip=i}function Mx(e,t){exports.DEBUG,t.fv=t.pv=t.dpv=e}function Dx(e,t){exports.DEBUG,t.pv=t.dpv=e}function Px(e,t){exports.DEBUG,t.fv=e}function kx(e,t){var r,n,i=t.stack,o=i.pop(),a=i.pop(),s=t.z2[o],l=t.z1[a];exports.DEBUG,e?(r=s.y-l.y,n=l.x-s.x):(r=l.x-s.x,n=l.y-s.y),t.pv=t.dpv=_x(r,n)}function Lx(e,t){var r,n,i=t.stack,o=i.pop(),a=i.pop(),s=t.z2[o],l=t.z1[a];exports.DEBUG,e?(r=s.y-l.y,n=l.x-s.x):(r=l.x-s.x,n=l.y-s.y),t.fv=_x(r,n)}function Ux(e){exports.DEBUG,e.stack.pop()}function Ix(e,t){var r=t.stack.pop(),n=t.z0[r],i=t.fv,o=t.pv;exports.DEBUG;var a=o.distance(n,Ox);e&&(a=t.round(a)),i.setRelative(n,Ox,a,o),i.touch(n),t.rp0=t.rp1=r}function zx(e,t){var r,n,i,o=t.z2,a=o.length-2;exports.DEBUG;for(var s=0;s<a;s++)r=o[s],!e.touched(r)&&((n=r.prevTouched(e))!==r&&(n===(i=r.nextTouched(e))&&e.setRelative(r,r,e.distance(n,n,!1,!0),e,!0),e.interpolate(r,n,i,e)))}function Rx(e,t){for(var r=t.stack,n=e?t.rp1:t.rp2,i=(e?t.z0:t.z1)[n],o=t.fv,a=t.pv,s=t.loop,l=t.z2;s--;){var u=l[r.pop()],c=a.distance(i,i,!1,!0);o.setRelative(u,u,c,a),o.touch(u),exports.DEBUG}t.loop=1}function Nx(e,t){var r=t.stack,n=e?t.rp1:t.rp2,i=(e?t.z0:t.z1)[n],o=t.fv,a=t.pv,s=r.pop(),l=t.z2[t.contours[s]],u=l;exports.DEBUG;var c=a.distance(i,i,!1,!0);do{u!==i&&o.setRelative(u,u,c,a),u=u.nextPointOnContour}while(u!==l)}function Bx(e,t){var r,n=t.stack,i=e?t.rp1:t.rp2,o=(e?t.z0:t.z1)[i],a=t.fv,s=t.pv,l=n.pop();switch(exports.DEBUG,l){case 0:r=t.tZone;break;case 1:r=t.gZone;break;default:throw new Error("Invalid zone")}for(var u,c=s.distance(o,o,!1,!0),h=r.length-2,d=0;d<h;d++)u=r[d],a.setRelative(u,u,c,s)}function Fx(e,t){var r=t.stack,n=r.pop()/64,i=r.pop(),o=t.z1[i],a=t.z0[t.rp0],s=t.fv,l=t.pv;s.setRelative(o,a,n,l),s.touch(o),exports.DEBUG,t.rp1=t.rp0,t.rp2=i,e&&(t.rp0=i)}function jx(e,t){var r=t.stack,n=r.pop(),i=r.pop(),o=t.z0[i],a=t.fv,s=t.pv,l=t.cvt[n];exports.DEBUG;var u=s.distance(o,Ox);e&&(Math.abs(u-l)<t.cvCutIn&&(u=l),u=t.round(u)),a.setRelative(o,Ox,u,s),0===t.zp0&&(o.xo=o.x,o.yo=o.y),a.touch(o),t.rp0=t.rp1=i}function Gx(e,t){var r=t.stack,n=r.pop(),i=t.z2[n];exports.DEBUG,r.push(64*t.dpv.distance(i,Ox,e,!1))}function Vx(e,t){var r=t.stack,n=r.pop(),i=r.pop(),o=t.z1[n],a=t.z0[i],s=t.dpv.distance(a,o,e,e);exports.DEBUG,t.stack.push(Math.round(64*s))}function Hx(e,t){var r=t.stack,n=r.pop(),i=t.fv,o=t.pv,a=t.ppem,s=t.deltaBase+16*(e-1),l=t.deltaShift,u=t.z0;exports.DEBUG;for(var c=0;c<n;c++){var h=r.pop(),d=r.pop();if(s+((240&d)>>4)===a){var p=(15&d)-8;p>=0&&p++,exports.DEBUG;var f=u[h];i.setRelative(f,f,p*l,o)}}}function Wx(e,t){var r=t.stack,n=r.pop();exports.DEBUG,r.push(64*t.round(n/64))}function qx(e,t){var r=t.stack,n=r.pop(),i=t.ppem,o=t.deltaBase+16*(e-1),a=t.deltaShift;exports.DEBUG;for(var s=0;s<n;s++){var l=r.pop(),u=r.pop();if(o+((240&u)>>4)===i){var c=(15&u)-8;c>=0&&c++;var h=c*a;exports.DEBUG,t.cvt[l]+=h}}}function $x(e,t){var r,n,i=t.stack,o=i.pop(),a=i.pop(),s=t.z2[o],l=t.z1[a];exports.DEBUG,e?(r=s.y-l.y,n=l.x-s.x):(r=l.x-s.x,n=l.y-s.y),t.dpv=_x(r,n)}function Xx(e,t){var r=t.stack,n=t.prog,i=t.ip;exports.DEBUG;for(var o=0;o<e;o++)r.push(n[++i]);t.ip=i}function Yx(e,t){var r=t.ip,n=t.prog,i=t.stack;exports.DEBUG;for(var o=0;o<e;o++){var a=n[++r]<<8|n[++r];32768&a&&(a=-(1+(65535^a))),i.push(a)}t.ip=r}function Zx(e,t,r,n,i,o){var a,s,l,u=o.stack,c=e&&u.pop(),h=u.pop(),d=o.rp0,p=o.z0[d],f=o.z1[h],m=o.minDis,v=o.fv,g=o.dpv;s=(a=g.distance(f,p,!0,!0))>=0?1:-1,a=Math.abs(a),e&&(l=o.cvt[c],n&&Math.abs(a-l)<o.cvCutIn&&(a=l)),r&&a<m&&(a=m),n&&(a=o.round(a)),v.setRelative(f,p,s*a,g),v.touch(f),exports.DEBUG,o.rp1=o.rp0,o.rp2=h,t&&(o.rp0=h)}function Kx(e){this.char=e,this.state={},this.activeState=null}function Qx(e,t,r){this.contextName=r,this.startIndex=e,this.endOffset=t}function Jx(e,t,r){this.contextName=e,this.openRange=null,this.ranges=[],this.checkStart=t,this.checkEnd=r}function ew(e,t){this.context=e,this.index=t,this.length=e.length,this.current=e[t],this.backtrack=e.slice(0,t),this.lookahead=e.slice(t+1)}function tw(e){this.eventId=e,this.subscribers=[]}function rw(e){var t=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach((function(e){Object.defineProperty(t.events,e,{value:new tw(e)})})),e&&r.forEach((function(r){var n=e[r];"function"==typeof n&&t.events[r].subscribe(n)}));["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"].forEach((function(e){t.events[e].subscribe(t.updateContextsRanges)}))}function nw(e){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],rw.call(this,e)}function iw(e){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(e)}function ow(e){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(e)}function aw(e){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(e)}function sw(e){return/[A-z]/.test(e)}function lw(e){this.font=e,this.features={}}function uw(e){this.id=e.id,this.tag=e.tag,this.substitution=e.substitution}function cw(e,t){if(!e)return-1;switch(t.format){case 1:return t.glyphs.indexOf(e);case 2:for(var r=t.ranges,n=0;n<r.length;n++){var i=r[n];if(e>=i.start&&e<=i.end){var o=e-i.start;return i.index+o}}break;default:return-1}return-1}function hw(e,t){return-1===cw(e,t.coverage)?null:e+t.deltaGlyphId}function dw(e,t){var r=cw(e,t.coverage);return-1===r?null:t.substitute[r]}function pw(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],o=t.current,a=cw(o=Array.isArray(o)?o[0]:o,i);-1!==a&&r.push(a)}return r.length!==e.length?-1:r}function fw(e,t){var r=t.inputCoverage.length+t.lookaheadCoverage.length+t.backtrackCoverage.length;if(e.context.length<r)return[];var n=pw(t.inputCoverage,e);if(-1===n)return[];var i=t.inputCoverage.length-1;if(e.lookahead.length<t.lookaheadCoverage.length)return[];for(var o=e.lookahead.slice(i);o.length&&aw(o[0].char);)o.shift();var a=new ew(o,0),s=pw(t.lookaheadCoverage,a),l=[].concat(e.backtrack);for(l.reverse();l.length&&aw(l[0].char);)l.shift();if(l.length<t.backtrackCoverage.length)return[];var u=new ew(l,0),c=pw(t.backtrackCoverage,u),h=[];if(n.length===t.inputCoverage.length&&s.length===t.lookaheadCoverage.length&&c.length===t.backtrackCoverage.length)for(var d=0;d<t.lookupRecords.length;d++)for(var p=t.lookupRecords[d].lookupListIndex,f=this.getLookupByIndex(p),m=0;m<f.subtables.length;m++){var v=f.subtables[m],g=this.getLookupMethod(f,v);if("12"===this.getSubstitutionType(f,v))for(var y=0;y<n.length;y++){var b=g(e.get(y));b&&h.push(b)}}return h}function mw(e,t){var r=cw(e.current,t.coverage);if(-1===r)return null;for(var n,i=t.ligatureSets[r],o=0;o<i.length;o++){n=i[o];for(var a=0;a<n.components.length;a++){if(e.lookahead[a]!==n.components[a])break;if(a===n.components.length-1)return n}}return null}function vw(e,t){var r=cw(e,t.coverage);return-1===r?null:t.sequences[r]}hx.prototype.exec=function(e,t){if("number"!=typeof t)throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==t){var i=this._fpgmState;if(!i){Ex.prototype=Tx,(i=this._fpgmState=new Ex("fpgm",r.tables.fpgm)).funcs=[],i.font=r,exports.DEBUG&&(i.step=-1);try{sx(i)}catch(Hs){return void(this._errorState=3)}}Ex.prototype=i,(n=this._prepState=new Ex("prep",r.tables.prep)).ppem=t;var o=r.tables.cvt;if(o)for(var a=n.cvt=new Array(o.length),s=t/r.unitsPerEm,l=0;l<o.length;l++)a[l]=o[l]*s;else n.cvt=[];exports.DEBUG&&(n.step=-1);try{sx(n)}catch(Hs){this._errorState,this._errorState=2}}if(!(this._errorState>1))try{return lx(e,n)}catch(Hs){return this._errorState,void(this._errorState=1)}}},lx=function(e,t){var r,n,i,o=t.ppem/t.font.unitsPerEm,a=o,s=e.components;if(Ex.prototype=t,s){var l=t.font;n=[],r=[];for(var u=0;u<s.length;u++){var c=s[u],h=l.glyphs.get(c.glyphIndex);i=new Ex("glyf",h.instructions),exports.DEBUG&&(i.step=-1),ux(h,i,o,a);for(var d=Math.round(c.dx*o),p=Math.round(c.dy*a),f=i.gZone,m=i.contours,v=0;v<f.length;v++){var g=f[v];g.xTouched=g.yTouched=!1,g.xo=g.x=g.x+d,g.yo=g.y=g.y+p}var y=n.length;n.push.apply(n,f);for(var b=0;b<m.length;b++)r.push(m[b]+y)}e.instructions&&!i.inhibitGridFit&&((i=new Ex("glyf",e.instructions)).gZone=i.z0=i.z1=i.z2=n,i.contours=r,n.push(new Sx(0,0),new Sx(Math.round(e.advanceWidth*o),0)),exports.DEBUG&&(i.step=-1),sx(i),n.length-=2)}else i=new Ex("glyf",e.instructions),exports.DEBUG&&(i.step=-1),ux(e,i,o,a),n=i.gZone;return n},ux=function(e,t,r,n){for(var i,o=e.points||[],a=o.length,s=t.gZone=t.z0=t.z1=t.z2=[],l=t.contours=[],u=0;u<a;u++)i=o[u],s[u]=new Sx(i.x*r,i.y*n,i.lastPointOfContour,i.onCurve);for(var c,h,d=0;d<a;d++)i=s[d],c||(c=i,l.push(d)),i.lastPointOfContour?(i.nextPointOnContour=c,c.prevPointOnContour=i,c=void 0):(h=s[d+1],i.nextPointOnContour=h,h.prevPointOnContour=i);if(!t.inhibitGridFit){if(exports.DEBUG)for(var p=0;p<a;p++);if(s.push(new Sx(0,0),new Sx(Math.round(e.advanceWidth*r),0)),sx(t),s.length-=2,exports.DEBUG)for(var f=0;f<a;f++);}},sx=function(e){var t=e.prog;if(t){var r,n=t.length;for(e.ip=0;e.ip<n;e.ip++){if(exports.DEBUG&&e.step++,!(r=ax[t[e.ip]]))throw new Error("unknown instruction: 0x"+Number(t[e.ip]).toString(16));r(e)}}},ax=[Mx.bind(void 0,xx),Mx.bind(void 0,bx),Dx.bind(void 0,xx),Dx.bind(void 0,bx),Px.bind(void 0,xx),Px.bind(void 0,bx),kx.bind(void 0,0),kx.bind(void 0,1),Lx.bind(void 0,0),Lx.bind(void 0,1),function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,e.pv=e.dpv=_x(n,r)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,e.fv=_x(n,r)},function(e){var t=e.stack,r=e.pv;exports.DEBUG,t.push(16384*r.x),t.push(16384*r.y)},function(e){var t=e.stack,r=e.fv;exports.DEBUG,t.push(16384*r.x),t.push(16384*r.y)},function(e){e.fv=e.pv,exports.DEBUG},function(e){var t=e.stack,r=t.pop(),n=t.pop(),i=t.pop(),o=t.pop(),a=t.pop(),s=e.z0,l=e.z1,u=s[r],c=s[n],h=l[i],d=l[o],p=e.z2[a];exports.DEBUG;var f=u.x,m=u.y,v=c.x,g=c.y,y=h.x,b=h.y,x=d.x,w=d.y,_=(f-v)*(b-w)-(m-g)*(y-x),S=f*g-m*v,O=y*w-b*x;p.x=(S*(y-x)-O*(f-v))/_,p.y=(S*(b-w)-O*(m-g))/_},function(e){e.rp0=e.stack.pop(),exports.DEBUG},function(e){e.rp1=e.stack.pop(),exports.DEBUG},function(e){e.rp2=e.stack.pop(),exports.DEBUG},function(e){var t=e.stack.pop();switch(exports.DEBUG,e.zp0=t,t){case 0:e.tZone||Cx(e),e.z0=e.tZone;break;case 1:e.z0=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(exports.DEBUG,e.zp1=t,t){case 0:e.tZone||Cx(e),e.z1=e.tZone;break;case 1:e.z1=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(exports.DEBUG,e.zp2=t,t){case 0:e.tZone||Cx(e),e.z2=e.tZone;break;case 1:e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(exports.DEBUG,e.zp0=e.zp1=e.zp2=t,t){case 0:e.tZone||Cx(e),e.z0=e.z1=e.z2=e.tZone;break;case 1:e.z0=e.z1=e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){e.loop=e.stack.pop(),exports.DEBUG},function(e){exports.DEBUG,e.round=px},function(e){exports.DEBUG,e.round=mx},function(e){var t=e.stack.pop();exports.DEBUG,e.minDis=t/64},function(e){exports.DEBUG,Ax(e,!1)},function(e){var t=e.stack.pop();exports.DEBUG,e.ip+=t-1},function(e){var t=e.stack.pop();exports.DEBUG,e.cvCutIn=t/64},void 0,void 0,function(e){var t=e.stack;exports.DEBUG,t.push(t[t.length-1])},Ux,function(e){exports.DEBUG,e.stack.length=0},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(r),t.push(n)},function(e){var t=e.stack;exports.DEBUG,t.push(t.length)},function(e){var t=e.stack,r=t.pop();exports.DEBUG,t.push(t[t.length-r])},function(e){var t=e.stack,r=t.pop();exports.DEBUG,t.push(t.splice(t.length-r,1)[0])},void 0,void 0,void 0,function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG;var i=e.ip,o=e.prog;e.prog=e.funcs[r];for(var a=0;a<n;a++)sx(e),exports.DEBUG;e.ip=i,e.prog=o},function(e){var t=e.stack.pop();exports.DEBUG;var r=e.ip,n=e.prog;e.prog=e.funcs[t],sx(e),e.ip=r,e.prog=n,exports.DEBUG},function(e){if("fpgm"!==e.env)throw new Error("FDEF not allowed here");var t=e.stack,r=e.prog,n=e.ip,i=t.pop(),o=n;for(exports.DEBUG;45!==r[++n];);e.ip=n,e.funcs[i]=r.slice(o+1,n)},void 0,Ix.bind(void 0,0),Ix.bind(void 0,1),zx.bind(void 0,xx),zx.bind(void 0,bx),Rx.bind(void 0,0),Rx.bind(void 0,1),Nx.bind(void 0,0),Nx.bind(void 0,1),Bx.bind(void 0,0),Bx.bind(void 0,1),function(e){for(var t=e.stack,r=e.loop,n=e.fv,i=t.pop()/64,o=e.z2;r--;){var a=o[t.pop()];exports.DEBUG,n.setRelative(a,a,i),n.touch(a)}e.loop=1},function(e){for(var t=e.stack,r=e.rp1,n=e.rp2,i=e.loop,o=e.z0[r],a=e.z1[n],s=e.fv,l=e.dpv,u=e.z2;i--;){var c=u[t.pop()];exports.DEBUG,s.interpolate(c,o,a,l),s.touch(c)}e.loop=1},Fx.bind(void 0,0),Fx.bind(void 0,1),function(e){for(var t=e.stack,r=e.rp0,n=e.z0[r],i=e.loop,o=e.fv,a=e.pv,s=e.z1;i--;){var l=s[t.pop()];exports.DEBUG,o.setRelative(l,n,0,a),o.touch(l)}e.loop=1},function(e){exports.DEBUG,e.round=fx},jx.bind(void 0,0),jx.bind(void 0,1),function(e){var t=e.prog,r=e.ip,n=e.stack,i=t[++r];exports.DEBUG;for(var o=0;o<i;o++)n.push(t[++r]);e.ip=r},function(e){var t=e.ip,r=e.prog,n=e.stack,i=r[++t];exports.DEBUG;for(var o=0;o<i;o++){var a=r[++t]<<8|r[++t];32768&a&&(a=-(1+(65535^a))),n.push(a)}e.ip=t},function(e){var t=e.stack,r=e.store;r||(r=e.store=[]);var n=t.pop(),i=t.pop();exports.DEBUG,r[i]=n},function(e){var t=e.stack,r=e.store,n=t.pop();exports.DEBUG;var i=r&&r[n]||0;t.push(i)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,e.cvt[n]=r/64},function(e){var t=e.stack,r=t.pop();exports.DEBUG,t.push(64*e.cvt[r])},Gx.bind(void 0,0),Gx.bind(void 0,1),void 0,Vx.bind(void 0,0),Vx.bind(void 0,1),function(e){exports.DEBUG,e.stack.push(e.ppem)},void 0,function(e){exports.DEBUG,e.autoFlip=!0},void 0,void 0,function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(n<r?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(n<=r?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(n>r?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(n>=r?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(r===n?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(r!==n?1:0)},function(e){var t=e.stack,r=t.pop();exports.DEBUG,t.push(Math.trunc(r)%2?1:0)},function(e){var t=e.stack,r=t.pop();exports.DEBUG,t.push(Math.trunc(r)%2?0:1)},function(e){var t=e.stack.pop();exports.DEBUG,t||(Ax(e,!0),exports.DEBUG)},function(e){exports.DEBUG},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(r&&n?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(r||n?1:0)},function(e){var t=e.stack,r=t.pop();exports.DEBUG,t.push(r?0:1)},Hx.bind(void 0,1),function(e){var t=e.stack.pop();exports.DEBUG,e.deltaBase=t},function(e){var t=e.stack.pop();exports.DEBUG,e.deltaShift=Math.pow(.5,t)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(n+r)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(n-r)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(64*n/r)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(n*r/64)},function(e){var t=e.stack,r=t.pop();exports.DEBUG,t.push(Math.abs(r))},function(e){var t=e.stack,r=t.pop();exports.DEBUG,t.push(-r)},function(e){var t=e.stack,r=t.pop();exports.DEBUG,t.push(64*Math.floor(r/64))},function(e){var t=e.stack,r=t.pop();exports.DEBUG,t.push(64*Math.ceil(r/64))},Wx.bind(void 0,0),Wx.bind(void 0,1),Wx.bind(void 0,2),Wx.bind(void 0,3),void 0,void 0,void 0,void 0,function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,e.cvt[n]=r*e.ppem/e.font.unitsPerEm},Hx.bind(void 0,2),Hx.bind(void 0,3),qx.bind(void 0,1),qx.bind(void 0,2),qx.bind(void 0,3),function(e){var t,r=e.stack.pop();switch(exports.DEBUG,e.round=yx,192&r){case 0:t=.5;break;case 64:t=1;break;case 128:t=2;break;default:throw new Error("invalid SROUND value")}switch(e.srPeriod=t,48&r){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid SROUND value")}r&=15,e.srThreshold=0===r?0:(r/8-.5)*t},function(e){var t,r=e.stack.pop();switch(exports.DEBUG,e.round=yx,192&r){case 0:t=Math.sqrt(2)/2;break;case 64:t=Math.sqrt(2);break;case 128:t=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(e.srPeriod=t,48&r){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid S45ROUND value")}r&=15,e.srThreshold=0===r?0:(r/8-.5)*t},void 0,void 0,function(e){exports.DEBUG,e.round=dx},void 0,function(e){exports.DEBUG,e.round=vx},function(e){exports.DEBUG,e.round=gx},Ux,Ux,void 0,void 0,void 0,void 0,void 0,function(e){e.stack.pop(),exports.DEBUG},$x.bind(void 0,0),$x.bind(void 0,1),function(e){var t=e.stack,r=t.pop(),n=0;exports.DEBUG,1&r&&(n=35),32&r&&(n|=4096),t.push(n)},void 0,function(e){var t=e.stack,r=t.pop(),n=t.pop(),i=t.pop();exports.DEBUG,t.push(n),t.push(r),t.push(i)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(Math.max(n,r))},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG,t.push(Math.min(n,r))},function(e){e.stack.pop(),exports.DEBUG},function(e){var t=e.stack.pop(),r=e.stack.pop();switch(exports.DEBUG,t){case 1:return void(e.inhibitGridFit=!!r);case 2:return void(e.ignoreCvt=!!r);default:throw new Error("invalid INSTCTRL[] selector")}},void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Xx.bind(void 0,1),Xx.bind(void 0,2),Xx.bind(void 0,3),Xx.bind(void 0,4),Xx.bind(void 0,5),Xx.bind(void 0,6),Xx.bind(void 0,7),Xx.bind(void 0,8),Yx.bind(void 0,1),Yx.bind(void 0,2),Yx.bind(void 0,3),Yx.bind(void 0,4),Yx.bind(void 0,5),Yx.bind(void 0,6),Yx.bind(void 0,7),Yx.bind(void 0,8),Zx.bind(void 0,0,0,0,0,0),Zx.bind(void 0,0,0,0,0,1),Zx.bind(void 0,0,0,0,0,2),Zx.bind(void 0,0,0,0,0,3),Zx.bind(void 0,0,0,0,1,0),Zx.bind(void 0,0,0,0,1,1),Zx.bind(void 0,0,0,0,1,2),Zx.bind(void 0,0,0,0,1,3),Zx.bind(void 0,0,0,1,0,0),Zx.bind(void 0,0,0,1,0,1),Zx.bind(void 0,0,0,1,0,2),Zx.bind(void 0,0,0,1,0,3),Zx.bind(void 0,0,0,1,1,0),Zx.bind(void 0,0,0,1,1,1),Zx.bind(void 0,0,0,1,1,2),Zx.bind(void 0,0,0,1,1,3),Zx.bind(void 0,0,1,0,0,0),Zx.bind(void 0,0,1,0,0,1),Zx.bind(void 0,0,1,0,0,2),Zx.bind(void 0,0,1,0,0,3),Zx.bind(void 0,0,1,0,1,0),Zx.bind(void 0,0,1,0,1,1),Zx.bind(void 0,0,1,0,1,2),Zx.bind(void 0,0,1,0,1,3),Zx.bind(void 0,0,1,1,0,0),Zx.bind(void 0,0,1,1,0,1),Zx.bind(void 0,0,1,1,0,2),Zx.bind(void 0,0,1,1,0,3),Zx.bind(void 0,0,1,1,1,0),Zx.bind(void 0,0,1,1,1,1),Zx.bind(void 0,0,1,1,1,2),Zx.bind(void 0,0,1,1,1,3),Zx.bind(void 0,1,0,0,0,0),Zx.bind(void 0,1,0,0,0,1),Zx.bind(void 0,1,0,0,0,2),Zx.bind(void 0,1,0,0,0,3),Zx.bind(void 0,1,0,0,1,0),Zx.bind(void 0,1,0,0,1,1),Zx.bind(void 0,1,0,0,1,2),Zx.bind(void 0,1,0,0,1,3),Zx.bind(void 0,1,0,1,0,0),Zx.bind(void 0,1,0,1,0,1),Zx.bind(void 0,1,0,1,0,2),Zx.bind(void 0,1,0,1,0,3),Zx.bind(void 0,1,0,1,1,0),Zx.bind(void 0,1,0,1,1,1),Zx.bind(void 0,1,0,1,1,2),Zx.bind(void 0,1,0,1,1,3),Zx.bind(void 0,1,1,0,0,0),Zx.bind(void 0,1,1,0,0,1),Zx.bind(void 0,1,1,0,0,2),Zx.bind(void 0,1,1,0,0,3),Zx.bind(void 0,1,1,0,1,0),Zx.bind(void 0,1,1,0,1,1),Zx.bind(void 0,1,1,0,1,2),Zx.bind(void 0,1,1,0,1,3),Zx.bind(void 0,1,1,1,0,0),Zx.bind(void 0,1,1,1,0,1),Zx.bind(void 0,1,1,1,0,2),Zx.bind(void 0,1,1,1,0,3),Zx.bind(void 0,1,1,1,1,0),Zx.bind(void 0,1,1,1,1,1),Zx.bind(void 0,1,1,1,1,2),Zx.bind(void 0,1,1,1,1,3)],Kx.prototype.setState=function(e,t){return this.state[e]=t,this.activeState={key:e,value:this.state[e]},this.activeState},Kx.prototype.getState=function(e){return this.state[e]||null},nw.prototype.inboundIndex=function(e){return e>=0&&e<this.tokens.length},nw.prototype.composeRUD=function(e){var t=this,r=e.map((function(e){return t[e[0]].apply(t,e.slice(1).concat(true))})),n=function(e){return"object"==typeof e&&e.hasOwnProperty("FAIL")};if(r.every(n))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:r.filter(n)};this.dispatch("composeRUD",[r.filter((function(e){return!n(e)}))])},nw.prototype.replaceRange=function(e,t,r,n){t=null!==t?t:this.tokens.length;var i=r.every((function(e){return e instanceof Kx}));if(!isNaN(e)&&this.inboundIndex(e)&&i){var o=this.tokens.splice.apply(this.tokens,[e,t].concat(r));return n||this.dispatch("replaceToken",[e,t,r]),[o,r]}return{FAIL:"replaceRange: invalid tokens or startIndex."}},nw.prototype.replaceToken=function(e,t,r){if(!isNaN(e)&&this.inboundIndex(e)&&t instanceof Kx){var n=this.tokens.splice(e,1,t);return r||this.dispatch("replaceToken",[e,t]),[n[0],t]}return{FAIL:"replaceToken: invalid token or index."}},nw.prototype.removeRange=function(e,t,r){t=isNaN(t)?this.tokens.length:t;var n=this.tokens.splice(e,t);return r||this.dispatch("removeRange",[n,e,t]),n},nw.prototype.removeToken=function(e,t){if(!isNaN(e)&&this.inboundIndex(e)){var r=this.tokens.splice(e,1);return t||this.dispatch("removeToken",[r,e]),r}return{FAIL:"removeToken: invalid token index."}},nw.prototype.insertToken=function(e,t,r){var n=e.every((function(e){return e instanceof Kx}));return n?(this.tokens.splice.apply(this.tokens,[t,0].concat(e)),r||this.dispatch("insertToken",[e,t]),e):{FAIL:"insertToken: invalid token(s)."}},nw.prototype.registerModifier=function(e,t,r){this.events.newToken.subscribe((function(n,i){var o=[n,i],a=[n,i];if(null===t||!0===t.apply(this,o)){var s=r.apply(this,a);n.setState(e,s)}})),this.registeredModifiers.push(e)},tw.prototype.subscribe=function(e){return"function"==typeof e?this.subscribers.push(e)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},tw.prototype.unsubscribe=function(e){this.subscribers.splice(e,1)},ew.prototype.setCurrentIndex=function(e){this.index=e,this.current=this.context[e],this.backtrack=this.context.slice(0,e),this.lookahead=this.context.slice(e+1)},ew.prototype.get=function(e){switch(!0){case 0===e:return this.current;case e<0&&Math.abs(e)<=this.backtrack.length:return this.backtrack.slice(e)[0];case e>0&&e<=this.lookahead.length:return this.lookahead[e-1];default:return null}},nw.prototype.rangeToText=function(e){if(e instanceof Qx)return this.getRangeTokens(e).map((function(e){return e.char})).join("")},nw.prototype.getText=function(){return this.tokens.map((function(e){return e.char})).join("")},nw.prototype.getContext=function(e){return this.registeredContexts[e]||null},nw.prototype.on=function(e,t){var r=this.events[e];return r?r.subscribe(t):null},nw.prototype.dispatch=function(e,t){var r=this,n=this.events[e];n instanceof tw&&n.subscribers.forEach((function(e){e.apply(r,t||[])}))},nw.prototype.registerContextChecker=function(e,t,r){if(this.getContext(e))return{FAIL:"context name '"+e+"' is already registered."};if("function"!=typeof t)return{FAIL:"missing context start check."};if("function"!=typeof r)return{FAIL:"missing context end check."};var n=new Jx(e,t,r);return this.registeredContexts[e]=n,this.contextCheckers.push(n),n},nw.prototype.getRangeTokens=function(e){var t=e.startIndex+e.endOffset;return[].concat(this.tokens.slice(e.startIndex,t))},nw.prototype.getContextRanges=function(e){var t=this.getContext(e);return t?t.ranges:{FAIL:"context checker '"+e+"' is not registered."}},nw.prototype.resetContextsRanges=function(){var e=this.registeredContexts;for(var t in e)if(e.hasOwnProperty(t)){e[t].ranges=[]}},nw.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var e=this.tokens.map((function(e){return e.char})),t=0;t<e.length;t++){var r=new ew(e,t);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},nw.prototype.setEndOffset=function(e,t){var r=new Qx(this.getContext(t).openRange.startIndex,e,t),n=this.getContext(t).ranges;return r.rangeId=t+"."+n.length,n.push(r),this.getContext(t).openRange=null,r},nw.prototype.runContextCheck=function(e){var t=this,r=e.index;this.contextCheckers.forEach((function(n){var i=n.contextName,o=t.getContext(i).openRange;if(!o&&n.checkStart(e)&&(o=new Qx(r,null,i),t.getContext(i).openRange=o,t.dispatch("contextStart",[i,r])),o&&n.checkEnd(e)){var a=r-o.startIndex+1,s=t.setEndOffset(a,i);t.dispatch("contextEnd",[i,s])}}))},nw.prototype.tokenize=function(e){this.tokens=[],this.resetContextsRanges();var t=Array.from(e);this.dispatch("start");for(var r=0;r<t.length;r++){var n=t[r],i=new ew(t,r);this.dispatch("next",[i]),this.runContextCheck(i);var o=new Kx(n);this.tokens.push(o),this.dispatch("newToken",[o,i])}return this.dispatch("end",[this.tokens]),this.tokens},lw.prototype.getDefaultScriptFeaturesIndexes=function(){for(var e=this.font.tables.gsub.scripts,t=0;t<e.length;t++){var r=e[t];if("DFLT"===r.tag)return r.script.defaultLangSys.featureIndexes}return[]},lw.prototype.getScriptFeaturesIndexes=function(e){if(!this.font.tables.gsub)return[];if(!e)return this.getDefaultScriptFeaturesIndexes();for(var t=this.font.tables.gsub.scripts,r=0;r<t.length;r++){var n=t[r];if(n.tag===e&&n.script.defaultLangSys)return n.script.defaultLangSys.featureIndexes;var i=n.langSysRecords;if(i)for(var o=0;o<i.length;o++){var a=i[o];if(a.tag===e)return a.langSys.featureIndexes}}return this.getDefaultScriptFeaturesIndexes()},lw.prototype.mapTagsToFeatures=function(e,t){for(var r={},n=0;n<e.length;n++){var i=e[n].tag,o=e[n].feature;r[i]=o}this.features[t].tags=r},lw.prototype.getScriptFeatures=function(e){var t=this.features[e];if(this.features.hasOwnProperty(e))return t;var r=this.getScriptFeaturesIndexes(e);if(!r)return null;var n=this.font.tables.gsub;return t=r.map((function(e){return n.features[e]})),this.features[e]=t,this.mapTagsToFeatures(t,e),t},lw.prototype.getSubstitutionType=function(e,t){return e.lookupType.toString()+t.substFormat.toString()},lw.prototype.getLookupMethod=function(e,t){var r=this;switch(this.getSubstitutionType(e,t)){case"11":return function(e){return hw.apply(r,[e,t])};case"12":return function(e){return dw.apply(r,[e,t])};case"63":return function(e){return fw.apply(r,[e,t])};case"41":return function(e){return mw.apply(r,[e,t])};case"21":return function(e){return vw.apply(r,[e,t])};default:throw new Error("lookupType: "+e.lookupType+" - substFormat: "+t.substFormat+" is not yet supported")}},lw.prototype.lookupFeature=function(e){var t=e.contextParams,r=t.index,n=this.getFeature({tag:e.tag,script:e.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+e.tag+"' for script '"+e.script+"'.");for(var i=this.getFeatureLookups(n),o=[].concat(t.context),a=0;a<i.length;a++)for(var s=i[a],l=this.getLookupSubtables(s),u=0;u<l.length;u++){var c=l[u],h=this.getSubstitutionType(s,c),d=this.getLookupMethod(s,c),p=void 0;switch(h){case"11":(p=d(t.current))&&o.splice(r,1,new uw({id:11,tag:e.tag,substitution:p}));break;case"12":(p=d(t.current))&&o.splice(r,1,new uw({id:12,tag:e.tag,substitution:p}));break;case"63":p=d(t),Array.isArray(p)&&p.length&&o.splice(r,1,new uw({id:63,tag:e.tag,substitution:p}));break;case"41":(p=d(t))&&o.splice(r,1,new uw({id:41,tag:e.tag,substitution:p}));break;case"21":(p=d(t.current))&&o.splice(r,1,new uw({id:21,tag:e.tag,substitution:p}))}t=new ew(o,r),(!Array.isArray(p)||p.length)&&(p=null)}return o.length?o:null},lw.prototype.supports=function(e){if(!e.script)return!1;this.getScriptFeatures(e.script);var t=this.features.hasOwnProperty(e.script);if(!e.tag)return t;var r=this.features[e.script].some((function(t){return t.tag===e.tag}));return t&&r},lw.prototype.getLookupSubtables=function(e){return e.subtables||null},lw.prototype.getLookupByIndex=function(e){return this.font.tables.gsub.lookups[e]||null},lw.prototype.getFeatureLookups=function(e){return e.lookupListIndexes.map(this.getLookupByIndex.bind(this))},lw.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var t=this.features[e.script];return t?t.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};var gw={startCheck:function(e){var t=e.current,r=e.get(-1);return null===r&&iw(t)||!iw(r)&&iw(t)},endCheck:function(e){var t=e.get(1);return null===t||!iw(t)}};var yw={startCheck:function(e){var t=e.current,r=e.get(-1);return(iw(t)||aw(t))&&!iw(r)},endCheck:function(e){var t=e.get(1);switch(!0){case null===t:return!0;case!iw(t)&&!aw(t):var r=function(e){return/\s/.test(e)}(t);if(!r)return!0;if(r){var n;if(n=e.lookahead.some((function(e){return iw(e)||aw(e)})),!n)return!0}break;default:return!1}}};var bw={11:function(e,t,r){t[r].setState(e.tag,e.substitution)},12:function(e,t,r){t[r].setState(e.tag,e.substitution)},63:function(e,t,r){e.substitution.forEach((function(n,i){t[r+i].setState(e.tag,n)}))},41:function(e,t,r){var n=t[r];n.setState(e.tag,e.substitution.ligGlyph);for(var i=e.substitution.components.length,o=0;o<i;o++)(n=t[r+o+1]).setState("deleted",!0)}};function xw(e,t,r){e instanceof uw&&bw[e.id]&&bw[e.id](e,t,r)}function ww(e){var t=this,r="arab",n=this.featuresTags[r],i=this.tokenizer.getRangeTokens(e);if(1!==i.length){var o=new ew(i.map((function(e){return e.getState("glyphIndex")})),0),a=new ew(i.map((function(e){return e.char})),0);i.forEach((function(e,s){if(!aw(e.char)){o.setCurrentIndex(s),a.setCurrentIndex(s);var l,u=0;switch(function(e){for(var t=[].concat(e.backtrack),r=t.length-1;r>=0;r--){var n=t[r],i=ow(n),o=aw(n);if(!i&&!o)return!0;if(i)return!1}return!1}(a)&&(u|=1),function(e){if(ow(e.current))return!1;for(var t=0;t<e.lookahead.length;t++)if(!aw(e.lookahead[t]))return!0;return!1}(a)&&(u|=2),u){case 1:l="fina";break;case 2:l="init";break;case 3:l="medi"}if(-1!==n.indexOf(l)){var c=t.query.lookupFeature({tag:l,script:r,contextParams:o});if(c instanceof Error)return;c.forEach((function(e,t){e instanceof uw&&(xw(e,i,t),o.context[t]=e.substitution)}))}}}))}}function _w(e,t){var r=e.map((function(e){return e.activeState.value}));return new ew(r,t||0)}function Sw(e){var t=this,r=this.tokenizer.getRangeTokens(e),n=_w(r);n.context.forEach((function(e,i){n.setCurrentIndex(i);var o=t.query.lookupFeature({tag:"rlig",script:"arab",contextParams:n});o.length&&(o.forEach((function(e){return xw(e,r,i)})),n=_w(r))}))}var Ow={startCheck:function(e){var t=e.current,r=e.get(-1);return null===r&&sw(t)||!sw(r)&&sw(t)},endCheck:function(e){var t=e.get(1);return null===t||!sw(t)}};function Tw(e,t){var r=e.map((function(e){return e.activeState.value}));return new ew(r,t||0)}function Ew(e){var t=this,r=this.tokenizer.getRangeTokens(e),n=Tw(r);n.context.forEach((function(e,i){n.setCurrentIndex(i);var o=t.query.lookupFeature({tag:"liga",script:"latn",contextParams:n});o.length&&(o.forEach((function(e){return xw(e,r,i)})),n=Tw(r))}))}function Cw(e){this.baseDir=e||"ltr",this.tokenizer=new nw,this.featuresTags={}}function Aw(e){var t=this.contextChecks[e+"Check"];return this.tokenizer.registerContextChecker(e,t.startCheck,t.endCheck)}function Mw(){return Aw.call(this,"latinWord"),Aw.call(this,"arabicWord"),Aw.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function Dw(){var e=this;this.tokenizer.getContextRanges("arabicSentence").forEach((function(t){var r=e.tokenizer.getRangeTokens(t);e.tokenizer.replaceRange(t.startIndex,t.endOffset,r.reverse())}))}function Pw(){if(-1===this.tokenizer.registeredModifiers.indexOf("glyphIndex"))throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function kw(){var e=this;this.featuresTags.hasOwnProperty("arab")&&(Pw.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){ww.call(e,t)})))}function Lw(){var e=this,t="arab";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags[t].indexOf("rlig")&&(Pw.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){Sw.call(e,t)}))))}function Uw(){var e=this,t="latn";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags[t].indexOf("liga")&&(Pw.call(this),this.tokenizer.getContextRanges("latinWord").forEach((function(t){Ew.call(e,t)}))))}function Iw(e){(e=e||{}).tables=e.tables||{},e.empty||(ex(e.familyName,"When creating a new Font object, familyName is required."),ex(e.styleName,"When creating a new Font object, styleName is required."),ex(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),ex(e.ascender,"When creating a new Font object, ascender is required."),ex(e.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||(e.familyName+e.styleName).replace(/\s/g,"")},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.createdTimestamp=e.createdTimestamp,this.tables=Object.assign(e.tables,{os2:Object.assign({usWeightClass:e.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:e.widthClass||this.usWidthClasses.MEDIUM,fsSelection:e.fsSelection||this.fsSelectionValues.REGULAR},e.tables.os2)})),this.supported=!0,this.glyphs=new qy.GlyphSet(this,e.glyphs||[]),this.encoding=new Ry(this),this.position=new Yb(this),this.substitution=new Zb(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){return this._hinting?this._hinting:"truetype"===this.outlinesFormat?this._hinting=new hx(this):void 0}})}function zw(e,t){var r=JSON.stringify(e),n=256;for(var i in t){var o=parseInt(i);if(o&&!(o<256)){if(JSON.stringify(t[i])===r)return o;n<=o&&(n=o+1)}}return t[n]=e,n}function Rw(e,t,r){var n=zw(t.name,r);return[{name:"tag_"+e,type:"TAG",value:t.tag},{name:"minValue_"+e,type:"FIXED",value:t.minValue<<16},{name:"defaultValue_"+e,type:"FIXED",value:t.defaultValue<<16},{name:"maxValue_"+e,type:"FIXED",value:t.maxValue<<16},{name:"flags_"+e,type:"USHORT",value:0},{name:"nameID_"+e,type:"USHORT",value:n}]}function Nw(e,t,r){var n={},i=new Dy.Parser(e,t);return n.tag=i.parseTag(),n.minValue=i.parseFixed(),n.defaultValue=i.parseFixed(),n.maxValue=i.parseFixed(),i.skip("uShort",1),n.name=r[i.parseUShort()]||{},n}function Bw(e,t,r,n){for(var i=[{name:"nameID_"+e,type:"USHORT",value:zw(t.name,n)},{name:"flags_"+e,type:"USHORT",value:0}],o=0;o<r.length;++o){var a=r[o].tag;i.push({name:"axis_"+e+" "+a,type:"FIXED",value:t.coordinates[a]<<16})}return i}function Fw(e,t,r,n){var i={},o=new Dy.Parser(e,t);i.name=n[o.parseUShort()]||{},o.skip("uShort",1),i.coordinates={};for(var a=0;a<r.length;++a)i.coordinates[r[a].tag]=o.parseFixed();return i}Cw.prototype.setText=function(e){this.text=e},Cw.prototype.contextChecks={latinWordCheck:Ow,arabicWordCheck:gw,arabicSentenceCheck:yw},Cw.prototype.registerFeatures=function(e,t){var r=this,n=t.filter((function(t){return r.query.supports({script:e,tag:t})}));this.featuresTags.hasOwnProperty(e)?this.featuresTags[e]=this.featuresTags[e].concat(n):this.featuresTags[e]=n},Cw.prototype.applyFeatures=function(e,t){if(!e)throw new Error("No valid font was provided to apply features");this.query||(this.query=new lw(e));for(var r=0;r<t.length;r++){var n=t[r];!this.query.supports({script:n.script})||this.registerFeatures(n.script,n.tags)}},Cw.prototype.registerModifier=function(e,t,r){this.tokenizer.registerModifier(e,t,r)},Cw.prototype.checkContextReady=function(e){return!!this.tokenizer.getContext(e)},Cw.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(kw.call(this),Lw.call(this)),this.checkContextReady("latinWord")&&Uw.call(this),this.checkContextReady("arabicSentence")&&Dw.call(this)},Cw.prototype.processText=function(e){(!this.text||this.text!==e)&&(this.setText(e),Mw.call(this),this.applyFeaturesToContexts())},Cw.prototype.getBidiText=function(e){return this.processText(e),this.tokenizer.getText()},Cw.prototype.getTextGlyphs=function(e){this.processText(e);for(var t=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var i=n.activeState.value;t.push(Array.isArray(i)?i[0]:i)}}return t},Iw.prototype.hasChar=function(e){return null!==this.encoding.charToGlyphIndex(e)},Iw.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},Iw.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},Iw.prototype.updateFeatures=function(e){return this.defaultRenderOptions.features.map((function(t){return"latn"===t.script?{script:"latn",tags:t.tags.filter((function(t){return e[t]}))}:t}))},Iw.prototype.stringToGlyphs=function(e,t){var r=this,n=new Cw;n.registerModifier("glyphIndex",null,(function(e){return r.charToGlyphIndex(e.char)}));var i=t?this.updateFeatures(t.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var o=n.getTextGlyphs(e),a=o.length,s=new Array(a),l=this.glyphs.get(0),u=0;u<a;u+=1)s[u]=this.glyphs.get(o[u])||l;return s},Iw.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},Iw.prototype.nameToGlyph=function(e){var t=this.nameToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},Iw.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},Iw.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,e,t):this.kerningPairs[e+","+t]||0},Iw.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},Iw.prototype.forEachGlyph=function(e,t,r,n,i,o){t=void 0!==t?t:0,r=void 0!==r?r:0,n=void 0!==n?n:72,i=Object.assign({},this.defaultRenderOptions,i);var a,s=1/this.unitsPerEm*n,l=this.stringToGlyphs(e,i);if(i.kerning){var u=i.script||this.position.getDefaultScriptName();a=this.position.getKerningTables(u,i.language)}for(var c=0;c<l.length;c+=1){var h=l[c];if(o.call(this,h,t,r,n,i),h.advanceWidth&&(t+=h.advanceWidth*s),i.kerning&&c<l.length-1)t+=(a?this.position.getKerningValue(a,h.index,l[c+1].index):this.getKerningValue(h,l[c+1]))*s;i.letterSpacing?t+=i.letterSpacing*n:i.tracking&&(t+=i.tracking/1e3*n)}return t},Iw.prototype.getPath=function(e,t,r,n,i){var o=new Kg;return this.forEachGlyph(e,t,r,n,i,(function(e,t,r,n){var a=e.getPath(t,r,n,i,this);o.extend(a)})),o},Iw.prototype.getPaths=function(e,t,r,n,i){var o=[];return this.forEachGlyph(e,t,r,n,i,(function(e,t,r,n){var a=e.getPath(t,r,n,i,this);o.push(a)})),o},Iw.prototype.getAdvanceWidth=function(e,t,r){return this.forEachGlyph(e,0,0,t,r,(function(){}))},Iw.prototype.draw=function(e,t,r,n,i,o){this.getPath(t,r,n,i,o).draw(e)},Iw.prototype.drawPoints=function(e,t,r,n,i,o){this.forEachGlyph(t,r,n,i,o,(function(t,r,n,i){t.drawPoints(e,r,n,i)}))},Iw.prototype.drawMetrics=function(e,t,r,n,i,o){this.forEachGlyph(t,r,n,i,o,(function(t,r,n,i){t.drawMetrics(e,r,n,i)}))},Iw.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},Iw.prototype.validate=function(){var e=this;function t(t){var r=e.getEnglishName(t);r&&r.trim().length}t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),this.unitsPerEm},Iw.prototype.toTables=function(){return Hb.fontToTable(this)},Iw.prototype.toBuffer=function(){return this.toArrayBuffer()},Iw.prototype.toArrayBuffer=function(){for(var e=this.toTables().encode(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e[n];return t},Iw.prototype.download=function(e){var t=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");e=e||t.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(typeof window<"u"){if(window.URL=window.URL||window.webkitURL,window.URL){var i=new DataView(n),o=new Blob([i],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(o),a.download=e;var s=document.createEvent("MouseEvents");s.initEvent("click",!0,!1),a.dispatchEvent(s)}}else{var l=Tg(),u=function(e){for(var t=new Buffer(e.byteLength),r=new Uint8Array(e),n=0;n<t.length;++n)t[n]=r[n];return t}(n);l.writeFileSync(e,u)}},Iw.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Iw.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Iw.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var jw={make:function(e,t){var r=new _y.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:e.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:e.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*e.axes.length}]);r.offsetToData=r.sizeOf();for(var n=0;n<e.axes.length;n++)r.fields=r.fields.concat(Rw(n,e.axes[n],t));for(var i=0;i<e.instances.length;i++)r.fields=r.fields.concat(Bw(i,e.instances[i],e.axes,t));return r},parse:function(e,t,r){var n=new Dy.Parser(e,t),i=n.parseULong();ey.argument(65536===i,"Unsupported fvar table version.");var o=n.parseOffset16();n.skip("uShort",1);for(var a=n.parseUShort(),s=n.parseUShort(),l=n.parseUShort(),u=n.parseUShort(),c=[],h=0;h<a;h++)c.push(Nw(e,t+o+h*s,r));for(var d=[],p=t+o+a*s,f=0;f<l;f++)d.push(Fw(e,p+f*u,c,r));return{axes:c,instances:d}}},Gw=function(){return{coverage:this.parsePointer(Ay.coverage),attachPoints:this.parseList(Ay.pointer(Ay.uShortList))}},Vw=function(){var e=this.parseUShort();return ey.argument(1===e||2===e||3===e,"Unsupported CaretValue table version."),1===e?{coordinate:this.parseShort()}:2===e?{pointindex:this.parseShort()}:3===e?{coordinate:this.parseShort()}:void 0},Hw=function(){return this.parseList(Ay.pointer(Vw))},Ww=function(){return{coverage:this.parsePointer(Ay.coverage),ligGlyphs:this.parseList(Ay.pointer(Hw))}},qw=function(){return this.parseUShort(),this.parseList(Ay.pointer(Ay.coverage))};var $w={parse:function(e,t){var r=new Ay(e,t=t||0),n=r.parseVersion(1);ey.argument(1===n||1.2===n||1.3===n,"Unsupported GDEF table version.");var i={version:n,classDef:r.parsePointer(Ay.classDef),attachList:r.parsePointer(Gw),ligCaretList:r.parsePointer(Ww),markAttachClassDef:r.parsePointer(Ay.classDef)};return n>=1.2&&(i.markGlyphSets=r.parsePointer(qw)),i}},Xw=new Array(10);Xw[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{posFormat:1,coverage:this.parsePointer(Ay.coverage),value:this.parseValueRecord()}:2===t?{posFormat:2,coverage:this.parsePointer(Ay.coverage),values:this.parseValueRecordList()}:void ey.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},Xw[2]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();ey.assert(1===t||2===t,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var r=this.parsePointer(Ay.coverage),n=this.parseUShort(),i=this.parseUShort();if(1===t)return{posFormat:t,coverage:r,valueFormat1:n,valueFormat2:i,pairSets:this.parseList(Ay.pointer(Ay.list((function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(n),value2:this.parseValueRecord(i)}}))))};if(2===t){var o=this.parsePointer(Ay.classDef),a=this.parsePointer(Ay.classDef),s=this.parseUShort(),l=this.parseUShort();return{posFormat:t,coverage:r,valueFormat1:n,valueFormat2:i,classDef1:o,classDef2:a,class1Count:s,class2Count:l,classRecords:this.parseList(s,Ay.list(l,(function(){return{value1:this.parseValueRecord(n),value2:this.parseValueRecord(i)}})))}}},Xw[3]=function(){return{error:"GPOS Lookup 3 not supported"}},Xw[4]=function(){return{error:"GPOS Lookup 4 not supported"}},Xw[5]=function(){return{error:"GPOS Lookup 5 not supported"}},Xw[6]=function(){return{error:"GPOS Lookup 6 not supported"}},Xw[7]=function(){return{error:"GPOS Lookup 7 not supported"}},Xw[8]=function(){return{error:"GPOS Lookup 8 not supported"}},Xw[9]=function(){return{error:"GPOS Lookup 9 not supported"}};var Yw=new Array(10);var Zw={parse:function(e,t){var r=new Ay(e,t=t||0),n=r.parseVersion(1);return ey.argument(1===n||1.1===n,"Unsupported GPOS table version "+n),1===n?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Xw)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Xw),variations:r.parseFeatureVariationsList()}},make:function(e){return new _y.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new _y.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new _y.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new _y.LookupList(e.lookups,Yw)}])}};var Kw={parse:function(e,t){var r=new Dy.Parser(e,t),n=r.parseUShort();if(0===n)return function(e){var t={};e.skip("uShort");var r=e.parseUShort();ey.argument(0===r,"Unsupported kern sub-table version."),e.skip("uShort",2);var n=e.parseUShort();e.skip("uShort",3);for(var i=0;i<n;i+=1){var o=e.parseUShort(),a=e.parseUShort(),s=e.parseShort();t[o+","+a]=s}return t}(r);if(1===n)return function(e){var t={};e.skip("uShort"),e.parseULong(),e.skip("uLong");var r=255&e.parseUShort();if(e.skip("uShort"),0===r){var n=e.parseUShort();e.skip("uShort",3);for(var i=0;i<n;i+=1){var o=e.parseUShort(),a=e.parseUShort(),s=e.parseShort();t[o+","+a]=s}}return t}(r);throw new Error("Unsupported kern table version ("+n+").")}};var Qw={parse:function(e,t,r,n){for(var i=new Dy.Parser(e,t),o=n?i.parseUShort:i.parseULong,a=[],s=0;s<r+1;s+=1){var l=o.call(i);n&&(l*=2),a.push(l)}return a}};function Jw(e,t){Tg().readFile(e,(function(e,r){if(e)return t(e.message);t(null,Jb(r))}))}function e_(e,t){var r=new XMLHttpRequest;r.open("get",e,!0),r.responseType="arraybuffer",r.onload=function(){return r.response?t(null,r.response):t("Font could not be loaded: "+r.statusText)},r.onerror=function(){t("Font could not be loaded")},r.send()}function t_(e,t){for(var r=[],n=12,i=0;i<t;i+=1){var o=Dy.getTag(e,n),a=Dy.getULong(e,n+4),s=Dy.getULong(e,n+8),l=Dy.getULong(e,n+12);r.push({tag:o,checksum:a,offset:s,length:l,compression:!1}),n+=16}return r}function r_(e,t){if("WOFF"===t.compression){var r=new Uint8Array(e.buffer,t.offset+2,t.compressedLength-2),n=new Uint8Array(t.length);if(Xg(r,n),n.byteLength!==t.length)throw new Error("Decompression error: "+t.tag+" decompressed length doesn't match recorded length");return{data:new DataView(n.buffer,0),offset:0}}return{data:e,offset:t.offset}}function n_(e,t){t=t??{};var r,n,i,o=new Iw({empty:!0}),a=new DataView(e,0),s=[],l=Dy.getTag(a,0);if(l===String.fromCharCode(0,1,0,0)||"true"===l||"typ1"===l)o.outlinesFormat="truetype",s=t_(a,i=Dy.getUShort(a,4));else if("OTTO"===l)o.outlinesFormat="cff",s=t_(a,i=Dy.getUShort(a,4));else{if("wOFF"!==l)throw new Error("Unsupported OpenType signature "+l);var u=Dy.getTag(a,4);if(u===String.fromCharCode(0,1,0,0))o.outlinesFormat="truetype";else{if("OTTO"!==u)throw new Error("Unsupported OpenType flavor "+l);o.outlinesFormat="cff"}s=function(e,t){for(var r=[],n=44,i=0;i<t;i+=1){var o=Dy.getTag(e,n),a=Dy.getULong(e,n+4),s=Dy.getULong(e,n+8),l=Dy.getULong(e,n+12),u=void 0;u=s<l&&"WOFF",r.push({tag:o,offset:a,compression:u,compressedLength:s,length:l}),n+=20}return r}(a,i=Dy.getUShort(a,12))}for(var c,h,d,p,f,m,v,g,y,b,x,w,_=0;_<i;_+=1){var S=s[_],O=void 0;switch(S.tag){case"cmap":O=r_(a,S),o.tables.cmap=ky.parse(O.data,O.offset),o.encoding=new Ny(o.tables.cmap);break;case"cvt ":O=r_(a,S),w=new Dy.Parser(O.data,O.offset),o.tables.cvt=w.parseShortList(S.length/2);break;case"fvar":h=S;break;case"fpgm":O=r_(a,S),w=new Dy.Parser(O.data,O.offset),o.tables.fpgm=w.parseByteList(S.length);break;case"head":O=r_(a,S),o.tables.head=db.parse(O.data,O.offset),o.unitsPerEm=o.tables.head.unitsPerEm,r=o.tables.head.indexToLocFormat;break;case"hhea":O=r_(a,S),o.tables.hhea=pb.parse(O.data,O.offset),o.ascender=o.tables.hhea.ascender,o.descender=o.tables.hhea.descender,o.numberOfHMetrics=o.tables.hhea.numberOfHMetrics;break;case"hmtx":v=S;break;case"ltag":O=r_(a,S),n=mb.parse(O.data,O.offset);break;case"maxp":O=r_(a,S),o.tables.maxp=vb.parse(O.data,O.offset),o.numGlyphs=o.tables.maxp.numGlyphs;break;case"name":b=S;break;case"OS/2":O=r_(a,S),o.tables.os2=Pb.parse(O.data,O.offset);break;case"post":O=r_(a,S),o.tables.post=kb.parse(O.data,O.offset),o.glyphNames=new Fy(o.tables.post);break;case"prep":O=r_(a,S),w=new Dy.Parser(O.data,O.offset),o.tables.prep=w.parseByteList(S.length);break;case"glyf":d=S;break;case"loca":y=S;break;case"CFF ":c=S;break;case"kern":g=S;break;case"GDEF":p=S;break;case"GPOS":f=S;break;case"GSUB":m=S;break;case"meta":x=S}}var T=r_(a,b);if(o.tables.name=Mb.parse(T.data,T.offset,n),o.names=o.tables.name,d&&y){var E=0===r,C=r_(a,y),A=Qw.parse(C.data,C.offset,o.numGlyphs,E),M=r_(a,d);o.glyphs=cx.parse(M.data,M.offset,A,o,t)}else{if(!c)throw new Error("Font doesn't contain TrueType or CFF outlines.");var D=r_(a,c);hb.parse(D.data,D.offset,o,t)}var P=r_(a,v);if(fb.parse(o,P.data,P.offset,o.numberOfHMetrics,o.numGlyphs,o.glyphs,t),jy(o,t),g){var k=r_(a,g);o.kerningPairs=Kw.parse(k.data,k.offset)}else o.kerningPairs={};if(p){var L=r_(a,p);o.tables.gdef=$w.parse(L.data,L.offset)}if(f){var U=r_(a,f);o.tables.gpos=Zw.parse(U.data,U.offset),o.position.init()}if(m){var I=r_(a,m);o.tables.gsub=zb.parse(I.data,I.offset)}if(h){var z=r_(a,h);o.tables.fvar=jw.parse(z.data,z.offset,o.names)}if(x){var R=r_(a,x);o.tables.meta=Rb.parse(R.data,R.offset),o.metas=o.tables.meta}return o}function i_(e,t,r){r=r??{};var n=typeof window>"u"&&!r.isUrl?Jw:e_;return new Promise((function(i,o){n(e,(function(e,n){if(e){if(t)return t(e);o(e)}var a;try{a=n_(n,r)}catch(s){if(t)return t(s,null);o(s)}if(t)return t(null,a);i(a)}))}))}function o_(e,t){return n_(Jb(Tg().readFileSync(e)),t)}var a_=Object.freeze({__proto__:null,Font:Iw,Glyph:Vy,Path:Kg,BoundingBox:Zg,_parse:Dy,parse:n_,load:i_,loadSync:o_});const s_=Object.freeze(Object.defineProperty({__proto__:null,Bidi:Cw,BoundingBox:Zg,Font:Iw,Glyph:Vy,Path:Kg,_parse:Dy,default:a_,load:i_,loadSync:o_,parse:n_},Symbol.toStringTag,{value:"Module"}));export{De as _,wg as u};
